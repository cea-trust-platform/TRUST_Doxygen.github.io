<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/Kernel/Utilitaires/Statistiques.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/Kernel/Utilitaires/Statistiques.cpp</div>  </div>
</div>
<div class="contents">
<a href="Statistiques_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (c) 2021, CEA</span>
<a name="l00003"></a>00003 <span class="comment">* All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment">* 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00007"></a>00007 <span class="comment">* 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00008"></a>00008 <span class="comment">* 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<a name="l00011"></a>00011 <span class="comment">* IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;</span>
<a name="l00012"></a>00012 <span class="comment">* OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// File:        Statistiques.cpp</span>
<a name="l00018"></a>00018 <span class="comment">// Directory:   $TRUST_ROOT/src/Kernel/Utilitaires</span>
<a name="l00019"></a>00019 <span class="comment">// Version:     /main/24</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;<a class="code" href="Statistiques_8h.html">Statistiques.h</a>&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="EcrFicPartage_8h.html">EcrFicPartage.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="SChaine_8h.html">SChaine.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;petsc_for_kernel.h&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#ifdef VTRACE</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span><span class="preprocessor">#include &lt;vt_user.h&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#endif</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span><span class="preprocessor">#ifdef MICROSOFT</span>
<a name="l00031"></a>00031 <span class="preprocessor"></span><span class="comment">// struct timeval { time_t tv_usec; time_t tv_sec; };</span>
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;windows.h&gt;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="comment">//</span>
<a name="l00036"></a>00036 <span class="comment">//</span>
<a name="l00037"></a>00037 <span class="comment">// Win32 timing specific function.</span>
<a name="l00038"></a>00038 <span class="comment">// Returns 0 on non-capable machines (Pentium 75 &amp; inferior mostly)</span>
<a name="l00039"></a>00039 <span class="comment">// /////////////////////////////////////////////////////////////////////////</span>
<a name="l00040"></a>00040 LARGE_INTEGER GetFrequency()
<a name="l00041"></a>00041 {
<a name="l00042"></a>00042   LARGE_INTEGER freq;
<a name="l00043"></a>00043   QueryPerformanceFrequency(&amp;freq);
<a name="l00044"></a>00044   <span class="keywordflow">return</span> freq;
<a name="l00045"></a>00045 }
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="keywordtype">double</span>  Now()
<a name="l00048"></a>00048 {
<a name="l00049"></a>00049   LARGE_INTEGER tick, freq;
<a name="l00050"></a>00050   freq = GetFrequency();
<a name="l00051"></a>00051   QueryPerformanceCounter(&amp;tick);
<a name="l00052"></a>00052   <span class="keywordflow">return</span> ((<span class="keywordtype">double</span>)tick.QuadPart) / freq.QuadPart;
<a name="l00053"></a>00053 }
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <span class="keywordtype">int</span> gettimeofday(<span class="keyword">struct</span> timeval *tv ,<span class="keywordtype">int</span> toto)
<a name="l00060"></a>00060 {
<a name="l00061"></a>00061   <span class="keywordtype">double</span> date=Now();
<a name="l00062"></a>00062   tv-&gt;tv_sec=date;
<a name="l00063"></a>00063   <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="Statistiques_8cpp.html#ad0ed10b92f4786ed72a6926f2758b35b">MILLION</a> = 1000000;
<a name="l00064"></a>00064   tv-&gt;tv_usec=(date-tv-&gt;tv_sec)*MILLION;
<a name="l00065"></a>00065   <span class="keywordflow">return</span> 0;
<a name="l00066"></a>00066 }
<a name="l00067"></a>00067 <span class="preprocessor">#else</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span><span class="preprocessor">#include &lt;sys/time.h&gt;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &lt;sys/resource.h&gt;</span>
<a name="l00070"></a>00070 <span class="preprocessor">#endif</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00072"></a>00072 <span class="preprocessor">#include &lt;<a class="code" href="ArrOfDouble_8h.html">ArrOfDouble.h</a>&gt;</span>
<a name="l00073"></a>00073 <span class="preprocessor">#include &lt;<a class="code" href="communications_8h.html">communications.h</a>&gt;</span>
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00076"></a>00076 <span class="comment">// Le pointeur declare dans Statistiques.h</span>
<a name="l00077"></a><a class="code" href="Statistiques_8h.html#a512a2b3ab1289af1ee1131d49e7a0d4b">00077</a> <a class="code" href="classStatistiques.html">Statistiques</a> * <a class="code" href="Statistiques_8cpp.html#a512a2b3ab1289af1ee1131d49e7a0d4b">les_statistiques_trio_U_nom_long_pour_decourager_l_utilisation_directe</a> = 0;
<a name="l00078"></a>00078 
<a name="l00079"></a><a class="code" href="Statistiques_8cpp.html#a97a8b18136d3bd7fa614ff6c3d66acab">00079</a> <span class="preprocessor">#define TIME_IS_gettimeofday</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span>
<a name="l00081"></a>00081 <span class="preprocessor">#ifdef TIME_IS_gettimeofday</span>
<a name="l00082"></a><a class="code" href="Statistiques_8cpp.html#ad550c15ff93e59b8aceaabb8c08188c2">00082</a> <span class="preprocessor"></span><span class="preprocessor">#define GetTimeOfDay_or_rusage</span>
<a name="l00083"></a>00083 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00084"></a>00084 <span class="preprocessor"></span><span class="preprocessor">#ifdef TIME_IS_getrusage</span>
<a name="l00085"></a>00085 <span class="preprocessor"></span><span class="preprocessor">#define GetTimeOfDay_or_rusage</span>
<a name="l00086"></a>00086 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00087"></a>00087 <span class="preprocessor"></span>
<a name="l00088"></a><a class="code" href="Statistiques_8cpp.html#ad974fe981249f5e84fbf1683b012c9f8">00088</a> <span class="preprocessor">#define BUFLEN 100</span>
<a name="l00089"></a>00089 <span class="preprocessor"></span>
<a name="l00090"></a><a class="code" href="Statistiques_8cpp.html#a44eb340230217d191e76723322f5235c">00090</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="Statistiques_8cpp.html#a44eb340230217d191e76723322f5235c">INITIAL_MIN</a> = 1000.0;
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 <span class="comment">// =================================================================</span>
<a name="l00093"></a>00093 <span class="comment">// =================================================================</span>
<a name="l00094"></a>00094 <span class="comment">// DEFINITION DE LA CLASSE TIME (interne au systeme de statistiques)</span>
<a name="l00095"></a>00095 <span class="comment">// =================================================================</span>
<a name="l00096"></a>00096 <span class="comment">// =================================================================</span>
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 <span class="preprocessor">#ifdef GetTimeOfDay_or_rusage</span>
<a name="l00099"></a>00099 <span class="preprocessor"></span><span class="comment">// Sur un PC a 1.5Ghz, le temps d&#39;execution de get_time est de</span>
<a name="l00100"></a>00100 <span class="comment">// 1 micro-seconde.</span>
<a name="l00101"></a>00101 <span class="comment">// getrusage n&#39;est pas utilisable pour le grain fin: la precision</span>
<a name="l00102"></a>00102 <span class="comment">// n&#39;est que de 0.01 s.</span>
<a name="l00103"></a><a class="code" href="Statistiques_8cpp.html#ad0ed10b92f4786ed72a6926f2758b35b">00103</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="Statistiques_8cpp.html#ad0ed10b92f4786ed72a6926f2758b35b">MILLION</a> = 1000000;
<a name="l00104"></a><a class="code" href="classTime.html">00104</a> <span class="keyword">class </span><a class="code" href="classTime.html">Time</a>
<a name="l00105"></a>00105 {
<a name="l00106"></a>00106 <span class="keyword">public</span>:
<a name="l00107"></a><a class="code" href="classTime.html#a4245e409c7347d1d671858962c2ca3b5">00107</a>   <a class="code" href="classTime.html#a4245e409c7347d1d671858962c2ca3b5">Time</a>()
<a name="l00108"></a>00108   {
<a name="l00109"></a>00109     <a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_sec = 0;
<a name="l00110"></a>00110     <a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_usec = 0;
<a name="l00111"></a>00111   }
<a name="l00112"></a>00112   <a class="code" href="classTime.html">Time</a>&amp; <a class="code" href="classTime.html#a58e10a116ef2ea8da0deab304a263b74" title="gcc 9">operator=</a>(<span class="keyword">const</span> <a class="code" href="classTime.html">Time</a>&amp; t) = <span class="keywordflow">default</span>; <span class="comment">//!&lt; gcc 9</span>
<a name="l00113"></a><a class="code" href="classTime.html#a98aa2167191c86090d3edc3c1475ba05">00113</a> <span class="comment"></span>  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="classTime.html#a98aa2167191c86090d3edc3c1475ba05">description</a>;
<a name="l00114"></a><a class="code" href="classTime.html#ab9a42b7809f059a61d89123fb6cd0cf5">00114</a>   <span class="keywordtype">void</span> <a class="code" href="classTime.html#ab9a42b7809f059a61d89123fb6cd0cf5">get_time</a>()
<a name="l00115"></a>00115   {
<a name="l00116"></a>00116 <span class="preprocessor">#ifdef TIME_IS_gettimeofday</span>
<a name="l00117"></a>00117 <span class="preprocessor"></span>    gettimeofday(&amp; <a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>, 0);
<a name="l00118"></a>00118 <span class="preprocessor">#else</span>
<a name="l00119"></a>00119 <span class="preprocessor"></span>    <span class="keyword">struct </span>rusage ru;
<a name="l00120"></a>00120 <span class="comment">// Sous Linux, RUSAGE_BOTH ne fonctionne pas</span>
<a name="l00121"></a>00121     getrusage(RUSAGE_SELF, &amp;ru);
<a name="l00122"></a>00122     <a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a> = ru.ru_utime; <span class="comment">//!&lt; Temps utilisateur ecoule (non systeme)</span>
<a name="l00123"></a>00123 <span class="comment"></span><span class="preprocessor">#endif</span>
<a name="l00124"></a>00124 <span class="preprocessor"></span>  }
<a name="l00125"></a>00125 <span class="comment">// Calcule :</span>
<a name="l00126"></a>00126 <span class="comment">// time_begin = time_end - time_begin</span>
<a name="l00127"></a>00127 <span class="comment">// time_ += time_end - time_begin</span>
<a name="l00128"></a><a class="code" href="classTime.html#adec422502c27100187da1a6fbfd2441c">00128</a>   <span class="keywordtype">void</span> <a class="code" href="classTime.html#adec422502c27100187da1a6fbfd2441c">add_time</a>(<a class="code" href="classTime.html">Time</a>&amp; time_begin, <span class="keyword">const</span> <a class="code" href="classTime.html">Time</a>&amp; time_end)
<a name="l00129"></a>00129   {
<a name="l00130"></a>00130     time_begin.<a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_sec = time_end.<a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_sec - time_begin.<a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_sec;
<a name="l00131"></a>00131     time_begin.<a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_usec = time_end.<a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_usec - time_begin.<a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_usec;
<a name="l00132"></a>00132     <span class="keywordflow">if</span> (<a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_usec &lt; 0)
<a name="l00133"></a>00133       {
<a name="l00134"></a>00134         time_begin.<a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_usec += <a class="code" href="Statistiques_8cpp.html#ad0ed10b92f4786ed72a6926f2758b35b">MILLION</a>;
<a name="l00135"></a>00135         time_begin.<a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_sec--;
<a name="l00136"></a>00136       }
<a name="l00137"></a>00137     <a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_sec += time_begin.<a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_sec;
<a name="l00138"></a>00138     <a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_usec += time_begin.<a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_usec;
<a name="l00139"></a>00139     <span class="keywordflow">if</span> (<a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_usec &gt;= MILLION)
<a name="l00140"></a>00140       {
<a name="l00141"></a>00141         <a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_usec -= <a class="code" href="Statistiques_8cpp.html#ad0ed10b92f4786ed72a6926f2758b35b">MILLION</a>;
<a name="l00142"></a>00142         <a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_sec++;
<a name="l00143"></a>00143       }
<a name="l00144"></a>00144   }
<a name="l00145"></a><a class="code" href="classTime.html#a677b65673911937f2e9fa5e4c7c40f7c">00145</a>   <span class="keywordtype">void</span> <a class="code" href="classTime.html#a677b65673911937f2e9fa5e4c7c40f7c">add</a>(<a class="code" href="classTime.html">Time</a>&amp; time)
<a name="l00146"></a>00146   {
<a name="l00147"></a>00147     <a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_sec += time.<a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_sec;
<a name="l00148"></a>00148     <a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_usec += time.<a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_usec;
<a name="l00149"></a>00149     <span class="keywordflow">if</span> (<a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_usec &gt;= MILLION)
<a name="l00150"></a>00150       {
<a name="l00151"></a>00151         <a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_usec -= <a class="code" href="Statistiques_8cpp.html#ad0ed10b92f4786ed72a6926f2758b35b">MILLION</a>;
<a name="l00152"></a>00152         <a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_sec++;
<a name="l00153"></a>00153       }
<a name="l00154"></a>00154   }
<a name="l00155"></a><a class="code" href="classTime.html#ac5827b15a105d9eece4a7f6e13190da3">00155</a>   <span class="keywordtype">void</span> <a class="code" href="classTime.html#ac5827b15a105d9eece4a7f6e13190da3">minus</a>(<a class="code" href="classTime.html">Time</a>&amp; time)
<a name="l00156"></a>00156   {
<a name="l00157"></a>00157     <a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_sec -= time.<a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_sec;
<a name="l00158"></a>00158     <a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_usec -= time.<a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_usec;
<a name="l00159"></a>00159     <span class="keywordflow">if</span> (<a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_usec &lt; 0)
<a name="l00160"></a>00160       {
<a name="l00161"></a>00161         <a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_usec += <a class="code" href="Statistiques_8cpp.html#ad0ed10b92f4786ed72a6926f2758b35b">MILLION</a>;
<a name="l00162"></a>00162         <a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_sec--;
<a name="l00163"></a>00163       }
<a name="l00164"></a>00164   }
<a name="l00165"></a><a class="code" href="classTime.html#af7938b9dc8519ac4d914182968ffbd78">00165</a>   <span class="keywordtype">double</span> <a class="code" href="classTime.html#af7938b9dc8519ac4d914182968ffbd78">second</a>()<span class="keyword"> const</span>
<a name="l00166"></a>00166 <span class="keyword">  </span>{
<a name="l00167"></a>00167     <span class="keywordflow">return</span> (<span class="keywordtype">double</span>) <a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_sec + 0.000001 * <a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>.tv_usec;
<a name="l00168"></a>00168   }
<a name="l00169"></a>00169 
<a name="l00170"></a>00170 <span class="keyword">private</span>:
<a name="l00171"></a><a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">00171</a>   <span class="keyword">struct </span>timeval <a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>;
<a name="l00172"></a>00172 };
<a name="l00173"></a>00173 <span class="preprocessor">#ifdef TIME_IS_gettimeofday</span>
<a name="l00174"></a>00174 <span class="preprocessor"></span><span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="classTime.html#a98aa2167191c86090d3edc3c1475ba05">Time::description</a> = <span class="stringliteral">&quot;gettimeofday (elapsed CPU time)&quot;</span>;
<a name="l00175"></a>00175 <span class="preprocessor">#else</span>
<a name="l00176"></a>00176 <span class="preprocessor"></span><span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> Time::description = <span class="stringliteral">&quot;getrusage (user CPU time)&quot;</span>;
<a name="l00177"></a>00177 <span class="preprocessor">#endif</span>
<a name="l00178"></a>00178 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00179"></a>00179 <span class="preprocessor"></span>
<a name="l00180"></a>00180 <span class="comment">// =================================================================</span>
<a name="l00181"></a>00181 <span class="comment">// =================================================================</span>
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 <span class="preprocessor">#ifdef TIME_IS_pentium_hardware_clock_counter</span>
<a name="l00184"></a>00184 <span class="preprocessor"></span><span class="comment">// get_time s&#39;execute en quelques cycles (beaucoup plus fin que</span>
<a name="l00185"></a>00185 <span class="comment">// gettimeofday). Marche uniquement sur plateforme Intel.</span>
<a name="l00186"></a>00186 <span class="keyword">class </span><a class="code" href="classTime.html">Time</a>
<a name="l00187"></a>00187 {
<a name="l00188"></a>00188 <span class="keyword">public</span>:
<a name="l00189"></a>00189   <a class="code" href="classTime.html#a4245e409c7347d1d671858962c2ca3b5">Time</a>() : <a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>(0);
<a name="l00190"></a>00190   { }
<a name="l00191"></a>00191   <a class="code" href="classTime.html#a4245e409c7347d1d671858962c2ca3b5">Time</a>(<span class="keyword">const</span> <a class="code" href="classTime.html">Time</a>&amp; t) : <a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>(t.<a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>)
<a name="l00192"></a>00192   { }
<a name="l00193"></a>00193   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="classTime.html#a98aa2167191c86090d3edc3c1475ba05">description</a>;
<a name="l00194"></a>00194   <span class="keywordtype">void</span> <a class="code" href="classTime.html#ab9a42b7809f059a61d89123fb6cd0cf5">get_time</a>()
<a name="l00195"></a>00195   {
<a name="l00196"></a>00196 <span class="comment">// On recupere le clock counter du processeur</span>
<a name="l00197"></a>00197 <span class="comment">// (int 64 bits incremente de 1 a chaque instruction)</span>
<a name="l00198"></a>00198     __asm__ __volatile__(<span class="stringliteral">&quot;rdtsc\n\t&quot;</span> : <span class="stringliteral">&quot;=A&quot;</span> (<a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>) );
<a name="l00199"></a>00199   }
<a name="l00200"></a>00200   <span class="keywordtype">void</span> <a class="code" href="classTime.html#adec422502c27100187da1a6fbfd2441c">add_time</a>(<a class="code" href="classTime.html">Time</a>&amp; time_begin, <span class="keyword">const</span> <a class="code" href="classTime.html">Time</a>&amp; time_end)
<a name="l00201"></a>00201   {
<a name="l00202"></a>00202     time_begin.<a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a> = time_end.<a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a> - time_begin.<a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>;
<a name="l00203"></a>00203     <a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a> += time_begin.<a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>;
<a name="l00204"></a>00204   }
<a name="l00205"></a>00205   <span class="keywordtype">double</span> <a class="code" href="classTime.html#af7938b9dc8519ac4d914182968ffbd78">second</a>()
<a name="l00206"></a>00206   {
<a name="l00207"></a>00207     <span class="keywordflow">if</span> (seconds_per_hardware_clock == 0.)
<a name="l00208"></a>00208       calibrate();
<a name="l00209"></a>00209     <span class="keywordflow">return</span> (<span class="keywordtype">double</span>) <a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a> * seconds_per_hardware_clock;
<a name="l00210"></a>00210   }
<a name="l00211"></a>00211   <span class="keywordtype">void</span> calibrate();
<a name="l00212"></a>00212 <span class="keyword">private</span>:
<a name="l00213"></a>00213   <span class="keyword">static</span> <span class="keywordtype">double</span> seconds_per_hardware_clock;
<a name="l00214"></a>00214   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>; <span class="comment">//!&lt; Entier 64 bits</span>
<a name="l00215"></a>00215 <span class="comment"></span>};
<a name="l00216"></a>00216 
<a name="l00217"></a>00217 <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> Time::description =
<a name="l00218"></a>00218   <span class="stringliteral">&quot;hardware clock counter (elapsed cpu time)&quot;</span>;
<a name="l00219"></a>00219 
<a name="l00220"></a>00220 <span class="keywordtype">double</span> Time::seconds_per_hardware_clock = 0;
<a name="l00221"></a>00221 
<a name="l00222"></a>00222 <span class="keywordtype">void</span> Time::calibrate()
<a name="l00223"></a>00223 {
<a name="l00224"></a>00224   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Time::calibrate() for 1 second &quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00225"></a>00225   timeval t_begin, now;
<a name="l00226"></a>00226   <a class="code" href="classTime.html">Time</a> ticks_begin, ticks_now;
<a name="l00227"></a>00227 
<a name="l00228"></a>00228   gettimeofday(&amp; t_begin, 0);
<a name="l00229"></a>00229   ticks_begin.<a class="code" href="classTime.html#ab9a42b7809f059a61d89123fb6cd0cf5">get_time</a>();
<a name="l00230"></a>00230   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> delta;
<a name="l00231"></a>00231   <span class="keywordflow">do</span>
<a name="l00232"></a>00232     {
<a name="l00233"></a>00233       gettimeofday(&amp; now, 0);
<a name="l00234"></a>00234       ticks_now.<a class="code" href="classTime.html#ab9a42b7809f059a61d89123fb6cd0cf5">get_time</a>();
<a name="l00235"></a>00235       delta = now.tv_usec - t_begin.tv_usec;
<a name="l00236"></a>00236       delta += (now.tv_sec - t_begin.tv_sec) * 1000000;
<a name="l00237"></a>00237     }
<a name="l00238"></a>00238   <span class="keywordflow">while</span> (delta &lt; 1000000);
<a name="l00239"></a>00239   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> delta_ticks = ticks_now.<a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a> - ticks_begin.<a class="code" href="classTime.html#ac57d85cff247dcc8cc63f9b890c0c474">time_</a>;
<a name="l00240"></a>00240   seconds_per_hardware_clock = delta * 0.000001 / (double) delta_ticks;
<a name="l00241"></a>00241 
<a name="l00242"></a>00242   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Result : hardware_clocks_per_second = &quot;</span>;
<a name="l00243"></a>00243   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; 1. / seconds_per_hardware_clock &lt;&lt; finl;
<a name="l00244"></a>00244 }
<a name="l00245"></a>00245 <span class="preprocessor">#endif</span>
<a name="l00246"></a>00246 <span class="preprocessor"></span>
<a name="l00247"></a>00247 <span class="comment">//</span>
<a name="l00248"></a>00248 <span class="comment">//</span><span class="comment"></span>
<a name="l00249"></a>00249 <span class="comment">//! Cette methode renvoie un temps en secondes depuis une origine&lt;br&gt;qui depend de la methode de mesure de la classe Time. Precision, normalement&lt;br&gt;de l&#39;ordre de 1ms ou inferieur.</span>
<a name="l00250"></a><a class="code" href="classStatistiques.html#afce574b1c6577fa642d288f6a6bd0253">00250</a> <span class="comment"></span><span class="keywordtype">double</span> <a class="code" href="classStatistiques.html#afce574b1c6577fa642d288f6a6bd0253" title="Cette methode renvoie un temps en secondes depuis une origine qui depend de la methode de mesure de l...">Statistiques::get_time_now</a>()
<a name="l00251"></a>00251 {
<a name="l00252"></a>00252   <a class="code" href="classTime.html">Time</a> t;
<a name="l00253"></a>00253   t.<a class="code" href="classTime.html#ab9a42b7809f059a61d89123fb6cd0cf5">get_time</a>();
<a name="l00254"></a>00254   <span class="keywordflow">return</span> t.<a class="code" href="classTime.html#af7938b9dc8519ac4d914182968ffbd78">second</a>();
<a name="l00255"></a>00255 }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257 <span class="comment">// =================================================================</span>
<a name="l00258"></a>00258 <span class="comment">// =================================================================</span>
<a name="l00259"></a>00259 
<a name="l00260"></a>00260 
<a name="l00261"></a>00261 <span class="comment">// CLASSE STAT_INTERNALS (interne au systeme de statistiques)</span>
<a name="l00262"></a>00262 <span class="comment">// =================================================================</span>
<a name="l00263"></a>00263 <span class="comment">// =================================================================</span>
<a name="l00264"></a>00264 
<a name="l00265"></a>00265 <span class="comment">// Je mets une limite en dur parce que:</span>
<a name="l00266"></a>00266 <span class="comment">// - un nombre trop eleve de compteurs est sans doute le signe d&#39;un bug</span>
<a name="l00267"></a>00267 <span class="comment">// (creation repetee du meme compteur)</span>
<a name="l00268"></a>00268 <span class="comment">// - dans un premier temps, ca suffit et c&#39;est plus simple</span>
<a name="l00269"></a><a class="code" href="Statistiques_8cpp.html#a93034cb14514e99e0fec6470b1f17e25">00269</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="Statistiques_8cpp.html#a93034cb14514e99e0fec6470b1f17e25">MAXCOUNTERS</a> = 1000;
<a name="l00270"></a>00270 
<a name="l00271"></a><a class="code" href="classStat__Internals.html">00271</a> <span class="keyword">class </span><a class="code" href="classStat__Internals.html">Stat_Internals</a>
<a name="l00272"></a>00272 {
<a name="l00273"></a>00273 <span class="keyword">public</span>:
<a name="l00274"></a>00274   <a class="code" href="classStat__Internals.html#a209a04cbfc12bea81f2a55894d3a6ae6">Stat_Internals</a>();
<a name="l00275"></a><a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">00275</a>   <span class="keywordtype">int</span> <a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>;
<a name="l00276"></a><a class="code" href="classStat__Internals.html#adca4555b4db6aa4030205a554fb8e8c4">00276</a>   <span class="keywordtype">int</span> <a class="code" href="classStat__Internals.html#adca4555b4db6aa4030205a554fb8e8c4">nb_comm_counters</a>;  <span class="comment">//nombre de compteurs de communication</span>
<a name="l00277"></a>00277 
<a name="l00278"></a>00278 <span class="comment">// Tous les compteurs sont crees, meme si le niveau est inferieur,</span>
<a name="l00279"></a>00279 <span class="comment">// cela permet d&#39;activer un niveau superieur au cours du calcul.</span>
<a name="l00280"></a>00280 <span class="comment">// A la fin, on imprime les resultats correspondant au niveau le plus</span>
<a name="l00281"></a>00281 <span class="comment">// eleve atteint au cours du calcul.</span>
<a name="l00282"></a><a class="code" href="classStat__Internals.html#a8fc7bcea1e6db84f0e8ef8de8ecb6232">00282</a>   <span class="keywordtype">int</span> <a class="code" href="classStat__Internals.html#a8fc7bcea1e6db84f0e8ef8de8ecb6232">max_debug_level_during_session</a>;
<a name="l00283"></a>00283 
<a name="l00284"></a><a class="code" href="classStat__Internals.html#a2ca40b1fd6a5056bfeb7361c2021edb4">00284</a>   <a class="code" href="classTime.html">Time</a> <a class="code" href="classStat__Internals.html#a2ca40b1fd6a5056bfeb7361c2021edb4">time_begin</a>[<a class="code" href="Statistiques_8cpp.html#a93034cb14514e99e0fec6470b1f17e25">MAXCOUNTERS</a>];
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 <span class="comment">// Cumul des temps cpu pour chaque compteur</span>
<a name="l00287"></a><a class="code" href="classStat__Internals.html#a68c81952102b4c67885978e0f59c8907">00287</a>   <a class="code" href="classTime.html">Time</a> <a class="code" href="classStat__Internals.html#a68c81952102b4c67885978e0f59c8907">counter_time</a>[<a class="code" href="Statistiques_8cpp.html#a93034cb14514e99e0fec6470b1f17e25">MAXCOUNTERS</a>];
<a name="l00288"></a>00288 <span class="comment">// Le compteur est-il en cours de comptage ?</span>
<a name="l00289"></a><a class="code" href="classStat__Internals.html#a9d4c13e1656b0cb65271d1c67f4a4272">00289</a>   <span class="keywordtype">int</span> <a class="code" href="classStat__Internals.html#a9d4c13e1656b0cb65271d1c67f4a4272">counter_running</a>[<a class="code" href="Statistiques_8cpp.html#a93034cb14514e99e0fec6470b1f17e25">MAXCOUNTERS</a>];
<a name="l00290"></a>00290 <span class="comment">// Nombre de comptages pour chaque compteur</span>
<a name="l00291"></a><a class="code" href="classStat__Internals.html#a3bc661477a7486ba0f19fc734624f367">00291</a>   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <a class="code" href="classStat__Internals.html#a3bc661477a7486ba0f19fc734624f367">counter_nb</a>[<a class="code" href="Statistiques_8cpp.html#a93034cb14514e99e0fec6470b1f17e25">MAXCOUNTERS</a>];
<a name="l00292"></a>00292 <span class="comment">// Cumul des quantites pour chaque compteur</span>
<a name="l00293"></a><a class="code" href="classStat__Internals.html#a6c82f740705153b26cc9e983545273ad">00293</a>   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <a class="code" href="classStat__Internals.html#a6c82f740705153b26cc9e983545273ad">counter_quantity</a>[<a class="code" href="Statistiques_8cpp.html#a93034cb14514e99e0fec6470b1f17e25">MAXCOUNTERS</a>];
<a name="l00294"></a>00294 <span class="comment">// Description des compteurs</span>
<a name="l00295"></a><a class="code" href="classStat__Internals.html#a15f28ff82cee405d14d517fe6bdb6c16">00295</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="classStat__Internals.html#a15f28ff82cee405d14d517fe6bdb6c16">description</a>[<a class="code" href="Statistiques_8cpp.html#a93034cb14514e99e0fec6470b1f17e25">MAXCOUNTERS</a>];
<a name="l00296"></a>00296 <span class="comment">// Famille de chaque compteur</span>
<a name="l00297"></a><a class="code" href="classStat__Internals.html#a649b539b90556341cb019ec95c0b5bbf">00297</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="classStat__Internals.html#a649b539b90556341cb019ec95c0b5bbf">family</a>[<a class="code" href="Statistiques_8cpp.html#a93034cb14514e99e0fec6470b1f17e25">MAXCOUNTERS</a>];
<a name="l00298"></a>00298 <span class="comment">// Niveau de debug du compteur (on n&#39;a pas acces aux Stat_Counter_Id lors</span>
<a name="l00299"></a>00299 <span class="comment">// de l&#39;impression des statistiques, et on veut pouvoir afficher le niveau</span>
<a name="l00300"></a>00300 <span class="comment">// quand meme).</span>
<a name="l00301"></a><a class="code" href="classStat__Internals.html#a76a6ba07d3b416de75d3bd62bbb9126f">00301</a>   <span class="keywordtype">int</span> <a class="code" href="classStat__Internals.html#a76a6ba07d3b416de75d3bd62bbb9126f">counter_level</a>[<a class="code" href="Statistiques_8cpp.html#a93034cb14514e99e0fec6470b1f17e25">MAXCOUNTERS</a>];
<a name="l00302"></a>00302 
<a name="l00303"></a><a class="code" href="classStat__Internals.html#a7d90f34d561db121dca4b9b052416fb2">00303</a>   <span class="keywordtype">int</span> <a class="code" href="classStat__Internals.html#a7d90f34d561db121dca4b9b052416fb2">change_level_forbidden</a>;
<a name="l00304"></a><a class="code" href="classStat__Internals.html#aa95673996dcc78027c70296f5b328333">00304</a>   <span class="keywordtype">int</span> <a class="code" href="classStat__Internals.html#aa95673996dcc78027c70296f5b328333">debug_level_before</a>;
<a name="l00305"></a>00305 
<a name="l00306"></a>00306 <span class="comment">// mapping between counter description and counter id</span>
<a name="l00307"></a><a class="code" href="classStat__Internals.html#adca81cdcf94b48a8b3836203e317e3cb">00307</a>   std::map&lt;const char*, int&gt; <a class="code" href="classStat__Internals.html#adca81cdcf94b48a8b3836203e317e3cb">description_to_id</a>;
<a name="l00308"></a>00308 
<a name="l00309"></a>00309 <span class="comment">// is the counter a communication counter ?</span>
<a name="l00310"></a><a class="code" href="classStat__Internals.html#acf9be2a71aadb932ce038def496aa0f4">00310</a>   <span class="keywordtype">int</span> <a class="code" href="classStat__Internals.html#acf9be2a71aadb932ce038def496aa0f4">counter_comm</a>[<a class="code" href="Statistiques_8cpp.html#a93034cb14514e99e0fec6470b1f17e25">MAXCOUNTERS</a>];
<a name="l00311"></a>00311 <span class="comment">// est-ce qu&#39;on traque les communications pour ce compteur ?</span>
<a name="l00312"></a><a class="code" href="classStat__Internals.html#a2bd8a11dd20c95119aadd64a02a4e962">00312</a>   <span class="keywordtype">bool</span> <a class="code" href="classStat__Internals.html#a2bd8a11dd20c95119aadd64a02a4e962">comm_zones_on</a>[<a class="code" href="Statistiques_8cpp.html#a93034cb14514e99e0fec6470b1f17e25">MAXCOUNTERS</a>];
<a name="l00313"></a>00313 <span class="comment">// if the counter is a communication, give its index inside the communication_tracking_info array (-1 otherwise)</span>
<a name="l00314"></a><a class="code" href="classStat__Internals.html#a99685fe38179ce69ca479aea547eaee8">00314</a>   <span class="keywordtype">int</span> <a class="code" href="classStat__Internals.html#a99685fe38179ce69ca479aea547eaee8">index_in_communication_tracking_info</a>[<a class="code" href="Statistiques_8cpp.html#a93034cb14514e99e0fec6470b1f17e25">MAXCOUNTERS</a>];
<a name="l00315"></a>00315 
<a name="l00316"></a>00316   <span class="comment">/* tableau stockant les temps de communication de chaque zone du code souhaitee</span>
<a name="l00317"></a>00317 <span class="comment">   * 1ere dimension : les differents types de communication</span>
<a name="l00318"></a>00318 <span class="comment">   * 2eme dimension : le temps passe dans chaque zone  de communication qu&#39;on a definie pour chaque compteur</span>
<a name="l00319"></a>00319 <span class="comment">   * ==&gt; quand j different de 0 : l&#39;element (i,j) du tableau contient le temps passe dans la zone j par la communication i</span>
<a name="l00320"></a>00320 <span class="comment">   * ==&gt; quand j = 0 : l&#39;element (i,j) contient le temps total (dans tout le code) consomme par la communication i</span>
<a name="l00321"></a>00321 <span class="comment">   */</span>
<a name="l00322"></a><a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">00322</a>   <a class="code" href="classStat__Results.html">Stat_Results</a>** <a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">communication_tracking_info</a>;
<a name="l00323"></a>00323 
<a name="l00324"></a>00324 
<a name="l00325"></a>00325   <span class="comment">/*</span>
<a name="l00326"></a>00326 <span class="comment">   * Ce tableau stocke et calcule a la fin de chaque iteration:</span>
<a name="l00327"></a>00327 <span class="comment">   * 1: le cumul du temps passe dans chaque compteur sans compter la derniere iteration</span>
<a name="l00328"></a>00328 <span class="comment">   * 2: la moyenne du temps passe dans chaque compteur durant une iteration</span>
<a name="l00329"></a>00329 <span class="comment">   * 3: le temps minimal passe durant une iteration pour chaque compteur</span>
<a name="l00330"></a>00330 <span class="comment">   * 4: le temps maximal passe durant une iteration pour chaque compteur</span>
<a name="l00331"></a>00331 <span class="comment">   * 5: la variance du temps passe dans chaque compteur durant une iteration</span>
<a name="l00332"></a>00332 <span class="comment">   */</span>
<a name="l00333"></a><a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">00333</a>   <span class="keywordtype">double</span> <a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[<a class="code" href="Statistiques_8cpp.html#a93034cb14514e99e0fec6470b1f17e25">MAXCOUNTERS</a>][5];
<a name="l00334"></a>00334 };
<a name="l00335"></a>00335 
<a name="l00336"></a><a class="code" href="classStat__Internals.html#a209a04cbfc12bea81f2a55894d3a6ae6">00336</a> <a class="code" href="classStat__Internals.html#a209a04cbfc12bea81f2a55894d3a6ae6">Stat_Internals::Stat_Internals</a>() :
<a name="l00337"></a>00337   nb_counters(0),
<a name="l00338"></a>00338   nb_comm_counters(0),
<a name="l00339"></a>00339   max_debug_level_during_session(0),
<a name="l00340"></a>00340   change_level_forbidden(0),
<a name="l00341"></a>00341   debug_level_before(0),
<a name="l00342"></a>00342   communication_tracking_info(0)
<a name="l00343"></a>00343 {
<a name="l00344"></a>00344   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="Statistiques_8cpp.html#a93034cb14514e99e0fec6470b1f17e25">MAXCOUNTERS</a>; i++)
<a name="l00345"></a>00345     {
<a name="l00346"></a>00346       <a class="code" href="classStat__Internals.html#a9d4c13e1656b0cb65271d1c67f4a4272">counter_running</a>[i] = 0;
<a name="l00347"></a>00347       <a class="code" href="classStat__Internals.html#a3bc661477a7486ba0f19fc734624f367">counter_nb</a>[i] = 0;
<a name="l00348"></a>00348       <a class="code" href="classStat__Internals.html#a6c82f740705153b26cc9e983545273ad">counter_quantity</a>[i] = 0;
<a name="l00349"></a>00349       <a class="code" href="classStat__Internals.html#a15f28ff82cee405d14d517fe6bdb6c16">description</a>[i] = 0;
<a name="l00350"></a>00350       <a class="code" href="classStat__Internals.html#a649b539b90556341cb019ec95c0b5bbf">family</a>[i] = 0;
<a name="l00351"></a>00351       <a class="code" href="classStat__Internals.html#a76a6ba07d3b416de75d3bd62bbb9126f">counter_level</a>[i] = 0;
<a name="l00352"></a>00352       <a class="code" href="classStat__Internals.html#acf9be2a71aadb932ce038def496aa0f4">counter_comm</a>[i] = 0;
<a name="l00353"></a>00353       <a class="code" href="classStat__Internals.html#a2bd8a11dd20c95119aadd64a02a4e962">comm_zones_on</a>[i] = <span class="keyword">false</span>;
<a name="l00354"></a>00354       <a class="code" href="classStat__Internals.html#a99685fe38179ce69ca479aea547eaee8">index_in_communication_tracking_info</a>[i] = -1;
<a name="l00355"></a>00355 
<a name="l00356"></a>00356       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; 5; j++)
<a name="l00357"></a>00357         {
<a name="l00358"></a>00358           <span class="keywordflow">if</span>(j==2)  <span class="comment">//temps minimum ecoule lors d&#39;une iteration : on l&#39;initialise par une valeur arbitrairement grande</span>
<a name="l00359"></a>00359             <a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][j] = <a class="code" href="Statistiques_8cpp.html#a44eb340230217d191e76723322f5235c">INITIAL_MIN</a>;
<a name="l00360"></a>00360           <span class="keywordflow">else</span>
<a name="l00361"></a>00361             <a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][j] = 0.0;
<a name="l00362"></a>00362         }
<a name="l00363"></a>00363     }
<a name="l00364"></a>00364 }
<a name="l00365"></a>00365 
<a name="l00366"></a>00366 <span class="comment">// =========================================================================</span>
<a name="l00367"></a>00367 <span class="comment">// =========================================================================</span>
<a name="l00368"></a>00368 
<a name="l00369"></a>00369 <span class="comment">// IMPLEMENTATION DE LA CLASSE Statistiques</span>
<a name="l00370"></a>00370 <span class="comment">// =========================================================================</span>
<a name="l00371"></a>00371 <span class="comment">// =========================================================================</span>
<a name="l00372"></a><a class="code" href="classStatistiques.html#a4ecd522328776fb86ba21d6a3dfe8d70">00372</a> <a class="code" href="classStatistiques.html#a4ecd522328776fb86ba21d6a3dfe8d70">Statistiques::Statistiques</a>()
<a name="l00373"></a>00373 {
<a name="l00374"></a>00374   <a class="code" href="classStatistiques.html#aedc55c74ea44d73052ef59db108b45ed">total_time_</a> = 0;
<a name="l00375"></a>00375   <a class="code" href="classStatistiques.html#a9cb454c21eb3395788b2bf386c103acb">debug_level_</a> = 0;
<a name="l00376"></a>00376   <a class="code" href="classStatistiques.html#a91eedfbf675836564ff5d7250a31a85c">three_first_steps_elapsed_</a> = <span class="keyword">false</span>;
<a name="l00377"></a>00377   <a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a> = <span class="keyword">new</span> <a class="code" href="classStat__Internals.html">Stat_Internals</a>();
<a name="l00378"></a>00378 }
<a name="l00379"></a>00379 
<a name="l00380"></a><a class="code" href="classStatistiques.html#a0b3904d9f448c4eb3c88074932c25051">00380</a> <a class="code" href="classStatistiques.html#a0b3904d9f448c4eb3c88074932c25051">Statistiques::~Statistiques</a>()
<a name="l00381"></a>00381 {
<a name="l00382"></a>00382 <span class="comment">// Cerr &lt;&lt; &quot;Stat::~Stat called !!! &quot; &lt;&lt; finl;</span>
<a name="l00383"></a>00383 
<a name="l00384"></a>00384   <span class="keyword">delete</span> <a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a>;
<a name="l00385"></a>00385   <a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a> = 0;
<a name="l00386"></a>00386 }
<a name="l00387"></a>00387 
<a name="l00388"></a><a class="code" href="classStatistiques.html#a4cd169e5658c3181ed233bf3b4259d05">00388</a> <span class="keywordtype">void</span> <a class="code" href="classStatistiques.html#a4cd169e5658c3181ed233bf3b4259d05">Statistiques::set_debug_level</a>(<span class="keywordtype">int</span> level)
<a name="l00389"></a>00389 {
<a name="l00390"></a>00390   <a class="code" href="classStat__Internals.html">Stat_Internals</a>&amp; si = *<a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a>;
<a name="l00391"></a>00391 <span class="comment">// Lors de l&#39;impression des stats, on bloque les compteurs.</span>
<a name="l00392"></a>00392 <span class="comment">// Le niveau est mis a zero, et</span>
<a name="l00393"></a>00393 <span class="comment">// on n&#39;a pas le droit de changer de niveau.</span>
<a name="l00394"></a>00394   <span class="keywordflow">if</span> (si.<a class="code" href="classStat__Internals.html#a7d90f34d561db121dca4b9b052416fb2">change_level_forbidden</a>)
<a name="l00395"></a>00395     <span class="keywordflow">return</span>;
<a name="l00396"></a>00396 
<a name="l00397"></a>00397   <a class="code" href="classStatistiques.html#a9cb454c21eb3395788b2bf386c103acb">debug_level_</a> = level;
<a name="l00398"></a>00398   <span class="keywordflow">if</span> (level &gt; si.<a class="code" href="classStat__Internals.html#a8fc7bcea1e6db84f0e8ef8de8ecb6232">max_debug_level_during_session</a>)
<a name="l00399"></a>00399     si.<a class="code" href="classStat__Internals.html#a8fc7bcea1e6db84f0e8ef8de8ecb6232">max_debug_level_during_session</a> = level;
<a name="l00400"></a>00400 }
<a name="l00401"></a>00401 
<a name="l00402"></a>00402 <span class="comment">// Voir Statistiques.h pour le commentaire...</span>
<a name="l00403"></a>00403 
<a name="l00404"></a><a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">00404</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">Statistiques::new_counter</a>(<span class="keywordtype">int</span> level,
<a name="l00405"></a>00405                                           <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> description,
<a name="l00406"></a>00406                                           <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> family,
<a name="l00407"></a>00407                                           <span class="keywordtype">int</span> <a class="code" href="MD__Vector__tools_8cpp.html#aff39c4429f5c1b24eb7ac0848f154ffc">comm</a>)
<a name="l00408"></a>00408 {
<a name="l00409"></a>00409   <a class="code" href="classStat__Internals.html">Stat_Internals</a>&amp; si = *<a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a>;
<a name="l00410"></a>00410   assert(description); <span class="comment">//!&lt; Pointeur non nul ?</span>
<a name="l00411"></a>00411 <span class="comment"></span>  <span class="keywordflow">if</span> (si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a> &gt;= MAXCOUNTERS)
<a name="l00412"></a>00412     {
<a name="l00413"></a>00413       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Stat_Counter_Id::new_counter : too much counters.&quot;</span> &lt;&lt; finl;
<a name="l00414"></a>00414       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Check this : new_counter must be called only once per counter.&quot;</span> &lt;&lt; finl;
<a name="l00415"></a>00415       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; (counter &quot;</span> &lt;&lt; description &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; finl;
<a name="l00416"></a>00416       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Otherwise, increase MAXCOUNTERS in Statistiques.cpp.&quot;</span> &lt;&lt; finl;
<a name="l00417"></a>00417       assert(0);
<a name="l00418"></a>00418       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00419"></a>00419     }
<a name="l00420"></a>00420   <span class="keywordtype">int</span> length = strlen(description);
<a name="l00421"></a>00421   <span class="keywordflow">if</span> (family) length += strlen(family);
<a name="l00422"></a>00422   <span class="keywordflow">if</span> (length &gt; <a class="code" href="Statistiques_8cpp.html#ad974fe981249f5e84fbf1683b012c9f8">BUFLEN</a> - 10)
<a name="l00423"></a>00423     {
<a name="l00424"></a>00424       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Statistiques::new_counter : description or family : string too long&quot;</span>
<a name="l00425"></a>00425            &lt;&lt; finl;
<a name="l00426"></a>00426       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; description &lt;&lt; finl;
<a name="l00427"></a>00427       assert(0);
<a name="l00428"></a>00428       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00429"></a>00429     }
<a name="l00430"></a>00430 
<a name="l00431"></a>00431   <span class="keywordflow">if</span> (level &lt; 1)
<a name="l00432"></a>00432     level = 1;
<a name="l00433"></a>00433 
<a name="l00434"></a>00434   <span class="keyword">const</span> <span class="keywordtype">int</span> <span class="keywordtype">id</span> = si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>;
<a name="l00435"></a>00435   <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> new_id(<span class="keywordtype">id</span>, level);
<a name="l00436"></a>00436   si.<a class="code" href="classStat__Internals.html#a76a6ba07d3b416de75d3bd62bbb9126f">counter_level</a>[id] = level;
<a name="l00437"></a>00437   si.<a class="code" href="classStat__Internals.html#a15f28ff82cee405d14d517fe6bdb6c16">description</a>[id] = description;
<a name="l00438"></a>00438   si.<a class="code" href="classStat__Internals.html#a649b539b90556341cb019ec95c0b5bbf">family</a>[id] = family;
<a name="l00439"></a>00439   si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>++;
<a name="l00440"></a>00440   si.<a class="code" href="classStat__Internals.html#adca81cdcf94b48a8b3836203e317e3cb">description_to_id</a>[description] = id;
<a name="l00441"></a>00441 
<a name="l00442"></a>00442   si.<a class="code" href="classStat__Internals.html#acf9be2a71aadb932ce038def496aa0f4">counter_comm</a>[id] = <a class="code" href="MD__Vector__tools_8cpp.html#aff39c4429f5c1b24eb7ac0848f154ffc">comm</a>;
<a name="l00443"></a>00443   <span class="keywordflow">if</span> (comm)
<a name="l00444"></a>00444     {
<a name="l00445"></a>00445       si.<a class="code" href="classStat__Internals.html#a99685fe38179ce69ca479aea547eaee8">index_in_communication_tracking_info</a>[id] = si.<a class="code" href="classStat__Internals.html#adca4555b4db6aa4030205a554fb8e8c4">nb_comm_counters</a>;
<a name="l00446"></a>00446       si.<a class="code" href="classStat__Internals.html#adca4555b4db6aa4030205a554fb8e8c4">nb_comm_counters</a>++;
<a name="l00447"></a>00447     }
<a name="l00448"></a>00448 
<a name="l00449"></a>00449   <span class="keywordflow">return</span> new_id;
<a name="l00450"></a>00450 }
<a name="l00451"></a>00451 
<a name="l00452"></a><a class="code" href="classStatistiques.html#ae1be075c9bd65c1534af067cfcee76c6">00452</a> <span class="keywordtype">void</span> <a class="code" href="classStatistiques.html#ae1be075c9bd65c1534af067cfcee76c6">Statistiques::begin_count_</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> <span class="keywordtype">id</span>)
<a name="l00453"></a>00453 {
<a name="l00454"></a>00454   <a class="code" href="classStat__Internals.html">Stat_Internals</a>&amp; si = *<a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a>;
<a name="l00455"></a>00455   assert(<span class="keywordtype">id</span> &lt; si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>);
<a name="l00456"></a>00456 
<a name="l00457"></a>00457   <span class="keywordflow">if</span>(si.<a class="code" href="classStat__Internals.html#a9d4c13e1656b0cb65271d1c67f4a4272">counter_running</a>[<span class="keywordtype">id</span>])
<a name="l00458"></a>00458     {
<a name="l00459"></a>00459       <a class="code" href="classProcess.html#a57e0f54b11e6eaadbea224fa904b18dd" title="Renvoie un objet statique de type Sortie qui sert de journal d&#39;evenements. Si message_level &lt;= verbose...">Process::Journal</a>() &lt;&lt; <span class="stringliteral">&quot;WARNING : counter &quot;</span> &lt;&lt; si.<a class="code" href="classStat__Internals.html#a15f28ff82cee405d14d517fe6bdb6c16">description</a>[id]
<a name="l00460"></a>00460                          &lt;&lt; <span class="stringliteral">&quot; has been started while it&#39;s already running !&quot;</span> &lt;&lt; finl;
<a name="l00461"></a>00461       <span class="keywordflow">return</span>;
<a name="l00462"></a>00462     }
<a name="l00463"></a>00463 
<a name="l00464"></a>00464 
<a name="l00465"></a>00465 <span class="comment">// demarrage des compteurs seulement apres les 3 premieres iterations car elles peuvent fausser les statistiques</span>
<a name="l00466"></a>00466 <span class="comment">// (on demarre le compteur du temps total sans attendre que les 3 premiers pas de temps soient ecoules)</span>
<a name="l00467"></a>00467   <span class="keywordtype">bool</span> is_temps_total = strcmp(si.<a class="code" href="classStat__Internals.html#a15f28ff82cee405d14d517fe6bdb6c16">description</a>[<span class="keywordtype">id</span>], <span class="stringliteral">&quot;Temps total&quot;</span>) == 0;
<a name="l00468"></a>00468   <span class="keywordflow">if</span> ( (<a class="code" href="Statistiques_8h.html#a1bcfabda5482a837da0f52c13f997a92">JUMP_3_FIRST_STEPS</a> &amp;&amp; (is_temps_total || <a class="code" href="classStatistiques.html#a91eedfbf675836564ff5d7250a31a85c">three_first_steps_elapsed_</a> ) )
<a name="l00469"></a>00469        || !<a class="code" href="Statistiques_8h.html#a1bcfabda5482a837da0f52c13f997a92">JUMP_3_FIRST_STEPS</a>)
<a name="l00470"></a>00470     {
<a name="l00471"></a>00471       si.<a class="code" href="classStat__Internals.html#a2ca40b1fd6a5056bfeb7361c2021edb4">time_begin</a>[id].<a class="code" href="classTime.html#ab9a42b7809f059a61d89123fb6cd0cf5">get_time</a>();
<a name="l00472"></a>00472       si.<a class="code" href="classStat__Internals.html#a9d4c13e1656b0cb65271d1c67f4a4272">counter_running</a>[id] = 1;
<a name="l00473"></a>00473 <span class="preprocessor">#ifdef PETSCKSP_H</span>
<a name="l00474"></a>00474 <span class="preprocessor"></span>      <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> <a class="code" href="Champ__implementation__Q1_8cpp.html#a29045c997670516117cd2d1cac1069ed">info</a>(si.<a class="code" href="classStat__Internals.html#a15f28ff82cee405d14d517fe6bdb6c16">description</a>[<span class="keywordtype">id</span>]);
<a name="l00475"></a>00475       info+=<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00476"></a>00476       PetscInfo(0,info);
<a name="l00477"></a>00477 <span class="preprocessor">#endif</span>
<a name="l00478"></a>00478 <span class="preprocessor"></span><span class="preprocessor">#ifdef VTRACE</span>
<a name="l00479"></a>00479 <span class="preprocessor"></span><span class="comment">// Level 1 only to avoid MPI calls</span>
<a name="l00480"></a>00480       <span class="keywordflow">if</span> (si.<a class="code" href="classStat__Internals.html#a76a6ba07d3b416de75d3bd62bbb9126f">counter_level</a>[<span class="keywordtype">id</span>]==1) VT_USER_START(si.<a class="code" href="classStat__Internals.html#a15f28ff82cee405d14d517fe6bdb6c16">description</a>[<span class="keywordtype">id</span>]);
<a name="l00481"></a>00481 <span class="preprocessor">#endif</span>
<a name="l00482"></a>00482 <span class="preprocessor"></span>    }
<a name="l00483"></a>00483 
<a name="l00484"></a>00484 }
<a name="l00485"></a>00485 
<a name="l00486"></a><a class="code" href="classStatistiques.html#a068333577be7c53eeb27d2f067ed6b36">00486</a> <span class="keywordtype">void</span> <a class="code" href="classStatistiques.html#a068333577be7c53eeb27d2f067ed6b36">Statistiques::end_count_</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">int</span> quantity, <span class="keywordtype">int</span> count)
<a name="l00487"></a>00487 {
<a name="l00488"></a>00488   <a class="code" href="classStat__Internals.html">Stat_Internals</a>&amp; si = *<a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a>;
<a name="l00489"></a>00489   assert(<span class="keywordtype">id</span> &lt; si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>);
<a name="l00490"></a>00490 
<a name="l00491"></a>00491 <span class="comment">// arret des compteurs seulement apres les 3 premieres iterations (car on les demarre seulement apres 3 iterations)</span>
<a name="l00492"></a>00492   <span class="keywordtype">bool</span> is_temps_total = strcmp(si.<a class="code" href="classStat__Internals.html#a15f28ff82cee405d14d517fe6bdb6c16">description</a>[<span class="keywordtype">id</span>], <span class="stringliteral">&quot;Temps total&quot;</span>) == 0;
<a name="l00493"></a>00493   <span class="keywordflow">if</span> ( (<a class="code" href="Statistiques_8h.html#a1bcfabda5482a837da0f52c13f997a92">JUMP_3_FIRST_STEPS</a> &amp;&amp; (is_temps_total || <a class="code" href="classStatistiques.html#a91eedfbf675836564ff5d7250a31a85c">three_first_steps_elapsed_</a> ) )
<a name="l00494"></a>00494        || !<a class="code" href="Statistiques_8h.html#a1bcfabda5482a837da0f52c13f997a92">JUMP_3_FIRST_STEPS</a>)
<a name="l00495"></a>00495     {
<a name="l00496"></a>00496       <span class="keywordflow">if</span> (si.<a class="code" href="classStat__Internals.html#a9d4c13e1656b0cb65271d1c67f4a4272">counter_running</a>[<span class="keywordtype">id</span>])
<a name="l00497"></a>00497         {
<a name="l00498"></a>00498           <a class="code" href="classTime.html">Time</a> time_end;
<a name="l00499"></a>00499           time_end.<a class="code" href="classTime.html#ab9a42b7809f059a61d89123fb6cd0cf5">get_time</a>();
<a name="l00500"></a>00500           si.<a class="code" href="classStat__Internals.html#a68c81952102b4c67885978e0f59c8907">counter_time</a>[id].<a class="code" href="classTime.html#adec422502c27100187da1a6fbfd2441c">add_time</a>(si.<a class="code" href="classStat__Internals.html#a2ca40b1fd6a5056bfeb7361c2021edb4">time_begin</a>[<span class="keywordtype">id</span>], time_end);
<a name="l00501"></a>00501           si.<a class="code" href="classStat__Internals.html#a9d4c13e1656b0cb65271d1c67f4a4272">counter_running</a>[id] = 0;
<a name="l00502"></a>00502           si.<a class="code" href="classStat__Internals.html#a3bc661477a7486ba0f19fc734624f367">counter_nb</a>[id] += count;
<a name="l00503"></a>00503           si.<a class="code" href="classStat__Internals.html#a6c82f740705153b26cc9e983545273ad">counter_quantity</a>[id] += quantity;
<a name="l00504"></a>00504 <span class="preprocessor">#ifdef VTRACE</span>
<a name="l00505"></a>00505 <span class="preprocessor"></span><span class="comment">// Level 1 only to avoid MPI calls</span>
<a name="l00506"></a>00506           <span class="keywordflow">if</span> (si.<a class="code" href="classStat__Internals.html#a76a6ba07d3b416de75d3bd62bbb9126f">counter_level</a>[<span class="keywordtype">id</span>]==1) VT_USER_END(si.<a class="code" href="classStat__Internals.html#a15f28ff82cee405d14d517fe6bdb6c16">description</a>[<span class="keywordtype">id</span>]);
<a name="l00507"></a>00507 <span class="preprocessor">#endif</span>
<a name="l00508"></a>00508 <span class="preprocessor"></span>        }
<a name="l00509"></a>00509     }
<a name="l00510"></a>00510 
<a name="l00511"></a>00511 
<a name="l00512"></a>00512 }
<a name="l00513"></a>00513 
<a name="l00514"></a>00514 <span class="comment">// Si le compteur n&#39;est pas arrete, renvoie le temps depuis</span>
<a name="l00515"></a>00515 <span class="comment">// le dernier demarrage du compteur. Sinon, renvoie le dernier</span>
<a name="l00516"></a>00516 <span class="comment">// intervalle de temps mesure.</span>
<a name="l00517"></a><a class="code" href="classStatistiques.html#a21c24113a2042f33ce1134b473ebc1ac">00517</a> <span class="keywordtype">double</span> <a class="code" href="classStatistiques.html#a21c24113a2042f33ce1134b473ebc1ac">Statistiques::last_time</a>(<span class="keyword">const</span> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a>&amp; counter_id)
<a name="l00518"></a>00518 {
<a name="l00519"></a>00519   <a class="code" href="classStat__Internals.html">Stat_Internals</a>&amp; si = *<a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a>;
<a name="l00520"></a>00520   <span class="keywordflow">if</span> (si.<a class="code" href="classStat__Internals.html#a9d4c13e1656b0cb65271d1c67f4a4272">counter_running</a>[counter_id.<a class="code" href="classStat__Counter__Id.html#a33db57ea355a4567d6677d71bde15901">id_</a>])
<a name="l00521"></a>00521     {
<a name="l00522"></a>00522       <a class="code" href="classTime.html">Time</a> time_begin(si.<a class="code" href="classStat__Internals.html#a2ca40b1fd6a5056bfeb7361c2021edb4">time_begin</a>[counter_id.<a class="code" href="classStat__Counter__Id.html#a33db57ea355a4567d6677d71bde15901">id_</a>]);
<a name="l00523"></a>00523       <a class="code" href="classTime.html">Time</a> time_end;
<a name="l00524"></a>00524       time_end.<a class="code" href="classTime.html#ab9a42b7809f059a61d89123fb6cd0cf5">get_time</a>();
<a name="l00525"></a>00525       <a class="code" href="classTime.html">Time</a> delta;
<a name="l00526"></a>00526       delta.<a class="code" href="classTime.html#adec422502c27100187da1a6fbfd2441c">add_time</a>(time_begin, time_end);
<a name="l00527"></a>00527       <span class="keywordflow">return</span> delta.<a class="code" href="classTime.html#af7938b9dc8519ac4d914182968ffbd78">second</a>();
<a name="l00528"></a>00528     }
<a name="l00529"></a>00529   <span class="keywordflow">else</span>
<a name="l00530"></a>00530     {
<a name="l00531"></a>00531       <span class="keywordflow">return</span> si.<a class="code" href="classStat__Internals.html#a2ca40b1fd6a5056bfeb7361c2021edb4">time_begin</a>[counter_id.<a class="code" href="classStat__Counter__Id.html#a33db57ea355a4567d6677d71bde15901">id_</a>].<a class="code" href="classTime.html#af7938b9dc8519ac4d914182968ffbd78">second</a>();
<a name="l00532"></a>00532     }
<a name="l00533"></a>00533 }
<a name="l00534"></a>00534 
<a name="l00535"></a>00535 
<a name="l00536"></a>00536 <span class="comment">// static =&gt; ne pas exporter cette fonction</span>
<a name="l00537"></a><a class="code" href="Statistiques_8cpp.html#a94cee1daf927202c49f853aadf1c06c2">00537</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="Statistiques_8cpp.html#a94cee1daf927202c49f853aadf1c06c2">print_stat</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; perfs,
<a name="l00538"></a>00538                        <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; perfs_globales,
<a name="l00539"></a>00539                        <span class="keyword">const</span> <span class="keywordtype">char</span> * description,
<a name="l00540"></a>00540                        <span class="keywordtype">int</span> level,
<a name="l00541"></a>00541                        <span class="keywordtype">double</span> time,
<a name="l00542"></a>00542                        <span class="keywordtype">double</span> nb,
<a name="l00543"></a>00543                        <span class="keywordtype">double</span> quantity,
<a name="l00544"></a>00544                        <span class="keywordtype">double</span> temps_total_max,
<a name="l00545"></a>00545                        <span class="keywordtype">int</span> skip_globals,
<a name="l00546"></a>00546                        <span class="keywordtype">double</span> avg_time_per_step = 0,
<a name="l00547"></a>00547                        <span class="keywordtype">double</span> min_time_per_step = 0,
<a name="l00548"></a>00548                        <span class="keywordtype">double</span> max_time_per_step = 0,
<a name="l00549"></a>00549                        <span class="keywordtype">double</span> var_time_per_step = 0)
<a name="l00550"></a>00550 {
<a name="l00551"></a>00551   <span class="keywordtype">char</span> tampon[<a class="code" href="Statistiques_8cpp.html#ad974fe981249f5e84fbf1683b012c9f8">BUFLEN</a>+200];
<a name="l00552"></a>00552   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>() &gt; 1)
<a name="l00553"></a>00553     {
<a name="l00554"></a>00554       <span class="keywordtype">double</span> percent_time = (temps_total_max==0 ? 0 : time / temps_total_max * 100.);
<a name="l00555"></a>00555 
<a name="l00556"></a>00556       <span class="keywordtype">char</span> s[50];
<a name="l00557"></a>00557       s[0] = 0;
<a name="l00558"></a>00558 
<a name="l00559"></a>00559       <span class="keywordflow">if</span> (min_time_per_step != max_time_per_step)
<a name="l00560"></a>00560         sprintf(s, <span class="stringliteral">&quot;(%0.3f,%0.3f, %0.3f)&quot;</span>, min_time_per_step == INITIAL_MIN? 0.0 : min_time_per_step, max_time_per_step, var_time_per_step);
<a name="l00561"></a>00561 
<a name="l00562"></a>00562       sprintf(tampon, <span class="stringliteral">&quot;%55s (%02d) %10.2f %5.1f%% %10.3g %10.3g %10.2f %10s &quot;</span>,
<a name="l00563"></a>00563               description, (<a class="code" href="arch_8h.html#a1caaf369d9c5f0817dbaa76b43b8d87b">True_int</a>)level, time, percent_time, nb, quantity,
<a name="l00564"></a>00564               avg_time_per_step, s);
<a name="l00565"></a>00565       perfs &lt;&lt; tampon &lt;&lt; finl;
<a name="l00566"></a>00566     }
<a name="l00567"></a>00567 
<a name="l00568"></a>00568   <span class="keywordflow">if</span> (! skip_globals)
<a name="l00569"></a>00569     {
<a name="l00570"></a>00570       <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> tmp(3);
<a name="l00571"></a>00571 <span class="comment">// Min</span>
<a name="l00572"></a>00572       tmp(0)=time;
<a name="l00573"></a>00573       tmp(1)=nb;
<a name="l00574"></a>00574       tmp(2)=quantity;
<a name="l00575"></a>00575       <a class="code" href="communications_8cpp.html#aba41fffdc595094c8dfb819a44ca3f0a">mp_min_for_each_item</a>(tmp);
<a name="l00576"></a>00576       <span class="keywordtype">double</span> min_time = tmp(0);
<a name="l00577"></a>00577       <span class="keywordtype">double</span> min_nb = tmp(1);
<a name="l00578"></a>00578       <span class="keywordtype">double</span> min_quantity = tmp(2);
<a name="l00579"></a>00579 
<a name="l00580"></a>00580 <span class="comment">// Max</span>
<a name="l00581"></a>00581       tmp(0)=time;
<a name="l00582"></a>00582       tmp(1)=nb;
<a name="l00583"></a>00583       tmp(2)=quantity;
<a name="l00584"></a>00584       <a class="code" href="communications_8cpp.html#aafa4a4611353c452208f47a6e4381488">mp_max_for_each_item</a>(tmp);
<a name="l00585"></a>00585       <span class="keywordtype">double</span> max_time = tmp(0);
<a name="l00586"></a>00586       <span class="keywordtype">double</span> max_nb = tmp(1);
<a name="l00587"></a>00587       <span class="keywordtype">double</span> max_quantity = tmp(2);
<a name="l00588"></a>00588 
<a name="l00589"></a>00589 <span class="comment">// Average</span>
<a name="l00590"></a>00590       tmp.<a class="code" href="classArrOfDouble.html#aa5d7035f2e4f451c484aabd5dffb873b" title="appel a ArrOfDouble::resize_array()">resize</a>(5);
<a name="l00591"></a>00591       tmp(0)=time;
<a name="l00592"></a>00592       tmp(1)=nb;
<a name="l00593"></a>00593       tmp(2)=quantity;
<a name="l00594"></a>00594       tmp(3)=avg_time_per_step;
<a name="l00595"></a>00595       tmp(4)=var_time_per_step;
<a name="l00596"></a>00596       <a class="code" href="communications_8cpp.html#a5f15b8a5c15449d3277ff3cde06fa68a">mp_sum_for_each_item</a>(tmp);
<a name="l00597"></a>00597 
<a name="l00598"></a>00598       <span class="keywordtype">double</span> avg_time = tmp(0) / <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l00599"></a>00599       <span class="keywordtype">double</span> avg_nb = tmp(1) / <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l00600"></a>00600       <span class="keywordtype">double</span> avg_quantity = tmp(2) / <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l00601"></a>00601       <span class="keywordtype">double</span> avg_avg_time_ps = tmp(3) / <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l00602"></a>00602       <span class="keywordtype">double</span> avg_var_time_ps = tmp(4)/ <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l00603"></a>00603 
<a name="l00604"></a>00604       <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l00605"></a>00605         {
<a name="l00606"></a>00606 
<a name="l00607"></a>00607           <span class="keywordtype">double</span> percent_time = (temps_total_max==0 ? 0 : avg_time / temps_total_max * 100.);
<a name="l00608"></a>00608 
<a name="l00609"></a>00609           <span class="keywordtype">char</span> s1[50], s2[50], s3[50];
<a name="l00610"></a>00610           s1[0] = s2[0] = s3[0] = 0;
<a name="l00611"></a>00611           <span class="keywordflow">if</span> (min_time != max_time)
<a name="l00612"></a>00612             sprintf(s1, <span class="stringliteral">&quot;(%0.2f,%0.2f)&quot;</span>, min_time, max_time);
<a name="l00613"></a>00613           <span class="keywordflow">if</span> (min_nb != max_nb)
<a name="l00614"></a>00614             sprintf(s2, <span class="stringliteral">&quot;(%0.3g,%0.3g)&quot;</span>, min_nb, max_nb);
<a name="l00615"></a>00615           <span class="keywordflow">if</span> (min_quantity != max_quantity)
<a name="l00616"></a>00616             sprintf(s3, <span class="stringliteral">&quot;(%0.3g,%0.3g)&quot;</span>, min_quantity, max_quantity);
<a name="l00617"></a>00617 
<a name="l00618"></a>00618           sprintf(tampon,
<a name="l00619"></a>00619                   <span class="stringliteral">&quot;%55s (%02d) %10.2f  %5.1f%% %-23s %10.3g %-23s %10.3g %-23s %10.2f (%0.3f)&quot;</span>,
<a name="l00620"></a>00620                   description, (<a class="code" href="arch_8h.html#a1caaf369d9c5f0817dbaa76b43b8d87b">True_int</a>)level,
<a name="l00621"></a>00621                   avg_time, percent_time, s1,
<a name="l00622"></a>00622                   avg_nb, s2,
<a name="l00623"></a>00623                   avg_quantity, s3,
<a name="l00624"></a>00624                   avg_avg_time_ps, avg_var_time_ps);
<a name="l00625"></a>00625 
<a name="l00626"></a>00626           perfs_globales &lt;&lt; tampon &lt;&lt; finl;
<a name="l00627"></a>00627         }
<a name="l00628"></a>00628     }
<a name="l00629"></a>00629 }
<a name="l00630"></a>00630 
<a name="l00631"></a><a class="code" href="classStatistiques.html#a53b4c3f5e2690ed40586dc62e086c5a8">00631</a> <span class="keywordtype">void</span> <a class="code" href="classStatistiques.html#a53b4c3f5e2690ed40586dc62e086c5a8">Statistiques::dump</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="Reordonner__faces__periodiques_8cpp.html#a137d78a01e63d3b66d1b2ed0de0f4c4c">message</a>, <span class="keywordtype">int</span> mode_append)
<a name="l00632"></a>00632 {
<a name="l00633"></a>00633   assert(message); <span class="comment">//!&lt; message non nul !</span>
<a name="l00634"></a>00634 <span class="comment"></span>
<a name="l00635"></a>00635   <a class="code" href="classStat__Internals.html">Stat_Internals</a>&amp; si = *<a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a>;
<a name="l00636"></a>00636 
<a name="l00637"></a>00637   <span class="keywordtype">char</span> tampon[<a class="code" href="Statistiques_8cpp.html#ad974fe981249f5e84fbf1683b012c9f8">BUFLEN</a>+150];
<a name="l00638"></a>00638 
<a name="l00639"></a>00639   <a class="code" href="classStatistiques.html#a854ef63a0b657c147bb625bce97e4f4f">stop_counters</a>();
<a name="l00640"></a>00640 
<a name="l00641"></a>00641   <a class="code" href="classSChaine.html" title="Cette classe derivee de Sortie empile ce qu&#39;on lui envoie dans une chaine de caracteres. On recupere le contenu de la chaine avec get_str().">SChaine</a> perfs;
<a name="l00642"></a>00642   <a class="code" href="classSChaine.html" title="Cette classe derivee de Sortie empile ce qu&#39;on lui envoie dans une chaine de caracteres. On recupere le contenu de la chaine avec get_str().">SChaine</a> perfs_globales;
<a name="l00643"></a>00643   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>() &gt; 1)
<a name="l00644"></a>00644     {
<a name="l00645"></a>00645       perfs.<a class="code" href="classSortie.html#a846ea173fd5e5b18fa2a0764f39724e3">precision</a>(3);
<a name="l00646"></a>00646       perfs &lt;&lt; <span class="stringliteral">&quot;Statistics execution [PE &quot;</span> &lt;&lt; <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>() &lt;&lt; <span class="stringliteral">&quot;] : &quot;</span> &lt;&lt; message &lt;&lt; finl;
<a name="l00647"></a>00647       perfs &lt;&lt; <span class="stringliteral">&quot; the time was measured by the following method :&quot;</span> &lt;&lt; finl;
<a name="l00648"></a>00648       perfs &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; Time::description &lt;&lt; finl;
<a name="l00649"></a>00649 
<a name="l00650"></a>00650 
<a name="l00651"></a>00651       sprintf(tampon, <span class="stringliteral">&quot;%60s %10s         %10s %10s  %-23s %10s &quot;</span>,
<a name="l00652"></a>00652               <span class="stringliteral">&quot;Counter (level)&quot;</span>, <span class="stringliteral">&quot;time(s)&quot;</span>, <span class="stringliteral">&quot;count&quot;</span>, <span class="stringliteral">&quot;quantity&quot;</span>, <span class="stringliteral">&quot;avg time per step&quot;</span>, <span class="stringliteral">&quot;(min,max,std dev)&quot;</span> );
<a name="l00653"></a>00653       perfs &lt;&lt; tampon &lt;&lt; finl;
<a name="l00654"></a>00654     }
<a name="l00655"></a>00655 
<a name="l00656"></a>00656   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l00657"></a>00657     {
<a name="l00658"></a>00658       sprintf(tampon,
<a name="l00659"></a>00659               <span class="stringliteral">&quot;%60s %10s         %-23s %10s %-23s %10s %-23s %10s %-23s&quot;</span>,
<a name="l00660"></a>00660               <span class="stringliteral">&quot;Counter (level)&quot;</span>,
<a name="l00661"></a>00661               <span class="stringliteral">&quot;avg time&quot;</span>, <span class="stringliteral">&quot;(min,max)&quot;</span>,
<a name="l00662"></a>00662               <span class="stringliteral">&quot;avg count&quot;</span>, <span class="stringliteral">&quot;(min,max)&quot;</span>,
<a name="l00663"></a>00663               <span class="stringliteral">&quot;avg qty&quot;</span>, <span class="stringliteral">&quot;(min,max)&quot;</span>,
<a name="l00664"></a>00664               <span class="stringliteral">&quot;avg time per step&quot;</span>, <span class="stringliteral">&quot;(std dev)&quot;</span>);
<a name="l00665"></a>00665       perfs_globales &lt;&lt; <span class="stringliteral">&quot;Statistics overall execution : &quot;</span> &lt;&lt; message &lt;&lt; finl;
<a name="l00666"></a>00666       perfs_globales &lt;&lt; <span class="stringliteral">&quot; the time was measured by the following method :&quot;</span> &lt;&lt; finl;
<a name="l00667"></a>00667       perfs_globales &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; Time::description &lt;&lt; finl;
<a name="l00668"></a>00668       perfs_globales &lt;&lt; tampon &lt;&lt; finl;
<a name="l00669"></a>00669     }
<a name="l00670"></a>00670 
<a name="l00671"></a>00671 <span class="comment">// Verification : on a le meme nombre de compteurs sur tous les procs ?</span>
<a name="l00672"></a>00672   <span class="keywordtype">int</span> skip_globals = 0;
<a name="l00673"></a>00673   {
<a name="l00674"></a>00674     <span class="keywordtype">int</span> min_nb = (int) <a class="code" href="classProcess.html#a05de57db7288d95f9e67046af585d5ff" title="Calcule le min de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_min</a>(si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>);
<a name="l00675"></a>00675     <span class="keywordtype">int</span> max_nb = (int) <a class="code" href="classProcess.html#a1e9d9f9899b71927cfafae14c7bd048d" title="Calcule le max de x sur tous les processeurs du groupe courant. Remarques : Cette methode doit etre a...">Process::mp_max</a>(si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>);
<a name="l00676"></a>00676     <span class="keywordflow">if</span> (min_nb != max_nb)
<a name="l00677"></a>00677       {
<a name="l00678"></a>00678         <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l00679"></a>00679           {
<a name="l00680"></a>00680             perfs_globales &lt;&lt; <span class="stringliteral">&quot;Unable to collect statistics :&quot;</span> &lt;&lt; finl
<a name="l00681"></a>00681                            &lt;&lt; <span class="stringliteral">&quot; there is not the same number of counters on all&quot;</span>
<a name="l00682"></a>00682                            <span class="stringliteral">&quot; processors.&quot;</span>;
<a name="l00683"></a>00683           }
<a name="l00684"></a>00684         skip_globals = 1;
<a name="l00685"></a>00685       }
<a name="l00686"></a>00686   }
<a name="l00687"></a>00687 
<a name="l00688"></a>00688 <span class="comment">// Temps de reference pour les pourcentages</span>
<a name="l00689"></a>00689   <span class="keywordtype">double</span> temps_total_max = 0.;
<a name="l00690"></a>00690 
<a name="l00691"></a>00691 <span class="comment">// Compute Divers (time not counted by other counters in time step loop):</span>
<a name="l00692"></a>00692   <span class="keywordflow">if</span> (si.<a class="code" href="classStat__Internals.html#a3bc661477a7486ba0f19fc734624f367">counter_nb</a>[2]&gt;0)
<a name="l00693"></a>00693     {
<a name="l00694"></a>00694       <span class="keywordflow">if</span> (strcmp(si.<a class="code" href="classStat__Internals.html#a15f28ff82cee405d14d517fe6bdb6c16">description</a>[2],<span class="stringliteral">&quot;Resoudre (timestep loop)&quot;</span>))
<a name="l00695"></a>00695         {
<a name="l00696"></a>00696           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Statistiques::dump(...)&quot;</span> &lt;&lt; finl;
<a name="l00697"></a>00697           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00698"></a>00698         }
<a name="l00699"></a>00699       <span class="keywordtype">int</span> <span class="keywordtype">id</span>=-1;
<a name="l00700"></a>00700 <span class="comment">// Look for counter Divers</span>
<a name="l00701"></a>00701       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>; i++)
<a name="l00702"></a>00702         <span class="keywordflow">if</span> (!strcmp(si.<a class="code" href="classStat__Internals.html#a15f28ff82cee405d14d517fe6bdb6c16">description</a>[i],<span class="stringliteral">&quot;Divers&quot;</span>))
<a name="l00703"></a>00703           <span class="keywordtype">id</span>=i;
<a name="l00704"></a>00704 <span class="comment">// Compute CPU Divers = counter(time step) - sum(other counters))</span>
<a name="l00705"></a>00705       si.<a class="code" href="classStat__Internals.html#a68c81952102b4c67885978e0f59c8907">counter_time</a>[id].<a class="code" href="classTime.html#a677b65673911937f2e9fa5e4c7c40f7c">add</a>(si.<a class="code" href="classStat__Internals.html#a68c81952102b4c67885978e0f59c8907">counter_time</a>[2]);
<a name="l00706"></a>00706       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 3; i &lt; si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>; i++)
<a name="l00707"></a>00707         {
<a name="l00708"></a>00708           <span class="keywordflow">if</span> (i!=<span class="keywordtype">id</span> &amp;&amp; si.<a class="code" href="classStat__Internals.html#a76a6ba07d3b416de75d3bd62bbb9126f">counter_level</a>[i]==1)
<a name="l00709"></a>00709             si.<a class="code" href="classStat__Internals.html#a68c81952102b4c67885978e0f59c8907">counter_time</a>[id].<a class="code" href="classTime.html#ac5827b15a105d9eece4a7f6e13190da3">minus</a>(si.<a class="code" href="classStat__Internals.html#a68c81952102b4c67885978e0f59c8907">counter_time</a>[i]);
<a name="l00710"></a>00710         }
<a name="l00711"></a>00711     }
<a name="l00712"></a>00712 
<a name="l00713"></a>00713 <span class="comment">// Affichage des compteurs individuels</span>
<a name="l00714"></a>00714   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>; i++)
<a name="l00715"></a>00715     {
<a name="l00716"></a>00716       <span class="keywordtype">char</span> description[<a class="code" href="Statistiques_8cpp.html#ad974fe981249f5e84fbf1683b012c9f8">BUFLEN</a>];
<a name="l00717"></a>00717 
<a name="l00718"></a>00718       <span class="keywordflow">if</span> (si.<a class="code" href="classStat__Internals.html#a649b539b90556341cb019ec95c0b5bbf">family</a>[i])
<a name="l00719"></a>00719         sprintf(description, <span class="stringliteral">&quot;%s:%s&quot;</span>, si.<a class="code" href="classStat__Internals.html#a649b539b90556341cb019ec95c0b5bbf">family</a>[i], si.<a class="code" href="classStat__Internals.html#a15f28ff82cee405d14d517fe6bdb6c16">description</a>[i]);
<a name="l00720"></a>00720       <span class="keywordflow">else</span>
<a name="l00721"></a>00721         sprintf(description, <span class="stringliteral">&quot;%s&quot;</span>, si.<a class="code" href="classStat__Internals.html#a15f28ff82cee405d14d517fe6bdb6c16">description</a>[i]);
<a name="l00722"></a>00722 
<a name="l00723"></a>00723       <span class="keywordtype">double</span> time;
<a name="l00724"></a>00724       <span class="keywordtype">double</span> nb;
<a name="l00725"></a>00725       <span class="keywordtype">double</span> quantity;
<a name="l00726"></a>00726 
<a name="l00727"></a>00727 <span class="comment">// si l&#39;option GET_COMM_DETAILS est activee, les infos des compteurs de communication dans les stat_internals ne sont plus a jour</span>
<a name="l00728"></a>00728 <span class="comment">// elles sont neanmoins stockees dans le tableau communication_tracking_times</span>
<a name="l00729"></a>00729       <span class="keywordflow">if</span>(<a class="code" href="Statistiques_8h.html#a7f6c434cd21697d3bafbdc2433f06c37">GET_COMM_DETAILS</a> &amp;&amp; si.<a class="code" href="classStat__Internals.html#acf9be2a71aadb932ce038def496aa0f4">counter_comm</a>[i] &amp;&amp; si.<a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">communication_tracking_info</a> )
<a name="l00730"></a>00730         {
<a name="l00731"></a>00731 <span class="comment">// correspondance entre l&#39;identifiant du compteur de communication et son indice dans le tableau communication_tracking_times</span>
<a name="l00732"></a>00732           <span class="keywordtype">int</span> index =  si.<a class="code" href="classStat__Internals.html#a99685fe38179ce69ca479aea547eaee8">index_in_communication_tracking_info</a>[i];
<a name="l00733"></a>00733           time = si.<a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">communication_tracking_info</a>[index][0].<a class="code" href="classStat__Results.html#a9ac46c2ac7225154b6893ac453e214ef">time</a>;
<a name="l00734"></a>00734           nb = si.<a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">communication_tracking_info</a>[index][0].<a class="code" href="classStat__Results.html#a616f30fa3456aa88ed6b4c3f07c3f3d9">count</a>;
<a name="l00735"></a>00735           quantity = si.<a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">communication_tracking_info</a>[index][0].<a class="code" href="classStat__Results.html#affd1c9ac470125e25e499ca637e94f94">quantity</a>;
<a name="l00736"></a>00736         }
<a name="l00737"></a>00737       <span class="keywordflow">else</span>
<a name="l00738"></a>00738         {
<a name="l00739"></a>00739           time = si.<a class="code" href="classStat__Internals.html#a68c81952102b4c67885978e0f59c8907">counter_time</a>[i].<a class="code" href="classTime.html#af7938b9dc8519ac4d914182968ffbd78">second</a>();
<a name="l00740"></a>00740           nb = si.<a class="code" href="classStat__Internals.html#a3bc661477a7486ba0f19fc734624f367">counter_nb</a>[i];
<a name="l00741"></a>00741           quantity = si.<a class="code" href="classStat__Internals.html#a6c82f740705153b26cc9e983545273ad">counter_quantity</a>[i];
<a name="l00742"></a>00742         }
<a name="l00743"></a>00743 
<a name="l00744"></a>00744       <span class="keywordtype">int</span> level = si.<a class="code" href="classStat__Internals.html#a76a6ba07d3b416de75d3bd62bbb9126f">counter_level</a>[i];
<a name="l00745"></a>00745       <span class="keywordtype">double</span> avg_time_per_step = si.<a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][1];
<a name="l00746"></a>00746       <span class="keywordtype">double</span> min_time_per_step = si.<a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][2];
<a name="l00747"></a>00747       <span class="keywordtype">double</span> max_time_per_step = si.<a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][3];
<a name="l00748"></a>00748       <span class="keywordtype">double</span> var_time_per_step = si.<a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][4];
<a name="l00749"></a>00749 
<a name="l00750"></a>00750       <span class="keywordflow">if</span> (i == 0)
<a name="l00751"></a>00751         {
<a name="l00752"></a>00752           temps_total_max = time;
<a name="l00753"></a>00753           <a class="code" href="classStatistiques.html#aedc55c74ea44d73052ef59db108b45ed">total_time_</a>+=time;     <span class="comment">//!&lt; Update total_time_</span>
<a name="l00754"></a>00754 <span class="comment"></span>        }
<a name="l00755"></a>00755 
<a name="l00756"></a>00756       <span class="keywordflow">if</span>( <a class="code" href="Statistiques_8h.html#a1bcfabda5482a837da0f52c13f997a92">JUMP_3_FIRST_STEPS</a> &amp;&amp; i == 2 )
<a name="l00757"></a>00757         temps_total_max = time;
<a name="l00758"></a>00758 
<a name="l00759"></a>00759       assert(var_time_per_step &gt;= 0.);
<a name="l00760"></a>00760       <a class="code" href="Statistiques_8cpp.html#a94cee1daf927202c49f853aadf1c06c2">print_stat</a>(perfs,perfs_globales,description,
<a name="l00761"></a>00761                  level,time,nb,quantity,temps_total_max, skip_globals,
<a name="l00762"></a>00762                  avg_time_per_step, min_time_per_step, max_time_per_step, sqrt(var_time_per_step));
<a name="l00763"></a>00763 
<a name="l00764"></a>00764     }
<a name="l00765"></a>00765 
<a name="l00766"></a>00766 <span class="comment">// Affichage par famille de compteur</span>
<a name="l00767"></a>00767   <span class="keywordtype">int</span> * drapeaux = <span class="keyword">new</span> <span class="keywordtype">int</span>[si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>];
<a name="l00768"></a>00768   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>; i++)
<a name="l00769"></a>00769     drapeaux[i] = 0;
<a name="l00770"></a>00770   <span class="keywordtype">int</span> <a class="code" href="Zone__VEF__PreP1b_8cpp.html#a24a462bbedad66c2a21f5f6f84b8ec5b">next</a> = 0;
<a name="l00771"></a>00771 
<a name="l00772"></a>00772 <span class="comment">// Next designe le premier compteur d&#39;une famille en cours</span>
<a name="l00773"></a>00773   <span class="keywordflow">while</span> (next &lt; si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>)
<a name="l00774"></a>00774     {
<a name="l00775"></a>00775       <span class="keywordtype">int</span> level = 0;
<a name="l00776"></a>00776       <span class="keywordtype">double</span> time = 0.;
<a name="l00777"></a>00777       <span class="keywordtype">double</span> nb = 0.;
<a name="l00778"></a>00778       <span class="keywordtype">double</span> quantity = 0.;
<a name="l00779"></a>00779       <span class="keywordtype">double</span> avg_time_per_step = 0.;
<a name="l00780"></a>00780       <span class="keywordtype">double</span> min_time_per_step = 0.;
<a name="l00781"></a>00781       <span class="keywordtype">double</span> max_time_per_step = 0.;
<a name="l00782"></a>00782       <span class="keywordtype">double</span> var_time_per_step = 0.;
<a name="l00783"></a>00783 
<a name="l00784"></a>00784 
<a name="l00785"></a>00785 <span class="comment">// Trouve le premier compteur de la famille suivante</span>
<a name="l00786"></a>00786 <span class="comment">// (famille non nulle et pas encore traitee)</span>
<a name="l00787"></a>00787       <span class="keywordflow">while</span> (next &lt; si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>
<a name="l00788"></a>00788              &amp;&amp; (si.<a class="code" href="classStat__Internals.html#a649b539b90556341cb019ec95c0b5bbf">family</a>[next] == 0 || drapeaux[next] != 0))
<a name="l00789"></a>00789         next++;
<a name="l00790"></a>00790       <span class="keywordflow">if</span> (next &gt;= si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>)
<a name="l00791"></a>00791         <span class="keywordflow">break</span>;
<a name="l00792"></a>00792 
<a name="l00793"></a>00793 
<a name="l00794"></a>00794 <span class="comment">// Somme des valeurs des compteurs de cette famille</span>
<a name="l00795"></a>00795       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = next; i &lt; si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>; i++)
<a name="l00796"></a>00796         {
<a name="l00797"></a>00797           <span class="keywordflow">if</span> (si.<a class="code" href="classStat__Internals.html#a649b539b90556341cb019ec95c0b5bbf">family</a>[i] != 0)
<a name="l00798"></a>00798             {
<a name="l00799"></a>00799               <span class="keywordflow">if</span> (strcmp(si.<a class="code" href="classStat__Internals.html#a649b539b90556341cb019ec95c0b5bbf">family</a>[i], si.<a class="code" href="classStat__Internals.html#a649b539b90556341cb019ec95c0b5bbf">family</a>[next]) == 0)
<a name="l00800"></a>00800                 {
<a name="l00801"></a>00801 <span class="comment">// OK, on veut compter celui-la</span>
<a name="l00802"></a>00802                   drapeaux[i] = 1;
<a name="l00803"></a>00803 
<a name="l00804"></a>00804 <span class="comment">// si l&#39;option GET_COMM_DETAILS est activee, les infos des compteurs de communication dans les stat_internals ne sont plus a jour</span>
<a name="l00805"></a>00805 <span class="comment">// elles sont neanmoins stockees dans le tableau communication_tracking_times</span>
<a name="l00806"></a>00806                   <span class="keywordflow">if</span>(<a class="code" href="Statistiques_8h.html#a7f6c434cd21697d3bafbdc2433f06c37">GET_COMM_DETAILS</a> &amp;&amp; si.<a class="code" href="classStat__Internals.html#acf9be2a71aadb932ce038def496aa0f4">counter_comm</a>[i] &amp;&amp; si.<a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">communication_tracking_info</a> )
<a name="l00807"></a>00807                     {
<a name="l00808"></a>00808 <span class="comment">// correspondance entre l&#39;identifiant du compteur de communication et son indice dans le tableau communication_tracking_times</span>
<a name="l00809"></a>00809                       <span class="keywordtype">int</span> index = si.<a class="code" href="classStat__Internals.html#a99685fe38179ce69ca479aea547eaee8">index_in_communication_tracking_info</a>[i];
<a name="l00810"></a>00810                       time += si.<a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">communication_tracking_info</a>[index][0].<a class="code" href="classStat__Results.html#a9ac46c2ac7225154b6893ac453e214ef">time</a>;
<a name="l00811"></a>00811                       nb   += si.<a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">communication_tracking_info</a>[index][0].<a class="code" href="classStat__Results.html#a616f30fa3456aa88ed6b4c3f07c3f3d9">count</a>;
<a name="l00812"></a>00812                       quantity += si.<a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">communication_tracking_info</a>[index][0].<a class="code" href="classStat__Results.html#affd1c9ac470125e25e499ca637e94f94">quantity</a>;
<a name="l00813"></a>00813 
<a name="l00814"></a>00814                     }
<a name="l00815"></a>00815                   <span class="keywordflow">else</span>
<a name="l00816"></a>00816                     {
<a name="l00817"></a>00817                       time += si.<a class="code" href="classStat__Internals.html#a68c81952102b4c67885978e0f59c8907">counter_time</a>[i].<a class="code" href="classTime.html#af7938b9dc8519ac4d914182968ffbd78">second</a>();
<a name="l00818"></a>00818                       nb += si.<a class="code" href="classStat__Internals.html#a3bc661477a7486ba0f19fc734624f367">counter_nb</a>[i];
<a name="l00819"></a>00819                       quantity += si.<a class="code" href="classStat__Internals.html#a6c82f740705153b26cc9e983545273ad">counter_quantity</a>[i];
<a name="l00820"></a>00820                     }
<a name="l00821"></a>00821 
<a name="l00822"></a>00822                   avg_time_per_step += si.<a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][1];
<a name="l00823"></a>00823                   var_time_per_step += si.<a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][4];
<a name="l00824"></a>00824 
<a name="l00825"></a>00825                 }
<a name="l00826"></a>00826             }
<a name="l00827"></a>00827         }
<a name="l00828"></a>00828 
<a name="l00829"></a>00829 
<a name="l00830"></a>00830       <span class="keyword">const</span> <span class="keywordtype">char</span> * description = si.<a class="code" href="classStat__Internals.html#a649b539b90556341cb019ec95c0b5bbf">family</a>[<a class="code" href="Zone__VEF__PreP1b_8cpp.html#a24a462bbedad66c2a21f5f6f84b8ec5b">next</a>];
<a name="l00831"></a>00831 
<a name="l00832"></a>00832       assert(var_time_per_step &gt;= 0.);
<a name="l00833"></a>00833       <a class="code" href="Statistiques_8cpp.html#a94cee1daf927202c49f853aadf1c06c2">print_stat</a>(perfs,perfs_globales,description,
<a name="l00834"></a>00834                  level,time,nb,quantity,temps_total_max, skip_globals,
<a name="l00835"></a>00835                  avg_time_per_step, min_time_per_step, max_time_per_step, sqrt(var_time_per_step));
<a name="l00836"></a>00836 
<a name="l00837"></a>00837       next++;
<a name="l00838"></a>00838     }
<a name="l00839"></a>00839   <span class="keyword">delete</span>[] drapeaux;
<a name="l00840"></a>00840 
<a name="l00841"></a>00841   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>() &gt; 1)
<a name="l00842"></a>00842     perfs &lt;&lt; finl;
<a name="l00843"></a>00843 
<a name="l00844"></a>00844   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l00845"></a>00845     perfs_globales &lt;&lt; finl;
<a name="l00846"></a>00846 
<a name="l00847"></a>00847 <span class="comment">// Les fichiers sont ouverts en mode append.</span>
<a name="l00848"></a>00848   {
<a name="l00849"></a>00849     <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> TU(<a class="code" href="classObjet__U.html#a7c27c4f80259eeef76ff8fe2d3bc61f7" title="Renvoie une reference constante vers le nom du cas. Cette methode est statique.">Objet_U::nom_du_cas</a>());
<a name="l00850"></a>00850     TU+=<span class="stringliteral">&quot;_detail.TU&quot;</span>;
<a name="l00851"></a>00851     <a class="code" href="classEcrFicPartage.html">EcrFicPartage</a> file(TU, mode_append ? (ios::out | ios::app) : (ios::out));
<a name="l00852"></a>00852     <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l00853"></a>00853       file &lt;&lt; perfs_globales.<a class="code" href="classSChaine.html#a8ed820eca8d79e52fb50520d02637315" title="returns a copy of the string stored by the SChaine">get_str</a>();
<a name="l00854"></a>00854     file &lt;&lt; perfs.<a class="code" href="classSChaine.html#a8ed820eca8d79e52fb50520d02637315" title="returns a copy of the string stored by the SChaine">get_str</a>();
<a name="l00855"></a>00855     file.<a class="code" href="classEcrFicPartage.html#a76131150f8293c86eb36f4b45125183d" title="Provoque l&#39;ecriture sur disque des donnees accumulees sur les differents processeurs depuis le dernie...">syncfile</a>();
<a name="l00856"></a>00856   }
<a name="l00857"></a>00857 
<a name="l00858"></a>00858 
<a name="l00859"></a>00859   <a class="code" href="classStatistiques.html#a9c05facd54b457e522edda7a77273e35">restart_counters</a>();
<a name="l00860"></a>00860 }
<a name="l00861"></a>00861 
<a name="l00862"></a><a class="code" href="classStatistiques.html#ae51f47e953e4e439d0929e2f0283bdef">00862</a> <span class="keywordtype">void</span> <a class="code" href="classStatistiques.html#ae51f47e953e4e439d0929e2f0283bdef">Statistiques::reset_counters</a>()
<a name="l00863"></a>00863 {
<a name="l00864"></a>00864   <a class="code" href="classStat__Internals.html">Stat_Internals</a>&amp; si = *<a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a>;
<a name="l00865"></a>00865   <a class="code" href="classTime.html">Time</a> time_zero;
<a name="l00866"></a>00866   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="Statistiques_8cpp.html#a93034cb14514e99e0fec6470b1f17e25">MAXCOUNTERS</a>; i++)
<a name="l00867"></a>00867     {
<a name="l00868"></a>00868       si.<a class="code" href="classStat__Internals.html#a2ca40b1fd6a5056bfeb7361c2021edb4">time_begin</a>[i] = time_zero;
<a name="l00869"></a>00869       si.<a class="code" href="classStat__Internals.html#a68c81952102b4c67885978e0f59c8907">counter_time</a>[i] = time_zero;
<a name="l00870"></a>00870       si.<a class="code" href="classStat__Internals.html#a9d4c13e1656b0cb65271d1c67f4a4272">counter_running</a>[i] = 0;
<a name="l00871"></a>00871       si.<a class="code" href="classStat__Internals.html#a3bc661477a7486ba0f19fc734624f367">counter_nb</a>[i] = 0;
<a name="l00872"></a>00872       si.<a class="code" href="classStat__Internals.html#a6c82f740705153b26cc9e983545273ad">counter_quantity</a>[i] = 0;
<a name="l00873"></a>00873 
<a name="l00874"></a>00874       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; 5; j++)
<a name="l00875"></a>00875         {
<a name="l00876"></a>00876           si.<a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][j] = j==2 ? INITIAL_MIN : 0.0;   <span class="comment">//l&#39;indice 2 correspond au min courant</span>
<a name="l00877"></a>00877         }
<a name="l00878"></a>00878     }
<a name="l00879"></a>00879 
<a name="l00880"></a>00880   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; si.<a class="code" href="classStat__Internals.html#adca4555b4db6aa4030205a554fb8e8c4">nb_comm_counters</a>; i++)
<a name="l00881"></a>00881     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="Statistiques_8cpp.html#a93034cb14514e99e0fec6470b1f17e25">MAXCOUNTERS</a>; j++)
<a name="l00882"></a>00882       si.<a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">communication_tracking_info</a>[i][j].<a class="code" href="classStat__Results.html#adf1894eaee9742004680be08cb5470de">reset</a>();
<a name="l00883"></a>00883 
<a name="l00884"></a>00884 }
<a name="l00885"></a>00885 
<a name="l00886"></a><a class="code" href="classStatistiques.html#a9dcac2b83caee9e5f27c55134f000efc">00886</a> <span class="keywordtype">void</span> <a class="code" href="classStatistiques.html#a9dcac2b83caee9e5f27c55134f000efc">Statistiques::reset_counter</a>(<span class="keywordtype">int</span> counter_id)
<a name="l00887"></a>00887 {
<a name="l00888"></a>00888   <a class="code" href="classStat__Internals.html">Stat_Internals</a>&amp; si = *<a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a>;
<a name="l00889"></a>00889   <a class="code" href="classTime.html">Time</a> time_zero;
<a name="l00890"></a>00890 
<a name="l00891"></a>00891   si.<a class="code" href="classStat__Internals.html#a2ca40b1fd6a5056bfeb7361c2021edb4">time_begin</a>[counter_id] = time_zero;
<a name="l00892"></a>00892   si.<a class="code" href="classStat__Internals.html#a68c81952102b4c67885978e0f59c8907">counter_time</a>[counter_id] = time_zero;
<a name="l00893"></a>00893   si.<a class="code" href="classStat__Internals.html#a9d4c13e1656b0cb65271d1c67f4a4272">counter_running</a>[counter_id] = 0;
<a name="l00894"></a>00894 
<a name="l00895"></a>00895   si.<a class="code" href="classStat__Internals.html#a3bc661477a7486ba0f19fc734624f367">counter_nb</a>[counter_id] = 0;
<a name="l00896"></a>00896   si.<a class="code" href="classStat__Internals.html#a6c82f740705153b26cc9e983545273ad">counter_quantity</a>[counter_id] = 0;
<a name="l00897"></a>00897 
<a name="l00898"></a>00898 }
<a name="l00899"></a>00899 
<a name="l00900"></a>00900 
<a name="l00901"></a><a class="code" href="classStatistiques.html#a854ef63a0b657c147bb625bce97e4f4f">00901</a> <span class="keywordtype">void</span> <a class="code" href="classStatistiques.html#a854ef63a0b657c147bb625bce97e4f4f">Statistiques::stop_counters</a>()
<a name="l00902"></a>00902 {
<a name="l00903"></a>00903   <a class="code" href="classStat__Internals.html">Stat_Internals</a>&amp; si = *<a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a>;
<a name="l00904"></a>00904   assert(si.<a class="code" href="classStat__Internals.html#a7d90f34d561db121dca4b9b052416fb2">change_level_forbidden</a> == 0);
<a name="l00905"></a>00905 <span class="comment">// Bloquer tous les compteurs pendant le dump (on fait appel a des communications)</span>
<a name="l00906"></a>00906   si.<a class="code" href="classStat__Internals.html#a7d90f34d561db121dca4b9b052416fb2">change_level_forbidden</a> = 1;
<a name="l00907"></a>00907   si.<a class="code" href="classStat__Internals.html#aa95673996dcc78027c70296f5b328333">debug_level_before</a> = <a class="code" href="classStatistiques.html#a9cb454c21eb3395788b2bf386c103acb">debug_level_</a>;
<a name="l00908"></a>00908   <a class="code" href="classStatistiques.html#a9cb454c21eb3395788b2bf386c103acb">debug_level_</a> = 0;
<a name="l00909"></a>00909   <span class="keywordtype">int</span> i;
<a name="l00910"></a>00910 <span class="comment">// Arret de tous les compteurs</span>
<a name="l00911"></a>00911   <span class="keywordflow">for</span> (i = 0; i &lt; si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>; i++)
<a name="l00912"></a>00912     <span class="keywordflow">if</span> (si.<a class="code" href="classStat__Internals.html#a9d4c13e1656b0cb65271d1c67f4a4272">counter_running</a>[i])
<a name="l00913"></a>00913       <a class="code" href="classStatistiques.html#a068333577be7c53eeb27d2f067ed6b36">end_count_</a>(i, 0, 0);
<a name="l00914"></a>00914 }
<a name="l00915"></a>00915 
<a name="l00916"></a><a class="code" href="classStatistiques.html#a9c05facd54b457e522edda7a77273e35">00916</a> <span class="keywordtype">void</span> <a class="code" href="classStatistiques.html#a9c05facd54b457e522edda7a77273e35">Statistiques::restart_counters</a>()
<a name="l00917"></a>00917 {
<a name="l00918"></a>00918   <a class="code" href="classStat__Internals.html">Stat_Internals</a>&amp; si = *<a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a>;
<a name="l00919"></a>00919   assert(si.<a class="code" href="classStat__Internals.html#a7d90f34d561db121dca4b9b052416fb2">change_level_forbidden</a> == 1);
<a name="l00920"></a>00920 <span class="comment">// Reactiver les compteurs</span>
<a name="l00921"></a>00921   <a class="code" href="classStatistiques.html#a9cb454c21eb3395788b2bf386c103acb">debug_level_</a> = si.<a class="code" href="classStat__Internals.html#aa95673996dcc78027c70296f5b328333">debug_level_before</a>;
<a name="l00922"></a>00922   si.<a class="code" href="classStat__Internals.html#a7d90f34d561db121dca4b9b052416fb2">change_level_forbidden</a> = 0;
<a name="l00923"></a>00923 }
<a name="l00924"></a>00924 
<a name="l00925"></a>00925 
<a name="l00926"></a>00926 
<a name="l00927"></a><a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">00927</a> <span class="keywordtype">void</span> <a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">Statistiques::get_stats</a>(<span class="keyword">const</span> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a>&amp; counter_id,
<a name="l00928"></a>00928                              <a class="code" href="classStat__Results.html">Stat_Results</a>&amp; result)
<a name="l00929"></a>00929 {
<a name="l00930"></a>00930   <a class="code" href="classStat__Internals.html">Stat_Internals</a>&amp; si = *<a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a>;
<a name="l00931"></a>00931   <span class="keywordtype">int</span> <span class="keywordtype">id</span> = counter_id.<a class="code" href="classStat__Counter__Id.html#a33db57ea355a4567d6677d71bde15901">id_</a>;
<a name="l00932"></a>00932   assert(<span class="keywordtype">id</span> &lt; si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>);
<a name="l00933"></a>00933   result.<a class="code" href="classStat__Results.html#a9ac46c2ac7225154b6893ac453e214ef">time</a> = si.<a class="code" href="classStat__Internals.html#a68c81952102b4c67885978e0f59c8907">counter_time</a>[id].<a class="code" href="classTime.html#af7938b9dc8519ac4d914182968ffbd78">second</a>();
<a name="l00934"></a>00934   result.<a class="code" href="classStat__Results.html#a616f30fa3456aa88ed6b4c3f07c3f3d9">count</a> = si.<a class="code" href="classStat__Internals.html#a3bc661477a7486ba0f19fc734624f367">counter_nb</a>[id];
<a name="l00935"></a>00935   result.<a class="code" href="classStat__Results.html#affd1c9ac470125e25e499ca637e94f94">quantity</a> = si.<a class="code" href="classStat__Internals.html#a6c82f740705153b26cc9e983545273ad">counter_quantity</a>[id];
<a name="l00936"></a>00936   result.<a class="code" href="classStat__Results.html#a3a05bd3af5a7f6eac5d08c7cd4cdf3e8">compute_min_max_avg</a>();
<a name="l00937"></a>00937 }
<a name="l00938"></a>00938 
<a name="l00939"></a><a class="code" href="classStatistiques.html#a7f24347674a21d35dfe89f9bb1159455">00939</a> <span class="keywordtype">void</span> <a class="code" href="classStatistiques.html#a7f24347674a21d35dfe89f9bb1159455">Statistiques::get_stats_familly</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * familly, <a class="code" href="classStat__Results.html">Stat_Results</a>&amp; result)
<a name="l00940"></a>00940 {
<a name="l00941"></a>00941   assert(familly);
<a name="l00942"></a>00942   <a class="code" href="classStat__Internals.html">Stat_Internals</a>&amp; si = *<a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a>;
<a name="l00943"></a>00943   result.<a class="code" href="classStat__Results.html#a9ac46c2ac7225154b6893ac453e214ef">time</a> = 0.;
<a name="l00944"></a>00944   result.<a class="code" href="classStat__Results.html#a616f30fa3456aa88ed6b4c3f07c3f3d9">count</a> = 0.;
<a name="l00945"></a>00945   result.<a class="code" href="classStat__Results.html#affd1c9ac470125e25e499ca637e94f94">quantity</a> = 0.;
<a name="l00946"></a>00946   <span class="keywordtype">int</span> i;
<a name="l00947"></a>00947   <span class="keywordflow">for</span> (i = 0; i &lt; si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>; i++)
<a name="l00948"></a>00948     {
<a name="l00949"></a>00949       <span class="keywordflow">if</span> (si.<a class="code" href="classStat__Internals.html#a649b539b90556341cb019ec95c0b5bbf">family</a>[i] != 0)
<a name="l00950"></a>00950         {
<a name="l00951"></a>00951           <span class="keywordflow">if</span> (strcmp(si.<a class="code" href="classStat__Internals.html#a649b539b90556341cb019ec95c0b5bbf">family</a>[i], familly) == 0)
<a name="l00952"></a>00952             {
<a name="l00953"></a>00953               result.<a class="code" href="classStat__Results.html#a9ac46c2ac7225154b6893ac453e214ef">time</a> += si.<a class="code" href="classStat__Internals.html#a68c81952102b4c67885978e0f59c8907">counter_time</a>[i].<a class="code" href="classTime.html#af7938b9dc8519ac4d914182968ffbd78">second</a>();
<a name="l00954"></a>00954               result.<a class="code" href="classStat__Results.html#a616f30fa3456aa88ed6b4c3f07c3f3d9">count</a> += si.<a class="code" href="classStat__Internals.html#a3bc661477a7486ba0f19fc734624f367">counter_nb</a>[i];
<a name="l00955"></a>00955               result.<a class="code" href="classStat__Results.html#affd1c9ac470125e25e499ca637e94f94">quantity</a> += si.<a class="code" href="classStat__Internals.html#a6c82f740705153b26cc9e983545273ad">counter_quantity</a>[i];
<a name="l00956"></a>00956             }
<a name="l00957"></a>00957         }
<a name="l00958"></a>00958     }
<a name="l00959"></a>00959   result.<a class="code" href="classStat__Results.html#a3a05bd3af5a7f6eac5d08c7cd4cdf3e8">compute_min_max_avg</a>();
<a name="l00960"></a>00960 }
<a name="l00961"></a>00961 
<a name="l00962"></a>00962 
<a name="l00963"></a><a class="code" href="classStatistiques.html#a072a355a4ec8a3bae3afbbf11959a82e">00963</a> <span class="keywordtype">void</span> <a class="code" href="classStatistiques.html#a072a355a4ec8a3bae3afbbf11959a82e">Statistiques::cumulate_stats</a>(<span class="keywordtype">int</span> counter_id, <a class="code" href="classStat__Results.html">Stat_Results</a>&amp; result)
<a name="l00964"></a>00964 {
<a name="l00965"></a>00965   <a class="code" href="classStat__Internals.html">Stat_Internals</a>&amp; si = *<a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a>;
<a name="l00966"></a>00966   assert(counter_id &lt; si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>);
<a name="l00967"></a>00967   result.<a class="code" href="classStat__Results.html#a9ac46c2ac7225154b6893ac453e214ef">time</a> += si.<a class="code" href="classStat__Internals.html#a68c81952102b4c67885978e0f59c8907">counter_time</a>[counter_id].<a class="code" href="classTime.html#af7938b9dc8519ac4d914182968ffbd78">second</a>();
<a name="l00968"></a>00968   result.<a class="code" href="classStat__Results.html#a616f30fa3456aa88ed6b4c3f07c3f3d9">count</a> += si.<a class="code" href="classStat__Internals.html#a3bc661477a7486ba0f19fc734624f367">counter_nb</a>[counter_id];
<a name="l00969"></a>00969   result.<a class="code" href="classStat__Results.html#affd1c9ac470125e25e499ca637e94f94">quantity</a> += si.<a class="code" href="classStat__Internals.html#a6c82f740705153b26cc9e983545273ad">counter_quantity</a>[counter_id];
<a name="l00970"></a>00970 }
<a name="l00971"></a>00971 
<a name="l00972"></a>00972 
<a name="l00973"></a>00973 
<a name="l00974"></a>00974 <span class="comment">// retourne l&#39;identifiant du compteur de communication ayant index comme indice dans le tableau communication_tracking_info</span>
<a name="l00975"></a><a class="code" href="classStatistiques.html#a78ae177921fa3b206e6306a0d782eb18">00975</a> <span class="keywordtype">int</span> <a class="code" href="classStatistiques.html#a78ae177921fa3b206e6306a0d782eb18">Statistiques::get_counter_id_from_index_in_comm_tracking_info</a>(<span class="keywordtype">int</span> index)<span class="keyword"> const</span>
<a name="l00976"></a>00976 <span class="keyword"></span>{
<a name="l00977"></a>00977   <a class="code" href="classStat__Internals.html">Stat_Internals</a>&amp; si = *<a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a>;
<a name="l00978"></a>00978   <span class="keywordtype">int</span> counter_id = -1;
<a name="l00979"></a>00979   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>; i++)
<a name="l00980"></a>00980     <span class="keywordflow">if</span> ( si.<a class="code" href="classStat__Internals.html#a99685fe38179ce69ca479aea547eaee8">index_in_communication_tracking_info</a>[i] == index )
<a name="l00981"></a>00981       counter_id=i;
<a name="l00982"></a>00982 
<a name="l00983"></a>00983 
<a name="l00984"></a>00984   <span class="keywordflow">if</span>(counter_id == -1)
<a name="l00985"></a>00985     {
<a name="l00986"></a>00986       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Statistiques::get_counter_id_from_index_in_comm_tracking_info() : error! The provided index does not correspond to any counter...&quot;</span> &lt;&lt; finl;
<a name="l00987"></a>00987       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00988"></a>00988     }
<a name="l00989"></a>00989 
<a name="l00990"></a>00990   <span class="keywordflow">return</span> counter_id;
<a name="l00991"></a>00991 }
<a name="l00992"></a>00992 
<a name="l00993"></a><a class="code" href="classStatistiques.html#a74267755e9d140d541ab4e29a356da98">00993</a> <span class="keywordtype">int</span> <a class="code" href="classStatistiques.html#a74267755e9d140d541ab4e29a356da98">Statistiques::get_index_in_comm_tracking_info_from_counter_id</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>)<span class="keyword"> const</span>
<a name="l00994"></a>00994 <span class="keyword"></span>{
<a name="l00995"></a>00995   <span class="keywordflow">return</span> ( <a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a>-&gt;<a class="code" href="classStat__Internals.html#a99685fe38179ce69ca479aea547eaee8">index_in_communication_tracking_info</a>[<span class="keywordtype">id</span>] );
<a name="l00996"></a>00996 }
<a name="l00997"></a>00997 
<a name="l00998"></a>00998 
<a name="l00999"></a><a class="code" href="classStatistiques.html#a9d583f199fceea865e1a064bc11ef0d4">00999</a> <span class="keywordtype">int</span> <a class="code" href="classStatistiques.html#a9d583f199fceea865e1a064bc11ef0d4">Statistiques::get_counter_id_from_description</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* desc)<span class="keyword"> const</span>
<a name="l01000"></a>01000 <span class="keyword"></span>{
<a name="l01001"></a>01001   <span class="keywordflow">return</span> ( <a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a> -&gt; description_to_id[desc] );
<a name="l01002"></a>01002 }
<a name="l01003"></a><a class="code" href="classStatistiques.html#aeee98421824a65c16bfc1a2d7d3d124a">01003</a> <span class="keywordtype">int</span> <a class="code" href="classStatistiques.html#aeee98421824a65c16bfc1a2d7d3d124a">Statistiques::allocate_communication_tracking_times</a>()
<a name="l01004"></a>01004 {
<a name="l01005"></a>01005   <a class="code" href="classStat__Internals.html">Stat_Internals</a>&amp; si = *<a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a>;
<a name="l01006"></a>01006 
<a name="l01007"></a>01007   si.<a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">communication_tracking_info</a> = <span class="keyword">new</span> <a class="code" href="classStat__Results.html">Stat_Results</a>*[si.<a class="code" href="classStat__Internals.html#adca4555b4db6aa4030205a554fb8e8c4">nb_comm_counters</a>];
<a name="l01008"></a>01008   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; si.<a class="code" href="classStat__Internals.html#adca4555b4db6aa4030205a554fb8e8c4">nb_comm_counters</a>; i++)
<a name="l01009"></a>01009     si.<a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">communication_tracking_info</a>[i] = <span class="keyword">new</span> <a class="code" href="classStat__Results.html">Stat_Results</a>[MAXCOUNTERS+1];
<a name="l01010"></a>01010 
<a name="l01011"></a>01011   <span class="keywordflow">return</span> 0;
<a name="l01012"></a>01012 }
<a name="l01013"></a>01013 
<a name="l01014"></a><a class="code" href="classStatistiques.html#a058942e8d7a9f68ef7f1354b3bdb5a15">01014</a> <span class="keywordtype">int</span> <a class="code" href="classStatistiques.html#a058942e8d7a9f68ef7f1354b3bdb5a15">Statistiques::delete_communication_tracking_times</a>()
<a name="l01015"></a>01015 {
<a name="l01016"></a>01016   <a class="code" href="classStat__Internals.html">Stat_Internals</a>&amp; si = *<a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a>;
<a name="l01017"></a>01017   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; si.<a class="code" href="classStat__Internals.html#adca4555b4db6aa4030205a554fb8e8c4">nb_comm_counters</a>; ++i)
<a name="l01018"></a>01018     {
<a name="l01019"></a>01019       <span class="keyword">delete</span> [] si.<a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">communication_tracking_info</a>[i];
<a name="l01020"></a>01020       si.<a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">communication_tracking_info</a>[i] = 0;
<a name="l01021"></a>01021     }
<a name="l01022"></a>01022   <span class="keyword">delete</span> [] si.<a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">communication_tracking_info</a>;
<a name="l01023"></a>01023   si.<a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">communication_tracking_info</a> = 0;
<a name="l01024"></a>01024   <span class="keywordflow">return</span> 0;
<a name="l01025"></a>01025 }
<a name="l01026"></a>01026 
<a name="l01027"></a>01027 
<a name="l01028"></a><a class="code" href="classStatistiques.html#ad910ba9f3122d52d668205df343b4261">01028</a> <span class="keywordtype">void</span> <a class="code" href="classStatistiques.html#ad910ba9f3122d52d668205df343b4261">Statistiques::begin_communication_tracking</a>(<span class="keywordtype">int</span> cid)
<a name="l01029"></a>01029 {
<a name="l01030"></a>01030 
<a name="l01031"></a>01031   <a class="code" href="classStat__Internals.html">Stat_Internals</a>&amp; si = *<a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a>;
<a name="l01032"></a>01032   <span class="keywordflow">if</span>(!<a class="code" href="Statistiques_8h.html#a7f6c434cd21697d3bafbdc2433f06c37">GET_COMM_DETAILS</a> || si.<a class="code" href="classStat__Internals.html#acf9be2a71aadb932ce038def496aa0f4">counter_comm</a>[cid] )
<a name="l01033"></a>01033     <span class="keywordflow">return</span>;
<a name="l01034"></a>01034 
<a name="l01035"></a>01035   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; si.<a class="code" href="classStat__Internals.html#adca4555b4db6aa4030205a554fb8e8c4">nb_comm_counters</a>; i++)
<a name="l01036"></a>01036     {
<a name="l01037"></a>01037 <span class="comment">// correspondance entre l&#39;indice dans le tableau communication_tracking_times et l&#39;id du compteur associe</span>
<a name="l01038"></a>01038       <span class="keywordtype">int</span> counter_id = <a class="code" href="classStatistiques.html#a78ae177921fa3b206e6306a0d782eb18">get_counter_id_from_index_in_comm_tracking_info</a>(i);
<a name="l01039"></a>01039 
<a name="l01040"></a>01040       <a class="code" href="classStat__Results.html">Stat_Results</a>&amp; comm_total_time = si.<a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">communication_tracking_info</a>[i][0];
<a name="l01041"></a>01041       <a class="code" href="classStatistiques.html#a072a355a4ec8a3bae3afbbf11959a82e">cumulate_stats</a>(counter_id, comm_total_time);
<a name="l01042"></a>01042       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>; j++)
<a name="l01043"></a>01043         {
<a name="l01044"></a>01044 <span class="comment">// si d&#39;autres zones de communication sont activees,</span>
<a name="l01045"></a>01045 <span class="comment">// on met a jour leurs donnees</span>
<a name="l01046"></a>01046           <span class="keywordflow">if</span> (si.<a class="code" href="classStat__Internals.html#a2bd8a11dd20c95119aadd64a02a4e962">comm_zones_on</a>[j])
<a name="l01047"></a>01047             {
<a name="l01048"></a>01048               <a class="code" href="classStat__Results.html">Stat_Results</a>&amp; comm_time_in_zone_j = si.<a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">communication_tracking_info</a>[i][j + 1];
<a name="l01049"></a>01049               <a class="code" href="classStatistiques.html#a072a355a4ec8a3bae3afbbf11959a82e">cumulate_stats</a>(counter_id, comm_time_in_zone_j);
<a name="l01050"></a>01050 
<a name="l01051"></a>01051             }
<a name="l01052"></a>01052         }
<a name="l01053"></a>01053       <a class="code" href="classStatistiques.html#a9dcac2b83caee9e5f27c55134f000efc">reset_counter</a>(counter_id);
<a name="l01054"></a>01054 
<a name="l01055"></a>01055     }
<a name="l01056"></a>01056 
<a name="l01057"></a>01057   si.<a class="code" href="classStat__Internals.html#a2bd8a11dd20c95119aadd64a02a4e962">comm_zones_on</a>[cid] = <span class="keyword">true</span>;
<a name="l01058"></a>01058 
<a name="l01059"></a>01059 }
<a name="l01060"></a><a class="code" href="classStatistiques.html#a7f9d786ac1f129124a35a129d030ba3c">01060</a> <span class="keywordtype">void</span> <a class="code" href="classStatistiques.html#a7f9d786ac1f129124a35a129d030ba3c">Statistiques::end_communication_tracking</a>(<span class="keywordtype">int</span> cid)
<a name="l01061"></a>01061 {
<a name="l01062"></a>01062   <a class="code" href="classStat__Internals.html">Stat_Internals</a>&amp; si = *<a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a>;
<a name="l01063"></a>01063   <span class="keywordflow">if</span>(!<a class="code" href="Statistiques_8h.html#a7f6c434cd21697d3bafbdc2433f06c37">GET_COMM_DETAILS</a> || si.<a class="code" href="classStat__Internals.html#acf9be2a71aadb932ce038def496aa0f4">counter_comm</a>[cid] )
<a name="l01064"></a>01064     <span class="keywordflow">return</span>;
<a name="l01065"></a>01065 
<a name="l01066"></a>01066   assert(cid &gt;=0);
<a name="l01067"></a>01067 
<a name="l01068"></a>01068   <span class="keywordflow">if</span> (si.<a class="code" href="classStat__Internals.html#a2bd8a11dd20c95119aadd64a02a4e962">comm_zones_on</a>[cid] == <span class="keyword">false</span>)
<a name="l01069"></a>01069     {
<a name="l01070"></a>01070       <a class="code" href="classProcess.html#a57e0f54b11e6eaadbea224fa904b18dd" title="Renvoie un objet statique de type Sortie qui sert de journal d&#39;evenements. Si message_level &lt;= verbose...">Process::Journal</a>() &lt;&lt; <span class="stringliteral">&quot;Error! end_communication_tracking (&quot;</span> &lt;&lt; si.<a class="code" href="classStat__Internals.html#a15f28ff82cee405d14d517fe6bdb6c16">description</a>[cid] &lt;&lt; <span class="stringliteral">&quot;) has not been activated&quot;</span> &lt;&lt;finl;
<a name="l01071"></a>01071       <span class="keywordflow">return</span>;
<a name="l01072"></a>01072     }
<a name="l01073"></a>01073 
<a name="l01074"></a>01074   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; si.<a class="code" href="classStat__Internals.html#adca4555b4db6aa4030205a554fb8e8c4">nb_comm_counters</a>; i++)
<a name="l01075"></a>01075     {
<a name="l01076"></a>01076 <span class="comment">// correspondance entre l&#39;indice dans le tableau communication_tracking_times et l&#39;id du compteur associe</span>
<a name="l01077"></a>01077       <span class="keywordtype">int</span> counter_id = <a class="code" href="classStatistiques.html#a78ae177921fa3b206e6306a0d782eb18">get_counter_id_from_index_in_comm_tracking_info</a>(i);
<a name="l01078"></a>01078 
<a name="l01079"></a>01079       <a class="code" href="classStat__Results.html">Stat_Results</a>&amp; comm_time_in_zone_cid = si.<a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">communication_tracking_info</a>[i][cid + 1];
<a name="l01080"></a>01080       <a class="code" href="classStatistiques.html#a072a355a4ec8a3bae3afbbf11959a82e">cumulate_stats</a>(counter_id, comm_time_in_zone_cid);
<a name="l01081"></a>01081 
<a name="l01082"></a>01082     }
<a name="l01083"></a>01083 
<a name="l01084"></a>01084   si.<a class="code" href="classStat__Internals.html#a2bd8a11dd20c95119aadd64a02a4e962">comm_zones_on</a>[cid] = <span class="keyword">false</span>;
<a name="l01085"></a>01085 }
<a name="l01086"></a>01086 
<a name="l01087"></a>01087 
<a name="l01088"></a><a class="code" href="classStatistiques.html#a54c730ed76d3e1ce710392295369acaa">01088</a> <span class="keywordtype">void</span> <a class="code" href="classStatistiques.html#a54c730ed76d3e1ce710392295369acaa">Statistiques::print_communciation_tracking_details</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="Reordonner__faces__periodiques_8cpp.html#a137d78a01e63d3b66d1b2ed0de0f4c4c">message</a>, <span class="keywordtype">int</span> mode_append)
<a name="l01089"></a>01089 {
<a name="l01090"></a>01090   assert(message); <span class="comment">//!&lt; message non nul !</span>
<a name="l01091"></a>01091 <span class="comment"></span>
<a name="l01092"></a>01092   <a class="code" href="classStat__Internals.html">Stat_Internals</a>&amp; si = *<a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a>;
<a name="l01093"></a>01093 
<a name="l01094"></a>01094   <a class="code" href="classStatistiques.html#a854ef63a0b657c147bb625bce97e4f4f">stop_counters</a>();
<a name="l01095"></a>01095 
<a name="l01096"></a>01096 <span class="comment">// on recupere les donnees de communication produites depuis la derniere remise a zero</span>
<a name="l01097"></a>01097   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; si.<a class="code" href="classStat__Internals.html#adca4555b4db6aa4030205a554fb8e8c4">nb_comm_counters</a>; i++)
<a name="l01098"></a>01098     {
<a name="l01099"></a>01099 <span class="comment">// correspondance entre l&#39;indice dans le tableau communication_tracking_times et l&#39;id du compteur associe</span>
<a name="l01100"></a>01100       <span class="keywordtype">int</span> counter_id = <a class="code" href="classStatistiques.html#a78ae177921fa3b206e6306a0d782eb18">get_counter_id_from_index_in_comm_tracking_info</a>(i);
<a name="l01101"></a>01101 
<a name="l01102"></a>01102       <a class="code" href="classStat__Results.html">Stat_Results</a>&amp; comm_total_time = si.<a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">communication_tracking_info</a>[i][0];
<a name="l01103"></a>01103       <a class="code" href="classStatistiques.html#a072a355a4ec8a3bae3afbbf11959a82e">cumulate_stats</a>(counter_id, comm_total_time);
<a name="l01104"></a>01104 
<a name="l01105"></a>01105     }
<a name="l01106"></a>01106 
<a name="l01107"></a>01107   <a class="code" href="classSChaine.html" title="Cette classe derivee de Sortie empile ce qu&#39;on lui envoie dans une chaine de caracteres. On recupere le contenu de la chaine avec get_str().">SChaine</a> <a class="code" href="MD__Vector__tools_8cpp.html#aff39c4429f5c1b24eb7ac0848f154ffc">comm</a>;
<a name="l01108"></a>01108   <span class="keywordtype">char</span> desc[<a class="code" href="Statistiques_8cpp.html#ad974fe981249f5e84fbf1683b012c9f8">BUFLEN</a>+100];
<a name="l01109"></a>01109 
<a name="l01110"></a>01110   comm &lt;&lt; <span class="stringliteral">&quot;*************************************************************************************************&quot;</span> &lt;&lt; finl;
<a name="l01111"></a>01111   comm &lt;&lt; message &lt;&lt; finl;
<a name="l01112"></a>01112   comm &lt;&lt; <span class="stringliteral">&quot;Block divided into 2 parts:&quot;</span> &lt;&lt; finl;
<a name="l01113"></a>01113   comm &lt;&lt; <span class="stringliteral">&quot;Part 1: for each function, gives the percentage consumed by communications&quot;</span> &lt;&lt; finl;
<a name="l01114"></a>01114   comm &lt;&lt; <span class="stringliteral">&quot;Part 2: for each type of communication, gives the percentage of time spent in each function&quot;</span> &lt;&lt; finl;
<a name="l01115"></a>01115   comm &lt;&lt; <span class="stringliteral">&quot;        Note that some counters are nested within each other, &quot;</span> &lt;&lt; finl;
<a name="l01116"></a>01116   comm &lt;&lt; <span class="stringliteral">&quot;        that&#39;s why the sum of the percentages does not necessarily add up to 100% in this part.&quot;</span> &lt;&lt; finl;
<a name="l01117"></a>01117   comm &lt;&lt; <span class="stringliteral">&quot;*************************************************************************************************&quot;</span> &lt;&lt; finl;
<a name="l01118"></a>01118 
<a name="l01119"></a>01119   comm &lt;&lt; finl;
<a name="l01120"></a>01120 
<a name="l01121"></a>01121 <span class="comment">// parcours des zones de communication</span>
<a name="l01122"></a>01122 <span class="comment">// on laisse tomber temps total</span>
<a name="l01123"></a>01123   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>; i++)
<a name="l01124"></a>01124     {
<a name="l01125"></a>01125 
<a name="l01126"></a>01126       <span class="keywordtype">double</span> tot_communication_in_zone_i = 0;
<a name="l01127"></a>01127       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; si.<a class="code" href="classStat__Internals.html#adca4555b4db6aa4030205a554fb8e8c4">nb_comm_counters</a>; j++)
<a name="l01128"></a>01128         {
<a name="l01129"></a>01129 <span class="comment">// on ne compte pas echange_espace_vectoriel (redondant avec send_recv)</span>
<a name="l01130"></a>01130           <span class="keywordtype">int</span> counter_id = <a class="code" href="classStatistiques.html#a78ae177921fa3b206e6306a0d782eb18">get_counter_id_from_index_in_comm_tracking_info</a>(j);
<a name="l01131"></a>01131           <span class="keywordflow">if</span>( strcmp(si.<a class="code" href="classStat__Internals.html#a15f28ff82cee405d14d517fe6bdb6c16">description</a>[counter_id], <span class="stringliteral">&quot;DoubleVect/IntVect::echange_espace_virtuel&quot;</span>) )
<a name="l01132"></a>01132             tot_communication_in_zone_i += si.<a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">communication_tracking_info</a>[j][i+1].<a class="code" href="classStat__Results.html#a9ac46c2ac7225154b6893ac453e214ef">time</a>;
<a name="l01133"></a>01133         }
<a name="l01134"></a>01134 
<a name="l01135"></a>01135       <span class="keywordtype">double</span> tot_avg_communication_in_zone_i = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(tot_communication_in_zone_i);
<a name="l01136"></a>01136       tot_avg_communication_in_zone_i /= <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l01137"></a>01137 
<a name="l01138"></a>01138       <span class="keywordtype">double</span> tot_time_in_zone_i = si.<a class="code" href="classStat__Internals.html#a68c81952102b4c67885978e0f59c8907">counter_time</a>[i].<a class="code" href="classTime.html#af7938b9dc8519ac4d914182968ffbd78">second</a>();
<a name="l01139"></a>01139       <span class="keywordtype">int</span> comm_pourcent = tot_time_in_zone_i != 0.0 ? tot_communication_in_zone_i / tot_time_in_zone_i * 100 : 0.0;
<a name="l01140"></a>01140       <span class="keywordtype">int</span> avg_comm_pourcent = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(comm_pourcent) / <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l01141"></a>01141 
<a name="l01142"></a>01142       <span class="keywordflow">if</span> (tot_avg_communication_in_zone_i)
<a name="l01143"></a>01143         {
<a name="l01144"></a>01144           comm &lt;&lt; si.<a class="code" href="classStat__Internals.html#a15f28ff82cee405d14d517fe6bdb6c16">description</a>[i] &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; tot_avg_communication_in_zone_i &lt;&lt; <span class="stringliteral">&quot;s de communications (soit &quot;</span>;
<a name="l01145"></a>01145           comm &lt;&lt; avg_comm_pourcent &lt;&lt; <span class="stringliteral">&quot;% du temps total consomme par ce compteur)\n&quot;</span>;
<a name="l01146"></a>01146 
<a name="l01147"></a>01147           <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; si.<a class="code" href="classStat__Internals.html#adca4555b4db6aa4030205a554fb8e8c4">nb_comm_counters</a>; j++)
<a name="l01148"></a>01148             {
<a name="l01149"></a>01149 <span class="comment">// on ne compte pas echange_espace_vectoriel</span>
<a name="l01150"></a>01150               <span class="keywordtype">int</span> counter_id = <a class="code" href="classStatistiques.html#a78ae177921fa3b206e6306a0d782eb18">get_counter_id_from_index_in_comm_tracking_info</a>(j);
<a name="l01151"></a>01151               <span class="keywordflow">if</span>( strcmp(si.<a class="code" href="classStat__Internals.html#a15f28ff82cee405d14d517fe6bdb6c16">description</a>[counter_id], <span class="stringliteral">&quot;DoubleVect/IntVect::echange_espace_virtuel&quot;</span>) )
<a name="l01152"></a>01152                 {
<a name="l01153"></a>01153                   <a class="code" href="classStat__Results.html">Stat_Results</a>&amp; communication_of_type_j = si.<a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">communication_tracking_info</a>[j][i+1];
<a name="l01154"></a>01154                   <span class="keywordtype">double</span> avg_communication_of_type_j = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(communication_of_type_j.<a class="code" href="classStat__Results.html#a9ac46c2ac7225154b6893ac453e214ef">time</a>);
<a name="l01155"></a>01155                   avg_communication_of_type_j /= <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l01156"></a>01156 
<a name="l01157"></a>01157                   <span class="keywordtype">int</span> communication_type_pourcentage = tot_communication_in_zone_i != 0.0 ? communication_of_type_j.<a class="code" href="classStat__Results.html#a9ac46c2ac7225154b6893ac453e214ef">time</a> / tot_communication_in_zone_i * 100 : 0.0;
<a name="l01158"></a>01158                   <span class="keywordtype">int</span> avg_communication_type_pourcentage = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(communication_type_pourcentage);
<a name="l01159"></a>01159                   avg_communication_type_pourcentage /= <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l01160"></a>01160 
<a name="l01161"></a>01161                   <span class="keywordflow">if</span>(avg_communication_of_type_j)
<a name="l01162"></a>01162                     {
<a name="l01163"></a>01163 <span class="preprocessor">#ifdef INT_is_64_</span>
<a name="l01164"></a>01164 <span class="preprocessor"></span>                      sprintf(desc, <span class="stringliteral">&quot;%10s %-25s %.2e s (%2li%%)\n&quot;</span>, <span class="stringliteral">&quot;\tdont&quot;</span>, si.<a class="code" href="classStat__Internals.html#a15f28ff82cee405d14d517fe6bdb6c16">description</a>[counter_id], avg_communication_of_type_j,avg_communication_type_pourcentage);
<a name="l01165"></a>01165 <span class="preprocessor">#else</span>
<a name="l01166"></a>01166 <span class="preprocessor"></span>                      sprintf(desc, <span class="stringliteral">&quot;%10s %-25s %.2e s (%2i%%)\n&quot;</span>, <span class="stringliteral">&quot;\tdont&quot;</span>, si.<a class="code" href="classStat__Internals.html#a15f28ff82cee405d14d517fe6bdb6c16">description</a>[counter_id], avg_communication_of_type_j,avg_communication_type_pourcentage);
<a name="l01167"></a>01167 <span class="preprocessor">#endif</span>
<a name="l01168"></a>01168 <span class="preprocessor"></span>                      comm &lt;&lt; desc;
<a name="l01169"></a>01169                     }
<a name="l01170"></a>01170                 }
<a name="l01171"></a>01171 
<a name="l01172"></a>01172             }
<a name="l01173"></a>01173 
<a name="l01174"></a>01174           comm &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01175"></a>01175         }
<a name="l01176"></a>01176 
<a name="l01177"></a>01177     }
<a name="l01178"></a>01178 
<a name="l01179"></a>01179 
<a name="l01180"></a>01180   <span class="keywordtype">double</span>* send_recv_family = (<span class="keywordtype">double</span> *)calloc(si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>+1, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l01181"></a>01181   <span class="keywordtype">double</span>* all_reduce_family = (<span class="keywordtype">double</span> *)calloc(si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>+1, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l01182"></a>01182 
<a name="l01183"></a>01183 <span class="comment">// parcours des compteurs de communication</span>
<a name="l01184"></a>01184   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; si.<a class="code" href="classStat__Internals.html#adca4555b4db6aa4030205a554fb8e8c4">nb_comm_counters</a>; i++)
<a name="l01185"></a>01185     {
<a name="l01186"></a>01186       <span class="keywordtype">int</span> counter_id = <a class="code" href="classStatistiques.html#a78ae177921fa3b206e6306a0d782eb18">get_counter_id_from_index_in_comm_tracking_info</a>(i);
<a name="l01187"></a>01187       <span class="keywordtype">double</span> total_time_of_communication_i = si.<a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">communication_tracking_info</a>[i][0].<a class="code" href="classStat__Results.html#a9ac46c2ac7225154b6893ac453e214ef">time</a>;
<a name="l01188"></a>01188       <span class="keywordtype">double</span> total_avg_time_of_communication_i = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(total_time_of_communication_i);
<a name="l01189"></a>01189       total_avg_time_of_communication_i /= <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l01190"></a>01190 
<a name="l01191"></a>01191       <span class="keywordflow">if</span>(total_avg_time_of_communication_i == 0.0) <span class="keywordflow">continue</span>;
<a name="l01192"></a>01192 
<a name="l01193"></a>01193       comm
<a name="l01194"></a>01194           &lt;&lt; <span class="stringliteral">&quot;\n-----------------------------------------------------------------&quot;</span>
<a name="l01195"></a>01195           &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01196"></a>01196       comm
<a name="l01197"></a>01197           &lt;&lt;                        si.<a class="code" href="classStat__Internals.html#a15f28ff82cee405d14d517fe6bdb6c16">description</a>[counter_id]
<a name="l01198"></a>01198           &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01199"></a>01199       comm
<a name="l01200"></a>01200           &lt;&lt; <span class="stringliteral">&quot;-----------------------------------------------------------------&quot;</span>
<a name="l01201"></a>01201           &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01202"></a>01202       comm &lt;&lt; <span class="stringliteral">&quot;Temps total : &quot;</span> &lt;&lt; total_avg_time_of_communication_i &lt;&lt; <span class="stringliteral">&quot;s\n&quot;</span>;
<a name="l01203"></a>01203 
<a name="l01204"></a>01204       <span class="keywordflow">if</span>( si.<a class="code" href="classStat__Internals.html#a649b539b90556341cb019ec95c0b5bbf">family</a>[counter_id] != 0 )
<a name="l01205"></a>01205         {
<a name="l01206"></a>01206           <span class="keywordflow">if</span>( !strcmp(si.<a class="code" href="classStat__Internals.html#a649b539b90556341cb019ec95c0b5bbf">family</a>[counter_id], <span class="stringliteral">&quot;MPI_allreduce&quot;</span> ) )
<a name="l01207"></a>01207             all_reduce_family[0] += total_time_of_communication_i;
<a name="l01208"></a>01208           <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !strcmp(si.<a class="code" href="classStat__Internals.html#a649b539b90556341cb019ec95c0b5bbf">family</a>[counter_id], <span class="stringliteral">&quot;MPI_sendrecv&quot;</span> ) )
<a name="l01209"></a>01209             send_recv_family[0] += total_time_of_communication_i;
<a name="l01210"></a>01210         }
<a name="l01211"></a>01211 
<a name="l01212"></a>01212 <span class="comment">// first counter is &quot;Temps total&quot;, we can skip it</span>
<a name="l01213"></a>01213       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>; j++)
<a name="l01214"></a>01214         {
<a name="l01215"></a>01215           <span class="keywordtype">double</span> communication_in_zone_j = si.<a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">communication_tracking_info</a>[i][j+1].<a class="code" href="classStat__Results.html#a9ac46c2ac7225154b6893ac453e214ef">time</a>;
<a name="l01216"></a>01216           <span class="keywordtype">double</span> avg_communication_in_zone_j = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(communication_in_zone_j);
<a name="l01217"></a>01217           avg_communication_in_zone_j /= <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l01218"></a>01218 
<a name="l01219"></a>01219           <span class="keywordtype">int</span> pourcentage = total_time_of_communication_i != 0.0 ? communication_in_zone_j / total_time_of_communication_i * 100 : 0.0;
<a name="l01220"></a>01220           <span class="keywordtype">int</span> avg_pourcentage = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(pourcentage);
<a name="l01221"></a>01221           avg_pourcentage /= <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l01222"></a>01222           <span class="keywordflow">if</span>(avg_pourcentage)
<a name="l01223"></a>01223             comm &lt;&lt; <span class="stringliteral">&quot;\tdont &quot;</span> &lt;&lt; si.<a class="code" href="classStat__Internals.html#a15f28ff82cee405d14d517fe6bdb6c16">description</a>[j] &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; avg_communication_in_zone_j &lt;&lt; <span class="stringliteral">&quot;s (&quot;</span> &lt;&lt; avg_pourcentage &lt;&lt; <span class="stringliteral">&quot;%) \n&quot;</span>;
<a name="l01224"></a>01224 
<a name="l01225"></a>01225           <span class="keywordflow">if</span> (si.<a class="code" href="classStat__Internals.html#a649b539b90556341cb019ec95c0b5bbf">family</a>[counter_id] != 0)
<a name="l01226"></a>01226             {
<a name="l01227"></a>01227               <span class="keywordflow">if</span>( !strcmp(si.<a class="code" href="classStat__Internals.html#a649b539b90556341cb019ec95c0b5bbf">family</a>[counter_id], <span class="stringliteral">&quot;MPI_allreduce&quot;</span> ) )
<a name="l01228"></a>01228                 all_reduce_family[j+1] += communication_in_zone_j;
<a name="l01229"></a>01229 
<a name="l01230"></a>01230               <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !strcmp(si.<a class="code" href="classStat__Internals.html#a649b539b90556341cb019ec95c0b5bbf">family</a>[counter_id], <span class="stringliteral">&quot;MPI_sendrecv&quot;</span> ) )
<a name="l01231"></a>01231                 send_recv_family[j+1] += communication_in_zone_j;
<a name="l01232"></a>01232             }
<a name="l01233"></a>01233 
<a name="l01234"></a>01234         }
<a name="l01235"></a>01235     }
<a name="l01236"></a>01236   comm &lt;&lt; finl;
<a name="l01237"></a>01237 
<a name="l01238"></a>01238 <span class="comment">// affichage des informations sur les familles de commpteurs</span>
<a name="l01239"></a>01239   comm
<a name="l01240"></a>01240       &lt;&lt; <span class="stringliteral">&quot;\n-----------------------------------------------------------------&quot;</span>
<a name="l01241"></a>01241       &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01242"></a>01242   comm
<a name="l01243"></a>01243       &lt;&lt; <span class="stringliteral">&quot;                    Famille MPI_allreduce                         &quot;</span>
<a name="l01244"></a>01244       &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01245"></a>01245   comm
<a name="l01246"></a>01246       &lt;&lt; <span class="stringliteral">&quot;-----------------------------------------------------------------&quot;</span>
<a name="l01247"></a>01247       &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01248"></a>01248 
<a name="l01249"></a>01249   <span class="keywordtype">double</span> tot_avg_all_reduce = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(all_reduce_family[0]);
<a name="l01250"></a>01250   tot_avg_all_reduce /= <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l01251"></a>01251   comm &lt;&lt; <span class="stringliteral">&quot;Temps total : &quot;</span> &lt;&lt; tot_avg_all_reduce &lt;&lt; <span class="stringliteral">&quot;s\n&quot;</span>;
<a name="l01252"></a>01252 
<a name="l01253"></a>01253   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>; i++)
<a name="l01254"></a>01254     {
<a name="l01255"></a>01255       <span class="keywordtype">double</span> avg_all_reduce_in_zone_i = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(all_reduce_family[i]);
<a name="l01256"></a>01256       avg_all_reduce_in_zone_i /= <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l01257"></a>01257 
<a name="l01258"></a>01258       <span class="keywordtype">int</span> pourcentage = all_reduce_family[0] != 0.0 ? all_reduce_family[i] / all_reduce_family[0] * 100 : 0.0;
<a name="l01259"></a>01259       <span class="keywordtype">int</span> avg_pourcentage = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(pourcentage);
<a name="l01260"></a>01260       avg_pourcentage /= <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l01261"></a>01261 
<a name="l01262"></a>01262       <span class="keywordflow">if</span>(avg_pourcentage)
<a name="l01263"></a>01263         comm &lt;&lt; <span class="stringliteral">&quot;\tdont &quot;</span> &lt;&lt; si.<a class="code" href="classStat__Internals.html#a15f28ff82cee405d14d517fe6bdb6c16">description</a>[i-1] &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; avg_all_reduce_in_zone_i &lt;&lt; <span class="stringliteral">&quot;s (&quot;</span> &lt;&lt; avg_pourcentage &lt;&lt; <span class="stringliteral">&quot;%) \n&quot;</span>;
<a name="l01264"></a>01264 
<a name="l01265"></a>01265     }
<a name="l01266"></a>01266 
<a name="l01267"></a>01267 
<a name="l01268"></a>01268   comm
<a name="l01269"></a>01269       &lt;&lt; <span class="stringliteral">&quot;\n-----------------------------------------------------------------&quot;</span>
<a name="l01270"></a>01270       &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01271"></a>01271   comm
<a name="l01272"></a>01272       &lt;&lt; <span class="stringliteral">&quot;                    Famille MPI_sendrecv                           &quot;</span>
<a name="l01273"></a>01273       &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01274"></a>01274   comm
<a name="l01275"></a>01275       &lt;&lt; <span class="stringliteral">&quot;-----------------------------------------------------------------&quot;</span>
<a name="l01276"></a>01276       &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01277"></a>01277 
<a name="l01278"></a>01278   <span class="keywordtype">double</span> tot_avg_send_recv = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(send_recv_family[0]);
<a name="l01279"></a>01279   tot_avg_send_recv /= <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l01280"></a>01280   comm &lt;&lt; <span class="stringliteral">&quot;Temps total : &quot;</span> &lt;&lt; tot_avg_send_recv &lt;&lt; <span class="stringliteral">&quot;s\n&quot;</span>;
<a name="l01281"></a>01281 
<a name="l01282"></a>01282   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>; i++)
<a name="l01283"></a>01283     {
<a name="l01284"></a>01284       <span class="keywordtype">double</span> avg_send_recv_in_zone_i = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(send_recv_family[i]);
<a name="l01285"></a>01285       avg_send_recv_in_zone_i /= <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l01286"></a>01286 
<a name="l01287"></a>01287       <span class="keywordtype">int</span> pourcentage = send_recv_family[0] != 0.0 ? send_recv_family[i] / send_recv_family[0] * 100 : 0.0;
<a name="l01288"></a>01288       <span class="keywordtype">int</span> avg_pourcentage = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(pourcentage);
<a name="l01289"></a>01289       avg_pourcentage /= <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l01290"></a>01290 
<a name="l01291"></a>01291       <span class="keywordflow">if</span>(avg_pourcentage)
<a name="l01292"></a>01292         comm &lt;&lt; <span class="stringliteral">&quot;\tdont &quot;</span> &lt;&lt; si.<a class="code" href="classStat__Internals.html#a15f28ff82cee405d14d517fe6bdb6c16">description</a>[i-1] &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; avg_send_recv_in_zone_i &lt;&lt; <span class="stringliteral">&quot;s (&quot;</span> &lt;&lt; avg_pourcentage &lt;&lt; <span class="stringliteral">&quot;%) \n&quot;</span>;
<a name="l01293"></a>01293 
<a name="l01294"></a>01294     }
<a name="l01295"></a>01295   comm &lt;&lt; <span class="stringliteral">&quot;\n\n&quot;</span>;
<a name="l01296"></a>01296 
<a name="l01297"></a>01297   free(send_recv_family);
<a name="l01298"></a>01298   free(all_reduce_family);
<a name="l01299"></a>01299 
<a name="l01300"></a>01300   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l01301"></a>01301     {
<a name="l01302"></a>01302       <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> TU(<a class="code" href="classObjet__U.html#a7c27c4f80259eeef76ff8fe2d3bc61f7" title="Renvoie une reference constante vers le nom du cas. Cette methode est statique.">Objet_U::nom_du_cas</a>());
<a name="l01303"></a>01303       TU += <span class="stringliteral">&quot;_comm.TU&quot;</span>;
<a name="l01304"></a>01304       <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a> comm_file(TU, mode_append ? (ios::out | ios::app) : (ios::out));
<a name="l01305"></a>01305       comm_file &lt;&lt; comm.<a class="code" href="classSChaine.html#a8ed820eca8d79e52fb50520d02637315" title="returns a copy of the string stored by the SChaine">get_str</a>();
<a name="l01306"></a>01306     }
<a name="l01307"></a>01307 
<a name="l01308"></a>01308   <a class="code" href="classStatistiques.html#a9c05facd54b457e522edda7a77273e35">restart_counters</a>();
<a name="l01309"></a>01309 
<a name="l01310"></a>01310 }
<a name="l01311"></a>01311 
<a name="l01312"></a><a class="code" href="classStatistiques.html#a79fc47f625b87bec7ebaa39d8e52b8e6">01312</a> <span class="keywordtype">void</span> <a class="code" href="classStatistiques.html#a79fc47f625b87bec7ebaa39d8e52b8e6">Statistiques::compute_avg_min_max_var_per_step</a>(<span class="keywordtype">int</span> tstep)
<a name="l01313"></a>01313 {
<a name="l01314"></a>01314 
<a name="l01315"></a>01315   <a class="code" href="classStat__Internals.html">Stat_Internals</a>&amp; si = *<a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a>;
<a name="l01316"></a>01316 
<a name="l01317"></a>01317   <span class="keywordtype">int</span> step = <a class="code" href="Statistiques_8h.html#a1bcfabda5482a837da0f52c13f997a92">JUMP_3_FIRST_STEPS</a> ? tstep - 3 : tstep;
<a name="l01318"></a>01318   <span class="keywordtype">double</span> counter_time_step;
<a name="l01319"></a>01319 
<a name="l01320"></a>01320   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; si.<a class="code" href="classStat__Internals.html#a9b7ab1911c9e9470852afef517bea983">nb_counters</a>; i++)
<a name="l01321"></a>01321     {
<a name="l01322"></a>01322 <span class="comment">// suivant que l&#39;option GET_COMM_DETAILS est activee ou non,</span>
<a name="l01323"></a>01323 <span class="comment">// les informations de temps des compteurs de communication sont a jour uniquement dans le tableau communication_tracking_times</span>
<a name="l01324"></a>01324       <span class="keywordflow">if</span> ( (<a class="code" href="Statistiques_8h.html#a7f6c434cd21697d3bafbdc2433f06c37">GET_COMM_DETAILS</a> &amp;&amp; !si.<a class="code" href="classStat__Internals.html#acf9be2a71aadb932ce038def496aa0f4">counter_comm</a>[i]) || !<a class="code" href="Statistiques_8h.html#a7f6c434cd21697d3bafbdc2433f06c37">GET_COMM_DETAILS</a> )
<a name="l01325"></a>01325         {
<a name="l01326"></a>01326           counter_time_step =  si.<a class="code" href="classStat__Internals.html#a68c81952102b4c67885978e0f59c8907">counter_time</a>[i].<a class="code" href="classTime.html#af7938b9dc8519ac4d914182968ffbd78">second</a>() - si.<a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][0]; <span class="comment">//temps passe par le compteur i durant l&#39;iteration tstep</span>
<a name="l01327"></a>01327           si.<a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][0] = si.<a class="code" href="classStat__Internals.html#a68c81952102b4c67885978e0f59c8907">counter_time</a>[i].<a class="code" href="classTime.html#af7938b9dc8519ac4d914182968ffbd78">second</a>();
<a name="l01328"></a>01328         }
<a name="l01329"></a>01329       <span class="keywordflow">else</span>
<a name="l01330"></a>01330         {
<a name="l01331"></a>01331           <span class="keywordflow">if</span>(si.<a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">communication_tracking_info</a> == 0)
<a name="l01332"></a>01332             {
<a name="l01333"></a>01333               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;compute_avg_min_max_var_per_step: error ! communication_tracking_times hasn&#39;t been allocated yet... (disable the option GET_COMM_DETAILS in file Statistiques.h)&quot;</span> &lt;&lt;finl;
<a name="l01334"></a>01334               <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l01335"></a>01335             }
<a name="l01336"></a>01336 
<a name="l01337"></a>01337 <span class="comment">// correspondance entre l&#39;identifiant du compteur de communication et son indice dans le tableau communication_tracking_times</span>
<a name="l01338"></a>01338           <span class="keywordtype">int</span> index = si.<a class="code" href="classStat__Internals.html#a99685fe38179ce69ca479aea547eaee8">index_in_communication_tracking_info</a>[i] ;
<a name="l01339"></a>01339           counter_time_step = si.<a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">communication_tracking_info</a>[index][0].<a class="code" href="classStat__Results.html#a9ac46c2ac7225154b6893ac453e214ef">time</a> - si.<a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][0]; <span class="comment">//temps passe par le compteur i durant l&#39;iteration tstep</span>
<a name="l01340"></a>01340           si.<a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][0] = si.<a class="code" href="classStat__Internals.html#a522069cc1a6d0828af1097584c21bf1a">communication_tracking_info</a>[index][0].<a class="code" href="classStat__Results.html#a9ac46c2ac7225154b6893ac453e214ef">time</a>;
<a name="l01341"></a>01341 
<a name="l01342"></a>01342 
<a name="l01343"></a>01343         }
<a name="l01344"></a>01344 
<a name="l01345"></a>01345       <span class="keywordtype">double</span> old_moy = si.<a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][1];
<a name="l01346"></a>01346 <span class="comment">// moyenne courante</span>
<a name="l01347"></a>01347       si.<a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][1] = ((si.<a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][1] * step) + counter_time_step) / (step + 1);
<a name="l01348"></a>01348 <span class="comment">// min courant</span>
<a name="l01349"></a>01349       si.<a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][2] = <a class="code" href="Double_8h.html#a2f8edc4561e9744ed4233b205fa7ec32">min</a>(si.<a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][2],counter_time_step);
<a name="l01350"></a>01350 <span class="comment">// max courant</span>
<a name="l01351"></a>01351       si.<a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][3] = <a class="code" href="Double_8h.html#a1c45761573e6cbc97cfacac78d905016">max</a>(si.<a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][3],counter_time_step);
<a name="l01352"></a>01352 <span class="comment">// variance courante</span>
<a name="l01353"></a>01353       si.<a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][4] = (si.<a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][4] + old_moy*old_moy)* step;
<a name="l01354"></a>01354       si.<a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][4] += counter_time_step*counter_time_step;
<a name="l01355"></a>01355       si.<a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][4] /= step+1;
<a name="l01356"></a>01356       si.<a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][4] -= si.<a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][1] * si.<a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][1];
<a name="l01357"></a>01357 <span class="comment">// avec les erreurs d&#39;arrondis, on peut obtenir une variance negative</span>
<a name="l01358"></a>01358       <span class="keywordflow">if</span> (si.<a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][4] &lt; 0)
<a name="l01359"></a>01359         si.<a class="code" href="classStat__Internals.html#a957848a67d5319b7f1cb5f92ffba0ac2">counters_avg_min_max_var_per_step</a>[i][4] = 0.0;
<a name="l01360"></a>01360 
<a name="l01361"></a>01361     }
<a name="l01362"></a>01362 }
<a name="l01363"></a>01363 
<a name="l01364"></a>01364 
<a name="l01365"></a><a class="code" href="classStatistiques.html#a6eb7e07b408a25885a8f0fc540347e2c">01365</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classStatistiques.html#a6eb7e07b408a25885a8f0fc540347e2c">Statistiques::get_counter_family</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>)
<a name="l01366"></a>01366 {
<a name="l01367"></a>01367   <span class="keywordflow">return</span> ( <a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a> -&gt; family[<span class="keywordtype">id</span>]);
<a name="l01368"></a>01368 }
<a name="l01369"></a>01369 
<a name="l01370"></a><a class="code" href="classStatistiques.html#aaf2bb44b91707e74de0c71449f2fdc91">01370</a> <span class="keywordtype">int</span> <a class="code" href="classStatistiques.html#aaf2bb44b91707e74de0c71449f2fdc91">Statistiques::get_nb_comm_counters</a>()<span class="keyword"> const</span>
<a name="l01371"></a>01371 <span class="keyword"></span>{
<a name="l01372"></a>01372   <span class="keywordflow">return</span> ( <a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a> -&gt; nb_comm_counters);
<a name="l01373"></a>01373 }
<a name="l01374"></a>01374 
<a name="l01375"></a><a class="code" href="classStatistiques.html#a3f4276aa8c867366d16dd5e59e6394f8">01375</a> <a class="code" href="classStat__Results.html">Stat_Results</a> <a class="code" href="classStatistiques.html#a3f4276aa8c867366d16dd5e59e6394f8">Statistiques::get_communication_tracking_info</a>(<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j)<span class="keyword"> const</span>
<a name="l01376"></a>01376 <span class="keyword"></span>{
<a name="l01377"></a>01377   <span class="keywordflow">return</span> ( <a class="code" href="classStatistiques.html#ab06bd0468225719a0aa8b83960445575">stat_internals</a> -&gt; communication_tracking_info[i][j]);
<a name="l01378"></a>01378 }
<a name="l01379"></a>01379 
<a name="l01380"></a><a class="code" href="classStat__Results.html#a3a05bd3af5a7f6eac5d08c7cd4cdf3e8">01380</a> <span class="keywordtype">void</span> <a class="code" href="classStat__Results.html#a3a05bd3af5a7f6eac5d08c7cd4cdf3e8">Stat_Results::compute_min_max_avg</a>()
<a name="l01381"></a>01381 {
<a name="l01382"></a>01382   <span class="keyword">const</span> <span class="keywordtype">int</span> nproc = <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l01383"></a>01383   <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> tmp(3);
<a name="l01384"></a>01384 <span class="comment">// Min</span>
<a name="l01385"></a>01385   tmp(0)=<a class="code" href="classStat__Results.html#a9ac46c2ac7225154b6893ac453e214ef">time</a>;
<a name="l01386"></a>01386   tmp(1)=<a class="code" href="classStat__Results.html#a616f30fa3456aa88ed6b4c3f07c3f3d9">count</a>;
<a name="l01387"></a>01387   tmp(2)=<a class="code" href="classStat__Results.html#affd1c9ac470125e25e499ca637e94f94">quantity</a>;
<a name="l01388"></a>01388   <a class="code" href="communications_8cpp.html#aba41fffdc595094c8dfb819a44ca3f0a">mp_min_for_each_item</a>(tmp);
<a name="l01389"></a>01389   <a class="code" href="classStat__Results.html#adf949d6c6658bccf46a263be04686a7a">min_time</a> = tmp(0);
<a name="l01390"></a>01390   <a class="code" href="classStat__Results.html#a62ed408ed837866dad9f23c9c9d23876">min_count</a> = tmp(1);
<a name="l01391"></a>01391   <a class="code" href="classStat__Results.html#a0b52525cdfb7f79c065734d230ee3a83">min_quantity</a> = tmp(2);
<a name="l01392"></a>01392 
<a name="l01393"></a>01393 <span class="comment">// Max</span>
<a name="l01394"></a>01394   tmp(0)=<a class="code" href="classStat__Results.html#a9ac46c2ac7225154b6893ac453e214ef">time</a>;
<a name="l01395"></a>01395   tmp(1)=<a class="code" href="classStat__Results.html#a616f30fa3456aa88ed6b4c3f07c3f3d9">count</a>;
<a name="l01396"></a>01396   tmp(2)=<a class="code" href="classStat__Results.html#affd1c9ac470125e25e499ca637e94f94">quantity</a>;
<a name="l01397"></a>01397   <a class="code" href="communications_8cpp.html#aafa4a4611353c452208f47a6e4381488">mp_max_for_each_item</a>(tmp);
<a name="l01398"></a>01398   <a class="code" href="classStat__Results.html#a94dd53d2de3c447c34b5ed4d7c5aae25">max_time</a> = tmp(0);
<a name="l01399"></a>01399   <a class="code" href="classStat__Results.html#a75a8974bd6d2cb5f01f4cc9ad3d5b8cd">max_count</a> = tmp(1);
<a name="l01400"></a>01400   <a class="code" href="classStat__Results.html#aec36e8a11ca9889123bc5fc53d28b3ea">max_quantity</a> = tmp(2);
<a name="l01401"></a>01401 
<a name="l01402"></a>01402 <span class="comment">// Average</span>
<a name="l01403"></a>01403   tmp(0)=<a class="code" href="classStat__Results.html#a9ac46c2ac7225154b6893ac453e214ef">time</a>;
<a name="l01404"></a>01404   tmp(1)=<a class="code" href="classStat__Results.html#a616f30fa3456aa88ed6b4c3f07c3f3d9">count</a>;
<a name="l01405"></a>01405   tmp(2)=<a class="code" href="classStat__Results.html#affd1c9ac470125e25e499ca637e94f94">quantity</a>;
<a name="l01406"></a>01406   <a class="code" href="communications_8cpp.html#a5f15b8a5c15449d3277ff3cde06fa68a">mp_sum_for_each_item</a>(tmp);
<a name="l01407"></a>01407   <a class="code" href="classStat__Results.html#a95d9ababbcf6e244207d7bec0ca67e84">avg_time</a> = tmp(0) / nproc;
<a name="l01408"></a>01408   <a class="code" href="classStat__Results.html#ac0bc2b3429e4545adcbb753c3edcdb44">avg_count</a> = tmp(1) / nproc;
<a name="l01409"></a>01409   <a class="code" href="classStat__Results.html#a26d15e661803c10b0be24f02b5b6f978">avg_quantity</a> = tmp(2) / nproc;
<a name="l01410"></a>01410 }
<a name="l01411"></a>01411 
<a name="l01412"></a>01412 
<a name="l01413"></a>01413 
<a name="l01414"></a>01414 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:28 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
