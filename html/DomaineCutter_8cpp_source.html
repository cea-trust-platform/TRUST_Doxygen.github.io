<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/Kernel/Geometrie/DomaineCutter.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/Kernel/Geometrie/DomaineCutter.cpp</div>  </div>
</div>
<div class="contents">
<a href="DomaineCutter_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (c) 2021, CEA</span>
<a name="l00003"></a>00003 <span class="comment">* All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment">* 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00007"></a>00007 <span class="comment">* 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00008"></a>00008 <span class="comment">* 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<a name="l00011"></a>00011 <span class="comment">* IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;</span>
<a name="l00012"></a>00012 <span class="comment">* OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// File:        DomaineCutter.cpp</span>
<a name="l00018"></a>00018 <span class="comment">// Directory:   $TRUST_ROOT/src/Kernel/Geometrie</span>
<a name="l00019"></a>00019 <span class="comment">// Version:     /main/26</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;<a class="code" href="DomaineCutter_8h.html">DomaineCutter.h</a>&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="ArrOfBit_8h.html">ArrOfBit.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="Domaine_8h.html">Domaine.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="Connectivite__som__elem_8h.html">Connectivite_som_elem.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="SFichierBin_8h.html">SFichierBin.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="Array__tools_8h.html">Array_tools.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="Scatter_8h.html">Scatter.h</a>&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;<a class="code" href="Vect__ArrOfInt_8h.html">Vect_ArrOfInt.h</a>&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;<a class="code" href="Sous__Zone_8h.html">Sous_Zone.h</a>&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;<a class="code" href="Sparskit_8h.html">Sparskit.h</a>&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;<a class="code" href="Poly__geom__base_8h.html">Poly_geom_base.h</a>&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;<a class="code" href="Sortie__Brute_8h.html">Sortie_Brute.h</a>&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;<a class="code" href="IntVect_8h.html">IntVect.h</a>&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;<a class="code" href="FichierHDFPar_8h.html">FichierHDFPar.h</a>&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;<a class="code" href="communications_8h.html">communications.h</a>&gt;</span>
<a name="l00038"></a>00038 
<a name="l00039"></a><a class="code" href="DomaineCutter_8cpp.html#a9049ebf5e07a2e8a81abb3af73ffac66">00039</a> <a class="code" href="Declare__Inst_8h.html#afcab3f7633508e92f2077d767e19bc60">Implemente_instanciable_sans_constructeur</a>(<a class="code" href="classDomaineCutter.html" title="Classe outil permettant de generer des sous-domaines pour un calcul parallele a partir d&#39;un domaine d...">DomaineCutter</a>,<span class="stringliteral">&quot;DomaineCutter&quot;</span>,<a class="code" href="classObjet__U.html" title="classe Objet_U Cette classe est la classe de base des Objets de TRUST Dans les classes derivees de Ob...">Objet_U</a>);
<a name="l00040"></a>00040 <span class="comment"></span>
<a name="l00041"></a>00041 <span class="comment">//! Appel invalide. exit.</span>
<a name="l00042"></a><a class="code" href="classDomaineCutter.html#a730003ff4a1d8213ab32049817336697">00042</a> <span class="comment"></span><span class="keyword">const</span> <a class="code" href="classDomaineCutter.html" title="Classe outil permettant de generer des sous-domaines pour un calcul parallele a partir d&#39;un domaine d...">DomaineCutter</a>&amp; <a class="code" href="classDomaineCutter.html#a730003ff4a1d8213ab32049817336697" title="Appel invalide. exit.">DomaineCutter::operator=</a>(<span class="keyword">const</span> <a class="code" href="classDomaineCutter.html" title="Classe outil permettant de generer des sous-domaines pour un calcul parallele a partir d&#39;un domaine d...">DomaineCutter</a>&amp; dc)
<a name="l00043"></a>00043 {
<a name="l00044"></a>00044   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00045"></a>00045   <span class="keywordflow">return</span> *<span class="keyword">this</span>; <span class="comment">//!&lt; pour le compilateur</span>
<a name="l00046"></a>00046 <span class="comment"></span>}
<a name="l00047"></a>00047 <span class="comment"></span>
<a name="l00048"></a>00048 <span class="comment">//! Appel invalide. exit.</span>
<a name="l00049"></a><a class="code" href="classDomaineCutter.html#a095f50f81778d6e78fd0c71f45b63340">00049</a> <span class="comment"></span><a class="code" href="classDomaineCutter.html#a0bbc973c7219042f38b13b7db0f00afe" title="Constructeur par defaut (structure vide)">DomaineCutter::DomaineCutter</a>(<span class="keyword">const</span> <a class="code" href="classDomaineCutter.html" title="Classe outil permettant de generer des sous-domaines pour un calcul parallele a partir d&#39;un domaine d...">DomaineCutter</a>&amp; dc): <a class="code" href="classObjet__U.html" title="classe Objet_U Cette classe est la classe de base des Objets de TRUST Dans les classes derivees de Ob...">Objet_U</a>(dc)
<a name="l00050"></a>00050 {
<a name="l00051"></a>00051   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00052"></a>00052 }
<a name="l00053"></a>00053 <span class="comment"></span>
<a name="l00054"></a>00054 <span class="comment">//! Appel invalide. exit.</span>
<a name="l00055"></a><a class="code" href="classDomaineCutter.html#a22fd81987dad44caafd02ce43815c9d5">00055</a> <span class="comment"></span><a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classDomaineCutter.html#a22fd81987dad44caafd02ce43815c9d5" title="Appel invalide. exit.">DomaineCutter::printOn</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os)<span class="keyword"> const</span>
<a name="l00056"></a>00056 <span class="keyword"></span>{
<a name="l00057"></a>00057   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error : DomaineCutter::printOn should not be used.&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00058"></a>00058   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00059"></a>00059   <span class="keywordflow">return</span> os; <span class="comment">//!&lt; pour le compilateur</span>
<a name="l00060"></a>00060 <span class="comment"></span>}
<a name="l00061"></a>00061 <span class="comment"></span>
<a name="l00062"></a>00062 <span class="comment">//! Appel invalide. exit.</span>
<a name="l00063"></a><a class="code" href="classDomaineCutter.html#a03d30ce2cf6a1da0a73ee068b4e85fec">00063</a> <span class="comment"></span><a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classDomaineCutter.html#a03d30ce2cf6a1da0a73ee068b4e85fec" title="Appel invalide. exit.">DomaineCutter::readOn</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; s)
<a name="l00064"></a>00064 {
<a name="l00065"></a>00065   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error : DomaineCutter::readOn should not be used.&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00066"></a>00066   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00067"></a>00067   <span class="keywordflow">return</span> s; <span class="comment">//!&lt; pour le compilateur</span>
<a name="l00068"></a>00068 <span class="comment"></span>}
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 <span class="comment">//</span>
<a name="l00071"></a>00071 <span class="comment">//</span>
<a name="l00072"></a>00072 <span class="comment">//</span>
<a name="l00073"></a>00073 <span class="comment">//</span>
<a name="l00074"></a>00074 <span class="comment">//</span>
<a name="l00075"></a>00075 <span class="comment">//</span>
<a name="l00076"></a>00076 <span class="comment">//</span>
<a name="l00077"></a>00077 <span class="comment">//</span>
<a name="l00078"></a>00078 <span class="comment">//</span>
<a name="l00079"></a>00079 <span class="comment">//</span>
<a name="l00080"></a>00080 <span class="comment">//</span>
<a name="l00081"></a>00081 <span class="comment">//</span>
<a name="l00082"></a>00082 <span class="comment">//</span>
<a name="l00083"></a>00083 <span class="comment">//</span>
<a name="l00084"></a>00084 <span class="comment">//</span>
<a name="l00085"></a>00085 <span class="comment">//</span>
<a name="l00086"></a>00086 <span class="comment">//</span>
<a name="l00087"></a>00087 <span class="comment">//</span>
<a name="l00088"></a>00088 <span class="comment">//</span>
<a name="l00089"></a>00089 <span class="comment">//</span><span class="comment"></span>
<a name="l00090"></a>00090 <span class="comment">//! Creation de la liste des sommets du sous-domaine &quot;partie&quot;.&lt;br&gt;C&#39;est l&#39;ensemble des sommets des elements appartenant a ce sous-domaine.&lt;br&gt;On ne traite que les elements reels.&lt;br&gt;Parametre:     nb_sommets&lt;br&gt;Signification: nombre de sommets de la zone globale&lt;br&gt;Parametre:     les_elems&lt;br&gt;Signification  tableau des elements de la zone globale (pour chaque element, numeros de ses sommets)&lt;br&gt;Parametre:     elem_part&lt;br&gt;Signification: tableau de decoupage (pour chaque element i du domaine global,&lt;br&gt;elem_part[i] est le numero du sous-domaine auquel il est affecte)&lt;br&gt;Parametre:     partie&lt;br&gt;Signification: le numero du sous-domaine a construire&lt;br&gt;Parametre:     liste_sommets&lt;br&gt;Signification: en sortie : liste des sommets du sous-domaine: liste_sommets[i] est&lt;br&gt;l&#39;indice dans la zone_globale du i-ieme sommet du sous-domaine.&lt;br&gt;Les indices sont classes dans l&#39;ordre croissant.&lt;br&gt;Parametre:     liste_inverse_sommets&lt;br&gt;Signification: en sortie : on lui donne la taille nb_sommets et on l&#39;initialise.&lt;br&gt;liste_inverse_sommet[i] est l&#39;indice du sommet dans le sous-domaine&lt;br&gt;ou -1 si le sommet i n&#39;est pas dans le sous-domaine)</span>
<a name="l00091"></a><a class="code" href="DomaineCutter_8cpp.html#a864ba9bfc1dd181f22111636ac9cd45d">00091</a> <span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="DomaineCutter_8cpp.html#a864ba9bfc1dd181f22111636ac9cd45d" title="Creation de la liste des sommets du sous-domaine &quot;partie&quot;. C&#39;est l&#39;ensemble des sommets des element...">construire_liste_sommets_sousdomaine</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> nb_sommets,
<a name="l00092"></a>00092                                                  <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; les_elems,
<a name="l00093"></a>00093                                                  <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; liste_elements,
<a name="l00094"></a>00094                                                  <span class="keyword">const</span> <span class="keywordtype">int</span> i_part,
<a name="l00095"></a>00095                                                  <span class="keyword">const</span> <a class="code" href="classStatic__Int__Lists.html" title="Cette classe permet de stocker des listes d&#39;entiers accessibles en temps constant. La taille des listes ne peut pas changer sans perdre le contenu (ce sont des listes statiques). Exemple: Static_Int_List l; ArrOfInt tailles(3); tailles[0] = 2; tailles[1] = 3; tailles[2] = 0; // On reserve la memoire pour trois listes de taille 2, 3 et 0: l.set_list_sizes(tailles); // On affecte une valeur au deuxieme element de la premiere liste: l.set_value(0,1,765); // Affiche la valeur Cout &lt;&lt; l(0,1);.">Static_Int_Lists</a> *som_raccord,
<a name="l00096"></a>00096                                                  <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; liste_sommets,
<a name="l00097"></a>00097                                                  <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; liste_inverse_sommets)
<a name="l00098"></a>00098 {
<a name="l00099"></a>00099   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_elem_part = liste_elements.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00100"></a>00100   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_sommets_par_element = les_elems.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1);
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 <span class="comment">// Algorithme : on parcourt les elements: pour les elements de la partie,</span>
<a name="l00103"></a>00103 <span class="comment">// on marque les sommets de l&#39;element par un drapeau.</span>
<a name="l00104"></a>00104 <span class="comment">// Puis on fait une boucle sur les sommets, et ceux dont le drapeau</span>
<a name="l00105"></a>00105 <span class="comment">// est mis sont mis dans la liste.</span>
<a name="l00106"></a>00106 
<a name="l00107"></a>00107 <span class="comment">// D&#39;abord, on compte les sommets de la partie et on</span>
<a name="l00108"></a>00108 <span class="comment">// remplit drapeau_sommet</span>
<a name="l00109"></a>00109   <a class="code" href="classArrOfBit.html">ArrOfBit</a> drapeau_sommet(nb_sommets);
<a name="l00110"></a>00110 
<a name="l00111"></a>00111   drapeau_sommet = 0;
<a name="l00112"></a>00112 <span class="comment">// Nombre de sommets de la partie &quot;part&quot;</span>
<a name="l00113"></a>00113   <span class="keywordtype">int</span> nb_sommets_part = 0;
<a name="l00114"></a>00114   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_elem = 0; i_elem &lt; nb_elem_part; i_elem++)
<a name="l00115"></a>00115     {
<a name="l00116"></a>00116       <span class="keyword">const</span> <span class="keywordtype">int</span> elem = liste_elements[i_elem];
<a name="l00117"></a>00117       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; nb_sommets_par_element; j++)
<a name="l00118"></a>00118         {
<a name="l00119"></a>00119           <span class="keywordtype">int</span> sommet = les_elems(elem, j);
<a name="l00120"></a>00120           <span class="keywordflow">if</span> (sommet&gt;-1)
<a name="l00121"></a>00121             {
<a name="l00122"></a>00122               <span class="keywordtype">int</span> bit = drapeau_sommet.<a class="code" href="classArrOfBit.html#a68b08edd2eebc91e7bd7d34ec81f6cd2" title="Renvoie la valeur du bit e, puis met le bit e a 1.">testsetbit</a>(sommet);
<a name="l00123"></a>00123 <span class="comment">// Si le drapeau n&#39;etait pas mis, cela fait un sommet de plus</span>
<a name="l00124"></a>00124               <span class="keywordflow">if</span> (! bit)
<a name="l00125"></a>00125                 nb_sommets_part++;
<a name="l00126"></a>00126             }
<a name="l00127"></a>00127         }
<a name="l00128"></a>00128     }
<a name="l00129"></a>00129 <span class="comment">// sommets a ajouter a cause de som_raccord</span>
<a name="l00130"></a>00130   <span class="keywordflow">if</span> (som_raccord) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> s = 0; s &lt; som_raccord-&gt;<a class="code" href="classStatic__Int__Lists.html#a5872636466919b2cb8efe715c315d7ca" title="renvoie le nombre de listes stockees">get_nb_lists</a>(); s++)
<a name="l00131"></a>00131       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; som_raccord-&gt;<a class="code" href="classStatic__Int__Lists.html#adbf6903737c3c30bf87e05b29f5a5b56" title="renvoie le nombre d&#39;elements de la liste i">get_list_size</a>(s); i++)
<a name="l00132"></a>00132         <span class="keywordflow">if</span> ((*som_raccord)(s, i) == i_part &amp;&amp; !drapeau_sommet.<a class="code" href="classArrOfBit.html#a68b08edd2eebc91e7bd7d34ec81f6cd2" title="Renvoie la valeur du bit e, puis met le bit e a 1.">testsetbit</a>(s)) <span class="comment">//le sommet est demande par ce proc</span>
<a name="l00133"></a>00133           nb_sommets_part++; <span class="comment">//si on ne l&#39;a pas deja, on le rajoute</span>
<a name="l00134"></a>00134 
<a name="l00135"></a>00135 <span class="comment">// Remplissage de liste_sommets et liste_inverse_sommets</span>
<a name="l00136"></a>00136   liste_sommets.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(0); <span class="comment">//!&lt; On oublie les valeurs precedentes</span>
<a name="l00137"></a>00137 <span class="comment"></span>  liste_sommets.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(nb_sommets_part);
<a name="l00138"></a>00138 
<a name="l00139"></a>00139   liste_inverse_sommets.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(0); <span class="comment">//!&lt; On oublie les valeurs precedentes</span>
<a name="l00140"></a>00140 <span class="comment"></span>  liste_inverse_sommets.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(nb_sommets,<a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ffaf6ae9ba7eb51c5f298ce693345b3ec68">Array_base::NOCOPY_NOINIT</a>);
<a name="l00141"></a>00141   liste_inverse_sommets = -1;
<a name="l00142"></a>00142 
<a name="l00143"></a>00143   <span class="keywordtype">int</span> n = 0;
<a name="l00144"></a>00144   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_sommets; i++)
<a name="l00145"></a>00145     {
<a name="l00146"></a>00146       <span class="keywordflow">if</span> (drapeau_sommet[i])
<a name="l00147"></a>00147         {
<a name="l00148"></a>00148           liste_sommets[n] = i;
<a name="l00149"></a>00149           liste_inverse_sommets[i] = n;
<a name="l00150"></a>00150           n++;
<a name="l00151"></a>00151         }
<a name="l00152"></a>00152     }
<a name="l00153"></a>00153 }
<a name="l00154"></a>00154 
<a name="l00155"></a>00155 <span class="comment">// Remplissage du tableau des coordonnees des sommets d&#39;une partie</span>
<a name="l00156"></a>00156 <span class="comment">// a partir des coordonnees des sommets du domaine complet (sommets_glob)</span>
<a name="l00157"></a>00157 <span class="comment">// et de la liste des sommets de la partie (liste_sommets)</span>
<a name="l00158"></a>00158 <span class="comment">// On cree sommets_loc comme suit:</span>
<a name="l00159"></a>00159 <span class="comment">// sommets_loc.dimension(0) = liste_sommets.size_array()</span>
<a name="l00160"></a>00160 <span class="comment">// sommets_loc.dimension(1) = sommets_glob.dimension(1)</span>
<a name="l00161"></a>00161 <span class="comment">// </span>
<a name="l00162"></a>00162 <span class="comment">// Parametre:     sommets_glob</span>
<a name="l00163"></a>00163 <span class="comment">// Signification: les coordonnees des sommets du domaine global</span>
<a name="l00164"></a>00164 <span class="comment">// Parametre:     liste_sommets</span>
<a name="l00165"></a>00165 <span class="comment">// Signification: les indices des sommets de sommets_glob a copier</span>
<a name="l00166"></a>00166 <span class="comment">// dans sommets_loc.</span>
<a name="l00167"></a><a class="code" href="DomaineCutter_8cpp.html#adf74c004dd180d3a955e02b71acd8c52">00167</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="DomaineCutter_8cpp.html#adf74c004dd180d3a955e02b71acd8c52">remplir_coordsommets_sous_domaine</a>(<span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; sommets_glob,
<a name="l00168"></a>00168                                               <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; liste_sommets,
<a name="l00169"></a>00169                                               <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; sommets_loc)
<a name="l00170"></a>00170 {
<a name="l00171"></a>00171   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_som = liste_sommets.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00172"></a>00172   <span class="keyword">const</span> <span class="keywordtype">int</span> dim = sommets_glob.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1);
<a name="l00173"></a>00173   sommets_loc.<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(nb_som, dim);
<a name="l00174"></a>00174 
<a name="l00175"></a>00175   <span class="keywordtype">int</span> i;
<a name="l00176"></a>00176   <span class="keywordflow">for</span> (i = 0; i &lt; nb_som; i++)
<a name="l00177"></a>00177     {
<a name="l00178"></a>00178       <span class="keywordtype">int</span> indice = liste_sommets[i];
<a name="l00179"></a>00179       <span class="keywordtype">int</span> j;
<a name="l00180"></a>00180       <span class="keywordflow">for</span> (j = 0; j &lt; dim; j++)
<a name="l00181"></a>00181         sommets_loc(i, j) = sommets_glob(indice, j);
<a name="l00182"></a>00182     }
<a name="l00183"></a>00183 }
<a name="l00184"></a>00184 
<a name="l00185"></a>00185 <span class="comment">// Construction du tableau elems des elements de la partie &quot;part&quot;.</span>
<a name="l00186"></a>00186 <span class="comment">// elems(i, j) sera le nouveau numero du sommet j de l&#39;element i</span>
<a name="l00187"></a>00187 <span class="comment">// dans la partie part. On utilise la liste_inverse pour obtenir les</span>
<a name="l00188"></a>00188 <span class="comment">// nouveaux numeros des sommets.</span>
<a name="l00189"></a>00189 <span class="comment">// Les elements du domaine local sont crees dans l&#39;ordre croissant de</span>
<a name="l00190"></a>00190 <span class="comment">// leur indice dans la zone globale.</span>
<a name="l00191"></a>00191 
<a name="l00192"></a><a class="code" href="DomaineCutter_8cpp.html#a0182ac071592d0b622994493f6c2a9a3">00192</a> <span class="keywordtype">void</span> <a class="code" href="DomaineCutter_8cpp.html#a0182ac071592d0b622994493f6c2a9a3">construire_elems_sous_domaine</a>(<span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp;    elems_zone_globale,
<a name="l00193"></a>00193                                    <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; liste_elements,
<a name="l00194"></a>00194                                    <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; liste_inverse_sommets,
<a name="l00195"></a>00195                                    <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp;    elems_zone_locale,
<a name="l00196"></a>00196                                    <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; liste_inverse_elements)
<a name="l00197"></a>00197 {
<a name="l00198"></a>00198   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_elem_tot                = elems_zone_globale.<a class="code" href="classIntTab.html#a71e9b9ddc1793094b1b3f109377952b1" title="Returns the total dimensions of the multi-dimensionnal array, including virtual items (used in parall...">dimension_tot</a>(0);
<a name="l00199"></a>00199   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_sommets_par_element = elems_zone_globale.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1);
<a name="l00200"></a>00200 
<a name="l00201"></a>00201   liste_inverse_elements.<a class="code" href="classArrOfInt.html#a15fc7e3958f02cb38d3106eeb919f6fc" title="appel a ArrOfInt::resize_array()">resize</a>(nb_elem_tot,<a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ffaf6ae9ba7eb51c5f298ce693345b3ec68">Array_base::NOCOPY_NOINIT</a>);
<a name="l00202"></a>00202   liste_inverse_elements = -1;
<a name="l00203"></a>00203 
<a name="l00204"></a>00204 <span class="comment">// Premier passage: comptage du nombre d&#39;elements de la partie</span>
<a name="l00205"></a>00205   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_elem_part = liste_elements.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00206"></a>00206   elems_zone_locale.<a class="code" href="classIntTab.html#a22e6bed6826b3688d4d0181cbf3b7a38" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(nb_elem_part, nb_sommets_par_element);
<a name="l00207"></a>00207 
<a name="l00208"></a>00208 <span class="comment">// Deuxieme passage: remplissage du tableau</span>
<a name="l00209"></a>00209   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_elem = 0; i_elem &lt; nb_elem_part; i_elem++)
<a name="l00210"></a>00210     {
<a name="l00211"></a>00211       <span class="keywordtype">int</span> elem = liste_elements[i_elem];
<a name="l00212"></a>00212 
<a name="l00213"></a>00213 <span class="comment">// Nouveau numero de l&#39;element dans la partie</span>
<a name="l00214"></a>00214       liste_inverse_elements[elem] = i_elem;
<a name="l00215"></a>00215 <span class="comment">// Copie de l&#39;element avec traduction du numero des sommets en</span>
<a name="l00216"></a>00216 <span class="comment">// numero local dans le sous-domaine</span>
<a name="l00217"></a>00217       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_sommets_par_element; i++)
<a name="l00218"></a>00218         {
<a name="l00219"></a>00219           <span class="keywordtype">int</span> sommet = elems_zone_globale(elem, i);
<a name="l00220"></a>00220           <span class="keywordflow">if</span> (sommet&lt;0)
<a name="l00221"></a>00221             elems_zone_locale(i_elem, i) =sommet;
<a name="l00222"></a>00222           <span class="keywordflow">else</span>
<a name="l00223"></a>00223             {
<a name="l00224"></a>00224               <span class="keywordtype">int</span> new_num = liste_inverse_sommets[sommet];
<a name="l00225"></a>00225               assert(new_num &gt;= 0);
<a name="l00226"></a>00226               elems_zone_locale(i_elem, i) = new_num;
<a name="l00227"></a>00227             }
<a name="l00228"></a>00228         }
<a name="l00229"></a>00229     }
<a name="l00230"></a>00230 }
<a name="l00231"></a>00231 
<a name="l00232"></a>00232 <span class="comment">//</span>
<a name="l00233"></a>00233 <span class="comment">//</span>
<a name="l00234"></a>00234 <span class="comment">//</span>
<a name="l00235"></a>00235 <span class="comment">//</span>
<a name="l00236"></a>00236 <span class="comment">//</span>
<a name="l00237"></a>00237 <span class="comment">//</span>
<a name="l00238"></a>00238 <span class="comment">//</span>
<a name="l00239"></a>00239 <span class="comment">//</span>
<a name="l00240"></a>00240 <span class="comment">//</span>
<a name="l00241"></a>00241 <span class="comment">//</span>
<a name="l00242"></a>00242 <span class="comment">//</span>
<a name="l00243"></a>00243 <span class="comment">//</span><span class="comment"></span>
<a name="l00244"></a>00244 <span class="comment">//! Pour une liste de &quot;faces&quot; de la zone globale, compter le nombre de&lt;br&gt;faces incluses dans la partie &quot;part&quot; et les copier dans la structure&lt;br&gt;faces_partie en remplacant les numeros de sommets par les numeros locaux&lt;br&gt;dans le sous-domaine.&lt;br&gt;L&#39;ordre des faces est conserve (si une face apparait avant une autre dans&lt;br&gt;la liste du domaine complet et si elles sont toutes les deux dans la sous-partie,&lt;br&gt;alors leur ordre est conserve). C&#39;est important pour le periodique&lt;br&gt;(hypothese qu&#39;il y a correspondance entre la face i et la face i+n/2 du bord&lt;br&gt;periodique).&lt;br&gt;Attention: la condition pour qu&#39;une face soit incluse est &quot;la face appartient&lt;br&gt;a un element de la partie voisine&quot;. La condition &quot;les sommets des faces sont&lt;br&gt;des sommets de joint&quot; n&#39;est PAS suffisante.</span>
<a name="l00245"></a><a class="code" href="DomaineCutter_8cpp.html#a343028ad4896bd87bade3f9076b098b5">00245</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="DomaineCutter_8cpp.html#a343028ad4896bd87bade3f9076b098b5" title="Pour une liste de &quot;faces&quot; de la zone globale, compter le nombre de faces incluses dans la partie &quot;...">construire_liste_faces_sous_domaine</a>(<span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; elements_voisins,
<a name="l00246"></a>00246                                          <span class="keyword">const</span> <a class="code" href="classIntVect.html">IntVect</a>&amp; elem_part,
<a name="l00247"></a>00247                                          <span class="keyword">const</span> <span class="keywordtype">int</span>     partie,
<a name="l00248"></a>00248                                          <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp;    faces_sommets,
<a name="l00249"></a>00249                                          <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; liste_inverse_sommets,
<a name="l00250"></a>00250                                          <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; faces_sommets_partie)
<a name="l00251"></a>00251 {
<a name="l00252"></a>00252   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_faces = faces_sommets.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00253"></a>00253   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_sommets_par_face = faces_sommets.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1);
<a name="l00254"></a>00254   <span class="keywordtype">int</span> i;
<a name="l00255"></a>00255 
<a name="l00256"></a>00256   assert(elements_voisins.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>() == nb_faces);
<a name="l00257"></a>00257 <span class="comment">// La liste des faces du tableau faces_sommets a inclure dans le sous-domaine</span>
<a name="l00258"></a>00258   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> liste_faces;
<a name="l00259"></a>00259   liste_faces.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1); <span class="comment">//!&lt; Pour faire append_array...</span>
<a name="l00260"></a>00260 <span class="comment"></span>
<a name="l00261"></a>00261 <span class="comment">// Premier passage : on cherche les faces a inclure</span>
<a name="l00262"></a>00262   {
<a name="l00263"></a>00263     <span class="keywordflow">for</span> (i = 0; i &lt; nb_faces; i++)
<a name="l00264"></a>00264       {
<a name="l00265"></a>00265         <span class="keywordtype">int</span> elem = elements_voisins[i];
<a name="l00266"></a>00266         <span class="keyword">const</span> <span class="keywordtype">int</span> part = elem_part[elem];
<a name="l00267"></a>00267         <span class="keywordflow">if</span> (part == partie)
<a name="l00268"></a>00268           liste_faces.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(i);
<a name="l00269"></a>00269       }
<a name="l00270"></a>00270   }
<a name="l00271"></a>00271 
<a name="l00272"></a>00272   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_faces_part = liste_faces.size_array();
<a name="l00273"></a>00273   faces_sommets_partie.<a class="code" href="classIntTab.html#a22e6bed6826b3688d4d0181cbf3b7a38" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(nb_faces_part, nb_sommets_par_face);
<a name="l00274"></a>00274 
<a name="l00275"></a>00275 <span class="comment">// Deuxieme passage : stockage des faces et conversion des numeros</span>
<a name="l00276"></a>00276 <span class="comment">// de sommets des faces en numeros locaux dans le sous-domaine.</span>
<a name="l00277"></a>00277   <span class="keywordflow">for</span> (i = 0; i &lt; nb_faces_part; i++)
<a name="l00278"></a>00278     {
<a name="l00279"></a>00279       <span class="keyword">const</span> <span class="keywordtype">int</span> i_face = liste_faces[i];
<a name="l00280"></a>00280       <span class="keywordtype">int</span> j;
<a name="l00281"></a>00281       <span class="keywordflow">for</span> (j = 0; j &lt; nb_sommets_par_face; j++)
<a name="l00282"></a>00282         {
<a name="l00283"></a>00283           <span class="keywordtype">int</span> sommet = faces_sommets(i_face, j);
<a name="l00284"></a>00284           <span class="keywordflow">if</span> (sommet&gt;-1)
<a name="l00285"></a>00285             {
<a name="l00286"></a>00286               <span class="keywordtype">int</span> new_num = liste_inverse_sommets[sommet];
<a name="l00287"></a>00287               assert(new_num &gt;= 0);
<a name="l00288"></a>00288               faces_sommets_partie(i, j) = new_num;
<a name="l00289"></a>00289             }
<a name="l00290"></a>00290           <span class="keywordflow">else</span>
<a name="l00291"></a>00291             faces_sommets_partie(i, j) = -1;
<a name="l00292"></a>00292         }
<a name="l00293"></a>00293     }
<a name="l00294"></a>00294 }
<a name="l00295"></a>00295 
<a name="l00296"></a>00296 <span class="comment">// Pour les trois fonctions suivantes :</span>
<a name="l00297"></a>00297 <span class="comment">// Remplissage des frontieres de la partie associee a un processeur.</span>
<a name="l00298"></a><a class="code" href="classDomaineCutter.html#a2a1da80e63599c4e43955a05e24d4ce7">00298</a> <span class="keywordtype">void</span> <a class="code" href="classDomaineCutter.html#a2a1da80e63599c4e43955a05e24d4ce7">DomaineCutter::construire_faces_bords_ssdom</a>(<span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; liste_inverse_sommets,
<a name="l00299"></a>00299                                                  <span class="keyword">const</span> <span class="keywordtype">int</span> partie,
<a name="l00300"></a>00300                                                  <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone_partie)<span class="keyword"> const</span>
<a name="l00301"></a>00301 <span class="keyword"></span>{
<a name="l00302"></a>00302   <span class="keyword">const</span> <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone = <a class="code" href="classDomaineCutter.html#afceb976e349529db27883bdf2a52d60c">ref_domaine_</a>.<a class="code" href="classRef__Domaine.html#a89e1c374ada79faa2c7e9a76c3393ad8">valeur</a>().<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0);
<a name="l00303"></a>00303   <a class="code" href="List_8h.html#add189d7375e577842ac891b09afc6d4b">CONST_LIST_CURSEUR</a>(<a class="code" href="classBord.html" title="Classe Bord Cette classe represente un bord d&#39;une zone, c&#39;est un type de frontiere&lt;br&gt;(derive de Fronti...">Bord</a> <span class="comment">/*difference*/</span>) curseur(zone.<a class="code" href="classZone.html#a4bc04163903c004c5c1383eaa5fa844d" title="Renvoie la liste des bords de la zone. (version const)">faces_bord</a>()<span class="comment">/*difference*/</span>);
<a name="l00304"></a>00304   <span class="keywordtype">int</span> i_fr = 0;
<a name="l00305"></a>00305   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> elements_voisins;
<a name="l00306"></a>00306   <span class="keywordflow">for</span> (; curseur; ++curseur)
<a name="l00307"></a>00307     {
<a name="l00308"></a>00308 
<a name="l00309"></a>00309       <span class="keyword">const</span> <a class="code" href="classFrontiere.html" title="Classe Frontiere. Une Frontiere decrit une partie de la frontiere d&#39;une Zone, elle possede un Nom...">Frontiere</a>&amp; frontiere = curseur.valeur();
<a name="l00310"></a>00310       <a class="code" href="classFrontiere.html" title="Classe Frontiere. Une Frontiere decrit une partie de la frontiere d&#39;une Zone, elle possede un Nom...">Frontiere</a>&amp; front_partie =
<a name="l00311"></a>00311         zone_partie.<a class="code" href="classZone.html#a4bc04163903c004c5c1383eaa5fa844d" title="Renvoie la liste des bords de la zone. (version const)">faces_bord</a>()<span class="comment">/*difference*/</span>.<a class="code" href="classList__Bord.html#a61386a2f94d915253bcec812ce0735c3">add</a>(<a class="code" href="classBord.html" title="Classe Bord Cette classe represente un bord d&#39;une zone, c&#39;est un type de frontiere&lt;br&gt;(derive de Fronti...">Bord</a>()<span class="comment">/*difference*/</span>);
<a name="l00312"></a>00312       front_partie.<a class="code" href="classFrontiere.html#a714e3cc26d7e59f3a65d80de23ea21ac" title="Donne un nom a la frontiere.">nommer</a>(frontiere.<a class="code" href="classFrontiere.html#a2868774681d6f050479a95cbc7cd6fc9" title="Renvoie le nom de la frontiere.">le_nom</a>());
<a name="l00313"></a>00313       front_partie.<a class="code" href="classFrontiere.html#af927b5d4fc1fd086ba91e916f61badee" title="Associe la frontiere a la zone dont elle depend.">associer_zone</a>(zone_partie);
<a name="l00314"></a>00314       front_partie.<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a503fe687811445373b75dd8ac0991ec2" title="Type les faces.">typer</a>(frontiere.<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a2fb942d8b2c2f276afa1e6118371b962" title="Renvoie le type des Faces.">type_face</a>());
<a name="l00315"></a>00315       <a class="code" href="classDomaineCutter.html#a396245cb32fa5d410b790146a274d4a8">voisins_bords_</a>.<a class="code" href="classStatic__Int__Lists.html#ac5f80aca1def83653c95221f391b916d" title="copie la i-ieme liste dans le tableau fourni Le tableau array doit etre resizable.">copy_list_to_array</a>(i_fr, elements_voisins);
<a name="l00316"></a>00316       <a class="code" href="DomaineCutter_8cpp.html#a343028ad4896bd87bade3f9076b098b5" title="Pour une liste de &quot;faces&quot; de la zone globale, compter le nombre de faces incluses dans la partie &quot;...">construire_liste_faces_sous_domaine</a>(elements_voisins,
<a name="l00317"></a>00317                                           <a class="code" href="classDomaineCutter.html#a9da3c1aef1b48f6d6566abbee7dbcb85">ref_elem_part_</a>.<a class="code" href="classRef__IntVect.html#a1c7959efd862b8dd91818c78820c31b2">valeur</a>(),
<a name="l00318"></a>00318                                           partie,
<a name="l00319"></a>00319                                           frontiere.<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a07b8d8db9e3d656b93a21a49c063430c">les_sommets</a>(),
<a name="l00320"></a>00320                                           liste_inverse_sommets,
<a name="l00321"></a>00321                                           front_partie.<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a07b8d8db9e3d656b93a21a49c063430c">les_sommets</a>());
<a name="l00322"></a>00322       i_fr++;
<a name="l00323"></a>00323     }
<a name="l00324"></a>00324 }
<a name="l00325"></a>00325 
<a name="l00326"></a>00326 <span class="comment">//</span>
<a name="l00327"></a>00327 <span class="comment">//</span><span class="comment"></span>
<a name="l00328"></a>00328 <span class="comment">//! Constructions des raccords de la sous_partie a partir des raccords&lt;br&gt;du domaine global.&lt;br&gt;Les Raccord_local_homogene sont transformes en Raccord_distant_homogene.</span>
<a name="l00329"></a><a class="code" href="classDomaineCutter.html#a0d823ebe378eb13f8ebe8a95410f6565">00329</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classDomaineCutter.html#a0d823ebe378eb13f8ebe8a95410f6565" title="Constructions des raccords de la sous_partie a partir des raccords du domaine global. Les Raccord_local_homogene sont transformes en Raccord_distant_homogene.">DomaineCutter::construire_faces_raccords_ssdom</a>(<span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; liste_inverse_sommets,
<a name="l00330"></a>00330                                                     <span class="keyword">const</span> <span class="keywordtype">int</span> partie,
<a name="l00331"></a>00331                                                     <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone_partie)<span class="keyword"> const</span>
<a name="l00332"></a>00332 <span class="keyword"></span>{
<a name="l00333"></a>00333   <span class="keyword">const</span> <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone = <a class="code" href="classDomaineCutter.html#afceb976e349529db27883bdf2a52d60c">ref_domaine_</a>.<a class="code" href="classRef__Domaine.html#a89e1c374ada79faa2c7e9a76c3393ad8">valeur</a>().<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0);
<a name="l00334"></a>00334   <a class="code" href="List_8h.html#add189d7375e577842ac891b09afc6d4b">CONST_LIST_CURSEUR</a>(<a class="code" href="classRaccord.html" title="Classe Raccord Classe generique de la hierarchie des raccords, un objet Raccord peut referencer n&#39;imp...">Raccord</a>) curseur(zone.<a class="code" href="classZone.html#ac2a20fe8fa5529c7eefd418b43c0131c" title="Renvoie la liste des racoords de la zone. (version const)">faces_raccord</a>());
<a name="l00335"></a>00335   <span class="keywordtype">int</span> i_fr = zone.<a class="code" href="classZone.html#a7d6ba9a2216d306cb0a0bf3dfff6f170" title="Renvoie le nombre de bords de la zone.">nb_bords</a>();
<a name="l00336"></a>00336   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> elements_voisins;
<a name="l00337"></a>00337   <span class="keywordflow">for</span> (; curseur; ++curseur)
<a name="l00338"></a>00338     {
<a name="l00339"></a>00339 
<a name="l00340"></a>00340       <span class="keyword">const</span> <a class="code" href="classRaccord.html" title="Classe Raccord Classe generique de la hierarchie des raccords, un objet Raccord peut referencer n&#39;imp...">Raccord</a>&amp; raccord = curseur.<a class="code" href="classDeriv__Raccord__base.html#a00893b6e21deda193b9f429651361f14">valeur</a>();
<a name="l00341"></a>00341       <span class="keyword">const</span> <a class="code" href="classFrontiere.html" title="Classe Frontiere. Une Frontiere decrit une partie de la frontiere d&#39;une Zone, elle possede un Nom...">Frontiere</a>&amp; frontiere = raccord.<a class="code" href="classDeriv__Raccord__base.html#a00893b6e21deda193b9f429651361f14">valeur</a>();
<a name="l00342"></a>00342       <a class="code" href="classRaccord.html" title="Classe Raccord Classe generique de la hierarchie des raccords, un objet Raccord peut referencer n&#39;imp...">Raccord</a>&amp; raccord_partie = zone_partie.<a class="code" href="classZone.html#ac2a20fe8fa5529c7eefd418b43c0131c" title="Renvoie la liste des racoords de la zone. (version const)">faces_raccord</a>().<a class="code" href="classList__Raccord.html#ac995f4b0d89ff514917a9a1c5c213fd7">add</a>(<a class="code" href="classRaccord.html" title="Classe Raccord Classe generique de la hierarchie des raccords, un objet Raccord peut referencer n&#39;imp...">Raccord</a>());
<a name="l00343"></a>00343       <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> type_raccord = frontiere.<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>();
<a name="l00344"></a>00344       <span class="keywordflow">if</span> (type_raccord == <span class="stringliteral">&quot;Raccord_local_homogene&quot;</span>)
<a name="l00345"></a>00345         type_raccord = <span class="stringliteral">&quot;Raccord_distant_homogene&quot;</span>;
<a name="l00346"></a>00346       raccord_partie.<a class="code" href="classDeriv__.html#ad1d33400ed15b6ff96579ed82d9e2719" title="Essaie de creer une instance du type &quot;type&quot;. si type n&#39;est pas un type ou type n&#39;est pas instanciab...">typer</a>(type_raccord);
<a name="l00347"></a>00347       <a class="code" href="classFrontiere.html" title="Classe Frontiere. Une Frontiere decrit une partie de la frontiere d&#39;une Zone, elle possede un Nom...">Frontiere</a>&amp; front_partie = raccord_partie.<a class="code" href="classDeriv__Raccord__base.html#a00893b6e21deda193b9f429651361f14">valeur</a>();
<a name="l00348"></a>00348       front_partie.<a class="code" href="classFrontiere.html#a714e3cc26d7e59f3a65d80de23ea21ac" title="Donne un nom a la frontiere.">nommer</a>(frontiere.<a class="code" href="classFrontiere.html#a2868774681d6f050479a95cbc7cd6fc9" title="Renvoie le nom de la frontiere.">le_nom</a>());
<a name="l00349"></a>00349       front_partie.<a class="code" href="classFrontiere.html#af927b5d4fc1fd086ba91e916f61badee" title="Associe la frontiere a la zone dont elle depend.">associer_zone</a>(zone_partie);
<a name="l00350"></a>00350       front_partie.<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a503fe687811445373b75dd8ac0991ec2" title="Type les faces.">typer</a>(frontiere.<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a2fb942d8b2c2f276afa1e6118371b962" title="Renvoie le type des Faces.">type_face</a>());
<a name="l00351"></a>00351       <a class="code" href="classDomaineCutter.html#a396245cb32fa5d410b790146a274d4a8">voisins_bords_</a>.<a class="code" href="classStatic__Int__Lists.html#ac5f80aca1def83653c95221f391b916d" title="copie la i-ieme liste dans le tableau fourni Le tableau array doit etre resizable.">copy_list_to_array</a>(i_fr, elements_voisins);
<a name="l00352"></a>00352       <a class="code" href="DomaineCutter_8cpp.html#a343028ad4896bd87bade3f9076b098b5" title="Pour une liste de &quot;faces&quot; de la zone globale, compter le nombre de faces incluses dans la partie &quot;...">construire_liste_faces_sous_domaine</a>(elements_voisins,
<a name="l00353"></a>00353                                           <a class="code" href="classDomaineCutter.html#a9da3c1aef1b48f6d6566abbee7dbcb85">ref_elem_part_</a>.<a class="code" href="classRef__IntVect.html#a1c7959efd862b8dd91818c78820c31b2">valeur</a>(),
<a name="l00354"></a>00354                                           partie,
<a name="l00355"></a>00355                                           frontiere.<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a07b8d8db9e3d656b93a21a49c063430c">les_sommets</a>(),
<a name="l00356"></a>00356                                           liste_inverse_sommets,
<a name="l00357"></a>00357                                           front_partie.<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a07b8d8db9e3d656b93a21a49c063430c">les_sommets</a>());
<a name="l00358"></a>00358       i_fr++;
<a name="l00359"></a>00359     }
<a name="l00360"></a>00360 }
<a name="l00361"></a>00361 
<a name="l00362"></a><a class="code" href="classDomaineCutter.html#aba35bd15f234dc72046ca3281e47afbc">00362</a> <span class="keywordtype">void</span> <a class="code" href="classDomaineCutter.html#aba35bd15f234dc72046ca3281e47afbc">DomaineCutter::construire_faces_internes_ssdom</a>(<span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; liste_inverse_sommets,
<a name="l00363"></a>00363                                                     <span class="keyword">const</span> <span class="keywordtype">int</span> partie,
<a name="l00364"></a>00364                                                     <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone_partie)<span class="keyword"> const</span>
<a name="l00365"></a>00365 <span class="keyword"></span>{
<a name="l00366"></a>00366 <span class="comment">// Rappel : les faces internes sont des &quot;frontieres&quot; a l&#39;interieur du domaine</span>
<a name="l00367"></a>00367 <span class="comment">// (par exemple une plaque d&#39;epaisseur nulle dans l&#39;ecoulement)</span>
<a name="l00368"></a>00368   <span class="keyword">const</span> <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone = <a class="code" href="classDomaineCutter.html#afceb976e349529db27883bdf2a52d60c">ref_domaine_</a>.<a class="code" href="classRef__Domaine.html#a89e1c374ada79faa2c7e9a76c3393ad8">valeur</a>().<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0);
<a name="l00369"></a>00369   <a class="code" href="List_8h.html#add189d7375e577842ac891b09afc6d4b">CONST_LIST_CURSEUR</a>(<a class="code" href="classFaces__Interne.html" title="Classe Faces_Interne La classe sert a representer un ensemble de faces qui sont internes d&#39;un point d...">Faces_Interne</a><span class="comment">/*difference*/</span>) curseur(zone.<a class="code" href="classZone.html#ad1d5f91adfa5e56003ce778cab9610e8" title="Renvoie la liste des faces internes de la zone. (version const)">faces_int</a>()<span class="comment">/*difference*/</span>);
<a name="l00370"></a>00370   <span class="keywordtype">int</span> i_fr = zone.<a class="code" href="classZone.html#a7d6ba9a2216d306cb0a0bf3dfff6f170" title="Renvoie le nombre de bords de la zone.">nb_bords</a>()+zone.<a class="code" href="classZone.html#a150d1dac14da48d5f22abdae26fd85f3" title="Renvoie le nombre de raccords de la zone.">nb_raccords</a>();
<a name="l00371"></a>00371   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> elements_voisins;
<a name="l00372"></a>00372 
<a name="l00373"></a>00373   <span class="keywordflow">for</span> (; curseur; ++curseur)
<a name="l00374"></a>00374     {
<a name="l00375"></a>00375 
<a name="l00376"></a>00376       <span class="keyword">const</span> <a class="code" href="classFrontiere.html" title="Classe Frontiere. Une Frontiere decrit une partie de la frontiere d&#39;une Zone, elle possede un Nom...">Frontiere</a>&amp; frontiere = curseur.valeur();
<a name="l00377"></a>00377       <a class="code" href="classFrontiere.html" title="Classe Frontiere. Une Frontiere decrit une partie de la frontiere d&#39;une Zone, elle possede un Nom...">Frontiere</a>&amp; front_partie =
<a name="l00378"></a>00378         zone_partie.<a class="code" href="classZone.html#ad1d5f91adfa5e56003ce778cab9610e8" title="Renvoie la liste des faces internes de la zone. (version const)">faces_int</a>()<span class="comment">/*difference*/</span>.<a class="code" href="classList__Faces__Interne.html#a9f9ca7e4ddbeddbf18666234ed5e888e">add</a>(<a class="code" href="classFaces__Interne.html" title="Classe Faces_Interne La classe sert a representer un ensemble de faces qui sont internes d&#39;un point d...">Faces_Interne</a>()<span class="comment">/*difference*/</span>);
<a name="l00379"></a>00379       front_partie.<a class="code" href="classFrontiere.html#a714e3cc26d7e59f3a65d80de23ea21ac" title="Donne un nom a la frontiere.">nommer</a>(frontiere.<a class="code" href="classFrontiere.html#a2868774681d6f050479a95cbc7cd6fc9" title="Renvoie le nom de la frontiere.">le_nom</a>());
<a name="l00380"></a>00380       front_partie.<a class="code" href="classFrontiere.html#af927b5d4fc1fd086ba91e916f61badee" title="Associe la frontiere a la zone dont elle depend.">associer_zone</a>(zone_partie);
<a name="l00381"></a>00381       front_partie.<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a503fe687811445373b75dd8ac0991ec2" title="Type les faces.">typer</a>(frontiere.<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a2fb942d8b2c2f276afa1e6118371b962" title="Renvoie le type des Faces.">type_face</a>());
<a name="l00382"></a>00382       <a class="code" href="classDomaineCutter.html#a396245cb32fa5d410b790146a274d4a8">voisins_bords_</a>.<a class="code" href="classStatic__Int__Lists.html#ac5f80aca1def83653c95221f391b916d" title="copie la i-ieme liste dans le tableau fourni Le tableau array doit etre resizable.">copy_list_to_array</a>(i_fr, elements_voisins);
<a name="l00383"></a>00383       <a class="code" href="DomaineCutter_8cpp.html#a343028ad4896bd87bade3f9076b098b5" title="Pour une liste de &quot;faces&quot; de la zone globale, compter le nombre de faces incluses dans la partie &quot;...">construire_liste_faces_sous_domaine</a>(elements_voisins,
<a name="l00384"></a>00384                                           <a class="code" href="classDomaineCutter.html#a9da3c1aef1b48f6d6566abbee7dbcb85">ref_elem_part_</a>.<a class="code" href="classRef__IntVect.html#a1c7959efd862b8dd91818c78820c31b2">valeur</a>(),
<a name="l00385"></a>00385                                           partie,
<a name="l00386"></a>00386                                           frontiere.<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a07b8d8db9e3d656b93a21a49c063430c">les_sommets</a>(),
<a name="l00387"></a>00387                                           liste_inverse_sommets,
<a name="l00388"></a>00388                                           front_partie.<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a07b8d8db9e3d656b93a21a49c063430c">les_sommets</a>());
<a name="l00389"></a>00389       i_fr++;
<a name="l00390"></a>00390     }
<a name="l00391"></a>00391 }
<a name="l00392"></a>00392 
<a name="l00393"></a>00393 <span class="comment">//</span>
<a name="l00394"></a>00394 <span class="comment">//</span><span class="comment"></span>
<a name="l00395"></a>00395 <span class="comment">//! Pour chaque pe mentionne dans le tableau &quot;voisins&quot;, si un joint avec ce pe&lt;br&gt;n&#39;existe par encore dans la zone, ajoute un joint et initialise ce joint avec &quot;epaisseur&quot;.</span>
<a name="l00396"></a><a class="code" href="DomaineCutter_8cpp.html#aa231b6022b4a942b392a39d991b8ffd3">00396</a> <span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="DomaineCutter_8cpp.html#aa231b6022b4a942b392a39d991b8ffd3" title="Pour chaque pe mentionne dans le tableau &quot;voisins&quot;, si un joint avec ce pe n&#39;existe par encore dans...">ajouter_joints</a>(<a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone, <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; voisins, <span class="keyword">const</span> <span class="keywordtype">int</span> epaisseur)
<a name="l00397"></a>00397 {
<a name="l00398"></a>00398   <a class="code" href="classJoints.html" title="Classe Joints Cette classe represente une liste d&#39;objet de type Joint.">Joints</a>&amp; joints = zone.<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>();
<a name="l00399"></a>00399 
<a name="l00400"></a>00400   <span class="keyword">const</span> <span class="keywordtype">int</span> n = voisins.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00401"></a>00401   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
<a name="l00402"></a>00402     {
<a name="l00403"></a>00403       <span class="keyword">const</span> <span class="keywordtype">int</span> pe = voisins[i];
<a name="l00404"></a>00404       <span class="keywordtype">int</span> j;
<a name="l00405"></a>00405       <span class="keyword">const</span> <span class="keywordtype">int</span> nb_joints = joints.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>();
<a name="l00406"></a>00406       <span class="keywordflow">for</span> (j = 0; j &lt; nb_joints; j++)
<a name="l00407"></a>00407         <span class="keywordflow">if</span> (joints[j].PEvoisin() == pe)
<a name="l00408"></a>00408           <span class="keywordflow">break</span>;
<a name="l00409"></a>00409       <span class="keywordflow">if</span> (j == nb_joints)
<a name="l00410"></a>00410         {
<a name="l00411"></a>00411           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Adding of a new joint : &quot;</span> &lt;&lt; pe &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00412"></a>00412           <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp; joint = joints.<a class="code" href="classList__Joint.html#af5bca88a907fbe4086842805696cfe2f">add</a>(<a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>());
<a name="l00413"></a>00413           joint.<a class="code" href="classFrontiere.html#a714e3cc26d7e59f3a65d80de23ea21ac" title="Donne un nom a la frontiere.">nommer</a>(<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(<span class="stringliteral">&quot;Joint_&quot;</span>)+<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(pe));
<a name="l00414"></a>00414           joint.<a class="code" href="classFrontiere.html#af927b5d4fc1fd086ba91e916f61badee" title="Associe la frontiere a la zone dont elle depend.">associer_zone</a>(zone);
<a name="l00415"></a>00415           joint.<a class="code" href="classJoint.html#a130c206de5fddabf173bb3e4604cefa3" title="Fixe l&#39;epaisseur du joint.">affecte_epaisseur</a>(epaisseur);
<a name="l00416"></a>00416           joint.<a class="code" href="classJoint.html#a3c4ef6a648dd0b5d4aa072a1f4e3c64e" title="Fixe le numero du PE voisin.">affecte_PEvoisin</a>(pe);
<a name="l00417"></a>00417 <span class="comment">// Ces joints n&#39;auront pas de sommets communs. Met le flag</span>
<a name="l00418"></a>00418 <span class="comment">// d&#39;initialisation a 1.</span>
<a name="l00419"></a>00419           joint.<a class="code" href="classJoint.html#aa1c4d729a3017082d26907d82ad1d7de" title="Renvoie les informations de joint pour un type d&#39;item geometrique donne, pour remplissage des structu...">set_joint_item</a>(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>).<a class="code" href="classJoint__Items.html#aa01c4601d506c658f4f1d45e66951ce0" title="Renvoie le tableau items_communs_ pour le remplir. (BM: ce tableau n&#39;est pas encore rempli)...">set_items_communs</a>();
<a name="l00420"></a>00420         }
<a name="l00421"></a>00421     }
<a name="l00422"></a>00422 }
<a name="l00423"></a>00423 
<a name="l00424"></a>00424 <span class="comment">//</span>
<a name="l00425"></a>00425 <span class="comment">//</span>
<a name="l00426"></a>00426 <span class="comment">//</span>
<a name="l00427"></a>00427 <span class="comment">//</span>
<a name="l00428"></a>00428 <span class="comment">//</span>
<a name="l00429"></a>00429 <span class="comment">//</span>
<a name="l00430"></a>00430 <span class="comment">//</span><span class="comment"></span>
<a name="l00431"></a>00431 <span class="comment">//! A partir d&#39;une liste de sommets de depart (liste_sommets_depart), on&lt;br&gt;parcourt les elements voisins de ces sommets (si epaisseur &lt;= 1),&lt;br&gt;puis les voisins de ces elements (voisins par un sommet de l&#39;element) si epaisseur &lt;= 2,&lt;br&gt;puis les voisins des voisins si epaisseur &lt;= 3, etc&lt;br&gt;Les elements appartenant a la &quot;partie_a_ignorer&quot; ne sont pas parcourus.&lt;br&gt;Les indices des elements parcourus sont ranges dans liste_elements_trouves.&lt;br&gt;Cette methode a ete codee pour construire_elements_distants_ssdom()</span>
<a name="l00432"></a><a class="code" href="DomaineCutter_8cpp.html#ad7049d16e9165a0d702924537dffe3e3">00432</a> <span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="DomaineCutter_8cpp.html#ad7049d16e9165a0d702924537dffe3e3" title="A partir d&#39;une liste de sommets de depart (liste_sommets_depart), on parcourt les elements voisins de...">parcourir_epaisseurs_elements</a>(<span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; elements,
<a name="l00433"></a>00433                                           <span class="keyword">const</span> <a class="code" href="classStatic__Int__Lists.html" title="Cette classe permet de stocker des listes d&#39;entiers accessibles en temps constant. La taille des listes ne peut pas changer sans perdre le contenu (ce sont des listes statiques). Exemple: Static_Int_List l; ArrOfInt tailles(3); tailles[0] = 2; tailles[1] = 3; tailles[2] = 0; // On reserve la memoire pour trois listes de taille 2, 3 et 0: l.set_list_sizes(tailles); // On affecte une valeur au deuxieme element de la premiere liste: l.set_value(0,1,765); // Affiche la valeur Cout &lt;&lt; l(0,1);.">Static_Int_Lists</a>&amp; elem_som,
<a name="l00434"></a>00434                                           <span class="keyword">const</span> <a class="code" href="classIntVect.html">IntVect</a>&amp; elem_part,
<a name="l00435"></a>00435                                           <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> liste_sommets_depart, <span class="comment">/* par valeur car on va la modifier */</span>
<a name="l00436"></a>00436                                           <span class="keyword">const</span> <span class="keywordtype">int</span> partie_a_ignorer, <span class="comment">/* ne pas parcourir les elems de cette partie */</span>
<a name="l00437"></a>00437                                           <span class="keyword">const</span> <span class="keywordtype">int</span> epaisseur,
<a name="l00438"></a>00438                                           <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; liste_elements_trouves)
<a name="l00439"></a>00439 {
<a name="l00440"></a>00440   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_sommets = elem_som.<a class="code" href="classStatic__Int__Lists.html#a5872636466919b2cb8efe715c315d7ca" title="renvoie le nombre de listes stockees">get_nb_lists</a>();
<a name="l00441"></a>00441   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_elements = elements.<a class="code" href="classIntTab.html#a71e9b9ddc1793094b1b3f109377952b1" title="Returns the total dimensions of the multi-dimensionnal array, including virtual items (used in parall...">dimension_tot</a>(0);
<a name="l00442"></a>00442   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_som_elem = elements.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1);
<a name="l00443"></a>00443 
<a name="l00444"></a>00444   liste_elements_trouves.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00445"></a>00445   liste_elements_trouves.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(0);
<a name="l00446"></a>00446 
<a name="l00447"></a>00447   <a class="code" href="classArrOfBit.html">ArrOfBit</a> sommets_parcourus(nb_sommets);
<a name="l00448"></a>00448   <a class="code" href="classArrOfBit.html">ArrOfBit</a> elements_parcourus(nb_elements);
<a name="l00449"></a>00449   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> new_liste;
<a name="l00450"></a>00450   liste_sommets_depart.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00451"></a>00451   new_liste.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00452"></a>00452   sommets_parcourus = 0;
<a name="l00453"></a>00453   elements_parcourus = 0;
<a name="l00454"></a>00454 
<a name="l00455"></a>00455   {
<a name="l00456"></a>00456 <span class="comment">// Marquage des sommets de depart et construction d&#39;une liste de sommets uniques</span>
<a name="l00457"></a>00457     <span class="keyword">const</span> <span class="keywordtype">int</span> sz_liste = liste_sommets_depart.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00458"></a>00458     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; sz_liste; i++)
<a name="l00459"></a>00459       {
<a name="l00460"></a>00460         <span class="keyword">const</span> <span class="keywordtype">int</span> sommet = liste_sommets_depart[i];
<a name="l00461"></a>00461         <span class="keywordflow">if</span> (sommet&gt;-1)
<a name="l00462"></a>00462           <span class="keywordflow">if</span> (!sommets_parcourus.<a class="code" href="classArrOfBit.html#a68b08edd2eebc91e7bd7d34ec81f6cd2" title="Renvoie la valeur du bit e, puis met le bit e a 1.">testsetbit</a>(sommet))
<a name="l00463"></a>00463             new_liste.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(sommet);
<a name="l00464"></a>00464       }
<a name="l00465"></a>00465   }
<a name="l00466"></a>00466 
<a name="l00467"></a>00467 <span class="comment">// Boucle sur les epaisseurs successives d&#39;elements autour des sommets de joint.</span>
<a name="l00468"></a>00468   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ep = 1; ep &lt;= epaisseur; ep++)
<a name="l00469"></a>00469     {
<a name="l00470"></a>00470       liste_sommets_depart = new_liste;
<a name="l00471"></a>00471       new_liste.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(0);
<a name="l00472"></a>00472       <span class="keyword">const</span> <span class="keywordtype">int</span> sz_liste = liste_sommets_depart.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00473"></a>00473       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_sommet = 0; i_sommet &lt; sz_liste; i_sommet++)
<a name="l00474"></a>00474         {
<a name="l00475"></a>00475           <span class="keyword">const</span> <span class="keywordtype">int</span> sommet = liste_sommets_depart[i_sommet];
<a name="l00476"></a>00476 <span class="comment">// Parcours des elements voisins de ce sommet :</span>
<a name="l00477"></a>00477           <span class="keyword">const</span> <span class="keywordtype">int</span> nb_elems_voisins = elem_som.<a class="code" href="classStatic__Int__Lists.html#adbf6903737c3c30bf87e05b29f5a5b56" title="renvoie le nombre d&#39;elements de la liste i">get_list_size</a>(sommet);
<a name="l00478"></a>00478           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_elem = 0; i_elem &lt; nb_elems_voisins; i_elem++)
<a name="l00479"></a>00479             {
<a name="l00480"></a>00480               <span class="keyword">const</span> <span class="keywordtype">int</span> elem = elem_som(sommet, i_elem);
<a name="l00481"></a>00481               <span class="keywordflow">if</span> (elements_parcourus[elem])
<a name="l00482"></a>00482                 <span class="keywordflow">continue</span>; <span class="comment">//!&lt; Cet element a deja ete visite Numero de zone de l&#39;element voisin:</span>
<a name="l00483"></a>00483 <span class="comment"></span><span class="comment">//</span>
<a name="l00484"></a>00484               <span class="keyword">const</span> <span class="keywordtype">int</span> part = elem_part[elem];
<a name="l00485"></a>00485               <span class="keywordflow">if</span> (part == partie_a_ignorer)
<a name="l00486"></a>00486                 <span class="keywordflow">continue</span>; <span class="comment">//!&lt; Ne traiter que les elements des autres parties</span>
<a name="l00487"></a>00487 <span class="comment"></span>
<a name="l00488"></a>00488               liste_elements_trouves.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(elem);
<a name="l00489"></a>00489               elements_parcourus.<a class="code" href="classArrOfBit.html#a5c339cfd9dea141737e127131e52aaae" title="Met le bit e a 1.">setbit</a>(elem);
<a name="l00490"></a>00490 
<a name="l00491"></a>00491 <span class="comment">// Ajout a la prochaine liste de sommets a traiter les sommets de cet element:</span>
<a name="l00492"></a>00492               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_som_elem; i++)
<a name="l00493"></a>00493                 {
<a name="l00494"></a>00494                   <span class="keyword">const</span> <span class="keywordtype">int</span> sommet2 = elements(elem, i);
<a name="l00495"></a>00495                   <span class="keywordflow">if</span> (sommet2&gt;-1)
<a name="l00496"></a>00496                     {
<a name="l00497"></a>00497                       <span class="keywordflow">if</span> (sommets_parcourus.<a class="code" href="classArrOfBit.html#a68b08edd2eebc91e7bd7d34ec81f6cd2" title="Renvoie la valeur du bit e, puis met le bit e a 1.">testsetbit</a>(sommet2) == 0)
<a name="l00498"></a>00498                         new_liste.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(sommet2);
<a name="l00499"></a>00499                     }
<a name="l00500"></a>00500                 }
<a name="l00501"></a>00501             }
<a name="l00502"></a>00502         }
<a name="l00503"></a>00503     }
<a name="l00504"></a>00504 }
<a name="l00505"></a>00505 
<a name="l00506"></a>00506 <span class="comment">// Precondition: les sommets de joint de la zone_partie ont deja ete calcules</span>
<a name="l00507"></a>00507 <span class="comment">//</span>
<a name="l00508"></a>00508 <span class="comment">//</span>
<a name="l00509"></a>00509 <span class="comment">//</span>
<a name="l00510"></a>00510 <span class="comment">//</span>
<a name="l00511"></a>00511 <span class="comment">//</span>
<a name="l00512"></a>00512 <span class="comment">//</span>
<a name="l00513"></a>00513 <span class="comment">//</span>
<a name="l00514"></a>00514 <span class="comment">//</span>
<a name="l00515"></a>00515 <span class="comment">//</span><span class="comment"></span>
<a name="l00516"></a>00516 <span class="comment">//! calcul et remplissage de&lt;br&gt;zone_partie.joint(i).set_joint_item(Joint::ELEMENT).set_items_distants()&lt;br&gt;(liste des elements distants).&lt;br&gt;Eventuellement, de nouveaux joints sont crees.&lt;br&gt;Historique: methode codee en janvier 2006 par B.Mathieu. Je croyais que c&#39;etait&lt;br&gt;trop complique de determiner les elements distants au moment du scatter et j&#39;ai&lt;br&gt;fini par trouver comment faire. Du coup la methode ci-dessous n&#39;est plus utilisee&lt;br&gt;en temps normal. En cas de probleme, on peut la reactiver: en theorie elle donne&lt;br&gt;exactement le meme resultat que l&#39;algorithme code dans Scatter::calculer_espace_distant_elements.&lt;br&gt;Attention, elle ne fait rien de special pour le bords periodiques...</span>
<a name="l00517"></a><a class="code" href="classDomaineCutter.html#a9a64f400c752faa582fd92995665b60f">00517</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classDomaineCutter.html#a9a64f400c752faa582fd92995665b60f" title="calcul et remplissage de zone_partie.joint(i).set_joint_item(Joint::ELEMENT).set_items_distants() (li...">DomaineCutter::construire_elements_distants_ssdom</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>     partie,
<a name="l00518"></a>00518                                                        <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; liste_sommets,
<a name="l00519"></a>00519                                                        <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; liste_inverse_elements,
<a name="l00520"></a>00520                                                        <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone_partie)<span class="keyword"> const</span>
<a name="l00521"></a>00521 <span class="keyword"></span>{
<a name="l00522"></a>00522   <span class="keyword">const</span> <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone          = <a class="code" href="classDomaineCutter.html#afceb976e349529db27883bdf2a52d60c">ref_domaine_</a>.<a class="code" href="classRef__Domaine.html#a89e1c374ada79faa2c7e9a76c3393ad8">valeur</a>().<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0);
<a name="l00523"></a>00523   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; elements    = zone.<a class="code" href="classZone.html#ac115e8342be89afb882b7b61cc343267" title="Renvoie le tableau des sommets des elements.">les_elems</a>();
<a name="l00524"></a>00524   <span class="keyword">const</span> <a class="code" href="classIntVect.html">IntVect</a>&amp; elem_part = <a class="code" href="classDomaineCutter.html#a9da3c1aef1b48f6d6566abbee7dbcb85">ref_elem_part_</a>.<a class="code" href="classRef__IntVect.html#a1c7959efd862b8dd91818c78820c31b2">valeur</a>();
<a name="l00525"></a>00525 
<a name="l00526"></a>00526   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_som_elem = elements.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1);
<a name="l00527"></a>00527 
<a name="l00528"></a>00528 <span class="comment">// Premiere etape: chercher les elements virtuels de la sous-partie</span>
<a name="l00529"></a>00529 <span class="comment">// (elements des autres parties situes dans l&#39;epaisseur de joint en partant</span>
<a name="l00530"></a>00530 <span class="comment">// des sommets de joint).</span>
<a name="l00531"></a>00531   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> elements_virtuels;
<a name="l00532"></a>00532   {
<a name="l00533"></a>00533 <span class="comment">// Construction d&#39;un tableau contenant tous les sommets de tous les joints</span>
<a name="l00534"></a>00534     <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> sommets_joint;
<a name="l00535"></a>00535     sommets_joint.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00536"></a>00536     <span class="keyword">const</span> <span class="keywordtype">int</span> nb_joints = zone_partie.<a class="code" href="classZone.html#ab096afb61e89705709a4ae6d3576a644" title="Renvoie le nombre de joints de la zone.">nb_joints</a>();
<a name="l00537"></a>00537     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_joint = 0; i_joint &lt; nb_joints; i_joint++)
<a name="l00538"></a>00538       {
<a name="l00539"></a>00539         <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; sommets = zone_partie.<a class="code" href="classZone.html#acec4c61032df8b55a95f9e7197ef6e3c" title="Renvoie le i-ieme joint de la zone&lt;br&gt;(version const)">joint</a>(i_joint).<a class="code" href="classJoint.html#a3f49fb1150967b436a115a7373ab27a0" title="Renvoie les informations de joint pour le type demande.">joint_item</a>(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>).<a class="code" href="classJoint__Items.html#a435fb1629f6dafb089605913517e73c4" title="Voir items_communs_.">items_communs</a>();
<a name="l00540"></a>00540         <span class="keyword">const</span> <span class="keywordtype">int</span> n = sommets.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00541"></a>00541         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
<a name="l00542"></a>00542           {
<a name="l00543"></a>00543             <span class="keyword">const</span> <span class="keywordtype">int</span> sommet_local = sommets[i];
<a name="l00544"></a>00544             <span class="keyword">const</span> <span class="keywordtype">int</span> sommet_global = liste_sommets[sommet_local];
<a name="l00545"></a>00545             sommets_joint.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(sommet_global);
<a name="l00546"></a>00546           }
<a name="l00547"></a>00547       }
<a name="l00548"></a>00548 
<a name="l00549"></a>00549     <a class="code" href="DomaineCutter_8cpp.html#ad7049d16e9165a0d702924537dffe3e3" title="A partir d&#39;une liste de sommets de depart (liste_sommets_depart), on parcourt les elements voisins de...">parcourir_epaisseurs_elements</a>(elements, <a class="code" href="classDomaineCutter.html#a6269ac4cb6130e39c5c5be181253fad5">som_elem_</a>, elem_part,
<a name="l00550"></a>00550                                   sommets_joint, <span class="comment">//!&lt; Sommets de depart</span>
<a name="l00551"></a>00551 <span class="comment"></span>                                  partie, <span class="comment">/* ignorer les elements de la partie locale */</span>
<a name="l00552"></a>00552                                   <a class="code" href="classDomaineCutter.html#a53b94536327688de8d72b5a36c2cf173">epaisseur_joint_</a>,
<a name="l00553"></a>00553                                   elements_virtuels);
<a name="l00554"></a>00554   }
<a name="l00555"></a>00555   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_elements_virtuels = elements_virtuels.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00556"></a>00556 <span class="comment">// Construire la liste des numeros de zones voisines et ajouter les joints manquants:</span>
<a name="l00557"></a>00557   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> parties_voisines;
<a name="l00558"></a>00558   {
<a name="l00559"></a>00559     parties_voisines.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00560"></a>00560     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_elements_virtuels; i++)
<a name="l00561"></a>00561       {
<a name="l00562"></a>00562         <span class="keyword">const</span> <span class="keywordtype">int</span> elem = elements_virtuels[i];
<a name="l00563"></a>00563         <span class="keyword">const</span> <span class="keywordtype">int</span> part = elem_part[elem];
<a name="l00564"></a>00564         parties_voisines.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(part);
<a name="l00565"></a>00565       }
<a name="l00566"></a>00566     <a class="code" href="Scatter_8cpp.html#a23c4d19dc90caae2323f04de90621709" title="Methode outil pour retirer les doublons dans un tableau.">array_trier_retirer_doublons</a>(parties_voisines);
<a name="l00567"></a>00567     <a class="code" href="DomaineCutter_8cpp.html#aa231b6022b4a942b392a39d991b8ffd3" title="Pour chaque pe mentionne dans le tableau &quot;voisins&quot;, si un joint avec ce pe n&#39;existe par encore dans...">ajouter_joints</a>(zone_partie, parties_voisines, <a class="code" href="classDomaineCutter.html#a53b94536327688de8d72b5a36c2cf173">epaisseur_joint_</a>);
<a name="l00568"></a>00568   }
<a name="l00569"></a>00569 
<a name="l00570"></a>00570 <span class="comment">// Pour chaque partie voisine, chercher les elements distants:</span>
<a name="l00571"></a>00571   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_parties_voisines = parties_voisines.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00572"></a>00572   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> sommets_depart;
<a name="l00573"></a>00573   sommets_depart.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00574"></a>00574   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_part = 0; i_part &lt; nb_parties_voisines; i_part++)
<a name="l00575"></a>00575     {
<a name="l00576"></a>00576       <span class="keyword">const</span> <span class="keywordtype">int</span> partie_voisine = parties_voisines[i_part];
<a name="l00577"></a>00577       sommets_depart.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(0);
<a name="l00578"></a>00578 <span class="comment">// Liste des sommets des elements virtuels de la partie voisine:</span>
<a name="l00579"></a>00579       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_elem = 0; i_elem &lt; nb_elements_virtuels; i_elem++)
<a name="l00580"></a>00580         {
<a name="l00581"></a>00581           <span class="keyword">const</span> <span class="keywordtype">int</span> elem = elements_virtuels[i_elem];
<a name="l00582"></a>00582           <span class="keywordflow">if</span> (elem_part(elem) == partie_voisine)
<a name="l00583"></a>00583             {
<a name="l00584"></a>00584               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_som_elem; i++)
<a name="l00585"></a>00585                 {
<a name="l00586"></a>00586                   <span class="keyword">const</span> <span class="keywordtype">int</span> som = elements(elem, i);
<a name="l00587"></a>00587                   sommets_depart.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(som);
<a name="l00588"></a>00588                 }
<a name="l00589"></a>00589             }
<a name="l00590"></a>00590         }
<a name="l00591"></a>00591 
<a name="l00592"></a>00592 <span class="comment">// Recherche des elements voisins de cette liste:</span>
<a name="l00593"></a>00593       <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> elements_distants;
<a name="l00594"></a>00594       <a class="code" href="DomaineCutter_8cpp.html#ad7049d16e9165a0d702924537dffe3e3" title="A partir d&#39;une liste de sommets de depart (liste_sommets_depart), on parcourt les elements voisins de...">parcourir_epaisseurs_elements</a>(elements, <a class="code" href="classDomaineCutter.html#a6269ac4cb6130e39c5c5be181253fad5">som_elem_</a>, elem_part,
<a name="l00595"></a>00595                                     sommets_depart,
<a name="l00596"></a>00596                                     partie_voisine, <span class="comment">/* ignorer les elements de la partie voisine */</span>
<a name="l00597"></a>00597                                     <a class="code" href="classDomaineCutter.html#a53b94536327688de8d72b5a36c2cf173">epaisseur_joint_</a>,
<a name="l00598"></a>00598                                     elements_distants);
<a name="l00599"></a>00599 
<a name="l00600"></a>00600 <span class="comment">// Retirer de la liste les elements qui ne sont pas dans la partie locale:</span>
<a name="l00601"></a>00601       {
<a name="l00602"></a>00602         <span class="keywordtype">int</span> count = 0;
<a name="l00603"></a>00603         <span class="keyword">const</span> <span class="keywordtype">int</span> n = elements_distants.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00604"></a>00604         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
<a name="l00605"></a>00605           {
<a name="l00606"></a>00606             <span class="keyword">const</span> <span class="keywordtype">int</span> elem = elements_distants[i];
<a name="l00607"></a>00607             <span class="keywordflow">if</span> (elem_part[elem] == partie &amp;&amp; elem &lt; elements.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0) )
<a name="l00608"></a>00608               elements_distants[count++] = elem;
<a name="l00609"></a>00609           }
<a name="l00610"></a>00610         elements_distants.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(count);
<a name="l00611"></a>00611       }
<a name="l00612"></a>00612 <span class="comment">// Traduire les indices des elements en indices locaux sur le sous-domaine.</span>
<a name="l00613"></a>00613       {
<a name="l00614"></a>00614         <span class="keyword">const</span> <span class="keywordtype">int</span> n = elements_distants.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00615"></a>00615         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
<a name="l00616"></a>00616           {
<a name="l00617"></a>00617             <span class="keyword">const</span> <span class="keywordtype">int</span> elem = elements_distants[i];
<a name="l00618"></a>00618             <span class="keyword">const</span> <span class="keywordtype">int</span> renum = liste_inverse_elements[elem];
<a name="l00619"></a>00619             elements_distants[i] = renum;
<a name="l00620"></a>00620           }
<a name="l00621"></a>00621       }
<a name="l00622"></a>00622 <span class="comment">// Trier les elements dans l&#39;ordre croissant des indices</span>
<a name="l00623"></a>00623       elements_distants.<a class="code" href="classArrOfInt.html#abb0f48cf5a4be4b70edcc90baaebd521" title="Tri des valeurs du tableau dans l&#39;ordre croissant. La fonction utilisee est qsort de stdlib (elle est...">ordonne_array</a>();
<a name="l00624"></a>00624 <span class="comment">// Stocker la liste des elements distants dans le joint</span>
<a name="l00625"></a>00625       <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp;     joint = zone_partie.<a class="code" href="classZone.html#a30b91002d3555eed44930b95b48df04f">joint_of_pe</a>(partie_voisine);
<a name="l00626"></a>00626       joint.<a class="code" href="classJoint.html#aa1c4d729a3017082d26907d82ad1d7de" title="Renvoie les informations de joint pour un type d&#39;item geometrique donne, pour remplissage des structu...">set_joint_item</a>(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926ae32de3a01fdb3ad6c506b8058a7f6173">Joint::ELEMENT</a>).<a class="code" href="classJoint__Items.html#a13add264f4ad36ef4bddbfc1b7bdb817" title="Renvoie le tableau items_distants_ pour le remplir Voir Scatter::calculer_espace_distant, Scatter::calculer_espace_distant_faces_frontieres, Scatter::calculer_espace_distant_elements.">set_items_distants</a>() = elements_distants;
<a name="l00627"></a>00627     }
<a name="l00628"></a>00628 }
<a name="l00629"></a>00629 
<a name="l00630"></a>00630 <span class="comment">//</span>
<a name="l00631"></a>00631 <span class="comment">//</span>
<a name="l00632"></a>00632 <span class="comment">//</span>
<a name="l00633"></a>00633 <span class="comment">//</span>
<a name="l00634"></a>00634 <span class="comment">//</span>
<a name="l00635"></a>00635 <span class="comment">//</span>
<a name="l00636"></a>00636 <span class="comment">//</span>
<a name="l00637"></a>00637 <span class="comment">//</span>
<a name="l00638"></a>00638 <span class="comment">//</span>
<a name="l00639"></a>00639 <span class="comment">//</span>
<a name="l00640"></a>00640 <span class="comment">//</span><span class="comment"></span>
<a name="l00641"></a>00641 <span class="comment">//! Creation des joints et construction des listes et des&lt;br&gt;tableaux de sommets joints pour tous les joints de&lt;br&gt;la partie part. Les sommets du joint avec le &quot;PEvoisin&quot; sont&lt;br&gt;les sommets de la partie &quot;part&quot; qui sont aussi un sommet d&#39;un&lt;br&gt;element appartenant au PEvoisin.&lt;br&gt;Les joints apparaissent dans la liste dans l&#39;ordre croissant des PEs.&lt;br&gt;Note:  Les faces que l&#39;on va creer ensuite utilisent forcement&lt;br&gt;des sommets que l&#39;on va trouver ici.&lt;br&gt;Propriete : Les sommets du joint sont classes dans l&#39;ordre croissant&lt;br&gt;de leur numero local, donc dans l&#39;ordre croissant de&lt;br&gt;leur numero global (voir Remplir_Numeros_Sommets)</span>
<a name="l00642"></a>00642 <span class="comment"></span>
<a name="l00643"></a><a class="code" href="classDomaineCutter.html#adfdcdff976a3d5638a3b1f7b66e81826">00643</a> <span class="keywordtype">void</span> <a class="code" href="classDomaineCutter.html#adfdcdff976a3d5638a3b1f7b66e81826" title="Creation des joints et construction des listes et des tableaux de sommets joints pour tous les joints...">DomaineCutter::construire_sommets_joints_ssdom</a>(<span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; liste_sommets,
<a name="l00644"></a>00644                                                     <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; liste_inverse_sommets,
<a name="l00645"></a>00645                                                     <span class="keyword">const</span> <span class="keywordtype">int</span> partie,
<a name="l00646"></a>00646                                                     <span class="keyword">const</span> <a class="code" href="classStatic__Int__Lists.html" title="Cette classe permet de stocker des listes d&#39;entiers accessibles en temps constant. La taille des listes ne peut pas changer sans perdre le contenu (ce sont des listes statiques). Exemple: Static_Int_List l; ArrOfInt tailles(3); tailles[0] = 2; tailles[1] = 3; tailles[2] = 0; // On reserve la memoire pour trois listes de taille 2, 3 et 0: l.set_list_sizes(tailles); // On affecte une valeur au deuxieme element de la premiere liste: l.set_value(0,1,765); // Affiche la valeur Cout &lt;&lt; l(0,1);.">Static_Int_Lists</a>* som_raccord,
<a name="l00647"></a>00647                                                     <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone_partie)<span class="keyword"> const</span>
<a name="l00648"></a>00648 <span class="keyword"></span>{
<a name="l00649"></a>00649   <a class="code" href="classJoints.html" title="Classe Joints Cette classe represente une liste d&#39;objet de type Joint.">Joints</a>&amp; les_joints = zone_partie.<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>();
<a name="l00650"></a>00650 
<a name="l00651"></a>00651   <span class="keyword">const</span> <span class="keywordtype">int</span> parts = <a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a>;
<a name="l00652"></a>00652   <span class="keyword">const</span> <a class="code" href="classIntVect.html">IntVect</a>&amp; elem_part = <a class="code" href="classDomaineCutter.html#a9da3c1aef1b48f6d6566abbee7dbcb85">ref_elem_part_</a>.<a class="code" href="classRef__IntVect.html#a1c7959efd862b8dd91818c78820c31b2">valeur</a>();
<a name="l00653"></a>00653   <span class="keyword">const</span> <a class="code" href="classStatic__Int__Lists.html" title="Cette classe permet de stocker des listes d&#39;entiers accessibles en temps constant. La taille des listes ne peut pas changer sans perdre le contenu (ce sont des listes statiques). Exemple: Static_Int_List l; ArrOfInt tailles(3); tailles[0] = 2; tailles[1] = 3; tailles[2] = 0; // On reserve la memoire pour trois listes de taille 2, 3 et 0: l.set_list_sizes(tailles); // On affecte une valeur au deuxieme element de la premiere liste: l.set_value(0,1,765); // Affiche la valeur Cout &lt;&lt; l(0,1);.">Static_Int_Lists</a>&amp; som_elem = <a class="code" href="classDomaineCutter.html#a6269ac4cb6130e39c5c5be181253fad5">som_elem_</a>;
<a name="l00654"></a>00654 
<a name="l00655"></a>00655 <span class="comment">// Liste de sommets de joint (toutes parties confondues, un sommet peut</span>
<a name="l00656"></a>00656 <span class="comment">// apparaitre plusieurs fois dans le tableau, une fois par pe voisin au maximum)</span>
<a name="l00657"></a>00657 <span class="comment">// C&#39;est le numero global du sommet</span>
<a name="l00658"></a>00658   <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>) joints_sommets(parts);
<a name="l00659"></a>00659   {
<a name="l00660"></a>00660 <span class="comment">// Pour append_array :</span>
<a name="l00661"></a>00661     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; parts; i++)
<a name="l00662"></a>00662       joints_sommets[i].set_smart_resize(1);
<a name="l00663"></a>00663   }
<a name="l00664"></a>00664 
<a name="l00665"></a>00665 <span class="comment">// Algorithme : boucle sur les sommets de la partie.</span>
<a name="l00666"></a>00666 <span class="comment">// Pour chaque sommet du sous-domaine &quot;p&quot;, on cherche les PEs auxquels appartiennent</span>
<a name="l00667"></a>00667 <span class="comment">// les elements voisins du sommet, et, s&#39;il y a un PE voisin different de &quot;p&quot;,</span>
<a name="l00668"></a>00668 <span class="comment">// on ajoute ce sommet aux joints avec ces PEs.</span>
<a name="l00669"></a>00669 
<a name="l00670"></a>00670   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_sommets = liste_sommets.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00671"></a>00671 
<a name="l00672"></a>00672   <span class="keywordtype">int</span> i_sommet;
<a name="l00673"></a>00673 <span class="comment">// i = indice local du sommet dans le sous-domaine</span>
<a name="l00674"></a>00674   <span class="keywordflow">for</span> (i_sommet = 0; i_sommet &lt; nb_sommets; i_sommet++)
<a name="l00675"></a>00675     {
<a name="l00676"></a>00676 <span class="comment">// Numero global du sommet</span>
<a name="l00677"></a>00677       <span class="keywordtype">int</span> sommet = liste_sommets[i_sommet];
<a name="l00678"></a>00678 <span class="comment">// Boucle sur les elements voisins du sommet i</span>
<a name="l00679"></a>00679       <span class="keywordtype">int</span> nb_elements_voisins = som_elem.<a class="code" href="classStatic__Int__Lists.html#adbf6903737c3c30bf87e05b29f5a5b56" title="renvoie le nombre d&#39;elements de la liste i">get_list_size</a>(sommet);
<a name="l00680"></a>00680       <span class="keywordtype">int</span> i;
<a name="l00681"></a>00681       <span class="keywordflow">for</span> (i = 0; i &lt; nb_elements_voisins; i++)
<a name="l00682"></a>00682         {
<a name="l00683"></a>00683           <span class="keywordtype">int</span> elem = som_elem(sommet, i);
<a name="l00684"></a>00684           <span class="keywordtype">int</span> PEvoisin = elem_part[elem];
<a name="l00685"></a>00685 <span class="comment">// Faut-il ajouter ce sommet aux sommets du joint avec le PEvoisin ?</span>
<a name="l00686"></a>00686           <span class="keywordflow">if</span> (PEvoisin != partie)
<a name="l00687"></a>00687             joints_sommets[PEvoisin].<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(sommet);
<a name="l00688"></a>00688         }
<a name="l00689"></a>00689 <span class="comment">// boucle sur les procs connectes au sommet par un raccord</span>
<a name="l00690"></a>00690       <span class="keywordflow">if</span> (som_raccord) <span class="keywordflow">for</span> (i = 0; i &lt; som_raccord-&gt;<a class="code" href="classStatic__Int__Lists.html#adbf6903737c3c30bf87e05b29f5a5b56" title="renvoie le nombre d&#39;elements de la liste i">get_list_size</a>(sommet); i++)
<a name="l00691"></a>00691           <span class="keywordflow">if</span> ((*som_raccord)(sommet, i) != partie) joints_sommets[(*som_raccord)(sommet, i)].append_array(sommet);
<a name="l00692"></a>00692     }
<a name="l00693"></a>00693 
<a name="l00694"></a>00694 <span class="comment">// Creation des joints : dans l&#39;ordre croissant du PE voisin</span>
<a name="l00695"></a>00695   <span class="keywordtype">int</span> PEvoisin;
<a name="l00696"></a>00696   <span class="keywordflow">for</span> (PEvoisin = 0; PEvoisin &lt; parts; PEvoisin++)
<a name="l00697"></a>00697     {
<a name="l00698"></a>00698       <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; sommets = joints_sommets[PEvoisin];
<a name="l00699"></a>00699       <span class="keywordflow">if</span> (sommets.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>() &gt; 0)
<a name="l00700"></a>00700         {
<a name="l00701"></a>00701 <span class="comment">// Trier les sommets de joint par ordre croissant de l&#39;indice global</span>
<a name="l00702"></a>00702 <span class="comment">// (donc toutes les listes sur les processeurs voisins seront ordonnees</span>
<a name="l00703"></a>00703 <span class="comment">// de la meme facon) et retirer les doublons</span>
<a name="l00704"></a>00704           <a class="code" href="Scatter_8cpp.html#a23c4d19dc90caae2323f04de90621709" title="Methode outil pour retirer les doublons dans un tableau.">array_trier_retirer_doublons</a>(sommets);
<a name="l00705"></a>00705           <span class="keyword">const</span> <span class="keywordtype">int</span> nb_sommets2 = sommets.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00706"></a>00706 
<a name="l00707"></a>00707 <span class="comment">// On cree un nouveau joint</span>
<a name="l00708"></a>00708           <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp; joint = les_joints.<a class="code" href="classList__Joint.html#af5bca88a907fbe4086842805696cfe2f">add</a>(<a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>());
<a name="l00709"></a>00709           <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> nom_joint(<span class="stringliteral">&quot;Joint_&quot;</span>);
<a name="l00710"></a>00710           <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> nom_numero(PEvoisin);
<a name="l00711"></a>00711           nom_joint+=nom_numero;
<a name="l00712"></a>00712           joint.<a class="code" href="classFrontiere.html#a714e3cc26d7e59f3a65d80de23ea21ac" title="Donne un nom a la frontiere.">nommer</a>(nom_joint);
<a name="l00713"></a>00713           joint.<a class="code" href="classJoint.html#a130c206de5fddabf173bb3e4604cefa3" title="Fixe l&#39;epaisseur du joint.">affecte_epaisseur</a>(<a class="code" href="classDomaineCutter.html#a53b94536327688de8d72b5a36c2cf173">epaisseur_joint_</a>);
<a name="l00714"></a>00714           joint.<a class="code" href="classFrontiere.html#af927b5d4fc1fd086ba91e916f61badee" title="Associe la frontiere a la zone dont elle depend.">associer_zone</a>(zone_partie);
<a name="l00715"></a>00715           joint.<a class="code" href="classJoint.html#a3c4ef6a648dd0b5d4aa072a1f4e3c64e" title="Fixe le numero du PE voisin.">affecte_PEvoisin</a>(PEvoisin);
<a name="l00716"></a>00716           <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; sommets_locaux = joint.<a class="code" href="classJoint.html#aa1c4d729a3017082d26907d82ad1d7de" title="Renvoie les informations de joint pour un type d&#39;item geometrique donne, pour remplissage des structu...">set_joint_item</a>(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>).<a class="code" href="classJoint__Items.html#aa01c4601d506c658f4f1d45e66951ce0" title="Renvoie le tableau items_communs_ pour le remplir. (BM: ce tableau n&#39;est pas encore rempli)...">set_items_communs</a>();
<a name="l00717"></a>00717           sommets_locaux.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(nb_sommets2);
<a name="l00718"></a>00718 <span class="comment">// Remplissage du tableau (transformation en indice local de sommet)</span>
<a name="l00719"></a>00719           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_sommets2; i++)
<a name="l00720"></a>00720             {
<a name="l00721"></a>00721               <span class="keyword">const</span> <span class="keywordtype">int</span> indice_global = sommets[i];
<a name="l00722"></a>00722               <span class="keyword">const</span> <span class="keywordtype">int</span> indice_local = liste_inverse_sommets[indice_global];
<a name="l00723"></a>00723 
<a name="l00724"></a>00724               assert(indice_local &gt;= 0);
<a name="l00725"></a>00725               sommets_locaux[i] = indice_local;
<a name="l00726"></a>00726             }
<a name="l00727"></a>00727         }
<a name="l00728"></a>00728     }
<a name="l00729"></a>00729 
<a name="l00730"></a>00730 }
<a name="l00731"></a>00731 
<a name="l00732"></a>00732 <span class="comment">// Recherche des faces de joints (faces adjacentes a deux elements appartenant</span>
<a name="l00733"></a>00733 <span class="comment">// a deux processeurs differents).</span>
<a name="l00734"></a>00734 <span class="comment">// On suppose que les sommets des joints ont ete construits.</span>
<a name="l00735"></a>00735 
<a name="l00736"></a><a class="code" href="classDomaineCutter.html#adf1b1154ac181e0fc367e7d78cedecaa">00736</a> <span class="keywordtype">void</span> <a class="code" href="classDomaineCutter.html#adf1b1154ac181e0fc367e7d78cedecaa">DomaineCutter::construire_faces_joints_ssdom</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> partie,
<a name="l00737"></a>00737                                                   <span class="keyword">const</span> <a class="code" href="classDomaineCutter__Correspondance.html" title="Classe outil contenant la correspondance entre les indices de sommets et d&#39;elements du domaine global...">DomaineCutter_Correspondance</a>&amp; correspondance,
<a name="l00738"></a>00738                                                   <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone_partie)<span class="keyword"> const</span>
<a name="l00739"></a>00739 <span class="keyword"></span>{
<a name="l00740"></a>00740   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_sommets_ssdom = zone_partie.<a class="code" href="classZone.html#ad340f571f81fa5c2e028b88c00b5c2ca" title="Renvoie le nombre de sommets de la zone.">nb_som</a>();
<a name="l00741"></a>00741   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_elem_ssdom = zone_partie.<a class="code" href="classZone.html#a7f249429803b27139a1c54436f6164a5" title="Renvoie le nombre d&#39;elements de la zone.">nb_elem</a>();
<a name="l00742"></a>00742   <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; liste_sommets = correspondance.<a class="code" href="classDomaineCutter__Correspondance.html#af011cabc695d3332f85f9fdfe9981b1d">get_liste_sommets</a>();
<a name="l00743"></a>00743   <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; liste_inverse_elements = correspondance.<a class="code" href="classDomaineCutter__Correspondance.html#a44cd509510f178b4b194b84744b1efbf">get_liste_inverse_elements</a>();
<a name="l00744"></a>00744   <span class="keyword">const</span> <a class="code" href="classStatic__Int__Lists.html" title="Cette classe permet de stocker des listes d&#39;entiers accessibles en temps constant. La taille des listes ne peut pas changer sans perdre le contenu (ce sont des listes statiques). Exemple: Static_Int_List l; ArrOfInt tailles(3); tailles[0] = 2; tailles[1] = 3; tailles[2] = 0; // On reserve la memoire pour trois listes de taille 2, 3 et 0: l.set_list_sizes(tailles); // On affecte une valeur au deuxieme element de la premiere liste: l.set_value(0,1,765); // Affiche la valeur Cout &lt;&lt; l(0,1);.">Static_Int_Lists</a>&amp; som_elem = <a class="code" href="classDomaineCutter.html#a6269ac4cb6130e39c5c5be181253fad5">som_elem_</a>;
<a name="l00745"></a>00745 
<a name="l00746"></a>00746 <span class="comment">// Premiere etape: reperage des &quot;elements de joint&quot; (elements de la &quot;partie&quot;</span>
<a name="l00747"></a>00747 <span class="comment">// possedant un sommet de joint), et marquage des sommets de joint</span>
<a name="l00748"></a>00748   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> liste_elements_joint;
<a name="l00749"></a>00749   <a class="code" href="classArrOfBit.html">ArrOfBit</a> drapeaux_sommets_joints(nb_sommets_ssdom);
<a name="l00750"></a>00750   {
<a name="l00751"></a>00751 <span class="comment">// Pour l&#39;instant, on utilise les joints en const...</span>
<a name="l00752"></a>00752     <span class="keyword">const</span> <a class="code" href="classJoints.html" title="Classe Joints Cette classe represente une liste d&#39;objet de type Joint.">Joints</a>&amp; joints_partie = zone_partie.<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>();
<a name="l00753"></a>00753 
<a name="l00754"></a>00754     drapeaux_sommets_joints = 0;
<a name="l00755"></a>00755     liste_elements_joint.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00756"></a>00756 
<a name="l00757"></a>00757 <span class="comment">// Marqueurs: pour chaque element du sous-domaine, est-il deja dans la liste ?</span>
<a name="l00758"></a>00758     <a class="code" href="classArrOfBit.html">ArrOfBit</a> drapeaux_elements(nb_elem_ssdom);
<a name="l00759"></a>00759     drapeaux_elements = 0;
<a name="l00760"></a>00760 <span class="comment">// Boucle sur tous les sommets de joint</span>
<a name="l00761"></a>00761     <span class="keyword">const</span> <span class="keywordtype">int</span> nb_joints = joints_partie.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>();
<a name="l00762"></a>00762     <span class="keywordtype">int</span> i_joint;
<a name="l00763"></a>00763     <span class="keywordflow">for</span> (i_joint = 0; i_joint &lt; nb_joints; i_joint++)
<a name="l00764"></a>00764       {
<a name="l00765"></a>00765         <span class="keyword">const</span> <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp; joint = joints_partie[i_joint];
<a name="l00766"></a>00766         <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; sommets_du_joint = joint.<a class="code" href="classJoint.html#a3f49fb1150967b436a115a7373ab27a0" title="Renvoie les informations de joint pour le type demande.">joint_item</a>(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>).<a class="code" href="classJoint__Items.html#a435fb1629f6dafb089605913517e73c4" title="Voir items_communs_.">items_communs</a>();
<a name="l00767"></a>00767         <span class="keyword">const</span> <span class="keywordtype">int</span> n = sommets_du_joint.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00768"></a>00768         <span class="keywordtype">int</span> i;
<a name="l00769"></a>00769         <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)
<a name="l00770"></a>00770           {
<a name="l00771"></a>00771             <span class="keyword">const</span> <span class="keywordtype">int</span> i_sommet_local = sommets_du_joint[i];
<a name="l00772"></a>00772             <span class="keyword">const</span> <span class="keywordtype">int</span> i_sommet_global = liste_sommets[i_sommet_local];
<a name="l00773"></a>00773             <span class="keyword">const</span> <span class="keywordtype">int</span> nb_elem_voisins = som_elem.<a class="code" href="classStatic__Int__Lists.html#adbf6903737c3c30bf87e05b29f5a5b56" title="renvoie le nombre d&#39;elements de la liste i">get_list_size</a>(i_sommet_global);
<a name="l00774"></a>00774 <span class="comment">// Marquage du sommet de joint dans le sous-domaine</span>
<a name="l00775"></a>00775             drapeaux_sommets_joints.<a class="code" href="classArrOfBit.html#a5c339cfd9dea141737e127131e52aaae" title="Met le bit e a 1.">setbit</a>(i_sommet_local);
<a name="l00776"></a>00776             <span class="keywordtype">int</span> j;
<a name="l00777"></a>00777             <span class="keywordflow">for</span> (j = 0; j &lt; nb_elem_voisins; j++)
<a name="l00778"></a>00778               {
<a name="l00779"></a>00779                 <span class="keyword">const</span> <span class="keywordtype">int</span> i_elem_global = som_elem(i_sommet_global, j);
<a name="l00780"></a>00780                 <span class="keyword">const</span> <span class="keywordtype">int</span> i_elem_local = liste_inverse_elements[i_elem_global];
<a name="l00781"></a>00781 <span class="comment">// On ajoute l&#39;element a la liste d&#39;elements joint s&#39;il est dans ma partie</span>
<a name="l00782"></a>00782 <span class="comment">// et s&#39;il n&#39;est pas encore dans la liste.</span>
<a name="l00783"></a>00783                 <span class="keywordflow">if</span> (i_elem_local &gt;= 0)
<a name="l00784"></a>00784                   <span class="keywordflow">if</span> (! drapeaux_elements.<a class="code" href="classArrOfBit.html#a68b08edd2eebc91e7bd7d34ec81f6cd2" title="Renvoie la valeur du bit e, puis met le bit e a 1.">testsetbit</a>(i_elem_local))
<a name="l00785"></a>00785                     liste_elements_joint.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(i_elem_global);
<a name="l00786"></a>00786               }
<a name="l00787"></a>00787           }
<a name="l00788"></a>00788       }
<a name="l00789"></a>00789   }
<a name="l00790"></a>00790 
<a name="l00791"></a>00791 <span class="comment">// Deuxieme etape: pour chaque element de joint, construction de ses</span>
<a name="l00792"></a>00792 <span class="comment">// faces et on regarde si la face a un element voisin dans une autre partie.</span>
<a name="l00793"></a>00793 <span class="comment">// Si oui, c&#39;est une face de joint</span>
<a name="l00794"></a>00794 
<a name="l00795"></a>00795 <span class="comment">// Tableau des indices des sommets de toutes les faces de joint</span>
<a name="l00796"></a>00796 <span class="comment">// (tous joints confondus, indices de sommets dans le sous-domaine)</span>
<a name="l00797"></a>00797   <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a> faces_joints;
<a name="l00798"></a>00798 <span class="comment">// Pour chaque face de joint, numero du sous-domaine voisin par cette face</span>
<a name="l00799"></a>00799   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> faces_pe_voisins;
<a name="l00800"></a>00800 <span class="comment">// Pour chaque processeur, nombre de faces de joint avec ce proc.</span>
<a name="l00801"></a>00801 <span class="comment">// (on initialise a zero)</span>
<a name="l00802"></a>00802   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> nb_faces_joints(<a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a>);
<a name="l00803"></a>00803   {
<a name="l00804"></a>00804     faces_joints.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00805"></a>00805     faces_pe_voisins.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00806"></a>00806 
<a name="l00807"></a>00807 <span class="comment">// Indices des sommets des faces sur l&#39;element de reference</span>
<a name="l00808"></a>00808     <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a> faces_element_reference;
<a name="l00809"></a>00809     <span class="keyword">const</span> <a class="code" href="classElem__geom__base.html" title="Classe Elem_geom_base Cette classe est la classe de base pour la definition d&#39;elements geometriques c...">Elem_geom_base</a>&amp; <a class="code" href="Raffiner__Simplexes_8cpp.html#a358dc168d8905bbafc12587204bc9fb8">type_elem</a> = zone_partie.<a class="code" href="classZone.html#a18cf83cd0f9c368dcfa32fb802a0ac94" title="Renvoie un element geometrique du type de ceux qui constituent la zone. (version const)">type_elem</a>().<a class="code" href="classDeriv__Elem__geom__base.html#a384b487459a33f9f521fb16539ec81de">valeur</a>();
<a name="l00810"></a>00810     <span class="keywordtype">int</span> is_regular = type_elem.<a class="code" href="classElem__geom__base.html#a9993267e98ef97472d3a5ef9c3c67882" title="remplit le tableau faces_som_local(i,j) qui donne pour 0 &lt;= i &lt; nb_faces() et 0 &lt;= j &lt; nb_som_face(i) le ...">get_tab_faces_sommets_locaux</a>(faces_element_reference);
<a name="l00811"></a>00811 <span class="comment">// On ne sait pas traiter les elements non reguliers</span>
<a name="l00812"></a>00812     <span class="keywordflow">if</span> (!is_regular)
<a name="l00813"></a>00813       {
<a name="l00814"></a>00814 <span class="comment">// Cerr &lt;&lt; &quot;DomaineCutter::faces_joints Error: non-regular elements not supported&quot; &lt;&lt; finl;</span>
<a name="l00815"></a>00815         <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classPoly__geom__base.html" title=": class Poly_geom_base &lt;Description of class Poly_geom_base&gt;">Poly_geom_base</a>,type_elem).get_tab_faces_sommets_locaux(faces_element_reference,0);
<a name="l00816"></a>00816 <span class="comment">// exit();</span>
<a name="l00817"></a>00817       }
<a name="l00818"></a>00818 
<a name="l00819"></a>00819     <span class="keywordtype">int</span> nb_faces_elem       = faces_element_reference.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00820"></a>00820     <span class="keyword">const</span> <span class="keywordtype">int</span> nb_sommets_par_face = faces_element_reference.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1);
<a name="l00821"></a>00821     faces_joints.<a class="code" href="classIntTab.html#a22e6bed6826b3688d4d0181cbf3b7a38" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(0, nb_sommets_par_face); <span class="comment">//!&lt; Voir *suite*</span>
<a name="l00822"></a>00822 <span class="comment"></span>    <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; liste_inverse_sommets = correspondance.<a class="code" href="classDomaineCutter__Correspondance.html#a5db92357e90fc70fff3699211571bf94">get_liste_inverse_sommets</a>();
<a name="l00823"></a>00823     <span class="keyword">const</span> <a class="code" href="classIntVect.html">IntVect</a>&amp; elem_part = <a class="code" href="classDomaineCutter.html#a9da3c1aef1b48f6d6566abbee7dbcb85">ref_elem_part_</a>.<a class="code" href="classRef__IntVect.html#a1c7959efd862b8dd91818c78820c31b2">valeur</a>();
<a name="l00824"></a>00824 <span class="comment">// Sommets des elements du maillage global</span>
<a name="l00825"></a>00825     <span class="keyword">const</span> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; domaine = <a class="code" href="classDomaineCutter.html#afceb976e349529db27883bdf2a52d60c">ref_domaine_</a>.<a class="code" href="classRef__Domaine.html#a89e1c374ada79faa2c7e9a76c3393ad8">valeur</a>();
<a name="l00826"></a>00826     <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; elem_som = domaine.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#ac115e8342be89afb882b7b61cc343267" title="Renvoie le tableau des sommets des elements.">les_elems</a>();
<a name="l00827"></a>00827 
<a name="l00828"></a>00828     <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> une_face(nb_sommets_par_face);
<a name="l00829"></a>00829     <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> elements_voisins;
<a name="l00830"></a>00830     elements_voisins.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00831"></a>00831 
<a name="l00832"></a>00832 <span class="comment">// Boucle sur les elements de joint</span>
<a name="l00833"></a>00833     <span class="keyword">const</span> <span class="keywordtype">int</span> nb_elem_joints = liste_elements_joint.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00834"></a>00834     <span class="keywordtype">int</span> i_elem_joint;
<a name="l00835"></a>00835     <span class="keywordflow">for</span> (i_elem_joint = 0; i_elem_joint &lt; nb_elem_joints; i_elem_joint++)
<a name="l00836"></a>00836       {
<a name="l00837"></a>00837 <span class="comment">// Indice de l&#39;element dans le domaine global</span>
<a name="l00838"></a>00838         <span class="keyword">const</span> <span class="keywordtype">int</span> i_elem_global = liste_elements_joint[i_elem_joint];
<a name="l00839"></a>00839 <span class="comment">// Boucle sur les faces de l&#39;element</span>
<a name="l00840"></a>00840         <span class="keywordtype">int</span> i_face;
<a name="l00841"></a>00841         <span class="keywordflow">if</span> (!is_regular)
<a name="l00842"></a>00842           {
<a name="l00843"></a>00843 <span class="comment">// global ou non ????????</span>
<a name="l00844"></a>00844             <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classPoly__geom__base.html" title=": class Poly_geom_base &lt;Description of class Poly_geom_base&gt;">Poly_geom_base</a>,type_elem).get_tab_faces_sommets_locaux(faces_element_reference,liste_inverse_elements[i_elem_global]);
<a name="l00845"></a>00845             nb_faces_elem       = faces_element_reference.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00846"></a>00846             <span class="keywordflow">while</span> ( faces_element_reference(nb_faces_elem-1,0)==-1)
<a name="l00847"></a>00847               nb_faces_elem--;
<a name="l00848"></a>00848           }
<a name="l00849"></a>00849         <span class="keywordflow">for</span> (i_face = 0; i_face &lt; nb_faces_elem; i_face++)
<a name="l00850"></a>00850           {
<a name="l00851"></a>00851 <span class="comment">// Construction de la face</span>
<a name="l00852"></a>00852             <span class="keywordtype">int</span> i;
<a name="l00853"></a>00853             <span class="keywordtype">int</span> face_ok = 1;
<a name="l00854"></a>00854             <span class="keywordflow">for</span> (i = 0; i &lt; nb_sommets_par_face; i++)
<a name="l00855"></a>00855               {
<a name="l00856"></a>00856                 <span class="keyword">const</span> <span class="keywordtype">int</span> i_ref = faces_element_reference(i_face, i);
<a name="l00857"></a>00857                 <span class="keywordflow">if</span> (i_ref&lt;0)
<a name="l00858"></a>00858                   {
<a name="l00859"></a>00859                     une_face[i] = i_ref;
<a name="l00860"></a>00860                   }
<a name="l00861"></a>00861                 <span class="keywordflow">else</span>
<a name="l00862"></a>00862                   {
<a name="l00863"></a>00863                     <span class="keyword">const</span> <span class="keywordtype">int</span> i_som = elem_som(i_elem_global, i_ref);
<a name="l00864"></a>00864                     une_face[i] = i_som;
<a name="l00865"></a>00865 <span class="comment">// Indice du sommet dans le sous-domaine</span>
<a name="l00866"></a>00866 
<a name="l00867"></a>00867                     <span class="keywordflow">if</span> (i_som&gt;-1)
<a name="l00868"></a>00868                       {
<a name="l00869"></a>00869                         <span class="keyword">const</span> <span class="keywordtype">int</span> i_som_local = liste_inverse_sommets(i_som);
<a name="l00870"></a>00870                         <span class="keywordflow">if</span>(i_som_local&gt;0)
<a name="l00871"></a>00871                           {
<a name="l00872"></a>00872 <span class="comment">// Le sommet est-il sur un joint ?</span>
<a name="l00873"></a>00873                             <span class="keywordflow">if</span> (drapeaux_sommets_joints[i_som_local] == 0)
<a name="l00874"></a>00874                               face_ok = 0; <span class="comment">//!&lt; Non =&gt; cette face n&#39;est pas sur un joint</span>
<a name="l00875"></a>00875 <span class="comment"></span>                          }
<a name="l00876"></a>00876                       }
<a name="l00877"></a>00877                   }
<a name="l00878"></a>00878               }
<a name="l00879"></a>00879 <span class="comment">// Premier test pour eliminer tout de suite la face</span>
<a name="l00880"></a>00880 <span class="comment">// si tous ses sommets ne sont pas des sommets de joint.</span>
<a name="l00881"></a>00881             <span class="keywordflow">if</span> (face_ok)
<a name="l00882"></a>00882               {
<a name="l00883"></a>00883 <span class="comment">// Recherche des elements voisins de cette face</span>
<a name="l00884"></a>00884                 <a class="code" href="Connectivite__som__elem_8cpp.html#afccbadf5344a16154a56b33dbddf88c1" title="Cherche les elements qui contiennent tous les sommets du tableau sommets_to_find (permet de trouver l...">find_adjacent_elements</a>(som_elem, une_face, elements_voisins);
<a name="l00885"></a>00885 <span class="comment">// Recherche d&#39;un element voisin qui n&#39;est pas dans ma partie</span>
<a name="l00886"></a>00886                 <span class="keyword">const</span> <span class="keywordtype">int</span> nb_elem_voisins = elements_voisins.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00887"></a>00887                 <span class="keywordtype">int</span> PEvoisin = -1;
<a name="l00888"></a>00888                 <span class="keywordflow">for</span> (i = 0; i &lt; nb_elem_voisins; i++)
<a name="l00889"></a>00889                   {
<a name="l00890"></a>00890                     <span class="keyword">const</span> <span class="keywordtype">int</span> i_elem_glob = elements_voisins[i];
<a name="l00891"></a>00891                     PEvoisin = elem_part[i_elem_glob];
<a name="l00892"></a>00892                     <span class="keywordflow">if</span> (PEvoisin != partie)
<a name="l00893"></a>00893                       <span class="keywordflow">break</span>;
<a name="l00894"></a>00894                   }
<a name="l00895"></a>00895                 <span class="keywordflow">if</span> (i &lt; nb_elem_voisins)
<a name="l00896"></a>00896                   {
<a name="l00897"></a>00897 <span class="comment">// J&#39;ai une face de joint, je l&#39;ajoute au tableau</span>
<a name="l00898"></a>00898                     faces_pe_voisins.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(PEvoisin);
<a name="l00899"></a>00899                     <span class="keyword">const</span> <span class="keywordtype">int</span> n = faces_joints.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00900"></a>00900                     faces_joints.<a class="code" href="classIntTab.html#a22e6bed6826b3688d4d0181cbf3b7a38" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(n+1, nb_sommets_par_face);
<a name="l00901"></a>00901                     <span class="keywordflow">for</span> (i = 0; i &lt; nb_sommets_par_face; i++)
<a name="l00902"></a>00902                       {
<a name="l00903"></a>00903                         <span class="keyword">const</span> <span class="keywordtype">int</span> i_som_global = une_face[i];
<a name="l00904"></a>00904                         <span class="keywordflow">if</span> (i_som_global&gt;-1)
<a name="l00905"></a>00905                           {
<a name="l00906"></a>00906                             <span class="keyword">const</span> <span class="keywordtype">int</span> i_som_local = liste_inverse_sommets[i_som_global];
<a name="l00907"></a>00907                             faces_joints(n, i) = i_som_local;
<a name="l00908"></a>00908                           }
<a name="l00909"></a>00909                         <span class="keywordflow">else</span>
<a name="l00910"></a>00910                           faces_joints(n, i) = -1;
<a name="l00911"></a>00911                       }
<a name="l00912"></a>00912                     nb_faces_joints[PEvoisin]++;
<a name="l00913"></a>00913                   }
<a name="l00914"></a>00914               }
<a name="l00915"></a>00915           }
<a name="l00916"></a>00916       }
<a name="l00917"></a>00917   }
<a name="l00918"></a>00918 
<a name="l00919"></a>00919 <span class="comment">// Troisieme etape: ajout des faces dans les joints</span>
<a name="l00920"></a>00920   {
<a name="l00921"></a>00921 <span class="comment">// Le type des faces de joint</span>
<a name="l00922"></a>00922     <span class="keyword">const</span> <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone_globale = <a class="code" href="classDomaineCutter.html#afceb976e349529db27883bdf2a52d60c">ref_domaine_</a>.<a class="code" href="classRef__Domaine.html#a89e1c374ada79faa2c7e9a76c3393ad8">valeur</a>().<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0);
<a name="l00923"></a>00923     <span class="keyword">const</span> <a class="code" href="classFaces.html#a62b7dbd959f99b997dc8111210ec8458">Type_Face</a>&amp; type_face_joint = zone_globale.<a class="code" href="classZone.html#a18cf83cd0f9c368dcfa32fb802a0ac94" title="Renvoie un element geometrique du type de ceux qui constituent la zone. (version const)">type_elem</a>().<a class="code" href="classElem__geom.html#a80ae8c21d0d7e74956065006519370c6" title="Appel a l&#39;objet sous-jacent Renvoie le i-eme type de face de l&#39;element geometrique.">type_face</a>();
<a name="l00924"></a>00924 <span class="comment">// On va modifier les joints:</span>
<a name="l00925"></a>00925     <a class="code" href="classJoints.html" title="Classe Joints Cette classe represente une liste d&#39;objet de type Joint.">Joints</a>&amp; joints_partie = zone_partie.<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>();
<a name="l00926"></a>00926     <span class="keyword">const</span> <span class="keywordtype">int</span> nb_joints = joints_partie.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>();
<a name="l00927"></a>00927     <span class="keywordtype">int</span> i_joint;
<a name="l00928"></a>00928 
<a name="l00929"></a>00929     <span class="keyword">const</span> <span class="keywordtype">int</span> nb_faces_joints_tot = faces_joints.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00930"></a>00930 <span class="comment">// *suite* : tableau de dimension 2 meme s&#39;il n&#39;y a pas de faces</span>
<a name="l00931"></a>00931     <span class="keyword">const</span> <span class="keywordtype">int</span> nb_sommets_par_face = faces_joints.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1);
<a name="l00932"></a>00932 
<a name="l00933"></a>00933     <span class="keywordflow">for</span> (i_joint = 0; i_joint &lt; nb_joints; i_joint++)
<a name="l00934"></a>00934       {
<a name="l00935"></a>00935 <span class="comment">// Typage des faces et allocation memoire</span>
<a name="l00936"></a>00936         <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp; joint = joints_partie[i_joint];
<a name="l00937"></a>00937         joint.<a class="code" href="classFrontiere.html#a982b45717b0c01579000d7a707b27672" title="Type les faces de la frontiere.">typer_faces</a>(type_face_joint);
<a name="l00938"></a>00938         joint.<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a07b8d8db9e3d656b93a21a49c063430c">les_sommets</a>().<a class="code" href="classIntTab.html#a22e6bed6826b3688d4d0181cbf3b7a38" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(0, nb_sommets_par_face);
<a name="l00939"></a>00939         <span class="keyword">const</span> <span class="keywordtype">int</span> PE_voisin = joint.<a class="code" href="classJoint.html#a0952bc5c7805434ccd8cd5c9b01e3747" title="Renvoie PEvoisin (numero de la zone voisine)">PEvoisin</a>();
<a name="l00940"></a>00940         <span class="keyword">const</span> <span class="keywordtype">int</span> nb_faces = nb_faces_joints[PE_voisin];
<a name="l00941"></a>00941         joint.<a class="code" href="classJoint.html#aea854b6ff4ed73bae948775e6f6b2564" title="Dimensionne la frontiere, i.e. fixe son nombre de faces.">dimensionner</a>(nb_faces);
<a name="l00942"></a>00942 <span class="comment">// Remplissage du tableau de faces</span>
<a name="l00943"></a>00943         <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; faces = joint.<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a07b8d8db9e3d656b93a21a49c063430c">les_sommets</a>();
<a name="l00944"></a>00944         <span class="keywordtype">int</span> i;
<a name="l00945"></a>00945         <span class="keywordtype">int</span> k = 0;
<a name="l00946"></a>00946         <span class="keywordflow">for</span> (i = 0; i &lt; nb_faces_joints_tot; i++)
<a name="l00947"></a>00947           {
<a name="l00948"></a>00948             <span class="keyword">const</span> <span class="keywordtype">int</span> face_pe = faces_pe_voisins[i];
<a name="l00949"></a>00949             <span class="keywordflow">if</span> (face_pe == PE_voisin)
<a name="l00950"></a>00950               {
<a name="l00951"></a>00951                 <span class="keywordtype">int</span> j;
<a name="l00952"></a>00952                 <span class="keywordflow">for</span> (j = 0; j &lt; nb_sommets_par_face; j++)
<a name="l00953"></a>00953                   faces(k, j) = faces_joints(i,j);
<a name="l00954"></a>00954                 k++;
<a name="l00955"></a>00955               }
<a name="l00956"></a>00956           }
<a name="l00957"></a>00957       }
<a name="l00958"></a>00958   }
<a name="l00959"></a>00959 }
<a name="l00960"></a>00960 <span class="comment"></span>
<a name="l00961"></a>00961 <span class="comment">//! Constructeur par defaut (structure vide)</span>
<a name="l00962"></a><a class="code" href="classDomaineCutter.html#a0bbc973c7219042f38b13b7db0f00afe">00962</a> <span class="comment"></span><a class="code" href="classDomaineCutter.html#a0bbc973c7219042f38b13b7db0f00afe" title="Constructeur par defaut (structure vide)">DomaineCutter::DomaineCutter</a>()
<a name="l00963"></a>00963 {
<a name="l00964"></a>00964   <a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a> = -1;
<a name="l00965"></a>00965   <a class="code" href="classDomaineCutter.html#a53b94536327688de8d72b5a36c2cf173">epaisseur_joint_</a> = -1;
<a name="l00966"></a>00966 }
<a name="l00967"></a>00967 <span class="comment"></span>
<a name="l00968"></a>00968 <span class="comment">//! annule toutes les references et vide les tableaux</span>
<a name="l00969"></a><a class="code" href="classDomaineCutter.html#a25ed06d3770465a4e4208555f4e5f5d2">00969</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classDomaineCutter.html#a25ed06d3770465a4e4208555f4e5f5d2" title="annule toutes les references et vide les tableaux">DomaineCutter::reset</a>()
<a name="l00970"></a>00970 {
<a name="l00971"></a>00971   <a class="code" href="classDomaineCutter.html#afceb976e349529db27883bdf2a52d60c">ref_domaine_</a>.<a class="code" href="classRef__.html#aefc8130f02e22c692853dd435cbd1c18" title="Annule la ref.">reset</a>();
<a name="l00972"></a>00972   <a class="code" href="classDomaineCutter.html#a9da3c1aef1b48f6d6566abbee7dbcb85">ref_elem_part_</a>.<a class="code" href="classRef__.html#aefc8130f02e22c692853dd435cbd1c18" title="Annule la ref.">reset</a>();
<a name="l00973"></a>00973   <a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a> = -1;
<a name="l00974"></a>00974   <a class="code" href="classDomaineCutter.html#a53b94536327688de8d72b5a36c2cf173">epaisseur_joint_</a> = -1;
<a name="l00975"></a>00975   <a class="code" href="classDomaineCutter.html#a6269ac4cb6130e39c5c5be181253fad5">som_elem_</a>.<a class="code" href="classStatic__Int__Lists.html#a0e0e3ede72f4efb729798d17e42f0294" title="detruit toutes les listes">reset</a>();
<a name="l00976"></a>00976 }
<a name="l00977"></a>00977 
<a name="l00978"></a><a class="code" href="DomaineCutter_8cpp.html#a89001120b42a3a2021e912f973f795b9">00978</a> <span class="keywordtype">void</span>  <a class="code" href="DomaineCutter_8cpp.html#a89001120b42a3a2021e912f973f795b9">calculer_listes_elements_sous_domaines</a>(<span class="keyword">const</span> <a class="code" href="classIntVect.html">IntVect</a>&amp; elem_part,
<a name="l00979"></a>00979                                              <span class="keyword">const</span> <span class="keywordtype">int</span> nb_parts,
<a name="l00980"></a>00980                                              <span class="keyword">const</span> <span class="keywordtype">int</span> nbelem,
<a name="l00981"></a>00981                                              <a class="code" href="classStatic__Int__Lists.html" title="Cette classe permet de stocker des listes d&#39;entiers accessibles en temps constant. La taille des listes ne peut pas changer sans perdre le contenu (ce sont des listes statiques). Exemple: Static_Int_List l; ArrOfInt tailles(3); tailles[0] = 2; tailles[1] = 3; tailles[2] = 0; // On reserve la memoire pour trois listes de taille 2, 3 et 0: l.set_list_sizes(tailles); // On affecte une valeur au deuxieme element de la premiere liste: l.set_value(0,1,765); // Affiche la valeur Cout &lt;&lt; l(0,1);.">Static_Int_Lists</a>&amp; liste_elems_sous_domaines)
<a name="l00982"></a>00982 {
<a name="l00983"></a>00983   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> sizes(nb_parts);
<a name="l00984"></a>00984 <span class="comment">// Premier passage : comptage</span>
<a name="l00985"></a>00985   <span class="keywordtype">int</span> i;
<a name="l00986"></a>00986   <span class="keywordflow">for</span> (i = 0; i &lt; nbelem; i++)
<a name="l00987"></a>00987     {
<a name="l00988"></a>00988       <span class="keyword">const</span> <span class="keywordtype">int</span> part = elem_part[i];
<a name="l00989"></a>00989       sizes[part]++;
<a name="l00990"></a>00990     }
<a name="l00991"></a>00991   liste_elems_sous_domaines.<a class="code" href="classStatic__Int__Lists.html#a60da63cb1970f5b87d1e1fdf6d65dcb2" title="detruit les listes existantes et en cree de nouvelles. On cree autant de listes que d&#39;elements dans l...">set_list_sizes</a>(sizes);
<a name="l00992"></a>00992 <span class="comment">// Deuxieme passage : remplissage</span>
<a name="l00993"></a>00993   sizes = 0;
<a name="l00994"></a>00994   <span class="keywordflow">for</span> (i = 0; i &lt; nbelem; i++)
<a name="l00995"></a>00995     {
<a name="l00996"></a>00996       <span class="keyword">const</span> <span class="keywordtype">int</span> part = elem_part[i];
<a name="l00997"></a>00997       <span class="keyword">const</span> <span class="keywordtype">int</span> index = sizes[part]++;
<a name="l00998"></a>00998       liste_elems_sous_domaines.<a class="code" href="classStatic__Int__Lists.html#ab56f42945e3057185cc1086e1cbc1bbb" title="affecte la &quot;valeur&quot; au j-ieme element de la i-ieme liste avec 0 &lt;= i &lt; get_nb_lists() et 0 &lt;= j &lt; get...">set_value</a>(part, index, i);
<a name="l00999"></a>00999     }
<a name="l01000"></a>01000 }
<a name="l01001"></a>01001 
<a name="l01002"></a><a class="code" href="DomaineCutter_8cpp.html#ad5a2c9a3de10b2385c5d6387060dc628">01002</a> <span class="keywordtype">void</span> <a class="code" href="DomaineCutter_8cpp.html#ad5a2c9a3de10b2385c5d6387060dc628">calculer_elements_voisins_bords</a>(<span class="keyword">const</span> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom,
<a name="l01003"></a>01003                                      <span class="keyword">const</span> <a class="code" href="classStatic__Int__Lists.html" title="Cette classe permet de stocker des listes d&#39;entiers accessibles en temps constant. La taille des listes ne peut pas changer sans perdre le contenu (ce sont des listes statiques). Exemple: Static_Int_List l; ArrOfInt tailles(3); tailles[0] = 2; tailles[1] = 3; tailles[2] = 0; // On reserve la memoire pour trois listes de taille 2, 3 et 0: l.set_list_sizes(tailles); // On affecte une valeur au deuxieme element de la premiere liste: l.set_value(0,1,765); // Affiche la valeur Cout &lt;&lt; l(0,1);.">Static_Int_Lists</a>&amp; som_elem,
<a name="l01004"></a>01004                                      <a class="code" href="classStatic__Int__Lists.html" title="Cette classe permet de stocker des listes d&#39;entiers accessibles en temps constant. La taille des listes ne peut pas changer sans perdre le contenu (ce sont des listes statiques). Exemple: Static_Int_List l; ArrOfInt tailles(3); tailles[0] = 2; tailles[1] = 3; tailles[2] = 0; // On reserve la memoire pour trois listes de taille 2, 3 et 0: l.set_list_sizes(tailles); // On affecte une valeur au deuxieme element de la premiere liste: l.set_value(0,1,765); // Affiche la valeur Cout &lt;&lt; l(0,1);.">Static_Int_Lists</a>&amp; voisins,<span class="keyword">const</span> <a class="code" href="classIntVect.html">IntVect</a>&amp; elem_part, <span class="keyword">const</span> <span class="keywordtype">int</span> permissif, <a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a>&amp; bords_a_pb_)
<a name="l01005"></a>01005 {
<a name="l01006"></a>01006   <span class="keyword">const</span> <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone = dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0);
<a name="l01007"></a>01007   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_front = zone.<a class="code" href="classZone.html#a9bf185c52ad1809d954bba670d9aed8a" title="Renvoie le nombre de bords + le nombre de raccords + le nombre de faces frontieres internes...">nb_front_Cl</a>();
<a name="l01008"></a>01008   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> nb_faces(nb_front);
<a name="l01009"></a>01009   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_front; i++)
<a name="l01010"></a>01010     nb_faces[i] = zone.<a class="code" href="classZone.html#ac338b119d4b0bc4f510a223b9086fe5e">frontiere</a>(i).<a class="code" href="classFrontiere.html#aa073fe9dbdddde59471ee7032b256aa2" title="Renvoie le nombre de faces de la frontiere.">nb_faces</a>();
<a name="l01011"></a>01011   voisins.<a class="code" href="classStatic__Int__Lists.html#a60da63cb1970f5b87d1e1fdf6d65dcb2" title="detruit les listes existantes et en cree de nouvelles. On cree autant de listes que d&#39;elements dans l...">set_list_sizes</a>(nb_faces);
<a name="l01012"></a>01012   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_som_face = zone.<a class="code" href="classZone.html#ac338b119d4b0bc4f510a223b9086fe5e">frontiere</a>(0).<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a1361d27e4c8b239c48de671fad23428c" title="Renvoie le nombre de sommet par face.">nb_som_faces</a>();
<a name="l01013"></a>01013   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> une_face(nb_som_face);
<a name="l01014"></a>01014   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> elems_voisins;
<a name="l01015"></a>01015   elems_voisins.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l01016"></a>01016   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_front; i++)
<a name="l01017"></a>01017     {
<a name="l01018"></a>01018       <span class="keywordtype">int</span> drap=0;
<a name="l01019"></a>01019       <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; faces = zone.<a class="code" href="classZone.html#ac338b119d4b0bc4f510a223b9086fe5e">frontiere</a>(i).<a class="code" href="classFrontiere.html#a6d1f96137ddae39a46985a8c3e53bcf5" title="Renvoie les sommets des faces de la frontiere.">les_sommets_des_faces</a>();
<a name="l01020"></a>01020       <span class="keyword">const</span> <span class="keywordtype">int</span> n = nb_faces[i];
<a name="l01021"></a>01021       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; n; j++)
<a name="l01022"></a>01022         {
<a name="l01023"></a>01023           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; nb_som_face; k++)
<a name="l01024"></a>01024             une_face[k] = faces(j, k);
<a name="l01025"></a>01025           <a class="code" href="Connectivite__som__elem_8cpp.html#afccbadf5344a16154a56b33dbddf88c1" title="Cherche les elements qui contiennent tous les sommets du tableau sommets_to_find (permet de trouver l...">find_adjacent_elements</a>(som_elem, une_face, elems_voisins);
<a name="l01026"></a>01026 
<a name="l01027"></a>01027           <span class="keyword">const</span> <span class="keywordtype">int</span> n_voisins = elems_voisins.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l01028"></a>01028           <span class="keywordflow">if</span> (n_voisins != 1)
<a name="l01029"></a>01029             {
<a name="l01030"></a>01030               <span class="keywordflow">if</span> (drap==0)
<a name="l01031"></a>01031                 {
<a name="l01032"></a>01032                   <span class="keywordflow">if</span> (permissif)
<a name="l01033"></a>01033                     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Message from DomaineCutter.cpp : calculer_elements_voisins_bords\n&quot;</span>
<a name="l01034"></a>01034                          &lt;&lt; <span class="stringliteral">&quot; boundary face &quot;</span>&lt;&lt;  zone.<a class="code" href="classZone.html#ac338b119d4b0bc4f510a223b9086fe5e">frontiere</a>(i).<a class="code" href="classFrontiere.html#a2868774681d6f050479a95cbc7cd6fc9" title="Renvoie le nom de la frontiere.">le_nom</a>()&lt;&lt;<span class="stringliteral">&quot; with &quot;</span> &lt;&lt; n_voisins &lt;&lt; <span class="stringliteral">&quot; neighbors.&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01035"></a>01035                   <span class="keywordflow">else</span>
<a name="l01036"></a>01036                     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in DomaineCutter.cpp : calculer_elements_voisins_bords\n&quot;</span>
<a name="l01037"></a>01037                          &lt;&lt; <span class="stringliteral">&quot; boundary face &quot;</span>&lt;&lt;  zone.<a class="code" href="classZone.html#ac338b119d4b0bc4f510a223b9086fe5e">frontiere</a>(i).<a class="code" href="classFrontiere.html#a2868774681d6f050479a95cbc7cd6fc9" title="Renvoie le nom de la frontiere.">le_nom</a>()&lt;&lt;<span class="stringliteral">&quot; with &quot;</span> &lt;&lt; n_voisins &lt;&lt; <span class="stringliteral">&quot; neighbors.&quot;</span> &lt;&lt; finl;
<a name="l01038"></a>01038                   bords_a_pb_.<a class="code" href="classVect__Nom.html#ae20c0d0842c00756c1a2610fe0ca471f">add</a>( zone.<a class="code" href="classZone.html#ac338b119d4b0bc4f510a223b9086fe5e">frontiere</a>(i).<a class="code" href="classFrontiere.html#a2868774681d6f050479a95cbc7cd6fc9" title="Renvoie le nom de la frontiere.">le_nom</a>());
<a name="l01039"></a>01039                   <span class="keywordflow">if</span> (elems_voisins.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>()==0) <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l01040"></a>01040                 }
<a name="l01041"></a>01041               drap=1;
<a name="l01042"></a>01042               <span class="keywordflow">if</span> (elem_part(elems_voisins[1])==1)
<a name="l01043"></a>01043                 elems_voisins[0]=elems_voisins[1];
<a name="l01044"></a>01044               <span class="keywordflow">if</span> (permissif==0)
<a name="l01045"></a>01045                 <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l01046"></a>01046             }
<a name="l01047"></a>01047           voisins.<a class="code" href="classStatic__Int__Lists.html#ab56f42945e3057185cc1086e1cbc1bbb" title="affecte la &quot;valeur&quot; au j-ieme element de la i-ieme liste avec 0 &lt;= i &lt; get_nb_lists() et 0 &lt;= j &lt; get...">set_value</a>(i, j, elems_voisins[0]);
<a name="l01048"></a>01048         }
<a name="l01049"></a>01049     }
<a name="l01050"></a>01050 }
<a name="l01051"></a>01051 
<a name="l01052"></a>01052 <span class="comment">//</span>
<a name="l01053"></a>01053 <span class="comment">//</span>
<a name="l01054"></a>01054 <span class="comment">//</span>
<a name="l01055"></a>01055 <span class="comment">//</span>
<a name="l01056"></a>01056 <span class="comment">//</span>
<a name="l01057"></a>01057 <span class="comment">//</span>
<a name="l01058"></a>01058 <span class="comment">//</span>
<a name="l01059"></a>01059 <span class="comment">//</span>
<a name="l01060"></a>01060 <span class="comment">//</span>
<a name="l01061"></a>01061 <span class="comment">//</span>
<a name="l01062"></a>01062 <span class="comment">//</span>
<a name="l01063"></a>01063 <span class="comment">//</span>
<a name="l01064"></a>01064 <span class="comment">//</span><span class="comment"></span>
<a name="l01065"></a>01065 <span class="comment">//! Prepare les structures de donnees pour la construction&lt;br&gt;des sous-domaines en fonction d&#39;un decoupage fourni dans elem_part.&lt;br&gt;Parametre: domaine_global&lt;br&gt;Signification: le domaine a decouper (doit avoir une zone). On prend une ref&lt;br&gt;a ce domaine (il doit donc rester valide).&lt;br&gt;Parametre: elem_part&lt;br&gt;Signification: pour chaque element, numero du sous-domaine auquel il appartient,&lt;br&gt;avec 0 &lt;= elem_part[i] &lt; nb_parts. Attention, on prend une ref a ce tableau, on&lt;br&gt;ne fait pas une copie local. Le tableau doit continuer a exister jusqu&#39;a ce qu&#39;on&lt;br&gt;a fini d&#39;utiliser DomaineCutter.&lt;br&gt;Parametre: nb_parts&lt;br&gt;Signification: nombre total de sous-domaines&lt;br&gt;Parametre: les_faces&lt;br&gt;Parametre: epaisseur_joint</span>
<a name="l01066"></a><a class="code" href="classDomaineCutter.html#a700d1294c0ad188e96dcfbd5903ae974">01066</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classDomaineCutter.html#a700d1294c0ad188e96dcfbd5903ae974" title="Prepare les structures de donnees pour la construction des sous-domaines en fonction d&#39;un decoupage f...">DomaineCutter::initialiser</a>(<span class="keyword">const</span> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp;   domaine_global,
<a name="l01067"></a>01067                                 <span class="keyword">const</span> <a class="code" href="classIntVect.html">IntVect</a>&amp; elem_part,
<a name="l01068"></a>01068                                 <span class="keyword">const</span> <span class="keywordtype">int</span>     nb_parts,
<a name="l01069"></a>01069                                 <span class="keyword">const</span> <span class="keywordtype">int</span>     epaisseur_joint,
<a name="l01070"></a>01070                                 <span class="keyword">const</span> <a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a>&amp;      liste_bords_periodiques,
<a name="l01071"></a>01071                                 <span class="keyword">const</span> <span class="keywordtype">int</span> permissif)
<a name="l01072"></a>01072 {
<a name="l01073"></a>01073   assert(nb_parts &gt;= 0);
<a name="l01074"></a>01074   assert(domaine_global.<a class="code" href="classDomaine.html#a9f3fc389a1310d1fc8b4b27976855376" title="Renvoie le nombre de zone du domaine.">nb_zones</a>() == 1);
<a name="l01075"></a>01075   assert(elem_part.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>() == domaine_global.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#aa3a33e8b723618b9092460007153e42d" title="Renvoie le nombre total d&#39;elements de la zone.">nb_elem_tot</a>());
<a name="l01076"></a>01076   assert(<a class="code" href="ArrOfDouble_8cpp.html#a95241fccf4bed7fb7a4e2340b7735f14" title="Retourne la valeur maximale.">max_array</a>(elem_part) &lt; nb_parts);
<a name="l01077"></a>01077   <span class="keywordflow">if</span> (<a class="code" href="ArrOfDouble_8cpp.html#abd3998749a1a8dab00dd6ac1798327fb" title="Retourne la valeur minimale.">min_array</a>(elem_part)&lt;0)
<a name="l01078"></a>01078     {
<a name="l01079"></a>01079       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in DomaineCutter::initialiser&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01080"></a>01080       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;The built partition has a default.&quot;</span> &lt;&lt; finl;
<a name="l01081"></a>01081       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Try to change the partition tool or try changing some partitioning options.&quot;</span> &lt;&lt; finl;
<a name="l01082"></a>01082       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Contact TRUST support if you are still unsuccessful with your tries.&quot;</span> &lt;&lt; finl;
<a name="l01083"></a>01083       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l01084"></a>01084     }
<a name="l01085"></a>01085   <a class="code" href="classDomaineCutter.html#a25ed06d3770465a4e4208555f4e5f5d2" title="annule toutes les references et vide les tableaux">reset</a>();
<a name="l01086"></a>01086 
<a name="l01087"></a>01087   <a class="code" href="classDomaineCutter.html#afceb976e349529db27883bdf2a52d60c">ref_domaine_</a> = domaine_global;
<a name="l01088"></a>01088   <a class="code" href="classDomaineCutter.html#a9da3c1aef1b48f6d6566abbee7dbcb85">ref_elem_part_</a> = elem_part;
<a name="l01089"></a>01089   <a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a> = nb_parts;
<a name="l01090"></a>01090   <a class="code" href="classDomaineCutter.html#a53b94536327688de8d72b5a36c2cf173">epaisseur_joint_</a> = epaisseur_joint;
<a name="l01091"></a>01091   <a class="code" href="classDomaineCutter.html#a78746f6428e7647f1eb79292c66c7147">liste_bords_periodiques_</a> = liste_bords_periodiques;
<a name="l01092"></a>01092 
<a name="l01093"></a>01093   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; elems = domaine_global.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#ac115e8342be89afb882b7b61cc343267" title="Renvoie le tableau des sommets des elements.">les_elems</a>();
<a name="l01094"></a>01094   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_som = domaine_global.<a class="code" href="classDomaine.html#a394e61cf1993665886de0fbbd0c0178e" title="Renvoie le nombre total de sommets.">nb_som_tot</a>();
<a name="l01095"></a>01095   <a class="code" href="Connectivite__som__elem_8cpp.html#a82161461a228e43ae236c31101ff3ce6" title="construction de la structure som_elem pour la zone donnee On cree pour chaque sommet i la liste des e...">construire_connectivite_som_elem</a>(nb_som, elems, <a class="code" href="classDomaineCutter.html#a6269ac4cb6130e39c5c5be181253fad5">som_elem_</a>,
<a name="l01096"></a>01096                                    1 <span class="comment">/* inclure les elems virtuels */</span>);
<a name="l01097"></a>01097 
<a name="l01098"></a>01098   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Search of neighboring elements of boundary faces&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01099"></a>01099   <a class="code" href="DomaineCutter_8cpp.html#ad5a2c9a3de10b2385c5d6387060dc628">calculer_elements_voisins_bords</a>(domaine_global, <a class="code" href="classDomaineCutter.html#a6269ac4cb6130e39c5c5be181253fad5">som_elem_</a>, <a class="code" href="classDomaineCutter.html#a396245cb32fa5d410b790146a274d4a8">voisins_bords_</a>,elem_part,permissif,<a class="code" href="classDomaineCutter.html#ad12026aab58f8a6670fe1415dfe5324e">bords_a_pb_</a>);
<a name="l01100"></a>01100   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Construction of lists of elements per subdomain&quot;</span> &lt;&lt; finl;
<a name="l01101"></a>01101   <a class="code" href="DomaineCutter_8cpp.html#a89001120b42a3a2021e912f973f795b9">calculer_listes_elements_sous_domaines</a>(elem_part, nb_parts, elems.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0), <a class="code" href="classDomaineCutter.html#abd0e4e1397f134880628a61dd7e629e7">liste_elems_sous_domaines_</a>);
<a name="l01102"></a>01102 <span class="comment">// calculer_listes_elements_sous_domaines(elem_part, nb_parts, liste_elems_sous_domaines_);</span>
<a name="l01103"></a>01103 
<a name="l01104"></a>01104 }
<a name="l01105"></a>01105 
<a name="l01106"></a>01106 <span class="comment">// Precondition:</span>
<a name="l01107"></a>01107 <span class="comment">// La methode initialiser doit avoir ete appelee avant</span>
<a name="l01108"></a>01108 <span class="comment">//</span>
<a name="l01109"></a>01109 <span class="comment">//</span>
<a name="l01110"></a>01110 <span class="comment">//</span>
<a name="l01111"></a>01111 <span class="comment">//</span>
<a name="l01112"></a>01112 <span class="comment">//</span>
<a name="l01113"></a>01113 <span class="comment">//</span><span class="comment"></span>
<a name="l01114"></a>01114 <span class="comment">//! Remplit la structure &quot;correspondance&quot; et le &quot;sous_domaine&quot;&lt;br&gt;pour la partie &quot;part&quot;. On cherche les sommets qui appartiennent a la sous-partie,&lt;br&gt;on calcule les tableaux de renumerotation des sommets et des elements entre numero&lt;br&gt;global et numero local (structure correspondance), on remplit les structures de&lt;br&gt;sous_domaine (sommets, elements, frontieres, joints, etc).&lt;br&gt;Attention: sous_domaine doit etre un objet vierge (ne pas contenir de zone)</span>
<a name="l01115"></a><a class="code" href="classDomaineCutter.html#a151d632d05724329525a5b05385ac2c1">01115</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classDomaineCutter.html#a151d632d05724329525a5b05385ac2c1" title="Remplit la structure &quot;correspondance&quot; et le &quot;sous_domaine&quot; pour la partie &quot;part&quot;. On cherche les somm...">DomaineCutter::construire_sous_domaine</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> part,
<a name="l01116"></a>01116                                             <a class="code" href="classDomaineCutter__Correspondance.html" title="Classe outil contenant la correspondance entre les indices de sommets et d&#39;elements du domaine global...">DomaineCutter_Correspondance</a>&amp; correspondance,
<a name="l01117"></a>01117                                             <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; sous_domaine, <span class="keyword">const</span> <a class="code" href="classStatic__Int__Lists.html" title="Cette classe permet de stocker des listes d&#39;entiers accessibles en temps constant. La taille des listes ne peut pas changer sans perdre le contenu (ce sont des listes statiques). Exemple: Static_Int_List l; ArrOfInt tailles(3); tailles[0] = 2; tailles[1] = 3; tailles[2] = 0; // On reserve la memoire pour trois listes de taille 2, 3 et 0: l.set_list_sizes(tailles); // On affecte une valeur au deuxieme element de la premiere liste: l.set_value(0,1,765); // Affiche la valeur Cout &lt;&lt; l(0,1);.">Static_Int_Lists</a>* som_raccord)<span class="keyword"> const</span>
<a name="l01118"></a>01118 <span class="keyword"></span>{
<a name="l01119"></a>01119 <span class="comment">// L&#39;objet doit etre initialise:</span>
<a name="l01120"></a>01120   assert(<a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a> &gt;= 0);
<a name="l01121"></a>01121 <span class="comment">// Pas de zone dans sous_domaine</span>
<a name="l01122"></a>01122   assert(sous_domaine.<a class="code" href="classDomaine.html#a9f3fc389a1310d1fc8b4b27976855376" title="Renvoie le nombre de zone du domaine.">nb_zones</a>() == 0);
<a name="l01123"></a>01123 <span class="comment">// Numero de partie valide</span>
<a name="l01124"></a>01124   assert(part &gt;= 0 &amp;&amp; part &lt; <a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a>);
<a name="l01125"></a>01125 
<a name="l01126"></a>01126   correspondance.<a class="code" href="classDomaineCutter__Correspondance.html#a80bcccac15c545419e7da12635b544d7">partie_</a> = part;
<a name="l01127"></a>01127 
<a name="l01128"></a>01128   <span class="keyword">const</span> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; domaine = <a class="code" href="classDomaineCutter.html#afceb976e349529db27883bdf2a52d60c">ref_domaine_</a>.<a class="code" href="classRef__Domaine.html#a89e1c374ada79faa2c7e9a76c3393ad8">valeur</a>();
<a name="l01129"></a>01129   <span class="keyword">const</span> <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp;     zone    = domaine.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0);
<a name="l01130"></a>01130 
<a name="l01131"></a>01131   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> elements_sous_partie;
<a name="l01132"></a>01132   <a class="code" href="classDomaineCutter.html#abd0e4e1397f134880628a61dd7e629e7">liste_elems_sous_domaines_</a>.<a class="code" href="classStatic__Int__Lists.html#ac5f80aca1def83653c95221f391b916d" title="copie la i-ieme liste dans le tableau fourni Le tableau array doit etre resizable.">copy_list_to_array</a>(part, elements_sous_partie);
<a name="l01133"></a>01133 
<a name="l01134"></a>01134 <span class="comment">// Preparation du sous_domaine</span>
<a name="l01135"></a>01135 <span class="comment">// sous_domaine.reset(); /* reset n&#39;existe pas encore... */</span>
<a name="l01136"></a>01136   sous_domaine.<a class="code" href="classDomaine.html#ae5d7a1cb2b05368fbb9a7ebec7793911" title="Donne un nom au domaine.">nommer</a>(domaine.<a class="code" href="classDomaine.html#a87e2cdc035a26565e6fe481446aa4cd3" title="Renvoie le nom du domaine.">le_nom</a>());
<a name="l01137"></a>01137 <span class="comment">// On cree une zone pour le domaine</span>
<a name="l01138"></a>01138   <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a> new_empty_zone;
<a name="l01139"></a>01139   <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone_partie = sous_domaine.<a class="code" href="classDomaine.html#a6204a2b89860bfd74ca2858d1d8750bf" title="Ajoute une Sous_Zone au domaine.">add</a>(new_empty_zone);
<a name="l01140"></a>01140 <span class="comment">// Nom de la zone</span>
<a name="l01141"></a>01141   {
<a name="l01142"></a>01142     <span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> nom_zone = zone.<a class="code" href="classZone.html#aad29ea7a38564404cc0417383233aaf0" title="Renvoie le nom de la zone.">le_nom</a>();
<a name="l01143"></a>01143     zone_partie.<a class="code" href="classZone.html#ad9cedce77314d4aa1d84a12958079b0e" title="Donne un nom a la zone.">nommer</a>(nom_zone);
<a name="l01144"></a>01144   }
<a name="l01145"></a>01145   zone_partie.<a class="code" href="classZone.html#a68a215145852861f2d513c959f52a1a5" title="Specifie le domaine dont la zone fait partie.">associer_domaine</a>(sous_domaine);
<a name="l01146"></a>01146   <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classPoly__geom__base.html" title=": class Poly_geom_base &lt;Description of class Poly_geom_base&gt;">Poly_geom_base</a>,zone.<a class="code" href="classZone.html#a18cf83cd0f9c368dcfa32fb802a0ac94" title="Renvoie un element geometrique du type de ceux qui constituent la zone. (version const)">type_elem</a>().<a class="code" href="classDeriv__Elem__geom__base.html#a384b487459a33f9f521fb16539ec81de">valeur</a>()))
<a name="l01147"></a>01147     <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classPoly__geom__base.html" title=": class Poly_geom_base &lt;Description of class Poly_geom_base&gt;">Poly_geom_base</a>,zone.<a class="code" href="classZone.html#a18cf83cd0f9c368dcfa32fb802a0ac94" title="Renvoie un element geometrique du type de ceux qui constituent la zone. (version const)">type_elem</a>().<a class="code" href="classDeriv__Elem__geom__base.html#a384b487459a33f9f521fb16539ec81de">valeur</a>()).build_reduced(zone_partie.<a class="code" href="classZone.html#a18cf83cd0f9c368dcfa32fb802a0ac94" title="Renvoie un element geometrique du type de ceux qui constituent la zone. (version const)">type_elem</a>(), elements_sous_partie);
<a name="l01148"></a>01148   <span class="keywordflow">else</span>
<a name="l01149"></a>01149     zone_partie.<a class="code" href="classZone.html#a18cf83cd0f9c368dcfa32fb802a0ac94" title="Renvoie un element geometrique du type de ceux qui constituent la zone. (version const)">type_elem</a>() = zone.<a class="code" href="classZone.html#a18cf83cd0f9c368dcfa32fb802a0ac94" title="Renvoie un element geometrique du type de ceux qui constituent la zone. (version const)">type_elem</a>();
<a name="l01150"></a>01150   zone_partie.<a class="code" href="classZone.html#a18cf83cd0f9c368dcfa32fb802a0ac94" title="Renvoie un element geometrique du type de ceux qui constituent la zone. (version const)">type_elem</a>().<a class="code" href="classElem__geom.html#a52107168bd97e24d851ca5f667c575e5" title="Appel a l&#39;objet sous-jacent Associe l&#39;element geometrique a sa zone.">associer_zone</a>(zone_partie);
<a name="l01151"></a>01151 
<a name="l01152"></a>01152   <a class="code" href="DomaineCutter_8cpp.html#a864ba9bfc1dd181f22111636ac9cd45d" title="Creation de la liste des sommets du sous-domaine &quot;partie&quot;. C&#39;est l&#39;ensemble des sommets des element...">construire_liste_sommets_sousdomaine</a>(domaine.<a class="code" href="classDomaine.html#a394e61cf1993665886de0fbbd0c0178e" title="Renvoie le nombre total de sommets.">nb_som_tot</a>(),
<a name="l01153"></a>01153                                        zone.<a class="code" href="classZone.html#ac115e8342be89afb882b7b61cc343267" title="Renvoie le tableau des sommets des elements.">les_elems</a>(),
<a name="l01154"></a>01154                                        elements_sous_partie,
<a name="l01155"></a>01155                                        part,
<a name="l01156"></a>01156                                        som_raccord,
<a name="l01157"></a>01157                                        correspondance.<a class="code" href="classDomaineCutter__Correspondance.html#a14d0ee827c30b03951418bd3a8bb87a6">liste_sommets_</a> <span class="comment">/* write */</span>,
<a name="l01158"></a>01158                                        correspondance.<a class="code" href="classDomaineCutter__Correspondance.html#ab96dbf96e1bcf775e6456b9e056018c5">liste_inverse_sommets_</a> <span class="comment">/* write */</span>);
<a name="l01159"></a>01159 
<a name="l01160"></a>01160   <a class="code" href="DomaineCutter_8cpp.html#adf74c004dd180d3a955e02b71acd8c52">remplir_coordsommets_sous_domaine</a>(domaine.<a class="code" href="classDomaine.html#aecd32c3eecc15cce7d1a0e468dadbf96" title="Renvoie le tableau des coordonnees des noeuds (sommets). (acces en lecture)">coord_sommets</a>(),
<a name="l01161"></a>01161                                     correspondance.<a class="code" href="classDomaineCutter__Correspondance.html#a14d0ee827c30b03951418bd3a8bb87a6">liste_sommets_</a>,
<a name="l01162"></a>01162                                     sous_domaine.<a class="code" href="classDomaine.html#a0846ac03a10b65c4df911fe35a19c02f" title="Renvoie le nombre total de sommets.">les_sommets</a>() <span class="comment">/* write */</span>);
<a name="l01163"></a>01163   <a class="code" href="DomaineCutter_8cpp.html#a0182ac071592d0b622994493f6c2a9a3">construire_elems_sous_domaine</a>(zone.<a class="code" href="classZone.html#ac115e8342be89afb882b7b61cc343267" title="Renvoie le tableau des sommets des elements.">les_elems</a>(),
<a name="l01164"></a>01164                                 elements_sous_partie,
<a name="l01165"></a>01165                                 correspondance.<a class="code" href="classDomaineCutter__Correspondance.html#ab96dbf96e1bcf775e6456b9e056018c5">liste_inverse_sommets_</a>,
<a name="l01166"></a>01166                                 zone_partie.<a class="code" href="classZone.html#ac115e8342be89afb882b7b61cc343267" title="Renvoie le tableau des sommets des elements.">les_elems</a>() <span class="comment">/* write */</span>,
<a name="l01167"></a>01167                                 correspondance.<a class="code" href="classDomaineCutter__Correspondance.html#abc0eef8c08a9f18f2fd41a2ccbc6972a">liste_inverse_elements_</a> <span class="comment">/* write */</span>);
<a name="l01168"></a>01168   {
<a name="l01169"></a>01169     <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; l_som     = correspondance.<a class="code" href="classDomaineCutter__Correspondance.html#a14d0ee827c30b03951418bd3a8bb87a6">liste_sommets_</a>;
<a name="l01170"></a>01170     <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; l_inv_som = correspondance.<a class="code" href="classDomaineCutter__Correspondance.html#ab96dbf96e1bcf775e6456b9e056018c5">liste_inverse_sommets_</a>;
<a name="l01171"></a>01171     <a class="code" href="classDomaineCutter.html#a2a1da80e63599c4e43955a05e24d4ce7">construire_faces_bords_ssdom</a>   (l_inv_som, part, zone_partie);
<a name="l01172"></a>01172     <a class="code" href="classDomaineCutter.html#a0d823ebe378eb13f8ebe8a95410f6565" title="Constructions des raccords de la sous_partie a partir des raccords du domaine global. Les Raccord_local_homogene sont transformes en Raccord_distant_homogene.">construire_faces_raccords_ssdom</a>(l_inv_som, part, zone_partie);
<a name="l01173"></a>01173     <a class="code" href="classDomaineCutter.html#aba35bd15f234dc72046ca3281e47afbc">construire_faces_internes_ssdom</a>(l_inv_som, part, zone_partie);
<a name="l01174"></a>01174     <a class="code" href="classDomaineCutter.html#adfdcdff976a3d5638a3b1f7b66e81826" title="Creation des joints et construction des listes et des tableaux de sommets joints pour tous les joints...">construire_sommets_joints_ssdom</a>(l_som, l_inv_som, part, som_raccord, zone_partie);
<a name="l01175"></a>01175   }
<a name="l01176"></a>01176 
<a name="l01177"></a>01177   <a class="code" href="classDomaineCutter.html#adf1b1154ac181e0fc367e7d78cedecaa">construire_faces_joints_ssdom</a>(part, correspondance, zone_partie);
<a name="l01178"></a>01178 
<a name="l01179"></a>01179 <span class="comment">// if som_raccord is used (for DecouperMulti), then construire_elements_distants_ssdom()</span>
<a name="l01180"></a>01180 <span class="comment">// can lead to the creation of empty joints -&gt; it must not be called</span>
<a name="l01181"></a>01181   <span class="keywordtype">int</span> compute_items_distants= <a class="code" href="classDecouper.html#a3547db48cde6991d341216127bff3091">Decouper::print_more_infos</a> &amp;&amp; !som_raccord; <span class="comment">//!&lt; To print NbElemDist informations</span>
<a name="l01182"></a>01182 <span class="comment"></span>  <span class="keywordflow">if</span> (compute_items_distants)
<a name="l01183"></a>01183     {
<a name="l01184"></a>01184 <span class="comment">// Cet algorithme sequentiel n&#39;est pas utilise en temps normal, sauf si</span>
<a name="l01185"></a>01185 <span class="comment">// on veut tester l&#39;algorithme parallele dans Scatter.cpp</span>
<a name="l01186"></a>01186 <span class="comment">// voir  CHECK_ALGO_ESPACE_VIRTUEL dans Scatter.cpp (Benoit Mathieu)</span>
<a name="l01187"></a>01187       <a class="code" href="classDomaineCutter.html#a9a64f400c752faa582fd92995665b60f" title="calcul et remplissage de zone_partie.joint(i).set_joint_item(Joint::ELEMENT).set_items_distants() (li...">construire_elements_distants_ssdom</a>(part,
<a name="l01188"></a>01188                                          correspondance.<a class="code" href="classDomaineCutter__Correspondance.html#a14d0ee827c30b03951418bd3a8bb87a6">liste_sommets_</a>,
<a name="l01189"></a>01189                                          correspondance.<a class="code" href="classDomaineCutter__Correspondance.html#abc0eef8c08a9f18f2fd41a2ccbc6972a">liste_inverse_elements_</a>,
<a name="l01190"></a>01190                                          zone_partie);
<a name="l01191"></a>01191     }
<a name="l01192"></a>01192   <span class="keywordflow">else</span>
<a name="l01193"></a>01193     {
<a name="l01194"></a>01194 <span class="comment">// Initialiser des joints vides (sinon assert en debug car les joints ne sont pas initialises)</span>
<a name="l01195"></a>01195       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ij = 0; ij &lt; zone_partie.<a class="code" href="classZone.html#ab096afb61e89705709a4ae6d3576a644" title="Renvoie le nombre de joints de la zone.">nb_joints</a>(); ij++)
<a name="l01196"></a>01196         {
<a name="l01197"></a>01197           <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp;     joint = zone_partie.<a class="code" href="classZone.html#acec4c61032df8b55a95f9e7197ef6e3c" title="Renvoie le i-ieme joint de la zone&lt;br&gt;(version const)">joint</a>(ij);
<a name="l01198"></a>01198           joint.<a class="code" href="classJoint.html#aa1c4d729a3017082d26907d82ad1d7de" title="Renvoie les informations de joint pour un type d&#39;item geometrique donne, pour remplissage des structu...">set_joint_item</a>(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926ae32de3a01fdb3ad6c506b8058a7f6173">Joint::ELEMENT</a>).<a class="code" href="classJoint__Items.html#a13add264f4ad36ef4bddbfc1b7bdb817" title="Renvoie le tableau items_distants_ pour le remplir Voir Scatter::calculer_espace_distant, Scatter::calculer_espace_distant_faces_frontieres, Scatter::calculer_espace_distant_elements.">set_items_distants</a>();
<a name="l01199"></a>01199         }
<a name="l01200"></a>01200     }
<a name="l01201"></a>01201   <a class="code" href="classScatter.html#ac5dd6d7661490708649976cde509f480" title="Tri des joints dans l&#39;ordre croissant des processeurs.">Scatter::trier_les_joints</a>(zone_partie.<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>());
<a name="l01202"></a>01202 }
<a name="l01203"></a>01203 
<a name="l01204"></a>01204 <span class="comment">//</span>
<a name="l01205"></a>01205 <span class="comment">//</span>
<a name="l01206"></a>01206 <span class="comment">//</span>
<a name="l01207"></a>01207 <span class="comment">//</span>
<a name="l01208"></a>01208 <span class="comment">//</span><span class="comment"></span>
<a name="l01209"></a>01209 <span class="comment">//! Build the name of the &quot;.Zones&quot; file for a given proc and a domain.&lt;br&gt;If partie == -1 a single filename is returned. For example&lt;br&gt;DOM.Zones&lt;br&gt;instead of&lt;br&gt;DOM_0001.Zones</span>
<a name="l01210"></a><a class="code" href="DomaineCutter_8cpp.html#a9e5238b7b86ba22c11d18274d708a57d">01210</a> <span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="DomaineCutter_8cpp.html#a9e5238b7b86ba22c11d18274d708a57d" title="Build the name of the &quot;.Zones&quot; file for a given proc and a domain. If partie == -1 a single filename ...">construire_nom_fichier_sous_domaine</a>(<span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; basename,
<a name="l01211"></a>01211                                                 <span class="keyword">const</span> <span class="keywordtype">int</span> partie, <span class="keyword">const</span> <span class="keywordtype">int</span> nb_parties_,
<a name="l01212"></a>01212                                                 <span class="keyword">const</span> <span class="keywordtype">int</span> original_proc,
<a name="l01213"></a>01213                                                 <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; fichier)
<a name="l01214"></a>01214 {
<a name="l01215"></a>01215   fichier = basename;
<a name="l01216"></a>01216 
<a name="l01217"></a>01217   <span class="keywordflow">if</span> (partie &gt; 100000)
<a name="l01218"></a>01218     {
<a name="l01219"></a>01219       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error while generating filename: nb_parties_ too large&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01220"></a>01220       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l01221"></a>01221     }
<a name="l01222"></a>01222   <span class="keywordtype">char</span> s[30];
<a name="l01223"></a>01223 <span class="comment">// single file name for all procs (HDF5)</span>
<a name="l01224"></a>01224 <span class="comment">// the number of parts is still included in the file name</span>
<a name="l01225"></a>01225 <span class="comment">// (make_PAR.data needs to know how many zones there are)</span>
<a name="l01226"></a>01226   <span class="keywordflow">if</span> (partie &lt; 0)
<a name="l01227"></a>01227     {
<a name="l01228"></a>01228       <span class="keywordflow">if</span> (nb_parties_ &gt; 10000)
<a name="l01229"></a>01229         sprintf(s, <span class="stringliteral">&quot;_p%05d.Zones&quot;</span>, (<a class="code" href="arch_8h.html#a1caaf369d9c5f0817dbaa76b43b8d87b">True_int</a>)nb_parties_);
<a name="l01230"></a>01230       <span class="keywordflow">else</span>
<a name="l01231"></a>01231         sprintf(s, <span class="stringliteral">&quot;_p%04d.Zones&quot;</span>,(<a class="code" href="arch_8h.html#a1caaf369d9c5f0817dbaa76b43b8d87b">True_int</a>) nb_parties_);
<a name="l01232"></a>01232     }
<a name="l01233"></a>01233   <span class="keywordflow">else</span>
<a name="l01234"></a>01234     {
<a name="l01235"></a>01235       <span class="keywordflow">if</span> (nb_parties_ &gt; 10000)
<a name="l01236"></a>01236         {
<a name="l01237"></a>01237           <span class="keywordflow">if</span>(original_proc &lt; 0)
<a name="l01238"></a>01238             sprintf(s, <span class="stringliteral">&quot;_%05d.Zones&quot;</span>, (<a class="code" href="arch_8h.html#a1caaf369d9c5f0817dbaa76b43b8d87b">True_int</a>)partie);
<a name="l01239"></a>01239           <span class="keywordflow">else</span>
<a name="l01240"></a>01240             sprintf(s, <span class="stringliteral">&quot;_%05d_%d.Zones&quot;</span>, (<a class="code" href="arch_8h.html#a1caaf369d9c5f0817dbaa76b43b8d87b">True_int</a>)partie, (<a class="code" href="arch_8h.html#a1caaf369d9c5f0817dbaa76b43b8d87b">True_int</a>)original_proc);
<a name="l01241"></a>01241         }
<a name="l01242"></a>01242       <span class="keywordflow">else</span>
<a name="l01243"></a>01243         {
<a name="l01244"></a>01244           <span class="keywordflow">if</span>(original_proc &lt; 0)
<a name="l01245"></a>01245             sprintf(s, <span class="stringliteral">&quot;_%04d.Zones&quot;</span>, (<a class="code" href="arch_8h.html#a1caaf369d9c5f0817dbaa76b43b8d87b">True_int</a>)partie);
<a name="l01246"></a>01246           <span class="keywordflow">else</span>
<a name="l01247"></a>01247             sprintf(s, <span class="stringliteral">&quot;_%04d_%d.Zones&quot;</span>, (<a class="code" href="arch_8h.html#a1caaf369d9c5f0817dbaa76b43b8d87b">True_int</a>)partie, (<a class="code" href="arch_8h.html#a1caaf369d9c5f0817dbaa76b43b8d87b">True_int</a>)original_proc);
<a name="l01248"></a>01248         }
<a name="l01249"></a>01249     }
<a name="l01250"></a>01250   fichier += <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(s);
<a name="l01251"></a>01251 }
<a name="l01252"></a>01252 
<a name="l01253"></a>01253 
<a name="l01254"></a><a class="code" href="classDomaineCutter.html#a6915956c4d26e4de8bb8f82c848108d0">01254</a> <span class="keywordtype">void</span> <a class="code" href="classDomaineCutter.html#a6915956c4d26e4de8bb8f82c848108d0">DomaineCutter::writeData</a>(<span class="keyword">const</span> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; sous_domaine, <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os)<span class="keyword"> const</span>
<a name="l01255"></a>01255 <span class="keyword"></span>{
<a name="l01256"></a>01256   os &lt;&lt; sous_domaine;
<a name="l01257"></a>01257 <span class="comment">// Benoit Mathieu: Scatter a besoin de la liste des bords periodiques pour le</span>
<a name="l01258"></a>01258 <span class="comment">// calcul des elements distants. Je l&#39;ecris apres le domaine dans le fichier .Zones.</span>
<a name="l01259"></a>01259 <span class="comment">// Pas genial mais c&#39;est pour depanner en attendant mieux.</span>
<a name="l01260"></a>01260   os &lt;&lt; <a class="code" href="classDomaineCutter.html#a78746f6428e7647f1eb79292c66c7147">liste_bords_periodiques_</a>;
<a name="l01261"></a>01261 }
<a name="l01262"></a>01262 
<a name="l01263"></a>01263 <span class="comment">//</span>
<a name="l01264"></a>01264 <span class="comment">//</span>
<a name="l01265"></a>01265 <span class="comment">//</span>
<a name="l01266"></a>01266 <span class="comment">//</span><span class="comment"></span>
<a name="l01267"></a>01267 <span class="comment">//! Generation de tous les sous-domaines du calcul et ecriture sur disque des&lt;br&gt;fichiers basename_000n.Zones pour 0 &lt;= n &lt; nb_parties_.&lt;br&gt;Si des &quot;sous-zones&quot; sont definies (dans le champ domaine.ss_zones()),&lt;br&gt;on genere aussi un fichier par sous-zone.</span>
<a name="l01268"></a><a class="code" href="classDomaineCutter.html#a77aab8be2856e40a5788398e36f411cc">01268</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classDomaineCutter.html#a77aab8be2856e40a5788398e36f411cc" title="Generation de tous les sous-domaines du calcul et ecriture sur disque des fichiers basename_000n...">DomaineCutter::ecrire_zones</a>(<span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; basename, <span class="keyword">const</span> <a class="code" href="classDecouper.html#a6185c781230e9987f8d0ed3deba63c77">Decouper::ZonesFileOutputType</a> format, <a class="code" href="classIntVect.html">IntVect</a>&amp; elem_part, <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; reorder, <span class="keyword">const</span> <a class="code" href="classStatic__Int__Lists.html" title="Cette classe permet de stocker des listes d&#39;entiers accessibles en temps constant. La taille des listes ne peut pas changer sans perdre le contenu (ce sont des listes statiques). Exemple: Static_Int_List l; ArrOfInt tailles(3); tailles[0] = 2; tailles[1] = 3; tailles[2] = 0; // On reserve la memoire pour trois listes de taille 2, 3 et 0: l.set_list_sizes(tailles); // On affecte une valeur au deuxieme element de la premiere liste: l.set_value(0,1,765); // Affiche la valeur Cout &lt;&lt; l(0,1);.">Static_Int_Lists</a>* som_raccord)
<a name="l01269"></a>01269 {
<a name="l01270"></a>01270   assert(<a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a> &gt;= 0);
<a name="l01271"></a>01271   <span class="keyword">const</span> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; domaine = <a class="code" href="classDomaineCutter.html#afceb976e349529db27883bdf2a52d60c">ref_domaine_</a>.<a class="code" href="classRef__Domaine.html#a89e1c374ada79faa2c7e9a76c3393ad8">valeur</a>();
<a name="l01272"></a>01272   <a class="code" href="classDomaineCutter__Correspondance.html" title="Classe outil contenant la correspondance entre les indices de sommets et d&#39;elements du domaine global...">DomaineCutter_Correspondance</a> dc_correspondance;
<a name="l01273"></a>01273 
<a name="l01274"></a>01274 <span class="comment">// Needed for HDF5 Zones output:</span>
<a name="l01275"></a>01275 <span class="preprocessor">#ifdef MPI_</span>
<a name="l01276"></a>01276 <span class="preprocessor"></span>  <a class="code" href="classFichierHDFPar.html" title="Parallel collective version of FichierHDF, to be used for all concurrent reading/writing on HDF files...">FichierHDFPar</a> fic_hdf;
<a name="l01277"></a>01277 <span class="preprocessor">#else</span>
<a name="l01278"></a>01278 <span class="preprocessor"></span>  <a class="code" href="classFichierHDF.html" title="This abstract class provides all the functionalities to open and manipulate HDF files and related con...">FichierHDF</a> fic_hdf;
<a name="l01279"></a>01279 <span class="preprocessor">#endif</span>
<a name="l01280"></a>01280 <span class="preprocessor"></span>  <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> nom_fichier_hdf5(basename);
<a name="l01281"></a>01281   nom_fichier_hdf5+=<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(<span class="stringliteral">&quot;.Zones&quot;</span>);
<a name="l01282"></a>01282   nom_fichier_hdf5 = nom_fichier_hdf5.<a class="code" href="classNom.html#a49a5c6438b6efe73ab314900c60a329c" title="Insere _prefix000n (n=me() ou nproc()) dans un nom de fichier (par ex:toto.titi) pour donner toto_pre...">nom_me</a>(<a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a>, <span class="stringliteral">&quot;p&quot;</span>, 1);
<a name="l01283"></a>01283 
<a name="l01284"></a>01284 <span class="comment">// Build temp arrays to eventually reorder the partition numbering</span>
<a name="l01285"></a>01285   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> ia(<a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a>+1);
<a name="l01286"></a>01286   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> ja;
<a name="l01287"></a>01287   ja.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l01288"></a>01288   <span class="keywordtype">int</span> nnz=0;
<a name="l01289"></a>01289   ia[0]=1;
<a name="l01290"></a>01290 
<a name="l01291"></a>01291 <span class="comment">// To detect my parts (when running in parallel)</span>
<a name="l01292"></a>01292   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> myZones(<a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a>);
<a name="l01293"></a>01293   myZones = 0;
<a name="l01294"></a>01294   <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>) otherProcZones(<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>());
<a name="l01295"></a>01295 
<a name="l01296"></a>01296 <span class="comment">// if some zones are splitted between multiple procs,</span>
<a name="l01297"></a>01297 <span class="comment">// we assign consecutive indices to each of its fragment</span>
<a name="l01298"></a>01298 <span class="comment">// (reading the .Zones files during Scatter will be more efficient)</span>
<a name="l01299"></a>01299 <span class="comment">// Possible values for zones_index[part]:</span>
<a name="l01300"></a>01300 <span class="comment">// -2    : means that part is detained by multiple procs but not by me</span>
<a name="l01301"></a>01301 <span class="comment">// -1    : means that part is detained by a single proc</span>
<a name="l01302"></a>01302 <span class="comment">// i &gt;=0 : means that my proc detains the i-th fragment of part</span>
<a name="l01303"></a>01303   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> zones_index(<a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a>);
<a name="l01304"></a>01304   zones_index = -2;
<a name="l01305"></a>01305 
<a name="l01306"></a>01306   <span class="keyword">const</span> <span class="keywordtype">int</span> nbelem = domaine.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a7f249429803b27139a1c54436f6164a5" title="Renvoie le nombre d&#39;elements de la zone.">nb_elem</a>();
<a name="l01307"></a>01307 
<a name="l01308"></a>01308   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Generation of &quot;</span> &lt;&lt; <a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a> &lt;&lt; <span class="stringliteral">&quot; parts:&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01309"></a>01309   <a class="code" href="classIntVect.html">IntVect</a> EdgeCut(<a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a>);
<a name="l01310"></a>01310   <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>) Neighbours(<a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a>);
<a name="l01311"></a>01311 <span class="comment">// 2 loops if reorder=1</span>
<a name="l01312"></a>01312   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> loop=0; loop&lt;1+reorder; loop++)
<a name="l01313"></a>01313     {
<a name="l01314"></a>01314       <span class="keywordflow">if</span> (reorder)
<a name="l01315"></a>01315         {
<a name="l01316"></a>01316           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;====================================&quot;</span> &lt;&lt; finl;
<a name="l01317"></a>01317           <span class="keywordflow">if</span> (loop==0)
<a name="l01318"></a>01318             <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;FIRST PASS, analyzing the partition:&quot;</span> &lt;&lt; finl;
<a name="l01319"></a>01319           <span class="keywordflow">else</span>
<a name="l01320"></a>01320             <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;SECOND PASS, after reordering the partition:&quot;</span> &lt;&lt; finl;
<a name="l01321"></a>01321           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;====================================&quot;</span> &lt;&lt; finl;
<a name="l01322"></a>01322         }
<a name="l01323"></a>01323 
<a name="l01324"></a>01324       <span class="keywordflow">if</span>(loop == reorder)
<a name="l01325"></a>01325         {
<a name="l01326"></a>01326 <span class="comment">// check to see which part is shared between multiple processors:</span>
<a name="l01327"></a>01327 <span class="comment">// 1- everyone sends the number of the parts that belong to them to the master process</span>
<a name="l01328"></a>01328 <span class="comment">// 2- master process will assign a unique positive number to each fragment of a shared zone</span>
<a name="l01329"></a>01329 <span class="comment">// 3- if a part is owned by a single process, it is indicated with the index -1</span>
<a name="l01330"></a>01330 <span class="comment">// 4- the master process scatters the indices to all the proc</span>
<a name="l01331"></a>01331           <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>) zones_indices(<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>());
<a name="l01332"></a>01332 
<a name="l01333"></a>01333           <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i &lt; nbelem; i++)
<a name="l01334"></a>01334             {
<a name="l01335"></a>01335               <span class="keyword">const</span> <span class="keywordtype">int</span> part = elem_part[i];
<a name="l01336"></a>01336               myZones[part] = 1;
<a name="l01337"></a>01337             }
<a name="l01338"></a>01338 
<a name="l01339"></a>01339           <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0; p&lt;<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>(); p++)
<a name="l01340"></a>01340             {
<a name="l01341"></a>01341               <span class="keywordflow">if</span>(p==0)
<a name="l01342"></a>01342                 otherProcZones[p] = myZones;
<a name="l01343"></a>01343               <span class="keywordflow">else</span>
<a name="l01344"></a>01344                 {
<a name="l01345"></a>01345                   otherProcZones[p].<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(<a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a>);
<a name="l01346"></a>01346                   otherProcZones[p] = 0;
<a name="l01347"></a>01347                 }
<a name="l01348"></a>01348             }
<a name="l01349"></a>01349           <span class="keywordflow">if</span>(<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l01350"></a>01350             {
<a name="l01351"></a>01351               <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0; p&lt;<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>(); p++)
<a name="l01352"></a>01352                 {
<a name="l01353"></a>01353                   zones_indices[p].resize_array(<a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a>);
<a name="l01354"></a>01354                   zones_indices[p] = -2;
<a name="l01355"></a>01355                   <span class="keywordflow">if</span>(p!=0)
<a name="l01356"></a>01356                     <a class="code" href="communications_8cpp.html#a729d9499913e22a5f0db62ef07b9793f">recevoir</a>(otherProcZones[p], p, 0, p+2001);
<a name="l01357"></a>01357                 }
<a name="l01358"></a>01358 
<a name="l01359"></a>01359               <span class="keywordflow">for</span>(<span class="keywordtype">int</span> part=0; part&lt;<a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a>; part++)
<a name="l01360"></a>01360                 {
<a name="l01361"></a>01361                   <span class="keywordtype">int</span> s = 0;
<a name="l01362"></a>01362                   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> proc=0; proc &lt; <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>(); proc++)
<a name="l01363"></a>01363                     {
<a name="l01364"></a>01364                       <span class="keywordflow">if</span>(otherProcZones[proc][part])
<a name="l01365"></a>01365                         zones_indices[proc][part] = s++;
<a name="l01366"></a>01366                     }
<a name="l01367"></a>01367 
<a name="l01368"></a>01368                   <span class="keywordflow">if</span>(s&lt;=1)
<a name="l01369"></a>01369                     {
<a name="l01370"></a>01370                       <span class="keywordflow">if</span>(s==0)   <span class="comment">//empty part: master process will write it</span>
<a name="l01371"></a>01371                         myZones[part] = 1;
<a name="l01372"></a>01372 
<a name="l01373"></a>01373 <span class="comment">// part is detained by a single proc</span>
<a name="l01374"></a>01374                       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> proc=0; proc &lt; <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>(); proc++)
<a name="l01375"></a>01375                         zones_indices[proc][part] = -1;
<a name="l01376"></a>01376                     }
<a name="l01377"></a>01377                 }
<a name="l01378"></a>01378 
<a name="l01379"></a>01379               <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p=0; p&lt;<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>(); p++)
<a name="l01380"></a>01380                 {
<a name="l01381"></a>01381                   <span class="keywordflow">if</span>(p==0)
<a name="l01382"></a>01382                     zones_index = zones_indices[p];
<a name="l01383"></a>01383                   <span class="keywordflow">else</span>
<a name="l01384"></a>01384                     <a class="code" href="communications_8cpp.html#af9feb6405277b375b2ebcbfaec9f8af3">envoyer</a>(zones_indices[p], 0, p, p+2002);
<a name="l01385"></a>01385                 }
<a name="l01386"></a>01386             }
<a name="l01387"></a>01387           <span class="keywordflow">else</span>
<a name="l01388"></a>01388             {
<a name="l01389"></a>01389               <a class="code" href="communications_8cpp.html#af9feb6405277b375b2ebcbfaec9f8af3">envoyer</a>(myZones, <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>(), 0, <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>()+2001);
<a name="l01390"></a>01390               <a class="code" href="communications_8cpp.html#a729d9499913e22a5f0db62ef07b9793f">recevoir</a>(zones_index, 0, <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>(), <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>()+2002);
<a name="l01391"></a>01391             }
<a name="l01392"></a>01392 
<a name="l01393"></a>01393           <span class="keywordflow">if</span> (format == <a class="code" href="classDecouper.html#a6185c781230e9987f8d0ed3deba63c77ab6eb35dc70963341302e570b944c7b44">Decouper::HDF5_SINGLE</a>)  <span class="comment">//!&lt; create HDF5 file only once!</span>
<a name="l01394"></a>01394 <span class="comment"></span>            {
<a name="l01395"></a>01395               fic_hdf.<a class="code" href="classFichierHDF.html#ae8d1c1444d9d7ac5d0bef32feaa050df">create</a>(nom_fichier_hdf5);
<a name="l01396"></a>01396               <span class="keywordflow">if</span>(Process::nproc() &gt; 1)
<a name="l01397"></a>01397                 {
<a name="l01398"></a>01398 <span class="comment">// creating datasets</span>
<a name="l01399"></a>01399                   <a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a> dataset_names;
<a name="l01400"></a>01400                   <span class="keywordflow">if</span>(<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l01401"></a>01401                     {
<a name="l01402"></a>01402                       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> part=0; part&lt;<a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a>; part++)
<a name="l01403"></a>01403                         {
<a name="l01404"></a>01404                           <span class="keywordflow">if</span>(zones_index[part] == -1)
<a name="l01405"></a>01405                             {
<a name="l01406"></a>01406                               std::string dname = <span class="stringliteral">&quot;/zone_&quot;</span>  + std::to_string(part);
<a name="l01407"></a>01407                               <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> dataset_name(dname.c_str());
<a name="l01408"></a>01408                               dataset_names.<a class="code" href="classVect__Nom.html#ae20c0d0842c00756c1a2610fe0ca471f">add</a>(dataset_name);
<a name="l01409"></a>01409                             }
<a name="l01410"></a>01410                           <span class="keywordflow">else</span>
<a name="l01411"></a>01411                             {
<a name="l01412"></a>01412                               <span class="keywordflow">for</span>(<span class="keywordtype">int</span> proc=0; proc &lt; <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>(); proc++)
<a name="l01413"></a>01413                                 {
<a name="l01414"></a>01414                                   <span class="keywordflow">if</span>(zones_indices[proc][part] &gt;=0)
<a name="l01415"></a>01415                                     {
<a name="l01416"></a>01416                                       std::string dname = <span class="stringliteral">&quot;/zone_&quot;</span>  + std::to_string(part) + <span class="stringliteral">&quot;_&quot;</span> + std::to_string(zones_indices[proc][part]);
<a name="l01417"></a>01417                                       <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> dataset_name(dname.c_str());
<a name="l01418"></a>01418                                       dataset_names.<a class="code" href="classVect__Nom.html#ae20c0d0842c00756c1a2610fe0ca471f">add</a>(dataset_name);
<a name="l01419"></a>01419                                     }
<a name="l01420"></a>01420                                 }
<a name="l01421"></a>01421                             }
<a name="l01422"></a>01422                         }
<a name="l01423"></a>01423 
<a name="l01424"></a>01424                     }
<a name="l01425"></a>01425 
<a name="l01426"></a>01426 <span class="comment">// estimation of an upper bound of the datasets&#39; size</span>
<a name="l01427"></a>01427                   <span class="keywordtype">int</span> ipart = 0;
<a name="l01428"></a>01428                   <span class="keywordflow">while</span>(!myZones[ipart]) ipart++;
<a name="l01429"></a>01429                   <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a> dom_tmp;
<a name="l01430"></a>01430                   <a class="code" href="classDomaineCutter.html#a151d632d05724329525a5b05385ac2c1" title="Remplit la structure &quot;correspondance&quot; et le &quot;sous_domaine&quot; pour la partie &quot;part&quot;. On cherche les somm...">construire_sous_domaine</a>(ipart, dc_correspondance, dom_tmp);
<a name="l01431"></a>01431                   <a class="code" href="classSortie__Brute.html" title="This derived class of Sortie stacks whatever it receives in an internal binary buffer. Data can be accessed through get_data().">Sortie_Brute</a> os_tmp;
<a name="l01432"></a>01432                   <a class="code" href="classDomaineCutter.html#a6915956c4d26e4de8bb8f82c848108d0">writeData</a>(dom_tmp, os_tmp);
<a name="l01433"></a>01433                   <span class="keywordtype">long</span> sz_ = os_tmp.<a class="code" href="classSortie__Brute.html#a6f6dbbd9d0b7795ee205279b59c643bd">get_size</a>();
<a name="l01434"></a>01434                   sz_ *= 1.5;
<a name="l01435"></a>01435                   sz_ = <a class="code" href="classProcess.html#a1e9d9f9899b71927cfafae14c7bd048d" title="Calcule le max de x sur tous les processeurs du groupe courant. Remarques : Cette methode doit etre a...">Process::mp_max</a>(sz_);
<a name="l01436"></a>01436                   <a class="code" href="communications_8cpp.html#a2335b36078ae87e23dab400a6e129a3c">envoyer_broadcast</a>(dataset_names,0);
<a name="l01437"></a>01437                   fic_hdf.create_datasets(dataset_names, sz_);
<a name="l01438"></a>01438                 }
<a name="l01439"></a>01439             }
<a name="l01440"></a>01440 
<a name="l01441"></a>01441         }
<a name="l01442"></a>01442       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_part = 0; i_part &lt; <a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a>; i_part++)
<a name="l01443"></a>01443         {
<a name="l01444"></a>01444           <span class="keywordflow">if</span>(!myZones[i_part])
<a name="l01445"></a>01445             <span class="keywordflow">continue</span>;
<a name="l01446"></a>01446 
<a name="l01447"></a>01447           assert(zones_index[i_part] &gt; -2);
<a name="l01448"></a>01448           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Construction of part number &quot;</span> &lt;&lt; i_part &lt;&lt; finl;
<a name="l01449"></a>01449           <span class="keywordflow">if</span>(zones_index[i_part] &gt;= 0)
<a name="l01450"></a>01450             <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;This part is shared between multiple processors&quot;</span> &lt;&lt; finl;
<a name="l01451"></a>01451 
<a name="l01452"></a>01452           <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a> sous_domaine;
<a name="l01453"></a>01453           <a class="code" href="classDomaineCutter.html#a151d632d05724329525a5b05385ac2c1" title="Remplit la structure &quot;correspondance&quot; et le &quot;sous_domaine&quot; pour la partie &quot;part&quot;. On cherche les somm...">construire_sous_domaine</a>(i_part, dc_correspondance, sous_domaine, som_raccord);
<a name="l01454"></a>01454 <span class="comment">// On affiche quelques informations...</span>
<a name="l01455"></a>01455           {
<a name="l01456"></a>01456             <span class="keyword">const</span> <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone = sous_domaine.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0);
<a name="l01457"></a>01457             <span class="keyword">const</span> <a class="code" href="classJoints.html" title="Classe Joints Cette classe represente une liste d&#39;objet de type Joint.">Joints</a>&amp; joints = zone.<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>();
<a name="l01458"></a>01458             <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; nb_joints = joints.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>();
<a name="l01459"></a>01459             <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;  Number of nodes    : &quot;</span> &lt;&lt; sous_domaine.<a class="code" href="classDomaine.html#abc4abc8b8db5bebeb161fae4162a89ce" title="Renvoie le nombre de sommets.">nb_som</a>() &lt;&lt; finl;
<a name="l01460"></a>01460             <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;  Number of elements : &quot;</span> &lt;&lt; zone.<a class="code" href="classZone.html#a7f249429803b27139a1c54436f6164a5" title="Renvoie le nombre d&#39;elements de la zone.">nb_elem</a>() &lt;&lt; finl;
<a name="l01461"></a>01461             <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;  Number of joints   : &quot;</span> &lt;&lt; nb_joints &lt;&lt; finl;
<a name="l01462"></a>01462 <span class="comment">// char s[200];</span>
<a name="l01463"></a>01463             <span class="keywordtype">int</span> nbfaces_total=0;
<a name="l01464"></a>01464             <span class="keywordtype">int</span> nbelemdist_total=0;
<a name="l01465"></a>01465             <span class="keywordtype">int</span> nbsom_total=0;
<a name="l01466"></a>01466             Neighbours[i_part].resize_array(0);
<a name="l01467"></a>01467             Neighbours[i_part].resize_array(nb_joints);
<a name="l01468"></a>01468             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_joints; i++)
<a name="l01469"></a>01469               {
<a name="l01470"></a>01470                 <span class="keyword">const</span> <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp; joint = joints[i];
<a name="l01471"></a>01471                 <span class="keyword">const</span> <span class="keywordtype">int</span> pe = joint.<a class="code" href="classJoint.html#a0952bc5c7805434ccd8cd5c9b01e3747" title="Renvoie PEvoisin (numero de la zone voisine)">PEvoisin</a>();
<a name="l01472"></a>01472                 Neighbours[i_part][i] = pe;
<a name="l01473"></a>01473                 <span class="keyword">const</span> <span class="keywordtype">int</span> nbsom = joint.<a class="code" href="classJoint.html#a3f49fb1150967b436a115a7373ab27a0" title="Renvoie les informations de joint pour le type demande.">joint_item</a>(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>).<a class="code" href="classJoint__Items.html#a435fb1629f6dafb089605913517e73c4" title="Voir items_communs_.">items_communs</a>().<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l01474"></a>01474                 nbsom_total+=nbsom;
<a name="l01475"></a>01475                 <span class="keyword">const</span> <span class="keywordtype">int</span> nbfaces = joint.<a class="code" href="classFrontiere.html#aa073fe9dbdddde59471ee7032b256aa2" title="Renvoie le nombre de faces de la frontiere.">nb_faces</a>();
<a name="l01476"></a>01476                 nbfaces_total+=nbfaces;
<a name="l01477"></a>01477                 <span class="keyword">const</span> <span class="keywordtype">int</span> nbelemdist = joint.<a class="code" href="classJoint.html#a3f49fb1150967b436a115a7373ab27a0" title="Renvoie les informations de joint pour le type demande.">joint_item</a>(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926ae32de3a01fdb3ad6c506b8058a7f6173">Joint::ELEMENT</a>).<a class="code" href="classJoint__Items.html#ae51b330de79fcaae9c88166e3eee7cb8" title="Voir items_distants_.">items_distants</a>().<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l01478"></a>01478                 nbelemdist_total+=nbelemdist;
<a name="l01479"></a>01479 <span class="comment">// Beurk: sprintf pas beau et dangereux, mais c&#39;est plus simple...</span>
<a name="l01480"></a>01480                 assert(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)==<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l01481"></a>01481                 <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt; <span class="stringliteral">&quot;  Joint &quot;</span>&lt;&lt;i&lt;&lt;<span class="stringliteral">&quot; PeVoisin &quot;</span>&lt;&lt;pe&lt;&lt;<span class="stringliteral">&quot; NbSommets &quot;</span>&lt;&lt;nbsom&lt;&lt;<span class="stringliteral">&quot; NbFaces &quot;</span>&lt;&lt;nbfaces;
<a name="l01482"></a>01482                 <span class="keywordflow">if</span> (<a class="code" href="classDecouper.html#a3547db48cde6991d341216127bff3091">Decouper::print_more_infos</a>) <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt;<span class="stringliteral">&quot; NbElemDist &quot;</span>&lt;&lt;nbelemdist;
<a name="l01483"></a>01483                 <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;finl;
<a name="l01484"></a>01484               }
<a name="l01485"></a>01485             <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;               Total:    NbSommets &quot;</span>&lt;&lt;nbsom_total&lt;&lt;<span class="stringliteral">&quot; NbFaces &quot;</span>&lt;&lt;nbfaces_total;
<a name="l01486"></a>01486             <span class="keywordflow">if</span> (<a class="code" href="classDecouper.html#a3547db48cde6991d341216127bff3091">Decouper::print_more_infos</a>) <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot; NbElemDist &quot;</span>&lt;&lt;nbelemdist_total;
<a name="l01487"></a>01487             EdgeCut(i_part)=nbfaces_total;
<a name="l01488"></a>01488             <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;finl;
<a name="l01489"></a>01489 
<a name="l01490"></a>01490           }
<a name="l01491"></a>01491           <span class="keywordflow">if</span> (reorder &amp;&amp; loop==0)
<a name="l01492"></a>01492             {
<a name="l01493"></a>01493               <span class="keyword">const</span> <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone = sous_domaine.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0);
<a name="l01494"></a>01494               <span class="keyword">const</span> <a class="code" href="classJoints.html" title="Classe Joints Cette classe represente une liste d&#39;objet de type Joint.">Joints</a>&amp; joints = zone.<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>();
<a name="l01495"></a>01495               <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; nb_joints = joints.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>();
<a name="l01496"></a>01496 <span class="comment">// Resize ja:</span>
<a name="l01497"></a>01497               ja.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(nnz+nb_joints+1);
<a name="l01498"></a>01498 <span class="comment">// Fortran numerotation:</span>
<a name="l01499"></a>01499               ja[nnz]=i_part+1;
<a name="l01500"></a>01500               nnz++;
<a name="l01501"></a>01501               ia[i_part+1]=ia[i_part]+1;
<a name="l01502"></a>01502               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_joints; i++)
<a name="l01503"></a>01503                 {
<a name="l01504"></a>01504                   <span class="keyword">const</span> <span class="keywordtype">int</span> pe = joints[i].PEvoisin();
<a name="l01505"></a>01505                   ja[nnz] = pe+1;
<a name="l01506"></a>01506                   nnz++;
<a name="l01507"></a>01507                   ia[i_part+1]++;
<a name="l01508"></a>01508                 }
<a name="l01509"></a>01509             }
<a name="l01510"></a>01510           <span class="keywordflow">else</span>
<a name="l01511"></a>01511             {
<a name="l01512"></a>01512 <span class="comment">// Write .Zones file(s):</span>
<a name="l01513"></a>01513               <span class="keywordflow">if</span> (format == <a class="code" href="classDecouper.html#a6185c781230e9987f8d0ed3deba63c77abb1fd046c875d348a8c0a151ca4a060a">Decouper::BINARY_MULTIPLE</a>)
<a name="l01514"></a>01514                 {
<a name="l01515"></a>01515                   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> <a class="code" href="Postraitement_8cpp.html#a2014b0b7ca4c8b7161754648bb234d56">nom_fichier</a>(basename);
<a name="l01516"></a>01516                   nom_fichier+=<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(<span class="stringliteral">&quot;.Zones&quot;</span>);
<a name="l01517"></a>01517 <span class="comment">// nom_fichier = nom_fichier.nom_me(i_part);</span>
<a name="l01518"></a>01518                   <a class="code" href="DomaineCutter_8cpp.html#a9e5238b7b86ba22c11d18274d708a57d" title="Build the name of the &quot;.Zones&quot; file for a given proc and a domain. If partie == -1 a single filename ...">construire_nom_fichier_sous_domaine</a>(basename,i_part, nb_parties_, zones_index[i_part], nom_fichier);
<a name="l01519"></a>01519                   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Writing part &quot;</span> &lt;&lt; i_part &lt;&lt; <span class="stringliteral">&quot; into the &quot;</span>
<a name="l01520"></a>01520                        &lt;&lt; (format == <a class="code" href="classDecouper.html#a6185c781230e9987f8d0ed3deba63c77abb1fd046c875d348a8c0a151ca4a060a">Decouper::BINARY_MULTIPLE</a> ? <span class="stringliteral">&quot;binary&quot;</span> : <span class="stringliteral">&quot;ascii&quot;</span>)
<a name="l01521"></a>01521                        &lt;&lt; <span class="stringliteral">&quot; file &quot;</span> &lt;&lt; nom_fichier &lt;&lt; finl;
<a name="l01522"></a>01522                   <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a> os;
<a name="l01523"></a>01523                   <span class="keywordflow">if</span> (format == <a class="code" href="classDecouper.html#a6185c781230e9987f8d0ed3deba63c77abb1fd046c875d348a8c0a151ca4a060a">Decouper::BINARY_MULTIPLE</a>)
<a name="l01524"></a>01524                     os.<a class="code" href="classSortie.html#a1b830c79a55971e0ae7281d13e06cb44" title="Change le mode d&#39;ecriture du fichier. Cette methode peut etre appelee n&#39;importe quand. Attention cependant pour les fichiers Ecrire_Fichier_Partage : il faut faire le changement uniquement au debut de l&#39;ecriture d&#39;un bloc, juste apres syncfile() (sinon, mauvaise traduction des retours a la ligne lors du syncfile suivant).">set_bin</a>(1);
<a name="l01525"></a>01525                   <span class="keyword">const</span> <span class="keywordtype">int</span> ok = os.ouvrir(nom_fichier);
<a name="l01526"></a>01526                   <span class="keywordflow">if</span> (!ok)
<a name="l01527"></a>01527                     {
<a name="l01528"></a>01528                       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;DomaineCutter::ecrire_zones : Error while opening file &quot;</span> &lt;&lt; finl;
<a name="l01529"></a>01529                       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l01530"></a>01530                     }
<a name="l01531"></a>01531                   <a class="code" href="classDomaineCutter.html#a6915956c4d26e4de8bb8f82c848108d0">writeData</a>(sous_domaine, os);
<a name="l01532"></a>01532                 }
<a name="l01533"></a>01533               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == <a class="code" href="classDecouper.html#a6185c781230e9987f8d0ed3deba63c77ab6eb35dc70963341302e570b944c7b44">Decouper::HDF5_SINGLE</a>)
<a name="l01534"></a>01534                 {
<a name="l01535"></a>01535                   <a class="code" href="classSortie__Brute.html" title="This derived class of Sortie stacks whatever it receives in an internal binary buffer. Data can be accessed through get_data().">Sortie_Brute</a> os_hdf;
<a name="l01536"></a>01536                   <a class="code" href="classDomaineCutter.html#a6915956c4d26e4de8bb8f82c848108d0">writeData</a>(sous_domaine, os_hdf);
<a name="l01537"></a>01537 
<a name="l01538"></a>01538                   std::string dname = <span class="stringliteral">&quot;/zone_&quot;</span> + std::to_string(i_part);
<a name="l01539"></a>01539                   <span class="keywordflow">if</span>(zones_index[i_part] &gt;=0)
<a name="l01540"></a>01540                     dname += <span class="stringliteral">&quot;_&quot;</span> + std::to_string(zones_index[i_part]);
<a name="l01541"></a>01541                   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> datasetname(dname.c_str());
<a name="l01542"></a>01542                   <span class="keywordflow">if</span>(<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>() &gt; 1)
<a name="l01543"></a>01543                     fic_hdf.<a class="code" href="classFichierHDF.html#a4a6063ebd4afc5bac8d24f4ceb60bf62">fill_dataset</a>(datasetname, os_hdf);
<a name="l01544"></a>01544                   <span class="keywordflow">else</span>
<a name="l01545"></a>01545                     fic_hdf.<a class="code" href="classFichierHDF.html#a7ba14e3b21aaca1de6d4473ccd3a5a66">create_and_fill_dataset_SW</a>(datasetname, os_hdf);
<a name="l01546"></a>01546 
<a name="l01547"></a>01547                 }
<a name="l01548"></a>01548               <span class="keywordflow">else</span>
<a name="l01549"></a>01549                 {
<a name="l01550"></a>01550                   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;DomaineCutter::ecrire_zones : Unsupported output file type!&quot;</span> &lt;&lt; finl;
<a name="l01551"></a>01551                   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>(1);
<a name="l01552"></a>01552                 }
<a name="l01553"></a>01553             }
<a name="l01554"></a>01554 
<a name="l01555"></a>01555 <span class="comment">// Ecritures des fichiers sous-zones .ssz</span>
<a name="l01556"></a>01556           <span class="keyword">const</span> <a class="code" href="List_8h.html#a3149526fb499ddb08728c87daa32c5ad">LIST</a>(<a class="code" href="Ref_8h.html#aab5720a5c34da14028d0745e386aaa01">REF</a>(<a class="code" href="classSous__Zone.html" title="Classe Sous_Zone Represente une sous zone volumique i.e un sous ensemble de polyedres d&#39;un objet de t...">Sous_Zone</a>)) &amp; liste_sous_zones = domaine.<a class="code" href="classDomaine.html#a6499cd6407eb6e5ac5e12891bd1afcb1">ss_zones</a>();
<a name="l01557"></a>01557           <span class="keyword">const</span> <span class="keywordtype">int</span> nb_sous_zones = liste_sous_zones.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>();
<a name="l01558"></a>01558           <span class="keywordflow">if</span> (nb_sous_zones&gt;0)
<a name="l01559"></a>01559             {
<a name="l01560"></a>01560               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Writing of files .ssz ...&quot;</span> &lt;&lt; finl;
<a name="l01561"></a>01561 <span class="comment">// Un fichier par sous-zone, dans chaque fichier on trouve toutes les parties...</span>
<a name="l01562"></a>01562 <span class="comment">// Si on est en train d&#39;ecrire la premiere partie, on efface le fichier</span>
<a name="l01563"></a>01563               <a class="code" href="arch_8h.html#a58aa6cef3a754a92479a2fb744a5f538" title="Gestion des dependances machines pour l&#39;appel a FORTRAN La macro F77DECLARE(TOTO) permet de declarer ...">IOS_OPEN_MODE</a> mode;
<a name="l01564"></a>01564               <span class="keywordflow">if</span> (i_part == 0)
<a name="l01565"></a>01565                 mode = ios::out; <span class="comment">//!&lt; Premiere partie, on ecrase le fichier</span>
<a name="l01566"></a>01566 <span class="comment"></span>              <span class="keywordflow">else</span>
<a name="l01567"></a>01567                 mode = (ios::out | ios::app); <span class="comment">//!&lt; Mode append</span>
<a name="l01568"></a>01568 <span class="comment"></span>
<a name="l01569"></a>01569 <span class="comment">// Boucle sur les sous-zones</span>
<a name="l01570"></a>01570               <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; liste_inverse_elements = dc_correspondance.<a class="code" href="classDomaineCutter__Correspondance.html#abc0eef8c08a9f18f2fd41a2ccbc6972a">liste_inverse_elements_</a>;
<a name="l01571"></a>01571 
<a name="l01572"></a>01572               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_sous_zone = 0; i_sous_zone &lt; nb_sous_zones; i_sous_zone++)
<a name="l01573"></a>01573                 {
<a name="l01574"></a>01574 <span class="comment">// Indices des elements du sous-domaine qui sont dans la sous-zone:</span>
<a name="l01575"></a>01575                   <span class="keyword">const</span> <a class="code" href="classSous__Zone.html" title="Classe Sous_Zone Represente une sous zone volumique i.e un sous ensemble de polyedres d&#39;un objet de t...">Sous_Zone</a>&amp; sous_zone = liste_sous_zones[i_sous_zone];
<a name="l01576"></a>01576                   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> elements;
<a name="l01577"></a>01577                   {
<a name="l01578"></a>01578                     <span class="keyword">const</span> <span class="keywordtype">int</span> n = sous_zone.<a class="code" href="classSous__Zone.html#a4266863124b1b4ce971ac57a6ec746e9" title="Returns the subzone number of elements (real+virtual elements in parallel)">nb_elem_tot</a>();
<a name="l01579"></a>01579                     elements.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l01580"></a>01580                     <span class="keywordtype">int</span> i;
<a name="l01581"></a>01581                     <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)
<a name="l01582"></a>01582                       {
<a name="l01583"></a>01583                         <span class="keyword">const</span> <span class="keywordtype">int</span> i_elem_global = sous_zone[i];
<a name="l01584"></a>01584                         <span class="keyword">const</span> <span class="keywordtype">int</span> i_elem_local = liste_inverse_elements[i_elem_global];
<a name="l01585"></a>01585                         <span class="keywordflow">if</span> (i_elem_local &gt;= 0)
<a name="l01586"></a>01586                           elements.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(i_elem_local);
<a name="l01587"></a>01587                       }
<a name="l01588"></a>01588                   }
<a name="l01589"></a>01589                   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> <a class="code" href="Postraitement_8cpp.html#a2014b0b7ca4c8b7161754648bb234d56">nom_fichier</a>(sous_zone.<a class="code" href="classSous__Zone.html#af05a7f18787ee39875bddf131f4b3d29" title="Renvoie le nom de la sous-zone.">le_nom</a>() + <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(<span class="stringliteral">&quot;.ssz&quot;</span>));
<a name="l01590"></a>01590                   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Subarea &quot;</span> &lt;&lt; i_sous_zone
<a name="l01591"></a>01591                        &lt;&lt; <span class="stringliteral">&quot;  file_name &quot;</span> &lt;&lt; <a class="code" href="Postraitement_8cpp.html#a2014b0b7ca4c8b7161754648bb234d56">nom_fichier</a>
<a name="l01592"></a>01592                        &lt;&lt; <span class="stringliteral">&quot;  nb_elements in this part &quot;</span> &lt;&lt; elements.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>()
<a name="l01593"></a>01593                        &lt;&lt; finl;
<a name="l01594"></a>01594 <span class="comment">// Le fichier sous-zones est toujours en ascii</span>
<a name="l01595"></a>01595                   <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a> os;
<a name="l01596"></a>01596                   <span class="keyword">const</span> <span class="keywordtype">int</span> ok = os.<a class="code" href="classSortie__Fichier__base.html#a7e75e18ed580cd4d45912ec202caa2b2">ouvrir</a>(<a class="code" href="Postraitement_8cpp.html#a2014b0b7ca4c8b7161754648bb234d56">nom_fichier</a>, mode);
<a name="l01597"></a>01597                   <span class="keywordflow">if</span> (!ok)
<a name="l01598"></a>01598                     {
<a name="l01599"></a>01599                       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;DomaineCutter::ecrire_zones :\n Error while opening file&quot;</span>
<a name="l01600"></a>01600                            &lt;&lt; <a class="code" href="Postraitement_8cpp.html#a2014b0b7ca4c8b7161754648bb234d56">nom_fichier</a> &lt;&lt; finl;
<a name="l01601"></a>01601                       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l01602"></a>01602                     }
<a name="l01603"></a>01603                   os &lt;&lt; elements;
<a name="l01604"></a>01604                 }
<a name="l01605"></a>01605             }
<a name="l01606"></a>01606         }
<a name="l01607"></a>01607       <span class="keywordflow">if</span> (reorder &amp;&amp; loop==0)
<a name="l01608"></a>01608         {
<a name="l01609"></a>01609 <span class="comment">// Reduce the bandwith of a the matrix connectivity between parts:</span>
<a name="l01610"></a>01610 <span class="comment">// ToDo forcer a ne pas changer la partition 0 !</span>
<a name="l01611"></a>01611           <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> riord(nb_parties_+1);
<a name="l01612"></a>01612           <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> levels(nb_parties_+1);
<a name="l01613"></a>01613           <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> mask(nb_parties_+1);
<a name="l01614"></a>01614           <span class="keywordtype">int</span> maskval = 1;
<a name="l01615"></a>01615           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_part=0 ; i_part&lt;nb_parties_+1; i_part++)
<a name="l01616"></a>01616             mask[i_part] = maskval;
<a name="l01617"></a>01617           <span class="keywordtype">int</span> init=1;
<a name="l01618"></a>01618           <span class="keywordtype">int</span> nlev;
<a name="l01619"></a>01619           <a class="code" href="arch_8h.html#a9b91c72ded7de2f0b393ea75de53929b">F77NAME</a>(PERPHN)(&amp;<a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a>, ja.<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>(), ia.<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>(), &amp;init, mask.<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>(), &amp;maskval, &amp;nlev, riord.<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>(), levels.<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>());
<a name="l01620"></a>01620 
<a name="l01621"></a>01621 <span class="comment">// Renumber the elem_part array:</span>
<a name="l01622"></a>01622           <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> renum(nb_parties_);
<a name="l01623"></a>01623           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_part=0; i_part &lt; <a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a>; i_part++)
<a name="l01624"></a>01624             renum[riord[i_part]-1]=i_part;
<a name="l01625"></a>01625           <span class="keywordtype">int</span> size=elem_part.<a class="code" href="classIntVect.html#ae17a73660093eb1d4e90fd8d0ec52670" title="Taille de l&#39;espace &quot;reel&quot; du vecteur. (si md_vector_ est nul, cette valeur est identique a size_arr...">size_reelle</a>();
<a name="l01626"></a>01626           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;size; i++)
<a name="l01627"></a>01627             elem_part[i]=renum[elem_part[i]];
<a name="l01628"></a>01628           elem_part.<a class="code" href="classIntVect.html#ad12bea67621d1a0ee82b27c9a37ca4ef">echange_espace_virtuel</a>();
<a name="l01629"></a>01629 <span class="comment">// Rebuild the liste_elems_sous_domaines_</span>
<a name="l01630"></a>01630           <a class="code" href="classDomaineCutter.html#abd0e4e1397f134880628a61dd7e629e7">liste_elems_sous_domaines_</a>.<a class="code" href="classStatic__Int__Lists.html#a0e0e3ede72f4efb729798d17e42f0294" title="detruit toutes les listes">reset</a>();
<a name="l01631"></a>01631           <a class="code" href="DomaineCutter_8cpp.html#a89001120b42a3a2021e912f973f795b9">calculer_listes_elements_sous_domaines</a>(elem_part, nb_parties_, nbelem, <a class="code" href="classDomaineCutter.html#abd0e4e1397f134880628a61dd7e629e7">liste_elems_sous_domaines_</a>);
<a name="l01632"></a>01632         }
<a name="l01633"></a>01633 
<a name="l01634"></a>01634       <span class="comment">/*</span>
<a name="l01635"></a>01635 <span class="comment">      // Print statistics exactly as Fluent:</span>
<a name="l01636"></a>01636 <span class="comment">      // http://combust.hit.edu.cn:8080/fluent/Fluent60_help/html/ug/node984.htm</span>
<a name="l01637"></a>01637 <span class="comment">      Cerr &lt;&lt; &quot;&gt;&gt; Partitions:&quot; &lt;&lt; finl;</span>
<a name="l01638"></a>01638 <span class="comment">      Cerr &lt;&lt; &quot;</span>
<a name="l01639"></a>01639 <span class="comment">               P   Cells I-Cells Cell Ratio  Faces I-Faces Face Ratio Neighbors&quot; &lt;&lt; finl;</span>
<a name="l01640"></a>01640 <span class="comment"></span>
<a name="l01641"></a>01641 <span class="comment">               0     134      10      0.075    217      10      0.046         1</span>
<a name="l01642"></a>01642 <span class="comment">               1     137      19      0.139    222      19      0.086         2</span>
<a name="l01643"></a>01643 <span class="comment">               2     134      19      0.142    218      19      0.087         2</span>
<a name="l01644"></a>01644 <span class="comment">               3     137      10      0.073    223      10      0.045         1</span>
<a name="l01645"></a>01645 <span class="comment">      Cerr &lt;&lt; &quot;------&quot; &lt;&lt; finl;</span>
<a name="l01646"></a>01646 <span class="comment">      Cerr &lt;&lt; &quot;Partition count             = &quot; &lt;&lt; nb_parties_ &lt;&lt; finl;</span>
<a name="l01647"></a>01647 <span class="comment">      Cerr &lt;&lt; &quot;Cell variation              = (134 - 138)</span>
<a name="l01648"></a>01648 <span class="comment">      Cerr &lt;&lt; &quot;Mean cell variation         = (  -1.1% -    1.1%)</span>
<a name="l01649"></a>01649 <span class="comment">      Cerr &lt;&lt; &quot;Intercell variation         = (10 - 19)</span>
<a name="l01650"></a>01650 <span class="comment">      Cerr &lt;&lt; &quot;Intercell ratio variation   = (   7.3% -   14.2%);</span>
<a name="l01651"></a>01651 <span class="comment">      Cerr &lt;&lt; &quot;Global intercell ratio      =   10.7%</span>
<a name="l01652"></a>01652 <span class="comment">      Cerr &lt;&lt; &quot;Face variation              = (217 - 223)</span>
<a name="l01653"></a>01653 <span class="comment">      Cerr &lt;&lt; &quot;Interface variation         = (10 - 19)</span>
<a name="l01654"></a>01654 <span class="comment">      Cerr &lt;&lt; &quot;Interface ratio variation   = (   4.5% -    8.7%)</span>
<a name="l01655"></a>01655 <span class="comment">      Cerr &lt;&lt; &quot;Global interface ratio      =    3.4%</span>
<a name="l01656"></a>01656 <span class="comment">      Cerr &lt;&lt; &quot;Neighbor variation          = (1 - 2) */</span>
<a name="l01657"></a>01657     }
<a name="l01658"></a>01658 
<a name="l01659"></a>01659 <span class="comment">// if my part is shared with other procs, then my whole part may contain joints that I don&#39;t have</span>
<a name="l01660"></a>01660 <span class="comment">// calling mp_sum wouldn&#39;t be correct though, because the shared joints would be counted several times</span>
<a name="l01661"></a>01661 <span class="comment">// so we need to gather neighbours of each part</span>
<a name="l01662"></a>01662   <span class="keywordflow">if</span> (<a class="code" href="classDecouper.html#a3547db48cde6991d341216127bff3091">Decouper::print_more_infos</a>)   <span class="comment">//!&lt; involves communication: do it only if requested</span>
<a name="l01663"></a>01663 <span class="comment"></span>    {
<a name="l01664"></a>01664       <span class="keywordflow">if</span>(<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l01665"></a>01665         {
<a name="l01666"></a>01666           <span class="keywordflow">for</span>(<span class="keywordtype">int</span> proc=1; proc&lt;<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>(); proc++)
<a name="l01667"></a>01667             {
<a name="l01668"></a>01668               <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i_part=0; i_part&lt;<a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a>; i_part++)
<a name="l01669"></a>01669                 {
<a name="l01670"></a>01670                   <span class="keywordflow">if</span>(otherProcZones[proc][i_part])
<a name="l01671"></a>01671                     {
<a name="l01672"></a>01672                       <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> tmp_neighbours;
<a name="l01673"></a>01673                       tmp_neighbours.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l01674"></a>01674                       <a class="code" href="communications_8cpp.html#a729d9499913e22a5f0db62ef07b9793f">recevoir</a>(tmp_neighbours, proc, 0, proc+2003);
<a name="l01675"></a>01675 
<a name="l01676"></a>01676                       Neighbours[i_part].set_smart_resize(1);
<a name="l01677"></a>01677                       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;tmp_neighbours.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>(); i++)
<a name="l01678"></a>01678                         Neighbours[i_part].append_array(tmp_neighbours[i]);
<a name="l01679"></a>01679                     }
<a name="l01680"></a>01680                 }
<a name="l01681"></a>01681               <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> tmp_edge_cut(nb_parties_);
<a name="l01682"></a>01682               tmp_edge_cut = 0;
<a name="l01683"></a>01683               <a class="code" href="communications_8cpp.html#a729d9499913e22a5f0db62ef07b9793f">recevoir</a>(tmp_edge_cut, proc, 0, proc+2008);
<a name="l01684"></a>01684 
<a name="l01685"></a>01685               <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i_part=0; i_part&lt;<a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a>; i_part++)
<a name="l01686"></a>01686                 EdgeCut(i_part) += tmp_edge_cut(i_part);
<a name="l01687"></a>01687 
<a name="l01688"></a>01688             }
<a name="l01689"></a>01689 
<a name="l01690"></a>01690           <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;\nQuality of partitioning --------------------------------------------&quot;</span> &lt;&lt; finl;
<a name="l01691"></a>01691           <span class="keywordtype">int</span> total_edge_cut = 0;
<a name="l01692"></a>01692           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_part=0; i_part&lt;<a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a>; i_part++)
<a name="l01693"></a>01693             total_edge_cut+=EdgeCut(i_part);
<a name="l01694"></a>01694           <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;Total number of edge-cut (faces shared by processes) : &quot;</span> &lt;&lt; total_edge_cut &lt;&lt; finl;
<a name="l01695"></a>01695           <span class="keywordflow">if</span> (total_edge_cut&gt;0)
<a name="l01696"></a>01696             {
<a name="l01697"></a>01697               <span class="keywordtype">double</span> mean_edgecut_zone = total_edge_cut / <a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a>;
<a name="l01698"></a>01698               <span class="keywordtype">int</span> max_edgecut_zone = <a class="code" href="DoubleVect_8cpp.html#a17be200c713a7031ede99b28391daa52">local_min_vect</a>(EdgeCut);
<a name="l01699"></a>01699               <span class="keywordtype">int</span> min_edgecut_zone = <a class="code" href="DoubleVect_8cpp.html#a6471e7e85cb0b00b67bd7ca9bb362371">local_max_vect</a>(EdgeCut);
<a name="l01700"></a>01700 
<a name="l01701"></a>01701               <span class="keywordtype">double</span> load_imbalance = double(max_edgecut_zone / mean_edgecut_zone);
<a name="l01702"></a>01702               <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;Number of edge-cut per Zone (min/mean/max) : &quot;</span> &lt;&lt; min_edgecut_zone  &lt;&lt; <span class="stringliteral">&quot; / &quot;</span>
<a name="l01703"></a>01703                    &lt;&lt; (int) (mean_edgecut_zone) &lt;&lt; <span class="stringliteral">&quot; / &quot;</span> &lt;&lt; max_edgecut_zone  &lt;&lt; <span class="stringliteral">&quot; Load imbalance: &quot;</span> &lt;&lt; load_imbalance
<a name="l01704"></a>01704                    &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span> &lt;&lt; finl;
<a name="l01705"></a>01705             }
<a name="l01706"></a>01706 
<a name="l01707"></a>01707           <span class="keywordtype">int</span> mean_neighbours = 0;
<a name="l01708"></a>01708           <span class="keywordtype">int</span> min_neighbours = <a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a>;
<a name="l01709"></a>01709           <span class="keywordtype">int</span> max_neighbours = 0;
<a name="l01710"></a>01710           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_part = 0; i_part &lt; <a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a>; i_part++)
<a name="l01711"></a>01711             {
<a name="l01712"></a>01712               Neighbours[i_part].array_trier_retirer_doublons();
<a name="l01713"></a>01713               <span class="keywordtype">int</span> nb_neighbours = Neighbours[i_part].size_array();
<a name="l01714"></a>01714               mean_neighbours += nb_neighbours;
<a name="l01715"></a>01715               <span class="keywordflow">if</span>(nb_neighbours &lt; min_neighbours)   min_neighbours = nb_neighbours;
<a name="l01716"></a>01716               <span class="keywordflow">if</span>(nb_neighbours &gt; max_neighbours)   max_neighbours = nb_neighbours;
<a name="l01717"></a>01717             }
<a name="l01718"></a>01718 
<a name="l01719"></a>01719           mean_neighbours/=<a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a>;
<a name="l01720"></a>01720           <span class="keywordflow">if</span> (mean_neighbours&gt;0)
<a name="l01721"></a>01721             {
<a name="l01722"></a>01722               <span class="keywordtype">double</span> load_imbalance = double(max_neighbours / mean_neighbours);
<a name="l01723"></a>01723               <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;Number of neighbours per Zone (min/mean/max) : &quot;</span> &lt;&lt; min_neighbours &lt;&lt; <span class="stringliteral">&quot; / &quot;</span>
<a name="l01724"></a>01724                    &lt;&lt; (int) (mean_neighbours) &lt;&lt; <span class="stringliteral">&quot; / &quot;</span> &lt;&lt;max_neighbours &lt;&lt; <span class="stringliteral">&quot; Load imbalance: &quot;</span> &lt;&lt; load_imbalance
<a name="l01725"></a>01725                    &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span> &lt;&lt; finl;
<a name="l01726"></a>01726             }
<a name="l01727"></a>01727         }
<a name="l01728"></a>01728       <span class="keywordflow">else</span>
<a name="l01729"></a>01729         {
<a name="l01730"></a>01730           <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i_part=0; i_part &lt; <a class="code" href="classDomaineCutter.html#adfc8d69793fb022d36d9e95f90777165">nb_parties_</a>; i_part++)
<a name="l01731"></a>01731             <span class="keywordflow">if</span>(myZones[i_part])
<a name="l01732"></a>01732               <a class="code" href="communications_8cpp.html#af9feb6405277b375b2ebcbfaec9f8af3">envoyer</a>(Neighbours[i_part], <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>(), 0, <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>()+2003);
<a name="l01733"></a>01733           <a class="code" href="communications_8cpp.html#af9feb6405277b375b2ebcbfaec9f8af3">envoyer</a>(EdgeCut, <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>(), 0, <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>()+2008);
<a name="l01734"></a>01734         }
<a name="l01735"></a>01735     }
<a name="l01736"></a>01736 
<a name="l01737"></a>01737   <span class="keywordflow">if</span> (format == <a class="code" href="classDecouper.html#a6185c781230e9987f8d0ed3deba63c77ab6eb35dc70963341302e570b944c7b44">Decouper::HDF5_SINGLE</a>)
<a name="l01738"></a>01738     fic_hdf.<a class="code" href="classFichierHDF.html#ac5d8eb389ee60109c2d60029f442487f">close</a>();
<a name="l01739"></a>01739 
<a name="l01740"></a>01740 }
<a name="l01741"></a>01741 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:18 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
