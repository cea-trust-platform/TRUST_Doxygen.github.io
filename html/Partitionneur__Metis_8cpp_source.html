<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/Kernel/Geometrie/Decoupeur/Partitionneur_Metis.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/Kernel/Geometrie/Decoupeur/Partitionneur_Metis.cpp</div>  </div>
</div>
<div class="contents">
<a href="Partitionneur__Metis_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (c) 2021, CEA</span>
<a name="l00003"></a>00003 <span class="comment">* All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment">* 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00007"></a>00007 <span class="comment">* 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00008"></a>00008 <span class="comment">* 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<a name="l00011"></a>00011 <span class="comment">* IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;</span>
<a name="l00012"></a>00012 <span class="comment">* OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// File:        Partitionneur_Metis.cpp</span>
<a name="l00018"></a>00018 <span class="comment">// Directory:   $TRUST_ROOT/src/Kernel/Geometrie/Decoupeur</span>
<a name="l00019"></a>00019 <span class="comment">// Version:     /main/20</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;<a class="code" href="Partitionneur__Metis_8h.html">Partitionneur_Metis.h</a>&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;<a class="code" href="Domaine_8h.html">Domaine.h</a>&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="Static__Int__Lists_8h.html">Static_Int_Lists.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="Connectivite__som__elem_8h.html">Connectivite_som_elem.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="Param_8h.html">Param.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="Poly__geom__base_8h.html">Poly_geom_base.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="Matrix__tools_8h.html">Matrix_tools.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="Matrice__Morse_8h.html">Matrice_Morse.h</a>&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;<a class="code" href="Array__tools_8h.html">Array_tools.h</a>&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;<a class="code" href="Comm__Group__MPI_8h.html">Comm_Group_MPI.h</a>&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;<a class="code" href="communications_8h.html">communications.h</a>&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;<a class="code" href="Domain__Graph_8h.html">Domain_Graph.h</a>&gt;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a><a class="code" href="Partitionneur__Metis_8cpp.html#a3d61d4a4b458baf51970ca2ac7a3c7fd">00035</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="Partitionneur__Metis_8cpp.html#a3d61d4a4b458baf51970ca2ac7a3c7fd">not_implemented</a>(<span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; chaine)
<a name="l00036"></a>00036 {
<a name="l00037"></a>00037   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; chaine &lt;&lt; <span class="stringliteral">&quot; is not implemented yet to the METIS API.&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00038"></a>00038   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00039"></a>00039 }
<a name="l00040"></a>00040 
<a name="l00041"></a><a class="code" href="Partitionneur__Metis_8cpp.html#aa0be004531b425cc5fd173481aa4a899">00041</a> <a class="code" href="Declare__Inst_8h.html#afcab3f7633508e92f2077d767e19bc60">Implemente_instanciable_sans_constructeur</a>(<a class="code" href="classPartitionneur__Metis.html" title="Partition d&#39;un domaine en nb_parties parties equilibrees en utilisant la librairie METIS...">Partitionneur_Metis</a>,<span class="stringliteral">&quot;Partitionneur_Metis&quot;</span>,<a class="code" href="classPartitionneur__base.html" title="Classe de base des partitionneurs de domaine&lt;br&gt;(pour decouper un maillage avant un calcul parallele)...">Partitionneur_base</a>);
<a name="l00042"></a>00042 
<a name="l00043"></a><a class="code" href="classPartitionneur__Metis.html#a1a4d90a7db288a87eefc4cf4125f1915">00043</a> <a class="code" href="classPartitionneur__Metis.html#a1a4d90a7db288a87eefc4cf4125f1915">Partitionneur_Metis::Partitionneur_Metis</a>()
<a name="l00044"></a>00044 {
<a name="l00045"></a>00045   <a class="code" href="classPartitionneur__Metis.html#a3c75984b336f89a33c8e09fb46ae0e05">nb_parties_</a> = -1;
<a name="l00046"></a>00046   <a class="code" href="classPartitionneur__Metis.html#ac6e5bea599d5dd23026f14022403e921">nb_essais_</a> = 1;
<a name="l00047"></a>00047   <a class="code" href="classPartitionneur__Metis.html#a93767a2dad3e7a31672a19f1d26c903a">algo_</a> = <a class="code" href="classPartitionneur__Metis.html#a4d58d88b7304528f1df9d5a8dafbb958acec316103df3e2a0921cfbe03fbbf22a">PMETIS</a>;
<a name="l00048"></a>00048   <a class="code" href="classPartitionneur__Metis.html#aa7ea87e9aa01d3b5d8d0c9a8aa8071b8">match_type_</a> = -1;
<a name="l00049"></a>00049   <a class="code" href="classPartitionneur__Metis.html#a8d88ffc72e5e6f7f1acfb928399bab95">ip_type_</a> = -1;
<a name="l00050"></a>00050   <a class="code" href="classPartitionneur__Metis.html#a659e783cdc8d6491ed6961ed59408dd8">ref_type_</a> = -1;
<a name="l00051"></a>00051   <a class="code" href="classPartitionneur__Metis.html#a9ac477c3b3cdc9aeab416733c04d1f3a">use_weights_</a> = 0;
<a name="l00052"></a>00052   <a class="code" href="classPartitionneur__Metis.html#adb14b9b82aa36beee89b789c4df9f10f">use_segment_to_build_connectivite_elem_elem_</a>=0;
<a name="l00053"></a>00053 }
<a name="l00054"></a>00054 
<a name="l00055"></a><a class="code" href="classPartitionneur__Metis.html#a494bdb42350136faacd5c412c87dc9c2">00055</a> <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classPartitionneur__Metis.html#a494bdb42350136faacd5c412c87dc9c2" title="Ecriture de l&#39;objet sur un flot de sortie Methode a surcharger.">Partitionneur_Metis::printOn</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os)<span class="keyword"> const</span>
<a name="l00056"></a>00056 <span class="keyword"></span>{
<a name="l00057"></a>00057   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Partitionneur_Metis::printOn invalid\n&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00058"></a>00058   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00059"></a>00059   <span class="keywordflow">return</span> os;
<a name="l00060"></a>00060 }
<a name="l00061"></a>00061 
<a name="l00062"></a><a class="code" href="classPartitionneur__Metis.html#abd97e99cf21906740b9319782670dba6">00062</a> <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classPartitionneur__Metis.html#abd97e99cf21906740b9319782670dba6" title="Lecture d&#39;un Objet_U sur un flot d&#39;entree Methode a surcharger.">Partitionneur_Metis::readOn</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00063"></a>00063 {
<a name="l00064"></a>00064   <a class="code" href="classPartitionneur__Metis.html#abd97e99cf21906740b9319782670dba6" title="Lecture d&#39;un Objet_U sur un flot d&#39;entree Methode a surcharger.">Partitionneur_base::readOn</a>(is);
<a name="l00065"></a>00065   <span class="keywordflow">return</span> is;
<a name="l00066"></a>00066 }
<a name="l00067"></a>00067 
<a name="l00068"></a><a class="code" href="classPartitionneur__Metis.html#a02810af27d6edfdcf572d6083de07500">00068</a> <span class="keywordtype">void</span> <a class="code" href="classPartitionneur__Metis.html#a02810af27d6edfdcf572d6083de07500">Partitionneur_Metis::set_param</a>(<a class="code" href="classParam.html" title="Defined below in this file.">Param</a>&amp; param)
<a name="l00069"></a>00069 {
<a name="l00070"></a>00070   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;nb_parts&quot;</span>,&amp;<a class="code" href="classPartitionneur__Metis.html#a3c75984b336f89a33c8e09fb46ae0e05">nb_parties_</a>,<a class="code" href="classParam.html#aa4ad0ca1d49bc5f2ebc5fc83ee9df384aaf5b6dfac1c5970478525407cc6ac572">Param::REQUIRED</a>);
<a name="l00071"></a>00071   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;nb_essais&quot;</span>,&amp;<a class="code" href="classPartitionneur__Metis.html#ac6e5bea599d5dd23026f14022403e921">nb_essais_</a>);
<a name="l00072"></a>00072   param.<a class="code" href="classParam.html#a6363f31c467c06512aee2f004abac69d">ajouter_condition</a>(<span class="stringliteral">&quot;(value_of_nb_parts_ge_1)_and_(value_of_nb_parts_le_100000)&quot;</span>,<span class="stringliteral">&quot;The following condition must be satisfied : 1 &lt;= nb_parties &lt;= 100000&quot;</span>);
<a name="l00073"></a>00073   param.<a class="code" href="classParam.html#a8d8bcddfd8087e577ffbb170c68e4f88">ajouter_non_std</a>(<span class="stringliteral">&quot;pmetis&quot;</span>,(<span class="keyword">this</span>));
<a name="l00074"></a>00074   param.<a class="code" href="classParam.html#a8d8bcddfd8087e577ffbb170c68e4f88">ajouter_non_std</a>(<span class="stringliteral">&quot;kmetis&quot;</span>,(<span class="keyword">this</span>));
<a name="l00075"></a>00075   param.<a class="code" href="classParam.html#a8d8bcddfd8087e577ffbb170c68e4f88">ajouter_non_std</a>(<span class="stringliteral">&quot;match_type&quot;</span>,(<span class="keyword">this</span>));
<a name="l00076"></a>00076   param.<a class="code" href="classParam.html#a8d8bcddfd8087e577ffbb170c68e4f88">ajouter_non_std</a>(<span class="stringliteral">&quot;initial_partition_type&quot;</span>,(<span class="keyword">this</span>));
<a name="l00077"></a>00077   param.<a class="code" href="classParam.html#a8d8bcddfd8087e577ffbb170c68e4f88">ajouter_non_std</a>(<span class="stringliteral">&quot;refinement_type&quot;</span>,(<span class="keyword">this</span>));
<a name="l00078"></a>00078   param.<a class="code" href="classParam.html#ae3d50612a0014a9d58e6e035a65f20e5">ajouter_flag</a>(<span class="stringliteral">&quot;use_weights&quot;</span>,&amp;<a class="code" href="classPartitionneur__Metis.html#a9ac477c3b3cdc9aeab416733c04d1f3a">use_weights_</a>);
<a name="l00079"></a>00079   param.<a class="code" href="classParam.html#ae3d50612a0014a9d58e6e035a65f20e5">ajouter_flag</a>(<span class="stringliteral">&quot;use_segment_to_build_connectivite_elem_elem&quot;</span>,&amp;<a class="code" href="classPartitionneur__Metis.html#adb14b9b82aa36beee89b789c4df9f10f">use_segment_to_build_connectivite_elem_elem_</a>); <span class="comment">//!&lt; option pour construire le grpah a partir des liens (segment) pour reseau electrique, sides ....</span>
<a name="l00080"></a>00080 <span class="comment"></span>}
<a name="l00081"></a>00081 
<a name="l00082"></a><a class="code" href="classPartitionneur__Metis.html#aa1733bc39ba016f581b69bc073c9dc82">00082</a> <span class="keywordtype">int</span> <a class="code" href="classPartitionneur__Metis.html#aa1733bc39ba016f581b69bc073c9dc82" title="Lecture des parametres de type non simple d&#39;un objet_U a partir d&#39;un flot d&#39;entree.">Partitionneur_Metis::lire_motcle_non_standard</a>(<span class="keyword">const</span> <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>&amp; mot, <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00083"></a>00083 {
<a name="l00084"></a>00084   <span class="keywordflow">if</span> (mot==<span class="stringliteral">&quot;pmetis&quot;</span>)
<a name="l00085"></a>00085     {
<a name="l00086"></a>00086       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Algorithm PMETIS&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00087"></a>00087       <a class="code" href="classPartitionneur__Metis.html#a93767a2dad3e7a31672a19f1d26c903a">algo_</a> = <a class="code" href="classPartitionneur__Metis.html#a4d58d88b7304528f1df9d5a8dafbb958acec316103df3e2a0921cfbe03fbbf22a">PMETIS</a>;
<a name="l00088"></a>00088       <span class="keywordflow">return</span> 1;
<a name="l00089"></a>00089     }
<a name="l00090"></a>00090   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mot==<span class="stringliteral">&quot;kmetis&quot;</span>)
<a name="l00091"></a>00091     {
<a name="l00092"></a>00092       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Algorithm KMETIS&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00093"></a>00093       <a class="code" href="classPartitionneur__Metis.html#a93767a2dad3e7a31672a19f1d26c903a">algo_</a> = <a class="code" href="classPartitionneur__Metis.html#a4d58d88b7304528f1df9d5a8dafbb958a277f424537f5344e494e68ee98680003">KMETIS</a>;
<a name="l00094"></a>00094       <span class="keywordflow">return</span> 1;
<a name="l00095"></a>00095     }
<a name="l00096"></a>00096   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mot==<span class="stringliteral">&quot;match_type&quot;</span>)
<a name="l00097"></a>00097     {
<a name="l00098"></a>00098       <a class="code" href="Partitionneur__Metis_8cpp.html#a3d61d4a4b458baf51970ca2ac7a3c7fd">not_implemented</a>(mot);
<a name="l00099"></a>00099       <span class="keywordflow">return</span> 1;
<a name="l00100"></a>00100     }
<a name="l00101"></a>00101   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mot==<span class="stringliteral">&quot;initial_partition_type&quot;</span>)
<a name="l00102"></a>00102     {
<a name="l00103"></a>00103       <a class="code" href="Partitionneur__Metis_8cpp.html#a3d61d4a4b458baf51970ca2ac7a3c7fd">not_implemented</a>(mot);
<a name="l00104"></a>00104       <span class="keywordflow">return</span> 1;
<a name="l00105"></a>00105     }
<a name="l00106"></a>00106   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mot==<span class="stringliteral">&quot;refinement_type&quot;</span>)
<a name="l00107"></a>00107     {
<a name="l00108"></a>00108       <a class="code" href="Partitionneur__Metis_8cpp.html#a3d61d4a4b458baf51970ca2ac7a3c7fd">not_implemented</a>(mot);
<a name="l00109"></a>00109       <span class="keywordflow">return</span> 1;
<a name="l00110"></a>00110     }
<a name="l00111"></a>00111   <span class="keywordflow">else</span>
<a name="l00112"></a>00112     <span class="keywordflow">return</span> <a class="code" href="classPartitionneur__Metis.html#aa1733bc39ba016f581b69bc073c9dc82" title="Lecture des parametres de type non simple d&#39;un objet_U a partir d&#39;un flot d&#39;entree.">Partitionneur_base::lire_motcle_non_standard</a>(mot,is);
<a name="l00113"></a>00113 
<a name="l00114"></a>00114   <span class="keywordflow">if</span>(<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>() &gt;1)
<a name="l00115"></a>00115     {
<a name="l00116"></a>00116       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;WARNING! You&#39;re using a sequential algorithm on &quot;</span> &lt;&lt; <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">nproc</a>() &lt;&lt; <span class="stringliteral">&quot;processors &quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00117"></a>00117       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Use PARMETIS for parallel domain cutting&quot;</span> &lt;&lt; finl;
<a name="l00118"></a>00118       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00119"></a>00119     }
<a name="l00120"></a>00120   <span class="keywordflow">return</span> 1;
<a name="l00121"></a>00121 }
<a name="l00122"></a>00122 
<a name="l00123"></a><a class="code" href="classPartitionneur__Metis.html#ac4eb920ef0568cf25f7a1402c3de6d72">00123</a> <span class="keywordtype">void</span> <a class="code" href="classPartitionneur__Metis.html#ac4eb920ef0568cf25f7a1402c3de6d72">Partitionneur_Metis::associer_domaine</a>(<span class="keyword">const</span> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; domaine)
<a name="l00124"></a>00124 {
<a name="l00125"></a>00125   <a class="code" href="classPartitionneur__Metis.html#ab678c54d6bf4172e3a53f57276dfd3a3">ref_domaine_</a> = domaine;
<a name="l00126"></a>00126 }
<a name="l00127"></a>00127 
<a name="l00128"></a>00128 <span class="comment">// Precondition:</span>
<a name="l00129"></a>00129 <span class="comment">// domaine associe et nombre de parties initialise</span>
<a name="l00130"></a>00130 <span class="comment">//</span>
<a name="l00131"></a>00131 <span class="comment">//</span>
<a name="l00132"></a>00132 <span class="comment">//</span>
<a name="l00133"></a>00133 <span class="comment">//</span>
<a name="l00134"></a>00134 <span class="comment">//</span><span class="comment"></span>
<a name="l00135"></a>00135 <span class="comment">//! Calcule le graphe de connectivite pour Metis, appelle le partitionneur&lt;br&gt;et remplit elem_part (pour chaque element, numero de la partie qui lui&lt;br&gt;est attribuee).&lt;br&gt;Les parties sont equilibrees de facon a minimiser le nombre de faces de joint&lt;br&gt;et a equilibrer le nombre d&#39;elements par partie.</span>
<a name="l00136"></a><a class="code" href="classPartitionneur__Metis.html#a66e062bbc8e4043f1b0fe8d5e1ee3ea3">00136</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classPartitionneur__Metis.html#a66e062bbc8e4043f1b0fe8d5e1ee3ea3" title="Calcule le graphe de connectivite pour Metis, appelle le partitionneur et remplit elem_part (pour cha...">Partitionneur_Metis::construire_partition</a>(<a class="code" href="classIntVect.html">IntVect</a>&amp; elem_part, <span class="keywordtype">int</span>&amp; nb_parts_tot)<span class="keyword"> const</span>
<a name="l00137"></a>00137 <span class="keyword"></span>{
<a name="l00138"></a>00138 <span class="preprocessor">#ifdef NO_METIS</span>
<a name="l00139"></a>00139 <span class="preprocessor"></span>  <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;METIS is not compiled with this version. Use another partition tool like Tranche.&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00140"></a>00140   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00141"></a>00141 <span class="preprocessor">#else</span>
<a name="l00142"></a>00142 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (!<a class="code" href="classPartitionneur__Metis.html#ab678c54d6bf4172e3a53f57276dfd3a3">ref_domaine_</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>())
<a name="l00143"></a>00143     {
<a name="l00144"></a>00144       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Partitionneur_Metis::construire_partition\n&quot;</span>;
<a name="l00145"></a>00145       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; The domain has not been associated&quot;</span> &lt;&lt; finl;
<a name="l00146"></a>00146       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00147"></a>00147     }
<a name="l00148"></a>00148   <span class="keywordflow">if</span> (<a class="code" href="classPartitionneur__Metis.html#a3c75984b336f89a33c8e09fb46ae0e05">nb_parties_</a> &lt;= 0)
<a name="l00149"></a>00149     {
<a name="l00150"></a>00150       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Partitionneur_Metis::construire_partition\n&quot;</span>;
<a name="l00151"></a>00151       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; The parts number has not been initialized&quot;</span> &lt;&lt; finl;
<a name="l00152"></a>00152       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00153"></a>00153     }
<a name="l00154"></a>00154 
<a name="l00155"></a>00155 <span class="comment">// Cas particulier: si nb_parts == 1, METIS ne veut rien faire...</span>
<a name="l00156"></a>00156   <span class="keywordflow">if</span> (<a class="code" href="classPartitionneur__Metis.html#a3c75984b336f89a33c8e09fb46ae0e05">nb_parties_</a> == 1)
<a name="l00157"></a>00157     {
<a name="l00158"></a>00158 
<a name="l00159"></a>00159       <span class="keywordtype">int</span> nb_elem = <a class="code" href="classPartitionneur__Metis.html#ab678c54d6bf4172e3a53f57276dfd3a3">ref_domaine_</a>.<a class="code" href="classRef__Domaine.html#a89e1c374ada79faa2c7e9a76c3393ad8">valeur</a>().<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#aa3a33e8b723618b9092460007153e42d" title="Renvoie le nombre total d&#39;elements de la zone.">nb_elem_tot</a>();
<a name="l00160"></a>00160       <span class="keywordflow">if</span> (<a class="code" href="classPartitionneur__Metis.html#adb14b9b82aa36beee89b789c4df9f10f">use_segment_to_build_connectivite_elem_elem_</a>==1)
<a name="l00161"></a>00161         nb_elem = <a class="code" href="classPartitionneur__Metis.html#ab678c54d6bf4172e3a53f57276dfd3a3">ref_domaine_</a>.<a class="code" href="classRef__Domaine.html#a89e1c374ada79faa2c7e9a76c3393ad8">valeur</a>().<a class="code" href="classDomaine.html#abc4abc8b8db5bebeb161fae4162a89ce" title="Renvoie le nombre de sommets.">nb_som</a>();
<a name="l00162"></a>00162       elem_part.<a class="code" href="classIntVect.html#a5900779fd9a3f9a82c68007a42b87d98" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(nb_elem);
<a name="l00163"></a>00163       elem_part = 0;
<a name="l00164"></a>00164       <span class="keywordflow">return</span>;
<a name="l00165"></a>00165     }
<a name="l00166"></a>00166 
<a name="l00167"></a>00167   <span class="keywordflow">if</span> (<a class="code" href="classPartitionneur__Metis.html#ab678c54d6bf4172e3a53f57276dfd3a3">ref_domaine_</a>.<a class="code" href="classRef__Domaine.html#a89e1c374ada79faa2c7e9a76c3393ad8">valeur</a>().<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a7f249429803b27139a1c54436f6164a5" title="Renvoie le nombre d&#39;elements de la zone.">nb_elem</a>() == 0)
<a name="l00168"></a>00168     <span class="keywordflow">return</span>;
<a name="l00169"></a>00169 
<a name="l00170"></a>00170   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Partitionneur_Metis::construire_partition&quot;</span> &lt;&lt; finl;
<a name="l00171"></a>00171   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Construction of graph connectivity...&quot;</span> &lt;&lt; finl;
<a name="l00172"></a>00172   <a class="code" href="classStatic__Int__Lists.html" title="Cette classe permet de stocker des listes d&#39;entiers accessibles en temps constant. La taille des listes ne peut pas changer sans perdre le contenu (ce sont des listes statiques). Exemple: Static_Int_List l; ArrOfInt tailles(3); tailles[0] = 2; tailles[1] = 3; tailles[2] = 0; // On reserve la memoire pour trois listes de taille 2, 3 et 0: l.set_list_sizes(tailles); // On affecte une valeur au deuxieme element de la premiere liste: l.set_value(0,1,765); // Affiche la valeur Cout &lt;&lt; l(0,1);.">Static_Int_Lists</a> graph_elements_perio;
<a name="l00173"></a>00173 <span class="comment">// const Domaine&amp; dom = ref_domaine_.valeur();</span>
<a name="l00174"></a>00174   <a class="code" href="classDomain__Graph.html" title="Build the graph of the domain that the METIS/PARMETIS/PTSCOTCH libraries need.">Domain_Graph</a> graph;
<a name="l00175"></a>00175   <span class="keywordflow">if</span> (<a class="code" href="classPartitionneur__Metis.html#adb14b9b82aa36beee89b789c4df9f10f">use_segment_to_build_connectivite_elem_elem_</a>==0)
<a name="l00176"></a>00176     {
<a name="l00177"></a>00177       graph.<a class="code" href="classDomain__Graph.html#a182aaf66fe5c9451d0c6b309a1289b86">construire_graph_elem_elem</a>(<a class="code" href="classPartitionneur__Metis.html#ab678c54d6bf4172e3a53f57276dfd3a3">ref_domaine_</a>.<a class="code" href="classRef__Domaine.html#a89e1c374ada79faa2c7e9a76c3393ad8">valeur</a>(), <a class="code" href="classPartitionneur__base.html#add8d511a53b90605e290ce2450757a69">liste_bords_periodiques_</a>,
<a name="l00178"></a>00178                                        <a class="code" href="classPartitionneur__Metis.html#a9ac477c3b3cdc9aeab416733c04d1f3a">use_weights_</a>,
<a name="l00179"></a>00179                                        graph_elements_perio);
<a name="l00180"></a>00180 
<a name="l00181"></a>00181     }
<a name="l00182"></a>00182   <span class="keywordflow">else</span>
<a name="l00183"></a>00183     {
<a name="l00184"></a>00184       graph.<a class="code" href="classDomain__Graph.html#acc11973f649e67cc5d0297b2a1462e65">construire_graph_from_segment</a>(<a class="code" href="classPartitionneur__Metis.html#ab678c54d6bf4172e3a53f57276dfd3a3">ref_domaine_</a>.<a class="code" href="classRef__Domaine.html#a89e1c374ada79faa2c7e9a76c3393ad8">valeur</a>(), <a class="code" href="classPartitionneur__Metis.html#a9ac477c3b3cdc9aeab416733c04d1f3a">use_weights_</a>);
<a name="l00185"></a>00185 
<a name="l00186"></a>00186     }
<a name="l00187"></a>00187   std::vector&lt;int&gt; partition(graph.<a class="code" href="classDomain__Graph.html#af9e2729c1801be23ecf1237370a9b97c">nvtxs</a>);
<a name="l00188"></a>00188   <span class="keywordtype">int</span> int_parts = <a class="code" href="classPartitionneur__Metis.html#a3c75984b336f89a33c8e09fb46ae0e05">nb_parties_</a>;
<a name="l00189"></a>00189   <span class="keywordtype">int</span> edgecut = 0; <span class="comment">//!&lt; valeur renvoyee par metis (nombre total de faces de joint)</span>
<a name="l00190"></a>00190 <span class="comment"></span>
<a name="l00191"></a>00191   <span class="keywordflow">switch</span>(<a class="code" href="classPartitionneur__Metis.html#a93767a2dad3e7a31672a19f1d26c903a">algo_</a>)
<a name="l00192"></a>00192     {
<a name="l00193"></a>00193     <span class="keywordflow">case</span> <a class="code" href="classPartitionneur__Metis.html#a4d58d88b7304528f1df9d5a8dafbb958acec316103df3e2a0921cfbe03fbbf22a">PMETIS</a>:
<a name="l00194"></a>00194       {
<a name="l00195"></a>00195         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;===============&quot;</span> &lt;&lt; finl;
<a name="l00196"></a>00196         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Call for PMETIS&quot;</span> &lt;&lt; finl;
<a name="l00197"></a>00197         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;===============&quot;</span> &lt;&lt; finl;
<a name="l00198"></a>00198 <span class="comment">// Voir le manual.pdf de METIS 5.0</span>
<a name="l00199"></a>00199         <span class="keywordtype">int</span> options[METIS_NOPTIONS];
<a name="l00200"></a>00200         METIS_SetDefaultOptions(options);
<a name="l00201"></a>00201 <span class="comment">// options[METIS_OPTION_PTYPE]=METIS_PTYPE_RB|METIS_PTYPE_KWAY; // Methode de partitionnement</span>
<a name="l00202"></a>00202 <span class="comment">// options[METIS_OPTION_OBJTYPE]=METIS_OBJTYPE_CUT|METIS_OBJTYPE_VOL; // Objective type</span>
<a name="l00203"></a>00203 <span class="comment">// options[METIS_OPTION_CTYPE]=METIS_CTYPE_SHEM|METIS_CTYPE_RM; // Matching scheme during coarsening</span>
<a name="l00204"></a>00204 <span class="comment">// options[METIS_OPTION_IPTYPE]=METIS_IPTYPE_GROW; // Algorithm during initial partitioning</span>
<a name="l00205"></a>00205 <span class="comment">// options[METIS_OPTION_RTYPE]=METIS_RTYPE_FM;   // Algorithm for refinement</span>
<a name="l00206"></a>00206         options[METIS_OPTION_NCUTS]=<a class="code" href="classPartitionneur__Metis.html#ac6e5bea599d5dd23026f14022403e921">nb_essais_</a>;         <span class="comment">//!&lt; Nombre de partitionnements testes pour en prendre le meilleur</span>
<a name="l00207"></a>00207 <span class="comment"></span>        options[METIS_OPTION_NUMBERING]=0;              <span class="comment">//!&lt; Numerotation C qui demarre a 0</span>
<a name="l00208"></a>00208 <span class="comment"></span>        options[METIS_OPTION_DBGLVL]=111111111;         <span class="comment">//!&lt; Mode verbose maximal options[METIS_OPTION_NO2HOP]=1;                 // 5.1.0: not perform any 2-hop matchings (as 5.0.3)</span>
<a name="l00209"></a>00209 <span class="comment"></span><span class="comment">//</span>
<a name="l00210"></a>00210         <span class="keywordtype">int</span> ncon=1;
<a name="l00211"></a>00211 
<a name="l00212"></a>00212 <span class="comment">// Implementation reduite (plusieurs valeurs par defaut-&gt;NULL) pour METIS 5.0</span>
<a name="l00213"></a>00213         <span class="keywordtype">int</span> status = METIS_PartGraphRecursive(&amp;graph.<a class="code" href="classDomain__Graph.html#af9e2729c1801be23ecf1237370a9b97c">nvtxs</a>, &amp;ncon, graph.<a class="code" href="classDomain__Graph.html#ace9fd4d5cc1ff127e4c7ed2f8d189e4a">xadj</a>.<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>(),
<a name="l00214"></a>00214                                               graph.<a class="code" href="classDomain__Graph.html#ab9d17a6424dcbf4c43a138c19aaf8016">adjncy</a>.<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>(), graph.<a class="code" href="classDomain__Graph.html#a59235e5ba7a37abd767bb8c18c5a3338">vwgts</a>.<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>(), NULL, graph.<a class="code" href="classDomain__Graph.html#a16341c1f48e745c57d5b5ad8955a9427">ewgts</a>.<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>(),
<a name="l00215"></a>00215                                               &amp;int_parts, NULL, NULL, options,
<a name="l00216"></a>00216                                               &amp;edgecut, partition.data());
<a name="l00217"></a>00217         <span class="keywordflow">if</span> (status != METIS_OK)
<a name="l00218"></a>00218           {
<a name="l00219"></a>00219             <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Call to METIS failed.&quot;</span> &lt;&lt; finl;
<a name="l00220"></a>00220             <span class="keywordflow">if</span> (status == METIS_ERROR_INPUT)  <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;It seems there is an input error.&quot;</span> &lt;&lt; finl;
<a name="l00221"></a>00221             <span class="keywordflow">if</span> (status == METIS_ERROR_MEMORY) <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;It seems it couldn&#39;t allocate enough memory.&quot;</span> &lt;&lt; finl;
<a name="l00222"></a>00222             <span class="keywordflow">if</span> (status == METIS_ERROR)        <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;It seems there is a METIS internal error.&quot;</span> &lt;&lt; finl;
<a name="l00223"></a>00223             <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Contact TRUST support.&quot;</span> &lt;&lt; finl;
<a name="l00224"></a>00224             <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00225"></a>00225           }
<a name="l00226"></a>00226         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;===============&quot;</span> &lt;&lt; finl;
<a name="l00227"></a>00227         <span class="keywordflow">break</span>;
<a name="l00228"></a>00228       }
<a name="l00229"></a>00229     <span class="keywordflow">case</span> <a class="code" href="classPartitionneur__Metis.html#a4d58d88b7304528f1df9d5a8dafbb958a277f424537f5344e494e68ee98680003">KMETIS</a>:
<a name="l00230"></a>00230       {
<a name="l00231"></a>00231         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Call for KMETIS&quot;</span> &lt;&lt; finl;
<a name="l00232"></a>00232         <span class="keywordtype">int</span> options[METIS_NOPTIONS];
<a name="l00233"></a>00233         METIS_SetDefaultOptions(options);
<a name="l00234"></a>00234 <span class="comment">// options[METIS_OPTION_PTYPE]=METIS_PTYPE_RB|METIS_PTYPE_KWAY; // Methode de partitionnement</span>
<a name="l00235"></a>00235 <span class="comment">// options[METIS_OPTION_OBJTYPE]=METIS_OBJTYPE_CUT|METIS_OBJTYPE_VOL; // Objective type</span>
<a name="l00236"></a>00236 <span class="comment">// options[METIS_OPTION_CTYPE]=METIS_CTYPE_SHEM; // Matching scheme during coarsening</span>
<a name="l00237"></a>00237 <span class="comment">// options[METIS_OPTION_IPTYPE]=METIS_IPTYPE_GROW; // Algorithm during initial partitioning</span>
<a name="l00238"></a>00238 <span class="comment">// options[METIS_OPTION_RTYPE]=METIS_RTYPE_FM; // Algorithm for refinement</span>
<a name="l00239"></a>00239         options[METIS_OPTION_NCUTS]=<a class="code" href="classPartitionneur__Metis.html#ac6e5bea599d5dd23026f14022403e921">nb_essais_</a>;         <span class="comment">//!&lt; Nombre de partitionnements testes pour en prendre le meilleur</span>
<a name="l00240"></a>00240 <span class="comment"></span>        options[METIS_OPTION_NUMBERING]=0;     <span class="comment">//!&lt; Numerotation C qui demarre a 0</span>
<a name="l00241"></a>00241 <span class="comment"></span>        options[METIS_OPTION_DBGLVL]=111111111; <span class="comment">//!&lt; Mode verbose maximal</span>
<a name="l00242"></a>00242 <span class="comment"></span>        <span class="keywordtype">int</span> ncon=1;
<a name="l00243"></a>00243 <span class="comment">// Conseil de la doc Metis 4.0 : METIS_PartGraphKway si int_parts&gt;8, METIS_PartGraphRecursive sinon...</span>
<a name="l00244"></a>00244 <span class="comment">// En effet semble plus rapide, mais edgecut en sortie est moins bon...</span>
<a name="l00245"></a>00245         <span class="keywordtype">int</span> status = METIS_PartGraphKway(&amp;graph.<a class="code" href="classDomain__Graph.html#af9e2729c1801be23ecf1237370a9b97c">nvtxs</a>, &amp;ncon, graph.<a class="code" href="classDomain__Graph.html#ace9fd4d5cc1ff127e4c7ed2f8d189e4a">xadj</a>.<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>(),
<a name="l00246"></a>00246                                          graph.<a class="code" href="classDomain__Graph.html#ab9d17a6424dcbf4c43a138c19aaf8016">adjncy</a>.<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>(), graph.<a class="code" href="classDomain__Graph.html#a59235e5ba7a37abd767bb8c18c5a3338">vwgts</a>.<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>(), NULL, graph.<a class="code" href="classDomain__Graph.html#a16341c1f48e745c57d5b5ad8955a9427">ewgts</a>.<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>(),
<a name="l00247"></a>00247                                          &amp;int_parts, NULL, NULL, options ,
<a name="l00248"></a>00248                                          &amp;edgecut, partition.data());
<a name="l00249"></a>00249         <span class="keywordflow">if</span> (status != METIS_OK)
<a name="l00250"></a>00250           {
<a name="l00251"></a>00251             <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Call to METIS failed.&quot;</span> &lt;&lt; finl;
<a name="l00252"></a>00252             <span class="keywordflow">if</span> (status == METIS_ERROR_INPUT)  <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;It seems there is an input error.&quot;</span> &lt;&lt; finl;
<a name="l00253"></a>00253             <span class="keywordflow">if</span> (status == METIS_ERROR_MEMORY) <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;It seems it couldn&#39;t allocate enough memory.&quot;</span> &lt;&lt; finl;
<a name="l00254"></a>00254             <span class="keywordflow">if</span> (status == METIS_ERROR)        <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;It seems there is a METIS internal error.&quot;</span> &lt;&lt; finl;
<a name="l00255"></a>00255             <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Contact TRUST support.&quot;</span> &lt;&lt; finl;
<a name="l00256"></a>00256             <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00257"></a>00257           }
<a name="l00258"></a>00258         <span class="keywordflow">break</span>;
<a name="l00259"></a>00259       }
<a name="l00260"></a>00260     <span class="keywordflow">default</span>:
<a name="l00261"></a>00261       {
<a name="l00262"></a>00262         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Internal error Partitionneur_Metis: not coded&quot;</span> &lt;&lt; finl;
<a name="l00263"></a>00263         <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00264"></a>00264       }
<a name="l00265"></a>00265     }
<a name="l00266"></a>00266   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Partitioning quality : edgecut = &quot;</span> &lt;&lt; edgecut &lt;&lt; finl;
<a name="l00267"></a>00267   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;-&gt; It is roughly the total number of edges (faces) which will be shared by the processors.&quot;</span> &lt;&lt; finl;
<a name="l00268"></a>00268   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;-&gt; The lesser this number is, the lesser the total volume of communication between processors.&quot;</span> &lt;&lt; finl;
<a name="l00269"></a>00269   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;-&gt; You can increase nb_essais option (default 1) to try to reduce (but at a higher CPU cost) this number.&quot;</span> &lt;&lt; finl;
<a name="l00270"></a>00270   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;===============&quot;</span> &lt;&lt; finl;
<a name="l00271"></a>00271 
<a name="l00272"></a>00272   <span class="keyword">const</span> <span class="keywordtype">int</span> n = graph.<a class="code" href="classDomain__Graph.html#af9e2729c1801be23ecf1237370a9b97c">nvtxs</a>;
<a name="l00273"></a>00273   elem_part.<a class="code" href="classIntVect.html#a5900779fd9a3f9a82c68007a42b87d98" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(n);
<a name="l00274"></a>00274   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
<a name="l00275"></a>00275     elem_part[i] = partition[i];
<a name="l00276"></a>00276 
<a name="l00277"></a>00277 <span class="comment">// Correction de la partition pour la periodicite. (***)</span>
<a name="l00278"></a>00278   <span class="keywordflow">if</span> (graph_elements_perio.<a class="code" href="classStatic__Int__Lists.html#a5872636466919b2cb8efe715c315d7ca" title="renvoie le nombre de listes stockees">get_nb_lists</a>() &gt; 0)
<a name="l00279"></a>00279     {
<a name="l00280"></a>00280       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Correction of the partition for the periodicity&quot;</span> &lt;&lt; finl;
<a name="l00281"></a>00281       <a class="code" href="classPartitionneur__base.html#a480ae38e862b1ea602c8ebb6c93ea63e" title="Calcul des graphes de connectivite elements periodiques et appel a corriger_periodique_avec_graphe. (Methode a utiliser quand on ne dispose pas encore du graphe de de connectivite, si on a le graphe sous la main, appeler directement corriger_periodique_avec_graphe)">corriger_bords_avec_liste</a>(<a class="code" href="classPartitionneur__Metis.html#ab678c54d6bf4172e3a53f57276dfd3a3">ref_domaine_</a>.<a class="code" href="classRef__Domaine.html#a89e1c374ada79faa2c7e9a76c3393ad8">valeur</a>(),
<a name="l00282"></a>00282                                 <a class="code" href="classPartitionneur__base.html#add8d511a53b90605e290ce2450757a69">liste_bords_periodiques_</a>,
<a name="l00283"></a>00283                                 0,
<a name="l00284"></a>00284                                 elem_part);
<a name="l00285"></a>00285       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;  If this number is high, we can improve the splitting with the option use_weights\n&quot;</span>
<a name="l00286"></a>00286            &lt;&lt; <span class="stringliteral">&quot;  but it takes more memory)&quot;</span> &lt;&lt; finl;
<a name="l00287"></a>00287     }
<a name="l00288"></a>00288 
<a name="l00289"></a>00289   <span class="keywordflow">if</span> (<a class="code" href="classPartitionneur__Metis.html#adb14b9b82aa36beee89b789c4df9f10f">use_segment_to_build_connectivite_elem_elem_</a>==0)
<a name="l00290"></a>00290     {
<a name="l00291"></a>00291       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Correction elem0 on processor 0&quot;</span> &lt;&lt; finl;
<a name="l00292"></a>00292       <a class="code" href="classPartitionneur__base.html#adf6843bb1ee54583b540b7b1c1ed1fcf" title="corrige la partition pour que l&#39;element 0 du domaine initial se trouve sur le premier sous-domaine de...">corriger_elem0_sur_proc0</a>(elem_part);
<a name="l00293"></a>00293     }
<a name="l00294"></a>00294 
<a name="l00295"></a>00295 <span class="preprocessor">#endif</span>
<a name="l00296"></a>00296 <span class="preprocessor"></span>}
<a name="l00297"></a>00297 
<a name="l00298"></a>00298 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:18 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
