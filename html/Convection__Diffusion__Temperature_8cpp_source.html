<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/ThHyd/Incompressible/Equations/Convection_Diffusion_Temperature.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/ThHyd/Incompressible/Equations/Convection_Diffusion_Temperature.cpp</div>  </div>
</div>
<div class="contents">
<a href="Convection__Diffusion__Temperature_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (c) 2021, CEA</span>
<a name="l00003"></a>00003 <span class="comment">* All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment">* 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00007"></a>00007 <span class="comment">* 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00008"></a>00008 <span class="comment">* 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<a name="l00011"></a>00011 <span class="comment">* IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;</span>
<a name="l00012"></a>00012 <span class="comment">* OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// File:        Convection_Diffusion_Temperature.cpp</span>
<a name="l00018"></a>00018 <span class="comment">// Directory:   $TRUST_ROOT/src/ThHyd/Incompressible/Equations</span>
<a name="l00019"></a>00019 <span class="comment">// Version:     /main/48</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;<a class="code" href="Convection__Diffusion__Temperature_8h.html">Convection_Diffusion_Temperature.h</a>&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="Navier__Stokes__std_8h.html">Navier_Stokes_std.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="Probleme__base_8h.html">Probleme_base.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="Fluide__Ostwald_8h.html">Fluide_Ostwald.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="Discret__Thyd_8h.html">Discret_Thyd.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="Frontiere__dis__base_8h.html">Frontiere_dis_base.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="Param_8h.html">Param.h</a>&gt;</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;<a class="code" href="Transport__Interfaces__base_8h.html">Transport_Interfaces_base.h</a>&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;<a class="code" href="Fluide__base_8h.html">Fluide_base.h</a>&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;<a class="code" href="DoubleTrav_8h.html">DoubleTrav.h</a>&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;<a class="code" href="IntTrav_8h.html">IntTrav.h</a>&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;<a class="code" href="SFichier_8h.html">SFichier.h</a>&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;<a class="code" href="Zone__VF_8h.html">Zone_VF.h</a>&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;<a class="code" href="Matrice__Morse_8h.html">Matrice_Morse.h</a>&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;<a class="code" href="Champ__Uniforme_8h.html">Champ_Uniforme.h</a>&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;<a class="code" href="Matrice__Morse__Sym_8h.html">Matrice_Morse_Sym.h</a>&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;<a class="code" href="Statistiques_8h.html">Statistiques.h</a>&gt;</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="keyword">extern</span> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="Equation__base_8cpp.html#a918aa9eada292ff09f7d2959342d3c2c">assemblage_sys_counter_</a>;
<a name="l00043"></a>00043 
<a name="l00044"></a><a class="code" href="Convection__Diffusion__Temperature_8cpp.html#ace54ae0805e1c36d5554165a08dd077e">00044</a> <a class="code" href="Declare__Inst_8h.html#afcab3f7633508e92f2077d767e19bc60">Implemente_instanciable_sans_constructeur</a>(<a class="code" href="classConvection__Diffusion__Temperature.html" title="classe Convection_Diffusion_Temperature Cas particulier de Convection_Diffusion_std quand le scalaire...">Convection_Diffusion_Temperature</a>,<span class="stringliteral">&quot;Convection_Diffusion_Temperature&quot;</span>,<a class="code" href="classConvection__Diffusion__std.html" title="classe Convection_Diffusion_std Cette classe est la base des equations modelisant le transport d&#39;un s...">Convection_Diffusion_std</a>);
<a name="l00045"></a><a class="code" href="Convection__Diffusion__Temperature_8cpp.html#aede94aa6dfcb1e90720dca2dc303fc54">00045</a> <a class="code" href="MacVect_8h.html#a0c9b693e7e6836489732c32b7a972a03">Implemente_vect</a>(<a class="code" href="classRef__Objet__U.html">RefObjU</a>);
<a name="l00046"></a>00046 
<a name="l00047"></a><a class="code" href="classConvection__Diffusion__Temperature.html#ab120e13159e4bf366b3a4616804aad42">00047</a> <a class="code" href="classConvection__Diffusion__Temperature.html#ab120e13159e4bf366b3a4616804aad42">Convection_Diffusion_Temperature::Convection_Diffusion_Temperature</a>()
<a name="l00048"></a>00048 {
<a name="l00049"></a>00049 <span class="comment">// champs_compris_.ajoute_nom_compris(&quot;temperature_paroi&quot;);</span>
<a name="l00050"></a>00050   <a class="code" href="classEquation__base.html#ad687c312e72dcbc783cf597af5927b07">champs_compris_</a>.<a class="code" href="classChamps__compris.html#a6bf07487654d24d9683955140ea44054">ajoute_nom_compris</a>(<span class="stringliteral">&quot;gradient_temperature&quot;</span>);
<a name="l00051"></a>00051   <a class="code" href="classEquation__base.html#ad687c312e72dcbc783cf597af5927b07">champs_compris_</a>.<a class="code" href="classChamps__compris.html#a6bf07487654d24d9683955140ea44054">ajoute_nom_compris</a>(<span class="stringliteral">&quot;h_echange_&quot;</span>);
<a name="l00052"></a>00052   <a class="code" href="classEquation__base.html#ad687c312e72dcbc783cf597af5927b07">champs_compris_</a>.<a class="code" href="classChamps__compris.html#a6bf07487654d24d9683955140ea44054">ajoute_nom_compris</a>(<span class="stringliteral">&quot;temperature_residu&quot;</span>);
<a name="l00053"></a>00053   <a class="code" href="classConvection__Diffusion__Temperature.html#aedbe5cc441073edc75ff1b7e491aa620">eta</a> = 1.0;
<a name="l00054"></a>00054   <a class="code" href="classConvection__Diffusion__Temperature.html#a076e32b9ad994a4121452cb3829b9273">is_penalized</a> = 0;
<a name="l00055"></a>00055   <a class="code" href="classConvection__Diffusion__Temperature.html#aa281e6ca4e8b6de76091836eb6d62ae3">tag_indic_pena_global</a> = -1;
<a name="l00056"></a>00056   <a class="code" href="classConvection__Diffusion__Temperature.html#a051d95d33a49c1860e4da0c5b62d9862">indic_pena_global</a> = 0;
<a name="l00057"></a>00057   <a class="code" href="classConvection__Diffusion__Temperature.html#ac11d5686f6bcdd802887cd66c01a54c7">indic_face_pena_global</a> = 0;
<a name="l00058"></a>00058   <a class="code" href="classConvection__Diffusion__Temperature.html#a7038fcce2e880fcf5580f291a4a35ebe">choix_pena</a> = 0;
<a name="l00059"></a>00059 }
<a name="l00060"></a>00060 <span class="comment">// Precondition:</span>
<a name="l00061"></a>00061 <span class="comment">// Parametre: Sortie&amp; is</span>
<a name="l00062"></a>00062 <span class="comment">// Signification: un flot de sortie</span>
<a name="l00063"></a>00063 <span class="comment">// Valeurs par defaut:</span>
<a name="l00064"></a>00064 <span class="comment">// Contraintes:</span>
<a name="l00065"></a>00065 <span class="comment">// Acces: entree/sortie</span>
<a name="l00066"></a>00066 <span class="comment">// Exception:</span>
<a name="l00067"></a>00067 <span class="comment">// Effets de bord:</span>
<a name="l00068"></a>00068 <span class="comment">// Postcondition: la methode ne modifie pas l&#39;objet</span>
<a name="l00069"></a>00069 <span class="comment">//</span><span class="comment"></span>
<a name="l00070"></a>00070 <span class="comment">//! Simple appel a: Convection_Diffusion_std::printOn(Sortie\&amp;)</span>
<a name="l00071"></a>00071 <span class="comment"></span><span class="comment">/** \return Sortie\&amp;&lt;br&gt;</span>
<a name="l00072"></a>00072 <span class="comment">Signification: le flot de sortie modifie&lt;br&gt;</span>
<a name="l00073"></a>00073 <span class="comment">Contraintes: */</span>
<a name="l00074"></a><a class="code" href="classConvection__Diffusion__Temperature.html#a868757abff8b1296a2d80765f22bc622">00074</a> <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classConvection__Diffusion__Temperature.html#a868757abff8b1296a2d80765f22bc622" title="Simple appel a: Convection_Diffusion_std::printOn(Sortie&amp;)">Convection_Diffusion_Temperature::printOn</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; is)<span class="keyword"> const</span>
<a name="l00075"></a>00075 <span class="keyword"></span>{
<a name="l00076"></a>00076   <span class="keywordflow">return</span> <a class="code" href="classConvection__Diffusion__Temperature.html#a868757abff8b1296a2d80765f22bc622" title="Simple appel a: Convection_Diffusion_std::printOn(Sortie&amp;)">Convection_Diffusion_std::printOn</a>(is);
<a name="l00077"></a>00077 }
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="comment">// Precondition: l&#39;objet a une temperature associee</span>
<a name="l00080"></a>00080 <span class="comment">// Precondition: l&#39;objet a un fluide associe</span>
<a name="l00081"></a>00081 <span class="comment">// Parametre: Entree&amp; is</span>
<a name="l00082"></a>00082 <span class="comment">// Signification: un flot d&#39;entree</span>
<a name="l00083"></a>00083 <span class="comment">// Valeurs par defaut:</span>
<a name="l00084"></a>00084 <span class="comment">// Contraintes:</span>
<a name="l00085"></a>00085 <span class="comment">// Acces: entree/sortie</span>
<a name="l00086"></a>00086 <span class="comment">// Exception:</span>
<a name="l00087"></a>00087 <span class="comment">// Effets de bord:</span>
<a name="l00088"></a>00088 <span class="comment">// Postcondition:</span>
<a name="l00089"></a>00089 <span class="comment">//</span>
<a name="l00090"></a>00090 <span class="comment">//</span><span class="comment"></span>
<a name="l00091"></a>00091 <span class="comment">//! Verifie si l&#39;equation a une temperature et un fluide associe&lt;br&gt;cf Convection_Diffusion_std::readOn(Entree\&amp;).</span>
<a name="l00092"></a>00092 <span class="comment"></span><span class="comment">/** \return Entree\&amp; is&lt;br&gt;</span>
<a name="l00093"></a>00093 <span class="comment">Signification: le flot d&#39;entree modifie&lt;br&gt;</span>
<a name="l00094"></a>00094 <span class="comment">Contraintes: */</span>
<a name="l00095"></a><a class="code" href="classConvection__Diffusion__Temperature.html#ad0740c9c79ae6e39edc019e53d67cfc1">00095</a> <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classConvection__Diffusion__Temperature.html#ad0740c9c79ae6e39edc019e53d67cfc1" title="Verifie si l&#39;equation a une temperature et un fluide associe cf Convection_Diffusion_std::readOn(Entr...">Convection_Diffusion_Temperature::readOn</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00096"></a>00096 {
<a name="l00097"></a>00097   assert(<a class="code" href="classConvection__Diffusion__Temperature.html#a45b435430d41951ca2e984afb04e8b34">la_temperature</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>());
<a name="l00098"></a>00098   assert(<a class="code" href="classConvection__Diffusion__Temperature.html#af5a9044ac039656dcde5c44fe081413e">le_fluide</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>());
<a name="l00099"></a>00099   <a class="code" href="classConvection__Diffusion__Temperature.html#ad0740c9c79ae6e39edc019e53d67cfc1" title="Verifie si l&#39;equation a une temperature et un fluide associe cf Convection_Diffusion_std::readOn(Entr...">Convection_Diffusion_std::readOn</a>(is);
<a name="l00100"></a>00100 <span class="comment">// Nom unite;</span>
<a name="l00101"></a>00101 <span class="comment">// if (dimension+bidim_axi==2) unite=&quot;[W/m]&quot;;</span>
<a name="l00102"></a>00102 <span class="comment">// else unite=&quot;[W]&quot;;</span>
<a name="l00103"></a>00103   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> num=<a class="code" href="classConvection__Diffusion__Temperature.html#aab6a891f15e7996eda73b1b6e67e7dbd" title="Renvoie le champ inconnue representant la temperatue. (version const)">inconnue</a>().<a class="code" href="classO__U__Ptr.html#a5aae0c48048a40339f3847aa14109231" title="Renvoie ref_().le_nom() si le pointeur est non nul ou &quot;Pointeur Nul&quot;.">le_nom</a>(); <span class="comment">//!&lt; On prevoir le cas d&#39;equation de scalaires passifs</span>
<a name="l00104"></a>00104 <span class="comment"></span>  num.<a class="code" href="classNom.html#acdb0a56b1654b0c37050be0ca9435706" title="extraction de suffix : Nom x(&quot;azerty&quot;); x.suffix(&quot;aze&quot;) x contient &quot;rty&quot;.">suffix</a>(<span class="stringliteral">&quot;temperature&quot;</span>);
<a name="l00105"></a>00105   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> nom=<span class="stringliteral">&quot;Convection_chaleur&quot;</span>;
<a name="l00106"></a>00106   nom+=num;
<a name="l00107"></a>00107   <a class="code" href="classConvection__Diffusion__std.html#aff629b8054c74fb1244b37c79aa6a3bd">terme_convectif</a>.<a class="code" href="classOperateur.html#adf6c5f02d4e0bd15282a628c4814d61f">set_fichier</a>(nom);
<a name="l00108"></a>00108 <span class="comment">// terme_convectif.set_description((Nom)&quot;Convective heat transfer rate=Integral(-rho*cp*T*u*ndS) &quot;+unite);</span>
<a name="l00109"></a>00109   <a class="code" href="classConvection__Diffusion__std.html#aff629b8054c74fb1244b37c79aa6a3bd">terme_convectif</a>.<a class="code" href="classOperateur.html#abe53b54eda0c886809a704bf79b60aa9">set_description</a>((<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>)<span class="stringliteral">&quot;Convective heat transfer rate=Integral(-rho*cp*T*u*ndS) [W] if SI units used&quot;</span>);
<a name="l00110"></a>00110   nom=<span class="stringliteral">&quot;Diffusion_chaleur&quot;</span>;
<a name="l00111"></a>00111   nom+=num;
<a name="l00112"></a>00112   <a class="code" href="classConvection__Diffusion__std.html#a7507bbda8e79eb03a9099ccd35af2275">terme_diffusif</a>.<a class="code" href="classOperateur.html#adf6c5f02d4e0bd15282a628c4814d61f">set_fichier</a>(nom);
<a name="l00113"></a>00113 <span class="comment">// terme_diffusif.set_description((Nom)&quot;Conduction heat transfer rate=Integral(lambda*grad(T)*ndS) &quot;+unite);</span>
<a name="l00114"></a>00114   <a class="code" href="classConvection__Diffusion__std.html#a7507bbda8e79eb03a9099ccd35af2275">terme_diffusif</a>.<a class="code" href="classOperateur.html#abe53b54eda0c886809a704bf79b60aa9">set_description</a>((<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>)<span class="stringliteral">&quot;Conduction heat transfer rate=Integral(lambda*grad(T)*ndS) [W] if SI units used&quot;</span>);
<a name="l00115"></a>00115   <a class="code" href="classEquation__base.html#aaaf61d60cca8205d2490a023633cc7d4">solveur_masse</a>-&gt;set_name_of_coefficient_temporel(<span class="stringliteral">&quot;rho_cp_comme_T&quot;</span>);
<a name="l00116"></a>00116   <span class="keywordflow">return</span> is;
<a name="l00117"></a>00117 }
<a name="l00118"></a>00118 
<a name="l00119"></a><a class="code" href="classConvection__Diffusion__Temperature.html#a365fcd2db507c039d52cba160982f4a8">00119</a> <span class="keywordtype">void</span> <a class="code" href="classConvection__Diffusion__Temperature.html#a365fcd2db507c039d52cba160982f4a8">Convection_Diffusion_Temperature::set_param</a>(<a class="code" href="classParam.html" title="Defined below in this file.">Param</a>&amp; param)
<a name="l00120"></a>00120 {
<a name="l00121"></a>00121   <a class="code" href="classConvection__Diffusion__Temperature.html#a365fcd2db507c039d52cba160982f4a8">Convection_Diffusion_std::set_param</a>(param);
<a name="l00122"></a>00122   param.<a class="code" href="classParam.html#a8d8bcddfd8087e577ffbb170c68e4f88">ajouter_non_std</a>(<span class="stringliteral">&quot;penalisation_L2_FTD&quot;</span>,(<span class="keyword">this</span>));
<a name="l00123"></a>00123 }
<a name="l00124"></a>00124 
<a name="l00125"></a><a class="code" href="classConvection__Diffusion__Temperature.html#ab353b1f81cc7fe5ed107e6c0fa254d1c">00125</a> <span class="keywordtype">int</span> <a class="code" href="classConvection__Diffusion__Temperature.html#ab353b1f81cc7fe5ed107e6c0fa254d1c" title="Lecture des parametres de type non simple d&#39;un objet_U a partir d&#39;un flot d&#39;entree.">Convection_Diffusion_Temperature::lire_motcle_non_standard</a>(<span class="keyword">const</span> <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>&amp; un_mot, <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00126"></a>00126 {
<a name="l00127"></a>00127   <span class="keywordflow">if</span> (un_mot==<span class="stringliteral">&quot;penalisation_L2_FTD&quot;</span>)
<a name="l00128"></a>00128     {
<a name="l00129"></a>00129       <a class="code" href="classConvection__Diffusion__Temperature.html#a076e32b9ad994a4121452cb3829b9273">is_penalized</a> = 1;
<a name="l00130"></a>00130       <a class="code" href="classConvection__Diffusion__Temperature.html#aedbe5cc441073edc75ff1b7e491aa620">eta</a> = 1.e-12;
<a name="l00131"></a>00131       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Equation_base :: penalisation_L2_FTD&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00132"></a>00132       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Equation_base: modele penalisation ibc = &quot;</span>&lt;&lt; <a class="code" href="classConvection__Diffusion__Temperature.html#a7038fcce2e880fcf5580f291a4a35ebe">choix_pena</a> &lt;&lt; finl;
<a name="l00133"></a>00133       <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> mot, nom_equation;
<a name="l00134"></a>00134       <span class="keywordtype">int</span> dim;
<a name="l00135"></a>00135       is &gt;&gt; mot;
<a name="l00136"></a>00136       <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> motlu, accolade_fermee=<span class="stringliteral">&quot;}&quot;</span>, accolade_ouverte=<span class="stringliteral">&quot;{&quot;</span>;
<a name="l00137"></a>00137       <span class="keywordflow">if</span> (mot == accolade_ouverte)
<a name="l00138"></a>00138         {
<a name="l00139"></a>00139           is &gt;&gt; mot;
<a name="l00140"></a>00140           <span class="keywordflow">while</span> (mot != accolade_fermee)
<a name="l00141"></a>00141             {
<a name="l00142"></a>00142               nom_equation = mot;
<a name="l00143"></a>00143 
<a name="l00144"></a>00144               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;penalisation_L2_FTD equation: &quot;</span>&lt;&lt; nom_equation &lt;&lt; finl;
<a name="l00145"></a>00145               <span class="keyword">const</span> <a class="code" href="classTransport__Interfaces__base.html" title="classe Transport_Interfaces_base Cette classe constitue la classe de base des equations de transport ...">Transport_Interfaces_base</a>&amp; eq = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classTransport__Interfaces__base.html" title="classe Transport_Interfaces_base Cette classe constitue la classe de base des equations de transport ...">Transport_Interfaces_base</a>,<a class="code" href="classEquation__base.html#aa8151a96f63719523bf50ddd832e0f8f" title="Renvoie le probleme associe a l&#39;equation.">probleme</a>().get_equation_by_name(nom_equation));
<a name="l00146"></a>00146               <a class="code" href="classConvection__Diffusion__Temperature.html#a025ff54c166b1a5ec73680548e82b913">ref_penalisation_L2_FTD</a>.<a class="code" href="classVect__RefObjU.html#ae2d6c9693597fbe1a1ea5df5bf66f69d">add</a>(eq);
<a name="l00147"></a>00147 
<a name="l00148"></a>00148               is &gt;&gt; dim;
<a name="l00149"></a>00149               <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> tab = <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>();
<a name="l00150"></a>00150               tab.<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(dim);
<a name="l00151"></a>00151               <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0 ; i&lt;dim ; i++)
<a name="l00152"></a>00152                 {
<a name="l00153"></a>00153                   is &gt;&gt; tab(i);
<a name="l00154"></a>00154                   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Lecture de la valeur de la penalisation suivant la direction &quot;</span> &lt;&lt; i+1 &lt;&lt;<span class="stringliteral">&quot; :&quot;</span> &lt;&lt; tab(i) &lt;&lt; finl;
<a name="l00155"></a>00155                 }
<a name="l00156"></a>00156               <a class="code" href="classConvection__Diffusion__Temperature.html#a9595595fb4b98825455db3dd680d3f64">tab_penalisation_L2_FTD</a>.<a class="code" href="classVect__DoubleTab.html#aed85078d242e65ab80a393aaaba8be1e">add</a>(tab);
<a name="l00157"></a>00157               is &gt;&gt; mot ;
<a name="l00158"></a>00158             }
<a name="l00159"></a>00159         }
<a name="l00160"></a>00160       <span class="keywordflow">else</span>
<a name="l00161"></a>00161         {
<a name="l00162"></a>00162           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Erreur a la lecture des parametres de la penalisation L2 &quot;</span> &lt;&lt; finl;
<a name="l00163"></a>00163           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;On attendait : &quot;</span> &lt;&lt; accolade_ouverte &lt;&lt; finl;
<a name="l00164"></a>00164           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00165"></a>00165         }
<a name="l00166"></a>00166       <span class="keyword">const</span> <a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>&amp; zone_vf = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>, <a class="code" href="classEquation__base.html#a12d97ae801edc18f614523677921346e" title="Renvoie la zone discretisee associee a l&#39;equation.">zone_dis</a>().<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>());
<a name="l00167"></a>00167       zone_vf.<a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>().<a class="code" href="classZone.html#a600fa15a19c7e1384564dffd83ecab4d" title="creation d&#39;un tableau parallele de valeurs aux elements. Voir MD_Vector_tools::creer_tableau_distribu...">creer_tableau_elements</a>(<a class="code" href="classConvection__Diffusion__Temperature.html#a051d95d33a49c1860e4da0c5b62d9862">indic_pena_global</a>);
<a name="l00168"></a>00168       zone_vf.<a class="code" href="classZone__VF.html#a8e02e68f236356f72728b82536538ac5">creer_tableau_faces</a>(<a class="code" href="classConvection__Diffusion__Temperature.html#ac11d5686f6bcdd802887cd66c01a54c7">indic_face_pena_global</a>);
<a name="l00169"></a>00169     }
<a name="l00170"></a>00170   <span class="keywordflow">else</span>
<a name="l00171"></a>00171     <span class="keywordflow">return</span> <a class="code" href="classConvection__Diffusion__Temperature.html#ab353b1f81cc7fe5ed107e6c0fa254d1c" title="Lecture des parametres de type non simple d&#39;un objet_U a partir d&#39;un flot d&#39;entree.">Convection_Diffusion_std::lire_motcle_non_standard</a>(un_mot,is);
<a name="l00172"></a>00172   <span class="keywordflow">return</span> 1;
<a name="l00173"></a>00173 }
<a name="l00174"></a>00174 
<a name="l00175"></a>00175 <span class="comment">// Precondition:</span>
<a name="l00176"></a>00176 <span class="comment">// Parametre: Milieu_base&amp; un_milieu</span>
<a name="l00177"></a>00177 <span class="comment">// Signification:</span>
<a name="l00178"></a>00178 <span class="comment">// Valeurs par defaut:</span>
<a name="l00179"></a>00179 <span class="comment">// Contraintes: reference constante</span>
<a name="l00180"></a>00180 <span class="comment">// doit pourvoir etre force au type &quot;Fluide_base&quot;</span>
<a name="l00181"></a>00181 <span class="comment">// Acces: entree</span>
<a name="l00182"></a>00182 <span class="comment">// </span>
<a name="l00183"></a>00183 <span class="comment">// Signification:</span>
<a name="l00184"></a>00184 <span class="comment">// Contraintes:</span>
<a name="l00185"></a>00185 <span class="comment">// Exception: les proprietes physiques du fluide ne sont pas toutes specifiees</span>
<a name="l00186"></a>00186 <span class="comment">// Effets de bord:</span>
<a name="l00187"></a>00187 <span class="comment">// Postcondition:</span>
<a name="l00188"></a>00188 <span class="comment">//</span>
<a name="l00189"></a>00189 <span class="comment">//</span><span class="comment"></span>
<a name="l00190"></a>00190 <span class="comment">//! Associe un milieu physique a l&#39;equation,&lt;br&gt;le milieu est en fait caste en Fluide_base ou en Fluide_Ostwald.</span>
<a name="l00191"></a><a class="code" href="classConvection__Diffusion__Temperature.html#aed44e94dd98d13bdbca8ef967f80a047">00191</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classConvection__Diffusion__Temperature.html#aed44e94dd98d13bdbca8ef967f80a047" title="Associe un milieu physique a l&#39;equation, le milieu est en fait caste en Fluide_base ou en Fluide_Ostw...">Convection_Diffusion_Temperature::associer_milieu_base</a>(<span class="keyword">const</span> <a class="code" href="classMilieu__base.html" title="classe Milieu_base Cette classe est la base de la hierarchie des milieux (physiques) Elle regroupe le...">Milieu_base</a>&amp; un_milieu)
<a name="l00192"></a>00192 {
<a name="l00193"></a>00193   <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classFluide__Ostwald.html" title="class Fluide_Ostwald Possede les proprietes d&#39;un fluide incompressible plus: N : indice de structure ...">Fluide_Ostwald</a>, un_milieu))
<a name="l00194"></a>00194     {
<a name="l00195"></a>00195       <span class="keyword">const</span> <a class="code" href="classFluide__Ostwald.html" title="class Fluide_Ostwald Possede les proprietes d&#39;un fluide incompressible plus: N : indice de structure ...">Fluide_Ostwald</a>&amp; un_fluide = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classFluide__Ostwald.html" title="class Fluide_Ostwald Possede les proprietes d&#39;un fluide incompressible plus: N : indice de structure ...">Fluide_Ostwald</a>,un_milieu);
<a name="l00196"></a>00196       <span class="keywordflow">if</span>  ((un_fluide.<a class="code" href="classMilieu__base.html#a99251c07d04e1f13ec4c300bfe8757db" title="Renvoie la conductivite du milieu. (version const)">conductivite</a>().<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>()) &amp;&amp;
<a name="l00197"></a>00197            ((un_fluide.<a class="code" href="classMilieu__base.html#a174d49eab1db7dfce83578b227f4e702" title="Renvoie la capacite calorifique du milieu. (version const)">capacite_calorifique</a>().<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>()) &amp;&amp; (un_fluide.<a class="code" href="classMilieu__base.html#ab28c342e189615a38b91b0fc831ca235" title="Renvoie beta_t du milieu. (version const)">beta_t</a>().<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>())))
<a name="l00198"></a>00198         <a class="code" href="classConvection__Diffusion__Temperature.html#a4631234386db71af1be20fb46dbfbecb" title="Associe un fluide incompressible a l&#39;equation.">associer_fluide</a>(un_fluide);
<a name="l00199"></a>00199       <span class="keywordflow">else</span>
<a name="l00200"></a>00200         {
<a name="l00201"></a>00201           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Vous n&#39;avez pas defini toutes les proprietes physiques du fluide &quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00202"></a>00202           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;necessaires pour resoudre l&#39;equation d&#39;energie &quot;</span> &lt;&lt; finl;
<a name="l00203"></a>00203           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Verifier que vous avez defini: la conductivite (lambda)&quot;</span>&lt;&lt; finl;
<a name="l00204"></a>00204           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;                                  la capacite calorifique (Cp)&quot;</span>&lt;&lt; finl;
<a name="l00205"></a>00205           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;                                  le coefficient de dilatation thermique (beta_th)&quot;</span>&lt;&lt; finl;
<a name="l00206"></a>00206           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00207"></a>00207         }
<a name="l00208"></a>00208     }
<a name="l00209"></a>00209   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classFluide__base.html" title="classe Fluide_base Cette classe represente un d&#39;un fluide incompressible ainsi que ses proprietes: - ...">Fluide_base</a>,un_milieu))
<a name="l00210"></a>00210     {
<a name="l00211"></a>00211       <span class="keyword">const</span> <a class="code" href="classFluide__base.html" title="classe Fluide_base Cette classe represente un d&#39;un fluide incompressible ainsi que ses proprietes: - ...">Fluide_base</a>&amp; un_fluide = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classFluide__base.html" title="classe Fluide_base Cette classe represente un d&#39;un fluide incompressible ainsi que ses proprietes: - ...">Fluide_base</a>,un_milieu);
<a name="l00212"></a>00212       <span class="keywordflow">if</span>  ((un_fluide.<a class="code" href="classMilieu__base.html#a99251c07d04e1f13ec4c300bfe8757db" title="Renvoie la conductivite du milieu. (version const)">conductivite</a>().<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>()) &amp;&amp;
<a name="l00213"></a>00213            ((un_fluide.<a class="code" href="classMilieu__base.html#a174d49eab1db7dfce83578b227f4e702" title="Renvoie la capacite calorifique du milieu. (version const)">capacite_calorifique</a>().<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>()) &amp;&amp; (un_fluide.<a class="code" href="classMilieu__base.html#ab28c342e189615a38b91b0fc831ca235" title="Renvoie beta_t du milieu. (version const)">beta_t</a>().<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>())))
<a name="l00214"></a>00214         <a class="code" href="classConvection__Diffusion__Temperature.html#a4631234386db71af1be20fb46dbfbecb" title="Associe un fluide incompressible a l&#39;equation.">associer_fluide</a>(un_fluide);
<a name="l00215"></a>00215       <span class="keywordflow">else</span>
<a name="l00216"></a>00216         {
<a name="l00217"></a>00217           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Vous n&#39;avez pas defini toutes les proprietes physiques du fluide &quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00218"></a>00218           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;necessaires pour resoudre l&#39;equation d&#39;energie &quot;</span> &lt;&lt; finl;
<a name="l00219"></a>00219           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Verifier que vous avez defini: la conductivite (lambda)&quot;</span>&lt;&lt; finl;
<a name="l00220"></a>00220           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;                                  la capacite calorifique (Cp)&quot;</span>&lt;&lt; finl;
<a name="l00221"></a>00221           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;                                  le coefficient de dilatation thermique (beta_th)&quot;</span>&lt;&lt; finl;
<a name="l00222"></a>00222 
<a name="l00223"></a>00223           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00224"></a>00224         }
<a name="l00225"></a>00225     }
<a name="l00226"></a>00226   <span class="keywordflow">else</span>
<a name="l00227"></a>00227     {
<a name="l00228"></a>00228       <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l00229"></a>00229         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;le fluide considere n&#39;est un sous fluide de Fluide_base, \n&quot;</span>
<a name="l00230"></a>00230              &lt;&lt; <span class="stringliteral">&quot;ni un sous fluide de Fluide_Ostwald. &quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00231"></a>00231     }
<a name="l00232"></a>00232 }
<a name="l00233"></a>00233 
<a name="l00234"></a>00234 
<a name="l00235"></a>00235 <span class="comment">// Precondition:</span>
<a name="l00236"></a>00236 <span class="comment">// Parametre:</span>
<a name="l00237"></a>00237 <span class="comment">// Signification:</span>
<a name="l00238"></a>00238 <span class="comment">// Valeurs par defaut:</span>
<a name="l00239"></a>00239 <span class="comment">// Contraintes:</span>
<a name="l00240"></a>00240 <span class="comment">// Acces:</span>
<a name="l00241"></a>00241 <span class="comment">// </span>
<a name="l00242"></a>00242 <span class="comment">// Signification:</span>
<a name="l00243"></a>00243 <span class="comment">// Contraintes:</span>
<a name="l00244"></a>00244 <span class="comment">// Exception:</span>
<a name="l00245"></a>00245 <span class="comment">// Effets de bord:</span>
<a name="l00246"></a>00246 <span class="comment">// Postcondition: l&#39;equation est discretisee</span>
<a name="l00247"></a>00247 <span class="comment">//</span><span class="comment"></span>
<a name="l00248"></a>00248 <span class="comment">//! Discretise l&#39;equation.</span>
<a name="l00249"></a><a class="code" href="classConvection__Diffusion__Temperature.html#a21661332b6926372eb7fc52e6fdaa7bb">00249</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classConvection__Diffusion__Temperature.html#a21661332b6926372eb7fc52e6fdaa7bb" title="Discretise l&#39;equation.">Convection_Diffusion_Temperature::discretiser</a>()
<a name="l00250"></a>00250 {
<a name="l00251"></a>00251   <span class="keyword">const</span> <a class="code" href="classDiscret__Thyd.html" title="classe Discret_Thyd Cette classe est la classe de base representant une discretisation spatiale appli...">Discret_Thyd</a>&amp; dis=<a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classDiscret__Thyd.html" title="classe Discret_Thyd Cette classe est la classe de base representant une discretisation spatiale appli...">Discret_Thyd</a>, <a class="code" href="classEquation__base.html#a324a761eaad25eb00d18e14764a1362e" title="Renvoie la discretisation associee a l&#39;equation.">discretisation</a>());
<a name="l00252"></a>00252   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l00253"></a>00253     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Energy equation discretization&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00254"></a>00254   dis.<a class="code" href="classDiscret__Thermique.html#a906524db2363d583643f646bc8f90417">temperature</a>(<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>(), <a class="code" href="classEquation__base.html#a12d97ae801edc18f614523677921346e" title="Renvoie la zone discretisee associee a l&#39;equation.">zone_dis</a>(), <a class="code" href="classConvection__Diffusion__Temperature.html#a45b435430d41951ca2e984afb04e8b34">la_temperature</a>);
<a name="l00255"></a>00255   <a class="code" href="classEquation__base.html#ad687c312e72dcbc783cf597af5927b07">champs_compris_</a>.<a class="code" href="classChamps__compris.html#aae00ca562b7d89ff638fae94d6973fcf">ajoute_champ</a>(<a class="code" href="classConvection__Diffusion__Temperature.html#a45b435430d41951ca2e984afb04e8b34">la_temperature</a>);
<a name="l00256"></a>00256 
<a name="l00257"></a>00257   <a class="code" href="classConvection__Diffusion__Temperature.html#a21661332b6926372eb7fc52e6fdaa7bb" title="Discretise l&#39;equation.">Equation_base::discretiser</a>();
<a name="l00258"></a>00258   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l00259"></a>00259     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Convection_Diffusion_Temperature::discretiser() ok&quot;</span> &lt;&lt; finl;
<a name="l00260"></a>00260 }
<a name="l00261"></a>00261 
<a name="l00262"></a>00262 
<a name="l00263"></a>00263 <span class="comment">// Precondition:</span>
<a name="l00264"></a>00264 <span class="comment">// Parametre:</span>
<a name="l00265"></a>00265 <span class="comment">// Signification:</span>
<a name="l00266"></a>00266 <span class="comment">// Valeurs par defaut:</span>
<a name="l00267"></a>00267 <span class="comment">// Contraintes:</span>
<a name="l00268"></a>00268 <span class="comment">// Acces:</span>
<a name="l00269"></a>00269 <span class="comment">// Exception:</span>
<a name="l00270"></a>00270 <span class="comment">// Effets de bord:</span>
<a name="l00271"></a>00271 <span class="comment">// Postcondition: la methode ne modifie pas l&#39;objet</span>
<a name="l00272"></a>00272 <span class="comment">//</span>
<a name="l00273"></a>00273 <span class="comment">//</span>
<a name="l00274"></a>00274 <span class="comment">//</span><span class="comment"></span>
<a name="l00275"></a>00275 <span class="comment">//! Renvoie le milieu physique de l&#39;equation.&lt;br&gt;(un Fluide_base upcaste en Milieu_base)&lt;br&gt;(version const)</span>
<a name="l00276"></a>00276 <span class="comment"></span><span class="comment">/** \return Milieu_base\&amp;&lt;br&gt;</span>
<a name="l00277"></a>00277 <span class="comment">Signification: le Fluide_base upcaste en Milieu_base&lt;br&gt;</span>
<a name="l00278"></a>00278 <span class="comment">Contraintes: reference constante */</span>
<a name="l00279"></a><a class="code" href="classConvection__Diffusion__Temperature.html#a4d944b784ab2d9d4845fd6eeca0cccc4">00279</a> <span class="keyword">const</span> <a class="code" href="classMilieu__base.html" title="classe Milieu_base Cette classe est la base de la hierarchie des milieux (physiques) Elle regroupe le...">Milieu_base</a>&amp; <a class="code" href="classConvection__Diffusion__Temperature.html#a4d944b784ab2d9d4845fd6eeca0cccc4" title="Renvoie le milieu physique de l&#39;equation. (un Fluide_base upcaste en Milieu_base) (version const)...">Convection_Diffusion_Temperature::milieu</a>()<span class="keyword"> const</span>
<a name="l00280"></a>00280 <span class="keyword"></span>{
<a name="l00281"></a>00281   <span class="keywordflow">return</span> <a class="code" href="classConvection__Diffusion__Temperature.html#a2733226a5a26dc9360a2e448e03608aa" title="Renvoie le fluide incompressible associe a l&#39;equation. (version const)">fluide</a>();
<a name="l00282"></a>00282 }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284 
<a name="l00285"></a>00285 <span class="comment">// Precondition:</span>
<a name="l00286"></a>00286 <span class="comment">// Parametre:</span>
<a name="l00287"></a>00287 <span class="comment">// Signification:</span>
<a name="l00288"></a>00288 <span class="comment">// Valeurs par defaut:</span>
<a name="l00289"></a>00289 <span class="comment">// Contraintes:</span>
<a name="l00290"></a>00290 <span class="comment">// Acces:</span>
<a name="l00291"></a>00291 <span class="comment">// Exception:</span>
<a name="l00292"></a>00292 <span class="comment">// Effets de bord:</span>
<a name="l00293"></a>00293 <span class="comment">// Postcondition:</span>
<a name="l00294"></a>00294 <span class="comment">//</span>
<a name="l00295"></a>00295 <span class="comment">//</span><span class="comment"></span>
<a name="l00296"></a>00296 <span class="comment">//! Renvoie le milieu physique de l&#39;equation.&lt;br&gt;(un Fluide_base upcaste en Milieu_base)</span>
<a name="l00297"></a>00297 <span class="comment"></span><span class="comment">/** \return Milieu_base\&amp;&lt;br&gt;</span>
<a name="l00298"></a>00298 <span class="comment">Signification: le Fluide_base upcaste en Milieu_base&lt;br&gt;</span>
<a name="l00299"></a>00299 <span class="comment">Contraintes: */</span>
<a name="l00300"></a><a class="code" href="classConvection__Diffusion__Temperature.html#a06276d9be9a7ad227c261214a7b9f059">00300</a> <a class="code" href="classMilieu__base.html" title="classe Milieu_base Cette classe est la base de la hierarchie des milieux (physiques) Elle regroupe le...">Milieu_base</a>&amp; <a class="code" href="classConvection__Diffusion__Temperature.html#a4d944b784ab2d9d4845fd6eeca0cccc4" title="Renvoie le milieu physique de l&#39;equation. (un Fluide_base upcaste en Milieu_base) (version const)...">Convection_Diffusion_Temperature::milieu</a>()
<a name="l00301"></a>00301 {
<a name="l00302"></a>00302   <span class="keywordflow">return</span> <a class="code" href="classConvection__Diffusion__Temperature.html#a2733226a5a26dc9360a2e448e03608aa" title="Renvoie le fluide incompressible associe a l&#39;equation. (version const)">fluide</a>();
<a name="l00303"></a>00303 }
<a name="l00304"></a>00304 
<a name="l00305"></a>00305 
<a name="l00306"></a>00306 <span class="comment">// Precondition:</span>
<a name="l00307"></a>00307 <span class="comment">// Parametre:</span>
<a name="l00308"></a>00308 <span class="comment">// Signification:</span>
<a name="l00309"></a>00309 <span class="comment">// Valeurs par defaut:</span>
<a name="l00310"></a>00310 <span class="comment">// Contraintes:</span>
<a name="l00311"></a>00311 <span class="comment">// Acces:</span>
<a name="l00312"></a>00312 <span class="comment">// Exception: pas de fluide associe a l&#39;eqaution</span>
<a name="l00313"></a>00313 <span class="comment">// Effets de bord:</span>
<a name="l00314"></a>00314 <span class="comment">// Postcondition: la methode ne modifie pas l&#39;objet</span>
<a name="l00315"></a>00315 <span class="comment">//</span>
<a name="l00316"></a>00316 <span class="comment">//</span><span class="comment"></span>
<a name="l00317"></a>00317 <span class="comment">//! Renvoie le fluide incompressible associe a l&#39;equation.&lt;br&gt;(version const)</span>
<a name="l00318"></a>00318 <span class="comment"></span><span class="comment">/** \return Fluide_base\&amp;&lt;br&gt;</span>
<a name="l00319"></a>00319 <span class="comment">Signification: le fluide incompressible associe a l&#39;equation&lt;br&gt;</span>
<a name="l00320"></a>00320 <span class="comment">Contraintes: reference constante */</span>
<a name="l00321"></a><a class="code" href="classConvection__Diffusion__Temperature.html#a2733226a5a26dc9360a2e448e03608aa">00321</a> <span class="keyword">const</span> <a class="code" href="classFluide__base.html" title="classe Fluide_base Cette classe represente un d&#39;un fluide incompressible ainsi que ses proprietes: - ...">Fluide_base</a>&amp; <a class="code" href="classConvection__Diffusion__Temperature.html#a2733226a5a26dc9360a2e448e03608aa" title="Renvoie le fluide incompressible associe a l&#39;equation. (version const)">Convection_Diffusion_Temperature::fluide</a>()<span class="keyword"> const</span>
<a name="l00322"></a>00322 <span class="keyword"></span>{
<a name="l00323"></a>00323   <span class="keywordflow">if</span>(!<a class="code" href="classConvection__Diffusion__Temperature.html#af5a9044ac039656dcde5c44fe081413e">le_fluide</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>())
<a name="l00324"></a>00324     {
<a name="l00325"></a>00325       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;A fluid has not been associated to &quot;</span>
<a name="l00326"></a>00326            &lt;&lt; <span class="stringliteral">&quot;the Convection_Diffusion_Temperature equation&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00327"></a>00327       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00328"></a>00328     }
<a name="l00329"></a>00329   <span class="keywordflow">return</span> <a class="code" href="classConvection__Diffusion__Temperature.html#af5a9044ac039656dcde5c44fe081413e">le_fluide</a>.<a class="code" href="classRef__Fluide__base.html#a614fc18293b0b3da4f460a857a3b3cb8">valeur</a>();
<a name="l00330"></a>00330 }
<a name="l00331"></a>00331 
<a name="l00332"></a>00332 
<a name="l00333"></a>00333 <span class="comment">// Precondition:</span>
<a name="l00334"></a>00334 <span class="comment">// Parametre:</span>
<a name="l00335"></a>00335 <span class="comment">// Signification:</span>
<a name="l00336"></a>00336 <span class="comment">// Valeurs par defaut:</span>
<a name="l00337"></a>00337 <span class="comment">// Contraintes:</span>
<a name="l00338"></a>00338 <span class="comment">// Acces:</span>
<a name="l00339"></a>00339 <span class="comment">// Exception: pas de fluide associe a l&#39;eqaution</span>
<a name="l00340"></a>00340 <span class="comment">// Effets de bord:</span>
<a name="l00341"></a>00341 <span class="comment">// Postcondition:</span>
<a name="l00342"></a>00342 <span class="comment">//</span><span class="comment"></span>
<a name="l00343"></a>00343 <span class="comment">//! Renvoie le fluide incompressible associe a l&#39;equation.</span>
<a name="l00344"></a>00344 <span class="comment"></span><span class="comment">/** \return Fluide_base\&amp;&lt;br&gt;</span>
<a name="l00345"></a>00345 <span class="comment">Signification: le fluide incompressible associe a l&#39;equation&lt;br&gt;</span>
<a name="l00346"></a>00346 <span class="comment">Contraintes: */</span>
<a name="l00347"></a><a class="code" href="classConvection__Diffusion__Temperature.html#aa9b6985791d67f8c3a4f87f61407ce54">00347</a> <a class="code" href="classFluide__base.html" title="classe Fluide_base Cette classe represente un d&#39;un fluide incompressible ainsi que ses proprietes: - ...">Fluide_base</a>&amp; <a class="code" href="classConvection__Diffusion__Temperature.html#a2733226a5a26dc9360a2e448e03608aa" title="Renvoie le fluide incompressible associe a l&#39;equation. (version const)">Convection_Diffusion_Temperature::fluide</a>()
<a name="l00348"></a>00348 {
<a name="l00349"></a>00349   <span class="keywordflow">if</span>(!<a class="code" href="classConvection__Diffusion__Temperature.html#af5a9044ac039656dcde5c44fe081413e">le_fluide</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>())
<a name="l00350"></a>00350     {
<a name="l00351"></a>00351       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;A fluid has not been associated to&quot;</span>
<a name="l00352"></a>00352            &lt;&lt; <span class="stringliteral">&quot;the Convection_Diffusion_Temperature equation&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00353"></a>00353       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00354"></a>00354     }
<a name="l00355"></a>00355   <span class="keywordflow">return</span> <a class="code" href="classConvection__Diffusion__Temperature.html#af5a9044ac039656dcde5c44fe081413e">le_fluide</a>.<a class="code" href="classRef__Fluide__base.html#a614fc18293b0b3da4f460a857a3b3cb8">valeur</a>();
<a name="l00356"></a>00356 }
<a name="l00357"></a>00357 
<a name="l00358"></a>00358 <span class="comment">// Precondition: Sortie&amp;</span>
<a name="l00359"></a>00359 <span class="comment">// Parametre: Sortie&amp; os</span>
<a name="l00360"></a>00360 <span class="comment">// Signification: un flot de sortie</span>
<a name="l00361"></a>00361 <span class="comment">// Valeurs par defaut:</span>
<a name="l00362"></a>00362 <span class="comment">// Contraintes:</span>
<a name="l00363"></a>00363 <span class="comment">// Acces: entree/sortie</span>
<a name="l00364"></a>00364 <span class="comment">// Exception:</span>
<a name="l00365"></a>00365 <span class="comment">// Effets de bord:</span>
<a name="l00366"></a>00366 <span class="comment">// Postcondition: la methode ne modifie pas l&#39;objet</span>
<a name="l00367"></a>00367 <span class="comment">//</span>
<a name="l00368"></a>00368 <span class="comment">//</span><span class="comment"></span>
<a name="l00369"></a>00369 <span class="comment">//! Impression des flux sur les bords sur un flot de sortie.&lt;br&gt;Appelle Equation_base::impr(Sortie\&amp;)</span>
<a name="l00370"></a>00370 <span class="comment"></span><span class="comment">/** \return int&lt;br&gt;</span>
<a name="l00371"></a>00371 <span class="comment">Signification: code de retour propage&lt;br&gt;</span>
<a name="l00372"></a>00372 <span class="comment">Contraintes: */</span>
<a name="l00373"></a><a class="code" href="classConvection__Diffusion__Temperature.html#aa87b5ab582fd4ecd37fce89eff3ccb6e">00373</a> <span class="keywordtype">int</span> <a class="code" href="classConvection__Diffusion__Temperature.html#aa87b5ab582fd4ecd37fce89eff3ccb6e" title="Impression des flux sur les bords sur un flot de sortie. Appelle Equation_base::impr(Sortie&amp;)">Convection_Diffusion_Temperature::impr</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os)<span class="keyword"> const</span>
<a name="l00374"></a>00374 <span class="keyword"></span>{
<a name="l00375"></a>00375   <span class="keywordflow">return</span> <a class="code" href="classConvection__Diffusion__Temperature.html#aa87b5ab582fd4ecd37fce89eff3ccb6e" title="Impression des flux sur les bords sur un flot de sortie. Appelle Equation_base::impr(Sortie&amp;)">Equation_base::impr</a>(os);
<a name="l00376"></a>00376 }
<a name="l00377"></a>00377 
<a name="l00378"></a>00378 
<a name="l00379"></a>00379 
<a name="l00380"></a><a class="code" href="Convection__Diffusion__Temperature_8cpp.html#a4b293f9badba6893d7b595238e6134a0">00380</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="Convection__Diffusion__Concentration_8cpp.html#a43724dfda1f6defe25a6b6aa60365cfa" title="Renvoie 1 si le mot clef specifie designe un type de champ inconnue de l&#39;equation. Renvoie 1 si mot = &quot;concentration&quot; Renvoie 0 sinon Si la methode renvoie 1 ch_ref fait reference au champ, dont le type a ete specifie.">string2int</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* digit, <span class="keywordtype">int</span>&amp; result)
<a name="l00381"></a>00381 {
<a name="l00382"></a>00382   result = 0;
<a name="l00383"></a>00383 
<a name="l00384"></a>00384 <span class="comment">// --- Convert each digit char and add into result.</span>
<a name="l00385"></a>00385   <span class="keywordflow">while</span> (*digit &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; *digit &lt;=<span class="charliteral">&#39;9&#39;</span>)
<a name="l00386"></a>00386     {
<a name="l00387"></a>00387       result = (result * 10) + (*digit - <span class="charliteral">&#39;0&#39;</span>);
<a name="l00388"></a>00388       digit++;
<a name="l00389"></a>00389     }
<a name="l00390"></a>00390 
<a name="l00391"></a>00391 <span class="comment">// --- Check that there were no non-digits at end.</span>
<a name="l00392"></a>00392   <span class="keywordflow">if</span> (*digit != 0)
<a name="l00393"></a>00393     {
<a name="l00394"></a>00394       <span class="keywordflow">return</span> 0;
<a name="l00395"></a>00395     }
<a name="l00396"></a>00396 
<a name="l00397"></a>00397   <span class="keywordflow">return</span> 1;
<a name="l00398"></a>00398 }
<a name="l00399"></a>00399 
<a name="l00400"></a><a class="code" href="classConvection__Diffusion__Temperature.html#a3bacf8f6add8a055cdabf1c7c8095400">00400</a> <span class="keywordtype">void</span> <a class="code" href="classConvection__Diffusion__Temperature.html#a3bacf8f6add8a055cdabf1c7c8095400">Convection_Diffusion_Temperature::creer_champ</a>(<span class="keyword">const</span> <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>&amp; motlu)
<a name="l00401"></a>00401 {
<a name="l00402"></a>00402   <a class="code" href="classConvection__Diffusion__Temperature.html#a3bacf8f6add8a055cdabf1c7c8095400">Convection_Diffusion_std::creer_champ</a>(motlu);
<a name="l00403"></a>00403 
<a name="l00404"></a>00404   <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> nom_mot(motlu),temp_mot(nom_mot);
<a name="l00405"></a>00405   <span class="comment">/*  if (motlu == &quot;temperature_paroi&quot;)</span>
<a name="l00406"></a>00406 <span class="comment">      {</span>
<a name="l00407"></a>00407 <span class="comment">        if (!temperature_paroi.non_nul())</span>
<a name="l00408"></a>00408 <span class="comment">          {</span>
<a name="l00409"></a>00409 <span class="comment">            const Discret_Thyd&amp; dis=ref_cast(Discret_Thyd, discretisation());</span>
<a name="l00410"></a>00410 <span class="comment">            dis.t_paroi(zone_dis(),zone_Cl_dis(),*this,temperature_paroi);</span>
<a name="l00411"></a>00411 <span class="comment">            champs_compris_.ajoute_champ(temperature_paroi);</span>
<a name="l00412"></a>00412 <span class="comment">          }</span>
<a name="l00413"></a>00413 <span class="comment">      } */</span>
<a name="l00414"></a>00414   <span class="keywordflow">if</span> (motlu == <span class="stringliteral">&quot;gradient_temperature&quot;</span>)
<a name="l00415"></a>00415     {
<a name="l00416"></a>00416       <span class="keywordflow">if</span> (!<a class="code" href="classConvection__Diffusion__Temperature.html#a9791260817ac5155c177a3d98f5d9ba6">gradient_temperature</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>())
<a name="l00417"></a>00417         {
<a name="l00418"></a>00418           <span class="keyword">const</span> <a class="code" href="classDiscret__Thyd.html" title="classe Discret_Thyd Cette classe est la classe de base representant une discretisation spatiale appli...">Discret_Thyd</a>&amp; dis=<a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classDiscret__Thyd.html" title="classe Discret_Thyd Cette classe est la classe de base representant une discretisation spatiale appli...">Discret_Thyd</a>, <a class="code" href="classEquation__base.html#a324a761eaad25eb00d18e14764a1362e" title="Renvoie la discretisation associee a l&#39;equation.">discretisation</a>());
<a name="l00419"></a>00419           dis.<a class="code" href="classDiscret__Thyd.html#a57082f56b0091bf87b5524733fd86167">grad_T</a>(<a class="code" href="classEquation__base.html#a12d97ae801edc18f614523677921346e" title="Renvoie la zone discretisee associee a l&#39;equation.">zone_dis</a>(),<a class="code" href="classEquation__base.html#af265fe0ea30868eb2176a0c887e4efab" title="Renvoie la zone des conditions aux limite discretisee associee a l&#39;equation.">zone_Cl_dis</a>(),<a class="code" href="classConvection__Diffusion__Temperature.html#a45b435430d41951ca2e984afb04e8b34">la_temperature</a>,<a class="code" href="classConvection__Diffusion__Temperature.html#a9791260817ac5155c177a3d98f5d9ba6">gradient_temperature</a>);
<a name="l00420"></a>00420           <a class="code" href="classEquation__base.html#ad687c312e72dcbc783cf597af5927b07">champs_compris_</a>.<a class="code" href="classChamps__compris.html#aae00ca562b7d89ff638fae94d6973fcf">ajoute_champ</a>(<a class="code" href="classConvection__Diffusion__Temperature.html#a9791260817ac5155c177a3d98f5d9ba6">gradient_temperature</a>);
<a name="l00421"></a>00421         }
<a name="l00422"></a>00422     }
<a name="l00423"></a>00423   <span class="keywordflow">if</span> (nom_mot.debute_par(<span class="stringliteral">&quot;H_ECHANGE&quot;</span>))
<a name="l00424"></a>00424     {
<a name="l00425"></a>00425       <span class="keywordflow">if</span> (!<a class="code" href="classConvection__Diffusion__Temperature.html#a0a86082c4a7dc0d65dc2b152a79c6d9a">h_echange</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>())
<a name="l00426"></a>00426         {
<a name="l00427"></a>00427           <span class="keyword">const</span> <a class="code" href="classDiscret__Thyd.html" title="classe Discret_Thyd Cette classe est la classe de base representant une discretisation spatiale appli...">Discret_Thyd</a>&amp; dis=<a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classDiscret__Thyd.html" title="classe Discret_Thyd Cette classe est la classe de base representant une discretisation spatiale appli...">Discret_Thyd</a>, <a class="code" href="classEquation__base.html#a324a761eaad25eb00d18e14764a1362e" title="Renvoie la discretisation associee a l&#39;equation.">discretisation</a>());
<a name="l00428"></a>00428           temp_mot.<a class="code" href="classNom.html#acdb0a56b1654b0c37050be0ca9435706" title="extraction de suffix : Nom x(&quot;azerty&quot;); x.suffix(&quot;aze&quot;) x contient &quot;rty&quot;.">suffix</a>(<span class="stringliteral">&quot;H_ECHANGE_&quot;</span>);
<a name="l00429"></a>00429           <span class="keywordtype">int</span> temperature;
<a name="l00430"></a>00430           <a class="code" href="Convection__Diffusion__Concentration_8cpp.html#a43724dfda1f6defe25a6b6aa60365cfa" title="Renvoie 1 si le mot clef specifie designe un type de champ inconnue de l&#39;equation. Renvoie 1 si mot = &quot;concentration&quot; Renvoie 0 sinon Si la methode renvoie 1 ch_ref fait reference au champ, dont le type a ete specifie.">string2int</a>(temp_mot,temperature);
<a name="l00431"></a>00431           dis.<a class="code" href="classDiscret__Thyd.html#afeb016b0c869f407fbb75f63860b8800">h_conv</a>(<a class="code" href="classEquation__base.html#a12d97ae801edc18f614523677921346e" title="Renvoie la zone discretisee associee a l&#39;equation.">zone_dis</a>(),<a class="code" href="classEquation__base.html#af265fe0ea30868eb2176a0c887e4efab" title="Renvoie la zone des conditions aux limite discretisee associee a l&#39;equation.">zone_Cl_dis</a>(),<a class="code" href="classConvection__Diffusion__Temperature.html#a45b435430d41951ca2e984afb04e8b34">la_temperature</a>,<a class="code" href="classConvection__Diffusion__Temperature.html#a0a86082c4a7dc0d65dc2b152a79c6d9a">h_echange</a>,nom_mot,temperature);
<a name="l00432"></a>00432           <a class="code" href="classEquation__base.html#ad687c312e72dcbc783cf597af5927b07">champs_compris_</a>.<a class="code" href="classChamps__compris.html#aae00ca562b7d89ff638fae94d6973fcf">ajoute_champ</a>(<a class="code" href="classConvection__Diffusion__Temperature.html#a0a86082c4a7dc0d65dc2b152a79c6d9a">h_echange</a>);
<a name="l00433"></a>00433         }
<a name="l00434"></a>00434     }
<a name="l00435"></a>00435 }
<a name="l00436"></a>00436 
<a name="l00437"></a><a class="code" href="classConvection__Diffusion__Temperature.html#af9bdd96da5f4693f0ed53a724668d1eb">00437</a> <span class="keyword">const</span> <a class="code" href="classChamp__base.html" title="classe Champ_base Cette classe est la base de la hierarchie des champs. Ses membres sont les attribut...">Champ_base</a>&amp; <a class="code" href="classConvection__Diffusion__Temperature.html#af9bdd96da5f4693f0ed53a724668d1eb">Convection_Diffusion_Temperature::get_champ</a>(<span class="keyword">const</span> <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>&amp; nom)<span class="keyword"> const</span>
<a name="l00438"></a>00438 <span class="keyword"></span>{
<a name="l00439"></a>00439 
<a name="l00440"></a>00440 
<a name="l00441"></a>00441   <span class="comment">/*  if (nom==&quot;temperature_paroi&quot;)</span>
<a name="l00442"></a>00442 <span class="comment">      {</span>
<a name="l00443"></a>00443 <span class="comment">        double temps_init = schema_temps().temps_init();</span>
<a name="l00444"></a>00444 <span class="comment">        Champ_Fonc_base&amp; ch_tp=ref_cast_non_const(Champ_Fonc_base,temperature_paroi.valeur());</span>
<a name="l00445"></a>00445 <span class="comment">        if (((ch_tp.temps()!=la_temperature-&gt;temps()) || (ch_tp.temps()==temps_init)) &amp;&amp; ((la_temperature-&gt;mon_equation_non_nul())))</span>
<a name="l00446"></a>00446 <span class="comment">          ch_tp.mettre_a_jour(la_temperature-&gt;temps());</span>
<a name="l00447"></a>00447 <span class="comment">        return champs_compris_.get_champ(nom);</span>
<a name="l00448"></a>00448 <span class="comment">      } */</span>
<a name="l00449"></a>00449   <span class="keywordflow">if</span> (nom==<span class="stringliteral">&quot;gradient_temperature&quot;</span>)
<a name="l00450"></a>00450     {
<a name="l00451"></a>00451       <span class="keywordtype">double</span> temps_init = <a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a2389e67de1603768ab6b1bd396e0adba" title="Renvoie le temps initial.">temps_init</a>();
<a name="l00452"></a>00452       <a class="code" href="classChamp__Fonc__base.html" title="classe Champ_Fonc_base Classe de base des champs qui sont fonction d&#39;une grandeur calculee au cours d...">Champ_Fonc_base</a>&amp; ch_gt=<a class="code" href="Cast_8h.html#ad3836a067c92103af8df5ad8f35959a6">ref_cast_non_const</a>(<a class="code" href="classChamp__Fonc__base.html" title="classe Champ_Fonc_base Classe de base des champs qui sont fonction d&#39;une grandeur calculee au cours d...">Champ_Fonc_base</a>,<a class="code" href="classConvection__Diffusion__Temperature.html#a9791260817ac5155c177a3d98f5d9ba6">gradient_temperature</a>.<a class="code" href="classDeriv__Champ__Fonc__base.html#a6c7253d2225e858b40c9251d97d57f72">valeur</a>());
<a name="l00453"></a>00453       <span class="keywordflow">if</span> (((ch_gt.<a class="code" href="classChamp__base.html#ada7350aecb7b6f20dcaee2d1106ab1a0" title="Renvoie le temps du champ.">temps</a>()!=<a class="code" href="classConvection__Diffusion__Temperature.html#a45b435430d41951ca2e984afb04e8b34">la_temperature</a>-&gt;<a class="code" href="classChamp__Inc.html#a38da91792d3b4d3ab725a6edf7f62b5a" title="Appel a l&#39;objet sous-jacent Renvoie le temps courant.">temps</a>()) || (ch_gt.<a class="code" href="classChamp__base.html#ada7350aecb7b6f20dcaee2d1106ab1a0" title="Renvoie le temps du champ.">temps</a>()==temps_init)) &amp;&amp; (<a class="code" href="classConvection__Diffusion__Temperature.html#a45b435430d41951ca2e984afb04e8b34">la_temperature</a>-&gt;mon_equation_non_nul()))
<a name="l00454"></a>00454         ch_gt.<a class="code" href="classChamp__Fonc__base.html#ab7d6cd96245a8c9971313976c0f34ccc" title="Mise a jour en temps du champ.">mettre_a_jour</a>(<a class="code" href="classConvection__Diffusion__Temperature.html#a45b435430d41951ca2e984afb04e8b34">la_temperature</a>-&gt;<a class="code" href="classChamp__Inc.html#a38da91792d3b4d3ab725a6edf7f62b5a" title="Appel a l&#39;objet sous-jacent Renvoie le temps courant.">temps</a>());
<a name="l00455"></a>00455       <span class="keywordflow">return</span> <a class="code" href="classEquation__base.html#ad687c312e72dcbc783cf597af5927b07">champs_compris_</a>.<a class="code" href="classChamps__compris.html#af38aefe53d102cb5ea2d328df769f85f">get_champ</a>(nom);
<a name="l00456"></a>00456     }
<a name="l00457"></a>00457   <span class="keywordflow">if</span> (<a class="code" href="classConvection__Diffusion__Temperature.html#a0a86082c4a7dc0d65dc2b152a79c6d9a">h_echange</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>())
<a name="l00458"></a>00458     <span class="keywordflow">if</span> (nom==<a class="code" href="classConvection__Diffusion__Temperature.html#a0a86082c4a7dc0d65dc2b152a79c6d9a">h_echange</a>.<a class="code" href="classDeriv__Champ__Fonc__base.html#a6c7253d2225e858b40c9251d97d57f72">valeur</a>().<a class="code" href="classField__base.html#ae1377124eabe8387aced762115b062bb" title="Renvoie le nom du champ.">le_nom</a>())
<a name="l00459"></a>00459       {
<a name="l00460"></a>00460         <span class="keywordtype">double</span> temps_init = <a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a2389e67de1603768ab6b1bd396e0adba" title="Renvoie le temps initial.">temps_init</a>();
<a name="l00461"></a>00461         <a class="code" href="classChamp__Fonc__base.html" title="classe Champ_Fonc_base Classe de base des champs qui sont fonction d&#39;une grandeur calculee au cours d...">Champ_Fonc_base</a>&amp; ch_hconv=<a class="code" href="Cast_8h.html#ad3836a067c92103af8df5ad8f35959a6">ref_cast_non_const</a>(<a class="code" href="classChamp__Fonc__base.html" title="classe Champ_Fonc_base Classe de base des champs qui sont fonction d&#39;une grandeur calculee au cours d...">Champ_Fonc_base</a>,<a class="code" href="classConvection__Diffusion__Temperature.html#a0a86082c4a7dc0d65dc2b152a79c6d9a">h_echange</a>.<a class="code" href="classDeriv__Champ__Fonc__base.html#a6c7253d2225e858b40c9251d97d57f72">valeur</a>());
<a name="l00462"></a>00462         <span class="keywordflow">if</span> (((ch_hconv.<a class="code" href="classChamp__base.html#ada7350aecb7b6f20dcaee2d1106ab1a0" title="Renvoie le temps du champ.">temps</a>()!=<a class="code" href="classConvection__Diffusion__Temperature.html#a45b435430d41951ca2e984afb04e8b34">la_temperature</a>-&gt;<a class="code" href="classChamp__Inc.html#a38da91792d3b4d3ab725a6edf7f62b5a" title="Appel a l&#39;objet sous-jacent Renvoie le temps courant.">temps</a>()) || (ch_hconv.<a class="code" href="classChamp__base.html#ada7350aecb7b6f20dcaee2d1106ab1a0" title="Renvoie le temps du champ.">temps</a>()==temps_init)) &amp;&amp; (<a class="code" href="classConvection__Diffusion__Temperature.html#a45b435430d41951ca2e984afb04e8b34">la_temperature</a>-&gt;mon_equation_non_nul()))
<a name="l00463"></a>00463           {
<a name="l00464"></a>00464             ch_hconv.<a class="code" href="classChamp__Fonc__base.html#ab7d6cd96245a8c9971313976c0f34ccc" title="Mise a jour en temps du champ.">mettre_a_jour</a>(<a class="code" href="classConvection__Diffusion__Temperature.html#a45b435430d41951ca2e984afb04e8b34">la_temperature</a>-&gt;<a class="code" href="classChamp__Inc.html#a38da91792d3b4d3ab725a6edf7f62b5a" title="Appel a l&#39;objet sous-jacent Renvoie le temps courant.">temps</a>());
<a name="l00465"></a>00465 
<a name="l00466"></a>00466           }
<a name="l00467"></a>00467         <span class="keywordflow">return</span> <a class="code" href="classEquation__base.html#ad687c312e72dcbc783cf597af5927b07">champs_compris_</a>.<a class="code" href="classChamps__compris.html#af38aefe53d102cb5ea2d328df769f85f">get_champ</a>(nom);
<a name="l00468"></a>00468       }
<a name="l00469"></a>00469 
<a name="l00470"></a>00470   <span class="keywordflow">try</span>
<a name="l00471"></a>00471     {
<a name="l00472"></a>00472       <span class="keywordflow">return</span> <a class="code" href="classConvection__Diffusion__Temperature.html#af9bdd96da5f4693f0ed53a724668d1eb">Convection_Diffusion_std::get_champ</a>(nom);
<a name="l00473"></a>00473     }
<a name="l00474"></a>00474   <span class="keywordflow">catch</span> (<a class="code" href="classChamps__compris__erreur.html">Champs_compris_erreur</a>)
<a name="l00475"></a>00475     {
<a name="l00476"></a>00476     }
<a name="l00477"></a>00477 
<a name="l00478"></a>00478   <span class="keywordflow">throw</span> <a class="code" href="classChamps__compris__erreur.html">Champs_compris_erreur</a>();
<a name="l00479"></a>00479   <a class="code" href="Ref_8h.html#aab5720a5c34da14028d0745e386aaa01">REF</a>(<a class="code" href="classChamp__base.html" title="classe Champ_base Cette classe est la base de la hierarchie des champs. Ses membres sont les attribut...">Champ_base</a>) ref_champ;
<a name="l00480"></a>00480 
<a name="l00481"></a>00481   <span class="keywordflow">return</span> ref_champ;
<a name="l00482"></a>00482 }
<a name="l00483"></a>00483 
<a name="l00484"></a>00484 <span class="comment">// Precondition:</span>
<a name="l00485"></a>00485 <span class="comment">// Parametre:</span>
<a name="l00486"></a>00486 <span class="comment">// Signification:</span>
<a name="l00487"></a>00487 <span class="comment">// Valeurs par defaut:</span>
<a name="l00488"></a>00488 <span class="comment">// Contraintes:</span>
<a name="l00489"></a>00489 <span class="comment">// Acces:</span>
<a name="l00490"></a>00490 <span class="comment">// Exception:</span>
<a name="l00491"></a>00491 <span class="comment">// Effets de bord:</span>
<a name="l00492"></a>00492 <span class="comment">// Postcondition: la methode ne modifie pas l&#39;objet</span>
<a name="l00493"></a>00493 <span class="comment">//</span>
<a name="l00494"></a>00494 <span class="comment">//</span><span class="comment"></span>
<a name="l00495"></a>00495 <span class="comment">//! Renvoie le nom du domaine d&#39;application de l&#39;equation.&lt;br&gt;Ici &quot;Thermique&quot;.</span>
<a name="l00496"></a>00496 <span class="comment"></span><span class="comment">/** \return Motcle\&amp;&lt;br&gt;</span>
<a name="l00497"></a>00497 <span class="comment">Signification: le nom du domaine d&#39;application de l&#39;equation&lt;br&gt;</span>
<a name="l00498"></a>00498 <span class="comment">Contraintes: toujours egal a &quot;Thermique&quot; */</span>
<a name="l00499"></a><a class="code" href="classConvection__Diffusion__Temperature.html#a53dae60f23bd5d3ec003bd285dd73c26">00499</a> <span class="keyword">const</span> <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>&amp; <a class="code" href="classConvection__Diffusion__Temperature.html#a53dae60f23bd5d3ec003bd285dd73c26" title="Renvoie le nom du domaine d&#39;application de l&#39;equation. Ici &quot;Thermique&quot;.">Convection_Diffusion_Temperature::domaine_application</a>()<span class="keyword"> const</span>
<a name="l00500"></a>00500 <span class="keyword"></span>{
<a name="l00501"></a>00501   <span class="keyword">static</span> <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> domaine = <span class="stringliteral">&quot;Thermique&quot;</span>;
<a name="l00502"></a>00502   <span class="keywordflow">return</span> domaine;
<a name="l00503"></a>00503 }
<a name="l00504"></a>00504 
<a name="l00505"></a><a class="code" href="classConvection__Diffusion__Temperature.html#a2e65653eeca0056bb6bb485ba0bbc64c">00505</a> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; <a class="code" href="classConvection__Diffusion__Temperature.html#a2e65653eeca0056bb6bb485ba0bbc64c" title="Returns the time derivative of the unknown I of the equation: dI/dt = M-1*(sum(operators(I) + sources...">Convection_Diffusion_Temperature::derivee_en_temps_inco</a>(<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; derivee)
<a name="l00506"></a>00506 {
<a name="l00507"></a>00507   <span class="keywordflow">if</span> (!<a class="code" href="classConvection__Diffusion__Temperature.html#a076e32b9ad994a4121452cb3829b9273">is_penalized</a>)
<a name="l00508"></a>00508     {
<a name="l00509"></a>00509       <span class="keywordflow">return</span> <a class="code" href="classConvection__Diffusion__Temperature.html#a7fb7465179789422db192cb948c37b06">derivee_en_temps_inco_eq_base</a>(derivee);
<a name="l00510"></a>00510     }
<a name="l00511"></a>00511   <span class="keywordflow">else</span>
<a name="l00512"></a>00512     {
<a name="l00513"></a>00513       <span class="keyword">const</span> <span class="keywordtype">double</span> rhoCp = <a class="code" href="classConvection__Diffusion__Temperature.html#af5a9044ac039656dcde5c44fe081413e">le_fluide</a>-&gt;capacite_calorifique().valeurs()(0, 0) * <a class="code" href="classConvection__Diffusion__Temperature.html#af5a9044ac039656dcde5c44fe081413e">le_fluide</a>-&gt;masse_volumique().valeurs()(0, 0);
<a name="l00514"></a>00514 <span class="comment">// Specific code if temperature equation is penalized</span>
<a name="l00515"></a>00515       derivee=<a class="code" href="classConvection__Diffusion__Temperature.html#aab6a891f15e7996eda73b1b6e67e7dbd" title="Renvoie le champ inconnue representant la temperatue. (version const)">inconnue</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>();
<a name="l00516"></a>00516 <span class="comment">// Mise en place d&#39;une methode de mise en place d&#39;une zone fantome</span>
<a name="l00517"></a>00517       <a class="code" href="classConvection__Diffusion__Temperature.html#a3689afde81dff034b576b7dab3b0da59">mise_en_place_zone_fantome</a>(derivee);
<a name="l00518"></a>00518       <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; inc=<a class="code" href="classConvection__Diffusion__Temperature.html#aab6a891f15e7996eda73b1b6e67e7dbd" title="Renvoie le champ inconnue representant la temperatue. (version const)">inconnue</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>();
<a name="l00519"></a>00519       inc = derivee;
<a name="l00520"></a>00520 
<a name="l00521"></a>00521       <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> secmem(derivee);
<a name="l00522"></a>00522 
<a name="l00523"></a>00523       <span class="keywordflow">if</span> (<a class="code" href="classConvection__Diffusion__std.html#a1eccdf9e6aedfbf1914e9fa95962fbf9" title="Renvoie le nombre d&#39;operateurs de l&#39;equation: 2 pour une equation de diffusion.">nombre_d_operateurs</a>()&gt;1)
<a name="l00524"></a>00524         {
<a name="l00525"></a>00525           <a class="code" href="classEquation__base.html#a20d04d53bd0c4b48aa923c2b328bb1e3" title="Add convection term In: solution is the unknown I Out: secmem is increased by convection(I)">derivee_en_temps_conv</a>(secmem, derivee);
<a name="l00526"></a>00526           secmem *= rhoCp;
<a name="l00527"></a>00527         }
<a name="l00528"></a>00528 
<a name="l00529"></a>00529 <span class="comment">// Transport des ibcs et de la couche limite</span>
<a name="l00530"></a>00530       <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> secmem_conv_vr(derivee);
<a name="l00531"></a>00531 <span class="comment">// on advecte la variable avec la vitesse ibc</span>
<a name="l00532"></a>00532       <a class="code" href="classConvection__Diffusion__Temperature.html#a82affa83cd11442b4b18d0e7114d4b08">transport_ibc</a>(secmem_conv_vr, derivee);
<a name="l00533"></a>00533 <span class="comment">// on retranche cette advection</span>
<a name="l00534"></a>00534       secmem -= secmem_conv_vr;
<a name="l00535"></a>00535 
<a name="l00536"></a>00536       <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> derivee_conv;
<a name="l00537"></a>00537       derivee_conv.<a class="code" href="classDoubleTab.html#aa4dd124734ab5d6cb7aa93a104c0868e">copy</a>(secmem, <a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ffa9a675e25b5b7accff8d861e05060547b">Array_base::COPY_INIT</a>);
<a name="l00538"></a>00538 
<a name="l00539"></a>00539       <a class="code" href="classEquation__base.html#a6dae2cb8a228b0e3a6d90042fd75f360">les_sources</a>.<a class="code" href="classSources.html#a6fc277f1920a71841cb041dc1b6ed771" title="Ajoute la contribution de toutes les sources de la liste au tableau passe en parametre, et renvoie ce tableau.">ajouter</a>(secmem);
<a name="l00540"></a>00540 
<a name="l00541"></a>00541       <a class="code" href="classConvection__Diffusion__Temperature.html#a9158886a17c4c95aaad8071763bc7ff1">filtrage_si_appart_ibc</a>(derivee_conv,secmem);
<a name="l00542"></a>00542       secmem.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l00543"></a>00543 
<a name="l00544"></a>00544       <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#ade5df25cd0183395ae30a9865e23611c">calculate_time_derivative</a>())
<a name="l00545"></a>00545         {
<a name="l00546"></a>00546 <span class="comment">// Store dI/dt(n) = M-1 secmem :</span>
<a name="l00547"></a>00547           <a class="code" href="classEquation__base.html#a10fb27f5c41123bf4ff96e616549f6d7">derivee_en_temps</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>()=secmem;
<a name="l00548"></a>00548           <a class="code" href="classEquation__base.html#aaaf61d60cca8205d2490a023633cc7d4">solveur_masse</a>.<a class="code" href="classSolveur__Masse.html#af7afe8c2d4d5764f7428f2cd4ef43ddb" title="Appel a l&#39;objet sous-jacent. Resoud le systeme lineaire, dont la matrice est la matrice de masse...">appliquer</a>(<a class="code" href="classEquation__base.html#a10fb27f5c41123bf4ff96e616549f6d7">derivee_en_temps</a>().valeurs());
<a name="l00549"></a>00549           <a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#aa363b76fa823b37bf9d1ae784f33bbfa">modifier_second_membre</a>((*<span class="keyword">this</span>),secmem); <span class="comment">//!&lt; Change secmem for some schemes (eg: Adams_Bashforth)</span>
<a name="l00550"></a>00550 <span class="comment"></span>        }
<a name="l00551"></a>00551 
<a name="l00552"></a>00552       <a class="code" href="classEquation__base.html#aaaf61d60cca8205d2490a023633cc7d4">solveur_masse</a>.<a class="code" href="classSolveur__Masse.html#af7afe8c2d4d5764f7428f2cd4ef43ddb" title="Appel a l&#39;objet sous-jacent. Resoud le systeme lineaire, dont la matrice est la matrice de masse...">appliquer</a>(secmem);
<a name="l00553"></a>00553       <a class="code" href="classEquation__base.html#abd67532530f67b3305703a130a5d823a">Equation_base::Gradient_conjugue_diff_impl</a>(secmem, derivee);
<a name="l00554"></a>00554 
<a name="l00555"></a>00555 <span class="comment">// penalisation de la temperature</span>
<a name="l00556"></a>00556       <a class="code" href="classConvection__Diffusion__Temperature.html#a22c0a145a3458c317b07d675b17517a4">penalisation_L2</a>(derivee);
<a name="l00557"></a>00557       <span class="keywordflow">return</span> derivee;
<a name="l00558"></a>00558     }
<a name="l00559"></a>00559 }
<a name="l00560"></a>00560 
<a name="l00561"></a><a class="code" href="classConvection__Diffusion__Temperature.html#a7fb7465179789422db192cb948c37b06">00561</a> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; <a class="code" href="classConvection__Diffusion__Temperature.html#a7fb7465179789422db192cb948c37b06">Convection_Diffusion_Temperature::derivee_en_temps_inco_eq_base</a>(<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; derivee)
<a name="l00562"></a>00562 {
<a name="l00563"></a>00563   derivee=0;
<a name="l00564"></a>00564   <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> secmem(derivee);
<a name="l00565"></a>00565 
<a name="l00566"></a>00566   <span class="keyword">const</span> <span class="keywordtype">double</span> rhoCp = <a class="code" href="classConvection__Diffusion__Temperature.html#af5a9044ac039656dcde5c44fe081413e">le_fluide</a>-&gt;capacite_calorifique().valeurs()(0, 0) * <a class="code" href="classConvection__Diffusion__Temperature.html#af5a9044ac039656dcde5c44fe081413e">le_fluide</a>-&gt;masse_volumique().valeurs()(0, 0);
<a name="l00567"></a>00567 
<a name="l00568"></a>00568 <span class="comment">// secmem = sum(operators) + sources + equation specific terms</span>
<a name="l00569"></a>00569   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#af19143270478f1a870292550da641a94" title="Renvoie 1 si le schema en temps a ete lu diffusion_implicite.">diffusion_implicite</a>())
<a name="l00570"></a>00570     {
<a name="l00571"></a>00571 <span class="comment">// Add convection operator only if equation has one</span>
<a name="l00572"></a>00572       derivee = <a class="code" href="classConvection__Diffusion__Temperature.html#aab6a891f15e7996eda73b1b6e67e7dbd" title="Renvoie le champ inconnue representant la temperatue. (version const)">inconnue</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>();
<a name="l00573"></a>00573       <span class="keywordflow">if</span> (<a class="code" href="classConvection__Diffusion__std.html#a1eccdf9e6aedfbf1914e9fa95962fbf9" title="Renvoie le nombre d&#39;operateurs de l&#39;equation: 2 pour une equation de diffusion.">nombre_d_operateurs</a>()&gt;1)
<a name="l00574"></a>00574         {
<a name="l00575"></a>00575           <a class="code" href="classEquation__base.html#a20d04d53bd0c4b48aa923c2b328bb1e3" title="Add convection term In: solution is the unknown I Out: secmem is increased by convection(I)">derivee_en_temps_conv</a>(secmem, derivee);
<a name="l00576"></a>00576           secmem *= rhoCp;
<a name="l00577"></a>00577         }
<a name="l00578"></a>00578     }
<a name="l00579"></a>00579   <span class="keywordflow">else</span>
<a name="l00580"></a>00580     {
<a name="l00581"></a>00581 <span class="comment">// Add all explicit operators</span>
<a name="l00582"></a>00582       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classConvection__Diffusion__std.html#a1eccdf9e6aedfbf1914e9fa95962fbf9" title="Renvoie le nombre d&#39;operateurs de l&#39;equation: 2 pour une equation de diffusion.">nombre_d_operateurs</a>(); i++)
<a name="l00583"></a>00583         <span class="keywordflow">if</span>(<a class="code" href="classConvection__Diffusion__std.html#a4bb82d17dd39ba9d8531764b2800a8bd" title="Renvoie l&#39;operateur specifie par son index: renvoie terme_diffusif si i = 0 renvoie terme_convectif s...">operateur</a>(i).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#ae7dae6829b1287b470717b08a8ae761e">get_decal_temps</a>()!=1)
<a name="l00584"></a>00584           {
<a name="l00585"></a>00585             <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> secmem_tmp(secmem);
<a name="l00586"></a>00586             <a class="code" href="classConvection__Diffusion__std.html#a4bb82d17dd39ba9d8531764b2800a8bd" title="Renvoie l&#39;operateur specifie par son index: renvoie terme_diffusif si i = 0 renvoie terme_convectif s...">operateur</a>(i).<a class="code" href="classOperateur.html#accdf61cf1e33fb42e9eb06f1c501422b">ajouter</a>(secmem_tmp);
<a name="l00587"></a>00587             <span class="keywordflow">if</span> (i == 1) secmem_tmp *= rhoCp;
<a name="l00588"></a>00588             secmem += secmem_tmp;
<a name="l00589"></a>00589           }
<a name="l00590"></a>00590     }
<a name="l00591"></a>00591   <a class="code" href="classEquation__base.html#a6dae2cb8a228b0e3a6d90042fd75f360">les_sources</a>.<a class="code" href="classSources.html#a6fc277f1920a71841cb041dc1b6ed771" title="Ajoute la contribution de toutes les sources de la liste au tableau passe en parametre, et renvoie ce tableau.">ajouter</a>(secmem);
<a name="l00592"></a>00592 
<a name="l00593"></a>00593   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#ade5df25cd0183395ae30a9865e23611c">calculate_time_derivative</a>())
<a name="l00594"></a>00594     {
<a name="l00595"></a>00595 <span class="comment">// Store dI/dt(n) = M-1 secmem :</span>
<a name="l00596"></a>00596       <a class="code" href="classEquation__base.html#a10fb27f5c41123bf4ff96e616549f6d7">derivee_en_temps</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>()=secmem;
<a name="l00597"></a>00597       <a class="code" href="classEquation__base.html#aaaf61d60cca8205d2490a023633cc7d4">solveur_masse</a>.<a class="code" href="classSolveur__Masse.html#af7afe8c2d4d5764f7428f2cd4ef43ddb" title="Appel a l&#39;objet sous-jacent. Resoud le systeme lineaire, dont la matrice est la matrice de masse...">appliquer</a>(<a class="code" href="classEquation__base.html#a10fb27f5c41123bf4ff96e616549f6d7">derivee_en_temps</a>().valeurs());
<a name="l00598"></a>00598       <a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#aa363b76fa823b37bf9d1ae784f33bbfa">modifier_second_membre</a>((*<span class="keyword">this</span>),secmem); <span class="comment">//!&lt; Change secmem for some schemes (eg: Adams_Bashforth)</span>
<a name="l00599"></a>00599 <span class="comment"></span>    }
<a name="l00600"></a>00600 
<a name="l00601"></a>00601   <a class="code" href="classEquation__base.html#a5c06feed3927199a5ff70fb1c3a10f2a">corriger_derivee_expl</a>(secmem); <span class="comment">//!&lt; Add specific term for an equation (eg: -gradP for Navier Stokes)</span>
<a name="l00602"></a>00602 <span class="comment"></span>
<a name="l00603"></a>00603   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#aef791a4afd5964d1b4dfd3d2ac3f5e5e">implicite_</a>==0)
<a name="l00604"></a>00604     {
<a name="l00605"></a>00605       <a class="code" href="classEquation__base.html#aaaf61d60cca8205d2490a023633cc7d4">solveur_masse</a>.<a class="code" href="classSolveur__Masse.html#af7afe8c2d4d5764f7428f2cd4ef43ddb" title="Appel a l&#39;objet sous-jacent. Resoud le systeme lineaire, dont la matrice est la matrice de masse...">appliquer</a>(secmem); <span class="comment">//!&lt; M-1 * secmem</span>
<a name="l00606"></a>00606 <span class="comment"></span>      <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().diffusion_implicite())
<a name="l00607"></a>00607         {
<a name="l00608"></a>00608 <span class="comment">// Solve: (1/dt + M-1*A)*dI = M-1 * secmem</span>
<a name="l00609"></a>00609 <span class="comment">// where A is the diffusion</span>
<a name="l00610"></a>00610           <a class="code" href="classEquation__base.html#abd67532530f67b3305703a130a5d823a">Equation_base::Gradient_conjugue_diff_impl</a>(secmem, derivee);
<a name="l00611"></a>00611         }
<a name="l00612"></a>00612       <span class="keywordflow">else</span>
<a name="l00613"></a>00613         {
<a name="l00614"></a>00614           derivee = secmem;
<a name="l00615"></a>00615           derivee.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l00616"></a>00616         }
<a name="l00617"></a>00617       <a class="code" href="classEquation__base.html#ab1a4dff7878cb1c47efb1ecb7b5b31ae">corriger_derivee_impl</a>(derivee);  <span class="comment">//!&lt; Solve specific implicit term for an equation (eg: pressure for Navier Stokes)</span>
<a name="l00618"></a>00618 <span class="comment"></span>    }
<a name="l00619"></a>00619   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#aef791a4afd5964d1b4dfd3d2ac3f5e5e">implicite_</a>&gt;0)
<a name="l00620"></a>00620     {
<a name="l00621"></a>00621 <span class="comment">// TRUST support notices that this part has never been covered...</span>
<a name="l00622"></a>00622 <span class="comment">// implicite</span>
<a name="l00623"></a>00623 <span class="comment">// M dU/dt + AU* = f -BUn;</span>
<a name="l00624"></a>00624 <span class="comment">// U* = Un+dt dU/dt</span>
<a name="l00625"></a>00625 <span class="comment">// (M/dt + A) U* = f -BUn + M/dt Un</span>
<a name="l00626"></a>00626 <span class="comment">// </span>
<a name="l00627"></a>00627       <span class="keywordtype">double</span> dt=<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a0e4f67ef6086c09434ddc161668077b2" title="Renvoie le pas de temps (delta_t) courant.">pas_de_temps</a>();
<a name="l00628"></a>00628       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classConvection__Diffusion__std.html#a1eccdf9e6aedfbf1914e9fa95962fbf9" title="Renvoie le nombre d&#39;operateurs de l&#39;equation: 2 pour une equation de diffusion.">nombre_d_operateurs</a>(); i++)
<a name="l00629"></a>00629         {
<a name="l00630"></a>00630 <span class="comment">// boucle sur les operateurs</span>
<a name="l00631"></a>00631           <a class="code" href="classOperateur__base.html" title="classe Operateur_base Classe est la base de la hierarchie des objets representant un operateur utilis...">Operateur_base</a>&amp; op=<a class="code" href="classConvection__Diffusion__std.html#a4bb82d17dd39ba9d8531764b2800a8bd" title="Renvoie l&#39;operateur specifie par son index: renvoie terme_diffusif si i = 0 renvoie terme_convectif s...">operateur</a>(i).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>();
<a name="l00632"></a>00632           <span class="keywordflow">if</span>(!op.<a class="code" href="classOperateur__base.html#a02e406fee1f2f32954a0fc6f1b86dca8">get_matrice</a>().<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>())
<a name="l00633"></a>00633             op.<a class="code" href="classOperateur__base.html#a58bbc3d85feaa143ec0d87e68d8fe137">set_matrice</a>().<a class="code" href="classDeriv__.html#ad1d33400ed15b6ff96579ed82d9e2719" title="Essaie de creer une instance du type &quot;type&quot;. si type n&#39;est pas un type ou type n&#39;est pas instanciab...">typer</a>(<span class="stringliteral">&quot;Matrice_Morse&quot;</span>);
<a name="l00634"></a>00634           <span class="keywordflow">if</span>(op.<a class="code" href="classOperateur__base.html#ae7dae6829b1287b470717b08a8ae761e">get_decal_temps</a>()==1)
<a name="l00635"></a>00635             {
<a name="l00636"></a>00636 <span class="comment">// if (op.set_matrice().valeur().nb_lignes()&lt;2)</span>
<a name="l00637"></a>00637               {
<a name="l00638"></a>00638                 <a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a>&amp; matrice=<a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a>,op.<a class="code" href="classOperateur__base.html#a58bbc3d85feaa143ec0d87e68d8fe137">set_matrice</a>().<a class="code" href="classDeriv__Matrice__Base.html#ae43f3a90ca16518c191f9e7d5ebef912">valeur</a>());
<a name="l00639"></a>00639                 op.<a class="code" href="classOperateur__base.html#a66ef3c42e72d13fce0852ba92e56be6a" title="NE FAIT RIEN A surcharger dans les classes derivees.">dimensionner</a>(matrice);
<a name="l00640"></a>00640                 <a class="code" href="classEquation__base.html#afd09d18db565d1acb431885b9c6d4a55">sys_invariant_</a>=0;
<a name="l00641"></a>00641               }
<a name="l00642"></a>00642               <span class="keywordflow">if</span>(!<a class="code" href="classEquation__base.html#afd09d18db565d1acb431885b9c6d4a55">sys_invariant_</a>)
<a name="l00643"></a>00643                 {
<a name="l00644"></a>00644                   <a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a>&amp; matrice=<a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a>, op.<a class="code" href="classOperateur__base.html#a58bbc3d85feaa143ec0d87e68d8fe137">set_matrice</a>().<a class="code" href="classDeriv__Matrice__Base.html#ae43f3a90ca16518c191f9e7d5ebef912">valeur</a>());
<a name="l00645"></a>00645                   op.<a class="code" href="classOperateur__base.html#a903e728aad8e2d490580bf264319d65f" title="NE FAIT RIEN A surcharger dans les classes derivees.">contribuer_a_avec</a>(<a class="code" href="classConvection__Diffusion__Temperature.html#aab6a891f15e7996eda73b1b6e67e7dbd" title="Renvoie le champ inconnue representant la temperatue. (version const)">inconnue</a>().valeurs(), matrice);
<a name="l00646"></a>00646                   <a class="code" href="classEquation__base.html#adfedf474c07a92f6b2261ca2f1cee80e" title="Renvoie le solveur de masse associe a l&#39;equation.">solv_masse</a>().<a class="code" href="classSolveur__Masse.html#adc554d2f7efe81e71ff8995d4f2df8c7">ajouter_masse</a>(dt, op.<a class="code" href="classOperateur__base.html#a58bbc3d85feaa143ec0d87e68d8fe137">set_matrice</a>().<a class="code" href="classDeriv__Matrice__Base.html#ae43f3a90ca16518c191f9e7d5ebef912">valeur</a>());
<a name="l00647"></a>00647 
<a name="l00648"></a>00648                   <span class="keywordflow">if</span>(
<a name="l00649"></a>00649                     (op.<a class="code" href="classOperateur__base.html#a2861e28bd5b9d3484c73271209b2e0b6">get_solveur</a>()-&gt;<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>()==<span class="stringliteral">&quot;Solv_Cholesky&quot;</span>)
<a name="l00650"></a>00650                     ||
<a name="l00651"></a>00651                     (op.<a class="code" href="classOperateur__base.html#a2861e28bd5b9d3484c73271209b2e0b6">get_solveur</a>()-&gt;<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>()==<span class="stringliteral">&quot;Solv_GCP&quot;</span>)
<a name="l00652"></a>00652                   )
<a name="l00653"></a>00653                     {
<a name="l00654"></a>00654                       <a class="code" href="classMatrice__Morse__Sym.html" title="Classe Matrice_Morse_Sym Represente une matrice M (creuse) symetrique stockee au format Morse Symetri...">Matrice_Morse_Sym</a> new_mat(matrice);
<a name="l00655"></a>00655                       new_mat.<a class="code" href="classMatrice__Sym.html#a532cf830aed3865010c9977b545927c0">set_est_definie</a>(1);
<a name="l00656"></a>00656                       op.<a class="code" href="classOperateur__base.html#a58bbc3d85feaa143ec0d87e68d8fe137">set_matrice</a>()=new_mat;
<a name="l00657"></a>00657                       <a class="code" href="Cast_8h.html#ad3836a067c92103af8df5ad8f35959a6">ref_cast_non_const</a>(<a class="code" href="classSolveurSys.html">SolveurSys</a>,op.<a class="code" href="classOperateur__base.html#a2861e28bd5b9d3484c73271209b2e0b6">get_solveur</a>())-&gt;reinit();
<a name="l00658"></a>00658                     }
<a name="l00659"></a>00659                 }
<a name="l00660"></a>00660             }
<a name="l00661"></a>00661         }
<a name="l00662"></a>00662       <span class="keywordflow">if</span>(<a class="code" href="classEquation__base.html#aef791a4afd5964d1b4dfd3d2ac3f5e5e">implicite_</a>==1)
<a name="l00663"></a>00663         {
<a name="l00664"></a>00664 <span class="comment">// Un seul operateur implicite.</span>
<a name="l00665"></a>00665 <span class="comment">// On suppose que c&#39;est le premier (la diffusion !!)</span>
<a name="l00666"></a>00666           <a class="code" href="classOperateur__base.html" title="classe Operateur_base Classe est la base de la hierarchie des objets representant un operateur utilis...">Operateur_base</a>&amp; op=<a class="code" href="classConvection__Diffusion__std.html#a4bb82d17dd39ba9d8531764b2800a8bd" title="Renvoie l&#39;operateur specifie par son index: renvoie terme_diffusif si i = 0 renvoie terme_convectif s...">operateur</a>(0).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>();
<a name="l00667"></a>00667           <a class="code" href="classMatrice__Base.html">Matrice_Base</a>&amp; matrice=op.<a class="code" href="classOperateur__base.html#a58bbc3d85feaa143ec0d87e68d8fe137">set_matrice</a>().<a class="code" href="classDeriv__Matrice__Base.html#ae43f3a90ca16518c191f9e7d5ebef912">valeur</a>();
<a name="l00668"></a>00668 <span class="comment">// DoubleTrav secmem(derivee);</span>
<a name="l00669"></a>00669           secmem=derivee;
<a name="l00670"></a>00670           <a class="code" href="classEquation__base.html#adfedf474c07a92f6b2261ca2f1cee80e" title="Renvoie le solveur de masse associe a l&#39;equation.">solv_masse</a>().<a class="code" href="classSolveur__Masse.html#adc554d2f7efe81e71ff8995d4f2df8c7">ajouter_masse</a>(dt, secmem, <a class="code" href="classConvection__Diffusion__Temperature.html#aab6a891f15e7996eda73b1b6e67e7dbd" title="Renvoie le champ inconnue representant la temperatue. (version const)">inconnue</a>().valeurs());
<a name="l00671"></a>00671           op.<a class="code" href="classOperateur__base.html#a1b64f0211a360c124a218be15c80d9c7" title="NE FAIT RIEN A surcharger dans les classes derivees.">contribuer_au_second_membre</a>(secmem );
<a name="l00672"></a>00672           op.<a class="code" href="classOperateur__base.html#a2fe69e40852fa946df7685516d3e5c66">set_solveur</a>().<a class="code" href="classSolveurSys.html#a62ca198f0c5dc599e53b0535761e5138">resoudre_systeme</a>(matrice,
<a name="l00673"></a>00673                                             secmem,
<a name="l00674"></a>00674                                             derivee
<a name="l00675"></a>00675                                            );
<a name="l00676"></a>00676           <a class="code" href="classEquation__base.html#adfedf474c07a92f6b2261ca2f1cee80e" title="Renvoie le solveur de masse associe a l&#39;equation.">solv_masse</a>().<a class="code" href="classSolveur__Masse.html#a328dc53fbe227ba188eaf55cd98474b8">corriger_solution</a>(derivee,<a class="code" href="classConvection__Diffusion__Temperature.html#aab6a891f15e7996eda73b1b6e67e7dbd" title="Renvoie le champ inconnue representant la temperatue. (version const)">inconnue</a>().valeurs());
<a name="l00677"></a>00677 
<a name="l00678"></a>00678           derivee-=<a class="code" href="classConvection__Diffusion__Temperature.html#aab6a891f15e7996eda73b1b6e67e7dbd" title="Renvoie le champ inconnue representant la temperatue. (version const)">inconnue</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>();
<a name="l00679"></a>00679           derivee/=dt;
<a name="l00680"></a>00680 
<a name="l00681"></a>00681 <span class="comment">// Sert uniquement a calculer les flux sur les bords quand la diffusion est implicitee !</span>
<a name="l00682"></a>00682           <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> resu;
<a name="l00683"></a>00683           resu=derivee;
<a name="l00684"></a>00684           <a class="code" href="classConvection__Diffusion__std.html#a4bb82d17dd39ba9d8531764b2800a8bd" title="Renvoie l&#39;operateur specifie par son index: renvoie terme_diffusif si i = 0 renvoie terme_convectif s...">operateur</a>(0).<a class="code" href="classOperateur.html#a203dd066e5203d6e9a02298b8ec12e09">calculer</a>(<a class="code" href="classConvection__Diffusion__Temperature.html#aab6a891f15e7996eda73b1b6e67e7dbd" title="Renvoie le champ inconnue representant la temperatue. (version const)">inconnue</a>().valeurs(), resu);
<a name="l00685"></a>00685         }
<a name="l00686"></a>00686       <span class="keywordflow">else</span>
<a name="l00687"></a>00687         {
<a name="l00688"></a>00688 <span class="comment">// plusieurs operateurs implicites ...</span>
<a name="l00689"></a>00689           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Must be coded ... &quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00690"></a>00690           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00691"></a>00691         }
<a name="l00692"></a>00692     }
<a name="l00693"></a>00693   <span class="keywordflow">else</span>
<a name="l00694"></a>00694     {
<a name="l00695"></a>00695       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Equation_base::derivee_en_temps_inco&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00696"></a>00696       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;implicite_ = &quot;</span> &lt;&lt; <a class="code" href="classEquation__base.html#aef791a4afd5964d1b4dfd3d2ac3f5e5e">implicite_</a> &lt;&lt; <span class="stringliteral">&quot; has not been initialized!&quot;</span> &lt;&lt; finl;
<a name="l00697"></a>00697       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;May be &quot;</span> &lt;&lt; <a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; <span class="stringliteral">&quot;::completer() method doesn&#39;t call Equation_base::completer()&quot;</span> &lt;&lt; finl;
<a name="l00698"></a>00698       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Contact TRUST support.&quot;</span> &lt;&lt; finl;
<a name="l00699"></a>00699       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00700"></a>00700     }
<a name="l00701"></a>00701   <span class="keywordflow">return</span> derivee;
<a name="l00702"></a>00702 }
<a name="l00703"></a>00703 
<a name="l00704"></a>00704 <span class="comment">// ajoute les contributions des operateurs et des sources</span>
<a name="l00705"></a><a class="code" href="classConvection__Diffusion__Temperature.html#afb5baf5187a88ec71af939b53385b0c7">00705</a> <span class="keywordtype">void</span> <a class="code" href="classConvection__Diffusion__Temperature.html#afb5baf5187a88ec71af939b53385b0c7">Convection_Diffusion_Temperature::assembler</a>(<a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a>&amp; matrice, <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; inco, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; resu)
<a name="l00706"></a>00706 {
<a name="l00707"></a>00707   <span class="keyword">const</span> <span class="keywordtype">double</span> rhoCp = <a class="code" href="classConvection__Diffusion__Temperature.html#af5a9044ac039656dcde5c44fe081413e">le_fluide</a>-&gt;capacite_calorifique().valeurs()(0, 0) * <a class="code" href="classConvection__Diffusion__Temperature.html#af5a9044ac039656dcde5c44fe081413e">le_fluide</a>-&gt;masse_volumique().valeurs()(0, 0);
<a name="l00708"></a>00708 
<a name="l00709"></a>00709 <span class="comment">// Test de verification de la methode contribuer_a_avec</span>
<a name="l00710"></a>00710   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> op=0; op&lt;<a class="code" href="classConvection__Diffusion__std.html#a1eccdf9e6aedfbf1914e9fa95962fbf9" title="Renvoie le nombre d&#39;operateurs de l&#39;equation: 2 pour une equation de diffusion.">nombre_d_operateurs</a>(); op++)
<a name="l00711"></a>00711     <a class="code" href="classConvection__Diffusion__std.html#a4bb82d17dd39ba9d8531764b2800a8bd" title="Renvoie l&#39;operateur specifie par son index: renvoie terme_diffusif si i = 0 renvoie terme_convectif s...">operateur</a>(op).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#a3640f8feaeac1bf4d8ff3777c233753c">tester_contribuer_a_avec</a>(inco, matrice);
<a name="l00712"></a>00712 
<a name="l00713"></a>00713 <span class="comment">// Contribution des operateurs et des sources:</span>
<a name="l00714"></a>00714 <span class="comment">// [Vol/dt+A]Inco(n+1)=somme(residu)+Vol/dt*Inco(n)</span>
<a name="l00715"></a>00715 <span class="comment">// Typiquement: si Op=flux(Inco) alors la matrice implicite A contient une contribution -dflux/dInco</span>
<a name="l00716"></a>00716 <span class="comment">// Exemple: Op flux convectif en VDF:</span>
<a name="l00717"></a>00717 <span class="comment">// Op=T*u*S et A=-d(T*u*S)/dT=-u*S</span>
<a name="l00718"></a>00718   <span class="keyword">const</span> <a class="code" href="classDiscretisation__base.html#ad6b02af5532904375c2384825f2d4ea0">Discretisation_base::type_calcul_du_residu</a>&amp; type_codage=<a class="code" href="classEquation__base.html#aa8151a96f63719523bf50ddd832e0f8f" title="Renvoie le probleme associe a l&#39;equation.">probleme</a>().<a class="code" href="classProbleme__base.html#ac2bc635ab5b121c1cab78b6f98c0b203" title="Renvoie la discretisation associee au probleme.">discretisation</a>().<a class="code" href="classDiscretisation__base.html#a9d643031e55125e1b99dcafa32a4c54c">codage_du_calcul_du_residu</a>();
<a name="l00719"></a>00719   <span class="keywordflow">if</span> (type_codage==<a class="code" href="classDiscretisation__base.html#ad6b02af5532904375c2384825f2d4ea0a6da3daf19c0be297ebb5c28e3ad11b2d">Discretisation_base::VIA_CONTRIBUER_AU_SECOND_MEMBRE</a>)
<a name="l00720"></a>00720     {
<a name="l00721"></a>00721       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;VIA_CONTRIBUER_AU_SECOND_MEMBRE pas code pour &quot;</span> &lt;&lt; <a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; <span class="stringliteral">&quot;:assembler&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00722"></a>00722       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00723"></a>00723 <span class="comment">// // On calcule somme(residu) par contribuer_au_second_membre (typiquement CL non implicitees)</span>
<a name="l00724"></a>00724 <span class="comment">// // Cette approche necessite de coder 3 methodes (contribuer_a_avec, contribuer_au_second_membre et ajouter pour l&#39;explicite)</span>
<a name="l00725"></a>00725 <span class="comment">// sources().contribuer_a_avec(inco,matrice);</span>
<a name="l00726"></a>00726 <span class="comment">// statistiques().end_count(assemblage_sys_counter_,0,0);</span>
<a name="l00727"></a>00727 <span class="comment">// sources().ajouter(resu);</span>
<a name="l00728"></a>00728 <span class="comment">// statistiques().begin_count(assemblage_sys_counter_);</span>
<a name="l00729"></a>00729 <span class="comment">// matrice.ajouter_multvect(inco, resu); // Add source residual first</span>
<a name="l00730"></a>00730 <span class="comment">// for (int op = 0; op &lt; nombre_d_operateurs(); op++)</span>
<a name="l00731"></a>00731 <span class="comment">// {</span>
<a name="l00732"></a>00732 <span class="comment">// operateur(op).l_op_base().contribuer_a_avec(inco, matrice);</span>
<a name="l00733"></a>00733 <span class="comment">// operateur(op).l_op_base().contribuer_au_second_membre(resu);</span>
<a name="l00734"></a>00734 <span class="comment">// }</span>
<a name="l00735"></a>00735     }
<a name="l00736"></a>00736   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type_codage==<a class="code" href="classDiscretisation__base.html#ad6b02af5532904375c2384825f2d4ea0ab1b0885ce8af07e1563ae012e4822f6e">Discretisation_base::VIA_AJOUTER</a>)
<a name="l00737"></a>00737     {
<a name="l00738"></a>00738 <span class="comment">// On calcule somme(residu) par somme(operateur)+sources+A*Inco(n)</span>
<a name="l00739"></a>00739 <span class="comment">// Cette approche necessite de coder seulement deux methodes (contribuer_a_avec et ajouter)</span>
<a name="l00740"></a>00740 <span class="comment">// Donc un peu plus couteux en temps de calcul mais moins de code a ecrire/maintenir</span>
<a name="l00741"></a>00741       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> op=0; op&lt;<a class="code" href="classConvection__Diffusion__std.html#a1eccdf9e6aedfbf1914e9fa95962fbf9" title="Renvoie le nombre d&#39;operateurs de l&#39;equation: 2 pour une equation de diffusion.">nombre_d_operateurs</a>(); op++)
<a name="l00742"></a>00742         {
<a name="l00743"></a>00743           <a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a> mat(matrice);
<a name="l00744"></a>00744           mat.<a class="code" href="classMatrice__Morse.html#acd067e8514e5741f52b18a1d99746d11">get_set_coeff</a>() = 0.0;
<a name="l00745"></a>00745           <a class="code" href="classConvection__Diffusion__std.html#a4bb82d17dd39ba9d8531764b2800a8bd" title="Renvoie l&#39;operateur specifie par son index: renvoie terme_diffusif si i = 0 renvoie terme_convectif s...">operateur</a>(op).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#a903e728aad8e2d490580bf264319d65f" title="NE FAIT RIEN A surcharger dans les classes derivees.">contribuer_a_avec</a>(inco, mat);
<a name="l00746"></a>00746           <span class="keywordflow">if</span> (op == 1) mat *= rhoCp; <span class="comment">//!&lt; la derivee est multipliee par rhoCp pour la convection</span>
<a name="l00747"></a>00747 <span class="comment"></span>          matrice += mat;
<a name="l00748"></a>00748           <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a0faf52d1b518f5b0b2177f22efcc222d" title="Arret du compteur counter_id. On ajoute quantity a la somme des &#39;quantity&#39; (par defaut 0) stockees po...">end_count</a>(assemblage_sys_counter_, 0, 0);
<a name="l00749"></a>00749           {
<a name="l00750"></a>00750             <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> resu_tmp(resu);
<a name="l00751"></a>00751             resu_tmp = 0.;
<a name="l00752"></a>00752             <a class="code" href="classConvection__Diffusion__std.html#a4bb82d17dd39ba9d8531764b2800a8bd" title="Renvoie l&#39;operateur specifie par son index: renvoie terme_diffusif si i = 0 renvoie terme_convectif s...">operateur</a>(op).<a class="code" href="classOperateur.html#accdf61cf1e33fb42e9eb06f1c501422b">ajouter</a>(inco, resu_tmp);
<a name="l00753"></a>00753             <span class="keywordflow">if</span> (op == 1) resu_tmp *= rhoCp;
<a name="l00754"></a>00754             resu += resu_tmp;
<a name="l00755"></a>00755           }
<a name="l00756"></a>00756           <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#affcd058809786918ed173aaf681d0843">begin_count</a>(assemblage_sys_counter_);
<a name="l00757"></a>00757         }
<a name="l00758"></a>00758       <a class="code" href="classEquation__base.html#a3c8ac50e3e7b6ed29024a43e828a5396" title="Renvoie les termes sources asssocies a l&#39;equation.">sources</a>().<a class="code" href="classSources.html#aa91bceeb92650bc8b60a94f193a9d689" title="contribution a la matrice implicite des termes sources par defaut pas de contribution">contribuer_a_avec</a>(inco,matrice);
<a name="l00759"></a>00759       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a0faf52d1b518f5b0b2177f22efcc222d" title="Arret du compteur counter_id. On ajoute quantity a la somme des &#39;quantity&#39; (par defaut 0) stockees po...">end_count</a>(assemblage_sys_counter_,0,0);
<a name="l00760"></a>00760       <a class="code" href="classEquation__base.html#a3c8ac50e3e7b6ed29024a43e828a5396" title="Renvoie les termes sources asssocies a l&#39;equation.">sources</a>().<a class="code" href="classSources.html#a6fc277f1920a71841cb041dc1b6ed771" title="Ajoute la contribution de toutes les sources de la liste au tableau passe en parametre, et renvoie ce tableau.">ajouter</a>(resu);
<a name="l00761"></a>00761       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#affcd058809786918ed173aaf681d0843">begin_count</a>(assemblage_sys_counter_);
<a name="l00762"></a>00762       matrice.<a class="code" href="classMatrice__Base.html#a6ccb4d20d3877cf09f5178ff72af5406" title="Operation de multiplication-accumulation (saxpy) matrice vecteur. Operation: r = r + A*x...">ajouter_multvect</a>(inco, resu); <span class="comment">//!&lt; Ajout de A*Inco(n) PL (11/04/2018): On aimerait bien calculer la contribution des sources en premier comme dans le cas VIA_CONTRIBUER_AU_SECOND_MEMBRE mais le cas Canal_perio_3D (keps periodique plante: il y&#39;a une erreur de periodicite dans les termes sources du modele KEps...</span>
<a name="l00763"></a>00763 <span class="comment"></span><span class="comment">//</span>
<a name="l00764"></a>00764 <span class="comment">//</span>
<a name="l00765"></a>00765 <span class="comment">//</span>
<a name="l00766"></a>00766     }
<a name="l00767"></a>00767   <span class="keywordflow">else</span>
<a name="l00768"></a>00768     {
<a name="l00769"></a>00769       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Unknown value in Equation_base::assembler for &quot;</span> &lt;&lt; (int)type_codage &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00770"></a>00770       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00771"></a>00771     }
<a name="l00772"></a>00772 }
<a name="l00773"></a>00773 
<a name="l00774"></a><a class="code" href="classConvection__Diffusion__Temperature.html#a5893252be9df68bd585d71351ce118e4">00774</a> <span class="keywordtype">int</span> <a class="code" href="classConvection__Diffusion__Temperature.html#a5893252be9df68bd585d71351ce118e4">Convection_Diffusion_Temperature::verifier_tag_indicatrice_pena_glob</a>()
<a name="l00775"></a>00775 {
<a name="l00776"></a>00776 <span class="comment">// Les ibcs ont elles ete modifiees ?</span>
<a name="l00777"></a>00777   <span class="keywordtype">int</span> maj = 0;
<a name="l00778"></a>00778   <span class="keywordtype">int</span> tag_all = 0;
<a name="l00779"></a>00779   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> w = 0; w&lt;<a class="code" href="classConvection__Diffusion__Temperature.html#a025ff54c166b1a5ec73680548e82b913">ref_penalisation_L2_FTD</a>.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>() ; ++w)
<a name="l00780"></a>00780     {
<a name="l00781"></a>00781       <a class="code" href="classTransport__Interfaces__base.html" title="classe Transport_Interfaces_base Cette classe constitue la classe de base des equations de transport ...">Transport_Interfaces_base</a>&amp; nom_eq = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classTransport__Interfaces__base.html" title="classe Transport_Interfaces_base Cette classe constitue la classe de base des equations de transport ...">Transport_Interfaces_base</a>,<a class="code" href="classConvection__Diffusion__Temperature.html#a025ff54c166b1a5ec73680548e82b913">ref_penalisation_L2_FTD</a>[w].<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>());
<a name="l00782"></a>00782       tag_all += nom_eq.<a class="code" href="classTransport__Interfaces__base.html#ac2016f75dfb4fb46bdbd2fd5adda1d89">get_mesh_tag</a>();
<a name="l00783"></a>00783     }
<a name="l00784"></a>00784   <span class="keywordflow">if</span> (tag_all == <a class="code" href="classConvection__Diffusion__Temperature.html#aa281e6ca4e8b6de76091836eb6d62ae3">tag_indic_pena_global</a>) maj = 1;
<a name="l00785"></a>00785   <span class="keywordflow">return</span> maj;
<a name="l00786"></a>00786 }
<a name="l00787"></a>00787 
<a name="l00788"></a><a class="code" href="classConvection__Diffusion__Temperature.html#aecf0e32fb40f34138650f1ced3b2aa71">00788</a> <span class="keywordtype">int</span> <a class="code" href="classConvection__Diffusion__Temperature.html#aecf0e32fb40f34138650f1ced3b2aa71">Convection_Diffusion_Temperature::mise_a_jour_tag_indicatrice_pena_glob</a>()
<a name="l00789"></a>00789 {
<a name="l00790"></a>00790 <span class="comment">// Les ibcs ont elles ete modifiees ?</span>
<a name="l00791"></a>00791   <span class="keywordtype">int</span> maj = 0;
<a name="l00792"></a>00792   <span class="keywordtype">int</span> tag_all = 0;
<a name="l00793"></a>00793   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> w = 0; w&lt;<a class="code" href="classConvection__Diffusion__Temperature.html#a025ff54c166b1a5ec73680548e82b913">ref_penalisation_L2_FTD</a>.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>() ; ++w)
<a name="l00794"></a>00794     {
<a name="l00795"></a>00795       <a class="code" href="classTransport__Interfaces__base.html" title="classe Transport_Interfaces_base Cette classe constitue la classe de base des equations de transport ...">Transport_Interfaces_base</a>&amp; nom_eq = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classTransport__Interfaces__base.html" title="classe Transport_Interfaces_base Cette classe constitue la classe de base des equations de transport ...">Transport_Interfaces_base</a>,<a class="code" href="classConvection__Diffusion__Temperature.html#a025ff54c166b1a5ec73680548e82b913">ref_penalisation_L2_FTD</a>[w].<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>());
<a name="l00796"></a>00796       tag_all += nom_eq.<a class="code" href="classTransport__Interfaces__base.html#ac2016f75dfb4fb46bdbd2fd5adda1d89">get_mesh_tag</a>();
<a name="l00797"></a>00797     }
<a name="l00798"></a>00798   <span class="keywordflow">if</span> (tag_all != <a class="code" href="classConvection__Diffusion__Temperature.html#aa281e6ca4e8b6de76091836eb6d62ae3">tag_indic_pena_global</a>)
<a name="l00799"></a>00799     {
<a name="l00800"></a>00800       <a class="code" href="classConvection__Diffusion__Temperature.html#aa281e6ca4e8b6de76091836eb6d62ae3">tag_indic_pena_global</a> = tag_all;
<a name="l00801"></a>00801       maj = 1;
<a name="l00802"></a>00802     }
<a name="l00803"></a>00803   <span class="keywordflow">return</span> maj;
<a name="l00804"></a>00804 }
<a name="l00805"></a>00805 
<a name="l00806"></a><a class="code" href="classConvection__Diffusion__Temperature.html#a2166b2c55902ad79bd60c797f31d1355">00806</a> <span class="keywordtype">void</span> <a class="code" href="classConvection__Diffusion__Temperature.html#a2166b2c55902ad79bd60c797f31d1355">Convection_Diffusion_Temperature::set_indic_pena_globale</a>()
<a name="l00807"></a>00807 {
<a name="l00808"></a>00808 <span class="comment">// Set de la fonction characteristique ibc globlale (element et faces)</span>
<a name="l00809"></a>00809   <span class="keywordtype">int</span> maj = <a class="code" href="classConvection__Diffusion__Temperature.html#a5893252be9df68bd585d71351ce118e4">verifier_tag_indicatrice_pena_glob</a>();
<a name="l00810"></a>00810   <span class="keywordflow">if</span> (maj == 0)
<a name="l00811"></a>00811     {
<a name="l00812"></a>00812       <a class="code" href="classConvection__Diffusion__Temperature.html#a54112f5b487abbdfc59de04c562b1b26">calcul_indic_pena_global</a>(<a class="code" href="classConvection__Diffusion__Temperature.html#a051d95d33a49c1860e4da0c5b62d9862">indic_pena_global</a>, <a class="code" href="classConvection__Diffusion__Temperature.html#ac11d5686f6bcdd802887cd66c01a54c7">indic_face_pena_global</a>);
<a name="l00813"></a>00813       maj = <a class="code" href="classConvection__Diffusion__Temperature.html#aecf0e32fb40f34138650f1ced3b2aa71">mise_a_jour_tag_indicatrice_pena_glob</a>();
<a name="l00814"></a>00814       assert(maj == 1);
<a name="l00815"></a>00815     }
<a name="l00816"></a>00816 }
<a name="l00817"></a>00817 
<a name="l00818"></a><a class="code" href="classConvection__Diffusion__Temperature.html#a82affa83cd11442b4b18d0e7114d4b08">00818</a> <span class="keywordtype">void</span> <a class="code" href="classConvection__Diffusion__Temperature.html#a82affa83cd11442b4b18d0e7114d4b08">Convection_Diffusion_Temperature::transport_ibc</a>(<a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a>&amp; secmem_conv_vr, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; inco_conv_vr)
<a name="l00819"></a>00819 {
<a name="l00820"></a>00820   secmem_conv_vr = 0.;
<a name="l00821"></a>00821   <span class="keyword">const</span> <span class="keywordtype">double</span> rhoCp = <a class="code" href="classConvection__Diffusion__Temperature.html#af5a9044ac039656dcde5c44fe081413e">le_fluide</a>-&gt;capacite_calorifique().valeurs()(0, 0) * <a class="code" href="classConvection__Diffusion__Temperature.html#af5a9044ac039656dcde5c44fe081413e">le_fluide</a>-&gt;masse_volumique().valeurs()(0, 0);
<a name="l00822"></a>00822 
<a name="l00823"></a>00823 <span class="comment">// fonction characteristique globale ibc au temps courant</span>
<a name="l00824"></a>00824   <a class="code" href="classConvection__Diffusion__Temperature.html#a2166b2c55902ad79bd60c797f31d1355">set_indic_pena_globale</a>();
<a name="l00825"></a>00825 
<a name="l00826"></a>00826 <span class="comment">// on calcule l indicatrice epaisse</span>
<a name="l00827"></a>00827   <span class="keyword">const</span> <a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>&amp; zone_vf = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>, <a class="code" href="classEquation__base.html#a12d97ae801edc18f614523677921346e" title="Renvoie la zone discretisee associee a l&#39;equation.">zone_dis</a>().<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>());
<a name="l00828"></a>00828   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; faces_elem = zone_vf.<a class="code" href="classZone__VF.html#a49d4322f5585a8fa95748ca785b70702" title="renvoie l&#39;element voisin de numface dans la direction i. i=0 : dans le sens oppose de l&#39;axe orthogona...">face_voisins</a>();
<a name="l00829"></a>00829   <a class="code" href="classIntTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un IntTab avec allocation dans un pool de memoire gere...">IntTrav</a> indic_pena_global_fat(<a class="code" href="classConvection__Diffusion__Temperature.html#a051d95d33a49c1860e4da0c5b62d9862">indic_pena_global</a>);
<a name="l00830"></a>00830   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_face = 0; i_face &lt; <a class="code" href="classConvection__Diffusion__Temperature.html#ac11d5686f6bcdd802887cd66c01a54c7">indic_face_pena_global</a>.<a class="code" href="classIntVect.html#ad90cfd411cbbd631ccf1935bb36f7c40" title="Identique a size_reelle()">size</a>(); i_face++)
<a name="l00831"></a>00831     {
<a name="l00832"></a>00832       <span class="keywordflow">if</span> (<a class="code" href="classConvection__Diffusion__Temperature.html#ac11d5686f6bcdd802887cd66c01a54c7">indic_face_pena_global</a>(i_face) &gt; 0.)
<a name="l00833"></a>00833         {
<a name="l00834"></a>00834           <span class="keyword">const</span> <span class="keywordtype">int</span> voisin_0 = faces_elem(i_face, 0);
<a name="l00835"></a>00835           <span class="keywordflow">if</span> (voisin_0 &gt;= 0) indic_pena_global_fat(voisin_0) = 1;
<a name="l00836"></a>00836           <span class="keyword">const</span> <span class="keywordtype">int</span> voisin_1 = faces_elem(i_face, 1);
<a name="l00837"></a>00837           <span class="keywordflow">if</span> (voisin_1 &gt;= 0) indic_pena_global_fat(voisin_1) = 1;
<a name="l00838"></a>00838         }
<a name="l00839"></a>00839     }
<a name="l00840"></a>00840 <span class="comment">// post-traitement particulier pour les coins</span>
<a name="l00841"></a>00841   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; elem_faces = zone_vf.<a class="code" href="classZone__VF.html#a067e462dcd3ab92b0f6d945b19e4eb37" title="renvoie le numero de le ieme face de la maille num_elem la facon dont ces faces sont numerotees est l...">elem_faces</a>();
<a name="l00842"></a>00842   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_faces_elem = elem_faces.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1);
<a name="l00843"></a>00843   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_elem  = <a class="code" href="classConvection__Diffusion__Temperature.html#a051d95d33a49c1860e4da0c5b62d9862">indic_pena_global</a>.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00844"></a>00844   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_elem = 0; i_elem &lt; nb_elem;  i_elem++)
<a name="l00845"></a>00845     {
<a name="l00846"></a>00846       <span class="keywordflow">if</span> (indic_pena_global_fat(i_elem) == 0)
<a name="l00847"></a>00847         {
<a name="l00848"></a>00848           <span class="keywordtype">int</span> <a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a> = 0;
<a name="l00849"></a>00849           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_face = 0; i_face &lt; nb_faces_elem; i_face++)
<a name="l00850"></a>00850             {
<a name="l00851"></a>00851               <span class="keyword">const</span> <span class="keywordtype">int</span> face = elem_faces(i_elem, i_face);
<a name="l00852"></a>00852               <span class="keyword">const</span> <span class="keywordtype">int</span> voisin = faces_elem(face, 0) + faces_elem(face, 1) - i_elem;
<a name="l00853"></a>00853               <span class="keywordflow">if</span> (voisin &gt;= 0)
<a name="l00854"></a>00854                 {
<a name="l00855"></a>00855                   <span class="keywordflow">if</span> (indic_pena_global_fat(voisin) != 0)
<a name="l00856"></a>00856                     {
<a name="l00857"></a>00857                       ++<a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a>;
<a name="l00858"></a>00858                     } ;
<a name="l00859"></a>00859                 }
<a name="l00860"></a>00860             }
<a name="l00861"></a>00861           <span class="keywordflow">if</span> (coeff &gt; 1) indic_pena_global_fat(i_elem) = 1;
<a name="l00862"></a>00862         }
<a name="l00863"></a>00863     }
<a name="l00864"></a>00864 
<a name="l00865"></a>00865 <span class="comment">// Si on veut un traitement local a chaque indicatrice (necessaire si on utilise vitesse imposee)</span>
<a name="l00866"></a>00866 <span class="comment">// IntTrav indic_pena_fat(indic_pena_global);</span>
<a name="l00867"></a>00867 <span class="comment">// for (int w = 0; w &lt; ref_penalisation_L2_FTD.size(); w++)</span>
<a name="l00868"></a>00868 <span class="comment">// {</span>
<a name="l00869"></a>00869 <span class="comment">// Transport_Interfaces_base &amp; nom_eq = ref_cast(Transport_Interfaces_base,ref_penalisation_L2_FTD[w].valeur());</span>
<a name="l00870"></a>00870 <span class="comment">// // on calcul le filtre local a l ibc</span>
<a name="l00871"></a>00871 <span class="comment">// const DoubleTab &amp; indicatrice_face = nom_eq.get_compute_indicatrice_faces().valeurs();</span>
<a name="l00872"></a>00872 <span class="comment">// indic_pena_fat = 0;</span>
<a name="l00873"></a>00873 <span class="comment">// for (int i_face = 0; i_face &lt; indicatrice_face.size(); i_face++)</span>
<a name="l00874"></a>00874 <span class="comment">// {</span>
<a name="l00875"></a>00875 <span class="comment">// if (indicatrice_face(i_face) &gt; 0.)</span>
<a name="l00876"></a>00876 <span class="comment">// {</span>
<a name="l00877"></a>00877 <span class="comment">// const int voisin_0 = faces_elem(i_face, 0);</span>
<a name="l00878"></a>00878 <span class="comment">// if (voisin_0 &gt;= 0) indic_pena_fat(voisin_0) = 1;</span>
<a name="l00879"></a>00879 <span class="comment">// const int voisin_1 = faces_elem(i_face, 1);</span>
<a name="l00880"></a>00880 <span class="comment">// if (voisin_1 &gt;= 0) indic_pena_fat(voisin_1) = 1;</span>
<a name="l00881"></a>00881 <span class="comment">// }</span>
<a name="l00882"></a>00882 <span class="comment">// }</span>
<a name="l00883"></a>00883 <span class="comment">// indic_pena_global_fat += indic_pena_fat;</span>
<a name="l00884"></a>00884 <span class="comment">// }</span>
<a name="l00885"></a>00885 
<a name="l00886"></a>00886 <span class="comment">// on convecte le champ de variable avec la vitesse fluide pour les faces ibc</span>
<a name="l00887"></a>00887   <span class="keywordflow">if</span> ( <a class="code" href="classConvection__Diffusion__std.html#a1eccdf9e6aedfbf1914e9fa95962fbf9" title="Renvoie le nombre d&#39;operateurs de l&#39;equation: 2 pour une equation de diffusion.">nombre_d_operateurs</a>() &gt; 1 )
<a name="l00888"></a>00888     {
<a name="l00889"></a>00889       <a class="code" href="classEquation__base.html#a20d04d53bd0c4b48aa923c2b328bb1e3" title="Add convection term In: solution is the unknown I Out: secmem is increased by convection(I)">derivee_en_temps_conv</a>(secmem_conv_vr, inco_conv_vr);
<a name="l00890"></a>00890       secmem_conv_vr *= rhoCp;
<a name="l00891"></a>00891     }
<a name="l00892"></a>00892 
<a name="l00893"></a>00893 <span class="comment">// on ne garde la contribution que pour les cellules dont indicatrice fat est &lt;&gt; 0</span>
<a name="l00894"></a>00894   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_elem = 0; i_elem &lt; nb_elem;  i_elem++)
<a name="l00895"></a>00895     {
<a name="l00896"></a>00896       <span class="keywordflow">if</span> (indic_pena_global_fat(i_elem) == 0) secmem_conv_vr(i_elem) = 0.;
<a name="l00897"></a>00897     }
<a name="l00898"></a>00898 }
<a name="l00899"></a>00899 
<a name="l00900"></a><a class="code" href="classConvection__Diffusion__Temperature.html#a3689afde81dff034b576b7dab3b0da59">00900</a> <span class="keywordtype">void</span> <a class="code" href="classConvection__Diffusion__Temperature.html#a3689afde81dff034b576b7dab3b0da59">Convection_Diffusion_Temperature::mise_en_place_zone_fantome</a>(<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; solution)
<a name="l00901"></a>00901 {
<a name="l00902"></a>00902   <span class="keywordtype">int</span> maj = <a class="code" href="classConvection__Diffusion__Temperature.html#a5893252be9df68bd585d71351ce118e4">verifier_tag_indicatrice_pena_glob</a>();
<a name="l00903"></a>00903   <span class="keywordflow">if</span> (maj == 1) <span class="keywordflow">return</span>;
<a name="l00904"></a>00904 
<a name="l00905"></a>00905 <span class="comment">// garde-fou</span>
<a name="l00906"></a>00906   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().facteur_securite_pas() &gt; 1.0)
<a name="l00907"></a>00907     {
<a name="l00908"></a>00908       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Convection_Diffusion_Temperature::mise_en_place_zone_fantome Facteur securite doit etre &lt;= 1&quot;</span>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00909"></a>00909       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00910"></a>00910     }
<a name="l00911"></a>00911 
<a name="l00912"></a>00912 <span class="comment">// fonction characteristique globale ibc penalisees actuelle</span>
<a name="l00913"></a>00913   <a class="code" href="classIntTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un IntTab avec allocation dans un pool de memoire gere...">IntTrav</a> indicatrice_totale;
<a name="l00914"></a>00914   <a class="code" href="classIntTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un IntTab avec allocation dans un pool de memoire gere...">IntTrav</a> indicatrice_face_totale ;
<a name="l00915"></a>00915   <a class="code" href="classConvection__Diffusion__Temperature.html#a54112f5b487abbdfc59de04c562b1b26">calcul_indic_pena_global</a>(indicatrice_totale,indicatrice_face_totale);
<a name="l00916"></a>00916 <span class="comment">// etat des lieux actuel</span>
<a name="l00917"></a>00917   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_elem  = indicatrice_totale.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00918"></a>00918   <span class="keywordtype">int</span> x=0;
<a name="l00919"></a>00919   <span class="keywordtype">int</span> j=0;
<a name="l00920"></a>00920   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k_elem =0 ; k_elem &lt;nb_elem; ++k_elem)  ((indicatrice_totale(k_elem)!=0) ? ++x : ++j);
<a name="l00921"></a>00921 
<a name="l00922"></a>00922 <span class="comment">// traitement cellules fantomes (if any)</span>
<a name="l00923"></a>00923   <span class="keyword">const</span> <a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>&amp; zone_vf = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>, <a class="code" href="classEquation__base.html#a12d97ae801edc18f614523677921346e" title="Renvoie la zone discretisee associee a l&#39;equation.">zone_dis</a>().<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>());
<a name="l00924"></a>00924   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; elem_faces = zone_vf.<a class="code" href="classZone__VF.html#a067e462dcd3ab92b0f6d945b19e4eb37" title="renvoie le numero de le ieme face de la maille num_elem la facon dont ces faces sont numerotees est l...">elem_faces</a>();
<a name="l00925"></a>00925   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; faces_elem = zone_vf.<a class="code" href="classZone__VF.html#a49d4322f5585a8fa95748ca785b70702" title="renvoie l&#39;element voisin de numface dans la direction i. i=0 : dans le sens oppose de l&#39;axe orthogona...">face_voisins</a>();
<a name="l00926"></a>00926   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_faces_elem = elem_faces.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1);
<a name="l00927"></a>00927   <span class="keywordtype">int</span> k=0; <span class="comment">//nb cellules fantomes ibc -&gt; fluide</span>
<a name="l00928"></a>00928   <span class="keywordtype">int</span> k_cor=0; <span class="comment">//nb cellules fantomes (ibc -&gt; fluide) corrigees</span>
<a name="l00929"></a>00929   <span class="keywordtype">int</span> k_cor2=0; <span class="comment">//nb cellules fantomes (fluide -&gt; ibc) corrigees</span>
<a name="l00930"></a>00930   <span class="keywordtype">int</span> u=0; <span class="comment">//nb cellules fluide -&gt; ibc</span>
<a name="l00931"></a>00931   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_elem = 0; i_elem &lt; nb_elem; i_elem++)
<a name="l00932"></a>00932     {
<a name="l00933"></a>00933 <span class="comment">// cellules fantomes (actuellement fluide et precedement ibc) =&gt; on modifie solution</span>
<a name="l00934"></a>00934       <span class="keywordtype">double</span> somme_inc = 0.;
<a name="l00935"></a>00935       <span class="keywordtype">double</span> <a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a> = 0.;
<a name="l00936"></a>00936       <span class="keywordflow">if</span> (<a class="code" href="classConvection__Diffusion__Temperature.html#a051d95d33a49c1860e4da0c5b62d9862">indic_pena_global</a>(i_elem) != 0 &amp;&amp; indicatrice_totale(i_elem) == 0)
<a name="l00937"></a>00937         {
<a name="l00938"></a>00938           ++k;
<a name="l00939"></a>00939 <span class="comment">// boucle sur les faces pour determiner la valeur de la variable pour les cellules voisines strictement fluide</span>
<a name="l00940"></a>00940           <a class="code" href="classIntTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un IntTab avec allocation dans un pool de memoire gere...">IntTrav</a> stok_vois(nb_faces_elem);
<a name="l00941"></a>00941           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_face = 0; i_face &lt; nb_faces_elem; i_face++)
<a name="l00942"></a>00942             {
<a name="l00943"></a>00943               <span class="keyword">const</span> <span class="keywordtype">int</span> face = elem_faces(i_elem, i_face);
<a name="l00944"></a>00944               <span class="keyword">const</span> <span class="keywordtype">int</span> voisin = faces_elem(face, 0) + faces_elem(face, 1) - i_elem;
<a name="l00945"></a>00945               <span class="keywordflow">if</span> (voisin &gt;= 0) <span class="comment">//!&lt; le voisin existe</span>
<a name="l00946"></a>00946 <span class="comment"></span>                {
<a name="l00947"></a>00947                   <span class="keywordflow">if</span> ((<a class="code" href="classConvection__Diffusion__Temperature.html#a051d95d33a49c1860e4da0c5b62d9862">indic_pena_global</a>(voisin) == indicatrice_totale(voisin)) &amp;&amp;  (<a class="code" href="classConvection__Diffusion__Temperature.html#a051d95d33a49c1860e4da0c5b62d9862">indic_pena_global</a>(voisin) == indicatrice_totale(i_elem))) <span class="comment">//!&lt; strictement fluide aux deux pas de temps</span>
<a name="l00948"></a>00948 <span class="comment"></span>                    {
<a name="l00949"></a>00949                       somme_inc += solution(voisin);
<a name="l00950"></a>00950                       ++<a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a>;
<a name="l00951"></a>00951                     }
<a name="l00952"></a>00952                   <span class="keywordflow">else</span>     <span class="comment">//!&lt; On sauve le numero du voisin</span>
<a name="l00953"></a>00953 <span class="comment"></span>                    {
<a name="l00954"></a>00954                       stok_vois(i_face) = voisin;
<a name="l00955"></a>00955                     }
<a name="l00956"></a>00956                 }
<a name="l00957"></a>00957             }
<a name="l00958"></a>00958 <span class="comment">// Si on n a pas trouve de cellules fluide, on regarde les voisins des voisins</span>
<a name="l00959"></a>00959           <span class="keywordflow">if</span> (coeff == 0.)
<a name="l00960"></a>00960             {
<a name="l00961"></a>00961               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_vois = 0; i_vois &lt; nb_faces_elem; i_vois++)
<a name="l00962"></a>00962                 {
<a name="l00963"></a>00963                   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii_face = 0; ii_face &lt; nb_faces_elem; ii_face++)
<a name="l00964"></a>00964                     {
<a name="l00965"></a>00965                       <span class="keyword">const</span> <span class="keywordtype">int</span> face_v = elem_faces(stok_vois(i_vois), ii_face);
<a name="l00966"></a>00966                       <span class="keyword">const</span> <span class="keywordtype">int</span> voisin_v = faces_elem(face_v, 0) + faces_elem(face_v, 1) - stok_vois(i_vois);
<a name="l00967"></a>00967                       <span class="keywordflow">if</span> ((voisin_v &gt;= 0) &amp;&amp; (voisin_v != i_elem) )<span class="comment">//!&lt; le voisin existe et pas i_elem</span>
<a name="l00968"></a>00968 <span class="comment"></span>                        {
<a name="l00969"></a>00969                           <span class="keywordflow">if</span> ((<a class="code" href="classConvection__Diffusion__Temperature.html#a051d95d33a49c1860e4da0c5b62d9862">indic_pena_global</a>(voisin_v) == indicatrice_totale(voisin_v)) &amp;&amp;  (<a class="code" href="classConvection__Diffusion__Temperature.html#a051d95d33a49c1860e4da0c5b62d9862">indic_pena_global</a>(voisin_v) == indicatrice_totale(i_elem))) <span class="comment">//!&lt; strictement fluide aux deux pas de temps</span>
<a name="l00970"></a>00970 <span class="comment"></span>                            {
<a name="l00971"></a>00971                               somme_inc += solution(voisin_v);
<a name="l00972"></a>00972                               ++<a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a>;
<a name="l00973"></a>00973                             }
<a name="l00974"></a>00974                         }
<a name="l00975"></a>00975                     }
<a name="l00976"></a>00976                 }
<a name="l00977"></a>00977             }
<a name="l00978"></a>00978 <span class="comment">// definition d une nouvelle valleur de la variable pour la cellule fantome</span>
<a name="l00979"></a>00979           <span class="keywordflow">if</span> (coeff &gt; 0.)
<a name="l00980"></a>00980             {
<a name="l00981"></a>00981               solution(i_elem) = somme_inc / <a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a>;
<a name="l00982"></a>00982               k_cor += 1;
<a name="l00983"></a>00983             }
<a name="l00984"></a>00984         }
<a name="l00985"></a>00985 <span class="comment">// cellules actuellement ibc et precedement fluide</span>
<a name="l00986"></a>00986       <span class="keywordflow">if</span> (<a class="code" href="classConvection__Diffusion__Temperature.html#a051d95d33a49c1860e4da0c5b62d9862">indic_pena_global</a>(i_elem) == 0 &amp;&amp; indicatrice_totale(i_elem) != 0)
<a name="l00987"></a>00987         {
<a name="l00988"></a>00988           ++u;
<a name="l00989"></a>00989 <span class="comment">// boucle sur les faces pour determiner la valeur de la variable pour les cellules voisines strictement ibc</span>
<a name="l00990"></a>00990           <a class="code" href="classIntTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un IntTab avec allocation dans un pool de memoire gere...">IntTrav</a> stok_vois(nb_faces_elem);
<a name="l00991"></a>00991           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_face = 0; i_face &lt; nb_faces_elem; i_face++)
<a name="l00992"></a>00992             {
<a name="l00993"></a>00993               <span class="keyword">const</span> <span class="keywordtype">int</span> face = elem_faces(i_elem, i_face);
<a name="l00994"></a>00994               <span class="keyword">const</span> <span class="keywordtype">int</span> voisin = faces_elem(face, 0) + faces_elem(face, 1) - i_elem;
<a name="l00995"></a>00995               <span class="keywordflow">if</span> (voisin &gt;= 0) <span class="comment">//!&lt; le voisin existe</span>
<a name="l00996"></a>00996 <span class="comment"></span>                {
<a name="l00997"></a>00997 <span class="comment">// strictement ibc aux deux pas de temps (la meme) car solution a ete modifiee ci-dessus</span>
<a name="l00998"></a>00998                   <span class="keywordflow">if</span> ((<a class="code" href="classConvection__Diffusion__Temperature.html#a051d95d33a49c1860e4da0c5b62d9862">indic_pena_global</a>(voisin) == indicatrice_totale(voisin)) &amp;&amp; (<a class="code" href="classConvection__Diffusion__Temperature.html#a051d95d33a49c1860e4da0c5b62d9862">indic_pena_global</a>(voisin) == indicatrice_totale(i_elem)))
<a name="l00999"></a>00999                     {
<a name="l01000"></a>01000                       somme_inc += solution(voisin);
<a name="l01001"></a>01001                       ++<a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a>;
<a name="l01002"></a>01002                     }
<a name="l01003"></a>01003                   <span class="keywordflow">else</span>     <span class="comment">//!&lt; On sauve le numero du voisin</span>
<a name="l01004"></a>01004 <span class="comment"></span>                    {
<a name="l01005"></a>01005                       stok_vois(i_face) = voisin;
<a name="l01006"></a>01006                     }
<a name="l01007"></a>01007                 }
<a name="l01008"></a>01008             }
<a name="l01009"></a>01009 <span class="comment">// Si on n a pas trouve de cellules ibc, on regarde les voisins des voisins</span>
<a name="l01010"></a>01010           <span class="keywordflow">if</span> (coeff == 0.)
<a name="l01011"></a>01011             {
<a name="l01012"></a>01012               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_vois = 0; i_vois &lt; nb_faces_elem; i_vois++)
<a name="l01013"></a>01013                 {
<a name="l01014"></a>01014                   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii_face = 0; ii_face &lt; nb_faces_elem; ii_face++)
<a name="l01015"></a>01015                     {
<a name="l01016"></a>01016                       <span class="keyword">const</span> <span class="keywordtype">int</span> face_v = elem_faces(stok_vois(i_vois), ii_face);
<a name="l01017"></a>01017                       <span class="keyword">const</span> <span class="keywordtype">int</span> voisin_v = faces_elem(face_v, 0) + faces_elem(face_v, 1) - stok_vois(i_vois);
<a name="l01018"></a>01018                       <span class="keywordflow">if</span> ((voisin_v &gt;= 0) &amp;&amp; (voisin_v != i_elem) )<span class="comment">//!&lt; le voisin existe et pas i_elem</span>
<a name="l01019"></a>01019 <span class="comment"></span>                        {
<a name="l01020"></a>01020                           <span class="keywordflow">if</span> ((<a class="code" href="classConvection__Diffusion__Temperature.html#a051d95d33a49c1860e4da0c5b62d9862">indic_pena_global</a>(voisin_v) == indicatrice_totale(voisin_v)) &amp;&amp; (<a class="code" href="classConvection__Diffusion__Temperature.html#a051d95d33a49c1860e4da0c5b62d9862">indic_pena_global</a>(voisin_v) == indicatrice_totale(i_elem))) <span class="comment">//!&lt; strictement ibc aux deux pas de temps (la meme) car solution a ete modifiee ci-dessus</span>
<a name="l01021"></a>01021 <span class="comment"></span>                            {
<a name="l01022"></a>01022                               somme_inc += solution(voisin_v);
<a name="l01023"></a>01023                               ++<a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a>;
<a name="l01024"></a>01024                             }
<a name="l01025"></a>01025                         }
<a name="l01026"></a>01026                     }
<a name="l01027"></a>01027                 }
<a name="l01028"></a>01028             }
<a name="l01029"></a>01029 <span class="comment">// definition d une nouvelle valleur de la variable pour la cellule fantome</span>
<a name="l01030"></a>01030           <span class="keywordflow">if</span> (coeff &gt; 0.)
<a name="l01031"></a>01031             {
<a name="l01032"></a>01032               solution(i_elem) = somme_inc / <a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a>;
<a name="l01033"></a>01033               k_cor2 += 1;
<a name="l01034"></a>01034             }
<a name="l01035"></a>01035           <span class="keywordflow">else</span>
<a name="l01036"></a>01036             {
<a name="l01037"></a>01037               solution(i_elem) = <a class="code" href="classConvection__Diffusion__Temperature.html#a9595595fb4b98825455db3dd680d3f64">tab_penalisation_L2_FTD</a>[indicatrice_totale(i_elem)-1](0);
<a name="l01038"></a>01038               k_cor2 += 1;
<a name="l01039"></a>01039             }
<a name="l01040"></a>01040         }
<a name="l01041"></a>01041     }
<a name="l01042"></a>01042   solution.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l01043"></a>01043 <span class="comment">// Debog::verifier(&quot;Convection_Diffusion_Temperature::mise_en_place_zone_fantome solution &quot;,solution);</span>
<a name="l01044"></a>01044   <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt;<span class="stringliteral">&quot;Mise_en_place_zone_fantome : fluide -&gt; ibc : &quot;</span>&lt;&lt;u&lt;&lt; <span class="stringliteral">&quot; elem. (dont &quot;</span>&lt;&lt;k_cor2&lt;&lt;<span class="stringliteral">&quot; corrigees) et ibc -&gt; fluide : &quot;</span>;
<a name="l01045"></a>01045   <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a>&lt;&lt;k&lt;&lt;<span class="stringliteral">&quot; elem.(dont &quot;</span>&lt;&lt;k_cor&lt;&lt;<span class="stringliteral">&quot; corrigees)&quot;</span>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01046"></a>01046   <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt;<span class="stringliteral">&quot;             nb elem. ibc : &quot;</span>&lt;&lt;x&lt;&lt;<span class="stringliteral">&quot; et nb elem fluide : &quot;</span>&lt;&lt;j&lt;&lt;<span class="stringliteral">&quot; sur un total de : &quot;</span>&lt;&lt;nb_elem&lt;&lt;finl;
<a name="l01047"></a>01047   <span class="keywordflow">if</span> ((u != k_cor2) || (k !=k_cor))
<a name="l01048"></a>01048     {
<a name="l01049"></a>01049       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt;<span class="stringliteral">&quot;Mise_en_place_zone_fantome : Les cellules fantomes ne sont pas toutes corrigees&quot;</span>&lt;&lt;finl;
<a name="l01050"></a>01050       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l01051"></a>01051     }
<a name="l01052"></a>01052 
<a name="l01053"></a>01053   <a class="code" href="classConvection__Diffusion__Temperature.html#a051d95d33a49c1860e4da0c5b62d9862">indic_pena_global</a> = indicatrice_totale;
<a name="l01054"></a>01054   <a class="code" href="classConvection__Diffusion__Temperature.html#ac11d5686f6bcdd802887cd66c01a54c7">indic_face_pena_global</a> = indicatrice_face_totale;
<a name="l01055"></a>01055   maj = <a class="code" href="classConvection__Diffusion__Temperature.html#aecf0e32fb40f34138650f1ced3b2aa71">mise_a_jour_tag_indicatrice_pena_glob</a>();
<a name="l01056"></a>01056   assert(maj == 1);
<a name="l01057"></a>01057 }
<a name="l01058"></a>01058 
<a name="l01059"></a><a class="code" href="classConvection__Diffusion__Temperature.html#a9158886a17c4c95aaad8071763bc7ff1">01059</a> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; <a class="code" href="classConvection__Diffusion__Temperature.html#a9158886a17c4c95aaad8071763bc7ff1">Convection_Diffusion_Temperature::filtrage_si_appart_ibc</a>(<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; u_conv, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; u)
<a name="l01060"></a>01060 {
<a name="l01061"></a>01061 <span class="comment">// caclul de la fonction caracteristique globale des ibc pour le calcul de T_voisinage</span>
<a name="l01062"></a>01062   <a class="code" href="classConvection__Diffusion__Temperature.html#a2166b2c55902ad79bd60c797f31d1355">set_indic_pena_globale</a>();
<a name="l01063"></a>01063 
<a name="l01064"></a>01064   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0 ; j&lt; <a class="code" href="classConvection__Diffusion__Temperature.html#a051d95d33a49c1860e4da0c5b62d9862">indic_pena_global</a>.<a class="code" href="classIntVect.html#ad90cfd411cbbd631ccf1935bb36f7c40" title="Identique a size_reelle()">size</a>() ; ++j)
<a name="l01065"></a>01065     {
<a name="l01066"></a>01066       <span class="keywordflow">if</span> ( <a class="code" href="classConvection__Diffusion__Temperature.html#a051d95d33a49c1860e4da0c5b62d9862">indic_pena_global</a>(j) != 0) u(j) = u_conv(j);
<a name="l01067"></a>01067     }
<a name="l01068"></a>01068   u.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l01069"></a>01069 <span class="comment">// Debog::verifier(&quot;Convection_Diffusion_Temperature::filtrage_si_appart_ibc u &quot;,u);</span>
<a name="l01070"></a>01070   <span class="keywordflow">return</span> u;
<a name="l01071"></a>01071 }
<a name="l01072"></a>01072 
<a name="l01073"></a><a class="code" href="classConvection__Diffusion__Temperature.html#a54112f5b487abbdfc59de04c562b1b26">01073</a> <span class="keywordtype">void</span> <a class="code" href="classConvection__Diffusion__Temperature.html#a54112f5b487abbdfc59de04c562b1b26">Convection_Diffusion_Temperature::calcul_indic_pena_global</a>(<a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; indicatrice_totale, <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; indicatrice_face_totale)
<a name="l01074"></a>01074 {
<a name="l01075"></a>01075 <span class="comment">// fonction characteristique globale ibc penalisees</span>
<a name="l01076"></a>01076   indicatrice_totale.<a class="code" href="classIntTab.html#a3d200d04b7bf53a32c27867c42065a0e">copy</a>(<a class="code" href="classConvection__Diffusion__Temperature.html#a051d95d33a49c1860e4da0c5b62d9862">indic_pena_global</a>);
<a name="l01077"></a>01077   indicatrice_face_totale.<a class="code" href="classIntTab.html#a3d200d04b7bf53a32c27867c42065a0e">copy</a>(<a class="code" href="classConvection__Diffusion__Temperature.html#ac11d5686f6bcdd802887cd66c01a54c7">indic_face_pena_global</a>);
<a name="l01078"></a>01078   indicatrice_totale = 0;
<a name="l01079"></a>01079   indicatrice_face_totale = 0;
<a name="l01080"></a>01080   <span class="keywordtype">int</span> x=0;
<a name="l01081"></a>01081   <span class="keywordtype">int</span> xf=0;
<a name="l01082"></a>01082   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_elem  = indicatrice_totale.<a class="code" href="classIntTab.html#a71e9b9ddc1793094b1b3f109377952b1" title="Returns the total dimensions of the multi-dimensionnal array, including virtual items (used in parall...">dimension_tot</a>(0);
<a name="l01083"></a>01083   <span class="keyword">const</span> <span class="keywordtype">int</span> nfaces = indicatrice_face_totale.<a class="code" href="classIntTab.html#a71e9b9ddc1793094b1b3f109377952b1" title="Returns the total dimensions of the multi-dimensionnal array, including virtual items (used in parall...">dimension_tot</a>(0);
<a name="l01084"></a>01084 <span class="comment">// boucle sur les ibc</span>
<a name="l01085"></a>01085   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> w = 0 ; w&lt;<a class="code" href="classConvection__Diffusion__Temperature.html#a025ff54c166b1a5ec73680548e82b913">ref_penalisation_L2_FTD</a>.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>() ; ++w)
<a name="l01086"></a>01086     {
<a name="l01087"></a>01087       <a class="code" href="classTransport__Interfaces__base.html" title="classe Transport_Interfaces_base Cette classe constitue la classe de base des equations de transport ...">Transport_Interfaces_base</a>&amp; nom_eq = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classTransport__Interfaces__base.html" title="classe Transport_Interfaces_base Cette classe constitue la classe de base des equations de transport ...">Transport_Interfaces_base</a>,<a class="code" href="classConvection__Diffusion__Temperature.html#a025ff54c166b1a5ec73680548e82b913">ref_penalisation_L2_FTD</a>[w].<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>());
<a name="l01088"></a>01088       <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; indicatrice = nom_eq.<a class="code" href="classTransport__Interfaces__base.html#a78dd18b060f3370efbfb4fbb230ce626">get_update_indicatrice</a>().<a class="code" href="classChamp__Proto.html#a9d8c69f11d1b0a8e378cc6ca41793614">valeurs</a>();
<a name="l01089"></a>01089 <span class="comment">// fonction characteristique (0 ou 1) pour l&#39;ensemble des ibc</span>
<a name="l01090"></a>01090       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k_elem =0 ; k_elem &lt;nb_elem; ++k_elem)
<a name="l01091"></a>01091         {
<a name="l01092"></a>01092           <span class="keywordflow">if</span> (indicatrice(k_elem)&gt;0.)
<a name="l01093"></a>01093             {
<a name="l01094"></a>01094               <span class="keywordflow">if</span>(indicatrice_totale(k_elem) != 0)
<a name="l01095"></a>01095                 {
<a name="l01096"></a>01096                   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;calcul_indic_pena_global : Attention: les elements des indicatrices se chevauchent &quot;</span>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01097"></a>01097                   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l01098"></a>01098                 }
<a name="l01099"></a>01099               indicatrice_totale(k_elem) = w+1;
<a name="l01100"></a>01100               ++x;
<a name="l01101"></a>01101             }
<a name="l01102"></a>01102         }
<a name="l01103"></a>01103 <span class="comment">// fonction characteristique (numero ibc) pour l&#39;ensemble des ibc</span>
<a name="l01104"></a>01104       <span class="keyword">const</span> <a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>&amp; zone_vf = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>, <a class="code" href="classEquation__base.html#a12d97ae801edc18f614523677921346e" title="Renvoie la zone discretisee associee a l&#39;equation.">zone_dis</a>().<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>());
<a name="l01105"></a>01105       <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; face_voisins = zone_vf.<a class="code" href="classZone__VF.html#a49d4322f5585a8fa95748ca785b70702" title="renvoie l&#39;element voisin de numface dans la direction i. i=0 : dans le sens oppose de l&#39;axe orthogona...">face_voisins</a>();
<a name="l01106"></a>01106       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nfaces ; i++)
<a name="l01107"></a>01107         {
<a name="l01108"></a>01108           <span class="keyword">const</span> <span class="keywordtype">int</span> elem0 = face_voisins(i, 0);
<a name="l01109"></a>01109           <span class="keyword">const</span> <span class="keywordtype">int</span> elem1 = face_voisins(i, 1);
<a name="l01110"></a>01110           <span class="keywordtype">double</span> indi = 0.;
<a name="l01111"></a>01111           <span class="keywordflow">if</span> (elem0 &gt;= 0) indi = indicatrice(elem0);
<a name="l01112"></a>01112           <span class="keywordflow">if</span> (elem1 &gt;= 0) indi += indicatrice(elem1);
<a name="l01113"></a>01113           <span class="keywordflow">if</span>(indi &gt; 0.)
<a name="l01114"></a>01114             {
<a name="l01115"></a>01115               <span class="keywordflow">if</span>(indicatrice_face_totale(i) !=  0)
<a name="l01116"></a>01116                 {
<a name="l01117"></a>01117                   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;calcul_indic_pena_global : Attention: les faces des indicatrices se chevauchent &quot;</span>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01118"></a>01118                   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l01119"></a>01119                 }
<a name="l01120"></a>01120               indicatrice_face_totale(i) = w+1;
<a name="l01121"></a>01121               ++xf;
<a name="l01122"></a>01122             }
<a name="l01123"></a>01123         }
<a name="l01124"></a>01124     }
<a name="l01125"></a>01125   <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a>&lt;&lt;<span class="stringliteral">&quot;Calcul_indic_pena_global : Nb d elements de l indicatrice globale des IBCs: &quot;</span>&lt;&lt;x;
<a name="l01126"></a>01126   <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a>&lt;&lt;<span class="stringliteral">&quot;  et nb de faces : &quot;</span>&lt;&lt;xf&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01127"></a>01127   indicatrice_totale.<a class="code" href="classIntVect.html#ad12bea67621d1a0ee82b27c9a37ca4ef">echange_espace_virtuel</a>();
<a name="l01128"></a>01128   indicatrice_face_totale.<a class="code" href="classIntVect.html#ad12bea67621d1a0ee82b27c9a37ca4ef">echange_espace_virtuel</a>();
<a name="l01129"></a>01129 <span class="comment">// Debog::verifier(&quot;Convection_Diffusion_Temperature::calcul_indic_pena_global indicatrice_totale &quot;,indicatrice_totale);</span>
<a name="l01130"></a>01130 <span class="comment">// Debog::verifier(&quot;Convection_Diffusion_Temperature::calcul_indic_pena_global indicatrice_face_totale &quot;,indicatrice_face_totale);</span>
<a name="l01131"></a>01131 }
<a name="l01132"></a>01132 
<a name="l01133"></a><a class="code" href="classConvection__Diffusion__Temperature.html#a22c0a145a3458c317b07d675b17517a4">01133</a> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; <a class="code" href="classConvection__Diffusion__Temperature.html#a22c0a145a3458c317b07d675b17517a4">Convection_Diffusion_Temperature::penalisation_L2</a>(<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; u)
<a name="l01134"></a>01134 {
<a name="l01135"></a>01135 <span class="comment">// garde-fou</span>
<a name="l01136"></a>01136   assert(<a class="code" href="classConvection__Diffusion__Temperature.html#a025ff54c166b1a5ec73680548e82b913">ref_penalisation_L2_FTD</a>.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>() != 0);
<a name="l01137"></a>01137   assert(<a class="code" href="classConvection__Diffusion__Temperature.html#a025ff54c166b1a5ec73680548e82b913">ref_penalisation_L2_FTD</a>.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>() == <a class="code" href="classConvection__Diffusion__Temperature.html#a9595595fb4b98825455db3dd680d3f64">tab_penalisation_L2_FTD</a>.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>());
<a name="l01138"></a>01138 
<a name="l01139"></a>01139   <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; dt = <a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a0e4f67ef6086c09434ddc161668077b2" title="Renvoie le pas de temps (delta_t) courant.">pas_de_temps</a>();
<a name="l01140"></a>01140   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> u_old(u);
<a name="l01141"></a>01141 
<a name="l01142"></a>01142 <span class="comment">// caclul de la fonction caracteristique globale des ibc pour le calcul de T_voisinage</span>
<a name="l01143"></a>01143   <a class="code" href="classConvection__Diffusion__Temperature.html#a2166b2c55902ad79bd60c797f31d1355">set_indic_pena_globale</a>();
<a name="l01144"></a>01144 
<a name="l01145"></a>01145 <span class="comment">// calcul de T_voisinage pour tous les elemnts</span>
<a name="l01146"></a>01146   <span class="keyword">const</span> <a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>&amp; zone_vf = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>, <a class="code" href="classEquation__base.html#a12d97ae801edc18f614523677921346e" title="Renvoie la zone discretisee associee a l&#39;equation.">zone_dis</a>().<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>());
<a name="l01147"></a>01147   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; elem_faces = zone_vf.<a class="code" href="classZone__VF.html#a067e462dcd3ab92b0f6d945b19e4eb37" title="renvoie le numero de le ieme face de la maille num_elem la facon dont ces faces sont numerotees est l...">elem_faces</a>();
<a name="l01148"></a>01148   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; faces_elem = zone_vf.<a class="code" href="classZone__VF.html#a49d4322f5585a8fa95748ca785b70702" title="renvoie l&#39;element voisin de numface dans la direction i. i=0 : dans le sens oppose de l&#39;axe orthogona...">face_voisins</a>();
<a name="l01149"></a>01149   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_faces_elem = elem_faces.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1);
<a name="l01150"></a>01150   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; inc=<a class="code" href="classConvection__Diffusion__Temperature.html#aab6a891f15e7996eda73b1b6e67e7dbd" title="Renvoie le champ inconnue representant la temperatue. (version const)">inconnue</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>();
<a name="l01151"></a>01151 <span class="comment">// inconnue doit etre scalaire</span>
<a name="l01152"></a>01152   assert(inc.<a class="code" href="classDoubleVect.html#ab02d01cd1bdab66fbd66f9a47cc29e10">line_size</a>() == 1);
<a name="l01153"></a>01153   <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> t_voisinage(inc);
<a name="l01154"></a>01154   <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> u_voisinage(u);
<a name="l01155"></a>01155   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_elem  = u.<a class="code" href="classDoubleTab.html#a3eadd63f3ba20c1b454d760b430acbf7" title="Returns the total dimensions of the multi-dimensionnal array, including virtual items (used in parall...">dimension_tot</a>(0);
<a name="l01156"></a>01156   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_elem = 0; i_elem &lt; nb_elem; i_elem++)
<a name="l01157"></a>01157     {
<a name="l01158"></a>01158       <span class="keywordtype">double</span> somme = 0.;
<a name="l01159"></a>01159       <span class="keywordtype">double</span> somme_deriv = 0.;
<a name="l01160"></a>01160       <span class="keywordtype">double</span> <a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a> = 0.;
<a name="l01161"></a>01161 
<a name="l01162"></a>01162       <span class="keywordflow">if</span>( <a class="code" href="classConvection__Diffusion__Temperature.html#a051d95d33a49c1860e4da0c5b62d9862">indic_pena_global</a>(i_elem) != 0)
<a name="l01163"></a>01163         {
<a name="l01164"></a>01164 <span class="comment">// boucle sur les faces de l element</span>
<a name="l01165"></a>01165           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_face = 0; i_face &lt; nb_faces_elem; i_face++)
<a name="l01166"></a>01166             {
<a name="l01167"></a>01167               <span class="keyword">const</span> <span class="keywordtype">int</span> face = elem_faces(i_elem, i_face);
<a name="l01168"></a>01168               <span class="keyword">const</span> <span class="keywordtype">int</span> voisin = faces_elem(face, 0) + faces_elem(face, 1) - i_elem;
<a name="l01169"></a>01169               <span class="keywordflow">if</span> (voisin &gt;= 0)
<a name="l01170"></a>01170                 {
<a name="l01171"></a>01171                   <span class="keywordflow">if</span> (<a class="code" href="classConvection__Diffusion__Temperature.html#a051d95d33a49c1860e4da0c5b62d9862">indic_pena_global</a>(voisin) == 0)
<a name="l01172"></a>01172                     {
<a name="l01173"></a>01173                       somme += inc(voisin);
<a name="l01174"></a>01174                       somme_deriv += u(voisin);
<a name="l01175"></a>01175                       coeff += 1.;
<a name="l01176"></a>01176                     }
<a name="l01177"></a>01177                 }
<a name="l01178"></a>01178             }
<a name="l01179"></a>01179         }
<a name="l01180"></a>01180 
<a name="l01181"></a>01181       <span class="keywordflow">if</span> (coeff &gt; 0.)
<a name="l01182"></a>01182         {
<a name="l01183"></a>01183           t_voisinage(i_elem) = somme / <a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a>;
<a name="l01184"></a>01184           u_voisinage(i_elem) = somme_deriv / <a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a>;
<a name="l01185"></a>01185         }
<a name="l01186"></a>01186       <span class="keywordflow">else</span>
<a name="l01187"></a>01187         {
<a name="l01188"></a>01188 <span class="comment">// cas pas de voisin dans le fluide</span>
<a name="l01189"></a>01189           t_voisinage(i_elem) = inc(i_elem);
<a name="l01190"></a>01190           u_voisinage(i_elem) = u(i_elem);
<a name="l01191"></a>01191         }
<a name="l01192"></a>01192     }
<a name="l01193"></a>01193   t_voisinage.echange_espace_virtuel();
<a name="l01194"></a>01194   u_voisinage.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l01195"></a>01195 
<a name="l01196"></a>01196 <span class="comment">// determination du champ global de penalisation L2</span>
<a name="l01197"></a>01197   <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> pena_glob(inc); <span class="comment">//initialise a zero</span>
<a name="l01198"></a>01198   <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> tab_(inc); <span class="comment">//initialise a zero</span>
<a name="l01199"></a>01199   <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> denom(inc); <span class="comment">//initialise a zero</span>
<a name="l01200"></a>01200 
<a name="l01201"></a>01201 <span class="comment">// boucle ibc</span>
<a name="l01202"></a>01202   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0 ; i &lt; <a class="code" href="classConvection__Diffusion__Temperature.html#a025ff54c166b1a5ec73680548e82b913">ref_penalisation_L2_FTD</a>.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>() ; ++i)
<a name="l01203"></a>01203     {
<a name="l01204"></a>01204       <a class="code" href="classTransport__Interfaces__base.html" title="classe Transport_Interfaces_base Cette classe constitue la classe de base des equations de transport ...">Transport_Interfaces_base</a>&amp; nom_eq = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classTransport__Interfaces__base.html" title="classe Transport_Interfaces_base Cette classe constitue la classe de base des equations de transport ...">Transport_Interfaces_base</a>,<a class="code" href="classConvection__Diffusion__Temperature.html#a025ff54c166b1a5ec73680548e82b913">ref_penalisation_L2_FTD</a>[i].<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>());
<a name="l01205"></a>01205       <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; tab = <a class="code" href="classConvection__Diffusion__Temperature.html#a9595595fb4b98825455db3dd680d3f64">tab_penalisation_L2_FTD</a>[i];
<a name="l01206"></a>01206 <span class="comment">// verification dimensions tab t obstacle = nb dim de l inconnu</span>
<a name="l01207"></a>01207       <span class="keywordflow">if</span> ( tab.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0) != inc.<a class="code" href="classDoubleVect.html#ab02d01cd1bdab66fbd66f9a47cc29e10">line_size</a>() )
<a name="l01208"></a>01208         {
<a name="l01209"></a>01209           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; penalisation_L2: Les champs de temperature impose et calcule n&#39;ont pas les memes dimensions&quot;</span> &lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01210"></a>01210           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Dimension du champ de temperature impose &quot;</span>&lt;&lt; tab.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0) &lt;&lt; finl;
<a name="l01211"></a>01211           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Dimension du champ de temperature calcule par TRUST &quot;</span>&lt;&lt;inc.<a class="code" href="classDoubleVect.html#ab02d01cd1bdab66fbd66f9a47cc29e10">line_size</a>() &lt;&lt;finl;
<a name="l01212"></a>01212           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Nombre d&#39;elements stockes au dans l&#39;iconnue &quot;</span> &lt;&lt;inc.<a class="code" href="classDoubleVect.html#a392c1f20b462563365389d28e0853867" title="Identique a size_reelle()">size</a>() &lt;&lt;finl;
<a name="l01213"></a>01213           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l01214"></a>01214         }
<a name="l01215"></a>01215       <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; indicatrice = nom_eq.<a class="code" href="classTransport__Interfaces__base.html#a78dd18b060f3370efbfb4fbb230ce626">get_update_indicatrice</a>().<a class="code" href="classChamp__Proto.html#a9d8c69f11d1b0a8e378cc6ca41793614">valeurs</a>();
<a name="l01216"></a>01216 
<a name="l01217"></a>01217       <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> pena_loc(indicatrice);
<a name="l01218"></a>01218 <span class="comment">// Determination du terme de penalisation pour l ibc courante</span>
<a name="l01219"></a>01219 <span class="comment">// boucle sur les elements</span>
<a name="l01220"></a>01220       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j&lt;nb_elem ; ++j)
<a name="l01221"></a>01221         {
<a name="l01222"></a>01222 <span class="comment">// calcul de la fonction characteristique Ksi de l ibc courante -&gt; pena_loc</span>
<a name="l01223"></a>01223           <span class="keywordflow">if</span> (indicatrice(j) &gt; 0.)
<a name="l01224"></a>01224             {
<a name="l01225"></a>01225               <span class="keywordtype">double</span> coeff_p=1.;
<a name="l01226"></a>01226               pena_loc(j) = coeff_p;
<a name="l01227"></a>01227 <span class="comment">// calcul du denominateur du terme de penalisation ( Sigma_ibc Ksi_ibc(j) )</span>
<a name="l01228"></a>01228               denom(j) += coeff_p;
<a name="l01229"></a>01229 
<a name="l01230"></a>01230 <span class="comment">// determination valeur a imposer T_ref</span>
<a name="l01231"></a>01231               <span class="keywordtype">double</span> tref_j = 0.;
<a name="l01232"></a>01232               <span class="keywordflow">switch</span> (<a class="code" href="classConvection__Diffusion__Temperature.html#a7038fcce2e880fcf5580f291a4a35ebe">choix_pena</a>)
<a name="l01233"></a>01233                 {
<a name="l01234"></a>01234                 <span class="keywordflow">case</span> 0 :
<a name="l01235"></a>01235 <span class="comment">// approximation de T_ref par T_ref = T_imp</span>
<a name="l01236"></a>01236                   tref_j = tab(0);
<a name="l01237"></a>01237                   <span class="keywordflow">break</span>;
<a name="l01238"></a>01238                 <span class="keywordflow">case</span> 1 :
<a name="l01239"></a>01239 <span class="comment">// approximation de T_ref par T_ref = T+dt*derivee</span>
<a name="l01240"></a>01240                   tref_j = inc(j) + dt*u_old(j);
<a name="l01241"></a>01241                   <span class="keywordflow">break</span>;
<a name="l01242"></a>01242                 <span class="keywordflow">case</span> 2 :
<a name="l01243"></a>01243 <span class="comment">// approximation de T_imp par T_ref= tau*T_imp + (1-tau)*T_voisin</span>
<a name="l01244"></a>01244 <span class="comment">// approximation de T_voisin par T_voisin= 1/n * somme(1,n)(T_environnant+dt*derivee_environnant)</span>
<a name="l01245"></a>01245                   tref_j = (indicatrice(j)*tab(0)+(1.-indicatrice(j))*(t_voisinage(j)+dt*u_voisinage(j)));
<a name="l01246"></a>01246                   <span class="keywordflow">break</span>;
<a name="l01247"></a>01247                 <span class="keywordflow">case</span> 3 :
<a name="l01248"></a>01248 <span class="comment">// approximation de T_imp par T_ref= [(1-tau)*T_voisin + (1/2)*T_imp] / (3/2 -tau)</span>
<a name="l01249"></a>01249 <span class="comment">// approximation de T_voisin par T_voisin= 1/n * somme(1,n)(T_environnant+dt*derivee_environnant)</span>
<a name="l01250"></a>01250                   tref_j = ((1.-indicatrice(j))*(t_voisinage(j)+dt*u_voisinage(j))+0.5*tab(0))/(1.5-indicatrice(j));
<a name="l01251"></a>01251                   <span class="keywordflow">break</span>;
<a name="l01252"></a>01252                 <span class="keywordflow">case</span> 4 :
<a name="l01253"></a>01253 <span class="comment">// approximation de T_imp par T_ref= T_imp si tau=1 sinon T_ref=T_voisin</span>
<a name="l01254"></a>01254                   <span class="keywordflow">if</span> (indicatrice(j) == 1.)
<a name="l01255"></a>01255                     {
<a name="l01256"></a>01256                       tref_j = tab(0);
<a name="l01257"></a>01257                     }
<a name="l01258"></a>01258                   <span class="keywordflow">else</span>
<a name="l01259"></a>01259                     {
<a name="l01260"></a>01260                       tref_j = (t_voisinage(j)+dt*u_voisinage(j));
<a name="l01261"></a>01261                     }
<a name="l01262"></a>01262                   <span class="keywordflow">break</span>;
<a name="l01263"></a>01263                 <span class="keywordflow">default</span>:
<a name="l01264"></a>01264                   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Penalisation_L2: choix_pena invalide &quot;</span>&lt;&lt; <a class="code" href="classConvection__Diffusion__Temperature.html#a7038fcce2e880fcf5580f291a4a35ebe">choix_pena</a> &lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01265"></a>01265                   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l01266"></a>01266                   <span class="keywordflow">break</span>;
<a name="l01267"></a>01267                 }
<a name="l01268"></a>01268 <span class="comment">// sauvegarde de Sigma_ibc Ksi_ibc(j) Tref_ibc pour post-traitement</span>
<a name="l01269"></a>01269               tab_(j) += tref_j;
<a name="l01270"></a>01270 <span class="comment">// penalisation_global = Sigma_ibc Ksi_ibc(j)*(Tref_ibc - inc) /  eta;</span>
<a name="l01271"></a>01271               pena_loc(j) *= (tref_j-inc(j));
<a name="l01272"></a>01272               pena_loc(j) /= <a class="code" href="classConvection__Diffusion__Temperature.html#aedbe5cc441073edc75ff1b7e491aa620">eta</a>;
<a name="l01273"></a>01273               pena_glob(j)  += pena_loc(j);
<a name="l01274"></a>01274             }
<a name="l01275"></a>01275         }
<a name="l01276"></a>01276     }
<a name="l01277"></a>01277 
<a name="l01278"></a>01278 <span class="comment">// Realisation de la penalisation L2 de la derivee en temps: (dT_t_* + pena_glob) / ( 1 + (dt*Sigma_ibc Ksi_ibc(j)) / eta )</span>
<a name="l01279"></a>01279 <span class="comment">// Tref est la moyenne arithmetique de Tref_j lorsque 0&lt;eta&lt;&lt;1</span>
<a name="l01280"></a>01280   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0 ; j&lt;nb_elem ; ++j)
<a name="l01281"></a>01281     {
<a name="l01282"></a>01282       u(j) = u_old(j) + pena_glob(j);
<a name="l01283"></a>01283       u(j) /= (1. + denom(j)*dt/<a class="code" href="classConvection__Diffusion__Temperature.html#aedbe5cc441073edc75ff1b7e491aa620">eta</a>);
<a name="l01284"></a>01284     }
<a name="l01285"></a>01285   u.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l01286"></a>01286 
<a name="l01287"></a>01287 <span class="comment">// Sauvegarde des flux</span>
<a name="l01288"></a>01288   <a class="code" href="classConvection__Diffusion__Temperature.html#a06c061aa19d88e3f1392c381247551e7">ecrire_fichier_pena_th</a>(u_old,u,tab_,denom);
<a name="l01289"></a>01289 
<a name="l01290"></a>01290 <span class="comment">// Debog::verifier(&quot;Convection_Diffusion_Temperature::penalisation_L2 u &quot;,u);</span>
<a name="l01291"></a>01291   <span class="keywordflow">return</span> u;
<a name="l01292"></a>01292 }
<a name="l01293"></a>01293 
<a name="l01294"></a><a class="code" href="Convection__Diffusion__Temperature_8cpp.html#a6620db2a6194e54088b4c12791761303">01294</a> <span class="keywordtype">void</span> <a class="code" href="Convection__Diffusion__Temperature_8cpp.html#a6620db2a6194e54088b4c12791761303">ouvrir_fichier_pena_th</a>(<a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a>&amp; os, <span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; type, <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; flag, <span class="keyword">const</span> <a class="code" href="classTransport__Interfaces__base.html" title="classe Transport_Interfaces_base Cette classe constitue la classe de base des equations de transport ...">Transport_Interfaces_base</a>&amp; equation)
<a name="l01295"></a>01295 {
<a name="l01296"></a>01296 <span class="comment">// flag nul on n&#39;ouvre pas le fichier</span>
<a name="l01297"></a>01297   <span class="keywordflow">if</span> (flag==0)
<a name="l01298"></a>01298     return ;
<a name="l01299"></a>01299   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> fichier=<a class="code" href="classObjet__U.html#a7c27c4f80259eeef76ff8fe2d3bc61f7" title="Renvoie une reference constante vers le nom du cas. Cette methode est statique.">Objet_U::nom_du_cas</a>();
<a name="l01300"></a>01300   fichier+=<span class="stringliteral">&quot;_&quot;</span>;
<a name="l01301"></a>01301   fichier+=type;
<a name="l01302"></a>01302   fichier+=<span class="stringliteral">&quot;_&quot;</span>;
<a name="l01303"></a>01303   fichier+=equation.<a class="code" href="classEquation__base.html#a65e9b2520ac7b42444e4d9aa4f18ccf7" title="Renvoie le nom de l&#39;equation.">le_nom</a>();
<a name="l01304"></a>01304   fichier+=<span class="stringliteral">&quot;.out&quot;</span>;
<a name="l01305"></a>01305   <span class="keyword">const</span> <a class="code" href="classSchema__Temps__base.html" title="classe Schema_Temps_base">Schema_Temps_base</a>&amp; sch=equation.<a class="code" href="classEquation__base.html#aa8151a96f63719523bf50ddd832e0f8f" title="Renvoie le probleme associe a l&#39;equation.">probleme</a>().<a class="code" href="classProbleme__base.html#a0cf6c541e30cd21c3da32fc122cb0e2b" title="Renvoie le schema en temps associe au probleme. (si il est non nul) (version const)">schema_temps</a>();
<a name="l01306"></a>01306   <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; precision=sch.<a class="code" href="classSchema__Temps__base.html#a340db779c9f9a2645534a79341fdd68b">precision_impr</a>();
<a name="l01307"></a>01307 <span class="comment">// On cree le fichier a la premiere impression avec l&#39;en tete</span>
<a name="l01308"></a>01308   <span class="keywordflow">if</span> (sch.<a class="code" href="classSchema__Temps__base.html#a84c5b1a3eb859cd76e245ae0b2d0a9ef" title="Renvoie le nombre d&#39;impressions effectuees.">nb_impr</a>()==1 &amp;&amp; !equation.<a class="code" href="classEquation__base.html#aa8151a96f63719523bf50ddd832e0f8f" title="Renvoie le probleme associe a l&#39;equation.">probleme</a>().<a class="code" href="classProbleme__base.html#acafc48b3c050d6c292bb8395a7904a33">reprise_effectuee</a>())
<a name="l01309"></a>01309     {
<a name="l01310"></a>01310       os.<a class="code" href="classSortie__Fichier__base.html#a7e75e18ed580cd4d45912ec202caa2b2">ouvrir</a>(fichier);
<a name="l01311"></a>01311       <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a>&amp; fic=os;
<a name="l01312"></a>01312       <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> espace=<span class="stringliteral">&quot;\t\t&quot;</span>;
<a name="l01313"></a>01313       fic &lt;&lt; (<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>)<span class="stringliteral">&quot;# Impression puissance thermique&quot;</span>;
<a name="l01314"></a>01314       fic &lt;&lt; <span class="stringliteral">&quot; interface &quot;</span> &lt;&lt; equation.<a class="code" href="classEquation__base.html#a65e9b2520ac7b42444e4d9aa4f18ccf7" title="Renvoie le nom de l&#39;equation.">le_nom</a>();
<a name="l01315"></a>01315       fic &lt;&lt; <span class="stringliteral">&quot; en W&quot;</span> &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01316"></a>01316       fic &lt;&lt; finl &lt;&lt; <span class="stringliteral">&quot;# Temps&quot;</span>;
<a name="l01317"></a>01317 
<a name="l01318"></a>01318       <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> ch=espace;
<a name="l01319"></a>01319       ch+=<span class="stringliteral">&quot;P&quot;</span>;
<a name="l01320"></a>01320       fic &lt;&lt; ch &lt;&lt; finl;
<a name="l01321"></a>01321     }
<a name="l01322"></a>01322 <span class="comment">// Sinon on l&#39;ouvre</span>
<a name="l01323"></a>01323   <span class="keywordflow">else</span>
<a name="l01324"></a>01324     {
<a name="l01325"></a>01325       os.<a class="code" href="classSortie__Fichier__base.html#a7e75e18ed580cd4d45912ec202caa2b2">ouvrir</a>(fichier,ios::app);
<a name="l01326"></a>01326     }
<a name="l01327"></a>01327   os.<a class="code" href="classSortie__Fichier__base.html#a489ca01946f4e2a7a9aa8f3a3d949b08">precision</a>(precision);
<a name="l01328"></a>01328   os.<a class="code" href="classSortie__Fichier__base.html#a5ddd834ca9c766c24cc608cd03ef0e96">setf</a>(ios::scientific);
<a name="l01329"></a>01329 }
<a name="l01330"></a>01330 
<a name="l01331"></a><a class="code" href="classConvection__Diffusion__Temperature.html#a06c061aa19d88e3f1392c381247551e7">01331</a> <span class="keywordtype">void</span> <a class="code" href="classConvection__Diffusion__Temperature.html#a06c061aa19d88e3f1392c381247551e7">Convection_Diffusion_Temperature::ecrire_fichier_pena_th</a>(<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; u_old, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; u, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; tref, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; denom)
<a name="l01332"></a>01332 {
<a name="l01333"></a>01333 
<a name="l01334"></a>01334   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>-&gt;limpr())
<a name="l01335"></a>01335     {
<a name="l01336"></a>01336 
<a name="l01337"></a>01337       <span class="keyword">const</span> <a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>&amp; zone_vf = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>, <a class="code" href="classEquation__base.html#a12d97ae801edc18f614523677921346e" title="Renvoie la zone discretisee associee a l&#39;equation.">zone_dis</a>().<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>());
<a name="l01338"></a>01338       <span class="keyword">const</span> <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; vol_maille = zone_vf.<a class="code" href="classZone__VF.html#aea771c835e561469d2d21dbca5fac1cf" title="renvoie le volume de la maille i.">volumes</a>();
<a name="l01339"></a>01339       <span class="keyword">const</span> <a class="code" href="classFluide__base.html" title="classe Fluide_base Cette classe represente un d&#39;un fluide incompressible ainsi que ses proprietes: - ...">Fluide_base</a>&amp; fluide_inc = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classFluide__base.html" title="classe Fluide_base Cette classe represente un d&#39;un fluide incompressible ainsi que ses proprietes: - ...">Fluide_base</a>, <a class="code" href="classConvection__Diffusion__Temperature.html#a4d944b784ab2d9d4845fd6eeca0cccc4" title="Renvoie le milieu physique de l&#39;equation. (un Fluide_base upcaste en Milieu_base) (version const)...">milieu</a>());
<a name="l01340"></a>01340       <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; tab_rho = fluide_inc.<a class="code" href="classMilieu__base.html#a46a9a4bfb046ed22d0f267b6c052889f" title="Renvoie la masse volumique du milieu. (version const)">masse_volumique</a>().<a class="code" href="classChamp__Proto.html#a9d8c69f11d1b0a8e378cc6ca41793614">valeurs</a>();
<a name="l01341"></a>01341       <span class="keyword">const</span> <span class="keywordtype">double</span> rho = tab_rho(0,0);
<a name="l01342"></a>01342       <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; tab_cp = fluide_inc.<a class="code" href="classMilieu__base.html#a174d49eab1db7dfce83578b227f4e702" title="Renvoie la capacite calorifique du milieu. (version const)">capacite_calorifique</a>().<a class="code" href="classDeriv__Champ__Don__base.html#ae16e7e2a7a706352781c5ecc7764703d">valeur</a>().<a class="code" href="classChamp__Don__base.html#ac0ac51817e03e27c28d2b96bb15db9a0" title="Surcharge Champ_base::valeurs() Renvoie le tableau des valeurs.">valeurs</a>();
<a name="l01343"></a>01343       <span class="keyword">const</span> <span class="keywordtype">double</span> cp = tab_cp(0,0);
<a name="l01344"></a>01344 
<a name="l01345"></a>01345 <span class="comment">// Methode pour calculer le flux total sur les ibc</span>
<a name="l01346"></a>01346 
<a name="l01347"></a>01347 <span class="comment">// Calcul de T_n+1 apres penalisation</span>
<a name="l01348"></a>01348       <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; inc=<a class="code" href="classConvection__Diffusion__Temperature.html#aab6a891f15e7996eda73b1b6e67e7dbd" title="Renvoie le champ inconnue representant la temperatue. (version const)">inconnue</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>();
<a name="l01349"></a>01349       <span class="keyword">const</span> <span class="keywordtype">int</span> nb_elem  = u.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l01350"></a>01350       <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; dt = <a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a0e4f67ef6086c09434ddc161668077b2" title="Renvoie le pas de temps (delta_t) courant.">pas_de_temps</a>();
<a name="l01351"></a>01351       <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> tkp1(inc);
<a name="l01352"></a>01352       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0 ; k&lt;nb_elem ; ++k) tkp1(k) += u(k)*dt;
<a name="l01353"></a>01353 
<a name="l01354"></a>01354 <span class="comment">// Terme de penalisation:       Sigma_ibc Ksi_ibc * ( T_n+1 - Tref_ibc) / eta</span>
<a name="l01355"></a>01355       <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> F(inc);
<a name="l01356"></a>01356       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j&lt;nb_elem; ++j)  F(j) = (tref(j)-denom(j)*tkp1(j))/<a class="code" href="classConvection__Diffusion__Temperature.html#aedbe5cc441073edc75ff1b7e491aa620">eta</a>;
<a name="l01357"></a>01357 
<a name="l01358"></a>01358 <span class="comment">// boucle sur les IBC</span>
<a name="l01359"></a>01359 
<a name="l01360"></a>01360       <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> filtre(nb_elem);
<a name="l01361"></a>01361       <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> filtre_glob(nb_elem);
<a name="l01362"></a>01362       <span class="keyword">const</span> <span class="keywordtype">double</span> temps_flux = <a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>-&gt;temps_courant();
<a name="l01363"></a>01363       <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> espace=<span class="stringliteral">&quot; \t&quot;</span>;
<a name="l01364"></a>01364 
<a name="l01365"></a>01365       <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0 ; i &lt; <a class="code" href="classConvection__Diffusion__Temperature.html#a025ff54c166b1a5ec73680548e82b913">ref_penalisation_L2_FTD</a>.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>() ; ++i) <span class="comment">//boucle sur le nombre d&#39;ibc</span>
<a name="l01366"></a>01366         {
<a name="l01367"></a>01367           <a class="code" href="classTransport__Interfaces__base.html" title="classe Transport_Interfaces_base Cette classe constitue la classe de base des equations de transport ...">Transport_Interfaces_base</a>&amp; nom_eq = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classTransport__Interfaces__base.html" title="classe Transport_Interfaces_base Cette classe constitue la classe de base des equations de transport ...">Transport_Interfaces_base</a>,<a class="code" href="classConvection__Diffusion__Temperature.html#a025ff54c166b1a5ec73680548e82b913">ref_penalisation_L2_FTD</a>[i].<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>());
<a name="l01368"></a>01368           <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; indicatrice = nom_eq.<a class="code" href="classTransport__Interfaces__base.html#a78dd18b060f3370efbfb4fbb230ce626">get_update_indicatrice</a>().<a class="code" href="classChamp__Proto.html#a9d8c69f11d1b0a8e378cc6ca41793614">valeurs</a>();
<a name="l01369"></a>01369           <span class="keywordtype">double</span> Flux_pena= 0.;
<a name="l01370"></a>01370           <span class="keywordtype">double</span> Flux_pena_old= 0.;
<a name="l01371"></a>01371           <span class="keywordtype">double</span> Flux_temp_interne= 0.;
<a name="l01372"></a>01372 <span class="comment">// Filtre ibc (1) / non ibc (0)</span>
<a name="l01373"></a>01373           filtre = 0.;
<a name="l01374"></a>01374           <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j = 0 ; j&lt;nb_elem ; ++j)
<a name="l01375"></a>01375             {
<a name="l01376"></a>01376               <span class="keywordflow">if</span> (indicatrice(j) &gt; 0.)
<a name="l01377"></a>01377                 {
<a name="l01378"></a>01378                   filtre(j) = 1.;
<a name="l01379"></a>01379                   filtre_glob(j)=1.;
<a name="l01380"></a>01380                 }
<a name="l01381"></a>01381 <span class="comment">// bilans</span>
<a name="l01382"></a>01382 <span class="comment">// Attention rho et cp constants</span>
<a name="l01383"></a>01383               Flux_pena_old += u_old(j) * filtre(j) *rho *cp *vol_maille(j);
<a name="l01384"></a>01384               Flux_pena += F(j) * filtre(j) * vol_maille(j) *rho *cp;
<a name="l01385"></a>01385               Flux_temp_interne += filtre(j)*rho*cp*vol_maille(j)*u(j);
<a name="l01386"></a>01386             }
<a name="l01387"></a>01387 
<a name="l01388"></a>01388 <span class="comment">// Ajout des differents processeurs en //</span>
<a name="l01389"></a>01389           Flux_pena_old = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">mp_sum</a>(Flux_pena_old);
<a name="l01390"></a>01390           Flux_pena = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">mp_sum</a>(Flux_pena);
<a name="l01391"></a>01391           Flux_temp_interne = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">mp_sum</a>(Flux_temp_interne);
<a name="l01392"></a>01392 
<a name="l01393"></a>01393 <span class="comment">// ecriture</span>
<a name="l01394"></a>01394           <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l01395"></a>01395             {
<a name="l01396"></a>01396               <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a> FTE;
<a name="l01397"></a>01397               <a class="code" href="Convection__Diffusion__Temperature_8cpp.html#a6620db2a6194e54088b4c12791761303">ouvrir_fichier_pena_th</a>(FTE,<span class="stringliteral">&quot;Puissance_penalisation_thermique_ibc&quot;</span>,1,nom_eq);
<a name="l01398"></a>01398               FTE &lt;&lt; temps_flux;
<a name="l01399"></a>01399               FTE &lt;&lt; espace &lt;&lt; Flux_pena;
<a name="l01400"></a>01400               FTE &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01401"></a>01401 
<a name="l01402"></a>01402               <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a> FTI;
<a name="l01403"></a>01403               <a class="code" href="Convection__Diffusion__Temperature_8cpp.html#a6620db2a6194e54088b4c12791761303">ouvrir_fichier_pena_th</a>(FTI,<span class="stringliteral">&quot;Puissance_thermique_ibc&quot;</span>,1,nom_eq);
<a name="l01404"></a>01404               FTI &lt;&lt; temps_flux;
<a name="l01405"></a>01405               FTI &lt;&lt; espace &lt;&lt; Flux_pena_old;
<a name="l01406"></a>01406               FTI &lt;&lt; finl;
<a name="l01407"></a>01407 
<a name="l01408"></a>01408               <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a> FTTI;
<a name="l01409"></a>01409               <a class="code" href="Convection__Diffusion__Temperature_8cpp.html#a6620db2a6194e54088b4c12791761303">ouvrir_fichier_pena_th</a>(FTTI,<span class="stringliteral">&quot;Derivee_temps_temperature_ibc&quot;</span>,1,nom_eq);
<a name="l01410"></a>01410               FTTI &lt;&lt; temps_flux;
<a name="l01411"></a>01411               FTTI &lt;&lt; espace &lt;&lt; Flux_temp_interne;
<a name="l01412"></a>01412               FTTI &lt;&lt; finl;
<a name="l01413"></a>01413             }
<a name="l01414"></a>01414         }
<a name="l01415"></a>01415 
<a name="l01416"></a>01416 <span class="comment">// bilan Derivee_temps_temperature_fluide</span>
<a name="l01417"></a>01417 <span class="comment">// Attention rho et cp constants</span>
<a name="l01418"></a>01418       <span class="keywordtype">double</span> Flux_temp_externe= 0.;
<a name="l01419"></a>01419       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j&lt;nb_elem; ++j)
<a name="l01420"></a>01420         {
<a name="l01421"></a>01421           Flux_temp_externe += (1.-filtre_glob(j))  *rho *cp *vol_maille(j) * u(j); <span class="comment">//fluide</span>
<a name="l01422"></a>01422         }
<a name="l01423"></a>01423 
<a name="l01424"></a>01424 <span class="comment">// Ajout des differents processeurs en //</span>
<a name="l01425"></a>01425       Flux_temp_externe = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">mp_sum</a>(Flux_temp_externe); <span class="comment">//fluide</span>
<a name="l01426"></a>01426 
<a name="l01427"></a>01427 <span class="comment">// ecriture</span>
<a name="l01428"></a>01428       <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l01429"></a>01429         {
<a name="l01430"></a>01430           <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a> fichier;
<a name="l01431"></a>01431           <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> fichier_nom=<a class="code" href="classObjet__U.html#a7c27c4f80259eeef76ff8fe2d3bc61f7" title="Renvoie une reference constante vers le nom du cas. Cette methode est statique.">Objet_U::nom_du_cas</a>();
<a name="l01432"></a>01432           fichier_nom+=<span class="stringliteral">&quot;_&quot;</span>;
<a name="l01433"></a>01433           fichier_nom+=<span class="stringliteral">&quot;Derivee_temps_temperature_fluide.out&quot;</span>;
<a name="l01434"></a>01434           <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>-&gt;nb_impr()==1 &amp;&amp; !<a class="code" href="classEquation__base.html#aa8151a96f63719523bf50ddd832e0f8f" title="Renvoie le probleme associe a l&#39;equation.">probleme</a>().<a class="code" href="classProbleme__base.html#acafc48b3c050d6c292bb8395a7904a33">reprise_effectuee</a>())
<a name="l01435"></a>01435             {
<a name="l01436"></a>01436               fichier.<a class="code" href="classSortie__Fichier__base.html#a7e75e18ed580cd4d45912ec202caa2b2">ouvrir</a>(fichier_nom);
<a name="l01437"></a>01437             }
<a name="l01438"></a>01438           <span class="keywordflow">else</span>
<a name="l01439"></a>01439             {
<a name="l01440"></a>01440               fichier.<a class="code" href="classSortie__Fichier__base.html#a7e75e18ed580cd4d45912ec202caa2b2">ouvrir</a>(fichier_nom,ios::app);
<a name="l01441"></a>01441             }
<a name="l01442"></a>01442 <span class="comment">// if (fichier)</span>
<a name="l01443"></a>01443           {
<a name="l01444"></a>01444             (fichier) &lt;&lt;temps_flux&lt;&lt;<span class="stringliteral">&quot; \t&quot;</span>&lt;&lt;Flux_temp_externe&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01445"></a>01445 
<a name="l01446"></a>01446           }
<a name="l01447"></a>01447         }
<a name="l01448"></a>01448     }
<a name="l01449"></a>01449 }
<a name="l01450"></a>01450 
<a name="l01451"></a><a class="code" href="classConvection__Diffusion__Temperature.html#a78c4b7631d32e6519bfb319f6a092931">01451</a> <span class="keyword">const</span> <a class="code" href="classChamp__Don.html" title="classe Champ_Don Classe generique de la hierarchie des champs donnes, un objet Champ_Don peut referen...">Champ_Don</a>&amp; <a class="code" href="classConvection__Diffusion__Temperature.html#a78c4b7631d32e6519bfb319f6a092931">Convection_Diffusion_Temperature::diffusivite_pour_transport</a>()
<a name="l01452"></a>01452 {
<a name="l01453"></a>01453   <span class="keywordflow">return</span> <a class="code" href="classConvection__Diffusion__Temperature.html#a4d944b784ab2d9d4845fd6eeca0cccc4" title="Renvoie le milieu physique de l&#39;equation. (un Fluide_base upcaste en Milieu_base) (version const)...">milieu</a>().<a class="code" href="classMilieu__base.html#a99251c07d04e1f13ec4c300bfe8757db" title="Renvoie la conductivite du milieu. (version const)">conductivite</a>();
<a name="l01454"></a>01454 }
<a name="l01455"></a>01455 
<a name="l01456"></a><a class="code" href="classConvection__Diffusion__Temperature.html#ab9459fce614d454490281858f631946e">01456</a> <span class="keyword">const</span> <a class="code" href="classChamp__base.html" title="classe Champ_base Cette classe est la base de la hierarchie des champs. Ses membres sont les attribut...">Champ_base</a>&amp; <a class="code" href="classConvection__Diffusion__Temperature.html#ab9459fce614d454490281858f631946e">Convection_Diffusion_Temperature::diffusivite_pour_pas_de_temps</a>()
<a name="l01457"></a>01457 {
<a name="l01458"></a>01458   <span class="keywordflow">return</span> <a class="code" href="classConvection__Diffusion__Temperature.html#a4d944b784ab2d9d4845fd6eeca0cccc4" title="Renvoie le milieu physique de l&#39;equation. (un Fluide_base upcaste en Milieu_base) (version const)...">milieu</a>().<a class="code" href="classMilieu__base.html#a4da7a57f2b9cafb4aaf9309360b6a29f" title="Renvoie la diffusivite du milieu. (version const)">diffusivite</a>();
<a name="l01459"></a>01459 }
<a name="l01460"></a>01460 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:34 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
