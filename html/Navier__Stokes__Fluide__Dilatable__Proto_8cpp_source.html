<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/ThHyd/Dilatable/Common/Equations/Navier_Stokes_Fluide_Dilatable_Proto.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/ThHyd/Dilatable/Common/Equations/Navier_Stokes_Fluide_Dilatable_Proto.cpp</div>  </div>
</div>
<div class="contents">
<a href="Navier__Stokes__Fluide__Dilatable__Proto_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (c) 2021, CEA</span>
<a name="l00003"></a>00003 <span class="comment">* All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment">* 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00007"></a>00007 <span class="comment">* 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00008"></a>00008 <span class="comment">* 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<a name="l00011"></a>00011 <span class="comment">* IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;</span>
<a name="l00012"></a>00012 <span class="comment">* OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// File:        Navier_Stokes_Fluide_Dilatable_Proto.cpp</span>
<a name="l00018"></a>00018 <span class="comment">// Directory:   $TRUST_ROOT/src/ThHyd/Dilatable/Common/Equations</span>
<a name="l00019"></a>00019 <span class="comment">// Version:     /main/47</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;<a class="code" href="Navier__Stokes__Fluide__Dilatable__Proto_8h.html">Navier_Stokes_Fluide_Dilatable_Proto.h</a>&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="Transport__Interfaces__base_8h.html">Transport_Interfaces_base.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="Fluide__Dilatable__base_8h.html">Fluide_Dilatable_base.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="Navier__Stokes__std_8h.html">Navier_Stokes_std.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="Schema__Temps__base_8h.html">Schema_Temps_base.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="Probleme__base_8h.html">Probleme_base.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="DoubleTrav_8h.html">DoubleTrav.h</a>&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;<a class="code" href="Dirichlet_8h.html">Dirichlet.h</a>&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;<a class="code" href="Zone__VF_8h.html">Zone_VF.h</a>&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;<a class="code" href="Domaine_8h.html">Domaine.h</a>&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;<a class="code" href="Debog_8h.html">Debog.h</a>&gt;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a><a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#a81f29a2ce2cf16fe45786c5ba146f5d5">00035</a> <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#a81f29a2ce2cf16fe45786c5ba146f5d5">Navier_Stokes_Fluide_Dilatable_Proto::Navier_Stokes_Fluide_Dilatable_Proto</a>() : cumulative_(0) { }
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="comment">// Multiply density by velocity and return density*velocity (mass flux)</span>
<a name="l00038"></a><a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#ad7b9506e7bda4dbde7ce4e4edca71298">00038</a> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#ad7b9506e7bda4dbde7ce4e4edca71298">Navier_Stokes_Fluide_Dilatable_Proto::rho_vitesse_impl</a>(<span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; tab_rho,<span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; vit,<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; rhovitesse)<span class="keyword"> const</span>
<a name="l00039"></a>00039 <span class="keyword"></span>{
<a name="l00040"></a>00040   <span class="keyword">const</span> <span class="keywordtype">int</span> n = vit.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0), ncomp = vit.<a class="code" href="classDoubleVect.html#ab02d01cd1bdab66fbd66f9a47cc29e10">line_size</a>();
<a name="l00041"></a>00041 
<a name="l00042"></a>00042   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0 ; i&lt;n ; i++)
<a name="l00043"></a>00043     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0 ; j&lt;ncomp ; j++) rhovitesse(i,j) = tab_rho(i,0)*vit(i,j);
<a name="l00044"></a>00044 
<a name="l00045"></a>00045   rhovitesse.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l00046"></a>00046   <a class="code" href="Op__Div__VEFP1B__Elem_8cpp.html#a45261662b3b88d5db461b3fc99246e5a">Debog::verifier</a>(<span class="stringliteral">&quot;Navier_Stokes_Fluide_Dilatable_Proto::rho_vitesse : &quot;</span>, rhovitesse);
<a name="l00047"></a>00047   <span class="keywordflow">return</span> rhovitesse;
<a name="l00048"></a>00048 }
<a name="l00049"></a>00049 
<a name="l00050"></a><a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#af931eee109bd785a2bf96957532fe2f3">00050</a> <span class="keywordtype">int</span> <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#af931eee109bd785a2bf96957532fe2f3">Navier_Stokes_Fluide_Dilatable_Proto::impr_impl</a>(<span class="keyword">const</span> <a class="code" href="classNavier__Stokes__std.html" title="classe Navier_Stokes_std Cette classe porte les termes de l&#39;equation de la dynamique pour un fluide s...">Navier_Stokes_std</a>&amp; eqn,<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os)<span class="keyword"> const</span>
<a name="l00051"></a>00051 <span class="keyword"></span>{
<a name="l00052"></a>00052   <span class="keyword">const</span> <a class="code" href="classFluide__Dilatable__base.html" title="classe Fluide_Dilatable_base Cette classe represente un d&#39;un fluide dilatable, heritant de fluide bas...">Fluide_Dilatable_base</a>&amp; fluide_dil = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classFluide__Dilatable__base.html" title="classe Fluide_Dilatable_base Cette classe represente un d&#39;un fluide dilatable, heritant de fluide bas...">Fluide_Dilatable_base</a>,eqn.<a class="code" href="classNavier__Stokes__std.html#a6b341590bc39e1395c14560f10d67fdb" title="Renvoie le fluide incompressible (milieu physique de l&#39;equation) associe a l&#39;equation. (version const)">fluide</a>());
<a name="l00053"></a>00053   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; vit = eqn.<a class="code" href="classNavier__Stokes__std.html#ab831017616b67792f562fea81f1e5dce">vitesse</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>(), rho = fluide_dil.<a class="code" href="classFluide__Dilatable__base.html#a29eacbad70e5894523fd7709d762dcf2">rho_face_np1</a>();
<a name="l00054"></a>00054   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> mass_flux(vit);
<a name="l00055"></a>00055   <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#ad7b9506e7bda4dbde7ce4e4edca71298">rho_vitesse_impl</a>(rho,vit,mass_flux);
<a name="l00056"></a>00056 
<a name="l00057"></a>00057   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> array;
<a name="l00058"></a>00058   array.<a class="code" href="classDoubleTab.html#aa4dd124734ab5d6cb7aa93a104c0868e">copy</a>(eqn.<a class="code" href="classNavier__Stokes__std.html#ad5001f4d8f41615c2963d36f703bb954">div</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>(), <a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ffaf6ae9ba7eb51c5f298ce693345b3ec68">Array_base::NOCOPY_NOINIT</a>); <span class="comment">//!&lt; init structure uniquement</span>
<a name="l00059"></a>00059 <span class="comment"></span>  <span class="keywordflow">if</span> (<a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#ab224b13eb4a2fa008b3ba02e314db03c" title="RHS of div(rho.U)">tab_W</a>.<a class="code" href="classDoubleVect.html#a0d16d30580c90526e4895388fb44be5d">get_md_vector</a>().<a class="code" href="classMD__Vector.html#a4165c00904b7096274e38fdc7ca340f4">non_nul</a>())
<a name="l00060"></a>00060     {
<a name="l00061"></a>00061       <a class="code" href="DoubleVect_8cpp.html#ad0e13908fed9f476adc797982dce010a">operator_egal</a>(array, <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#ab224b13eb4a2fa008b3ba02e314db03c" title="RHS of div(rho.U)">tab_W</a> ); <span class="comment">//, VECT_REAL_ITEMS); //!&lt; initialise</span>
<a name="l00062"></a>00062       array*=-1;
<a name="l00063"></a>00063     }
<a name="l00064"></a>00064   <span class="keywordflow">else</span>
<a name="l00065"></a>00065     {
<a name="l00066"></a>00066 <span class="comment">// remarque B.M.: certaines implementations de cette methode ne font pas echange espace virtuel:</span>
<a name="l00067"></a>00067       fluide_dil.<a class="code" href="classFluide__Dilatable__base.html#a881172acb09944046107e7c87e8fdcaf">secmembre_divU_Z</a>(array);
<a name="l00068"></a>00068       array*=-1;
<a name="l00069"></a>00069     }
<a name="l00070"></a>00070 
<a name="l00071"></a>00071   array.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l00072"></a>00072   eqn.<a class="code" href="classNavier__Stokes__std.html#a614d41350181667ee295b87a72779c1a" title="Renvoie l&#39;operateur de calcul de la divergence associe a l&#39;equation.">operateur_divergence</a>().<a class="code" href="classOperateur__Div.html#aeb7f9d269b7d93314ce9583f0fa1f57d" title="Ajoute la contribution de l&#39;operateur au tableau passe en parametre.">ajouter</a>(mass_flux, array);
<a name="l00073"></a>00073   <span class="keywordtype">double</span> LocalMassFlowRateError = <a class="code" href="DoubleVect_8cpp.html#acb21ec8c0b3909c26b20e3f3455e0289">mp_max_abs_vect</a>(array); <span class="comment">//!&lt; max|sum(rho*u*ndS)|</span>
<a name="l00074"></a>00074 <span class="comment"></span>
<a name="l00075"></a>00075   os &lt;&lt; <span class="stringliteral">&quot;-------------------------------------------------------------------&quot;</span>&lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00076"></a>00076   os &lt;&lt; <span class="stringliteral">&quot;Cell balance mass flow rate control for the problem &quot;</span> &lt;&lt; eqn.<a class="code" href="classEquation__base.html#aa8151a96f63719523bf50ddd832e0f8f" title="Renvoie le probleme associe a l&#39;equation.">probleme</a>().<a class="code" href="classProbleme__base.html#a58bc0b101f3f3f1d8522a9f41f1fad7b" title="surcharge Objet_U::le_nom() Renvoie le nom du probleme">le_nom</a>() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; finl;
<a name="l00077"></a>00077   os &lt;&lt; <span class="stringliteral">&quot;Absolute value : &quot;</span> &lt;&lt; LocalMassFlowRateError &lt;&lt; <span class="stringliteral">&quot; kg/s&quot;</span> &lt;&lt; finl; ;
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="comment">// On divise array par vol(i)</span>
<a name="l00080"></a>00080   eqn.<a class="code" href="classNavier__Stokes__std.html#a614d41350181667ee295b87a72779c1a" title="Renvoie l&#39;operateur de calcul de la divergence associe a l&#39;equation.">operateur_divergence</a>().<a class="code" href="classOperateur__Div.html#ad960676e405c7d46000efccf9fa062b4" title="Initialise le tableau passe en parametre avec la contribution de l&#39;operateur.">volumique</a>(array);
<a name="l00081"></a>00081 
<a name="l00082"></a>00082 <span class="comment">// On divise par un rho moyen</span>
<a name="l00083"></a>00083   <span class="keywordtype">double</span> rho_moyen = <a class="code" href="DoubleVect_8cpp.html#a71135d1749309bf589342004b76df614">mp_moyenne_vect</a>(rho), dt = eqn.<a class="code" href="classEquation__base.html#aa8151a96f63719523bf50ddd832e0f8f" title="Renvoie le probleme associe a l&#39;equation.">probleme</a>().<a class="code" href="classProbleme__base.html#a0cf6c541e30cd21c3da32fc122cb0e2b" title="Renvoie le schema en temps associe au probleme. (si il est non nul) (version const)">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a0e4f67ef6086c09434ddc161668077b2" title="Renvoie le pas de temps (delta_t) courant.">pas_de_temps</a>();
<a name="l00084"></a>00084   <span class="keywordtype">double</span> bilan_massique_relatif = <a class="code" href="DoubleVect_8cpp.html#acb21ec8c0b3909c26b20e3f3455e0289">mp_max_abs_vect</a>(array) * dt / rho_moyen;
<a name="l00085"></a>00085   os &lt;&lt; <span class="stringliteral">&quot;Relative value : &quot;</span> &lt;&lt; bilan_massique_relatif &lt;&lt; finl; <span class="comment">//!&lt; =max|LocalMassFlowRateError/(rho_moyen*Vol(i)/dt)|</span>
<a name="l00086"></a>00086 <span class="comment"></span>
<a name="l00087"></a>00087 <span class="comment">// Calculation as OpenFOAM: http://foam.sourceforge.net/docs/cpp/a04190_source.html</span>
<a name="l00088"></a>00088 <span class="comment">// It is relative errors (normalized by the volume/dt)</span>
<a name="l00089"></a>00089   <span class="keywordtype">double</span> TotalMass = rho_moyen * eqn.<a class="code" href="classEquation__base.html#aa8151a96f63719523bf50ddd832e0f8f" title="Renvoie le probleme associe a l&#39;equation.">probleme</a>().<a class="code" href="classProbleme__base.html#afa73c54a5b6b111e0f08cd1ab3608178" title="Renvoie le domaine associe au probleme. (version const)">domaine</a>().<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#ab642027f7a7c19e98f906f0ae007c2b7">volume_total</a>();
<a name="l00090"></a>00090   <span class="keywordtype">double</span> local = LocalMassFlowRateError / ( TotalMass / dt ), global = <a class="code" href="DoubleVect_8cpp.html#a07dd5e25d47ad3892ae0fa4e997ed011">mp_somme_vect</a>(array) / ( TotalMass / dt );
<a name="l00091"></a>00091   <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#ac294b3e6fc88a751ac14ac3547d5668b">cumulative_</a> += global;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093   os &lt;&lt; <span class="stringliteral">&quot;time step continuity errors : sum local = &quot;</span> &lt;&lt; local &lt;&lt; <span class="stringliteral">&quot;, global = &quot;</span> &lt;&lt; global &lt;&lt; <span class="stringliteral">&quot;, cumulative = &quot;</span> &lt;&lt; <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#ac294b3e6fc88a751ac14ac3547d5668b">cumulative_</a> &lt;&lt; finl;
<a name="l00094"></a>00094 
<a name="l00095"></a>00095   <span class="keywordflow">if</span> (local &gt; 0.01)
<a name="l00096"></a>00096     {
<a name="l00097"></a>00097       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;The mass balance is too bad (relative value &gt; 1%).&quot;</span> &lt;&lt; finl;
<a name="l00098"></a>00098       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Please check and lower the convergence value of the pressure solver.&quot;</span> &lt;&lt; finl;
<a name="l00099"></a>00099       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00100"></a>00100     }
<a name="l00101"></a>00101   <span class="keywordflow">return</span> 1;
<a name="l00102"></a>00102 }
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 <span class="comment">// Precondition:</span>
<a name="l00105"></a>00105 <span class="comment">// Parametre: DoubleTab&amp; vpoint</span>
<a name="l00106"></a>00106 <span class="comment">// Signification: le tableau des valeurs de l&#39;acceleration dU/dt</span>
<a name="l00107"></a>00107 <span class="comment">// Valeurs par defaut:</span>
<a name="l00108"></a>00108 <span class="comment">// Contraintes:</span>
<a name="l00109"></a>00109 <span class="comment">// Acces: sortie</span>
<a name="l00110"></a>00110 <span class="comment">// Exception:</span>
<a name="l00111"></a>00111 <span class="comment">// Effets de bord:</span>
<a name="l00112"></a>00112 <span class="comment">// Postcondition:</span>
<a name="l00113"></a>00113 <span class="comment">//</span>
<a name="l00114"></a>00114 <span class="comment">//</span>
<a name="l00115"></a>00115 <span class="comment">//</span>
<a name="l00116"></a>00116 <span class="comment">//</span><span class="comment"></span>
<a name="l00117"></a>00117 <span class="comment">//! Calcule la derivee en temps de l&#39;inconnue vitesse,&lt;br&gt;i.e. l&#39;acceleration dU/dt et la renvoie.&lt;br&gt;Appelle Equation_base::derivee_en_temps_inco(DoubleTab\&amp; )&lt;br&gt;Calcule egalement la pression.</span>
<a name="l00118"></a>00118 <span class="comment"></span><span class="comment">/** \return DoubleTab\&amp;&lt;br&gt;</span>
<a name="l00119"></a>00119 <span class="comment">Signification: le tableau des valeurs de l&#39;acceleration (derivee de la vitesse)&lt;br&gt;</span>
<a name="l00120"></a>00120 <span class="comment">Contraintes: */</span>
<a name="l00121"></a><a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#a9ce8625c558441d2f7221dd7eb8e6062">00121</a> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#a9ce8625c558441d2f7221dd7eb8e6062" title="Calcule la derivee en temps de l&#39;inconnue vitesse, i.e. l&#39;acceleration dU/dt et la renvoie...">Navier_Stokes_Fluide_Dilatable_Proto::derivee_en_temps_inco_impl</a>(<a class="code" href="classNavier__Stokes__std.html" title="classe Navier_Stokes_std Cette classe porte les termes de l&#39;equation de la dynamique pour un fluide s...">Navier_Stokes_std</a>&amp; eqn,<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; vpoint)
<a name="l00122"></a>00122 {
<a name="l00123"></a>00123   <span class="keyword">const</span> <a class="code" href="classFluide__Dilatable__base.html" title="classe Fluide_Dilatable_base Cette classe represente un d&#39;un fluide dilatable, heritant de fluide bas...">Fluide_Dilatable_base</a>&amp; fluide_dil=<a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classFluide__Dilatable__base.html" title="classe Fluide_Dilatable_base Cette classe represente un d&#39;un fluide dilatable, heritant de fluide bas...">Fluide_Dilatable_base</a>,eqn.<a class="code" href="classNavier__Stokes__std.html#a442d8f1138c18da07aa895728b3e41f2" title="Renvoie le milieu physique de l&#39;equation (le Fluide_base upcaste en Milieu_base)">milieu</a>());
<a name="l00124"></a>00124   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; press = eqn.<a class="code" href="classNavier__Stokes__std.html#afbb8f39bdfd70328dfad21bf2b9dd45a" title="Renvoie le champ de pression.">pression</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>(), vit = eqn.<a class="code" href="classNavier__Stokes__std.html#ab831017616b67792f562fea81f1e5dce">vitesse</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>();
<a name="l00125"></a>00125   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> secmem(press);
<a name="l00126"></a>00126   <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> inc_pre(press);
<a name="l00127"></a>00127 
<a name="l00128"></a>00128   <span class="keywordflow">if</span> (!<a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#ab224b13eb4a2fa008b3ba02e314db03c" title="RHS of div(rho.U)">tab_W</a>.<a class="code" href="classDoubleVect.html#a0d16d30580c90526e4895388fb44be5d">get_md_vector</a>().<a class="code" href="classMD__Vector.html#a4165c00904b7096274e38fdc7ca340f4">non_nul</a>())
<a name="l00129"></a>00129     {
<a name="l00130"></a>00130       <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#ab224b13eb4a2fa008b3ba02e314db03c" title="RHS of div(rho.U)">tab_W</a>.<a class="code" href="classDoubleTab.html#aa4dd124734ab5d6cb7aa93a104c0868e">copy</a>(secmem, <a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ffaf6ae9ba7eb51c5f298ce693345b3ec68">Array_base::NOCOPY_NOINIT</a>); <span class="comment">//!&lt; copie la structure initialisation sinon plantage assert lors du remplissage dans EDO_Pression_th_VEF::secmembre_divU_Z_VEFP1B</span>
<a name="l00131"></a>00131 <span class="comment"></span><span class="comment">//</span>
<a name="l00132"></a>00132       <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#ab224b13eb4a2fa008b3ba02e314db03c" title="RHS of div(rho.U)">tab_W</a> = 0.;
<a name="l00133"></a>00133     }
<a name="l00134"></a>00134 
<a name="l00135"></a>00135   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> rhoU;
<a name="l00136"></a>00136   rhoU.<a class="code" href="classDoubleTab.html#aa4dd124734ab5d6cb7aa93a104c0868e">copy</a>(vit, <a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ffaf6ae9ba7eb51c5f298ce693345b3ec68">Array_base::NOCOPY_NOINIT</a>); <span class="comment">//!&lt; copie la structure</span>
<a name="l00137"></a>00137 <span class="comment"></span>
<a name="l00138"></a>00138 <span class="comment">// Get champ gradP</span>
<a name="l00139"></a>00139   <a class="code" href="Ref_8h.html#aab5720a5c34da14028d0745e386aaa01">REF</a>(<a class="code" href="classChamp__base.html" title="classe Champ_base Cette classe est la base de la hierarchie des champs. Ses membres sont les attribut...">Champ_base</a>) gradient_pression;
<a name="l00140"></a>00140 
<a name="l00141"></a>00141   <span class="keywordflow">try</span>
<a name="l00142"></a>00142     {
<a name="l00143"></a>00143       gradient_pression = eqn.<a class="code" href="classNavier__Stokes__std.html#a18eccb9461a019135740a00f5e3dbec1">get_champ</a>(<span class="stringliteral">&quot;gradient_pression&quot;</span>);
<a name="l00144"></a>00144     }
<a name="l00145"></a>00145   <span class="keywordflow">catch</span> (<a class="code" href="classChamps__compris__erreur.html">Champs_compris_erreur</a>)
<a name="l00146"></a>00146     {
<a name="l00147"></a>00147       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot; l&#39;equation ne comprend pas gradient_pression &quot;</span>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00148"></a>00148       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00149"></a>00149     }
<a name="l00150"></a>00150 
<a name="l00151"></a>00151   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; gradP=gradient_pression.valeur().valeurs();
<a name="l00152"></a>00152   <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> Mmoins1grad(gradP);
<a name="l00153"></a>00153 
<a name="l00154"></a>00154 <span class="comment">// We use the incremental pressure-projection algorithm (Chorin)</span>
<a name="l00155"></a>00155 
<a name="l00156"></a>00156 <span class="comment">// Step 1 : prepare operators and solve for a provisional velocity u*</span>
<a name="l00157"></a>00157   <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#aa5039c9c3c958b1fc4cb8facddf543a4">prepare_and_solve_u_star</a>(eqn,fluide_dil,rhoU, vpoint);
<a name="l00158"></a>00158 
<a name="l00159"></a>00159 <span class="comment">// Step 2 : solve the poisson equation for the pressure increment (Pi = P^n+1 - P^n)</span>
<a name="l00160"></a>00160 <span class="comment">// Attention the matrix has a constant coefficient as the variable of NS is rhoU and not U !!!</span>
<a name="l00161"></a>00161   <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#a80fc279cfb275b0fce12a8110906a14b">solve_pressure_increment</a>(eqn,fluide_dil,rhoU,secmem,inc_pre,vpoint);
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 <span class="comment">// Step 3 : compute P^n+1 &amp; compute the correct velocity u^n+1</span>
<a name="l00164"></a>00164   <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#a9ba1bb0772471d97f38b08efceea4aa8">correct_and_compute_u_np1</a>(eqn,fluide_dil,rhoU,Mmoins1grad,inc_pre,gradP,vpoint);
<a name="l00165"></a>00165 
<a name="l00166"></a>00166   <span class="keywordflow">return</span> vpoint;
<a name="l00167"></a>00167 }
<a name="l00168"></a>00168 
<a name="l00169"></a><a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#a11534759c877a66e685dfa93eec9643e">00169</a> <span class="keywordtype">void</span> <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#a11534759c877a66e685dfa93eec9643e">Navier_Stokes_Fluide_Dilatable_Proto::assembler_avec_inertie_impl</a>(<span class="keyword">const</span> <a class="code" href="classNavier__Stokes__std.html" title="classe Navier_Stokes_std Cette classe porte les termes de l&#39;equation de la dynamique pour un fluide s...">Navier_Stokes_std</a>&amp; eqn, <a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a>&amp; mat_morse,
<a name="l00170"></a>00170                                                                        <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; present, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; secmem)
<a name="l00171"></a>00171 {
<a name="l00172"></a>00172 <span class="comment">// ******   avant inertie   ******</span>
<a name="l00173"></a>00173 <span class="comment">// diffusion en div(mu grad u ) or on veut impliciter en rho * u =&gt; on divise les contributions par le rho_face associe</span>
<a name="l00174"></a>00174 <span class="comment">// GF on ajoute apres avoir contribuer pour avoir les bons flux bords</span>
<a name="l00175"></a>00175   <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> rhovitesse(present);
<a name="l00176"></a>00176 
<a name="l00177"></a>00177 <span class="comment">// Op diff</span>
<a name="l00178"></a>00178   eqn.<a class="code" href="classNavier__Stokes__std.html#a3ad069bdae3ec7e0ffb25319401480df" title="Renvoie le i-eme operateur de l&#39;equation: - le terme_diffusif si i = 0 - le terme_convectif si i = 1 ...">operateur</a>(0).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#a903e728aad8e2d490580bf264319d65f" title="NE FAIT RIEN A surcharger dans les classes derivees.">contribuer_a_avec</a>(present,mat_morse);
<a name="l00179"></a>00179   eqn.<a class="code" href="classNavier__Stokes__std.html#a3ad069bdae3ec7e0ffb25319401480df" title="Renvoie le i-eme operateur de l&#39;equation: - le terme_diffusif si i = 0 - le terme_convectif si i = 1 ...">operateur</a>(0).<a class="code" href="classOperateur.html#accdf61cf1e33fb42e9eb06f1c501422b">ajouter</a>(secmem);
<a name="l00180"></a>00180 
<a name="l00181"></a>00181   <span class="keyword">const</span> <a class="code" href="classFluide__Dilatable__base.html" title="classe Fluide_Dilatable_base Cette classe represente un d&#39;un fluide dilatable, heritant de fluide bas...">Fluide_Dilatable_base</a>&amp; fluide_dil=<a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classFluide__Dilatable__base.html" title="classe Fluide_Dilatable_base Cette classe represente un d&#39;un fluide dilatable, heritant de fluide bas...">Fluide_Dilatable_base</a>,eqn.<a class="code" href="classNavier__Stokes__std.html#a442d8f1138c18da07aa895728b3e41f2" title="Renvoie le milieu physique de l&#39;equation (le Fluide_base upcaste en Milieu_base)">milieu</a>());
<a name="l00182"></a>00182   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; tab_rho_face_np1 = fluide_dil.<a class="code" href="classFluide__Dilatable__base.html#a29eacbad70e5894523fd7709d762dcf2">rho_face_np1</a>(), tab_rho_face_n=fluide_dil.<a class="code" href="classFluide__Dilatable__base.html#ae1cc5ec1ca08dc3269b171143ad3df39">rho_face_n</a>();
<a name="l00183"></a>00183   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_compo = present.<a class="code" href="classDoubleVect.html#ab02d01cd1bdab66fbd66f9a47cc29e10">line_size</a>();
<a name="l00184"></a>00184   <span class="keyword">const</span> <a class="code" href="classIntVect.html">IntVect</a>&amp; tab1 = mat_morse.<a class="code" href="classMatrice__Morse.html#a79b4e334152850bd36e53478debf3061">get_tab1</a>(), tab2 = mat_morse.<a class="code" href="classMatrice__Morse.html#a787b5a63f27063f9c891243d8f188cda">get_tab2</a>();
<a name="l00185"></a>00185 
<a name="l00186"></a>00186   <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; <a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a> = mat_morse.<a class="code" href="classMatrice__Morse.html#acd067e8514e5741f52b18a1d99746d11">get_set_coeff</a>();
<a name="l00187"></a>00187   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;mat_morse.<a class="code" href="classMatrice__Morse.html#a1f9bd6aedb226c86b7299689fa5b821a">nb_lignes</a>(); i++)
<a name="l00188"></a>00188     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=tab1(i)-1; k&lt;tab1(i+1)-1; k++)
<a name="l00189"></a>00189       {
<a name="l00190"></a>00190         <span class="keywordtype">int</span> j = tab2(k)-1;
<a name="l00191"></a>00191         <span class="keywordtype">double</span> rapport = tab_rho_face_np1(j/nb_compo);
<a name="l00192"></a>00192         <a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a>(k) /= rapport;
<a name="l00193"></a>00193       }
<a name="l00194"></a>00194 
<a name="l00195"></a>00195   <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#ad7b9506e7bda4dbde7ce4e4edca71298">rho_vitesse_impl</a>(tab_rho_face_np1,present,rhovitesse); <span class="comment">//!&lt; rho*U</span>
<a name="l00196"></a>00196 <span class="comment"></span>
<a name="l00197"></a>00197 <span class="comment">// Op conv</span>
<a name="l00198"></a>00198   eqn.<a class="code" href="classNavier__Stokes__std.html#a3ad069bdae3ec7e0ffb25319401480df" title="Renvoie le i-eme operateur de l&#39;equation: - le terme_diffusif si i = 0 - le terme_convectif si i = 1 ...">operateur</a>(1).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#a903e728aad8e2d490580bf264319d65f" title="NE FAIT RIEN A surcharger dans les classes derivees.">contribuer_a_avec</a>(rhovitesse,mat_morse);
<a name="l00199"></a>00199   eqn.<a class="code" href="classNavier__Stokes__std.html#a3ad069bdae3ec7e0ffb25319401480df" title="Renvoie le i-eme operateur de l&#39;equation: - le terme_diffusif si i = 0 - le terme_convectif si i = 1 ...">operateur</a>(1).<a class="code" href="classOperateur.html#accdf61cf1e33fb42e9eb06f1c501422b">ajouter</a>(rhovitesse,secmem);
<a name="l00200"></a>00200 
<a name="l00201"></a>00201 <span class="comment">// sources</span>
<a name="l00202"></a>00202   eqn.<a class="code" href="classEquation__base.html#a3c8ac50e3e7b6ed29024a43e828a5396" title="Renvoie les termes sources asssocies a l&#39;equation.">sources</a>().<a class="code" href="classSources.html#a6fc277f1920a71841cb041dc1b6ed771" title="Ajoute la contribution de toutes les sources de la liste au tableau passe en parametre, et renvoie ce tableau.">ajouter</a>(secmem);
<a name="l00203"></a>00203   eqn.<a class="code" href="classEquation__base.html#a3c8ac50e3e7b6ed29024a43e828a5396" title="Renvoie les termes sources asssocies a l&#39;equation.">sources</a>().<a class="code" href="classSources.html#aa91bceeb92650bc8b60a94f193a9d689" title="contribution a la matrice implicite des termes sources par defaut pas de contribution">contribuer_a_avec</a>(present,mat_morse);
<a name="l00204"></a>00204 
<a name="l00205"></a>00205 <span class="comment">// on resout en rho u on stocke donc rho u dans present</span>
<a name="l00206"></a>00206   <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#ad7b9506e7bda4dbde7ce4e4edca71298">rho_vitesse_impl</a>(tab_rho_face_np1,present,<a class="code" href="Cast_8h.html#ad3836a067c92103af8df5ad8f35959a6">ref_cast_non_const</a>(<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>,present));
<a name="l00207"></a>00207   mat_morse.<a class="code" href="classMatrice__Base.html#a6ccb4d20d3877cf09f5178ff72af5406" title="Operation de multiplication-accumulation (saxpy) matrice vecteur. Operation: r = r + A*x...">ajouter_multvect</a>(present,secmem);
<a name="l00208"></a>00208 
<a name="l00209"></a>00209   <span class="comment">/*</span>
<a name="l00210"></a>00210 <span class="comment">   * contribution a la matrice de l&#39;inertie :</span>
<a name="l00211"></a>00211 <span class="comment">   * on divisie la diagonale par rhon+1 face</span>
<a name="l00212"></a>00212 <span class="comment">   * on ajoute l&#39;inertie de facon standard</span>
<a name="l00213"></a>00213 <span class="comment">   * on remultiplie la diagonale par rhon+1</span>
<a name="l00214"></a>00214 <span class="comment">   */</span>
<a name="l00215"></a>00215 
<a name="l00216"></a>00216 <span class="comment">// ajout de l&#39;inertie</span>
<a name="l00217"></a>00217   <span class="keyword">const</span> <span class="keywordtype">double</span> dt=eqn.<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a0e4f67ef6086c09434ddc161668077b2" title="Renvoie le pas de temps (delta_t) courant.">pas_de_temps</a>();
<a name="l00218"></a>00218   eqn.<a class="code" href="classEquation__base.html#adfedf474c07a92f6b2261ca2f1cee80e" title="Renvoie le solveur de masse associe a l&#39;equation.">solv_masse</a>().<a class="code" href="classSolveur__Masse.html#adc554d2f7efe81e71ff8995d4f2df8c7">ajouter_masse</a>(dt,mat_morse,0);
<a name="l00219"></a>00219 
<a name="l00220"></a>00220   <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#ad7b9506e7bda4dbde7ce4e4edca71298">rho_vitesse_impl</a>(tab_rho_face_n,eqn.<a class="code" href="classNavier__Stokes__std.html#a743b777e6185faee7837326844c8fca1" title="Renvoie la vitesse (champ inconnue de l&#39;equation) (version const)">inconnue</a>().<a class="code" href="classChamp__Inc.html#ad4e16720f4575dceb8536c9f09635a3c" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps t-i.">passe</a>(),rhovitesse);
<a name="l00221"></a>00221   eqn.<a class="code" href="classEquation__base.html#adfedf474c07a92f6b2261ca2f1cee80e" title="Renvoie le solveur de masse associe a l&#39;equation.">solv_masse</a>().<a class="code" href="classSolveur__Masse.html#adc554d2f7efe81e71ff8995d4f2df8c7">ajouter_masse</a>(dt,secmem,rhovitesse,0);
<a name="l00222"></a>00222 
<a name="l00223"></a>00223 <span class="comment">// blocage_cl faux si dirichlet u!=0 !!!!!! manque multiplication par rho</span>
<a name="l00224"></a>00224   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> op=0; op&lt; eqn.<a class="code" href="classNavier__Stokes__std.html#ac7db452db8cfdb5f15bf971a47df82f1" title="Renvoie le nombre d&#39;operateurs de l&#39;equation: Pour Navier Stokes Standard c&#39;est 2.">nombre_d_operateurs</a>(); op++) eqn.<a class="code" href="classNavier__Stokes__std.html#a3ad069bdae3ec7e0ffb25319401480df" title="Renvoie le i-eme operateur de l&#39;equation: - le terme_diffusif si i = 0 - le terme_convectif si i = 1 ...">operateur</a>(op).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#a119798b1efa7c62fb28a53c20ccd105c" title="NE FAIT RIEN A surcharger dans les classes derivees.">modifier_pour_Cl</a>(mat_morse,secmem);
<a name="l00225"></a>00225 
<a name="l00226"></a>00226   <span class="comment">/*</span>
<a name="l00227"></a>00227 <span class="comment">   * correction finale pour les dirichlets</span>
<a name="l00228"></a>00228 <span class="comment">   * on ne doit pas imposer un+1 mais rho_un+1 =&gt; on multiplie dons le resu par rho_face_np1</span>
<a name="l00229"></a>00229 <span class="comment">   */</span>
<a name="l00230"></a>00230   <span class="keyword">const</span> <a class="code" href="classConds__lim.html">Conds_lim</a>&amp; lescl=eqn.<a class="code" href="classEquation__base.html#af265fe0ea30868eb2176a0c887e4efab" title="Renvoie la zone des conditions aux limite discretisee associee a l&#39;equation.">zone_Cl_dis</a>().<a class="code" href="classZone__Cl__dis.html#aafbd0525703e23200e31796bcd4fcac6" title="Appel a l&#39;objet sous-jacent Renvoie la i-ieme condition aux limites. (version const)">les_conditions_limites</a>();
<a name="l00231"></a>00231   <span class="keywordtype">int</span> nbcondlim=lescl.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>();
<a name="l00232"></a>00232 
<a name="l00233"></a>00233   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> icl=0; icl&lt;nbcondlim; icl++)
<a name="l00234"></a>00234     {
<a name="l00235"></a>00235       <span class="keyword">const</span> <a class="code" href="classCond__lim__base.html" title="classe Cond_lim_base Classe de base pour la hierarchie des classes qui representent les differentes c...">Cond_lim_base</a>&amp; la_cl_base = lescl[icl].valeur();
<a name="l00236"></a>00236       <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classDirichlet.html" title="classe Dirichlet Cette classe est la classe de base de la hierarchie des conditions aux limites de ty...">Dirichlet</a>,la_cl_base))
<a name="l00237"></a>00237         {
<a name="l00238"></a>00238 
<a name="l00239"></a>00239           <span class="keyword">const</span> <a class="code" href="classFront__VF.html" title="class Front_VF">Front_VF</a>&amp; la_front_dis = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classFront__VF.html" title="class Front_VF">Front_VF</a>,la_cl_base.<a class="code" href="classCond__lim__base.html#ad88b3b516351146c85e8fce1df0f691a" title="Renvoie la frontiere discretisee a laquelle les conditions aux limites s&#39;appliquent.">frontiere_dis</a>());
<a name="l00240"></a>00240           <span class="keywordtype">int</span> ndeb = la_front_dis.<a class="code" href="classFront__VF.html#a4986f0c65653fe9eb40bbbff5a97bf16" title="Numero de la premiere face du bord dans la liste des faces.">num_premiere_face</a>();
<a name="l00241"></a>00241           <span class="keywordtype">int</span> nfin = ndeb + la_front_dis.<a class="code" href="classFront__VF.html#a341e2fcb5117b96e745fd7078ba86bab" title="Nombre de faces reelles du bord.">nb_faces</a>();
<a name="l00242"></a>00242           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> num_face=ndeb; num_face&lt;nfin; num_face++)
<a name="l00243"></a>00243             {
<a name="l00244"></a>00244               <span class="keywordflow">if</span> (present.<a class="code" href="classDoubleVect.html#ab02d01cd1bdab66fbd66f9a47cc29e10">line_size</a>()==1) secmem(num_face)*=tab_rho_face_np1(num_face);
<a name="l00245"></a>00245               <span class="keywordflow">else</span>
<a name="l00246"></a>00246                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> dir=0; dir&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">Objet_U::dimension</a>; dir++) secmem(num_face,dir)*=tab_rho_face_np1(num_face);
<a name="l00247"></a>00247             }
<a name="l00248"></a>00248         }
<a name="l00249"></a>00249     }
<a name="l00250"></a>00250 }
<a name="l00251"></a>00251 
<a name="l00252"></a><a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#ae965269c96ba2459cdff24ea699ee641">00252</a> <span class="keywordtype">void</span> <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#ae965269c96ba2459cdff24ea699ee641">Navier_Stokes_Fluide_Dilatable_Proto::assembler_impl</a>( <a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a>&amp; mat_morse, <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; present, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; secmem)
<a name="l00253"></a>00253 {
<a name="l00254"></a>00254   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Navier_Stokes_Fluide_Dilatable_Proto::assembler is not coded ! You should use assembler_avec_inertie !&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00255"></a>00255   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00256"></a>00256 }
<a name="l00257"></a>00257 
<a name="l00258"></a>00258 <span class="comment">/*</span>
<a name="l00259"></a>00259 <span class="comment"> * ***************</span>
<a name="l00260"></a>00260 <span class="comment"> * Private methods</span>
<a name="l00261"></a>00261 <span class="comment"> * ***************</span>
<a name="l00262"></a>00262 <span class="comment"> */</span>
<a name="l00263"></a><a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#aa5039c9c3c958b1fc4cb8facddf543a4">00263</a> <span class="keywordtype">void</span> <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#aa5039c9c3c958b1fc4cb8facddf543a4">Navier_Stokes_Fluide_Dilatable_Proto::prepare_and_solve_u_star</a>(<a class="code" href="classNavier__Stokes__std.html" title="classe Navier_Stokes_std Cette classe porte les termes de l&#39;equation de la dynamique pour un fluide s...">Navier_Stokes_std</a>&amp; eqn,
<a name="l00264"></a>00264                                                                     <span class="keyword">const</span> <a class="code" href="classFluide__Dilatable__base.html" title="classe Fluide_Dilatable_base Cette classe represente un d&#39;un fluide dilatable, heritant de fluide bas...">Fluide_Dilatable_base</a>&amp; fluide_dil,
<a name="l00265"></a>00265                                                                     <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; rhoU, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; vpoint)
<a name="l00266"></a>00266 {
<a name="l00267"></a>00267   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; tab_rho_face_n =fluide_dil.<a class="code" href="classFluide__Dilatable__base.html#ae1cc5ec1ca08dc3269b171143ad3df39">rho_face_n</a>(), tab_rho_face_np1=fluide_dil.<a class="code" href="classFluide__Dilatable__base.html#a29eacbad70e5894523fd7709d762dcf2">rho_face_np1</a>();
<a name="l00268"></a>00268   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; tab_rho = fluide_dil.<a class="code" href="classFluide__Dilatable__base.html#a24fce1665e4890c748db49973c0f7fee">rho_discvit</a>(); <span class="comment">//!&lt; rho avec la meme discretisation que la vitesse</span>
<a name="l00269"></a>00269 <span class="comment"></span>  <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; vit = eqn.<a class="code" href="classNavier__Stokes__std.html#ab831017616b67792f562fea81f1e5dce">vitesse</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>();
<a name="l00270"></a>00270 
<a name="l00271"></a>00271   fluide_dil.<a class="code" href="classFluide__Dilatable__base.html#a881172acb09944046107e7c87e8fdcaf">secmembre_divU_Z</a>(<a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#ab224b13eb4a2fa008b3ba02e314db03c" title="RHS of div(rho.U)">tab_W</a>); <span class="comment">//Calcule W=-dZ/dt, 2nd membre de l&#39;equation div(rhoU) = W</span>
<a name="l00272"></a>00272   vpoint=0;
<a name="l00273"></a>00273 
<a name="l00274"></a>00274 <span class="comment">// ajout diffusion (avec la viscosite dynamique)</span>
<a name="l00275"></a>00275   <span class="keywordflow">if</span> (!eqn.<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#af19143270478f1a870292550da641a94" title="Renvoie 1 si le schema en temps a ete lu diffusion_implicite.">diffusion_implicite</a>()) eqn.<a class="code" href="classNavier__Stokes__std.html#a3ad069bdae3ec7e0ffb25319401480df" title="Renvoie le i-eme operateur de l&#39;equation: - le terme_diffusif si i = 0 - le terme_convectif si i = 1 ...">operateur</a>(0).<a class="code" href="classOperateur.html#accdf61cf1e33fb42e9eb06f1c501422b">ajouter</a>(vpoint);
<a name="l00276"></a>00276 
<a name="l00277"></a>00277   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; rhovitesse = <a class="code" href="Cast_8h.html#ad3836a067c92103af8df5ad8f35959a6">ref_cast_non_const</a>(<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>,eqn.<a class="code" href="classNavier__Stokes__std.html#a1de05cd8d0ca7595e1c1c0e80ca7f8ab">rho_la_vitesse</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>());
<a name="l00278"></a>00278   <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#ad7b9506e7bda4dbde7ce4e4edca71298">rho_vitesse_impl</a>(tab_rho,vit,rhovitesse);
<a name="l00279"></a>00279 
<a name="l00280"></a>00280 <span class="comment">// ajout convection utilise rhovitesse</span>
<a name="l00281"></a>00281   <span class="keywordflow">if</span> (!eqn.<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#af19143270478f1a870292550da641a94" title="Renvoie 1 si le schema en temps a ete lu diffusion_implicite.">diffusion_implicite</a>()) eqn.<a class="code" href="classNavier__Stokes__std.html#a3ad069bdae3ec7e0ffb25319401480df" title="Renvoie le i-eme operateur de l&#39;equation: - le terme_diffusif si i = 0 - le terme_convectif si i = 1 ...">operateur</a>(1).<a class="code" href="classOperateur.html#accdf61cf1e33fb42e9eb06f1c501422b">ajouter</a>(rhovitesse,vpoint);
<a name="l00282"></a>00282   <span class="keywordflow">else</span>
<a name="l00283"></a>00283     {
<a name="l00284"></a>00284       <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> trav(vpoint);
<a name="l00285"></a>00285       eqn.<a class="code" href="classEquation__base.html#a20d04d53bd0c4b48aa923c2b328bb1e3" title="Add convection term In: solution is the unknown I Out: secmem is increased by convection(I)">derivee_en_temps_conv</a>(trav,rhovitesse);
<a name="l00286"></a>00286       vpoint = trav;
<a name="l00287"></a>00287     }
<a name="l00288"></a>00288 
<a name="l00289"></a>00289 <span class="comment">// ajout source</span>
<a name="l00290"></a>00290   eqn.<a class="code" href="classEquation__base.html#a3c8ac50e3e7b6ed29024a43e828a5396" title="Renvoie les termes sources asssocies a l&#39;equation.">sources</a>().<a class="code" href="classSources.html#a6fc277f1920a71841cb041dc1b6ed771" title="Ajoute la contribution de toutes les sources de la liste au tableau passe en parametre, et renvoie ce tableau.">ajouter</a>(vpoint);
<a name="l00291"></a>00291 
<a name="l00292"></a>00292 <span class="comment">// ajout de gradP</span>
<a name="l00293"></a>00293   eqn.<a class="code" href="classNavier__Stokes__std.html#a8fc2b544594acef9cc31ff48e5184c47" title="Add a specific term for Navier Stokes (-gradP(n)) if necessary.">corriger_derivee_expl</a>(vpoint);
<a name="l00294"></a>00294 
<a name="l00295"></a>00295   <span class="keyword">const</span> <a class="code" href="classChamp__base.html" title="classe Champ_base Cette classe est la base de la hierarchie des champs. Ses membres sont les attribut...">Champ_base</a>&amp; rho_vit=eqn.<a class="code" href="classNavier__Stokes__std.html#a18eccb9461a019135740a00f5e3dbec1">get_champ</a>(<span class="stringliteral">&quot;rho_comme_v&quot;</span>);
<a name="l00296"></a>00296   <a class="code" href="Cast_8h.html#ad3836a067c92103af8df5ad8f35959a6">ref_cast_non_const</a>(<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>,rho_vit.<a class="code" href="classChamp__Proto.html#a9d8c69f11d1b0a8e378cc6ca41793614">valeurs</a>())=tab_rho_face_np1;
<a name="l00297"></a>00297 
<a name="l00298"></a>00298   <span class="keywordflow">if</span> (eqn.<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#af19143270478f1a870292550da641a94" title="Renvoie 1 si le schema en temps a ete lu diffusion_implicite.">diffusion_implicite</a>())
<a name="l00299"></a>00299     {
<a name="l00300"></a>00300       <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> secmemV(vpoint);
<a name="l00301"></a>00301       secmemV = vpoint;
<a name="l00302"></a>00302       <span class="keywordtype">double</span> dt = eqn.<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a0e4f67ef6086c09434ddc161668077b2" title="Renvoie le pas de temps (delta_t) courant.">pas_de_temps</a>();
<a name="l00303"></a>00303       <span class="comment">/*</span>
<a name="l00304"></a>00304 <span class="comment">       * secmemV contient M(rhonp1 unp1 -rhon un)/dt</span>
<a name="l00305"></a>00305 <span class="comment">       * M-1 secmemv*dt+rhon un -rhonp1un= rhonp1 (unp1 -unp )</span>
<a name="l00306"></a>00306 <span class="comment">       * dt/rhnhonp1 =(unp1-un)/dt</span>
<a name="l00307"></a>00307 <span class="comment">       * M-1 secmemV/rhonp1 + (rhon  -rhonp1)/rhonp1/dt  un</span>
<a name="l00308"></a>00308 <span class="comment">       *</span>
<a name="l00309"></a>00309 <span class="comment">       * on modifie le solveur masse pour diviser par rhonp1</span>
<a name="l00310"></a>00310 <span class="comment">       * (pratique aussi pour la diffusion implicite)</span>
<a name="l00311"></a>00311 <span class="comment">       */</span>
<a name="l00312"></a>00312 
<a name="l00313"></a>00313       eqn.<a class="code" href="classEquation__base.html#adfedf474c07a92f6b2261ca2f1cee80e" title="Renvoie le solveur de masse associe a l&#39;equation.">solv_masse</a>()-&gt;set_name_of_coefficient_temporel(<span class="stringliteral">&quot;rho_comme_v&quot;</span>);
<a name="l00314"></a>00314       eqn.<a class="code" href="classEquation__base.html#adfedf474c07a92f6b2261ca2f1cee80e" title="Renvoie le solveur de masse associe a l&#39;equation.">solv_masse</a>().<a class="code" href="classSolveur__Masse.html#af7afe8c2d4d5764f7428f2cd4ef43ddb" title="Appel a l&#39;objet sous-jacent. Resoud le systeme lineaire, dont la matrice est la matrice de masse...">appliquer</a>(secmemV);
<a name="l00315"></a>00315       <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> dr(tab_rho_face_n);
<a name="l00316"></a>00316       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;dr.<a class="code" href="classDoubleVect.html#ad2d21b364e1c6559771970596a25c006" title="Identique a size_array()">size_totale</a>(); i++) dr(i)=(tab_rho_face_n(i)/tab_rho_face_np1(i)-1.)/dt;
<a name="l00317"></a>00317 
<a name="l00318"></a>00318 <span class="comment">// on sert de vpoint pour calculer</span>
<a name="l00319"></a>00319       <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#ad7b9506e7bda4dbde7ce4e4edca71298">rho_vitesse_impl</a>(dr,vit,vpoint);
<a name="l00320"></a>00320       secmemV += vpoint;
<a name="l00321"></a>00321 
<a name="l00322"></a>00322       <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> delta_u(eqn.<a class="code" href="classNavier__Stokes__std.html#a743b777e6185faee7837326844c8fca1" title="Renvoie la vitesse (champ inconnue de l&#39;equation) (version const)">inconnue</a>().<a class="code" href="classChamp__Inc.html#a518c3eb1e7a249ae0fc4d1a4e0d072d0" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps t+i.">futur</a>());
<a name="l00323"></a>00323       eqn.<a class="code" href="classEquation__base.html#abd67532530f67b3305703a130a5d823a">Gradient_conjugue_diff_impl</a>(secmemV, delta_u ) ;
<a name="l00324"></a>00324 
<a name="l00325"></a>00325       <span class="comment">/*</span>
<a name="l00326"></a>00326 <span class="comment">       * delta_u=unp1 -un =&gt; delta_u + un=unp1</span>
<a name="l00327"></a>00327 <span class="comment">       * (delat_u + un)*rhonp1 = rhonp1 * unp1</span>
<a name="l00328"></a>00328 <span class="comment">       * (delat_u + un)*rhonp1  - rhon * un= rhonp1 * unp1 - rhon * un</span>
<a name="l00329"></a>00329 <span class="comment">       */</span>
<a name="l00330"></a>00330 
<a name="l00331"></a>00331       delta_u *= dt;
<a name="l00332"></a>00332       delta_u += vit;
<a name="l00333"></a>00333       <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#ad7b9506e7bda4dbde7ce4e4edca71298">rho_vitesse_impl</a>(tab_rho_face_np1,delta_u,vpoint);
<a name="l00334"></a>00334       vpoint -= rhovitesse;
<a name="l00335"></a>00335       vpoint /= dt;
<a name="l00336"></a>00336       eqn.<a class="code" href="classEquation__base.html#adfedf474c07a92f6b2261ca2f1cee80e" title="Renvoie le solveur de masse associe a l&#39;equation.">solv_masse</a>()-&gt;set_name_of_coefficient_temporel(<span class="stringliteral">&quot;no_coeff&quot;</span>);
<a name="l00337"></a>00337     }
<a name="l00338"></a>00338   <span class="keywordflow">else</span> eqn.<a class="code" href="classEquation__base.html#adfedf474c07a92f6b2261ca2f1cee80e" title="Renvoie le solveur de masse associe a l&#39;equation.">solv_masse</a>().<a class="code" href="classSolveur__Masse.html#af7afe8c2d4d5764f7428f2cd4ef43ddb" title="Appel a l&#39;objet sous-jacent. Resoud le systeme lineaire, dont la matrice est la matrice de masse...">appliquer</a>(vpoint);
<a name="l00339"></a>00339 
<a name="l00340"></a>00340   <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#ae6ca864f68a9e973a487ab3ec5396374">update_vpoint_on_boundaries</a>(eqn,fluide_dil,vpoint);
<a name="l00341"></a>00341 
<a name="l00342"></a>00342 } <span class="comment">/* END prepare_and_solve_u_star */</span>
<a name="l00343"></a>00343 
<a name="l00344"></a><a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#ae6ca864f68a9e973a487ab3ec5396374">00344</a> <span class="keywordtype">void</span> <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#ae6ca864f68a9e973a487ab3ec5396374">Navier_Stokes_Fluide_Dilatable_Proto::update_vpoint_on_boundaries</a>(<span class="keyword">const</span> <a class="code" href="classNavier__Stokes__std.html" title="classe Navier_Stokes_std Cette classe porte les termes de l&#39;equation de la dynamique pour un fluide s...">Navier_Stokes_std</a>&amp; eqn,
<a name="l00345"></a>00345                                                                        <span class="keyword">const</span> <a class="code" href="classFluide__Dilatable__base.html" title="classe Fluide_Dilatable_base Cette classe represente un d&#39;un fluide dilatable, heritant de fluide bas...">Fluide_Dilatable_base</a>&amp; fluide_dil,
<a name="l00346"></a>00346                                                                        <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; vpoint)
<a name="l00347"></a>00347 {
<a name="l00348"></a>00348 <span class="comment">// on ajoute durho/dt au bord Dirichlet car les solveur masse a mis a zero</span>
<a name="l00349"></a>00349 <span class="comment">// NOTE : en incompressible le terme est rajoute par modifier_secmem</span>
<a name="l00350"></a>00350   <span class="keyword">const</span> <span class="keywordtype">double</span> dt_ = eqn.<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a0e4f67ef6086c09434ddc161668077b2" title="Renvoie le pas de temps (delta_t) courant.">pas_de_temps</a>();
<a name="l00351"></a>00351   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; tab_rho_face_n =fluide_dil.<a class="code" href="classFluide__Dilatable__base.html#ae1cc5ec1ca08dc3269b171143ad3df39">rho_face_n</a>(), tab_rho_face_np1=fluide_dil.<a class="code" href="classFluide__Dilatable__base.html#a29eacbad70e5894523fd7709d762dcf2">rho_face_np1</a>();
<a name="l00352"></a>00352   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; vit = eqn.<a class="code" href="classNavier__Stokes__std.html#ab831017616b67792f562fea81f1e5dce">vitesse</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>();
<a name="l00353"></a>00353   <span class="keyword">const</span> <a class="code" href="classConds__lim.html">Conds_lim</a>&amp; lescl=eqn.<a class="code" href="classEquation__base.html#af265fe0ea30868eb2176a0c887e4efab" title="Renvoie la zone des conditions aux limite discretisee associee a l&#39;equation.">zone_Cl_dis</a>().<a class="code" href="classZone__Cl__dis.html#aafbd0525703e23200e31796bcd4fcac6" title="Appel a l&#39;objet sous-jacent Renvoie la i-ieme condition aux limites. (version const)">les_conditions_limites</a>();
<a name="l00354"></a>00354   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; face_voisins = eqn.<a class="code" href="classEquation__base.html#a12d97ae801edc18f614523677921346e" title="Renvoie la zone discretisee associee a l&#39;equation.">zone_dis</a>().<a class="code" href="classDeriv__Zone__dis__base.html#a30ff47fc0684fe134e8c74c35b268941">valeur</a>().<a class="code" href="classZone__dis__base.html#a5ae23109f0dbc1b9d4dd99e76ec3297f">face_voisins</a>();
<a name="l00355"></a>00355   <span class="keyword">const</span> <span class="keywordtype">int</span> nbcondlim = lescl.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>(), taille = vpoint.<a class="code" href="classDoubleVect.html#ab02d01cd1bdab66fbd66f9a47cc29e10">line_size</a>();
<a name="l00356"></a>00356 
<a name="l00357"></a>00357   <span class="keywordflow">if</span> (taille==1)
<a name="l00358"></a>00358     <span class="keywordflow">if</span> (<a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#acca173f86d33011d9eb6be9017c09b56">orientation_VDF_</a>.<a class="code" href="classIntVect.html#ad90cfd411cbbd631ccf1935bb36f7c40" title="Identique a size_reelle()">size</a>() == 0)
<a name="l00359"></a>00359       <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#acca173f86d33011d9eb6be9017c09b56">orientation_VDF_</a>.<a class="code" href="classIntVect.html#a165455689c6d27ac93c9cf8823e47a0f" title="detache le tableau et l&#39;attache a v (sauf si v==*this, ne fait rien) Fait pointer le tableau sur la m...">ref</a>(<a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>,eqn.<a class="code" href="classEquation__base.html#a12d97ae801edc18f614523677921346e" title="Renvoie la zone discretisee associee a l&#39;equation.">zone_dis</a>().<a class="code" href="classDeriv__Zone__dis__base.html#a30ff47fc0684fe134e8c74c35b268941">valeur</a>()).orientation());
<a name="l00360"></a>00360 
<a name="l00361"></a>00361   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> icl=0; icl&lt;nbcondlim; icl++)
<a name="l00362"></a>00362     {
<a name="l00363"></a>00363       <span class="keyword">const</span> <a class="code" href="classCond__lim__base.html" title="classe Cond_lim_base Classe de base pour la hierarchie des classes qui representent les differentes c...">Cond_lim_base</a>&amp; la_cl_base = lescl[icl].valeur();
<a name="l00364"></a>00364       <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classDirichlet.html" title="classe Dirichlet Cette classe est la classe de base de la hierarchie des conditions aux limites de ty...">Dirichlet</a>,la_cl_base))
<a name="l00365"></a>00365         {
<a name="l00366"></a>00366           <span class="keyword">const</span> <a class="code" href="classFront__VF.html" title="class Front_VF">Front_VF</a>&amp; la_front_dis = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classFront__VF.html" title="class Front_VF">Front_VF</a>,la_cl_base.<a class="code" href="classCond__lim__base.html#ad88b3b516351146c85e8fce1df0f691a" title="Renvoie la frontiere discretisee a laquelle les conditions aux limites s&#39;appliquent.">frontiere_dis</a>());
<a name="l00367"></a>00367           <span class="keyword">const</span> <a class="code" href="classDirichlet.html" title="classe Dirichlet Cette classe est la classe de base de la hierarchie des conditions aux limites de ty...">Dirichlet</a>&amp; diri=<a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classDirichlet.html" title="classe Dirichlet Cette classe est la classe de base de la hierarchie des conditions aux limites de ty...">Dirichlet</a>,la_cl_base);
<a name="l00368"></a>00368           <span class="keyword">const</span> <span class="keywordtype">int</span> ndeb = la_front_dis.<a class="code" href="classFront__VF.html#a4986f0c65653fe9eb40bbbff5a97bf16" title="Numero de la premiere face du bord dans la liste des faces.">num_premiere_face</a>(), nfin = ndeb + la_front_dis.<a class="code" href="classFront__VF.html#a341e2fcb5117b96e745fd7078ba86bab" title="Nombre de faces reelles du bord.">nb_faces</a>();
<a name="l00369"></a>00369 
<a name="l00370"></a>00370           <span class="keywordflow">if</span> (taille==1) <span class="comment">//!&lt; VDF //</span>
<a name="l00371"></a>00371 <span class="comment"></span>            {
<a name="l00372"></a>00372               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> num_face=ndeb; num_face&lt;nfin; num_face++)
<a name="l00373"></a>00373                 {
<a name="l00374"></a>00374                   <span class="keywordtype">int</span> n0 = face_voisins(num_face, 0);
<a name="l00375"></a>00375                   <span class="keywordflow">if</span> (n0 == -1) n0 = face_voisins(num_face, 1);
<a name="l00376"></a>00376 
<a name="l00377"></a>00377 <span class="comment">// GF en cas de diffsion implicite vpoint!=0 on ignrore l&#39;ancienne valeur</span>
<a name="l00378"></a>00378                   vpoint(num_face)=(diri.val_imp(num_face-ndeb,<a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#acca173f86d33011d9eb6be9017c09b56">orientation_VDF_</a>(num_face))*tab_rho_face_np1(num_face)-
<a name="l00379"></a>00379                                     vit(num_face)*tab_rho_face_n(num_face))/dt_;
<a name="l00380"></a>00380                 }
<a name="l00381"></a>00381             }
<a name="l00382"></a>00382           <span class="keywordflow">else</span> <span class="comment">//!&lt; VEF //</span>
<a name="l00383"></a>00383 <span class="comment"></span>            {
<a name="l00384"></a>00384               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> num_face=ndeb; num_face&lt;nfin; num_face++)
<a name="l00385"></a>00385                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> jj=0; jj&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">Objet_U::dimension</a>; jj++)
<a name="l00386"></a>00386                   {
<a name="l00387"></a>00387 <span class="comment">// GF en cas de diffsion implicite vpoint!=0 on ignrore l&#39;ancienne valeur</span>
<a name="l00388"></a>00388                     vpoint(num_face,jj)=(tab_rho_face_np1(num_face)*diri.val_imp(num_face-ndeb,jj)
<a name="l00389"></a>00389                                          -tab_rho_face_n(num_face)*vit(num_face,jj))/dt_;
<a name="l00390"></a>00390                   }
<a name="l00391"></a>00391             }
<a name="l00392"></a>00392         }
<a name="l00393"></a>00393     }
<a name="l00394"></a>00394 
<a name="l00395"></a>00395 } <span class="comment">/* END update_vpoint_on_boundaries */</span>
<a name="l00396"></a>00396 
<a name="l00397"></a><a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#a80fc279cfb275b0fce12a8110906a14b">00397</a> <span class="keywordtype">void</span> <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#a80fc279cfb275b0fce12a8110906a14b">Navier_Stokes_Fluide_Dilatable_Proto::solve_pressure_increment</a>(<a class="code" href="classNavier__Stokes__std.html" title="classe Navier_Stokes_std Cette classe porte les termes de l&#39;equation de la dynamique pour un fluide s...">Navier_Stokes_std</a>&amp; eqn,
<a name="l00398"></a>00398                                                                     <span class="keyword">const</span> <a class="code" href="classFluide__Dilatable__base.html" title="classe Fluide_Dilatable_base Cette classe represente un d&#39;un fluide dilatable, heritant de fluide bas...">Fluide_Dilatable_base</a>&amp; fluide_dil,
<a name="l00399"></a>00399                                                                     <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; rhoU, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; secmem,
<a name="l00400"></a>00400                                                                     <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; inc_pre, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; vpoint)
<a name="l00401"></a>00401 {
<a name="l00402"></a>00402   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; tab_rho_face_n =fluide_dil.<a class="code" href="classFluide__Dilatable__base.html#ae1cc5ec1ca08dc3269b171143ad3df39">rho_face_n</a>(), tab_rho_face_np1=fluide_dil.<a class="code" href="classFluide__Dilatable__base.html#a29eacbad70e5894523fd7709d762dcf2">rho_face_np1</a>();
<a name="l00403"></a>00403   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; vit = eqn.<a class="code" href="classNavier__Stokes__std.html#ab831017616b67792f562fea81f1e5dce">vitesse</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>();
<a name="l00404"></a>00404   <span class="keyword">const</span> <span class="keywordtype">double</span> dt_ = eqn.<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a0e4f67ef6086c09434ddc161668077b2" title="Renvoie le pas de temps (delta_t) courant.">pas_de_temps</a>(),t = eqn.<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a5054df01edb6d4f7baec7e612d423834" title="Renvoie le temps courant.">temps_courant</a>();
<a name="l00405"></a>00405 
<a name="l00406"></a>00406 <span class="comment">// Resolution pression</span>
<a name="l00407"></a>00407   vpoint.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l00408"></a>00408 
<a name="l00409"></a>00409 <span class="comment">// Compute rhoU(n) :</span>
<a name="l00410"></a>00410   <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#ad7b9506e7bda4dbde7ce4e4edca71298">rho_vitesse_impl</a>(tab_rho_face_n,vit,rhoU);
<a name="l00411"></a>00411 
<a name="l00412"></a>00412 <span class="comment">// Add source term to vpoint if interfaces</span>
<a name="l00413"></a>00413   <a class="code" href="classProbleme__base.html" title="classe Probleme_base C&#39;est un Probleme_U qui n&#39;est pas un couplage. Le role d&#39;un Probleme_base est la...">Probleme_base</a>&amp; prob=eqn.<a class="code" href="classEquation__base.html#aa8151a96f63719523bf50ddd832e0f8f" title="Renvoie le probleme associe a l&#39;equation.">probleme</a>();
<a name="l00414"></a>00414   <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> vpoint0(vpoint) ;
<a name="l00415"></a>00415   vpoint0 = vpoint ;
<a name="l00416"></a>00416   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;prob.<a class="code" href="classProbleme__base.html#abefceb0ac0d0b35d42a4daaa82a95f59">nombre_d_equations</a>(); i++)
<a name="l00417"></a>00417     <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classTransport__Interfaces__base.html" title="classe Transport_Interfaces_base Cette classe constitue la classe de base des equations de transport ...">Transport_Interfaces_base</a>,prob.<a class="code" href="classProbleme__base.html#ae97586575b7e510d7945ce3a894b806a">equation</a>(i)))
<a name="l00418"></a>00418       {
<a name="l00419"></a>00419         <a class="code" href="classTransport__Interfaces__base.html" title="classe Transport_Interfaces_base Cette classe constitue la classe de base des equations de transport ...">Transport_Interfaces_base</a>&amp; eq_transport = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classTransport__Interfaces__base.html" title="classe Transport_Interfaces_base Cette classe constitue la classe de base des equations de transport ...">Transport_Interfaces_base</a>,prob.<a class="code" href="classProbleme__base.html#ae97586575b7e510d7945ce3a894b806a">equation</a>(i));
<a name="l00420"></a>00420         <span class="keyword">const</span> <span class="keywordtype">int</span> nb = vpoint.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0), m = vpoint.<a class="code" href="classDoubleVect.html#ab02d01cd1bdab66fbd66f9a47cc29e10">line_size</a>();
<a name="l00421"></a>00421         <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> source_ibc(nb,m);
<a name="l00422"></a>00422 
<a name="l00423"></a>00423 <span class="comment">// On ajoute un terme source a vpoint pour imposer au fluide la vitesse de l interface</span>
<a name="l00424"></a>00424 <span class="comment">// source_ibc est local pas postraitable (different cas FT ou le terme source est defini et peut etre postraite)</span>
<a name="l00425"></a>00425         eq_transport.<a class="code" href="classTransport__Interfaces__base.html#a822ee006a29e2a1046af359f6e19aee3">modifier_vpoint_pour_imposer_vit</a>(rhoU,vpoint0,vpoint,tab_rho_face_np1,source_ibc,t,dt_);
<a name="l00426"></a>00426       }
<a name="l00427"></a>00427 
<a name="l00428"></a>00428   secmem = <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#ab224b13eb4a2fa008b3ba02e314db03c" title="RHS of div(rho.U)">tab_W</a>;
<a name="l00429"></a>00429   <a class="code" href="DoubleVect_8cpp.html#a037eedbd9167441dbd379675d4b2fe55">operator_negate</a>(secmem);
<a name="l00430"></a>00430   eqn.<a class="code" href="classNavier__Stokes__std.html#a614d41350181667ee295b87a72779c1a" title="Renvoie l&#39;operateur de calcul de la divergence associe a l&#39;equation.">operateur_divergence</a>().<a class="code" href="classOperateur__Div.html#aeb7f9d269b7d93314ce9583f0fa1f57d" title="Ajoute la contribution de l&#39;operateur au tableau passe en parametre.">ajouter</a>(rhoU,secmem);
<a name="l00431"></a>00431   secmem /= dt_; <span class="comment">//!&lt; (-tabW + Div(rhoU))/dt</span>
<a name="l00432"></a>00432 <span class="comment"></span>
<a name="l00433"></a>00433   eqn.<a class="code" href="classNavier__Stokes__std.html#a614d41350181667ee295b87a72779c1a" title="Renvoie l&#39;operateur de calcul de la divergence associe a l&#39;equation.">operateur_divergence</a>().<a class="code" href="classOperateur__Div.html#aeb7f9d269b7d93314ce9583f0fa1f57d" title="Ajoute la contribution de l&#39;operateur au tableau passe en parametre.">ajouter</a>(vpoint, secmem);
<a name="l00434"></a>00434   secmem *= -1;
<a name="l00435"></a>00435   secmem.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l00436"></a>00436   <a class="code" href="Op__Div__VEFP1B__Elem_8cpp.html#a45261662b3b88d5db461b3fc99246e5a">Debog::verifier</a>(<span class="stringliteral">&quot;Navier_Stokes_Fluide_Dilatable_base::derivee_en_temps_inco, secmem : &quot;</span>, secmem);
<a name="l00437"></a>00437 
<a name="l00438"></a>00438 <span class="comment">// On ne fait appel qu une seule fois a assembler dans preparer calcul (au lieu de assembler_QC)</span>
<a name="l00439"></a>00439 <span class="comment">// Correction du second membre d&#39;apres les conditions aux limites :</span>
<a name="l00440"></a>00440   eqn.<a class="code" href="classNavier__Stokes__std.html#af9f5e0396945755597f147bd424a4a08">assembleur_pression</a>().<a class="code" href="classAssembleur.html#abac307565fa214099f111a015e1cda3f" title="Appel a l&#39;objet sous-jacent. Permet de modifier le second membre du systeme Modifie egalement la solu...">modifier_secmem</a>(secmem);
<a name="l00441"></a>00441   eqn.<a class="code" href="classNavier__Stokes__std.html#ae83d9f7a42531293583f32be1efd3d5f" title="Renvoie le solveur en pression&lt;br&gt;(version const)">solveur_pression</a>().<a class="code" href="classSolveurSys.html#a62ca198f0c5dc599e53b0535761e5138">resoudre_systeme</a>(eqn.<a class="code" href="classNavier__Stokes__std.html#ade0331e225bfe2c312d4917eb127e3cd">matrice_pression</a>().<a class="code" href="classDeriv__Matrice__Base.html#ae43f3a90ca16518c191f9e7d5ebef912">valeur</a>(),secmem,inc_pre);
<a name="l00442"></a>00442 
<a name="l00443"></a>00443 } <span class="comment">/* END  solve_pressure_increment */</span>
<a name="l00444"></a>00444 
<a name="l00445"></a><a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#a9ba1bb0772471d97f38b08efceea4aa8">00445</a> <span class="keywordtype">void</span> <a class="code" href="classNavier__Stokes__Fluide__Dilatable__Proto.html#a9ba1bb0772471d97f38b08efceea4aa8">Navier_Stokes_Fluide_Dilatable_Proto::correct_and_compute_u_np1</a>(<a class="code" href="classNavier__Stokes__std.html" title="classe Navier_Stokes_std Cette classe porte les termes de l&#39;equation de la dynamique pour un fluide s...">Navier_Stokes_std</a>&amp; eqn,
<a name="l00446"></a>00446                                                                      <span class="keyword">const</span> <a class="code" href="classFluide__Dilatable__base.html" title="classe Fluide_Dilatable_base Cette classe represente un d&#39;un fluide dilatable, heritant de fluide bas...">Fluide_Dilatable_base</a>&amp; fluide_dil,
<a name="l00447"></a>00447                                                                      <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; rhoU,<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; Mmoins1grad,
<a name="l00448"></a>00448                                                                      <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; inc_pre,<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; gradP,
<a name="l00449"></a>00449                                                                      <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; vpoint)
<a name="l00450"></a>00450 {
<a name="l00451"></a>00451   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; tab_rho_face_np1=fluide_dil.<a class="code" href="classFluide__Dilatable__base.html#a29eacbad70e5894523fd7709d762dcf2">rho_face_np1</a>();
<a name="l00452"></a>00452   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; vit = eqn.<a class="code" href="classNavier__Stokes__std.html#ab831017616b67792f562fea81f1e5dce">vitesse</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>();
<a name="l00453"></a>00453   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; press = eqn.<a class="code" href="classNavier__Stokes__std.html#afbb8f39bdfd70328dfad21bf2b9dd45a" title="Renvoie le champ de pression.">pression</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>();
<a name="l00454"></a>00454   <span class="keyword">const</span> <span class="keywordtype">double</span> dt_ = eqn.<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a0e4f67ef6086c09434ddc161668077b2" title="Renvoie le pas de temps (delta_t) courant.">pas_de_temps</a>();
<a name="l00455"></a>00455 
<a name="l00456"></a>00456 <span class="comment">// On a besoin de l&#39;espace virtuel de la pression pour calculer le gradient plus bas</span>
<a name="l00457"></a>00457 <span class="comment">// et modifier_solution ne fait pas toujours l&#39;echange_espace_virtuel.</span>
<a name="l00458"></a>00458 <span class="comment">// On suppose que pression et inc_pre ont leur espace virtuel a jour</span>
<a name="l00459"></a>00459 <span class="comment">// On fait pression += inc_pre:</span>
<a name="l00460"></a>00460   <a class="code" href="DoubleVect_8cpp.html#a9dd7edead35e9d46fc6c8960f33e668a">operator_add</a>(press, inc_pre, <a class="code" href="MD__Vector_8h.html#a3616a15fe105ad6150819554ee8b11caad18680091a9f62247573cb3caa6450b9">VECT_ALL_ITEMS</a>);
<a name="l00461"></a>00461   eqn.<a class="code" href="classNavier__Stokes__std.html#af9f5e0396945755597f147bd424a4a08">assembleur_pression</a>().<a class="code" href="classAssembleur.html#ac7b804a7151f761f15395e67aa8fd024" title="Appel a l&#39;objet sous-jacent. Permet de modifier la pression.">modifier_solution</a>(press);
<a name="l00462"></a>00462 
<a name="l00463"></a>00463 <span class="comment">// Correction de la vitesse en pression : M-1 Bt P</span>
<a name="l00464"></a>00464   eqn.<a class="code" href="classEquation__base.html#adfedf474c07a92f6b2261ca2f1cee80e" title="Renvoie le solveur de masse associe a l&#39;equation.">solv_masse</a>().<a class="code" href="classSolveur__Masse.html#af7afe8c2d4d5764f7428f2cd4ef43ddb" title="Appel a l&#39;objet sous-jacent. Resoud le systeme lineaire, dont la matrice est la matrice de masse...">appliquer</a>(gradP);
<a name="l00465"></a>00465   vpoint += gradP; <span class="comment">//!&lt; M-1 F</span>
<a name="l00466"></a>00466 <span class="comment"></span>
<a name="l00467"></a>00467   press.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l00468"></a>00468   eqn.<a class="code" href="classNavier__Stokes__std.html#a840295836fce939b7861f1353da595ff" title="Renvoie l&#39;operateur de calcul du gradient associe a l&#39;equation.">operateur_gradient</a>().<a class="code" href="classOperateur__Grad.html#a179b2f08f6907e9b69fa715cfb98fa81" title="Initialise le tableau passe en parametre avec la contribution de l&#39;operateur.">calculer</a>(press, gradP);
<a name="l00469"></a>00469 
<a name="l00470"></a>00470 <span class="comment">// On conserve Bt P pour la prochaine fois.</span>
<a name="l00471"></a>00471   Mmoins1grad = gradP;
<a name="l00472"></a>00472   eqn.<a class="code" href="classEquation__base.html#adfedf474c07a92f6b2261ca2f1cee80e" title="Renvoie le solveur de masse associe a l&#39;equation.">solv_masse</a>().<a class="code" href="classSolveur__Masse.html#af7afe8c2d4d5764f7428f2cd4ef43ddb" title="Appel a l&#39;objet sous-jacent. Resoud le systeme lineaire, dont la matrice est la matrice de masse...">appliquer</a>(Mmoins1grad);
<a name="l00473"></a>00473 
<a name="l00474"></a>00474 <span class="comment">// Correction en pression</span>
<a name="l00475"></a>00475   vpoint -= Mmoins1grad;
<a name="l00476"></a>00476 
<a name="l00477"></a>00477 <span class="comment">// vpoint = (rhoU(n+1)-rhoU(n))/dt</span>
<a name="l00478"></a>00478   vpoint *= dt_;
<a name="l00479"></a>00479   vpoint += rhoU; <span class="comment">//!&lt; rhoU(n+1)</span>
<a name="l00480"></a>00480 <span class="comment"></span>
<a name="l00481"></a>00481 <span class="comment">// Compute U(n+1):</span>
<a name="l00482"></a>00482   <span class="keyword">const</span> <span class="keywordtype">int</span> n = vpoint.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0), ncomp = vpoint.<a class="code" href="classDoubleVect.html#ab02d01cd1bdab66fbd66f9a47cc29e10">line_size</a>();
<a name="l00483"></a>00483   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0 ; i&lt;n ; i++)
<a name="l00484"></a>00484     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0 ; j&lt; ncomp; j++) vpoint(i,j) /= tab_rho_face_np1(i);
<a name="l00485"></a>00485 
<a name="l00486"></a>00486 <span class="comment">// Compute (U(n+1)-U(n))/dt :</span>
<a name="l00487"></a>00487   vpoint -= vit;
<a name="l00488"></a>00488   vpoint /= dt_;
<a name="l00489"></a>00489 
<a name="l00490"></a>00490   vpoint.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l00491"></a>00491   <a class="code" href="Op__Div__VEFP1B__Elem_8cpp.html#a45261662b3b88d5db461b3fc99246e5a">Debog::verifier</a>(<span class="stringliteral">&quot;Navier_Stokes_Fluide_Dilatable_base::derivee_en_temps_inco, vpoint : &quot;</span>, vpoint);
<a name="l00492"></a>00492 
<a name="l00493"></a>00493 } <span class="comment">/* END correct_and_compute_u_np1 */</span>
<a name="l00494"></a>00494 
<a name="l00495"></a>00495 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:31 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
