<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/Kernel/VF/Zones/EcritureLectureSpecial.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">src/Kernel/VF/Zones/EcritureLectureSpecial.cpp File Reference</div>  </div>
</div>
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="EcritureLectureSpecial_8h_source.html">EcritureLectureSpecial.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="Champ__Inc__base_8h_source.html">Champ_Inc_base.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="Champ__Fonc__base_8h_source.html">Champ_Fonc_base.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="Zone__VF_8h_source.html">Zone_VF.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="Domaine_8h_source.html">Domaine.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="Scatter_8h_source.html">Scatter.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="MD__Vector__tools_8h_source.html">MD_Vector_tools.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="Octree__Double_8h_source.html">Octree_Double.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="MD__Vector__composite_8h_source.html">MD_Vector_composite.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="ConstDoubleTab__parts_8h_source.html">ConstDoubleTab_parts.h</a>&gt;</code><br/>
</div>
<p><a href="EcritureLectureSpecial_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="classDoubleTab.html">DoubleTab</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="EcritureLectureSpecial_8cpp.html#a3c36103a68b253ad4148d77f7349ff11">get_ref_coordinates_items</a> (const <a class="el" href="classZone__VF.html">Zone_VF</a> &amp;zvf, const <a class="el" href="classMD__Vector.html">MD_Vector</a> &amp;md)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="EcritureLectureSpecial_8cpp.html#aaa8066c85a2a9a8afd0ab6fadc02ca72">ecrit</a> (<a class="el" href="classSortie.html">Sortie</a> &amp;fich, const <a class="el" href="classArrOfBit.html">ArrOfBit</a> &amp;items_to_write, const <a class="el" href="classDoubleTab.html">DoubleTab</a> &amp;pos, const <a class="el" href="classDoubleTab.html">DoubleTab</a> &amp;val)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="EcritureLectureSpecial_8cpp.html#ae5dfb4258eda6870d633c2eecd512af0">ecriture_special_part2</a> (const <a class="el" href="classZone__VF.html">Zone_VF</a> &amp;zvf, <a class="el" href="classSortie.html">Sortie</a> &amp;fich, const <a class="el" href="classDoubleTab.html">DoubleTab</a> &amp;val)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Partie "interieure" de l'ecriture, appellee par la methode en dessous.<br/>
Methode recursive, si le tableau a ecrire a un descripteur <a class="el" href="classMD__Vector__composite.html" title="Metadata for a distributed composite vector. This class describes a vector that contains one or more ...">MD_Vector_composite</a>.  <a href="#ae5dfb4258eda6870d633c2eecd512af0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="EcritureLectureSpecial_8cpp.html#add887dff0aedc34240cf00685a51e592">lire_special</a> (<a class="el" href="classEntree.html">Entree</a> &amp;fich, const <a class="el" href="classDoubleTab.html">DoubleTab</a> &amp;coords, <a class="el" href="classDoubleTab.html">DoubleTab</a> &amp;val, const double epsilon)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Reciproque de la methode ecrit(...), lit uniquement les items sequentiels<br/>
(donc pas les items communs recus d'un autre processeur)<br/>
On verifie a la fin qu'on a bien lu exactement le nombre d'items attendus, s'il en manque<br/>
c'est que le epsilon n'est pas bon (ou qu'on a change le maillage...)<br/>
Valeur de retour: nombre total d'items sequentiels lus (sur tous les procs)  <a href="#add887dff0aedc34240cf00685a51e592"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="EcritureLectureSpecial_8cpp.html#a3f617959e1f0eae7f45ce84362c02a6a">lecture_special_part2</a> (const <a class="el" href="classZone__VF.html">Zone_VF</a> &amp;zvf, <a class="el" href="classEntree.html">Entree</a> &amp;fich, <a class="el" href="classDoubleTab.html">DoubleTab</a> &amp;val)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="classType__info.html">Type_info</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="EcritureLectureSpecial_8cpp.html#aa1da3bc730de1f441cb3155cae44fbbc">EcritureLectureSpecialbases</a> [1] = { &amp;( <a class="el" href="classInterprete.html">Interprete</a> ::info_obj)}</td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="aaa8066c85a2a9a8afd0ab6fadc02ca72"></a><!-- doxytag: member="EcritureLectureSpecial.cpp::ecrit" ref="aaa8066c85a2a9a8afd0ab6fadc02ca72" args="(Sortie &amp;fich, const ArrOfBit &amp;items_to_write, const DoubleTab &amp;pos, const DoubleTab &amp;val)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ecrit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classSortie.html">Sortie</a> &amp;&#160;</td>
          <td class="paramname"><em>fich</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classArrOfBit.html">ArrOfBit</a> &amp;&#160;</td>
          <td class="paramname"><em>items_to_write</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classDoubleTab.html">DoubleTab</a> &amp;&#160;</td>
          <td class="paramname"><em>pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classDoubleTab.html">DoubleTab</a> &amp;&#160;</td>
          <td class="paramname"><em>val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p>&lt; Bytes </p>
</p>

<p>Definition at line <a class="el" href="EcritureLectureSpecial_8cpp_source.html#l00152">152</a> of file <a class="el" href="EcritureLectureSpecial_8cpp_source.html">EcritureLectureSpecial.cpp</a>.</p>

<p>References <a class="el" href="ArrOfDouble_8h_source.html#l00379">ArrOfDouble::addr()</a>, <a class="el" href="DoubleTab_8h_source.html#l00243">DoubleTab::dimension()</a>, <a class="el" href="EcritureLectureSpecial_8cpp_source.html#l00562">EcritureLectureSpecial::get_Output()</a>, <a class="el" href="DoubleTab_8h_source.html#l00264">DoubleTab::nb_dim()</a>, <a class="el" href="Process_8cpp_source.html#l00109">Process::nproc()</a>, <a class="el" href="Sortie_8cpp_source.html#l00176">Sortie::put()</a>, <a class="el" href="ArrOfBit_8h_source.html#l00094">ArrOfBit::size_array()</a>, and <a class="el" href="Sortie_8cpp_source.html#l00512">Sortie::syncfile()</a>.</p>

<p>Referenced by <a class="el" href="EcritureLectureSpecial_8cpp_source.html#l00222">ecriture_special_part2()</a>, and <a class="el" href="Raffiner__isotrope__parallele_8cpp_source.html#l00198">Raffiner_isotrope_parallele::interpreter()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">const</span> <span class="keywordtype">int</span> nb_dim = val.<a class="code" href="classDoubleTab.html#ae6dda48778e7107e1beb723beef1f75b" title="Returns the number of dimensions of the array (&gt;= 1)">nb_dim</a>();
  <span class="keyword">const</span> <span class="keywordtype">int</span> nb_comp = (nb_dim == 2) ? val.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1) : 1;
  <span class="keyword">const</span> <span class="keywordtype">int</span> nb_val = items_to_write.<a class="code" href="classArrOfBit.html#a3dc47c19e757ec4c3c757abeec29dc3a" title="Renvoie la taille du tableau en bits.">size_array</a>();
  <span class="keyword">const</span> <span class="keywordtype">int</span> dim = pos.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1);

  <span class="keywordflow">if</span> (<a class="code" href="classEcritureLectureSpecial.html#a31185ccf177a5057cf0bf0dcba608833" title="Renvoie le mode d&#39;ecriture utilise&lt;br&gt;(pour pouvoir le modifier). Cette methode est statique...">EcritureLectureSpecial::get_Output</a>().finit_par(<span class="stringliteral">&quot;MPIIO&quot;</span>))
    {
<span class="comment">// No bufferisation needed for Parallel IO</span>
      <span class="keywordtype">int</span> jmax = (dim + nb_comp) * nb_val;
      <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> tmp(jmax);
      <span class="keywordtype">int</span> j=0;
      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> p = 0; p &lt; nb_val; p++)
        {
<span class="comment">// On n&#39;ecrit que les items reels non communs afin d&#39;avoir un fichier .xyz</span>
<span class="comment">// de meme taille quelque soit le decoupage et surtout de pouvoir le relire</span>
<span class="comment">// quelque soit le decoupage et les supports</span>
          <span class="keywordflow">if</span> (items_to_write[p])
            {
              <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; dim; k++)
                tmp[j++] = pos(p, k);
              <span class="keywordflow">if</span> (nb_dim == 1)
                tmp[j++] = val(p);
              <span class="keywordflow">else</span>
                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; nb_comp; k++)
                  tmp[j++] = val(p, k);
            }
        }
      fich.<a class="code" href="classSortie.html#aa3f46aaccaff0f83c018784b50d8ea24" title="Methode de bas niveau pour ecrire un tableau d&#39;ints ou reels dans le stream. Dans l&#39;implementation de...">put</a>(tmp.addr(), j, dim + nb_comp <span class="comment">/* nb colonnes en ascii */</span>);
    }
  <span class="keywordflow">else</span>
    {
<span class="comment">// Bufferisation needed for EcrFicPartage</span>
      <span class="keywordtype">int</span> jmax = (dim + nb_comp) * 128;
      <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> tmp(jmax);
      <span class="keywordtype">int</span> j = 0;
      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> p = 0; p &lt; nb_val; p++)
        {
<span class="comment">// On n&#39;ecrit que les items reels non communs afin d&#39;avoir un fichier .xyz</span>
<span class="comment">// de meme taille quelque soit le decoupage et surtout de pouvoir le relire</span>
<span class="comment">// quelque soit le decoupage et les supports</span>
          <span class="keywordflow">if</span> (items_to_write[p])
            {
              <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; dim; k++)
                tmp[j++] = pos(p, k);
              <span class="keywordflow">if</span> (nb_dim == 1)
                tmp[j++] = val(p);
              <span class="keywordflow">else</span>
                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; nb_comp; k++)
                  tmp[j++] = val(p, k);
              <span class="keywordflow">if</span> (j == jmax)
                {
                  fich.<a class="code" href="classSortie.html#aa3f46aaccaff0f83c018784b50d8ea24" title="Methode de bas niveau pour ecrire un tableau d&#39;ints ou reels dans le stream. Dans l&#39;implementation de...">put</a>(tmp.addr(), j, dim + nb_comp <span class="comment">/* nb colonnes en ascii */</span>);
<span class="comment">// On flushe regulierement en sequentiel car sur certains tres gros maillages</span>
<span class="comment">// stack overflow possible...</span>
                  <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>()==1) fich.<a class="code" href="classSortie.html#ae98acb70e7f3886cab47a51f2de6a976">syncfile</a>();
                  j = 0;
                }
            }
        }
      <span class="keywordflow">if</span> (j)
        fich.<a class="code" href="classSortie.html#aa3f46aaccaff0f83c018784b50d8ea24" title="Methode de bas niveau pour ecrire un tableau d&#39;ints ou reels dans le stream. Dans l&#39;implementation de...">put</a>(tmp.addr(), j, dim + nb_comp <span class="comment">/* nb colonnes en ascii */</span>);
    }
  <span class="keywordflow">return</span> 8 * (dim + nb_comp) * nb_val; <span class="comment">//!&lt; Bytes</span>
<span class="comment"></span>}
</pre></div>
</div>
</div>
<a class="anchor" id="ae5dfb4258eda6870d633c2eecd512af0"></a><!-- doxytag: member="EcritureLectureSpecial.cpp::ecriture_special_part2" ref="ae5dfb4258eda6870d633c2eecd512af0" args="(const Zone_VF &amp;zvf, Sortie &amp;fich, const DoubleTab &amp;val)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ecriture_special_part2 </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classZone__VF.html">Zone_VF</a> &amp;&#160;</td>
          <td class="paramname"><em>zvf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classSortie.html">Sortie</a> &amp;&#160;</td>
          <td class="paramname"><em>fich</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classDoubleTab.html">DoubleTab</a> &amp;&#160;</td>
          <td class="paramname"><em>val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Partie "interieure" de l'ecriture, appellee par la methode en dessous.<br/>
Methode recursive, si le tableau a ecrire a un descripteur <a class="el" href="classMD__Vector__composite.html" title="Metadata for a distributed composite vector. This class describes a vector that contains one or more ...">MD_Vector_composite</a>. </p>

<p>Definition at line <a class="el" href="EcritureLectureSpecial_8cpp_source.html#l00222">222</a> of file <a class="el" href="EcritureLectureSpecial_8cpp_source.html">EcritureLectureSpecial.cpp</a>.</p>

<p>References <a class="el" href="EntreeSortie_8h_source.html#l00032">Cerr</a>, <a class="el" href="EcritureLectureSpecial_8cpp_source.html#l00152">ecrit()</a>, <a class="el" href="Process_8cpp_source.html#l00223">Process::exit()</a>, <a class="el" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>, <a class="el" href="DoubleVect_8h_source.html#l00101">DoubleVect::get_md_vector()</a>, <a class="el" href="EcritureLectureSpecial_8cpp_source.html#l00048">get_ref_coordinates_items()</a>, <a class="el" href="MD__Vector__tools_8cpp_source.html#l00275">MD_Vector_tools::get_sequential_items_flags()</a>, <a class="el" href="Objet__U_8cpp_source.html#l00132">Objet_U::que_suis_je()</a>, <a class="el" href="ConstDoubleTab__parts_8h_source.html#l00043">ConstDoubleTab_parts::size()</a>, <a class="el" href="Cast_8h_source.html#l00054">sub_type</a>, <a class="el" href="Sortie_8cpp_source.html#l00512">Sortie::syncfile()</a>, and <a class="el" href="MD__Vector_8h_source.html#l00067">MD_Vector::valeur()</a>.</p>

<p>Referenced by <a class="el" href="EcritureLectureSpecial_8cpp_source.html#l00259">EcritureLectureSpecial::ecriture_special()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">const</span> <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a>&amp; md = val.<a class="code" href="classDoubleVect.html#a0d16d30580c90526e4895388fb44be5d">get_md_vector</a>();
  <span class="keywordtype">int</span> bytes = 0;
  <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classMD__Vector__composite.html" title="Metadata for a distributed composite vector. This class describes a vector that contains one or more ...">MD_Vector_composite</a>, md.<a class="code" href="classMD__Vector.html#a41324dfaa7a973091d0a8276908d10e2">valeur</a>()))
    {
<span class="comment">// Champs p1bulles et autres: appel recursif pour les differents sous-tableaux:</span>
      <a class="code" href="classConstDoubleTab__parts.html" title="This class allows to acces to individual sub-parts of const DoubleTab objects that have a MD_Vector_c...">ConstDoubleTab_parts</a> parts(val);
      <span class="keywordtype">int</span> n = zvf.<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() == <span class="stringliteral">&quot;Zone_PolyMAC&quot;</span> || zvf.<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() == <span class="stringliteral">&quot;Zone_CoviMAC&quot;</span> ? 1 : parts.size();<span class="comment">//on saute les variables auxiliaires de Champ_{P0,Face}_PolyMAC</span>
      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
        bytes += <a class="code" href="EcritureLectureSpecial_8cpp.html#ae5dfb4258eda6870d633c2eecd512af0" title="Partie &quot;interieure&quot; de l&#39;ecriture, appellee par la methode en dessous. Methode recursive, si le tableau a ecrire a un descripteur MD_Vector_composite.">ecriture_special_part2</a>(zvf, fich, parts[i]);
    }
  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classMD__Vector__std.html" title="C&#39;est le plus simple des descripteurs, utilise pour les tableaux de valeurs aux sommets, elements, faces, aretes, faces de bord, etc... Il supporte la notion d&#39;items &quot;communs&quot; (sommets du maillage partages entre plusieurs processeurs) et d&#39;items &quot;distants&quot; et &quot;virtuels&quot; (sommets, elements dans l&#39;epaisseur de joint). Voir aussi MD_Vector_composite (descripteur compose d&#39;une reunion de plusieurs descripteurs, pour le P1Bulle par exemple)">MD_Vector_std</a>, md.<a class="code" href="classMD__Vector.html#a41324dfaa7a973091d0a8276908d10e2">valeur</a>()))
    {
      <a class="code" href="classArrOfBit.html">ArrOfBit</a> items_to_write;
      <a class="code" href="classMD__Vector__tools.html#ad099d2407b0016920bd8c667a56fddd8">MD_Vector_tools::get_sequential_items_flags</a>(md, items_to_write);
      <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; coords = <a class="code" href="EcritureLectureSpecial_8cpp.html#a3c36103a68b253ad4148d77f7349ff11">get_ref_coordinates_items</a>(zvf, md);
      bytes += <a class="code" href="EcritureLectureSpecial_8cpp.html#aaa8066c85a2a9a8afd0ab6fadc02ca72">ecrit</a>(fich, items_to_write, coords, val);
      fich.<a class="code" href="classSortie.html#ae98acb70e7f3886cab47a51f2de6a976">syncfile</a>();
    }
  <span class="keywordflow">else</span>
    {
      <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;EcritureLectureSpecial::ecriture_special_part: Error, unknown Metadata vector type : &quot;</span>
           &lt;&lt; md.<a class="code" href="classMD__Vector.html#a41324dfaa7a973091d0a8276908d10e2">valeur</a>().<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
      <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
    }
  <span class="keywordflow">return</span> bytes;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3c36103a68b253ad4148d77f7349ff11"></a><!-- doxytag: member="EcritureLectureSpecial.cpp::get_ref_coordinates_items" ref="a3c36103a68b253ad4148d77f7349ff11" args="(const Zone_VF &amp;zvf, const MD_Vector &amp;md)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classDoubleTab.html">DoubleTab</a>&amp; get_ref_coordinates_items </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classZone__VF.html">Zone_VF</a> &amp;&#160;</td>
          <td class="paramname"><em>zvf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classMD__Vector.html">MD_Vector</a> &amp;&#160;</td>
          <td class="paramname"><em>md</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p>&lt; <a class="el" href="classDescripteur.html">Descripteur</a> des face j'aurais pris xp mais il n'a pas de structure parallele !!!!!!$&amp;</p>
<p>&lt; <a class="el" href="classDescripteur.html">Descripteur</a> des elements</p>
<p>&lt; <a class="el" href="classDescripteur.html">Descripteur</a> des aretes</p>
<p>&lt; for compiler </p>
</p>

<p>Definition at line <a class="el" href="EcritureLectureSpecial_8cpp_source.html#l00048">48</a> of file <a class="el" href="EcritureLectureSpecial_8cpp_source.html">EcritureLectureSpecial.cpp</a>.</p>

<p>References <a class="el" href="EntreeSortie_8h_source.html#l00032">Cerr</a>, <a class="el" href="Zone_8cpp_source.html#l00262">Zone::domaine()</a>, <a class="el" href="Process_8cpp_source.html#l00223">Process::exit()</a>, <a class="el" href="Zone__VF_8h_source.html#l00609">Zone_VF::face_sommets()</a>, <a class="el" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>, <a class="el" href="DoubleVect_8h_source.html#l00101">DoubleVect::get_md_vector()</a>, <a class="el" href="IntVect_8h_source.html#l00087">IntVect::get_md_vector()</a>, <a class="el" href="Zone_8h_source.html#l00402">Zone::les_elems()</a>, <a class="el" href="Domaine_8h_source.html#l00577">Domaine::les_sommets()</a>, <a class="el" href="Zone__VF_8h_source.html#l00718">Zone_VF::xa()</a>, <a class="el" href="Zone__VF_8h_source.html#l00700">Zone_VF::xp()</a>, <a class="el" href="Zone__VF_8h_source.html#l00650">Zone_VF::xv()</a>, and <a class="el" href="Zone__dis__base_8h_source.html#l00106">Zone_dis_base::zone()</a>.</p>

<p>Referenced by <a class="el" href="EcritureLectureSpecial_8cpp_source.html#l00222">ecriture_special_part2()</a>, and <a class="el" href="EcritureLectureSpecial_8cpp_source.html#l00492">lecture_special_part2()</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="comment">// j&#39;aurais pris xv mais il n&#39;a pas de structure parallele !!!</span>
  <span class="keywordflow">if</span> (md == zvf.<a class="code" href="classZone__VF.html#a298e73b18e17da55f421b1fb0879bd46" title="renvoie le numero du ieme sommet de la face num_face.">face_sommets</a>().get_md_vector())
    <span class="keywordflow">return</span> zvf.<a class="code" href="classZone__VF.html#a918c0885a9b67317fcce3a0535306542">xv</a>(); <span class="comment">//!&lt; Descripteur des face j&#39;aurais pris xp mais il n&#39;a pas de structure parallele !!!!!!$&amp;</span>
<span class="comment"></span><span class="comment">//</span>
  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (md == zvf.<a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>().<a class="code" href="classZone.html#ac115e8342be89afb882b7b61cc343267" title="Renvoie le tableau des sommets des elements.">les_elems</a>().<a class="code" href="classIntVect.html#ae74e1fee6aca124d32718267e33a40c6">get_md_vector</a>())
    <span class="keywordflow">return</span> zvf.<a class="code" href="classZone__VF.html#a87a29f0223c71256a25ee343c9277599">xp</a>(); <span class="comment">//!&lt; Descripteur des elements</span>
<span class="comment"></span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (md == zvf.<a class="code" href="classZone__VF.html#a6ad5a2a03fc2cba4247a6ebe662b1320">xa</a>().get_md_vector())
    <span class="keywordflow">return</span> zvf.<a class="code" href="classZone__VF.html#a6ad5a2a03fc2cba4247a6ebe662b1320">xa</a>(); <span class="comment">//!&lt; Descripteur des aretes</span>
<span class="comment"></span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (md == zvf.<a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>().<a class="code" href="classZone.html#a379ad2206b5a13a4f4f3df6d44c7546a" title="Renvoie le domaine dont la zone fait partie. (version const)">domaine</a>().<a class="code" href="classDomaine.html#a0846ac03a10b65c4df911fe35a19c02f" title="Renvoie le nombre total de sommets.">les_sommets</a>().<a class="code" href="classDoubleVect.html#a0d16d30580c90526e4895388fb44be5d">get_md_vector</a>())
    <span class="keywordflow">return</span> zvf.<a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>().<a class="code" href="classZone.html#a379ad2206b5a13a4f4f3df6d44c7546a" title="Renvoie le domaine dont la zone fait partie. (version const)">domaine</a>().<a class="code" href="classDomaine.html#a0846ac03a10b65c4df911fe35a19c02f" title="Renvoie le nombre total de sommets.">les_sommets</a>();
  <span class="keywordflow">else</span>
    {
      <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in get_ref_coordinates_items\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot; descriptor not found in this zone&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
      <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
    }
  <span class="keywordflow">return</span> zvf.<a class="code" href="classZone__VF.html#a918c0885a9b67317fcce3a0535306542">xv</a>(); <span class="comment">//!&lt; for compiler</span>
<span class="comment"></span>}
</pre></div>
</div>
</div>
<a class="anchor" id="a3f617959e1f0eae7f45ce84362c02a6a"></a><!-- doxytag: member="EcritureLectureSpecial.cpp::lecture_special_part2" ref="a3f617959e1f0eae7f45ce84362c02a6a" args="(const Zone_VF &amp;zvf, Entree &amp;fich, DoubleTab &amp;val)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lecture_special_part2 </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classZone__VF.html">Zone_VF</a> &amp;&#160;</td>
          <td class="paramname"><em>zvf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classEntree.html">Entree</a> &amp;&#160;</td>
          <td class="paramname"><em>fich</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classDoubleTab.html">DoubleTab</a> &amp;&#160;</td>
          <td class="paramname"><em>val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="EcritureLectureSpecial_8cpp_source.html#l00492">492</a> of file <a class="el" href="EcritureLectureSpecial_8cpp_source.html">EcritureLectureSpecial.cpp</a>.</p>

<p>References <a class="el" href="EntreeSortie_8h_source.html#l00032">Cerr</a>, <a class="el" href="Zone_8cpp_source.html#l00262">Zone::domaine()</a>, <a class="el" href="Domaine_8h_source.html#l00557">Domaine::epsilon()</a>, <a class="el" href="Process_8cpp_source.html#l00223">Process::exit()</a>, <a class="el" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>, <a class="el" href="DoubleVect_8h_source.html#l00101">DoubleVect::get_md_vector()</a>, <a class="el" href="EcritureLectureSpecial_8cpp_source.html#l00048">get_ref_coordinates_items()</a>, <a class="el" href="EcritureLectureSpecial_8cpp_source.html#l00328">lire_special()</a>, <a class="el" href="Objet__U_8cpp_source.html#l00132">Objet_U::que_suis_je()</a>, <a class="el" href="ConstDoubleTab__parts_8h_source.html#l00074">DoubleTab_parts::size()</a>, <a class="el" href="Cast_8h_source.html#l00054">sub_type</a>, <a class="el" href="MD__Vector_8h_source.html#l00067">MD_Vector::valeur()</a>, and <a class="el" href="Zone__dis__base_8h_source.html#l00106">Zone_dis_base::zone()</a>.</p>

<p>Referenced by <a class="el" href="EcritureLectureSpecial_8cpp_source.html#l00529">EcritureLectureSpecial::lecture_special()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">const</span> <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a>&amp; md = val.<a class="code" href="classDoubleVect.html#a0d16d30580c90526e4895388fb44be5d">get_md_vector</a>();

  <span class="keywordtype">int</span> ntot = 0;
  <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classMD__Vector__composite.html" title="Metadata for a distributed composite vector. This class describes a vector that contains one or more ...">MD_Vector_composite</a>, md.<a class="code" href="classMD__Vector.html#a41324dfaa7a973091d0a8276908d10e2">valeur</a>()))
    {
<span class="comment">// Champs p1bulles et autres: appel recursif pour les differents sous-tableaux:</span>
      <a class="code" href="classDoubleTab__parts.html">DoubleTab_parts</a> parts(val);
      <span class="keyword">const</span> <span class="keywordtype">int</span> n = parts.size();
      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
        ntot += <a class="code" href="EcritureLectureSpecial_8cpp.html#a3f617959e1f0eae7f45ce84362c02a6a">lecture_special_part2</a>(zvf, fich, parts[i]);
    }
  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classMD__Vector__std.html" title="C&#39;est le plus simple des descripteurs, utilise pour les tableaux de valeurs aux sommets, elements, faces, aretes, faces de bord, etc... Il supporte la notion d&#39;items &quot;communs&quot; (sommets du maillage partages entre plusieurs processeurs) et d&#39;items &quot;distants&quot; et &quot;virtuels&quot; (sommets, elements dans l&#39;epaisseur de joint). Voir aussi MD_Vector_composite (descripteur compose d&#39;une reunion de plusieurs descripteurs, pour le P1Bulle par exemple)">MD_Vector_std</a>, md.<a class="code" href="classMD__Vector.html#a41324dfaa7a973091d0a8276908d10e2">valeur</a>()))
    {
      <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; coords = <a class="code" href="EcritureLectureSpecial_8cpp.html#a3c36103a68b253ad4148d77f7349ff11">get_ref_coordinates_items</a>(zvf, md);
      <span class="keyword">const</span> <span class="keywordtype">double</span> epsilon = zvf.<a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>().<a class="code" href="classZone.html#a379ad2206b5a13a4f4f3df6d44c7546a" title="Renvoie le domaine dont la zone fait partie. (version const)">domaine</a>().<a class="code" href="classDomaine.html#a265dc75236ae3cc98a215f38424d2df1" title="Renvoie epsilon. Si 2 points d&#39;un domaine sont separes d&#39;une distance inferieure ou egale a epsilon i...">epsilon</a>();
      ntot += <a class="code" href="EcritureLectureSpecial_8cpp.html#add887dff0aedc34240cf00685a51e592" title="Reciproque de la methode ecrit(...), lit uniquement les items sequentiels (donc pas les items communs...">lire_special</a>(fich, coords, val, epsilon);
    }
  <span class="keywordflow">else</span>
    {
      <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;EcritureLectureSpecial::lecture_special_part2: Error, unknown Metadata vector type : &quot;</span>
           &lt;&lt; md.<a class="code" href="classMD__Vector.html#a41324dfaa7a973091d0a8276908d10e2">valeur</a>().<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
      <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
    }
  <span class="keywordflow">return</span> ntot;
}
</pre></div>
</div>
</div>
<a class="anchor" id="add887dff0aedc34240cf00685a51e592"></a><!-- doxytag: member="EcritureLectureSpecial.cpp::lire_special" ref="add887dff0aedc34240cf00685a51e592" args="(Entree &amp;fich, const DoubleTab &amp;coords, DoubleTab &amp;val, const double epsilon)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lire_special </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classEntree.html">Entree</a> &amp;&#160;</td>
          <td class="paramname"><em>fich</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classDoubleTab.html">DoubleTab</a> &amp;&#160;</td>
          <td class="paramname"><em>coords</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classDoubleTab.html">DoubleTab</a> &amp;&#160;</td>
          <td class="paramname"><em>val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>epsilon</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reciproque de la methode ecrit(...), lit uniquement les items sequentiels<br/>
(donc pas les items communs recus d'un autre processeur)<br/>
On verifie a la fin qu'on a bien lu exactement le nombre d'items attendus, s'il en manque<br/>
c'est que le epsilon n'est pas bon (ou qu'on a change le maillage...)<br/>
Valeur de retour: nombre total d'items sequentiels lus (sur tous les procs) </p>

<p><p>&lt; pas trop, histoire d'avoir plusieurs blocs dans les cas tests</p>
<p>&lt; celui-la est sans doute le bon, il faut un epsilon superieur a cette valeur la... </p>
</p>

<p>Definition at line <a class="el" href="EcritureLectureSpecial_8cpp_source.html#l00328">328</a> of file <a class="el" href="EcritureLectureSpecial_8cpp_source.html">EcritureLectureSpecial.cpp</a>.</p>

<p>References <a class="el" href="ArrOfDouble_8h_source.html#l00379">ArrOfDouble::addr()</a>, <a class="el" href="Process_8cpp_source.html#l00127">Process::barrier()</a>, <a class="el" href="Octree__Double_8cpp_source.html#l00154">Octree_Double::build_nodes()</a>, <a class="el" href="EntreeSortie_8h_source.html#l00032">Cerr</a>, <a class="el" href="DoubleTab_8h_source.html#l00243">DoubleTab::dimension()</a>, <a class="el" href="Process_8cpp_source.html#l00223">Process::exit()</a>, <a class="el" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>, <a class="el" href="Octree__Double_8h_source.html#l00066">Octree_Double::floor_elements()</a>, <a class="el" href="Entree_8cpp_source.html#l00302">Entree::get()</a>, <a class="el" href="DoubleVect_8h_source.html#l00101">DoubleVect::get_md_vector()</a>, <a class="el" href="MD__Vector__tools_8cpp_source.html#l00275">MD_Vector_tools::get_sequential_items_flags()</a>, <a class="el" href="Process_8cpp_source.html#l00095">Process::je_suis_maitre()</a>, <a class="el" href="Double_8h_source.html#l00199">min()</a>, <a class="el" href="Process_8cpp_source.html#l00167">Process::mp_min()</a>, <a class="el" href="Process_8cpp_source.html#l00178">Process::mp_sum()</a>, <a class="el" href="DoubleTab_8h_source.html#l00264">DoubleTab::nb_dim()</a>, <a class="el" href="Array__base_8h_source.html#l00038">Array_base::NOCOPY_NOINIT</a>, <a class="el" href="ArrOfInt_8h_source.html#l00240">ArrOfInt::resize_array()</a>, <a class="el" href="Octree__Double_8cpp_source.html#l00081">Octree_Double::search_elements()</a>, <a class="el" href="Octree__Double_8cpp_source.html#l00289">Octree_Double::search_nodes_close_to()</a>, <a class="el" href="ArrOfInt_8cpp_source.html#l00443">ArrOfInt::set_smart_resize()</a>, <a class="el" href="ArrOfInt_8h_source.html#l00342">ArrOfInt::size_array()</a>, and <a class="el" href="ArrOfDouble_8h_source.html#l00350">ArrOfDouble::size_array()</a>.</p>

<p>Referenced by <a class="el" href="EcritureLectureSpecial_8cpp_source.html#l00492">lecture_special_part2()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">const</span> <span class="keywordtype">int</span> dim = coords.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1);
  <span class="keyword">const</span> <span class="keywordtype">int</span> nb_dim = val.<a class="code" href="classDoubleTab.html#ae6dda48778e7107e1beb723beef1f75b" title="Returns the number of dimensions of the array (&gt;= 1)">nb_dim</a>();
  <span class="keyword">const</span> <span class="keywordtype">int</span> nb_comp = (nb_dim == 1) ? 1 : val.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1);

  <span class="keyword">const</span> <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a>&amp; md_vect = val.<a class="code" href="classDoubleVect.html#a0d16d30580c90526e4895388fb44be5d">get_md_vector</a>();
<span class="comment">// Dans un premier temps, 1 si l&#39;item est a lire, 0 s&#39;il est lu par un autre processeur.</span>
<span class="comment">// Une fois que l&#39;item est lu, on met le flag a 2.</span>
  <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> items_to_read;
  <span class="keyword">const</span> <span class="keywordtype">int</span> n_to_read = <a class="code" href="classMD__Vector__tools.html#ad099d2407b0016920bd8c667a56fddd8">MD_Vector_tools::get_sequential_items_flags</a>(md_vect, items_to_read);
  <a class="code" href="classOctree__Double.html" title=": Un octree permettant de chercher dans l&#39;espace des elements ou des points decrits par des coordonne...">Octree_Double</a> octree;
<span class="comment">// Build an octree with &quot;thick&quot; nodes (epsilon size)</span>
  octree.<a class="code" href="classOctree__Double.html#a0b66bd315e7f45a024695b6a2764e7d4" title="construit un octree contenant les points de coordonnees coords. Si include_virtual=1, on stocke coords.dimension_tot(0) elements, sinon on en stocke coords.dimension(0) Si epsilon = 0, on construit un octree de points de taille nulle (chaque point se trouve dans un seul octree_floor) Sinon, on construit un octree d&#39;elements cubiques centres sur les coords, de demie-largeur epsilon. Un point peut alors se trouver dans plusieurs octree_floor.">build_nodes</a>(coords, 0 <span class="comment">/* do not include virtual elements */</span>, epsilon);
  <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; floor_elements = octree.<a class="code" href="classOctree__Double.html#a54f3f6f6126f1bc9d3761816f6e5f89d">floor_elements</a>();

<span class="comment">// Le fichier contient ce nombre de lignes pour cette partie du tableau (nombre total d&#39;items sequentiels)</span>
  <span class="keyword">const</span> <span class="keywordtype">int</span> ntot = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(n_to_read);

<span class="comment">// On lit dans le fichier par blocs de buflines_max parce qu&#39;il y a</span>
<span class="comment">// un broadcast reseau a chaque comm:</span>
  <span class="keyword">const</span> <span class="keywordtype">int</span> buflines_max = 2048; <span class="comment">//!&lt; pas trop, histoire d&#39;avoir plusieurs blocs dans les cas tests</span>
<span class="comment"></span>  <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> buffer(buflines_max, dim + nb_comp);
  <span class="keywordtype">int</span> bufptr = buflines_max;
  <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> items;
  items.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);

  <span class="keywordtype">double</span> max_epsilon_needed = epsilon;
<span class="comment">// Combien de fois on a trouve plusieurs candidats a moins de epsilon ?</span>
  <span class="keywordtype">int</span> error_too_many_matches = 0;
<span class="comment">// Combien de fois on est tombe plusieurs fois sur le meme sommet a lire ?</span>
  <span class="keywordtype">int</span> error_duplicate_read = 0;
<span class="comment">// Combien d&#39;items a-t-on lu ?</span>
  <span class="keywordtype">int</span> count_items_read = 0;

<span class="comment">// Boucle sur les items sequentiels du fichier:</span>
  <span class="keywordtype">int</span> pourcent=0;
  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; ntot; i++)
    {
      <span class="keywordtype">int</span> tmp=(i*10)/(ntot-1);
      <span class="keywordflow">if</span> (tmp&gt;pourcent || i==0)
        {
          pourcent=tmp;
          <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;\r&quot;</span>&lt;&lt;pourcent*10&lt;&lt;<span class="stringliteral">&quot;% of data has been found.&quot;</span>&lt;&lt;flush;
        }
      <span class="keywordflow">if</span> (bufptr == buflines_max)
        {
          bufptr = 0;
          <span class="keywordtype">int</span> n = <a class="code" href="Double_8h.html#a2f8edc4561e9744ed4233b205fa7ec32">min</a>(buflines_max, ntot - i) * (dim + nb_comp);
          assert(n &lt;= buffer.size_array());
          fich.<a class="code" href="classEntree.html#aa434f5ceb8169e469613d1f6cd1fd99f" title="methode virtuelle pour lire un tableau d&#39;ints ou reels&lt;br&gt;(le tableau doit avoir la bonne dimension: ...">get</a>(buffer.addr(), n);
        }
      <span class="keyword">const</span> <span class="keywordtype">double</span> x = buffer(bufptr, 0);
      <span class="keyword">const</span> <span class="keywordtype">double</span> y = buffer(bufptr, 1);
      <span class="keyword">const</span> <span class="keywordtype">double</span> z = (dim == 3) ? buffer(bufptr, 2) : 0.;
<span class="comment">// Recherche des items correspondant potentiellement au point (x,y,z)</span>
      <span class="keywordtype">int</span> index = -1;
      <span class="keywordtype">int</span> nb_items_proches = octree.<a class="code" href="classOctree__Double.html#a66fb0c0bc01ad9c24ca23405a31c2aec" title="cherche les elements ou les points contenus dans l&#39;octree_floor qui contient le point (x...">search_elements</a>(x, y, z, index);
      <span class="keywordflow">if</span> (nb_items_proches &gt; 0)
        {
          items.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(nb_items_proches, <a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ffaf6ae9ba7eb51c5f298ce693345b3ec68">ArrOfInt::NOCOPY_NOINIT</a>);
<span class="comment">// Voir doc de Octree_Double::search_elements: on copie les indices des items proches dans items:</span>
          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; nb_items_proches; j++)
            items[j] = floor_elements[index++];
<span class="comment">// On reduit la liste pour avoir uniquement les items a moins de epsilon</span>
          <span class="keyword">const</span> <span class="keywordtype">int</span> item_le_plus_proche = octree.<a class="code" href="classOctree__Double.html#a8ba1f6ceba5dae2af587d2f9a766aac2" title="Methode hors classe Cherche parmi les sommets de la liste node_list ceux qui sont a une distance infe...">search_nodes_close_to</a>(x, y, z, coords, items, epsilon);
          nb_items_proches = items.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
          <span class="keywordflow">if</span> (nb_items_proches == 1)
            {
              <span class="keyword">const</span> <span class="keywordtype">int</span> flag = items_to_read[item_le_plus_proche];
              <span class="keywordflow">if</span> (flag == 1)
                {
<span class="comment">// Ok, il faut lire cette valeur</span>
                  items_to_read[item_le_plus_proche] = 2;
                  count_items_read++;
                  <span class="keywordflow">if</span> (nb_dim == 1)
                    {
                      val(item_le_plus_proche) = buffer(bufptr, dim);
                    }
                  <span class="keywordflow">else</span>
                    {
                      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; nb_comp; j++)
                        val(item_le_plus_proche, j) = buffer(bufptr, dim + j);
                    }
                }
              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (flag == 0)
                {
<span class="comment">// Cet item n&#39;est pas a moi, ne pas le lire</span>
                }
              <span class="keywordflow">else</span>
                {
<span class="comment">// Erreur, on a deja lu cet item !!! epsilon est trop grand (ou erreur a la sauvegarde ???)</span>
                  error_duplicate_read++;
                }
            }
          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nb_items_proches == 0)
            {
<span class="comment">// ok, le sommet est sur un autre processeur (ou epsilon trop petit ??)</span>
            }
          <span class="keywordflow">else</span>
            {
<span class="comment">// Erreur: epsilon est trop grand, on a plusieurs candidats a moins de epsilon</span>
<span class="comment">// Calcul de la distance avec le deuxieme plus proche pour afficher un message d&#39;erreur a la fin:</span>
              <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii = 0; ii &lt; nb_items_proches; ii++)
                {
                  <span class="keyword">const</span> <span class="keywordtype">int</span> i_coord = items[ii];
                  <span class="keywordflow">if</span> (i_coord == item_le_plus_proche)
                    <span class="keywordflow">continue</span>; <span class="comment">//!&lt; celui-la est sans doute le bon, il faut un epsilon superieur a cette valeur la...</span>
<span class="comment"></span>                  <span class="keywordtype">double</span> xx = 0;
                  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; dim; j++)
                    {
                      <span class="keywordtype">double</span> yy = coords(i_coord, j) - buffer(bufptr, j);
                      xx += yy * yy;
                    }
<span class="comment">// On propose de mettre un epsilon au maximum egal a 1/10 de la distance avec le deuxieme point le plus proche:</span>
                  xx = sqrt(xx) * 0.1;
                  <span class="keywordflow">if</span> (max_epsilon_needed &gt; xx)
                    max_epsilon_needed = xx;
                }
              error_too_many_matches++;
            }
        }
      bufptr++;
    }
  <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<span class="comment">// Erreurs ?</span>
  <span class="keywordtype">int</span> err = (count_items_read != n_to_read) || (error_too_many_matches &gt; 0) || (error_duplicate_read &gt; 0);
  err = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(err);
  <span class="keywordflow">if</span> (err)
    {
      error_too_many_matches = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(error_too_many_matches);
      error_duplicate_read = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(error_duplicate_read);
      max_epsilon_needed = <a class="code" href="classProcess.html#a05de57db7288d95f9e67046af585d5ff" title="Calcule le min de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_min</a>(max_epsilon_needed);
      <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
        {
          <span class="keywordflow">if</span> (error_too_many_matches)
            {
              <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in EcritureLectureSpecial: error_too_many_matches = &quot;</span> &lt;&lt; error_too_many_matches
                   &lt;&lt; <span class="stringliteral">&quot;, epsilon is too large. Suggested value: &quot;</span> &lt;&lt; max_epsilon_needed &lt;&lt; finl;
              <span class="keywordflow">if</span> (max_epsilon_needed==0)
                {
                  <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;It could be because your mesh has two boundaries which match exactly.&quot;</span> &lt;&lt; finl;
                  <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;It is possible to do calculation with this property but xyz restart process&quot;</span> &lt;&lt; finl;
                  <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;is impossible because it can&#39;t detect the differences between faces of the two boundaries...&quot;</span> &lt;&lt; finl;
                  <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Try to do a classic restart with .sauv files.&quot;</span> &lt;&lt; finl;
                }
            }
          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (error_duplicate_read)
            {
              <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in EcritureLectureSpecial: error_duplicate_read = &quot;</span> &lt;&lt; error_duplicate_read
                   &lt;&lt; <span class="stringliteral">&quot;, probably epsilon too large. &quot;</span> &lt;&lt; finl;
            }
          <span class="keywordflow">else</span>
            {
              <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in EcritureLectureSpecial: Some items were not found: epsilon too small (or the mesh has changed?)&quot;</span> &lt;&lt; finl;
            }
        }
      <a class="code" href="classProcess.html#aa9e74a5c06a68ea38298a08ea401e7b1" title="Synchronise tous les processeurs du groupe courant&lt;br&gt;(attend que tous les processeurs soient arrives...">Process::barrier</a>();
      <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
    }
  <span class="keywordflow">return</span> ntot;
}
</pre></div>
</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="aa1da3bc730de1f441cb3155cae44fbbc"></a><!-- doxytag: member="EcritureLectureSpecial.cpp::EcritureLectureSpecialbases" ref="aa1da3bc730de1f441cb3155cae44fbbc" args="[1]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classType__info.html">Type_info</a>* <a class="el" href="EcritureLectureSpecial_8cpp.html#aa1da3bc730de1f441cb3155cae44fbbc">EcritureLectureSpecialbases</a>[1] = { &amp;( <a class="el" href="classInterprete.html">Interprete</a> ::info_obj)}</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="EcritureLectureSpecial_8cpp_source.html#l00046">46</a> of file <a class="el" href="EcritureLectureSpecial_8cpp_source.html">EcritureLectureSpecial.cpp</a>.</p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:56 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
