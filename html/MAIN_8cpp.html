<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/MAIN/MAIN.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">src/MAIN/MAIN.cpp File Reference</div>  </div>
</div>
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="MAIN_8h_source.html">MAIN.h</a>&gt;</code><br/>
<code>#include &lt;sys/types.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;<a class="el" href="mon__main_8h_source.html">mon_main.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="EFichier_8h_source.html">EFichier.h</a>&gt;</code><br/>
<code>#include &lt;fenv.h&gt;</code><br/>
<code>#include &lt;errno.h&gt;</code><br/>
</div>
<p><a href="MAIN_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="MAIN_8cpp.html#ac84fdfce462a43800dfab9c412a2b8e5">DEFAULT_CHECK_ENABLED</a>&#160;&#160;&#160;1</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="MAIN_8cpp.html#ab80403809e7e0cc95ebbdd90a5d18dd5">desalloue_pwd</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="MAIN_8cpp.html#a2ef30c42cbc289d899a8be5d2d8f77d0">usage</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="MAIN_8cpp.html#af411fa81d014add367a077dfa9985f36">main_TRUST</a> (int argc, char **argv, <a class="el" href="classmon__main.html">mon_main</a> *&amp;main_process, int force_mpi)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="MAIN_8cpp.html#ac49acbee6fad41657b26bc355c9cddeb">directory_separator</a> = '/'</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ac84fdfce462a43800dfab9c412a2b8e5"></a><!-- doxytag: member="MAIN.cpp::DEFAULT_CHECK_ENABLED" ref="ac84fdfce462a43800dfab9c412a2b8e5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFAULT_CHECK_ENABLED&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MAIN_8cpp_source.html#l00066">66</a> of file <a class="el" href="MAIN_8cpp_source.html">MAIN.cpp</a>.</p>

<p>Referenced by <a class="el" href="MAIN_8cpp_source.html#l00069">main_TRUST()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ab80403809e7e0cc95ebbdd90a5d18dd5"></a><!-- doxytag: member="MAIN.cpp::desalloue_pwd" ref="ab80403809e7e0cc95ebbdd90a5d18dd5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void desalloue_pwd </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="arch_8cpp_source.html#l00055">55</a> of file <a class="el" href="arch_8cpp_source.html">arch.cpp</a>.</p>

<p>References <a class="el" href="arch_8cpp_source.html#l00052">buf</a>.</p>

<p>Referenced by <a class="el" href="MAIN_8cpp_source.html#l00069">main_TRUST()</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="comment">// si on a alloue le buf on le detruit ...</span>
<span class="preprocessor">#if defined(_CSH_) || defined(linux) || defined(cygwin) || defined(MICROSOFT)</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (<a class="code" href="arch_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>)
    <span class="keyword">delete</span> [] <a class="code" href="arch_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>;
  <a class="code" href="arch_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>=0;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div>
</div>
</div>
<a class="anchor" id="af411fa81d014add367a077dfa9985f36"></a><!-- doxytag: member="MAIN.cpp::main_TRUST" ref="af411fa81d014add367a077dfa9985f36" args="(int argc, char **argv, mon_main *&amp;main_process, int force_mpi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main_TRUST </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmon__main.html">mon_main</a> *&amp;&#160;</td>
          <td class="paramname"><em>main_process</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>force_mpi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p>&lt; -1 =&gt; use petsc if compiled</p>
<p>&lt; 1 =&gt; use of feenableexcept(FE_DIVBYZERO | FE_INVALID | FE_OVERFLOW); int ieee = 0; // PolyMAC ?</p>
<p>&lt; Crashes bizarres</p>
<p>&lt; Attention, longueur()=strlen+1</p>
<p>&lt; Attention, voir Nom::substr() </p>
</p>

<p>Definition at line <a class="el" href="MAIN_8cpp_source.html#l00069">69</a> of file <a class="el" href="MAIN_8cpp_source.html">MAIN.cpp</a>.</p>

<p>References <a class="el" href="EntreeSortie_8h_source.html#l00032">Cerr</a>, <a class="el" href="MAIN_8cpp_source.html#l00066">DEFAULT_CHECK_ENABLED</a>, <a class="el" href="arch_8cpp_source.html#l00055">desalloue_pwd()</a>, <a class="el" href="MAIN_8cpp_source.html#l00038">directory_separator</a>, <a class="el" href="mon__main_8cpp_source.html#l00278">mon_main::dowork()</a>, <a class="el" href="Process_8cpp_source.html#l00223">Process::exit()</a>, <a class="el" href="Nom_8cpp_source.html#l00470">Nom::finit_par()</a>, <a class="el" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>, <a class="el" href="mon__main_8cpp_source.html#l00178">mon_main::init_parallel()</a>, <a class="el" href="Process_8cpp_source.html#l00095">Process::je_suis_maitre()</a>, <a class="el" href="Nom_8cpp_source.html#l00334">Nom::longueur()</a>, <a class="el" href="Process_8cpp_source.html#l00117">Process::me()</a>, <a class="el" href="Process_8cpp_source.html#l00109">Process::nproc()</a>, <a class="el" href="Nom_8cpp_source.html#l00484">Nom::prefix()</a>, <a class="el" href="arch_8cpp_source.html#l00064">pwd()</a>, <a class="el" href="Nom_8cpp_source.html#l00653">Nom::substr_old()</a>, and <a class="el" href="MAIN_8cpp_source.html#l00042">usage()</a>.</p>

<p>Referenced by <a class="el" href="ProblemTrio_8cpp_source.html#l00145">ICoCo::ProblemTrio::initialize()</a>, and <a class="el" href="the__main_8cpp_source.html#l00026">main()</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="preprocessor">#ifdef VTRACE</span>
<span class="preprocessor"></span><span class="comment">// VT_USER_END(&quot;Initialization&quot;);</span>
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span><span class="comment">// Attention: on n&#39;a pas le droit d&#39;utiliser les communications paralleles au debut.</span>
<span class="comment">// Cerr et Cout sont OK (variables statiques dans Journal_log_files.cpp)</span>
<span class="comment">// Le journal peut etre utilise mais ecrit dans Sortie_Nulle jusqu&#39;a ce qu&#39;on ouvre</span>
<span class="comment">// les fichiers (voir Journal_log_files.cpp)</span>
<span class="comment">// </span>
<span class="comment">// Voir &lt;PARALLEL_OK&gt;</span>

<span class="comment">// *************** Process command-line arguments ********************</span>
  <span class="keywordtype">int</span> with_mpi = force_mpi;
  <span class="keywordtype">int</span> check_enabled = <a class="code" href="MAIN_8cpp.html#ac84fdfce462a43800dfab9c412a2b8e5">DEFAULT_CHECK_ENABLED</a>;
  <span class="keywordtype">int</span> with_petsc = -1;       <span class="comment">//!&lt; -1 =&gt; use petsc if compiled</span>
<span class="comment"></span>  <span class="keywordtype">int</span> nproc = -1;
  <span class="keywordtype">int</span> verbose_level = 1;
  <span class="keywordtype">int</span> journal_master = 0;
  <span class="keywordtype">int</span> journal_shared = 0;
  <span class="keywordtype">int</span> helptrust = 0;
  <span class="keywordtype">int</span> ieee = 1;              <span class="comment">//!&lt; 1 =&gt; use of feenableexcept(FE_DIVBYZERO | FE_INVALID | FE_OVERFLOW); int ieee = 0;              // PolyMAC ?</span>
<span class="comment"></span><span class="comment">//</span>
  <span class="keywordtype">bool</span> apply_verification = <span class="keyword">true</span>;
  <span class="keywordtype">int</span> disable_stop = 0;
  <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> data_file;
  data_file = <span class="stringliteral">&quot;&quot;</span>;
  <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> exec_script;
  exec_script = <span class="stringliteral">&quot;&quot;</span>;
  <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> arguments_info;
  arguments_info = <span class="stringliteral">&quot;Executable: &quot;</span>;
  arguments_info += argv[0];
  arguments_info += <span class="stringliteral">&quot;\n&quot;</span>;
  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; argc; i++)
    {
<span class="comment">// int error = 0;</span>
<span class="comment">// Le -help est reserve par Petsc</span>
      <span class="keywordflow">if</span> (strcmp(argv[i], <span class="stringliteral">&quot;-help_trust&quot;</span>) == 0)
        {
          helptrust = 1;
        }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[i], <span class="stringliteral">&quot;-disable_ieee&quot;</span>) == 0)
        {
          ieee = 0;
          arguments_info += <span class="stringliteral">&quot;-disable_ieee =&gt; disable of feenableexcept\n&quot;</span>;
        }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[i], <span class="stringliteral">&quot;-mpi&quot;</span>) == 0)
        {
          with_mpi = 1;
          arguments_info += <span class="stringliteral">&quot;-mpi =&gt; parallel computation with mpi\n&quot;</span>;
        }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[i], <span class="stringliteral">&quot;-no_verify&quot;</span>) == 0)
        {
          apply_verification = <span class="keyword">false</span>;
          arguments_info += <span class="stringliteral">&quot;-no_verify =&gt; Disable the call to verifie function (from Type_Verifie) to catch outdated keywords while reading data file.\n&quot;</span>;
        }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[i], <span class="stringliteral">&quot;-check_enabled=1&quot;</span>) == 0)
        {
          check_enabled = 1;
          arguments_info += <span class="stringliteral">&quot;-check_enabled=1 =&gt; force enable parallel message checking\n&quot;</span>;
        }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[i], <span class="stringliteral">&quot;-check_enabled=0&quot;</span>) == 0)
        {
          check_enabled = 0;
          arguments_info += <span class="stringliteral">&quot;-check_enabled=0 =&gt; force disable parallel message checking\n&quot;</span>;
        }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(argv[i], <span class="stringliteral">&quot;-debugscript=&quot;</span>, 13) == 0)
        {
          exec_script = argv[i]+13;
          arguments_info += <span class="stringliteral">&quot;-debugscript =&gt; execute script &quot;</span>;
          arguments_info += exec_script;
          arguments_info += <span class="stringliteral">&quot;\n&quot;</span>;
        }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[i], <span class="stringliteral">&quot;-petsc=0&quot;</span>) == 0)
        {
          with_petsc = 0;
          arguments_info += <span class="stringliteral">&quot;-petsc=0 =&gt; disable call to PetscInitialize\n&quot;</span>;
        }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(argv[i], <span class="stringliteral">&quot;-journal=&quot;</span>, 9) == 0)
        {
          <span class="keywordtype">int</span> level = atoi(argv[i]+9);
          <span class="keywordflow">if</span> (level &lt; 0 || level &gt; 9)
            {
              <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Bad journal level : &quot;</span> &lt;&lt; argv[i] &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<span class="comment">// error = 1;</span>
            }
          <span class="keywordflow">else</span>
            {
              verbose_level = level;
              arguments_info += <span class="stringliteral">&quot;-journal=&quot;</span>;
              arguments_info += <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(level);
              arguments_info += <span class="stringliteral">&quot;\n&quot;</span>;
            }
        }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[i], <span class="stringliteral">&quot;-journal_master&quot;</span>) == 0)
        {
          journal_master = 1;
          arguments_info += <span class="stringliteral">&quot;-journal_master =&gt; Only the master processor will write a journal&quot;</span>;
          <span class="keywordflow">if</span>(journal_shared)
            {
              journal_shared = 0;
              arguments_info += <span class="stringliteral">&quot; (journal_shared is thus ignored)&quot;</span>;
            }
          arguments_info += <span class="stringliteral">&quot;\n&quot;</span>;
        }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[i], <span class="stringliteral">&quot;-journal_shared&quot;</span>) == 0)
        {
          journal_shared = 1;
          arguments_info += <span class="stringliteral">&quot;-journal_shared =&gt; all the processors are going to write in a unique journal file&quot;</span>;
          <span class="keywordflow">if</span>(journal_master)
            {
              journal_master = 0;
              arguments_info += <span class="stringliteral">&quot; (journal_master is thus ignored)&quot;</span>;
            }
          arguments_info += <span class="stringliteral">&quot;\n&quot;</span>;
        }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[i], <span class="stringliteral">&quot;-disable_stop&quot;</span>) == 0)
        {
          disable_stop = 1;
          arguments_info += <span class="stringliteral">&quot;-disable_stop =&gt; Disable the writing of the .stop file.\n&quot;</span>;
        }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == 1)
        {
<span class="comment">// Les deux derniers tests doivent rester a la fin, inserer les arguments supplementaires avant.</span>
          data_file = argv[1];
          arguments_info += <span class="stringliteral">&quot;Data file name = &quot;</span>;
          arguments_info += data_file;
          arguments_info += <span class="stringliteral">&quot;\n&quot;</span>;
        }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == 2)
        {
          errno = 0;
          <span class="keywordtype">int</span> nprocs = strtol(argv[2], (<span class="keywordtype">char</span> **)NULL, 10);
          <span class="keywordflow">if</span> (!errno &amp;&amp; nprocs)
            {
              nproc = nprocs;
              <span class="keywordflow">if</span> (nproc &gt; 1)
                {
                  with_mpi = 1;
                  arguments_info += <span class="stringliteral">&quot;Running in parallel with &quot;</span>;
                  arguments_info += <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(nproc);
                  arguments_info += <span class="stringliteral">&quot; processors\n&quot;</span>;
                }
              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nproc == 1)
                {
                  arguments_info += <span class="stringliteral">&quot;Sequential calculation\n&quot;</span>;
                }
              <span class="keywordflow">else</span>
                {
                  <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Bad number of processors in old syntax TRUST case N&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<span class="comment">// error = 1;</span>
                }
            }
          <span class="keywordflow">else</span>
            {
              <span class="comment">/*</span>
<span class="comment">                      Nom fichier=argv[i];</span>
<span class="comment">                      fichier.prefix(&quot;.data&quot;);</span>
<span class="comment">                      fichier+=&quot;.data&quot;;</span>
<span class="comment">                      EFichier fic(fichier);</span>
<span class="comment">                      if(fic.fail())</span>
<span class="comment">                        {</span>
<span class="comment">                          Cerr &lt;&lt; &quot;Trying to open file &quot; &lt;&lt; fichier &lt;&lt; finl;</span>
<span class="comment">                          Cerr &lt;&lt; &quot;File &quot; &lt;&lt; fichier &lt;&lt; &quot; doesnt exist !&quot; &lt;&lt; finl;</span>
<span class="comment">                          Process::exit();</span>
<span class="comment">                        }</span>
<span class="comment">                      else</span>
<span class="comment">                        {</span>
<span class="comment">                          data_file = fichier.prefix(&quot;.data&quot;);</span>
<span class="comment">                        }</span>
<span class="comment">// Mise en commentaire car dans certains scripts verifie on teste: trust $jdd -ksp_view</span>
<span class="comment">              */</span>
<span class="comment">// error = 1;</span>
            }
        }
      <span class="keywordflow">else</span>
        {
<span class="comment">// error = 1;</span>
        }
      <span class="comment">/* PL: Je desactive car MPICH rajoute des arguments derriere le nombre de processeurs:</span>
<span class="comment">         ... TRUST_mpich_opt jdd 2 -p4pg .../PINNNN -p4wd pathname</span>
<span class="comment">         if (error) {</span>
<span class="comment">         Cerr &lt;&lt; &quot;TRUST error processing command line, argument &quot; &lt;&lt; i &lt;&lt; &quot; : \n &quot;</span>
<span class="comment">         &lt;&lt; argv[i] &lt;&lt; finl;</span>
<span class="comment">         usage();</span>
<span class="comment">// if (i==1) Cerr &lt;&lt; &quot;Arguments lus: &quot; &lt;&lt; argv[0];</span>
<span class="comment">// Cerr &lt;&lt; &quot; &quot; &lt;&lt; argv[i];</span>
<span class="comment">         } */</span>
    }

  {

    <span class="keywordflow">if</span> ( ieee == 1 )
      {
        <span class="keywordtype">char</span>* theValue = getenv(<span class="stringliteral">&quot;TRUST_DISABLE_FP_EXCEPT&quot;</span>);
        <span class="keywordflow">if</span> (theValue == NULL || atoi(theValue) == 0)
          {
            arguments_info += <span class="stringliteral">&quot;feenableexcept enabled.\n&quot;</span>;
<span class="preprocessor">#ifdef linux</span>
<span class="preprocessor"></span><span class="comment">// Detect all NaNs (don&#39;t add FE_UNDERFLOW cause exp(-x) with x big throws an exception)</span>
<span class="comment">// Test pre 1.7.0, on active en optimise:</span>
<span class="preprocessor">#ifndef _COMPILE_AVEC_CLANG</span>
<span class="preprocessor"></span><span class="preprocessor">#ifndef _COMPILE_AVEC_FCC //!&lt; Crashes bizarres </span>
<span class="preprocessor"></span>            feenableexcept(FE_DIVBYZERO | FE_INVALID | FE_OVERFLOW);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor"></span>          }
      }

<span class="comment">// ************** Initialisation de Petsc, du parallele (si Petsc) **********</span>
<span class="comment">// .. et demarrage du journal</span>
<span class="comment">// (tout ce qu&#39;on veut faire en commun avec l&#39;interface python doit etre</span>
<span class="comment">// mis dans mon_main)</span>
    main_process=<span class="keyword">new</span>  <a class="code" href="classmon__main.html" title="Classe creee et executee par main() et lors d&#39;une execution TRUST a travers Python. Il faut - creer une instance mon_main - initialiser le parallele - appeler dowork(nom_du_cas) (lecture et interpretation du jdd) A cet instant on peut jouer avec les objets crees en python (voir Interprete_bloc::objet_global(nom)) - detruire l&#39;instance mon_main L&#39;interprete principal conserve ses objets jusqu&#39;a la destruction de l&#39;instance mon_main.">mon_main</a>(verbose_level, journal_master, journal_shared, apply_verification, disable_stop);

    main_process-&gt;<a class="code" href="classmon__main.html#a6a95809188c22c231e854529b7d8c2d8">init_parallel</a>(argc, argv, with_mpi, check_enabled, with_petsc);

<span class="comment">// *************************  &lt;PARALLEL_OK&gt; *****************************</span>
<span class="comment">// A partir d&#39;ici on a le droit d&#39;utiliser les communications entre processeurs,</span>
<span class="comment">// me() etc...</span>
    <span class="keyword">const</span> <span class="keywordtype">int</span> master = <a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>();

<span class="comment">// Modif B.Mathieu 28/09/2004 :</span>
<span class="comment">// Pour debugger trust, on donne parametre le nom</span>
<span class="comment">// d&#39;une commande systeme a executer lorsqu&#39;on arrive a cet endroit.</span>
<span class="comment">// Le plus pratique, c&#39;est d&#39;utiliser un shell script qui ouvre</span>
<span class="comment">// un xterm et lance gdb. On peut aussi faire un tail -f du fichier log,</span>
<span class="comment">// etc...</span>
<span class="comment">// La commande est executee avec comme parametre le numero du PE.</span>
    <span class="keywordflow">if</span>(exec_script != <span class="stringliteral">&quot;&quot;</span>)
      {
        exec_script += <span class="stringliteral">&quot; &quot;</span>;
        exec_script += <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(<a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>());
        <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;[&quot;</span> &lt;&lt; <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>() &lt;&lt; <span class="stringliteral">&quot;] Debug mode =&gt; execute command : &quot;</span> &lt;&lt; exec_script &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
        std::cerr &lt;&lt; system(exec_script) &lt;&lt; std::endl;
      }

    <span class="keywordflow">if</span> (master)
      {
        <span class="keywordflow">if</span> ( helptrust == 1 ) <a class="code" href="MAIN_8cpp.html#a2ef30c42cbc289d899a8be5d2d8f77d0">usage</a>();

<span class="comment">// On affiche le resultat de la ligne de commande ici pour ne pas remplir stderr</span>
<span class="comment">// avec tous les processeurs...</span>
        <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; arguments_info;

        <span class="keywordflow">if</span> (nproc != -1 &amp;&amp; <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>() != nproc)
          {
            <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error: nproc on command line does not match mpirun parameter.\n&quot;</span>
                 &lt;&lt; <span class="stringliteral">&quot; Use same number or -mpi parameter instead.&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
            <a class="code" href="MAIN_8cpp.html#a2ef30c42cbc289d899a8be5d2d8f77d0">usage</a>();
          }
      }

    cerr.setf(ios::scientific);
    cerr.precision(12);
    cout.setf(ios::scientific);
    cout.precision(12);

<span class="comment">// ****************** Nom du cas ***********************</span>
    <span class="keywordflow">if</span> (data_file == <span class="stringliteral">&quot;&quot;</span>)
      {
<span class="comment">// TRUST sans argument =&gt; nom du cas = nom du repertoire courant</span>
        <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> <a class="code" href="arch_8cpp.html#a7a8e98611cd2044f91732950bd1c303b" title="_ARCH_H_">pwd</a>(::<a class="code" href="arch_8cpp.html#a7a8e98611cd2044f91732950bd1c303b" title="_ARCH_H_">pwd</a>());
        <span class="keywordflow">if</span> (master)
          <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;No command line argument. Data file name from directory name:\n &quot;</span>
               &lt;&lt; <a class="code" href="arch_8cpp.html#a7a8e98611cd2044f91732950bd1c303b" title="_ARCH_H_">pwd</a> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
        <span class="keyword">const</span> <span class="keywordtype">int</span> l = <a class="code" href="arch_8cpp.html#a7a8e98611cd2044f91732950bd1c303b" title="_ARCH_H_">pwd</a>.longueur() - 1; <span class="comment">//!&lt; Attention, longueur()=strlen+1</span>
<span class="comment"></span>        <span class="keywordtype">int</span> i = l - 1;
        <span class="keywordflow">while</span>(i &gt; 0 &amp;&amp; <a class="code" href="arch_8cpp.html#a7a8e98611cd2044f91732950bd1c303b" title="_ARCH_H_">pwd</a>[i] != <a class="code" href="MAIN_8cpp.html#ac49acbee6fad41657b26bc355c9cddeb">directory_separator</a>)
          {
            i--;
          }
        <span class="keywordflow">if</span> (i == l - 1)
          {
            <span class="keywordflow">if</span> (master)
              {
                <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error : pwd() ends with directory separator &quot;</span> &lt;&lt; (int)<a class="code" href="MAIN_8cpp.html#ac49acbee6fad41657b26bc355c9cddeb">directory_separator</a> &lt;&lt; finl;
                <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
              }
          }
        data_file = <a class="code" href="arch_8cpp.html#a7a8e98611cd2044f91732950bd1c303b" title="_ARCH_H_">pwd</a>.substr_old(i + 2, l - i - 1); <span class="comment">//!&lt; Attention, voir Nom::substr()</span>
<span class="comment"></span>      }
    <span class="keywordflow">if</span> (master)
      {
        <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Data file : &quot;</span> &lt;&lt; data_file &lt;&lt; finl;
      }
<span class="comment">// Si le nom du cas finit par .data, on l&#39;enleve.</span>
    <span class="keywordflow">if</span> (data_file.<a class="code" href="classNom.html#afc0e84c6c4f4b7b65bfb8f46f3ced45b">finit_par</a>(<span class="stringliteral">&quot;.data&quot;</span>))
      {
        <span class="keywordflow">if</span> (master)
          {
            <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; (removing .data extension)&quot;</span> &lt;&lt; finl;
          }
        data_file.<a class="code" href="classNom.html#aa296fc70f7abcf978968e09582d8fb06">prefix</a>(<span class="stringliteral">&quot;.data&quot;</span>);
      }



    <span class="keywordflow">if</span> (master)
      {
        <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;Localisation etude: &quot;</span> &lt;&lt;<a class="code" href="arch_8cpp.html#a7a8e98611cd2044f91732950bd1c303b" title="_ARCH_H_"> ::pwd</a>() &lt;&lt; finl;
        <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;Nom du cas &quot;</span> &lt;&lt; data_file &lt;&lt; finl;
        <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot; code : &quot;</span>&lt;&lt; argv[0] &lt;&lt; finl;
        <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot; version : 1.8.4 &quot;</span> &lt;&lt; finl;
      }

    main_process-&gt;<a class="code" href="classmon__main.html#a4f9df706fe29c9a9bc8086d5b5032216">dowork</a>(data_file);

    <span class="keywordflow">if</span> (master)
      {
        <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Arret des processes.&quot;</span> &lt;&lt; finl;
      }
  }

<span class="comment">// pour detruire les derniers octets</span>
  <a class="code" href="arch_8cpp.html#ab80403809e7e0cc95ebbdd90a5d18dd5">desalloue_pwd</a>();
  <span class="keywordflow">return</span> (0);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2ef30c42cbc289d899a8be5d2d8f77d0"></a><!-- doxytag: member="MAIN.cpp::usage" ref="a2ef30c42cbc289d899a8be5d2d8f77d0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void usage </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MAIN_8cpp_source.html#l00042">42</a> of file <a class="el" href="MAIN_8cpp_source.html">MAIN.cpp</a>.</p>

<p>References <a class="el" href="EntreeSortie_8h_source.html#l00032">Cerr</a>, <a class="el" href="Process_8cpp_source.html#l00223">Process::exit()</a>, and <a class="el" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>.</p>

<p>Referenced by <a class="el" href="MAIN_8cpp_source.html#l00069">main_TRUST()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;usage:\n&quot;</span>;
  <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;TRUST_EXECUTABLE [CASE[.data]] [options]\n&quot;</span>;
  <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; CASE is the basename of the trust data file (must have .data extension)\n&quot;</span>;
  <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;   If no CASE given, the current directory name is used\n&quot;</span>;
  <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; -help_trust =&gt; print options\n&quot;</span>;
  <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; -mpi =&gt; run in parallel with MPI (must run with mpirun)\n&quot;</span>;
  <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; -check_enabled=0|1  =&gt; enables or disables runtime checking of parallel messages\n&quot;</span>;
  <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; -debugscript=SCRIPT =&gt; execute \&quot;SCRIPT n\&quot; after parallel initialisation, n=processor rank\n&quot;</span>;
  <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; -petsc=0            =&gt; disable call to PetscInitialize\n&quot;</span>;
  <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; -journal=0..9       =&gt; select journal level (0=disable, 9=maximum verbosity)\n&quot;</span>;
  <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; -journal_master     =&gt; only master processor writes a journal (not compatible with journal_shared)\n&quot;</span>;
  <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; -journal_shared     =&gt; each processor writes in a single log file (not compatible with journal_master)\n&quot;</span>;
  <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; -disable_ieee       =&gt; Disable the detection of NaNs. The detection can also be de-activated with env variable TRUST_DISABLE_FP_EXCEPT set to non zero.\n&quot;</span>;
  <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; -no_verify          =&gt; Disable the call to verifie function (from Type_Verifie) to catch outdated keywords while reading data file.\n&quot;</span>;
  <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; -disable_stop       =&gt; Disable the writing of the .stop file.\n&quot;</span>;
  <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
  <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
}
</pre></div>
</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ac49acbee6fad41657b26bc355c9cddeb"></a><!-- doxytag: member="MAIN.cpp::directory_separator" ref="ac49acbee6fad41657b26bc355c9cddeb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char <a class="el" href="MAIN_8cpp.html#ac49acbee6fad41657b26bc355c9cddeb">directory_separator</a> = '/'<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MAIN_8cpp_source.html#l00038">38</a> of file <a class="el" href="MAIN_8cpp_source.html">MAIN.cpp</a>.</p>

<p>Referenced by <a class="el" href="MAIN_8cpp_source.html#l00069">main_TRUST()</a>.</p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:56 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
