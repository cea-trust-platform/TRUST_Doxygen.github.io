<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/Kernel/Math/SolvSys/Solv_GCP_NS.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/Kernel/Math/SolvSys/Solv_GCP_NS.cpp</div>  </div>
</div>
<div class="contents">
<a href="Solv__GCP__NS_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (c) 2015 - 2016, CEA</span>
<a name="l00003"></a>00003 <span class="comment">* All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment">* 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00007"></a>00007 <span class="comment">* 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00008"></a>00008 <span class="comment">* 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<a name="l00011"></a>00011 <span class="comment">* IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;</span>
<a name="l00012"></a>00012 <span class="comment">* OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// File:        Solv_GCP_NS.cpp</span>
<a name="l00018"></a>00018 <span class="comment">// Directory:   $TRUST_ROOT/src/Kernel/Math/SolvSys</span>
<a name="l00019"></a>00019 <span class="comment">// Version:     /main/23</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;<a class="code" href="Solv__GCP__NS_8h.html">Solv_GCP_NS.h</a>&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="Matrice__Bloc__Sym_8h.html">Matrice_Bloc_Sym.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="ConstDoubleTab__parts_8h.html">ConstDoubleTab_parts.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="Motcle_8h.html">Motcle.h</a>&gt;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a><a class="code" href="Solv__GCP__NS_8cpp.html#a32d879acc02f9eaf622c947954c079da">00028</a> <a class="code" href="Op__Diff__CoviMAC__Face_8cpp.html#aa86ec8ba612a969d9b4370b775037144">Implemente_instanciable</a>(<a class="code" href="classSolv__GCP__NS.html">Solv_GCP_NS</a>,<span class="stringliteral">&quot;Solv_GCP_NS&quot;</span>,<a class="code" href="classsolv__iteratif.html">solv_iteratif</a>);
<a name="l00029"></a>00029 <span class="comment">// </span>
<a name="l00030"></a>00030 <span class="comment">// printOn et readOn</span>
<a name="l00031"></a>00031 
<a name="l00032"></a><a class="code" href="classSolv__GCP__NS.html#a4d617ed1d1a06c8d02cc346813cdf17b">00032</a> <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classSolv__GCP__NS.html#a4d617ed1d1a06c8d02cc346813cdf17b" title="Ecriture de l&#39;objet sur un flot de sortie Methode a surcharger.">Solv_GCP_NS::printOn</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; s )<span class="keyword"> const</span>
<a name="l00033"></a>00033 <span class="keyword"></span>{
<a name="l00034"></a>00034   <span class="keywordflow">return</span> s ;
<a name="l00035"></a>00035 }
<a name="l00036"></a>00036 
<a name="l00037"></a><a class="code" href="classSolv__GCP__NS.html#a12623e770cca73f5c0fed0b01014d3bb">00037</a> <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classSolv__GCP__NS.html#a12623e770cca73f5c0fed0b01014d3bb" title="Lecture d&#39;un Objet_U sur un flot d&#39;entree Methode a surcharger.">Solv_GCP_NS::readOn</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is )
<a name="l00038"></a>00038 {
<a name="l00039"></a>00039   <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> accolade_ouverte(<span class="stringliteral">&quot;{&quot;</span>);
<a name="l00040"></a>00040   <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> accolade_fermee(<span class="stringliteral">&quot;}&quot;</span>);
<a name="l00041"></a>00041   <a class="code" href="classMotcles.html" title="Un tableau d&#39;objets de la classe Motcle.">Motcles</a> les_parametres(6);
<a name="l00042"></a>00042   {
<a name="l00043"></a>00043     les_parametres[0] = <span class="stringliteral">&quot;seuil&quot;</span>;
<a name="l00044"></a>00044     les_parametres[1] = <span class="stringliteral">&quot;solveur1&quot;</span>;
<a name="l00045"></a>00045     les_parametres[2] = <span class="stringliteral">&quot;solveur0&quot;</span>;
<a name="l00046"></a>00046     les_parametres[3] = <span class="stringliteral">&quot;impr&quot;</span>;
<a name="l00047"></a>00047     les_parametres[4] = <span class="stringliteral">&quot;precond&quot;</span>;
<a name="l00048"></a>00048     les_parametres[5] = <span class="stringliteral">&quot;quiet&quot;</span>;
<a name="l00049"></a>00049   }
<a name="l00050"></a>00050   <span class="keywordtype">int</span> rang;
<a name="l00051"></a>00051 
<a name="l00052"></a>00052   <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> motlu;
<a name="l00053"></a>00053   is &gt;&gt; motlu;
<a name="l00054"></a>00054   <span class="keywordflow">if</span> (motlu != accolade_ouverte)
<a name="l00055"></a>00055     {
<a name="l00056"></a>00056       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error when reading the parameters of the conjugate gradient SSOR &quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00057"></a>00057       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;One expected : &quot;</span> &lt;&lt; accolade_ouverte &lt;&lt; finl;
<a name="l00058"></a>00058       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00059"></a>00059     }
<a name="l00060"></a>00060   is &gt;&gt; motlu;
<a name="l00061"></a>00061   <span class="keywordflow">while</span> (motlu != accolade_fermee)
<a name="l00062"></a>00062     {
<a name="l00063"></a>00063       rang = les_parametres.<a class="code" href="classMotcles.html#afecd68f73e904bc129022a236ff6ab15">search</a>(motlu);
<a name="l00064"></a>00064       <span class="keywordflow">switch</span>(rang)
<a name="l00065"></a>00065         {
<a name="l00066"></a>00066         <span class="keywordflow">case</span> 0:
<a name="l00067"></a>00067           {
<a name="l00068"></a>00068             is &gt;&gt; <a class="code" href="classsolv__iteratif.html#a726974e9a0579e0c242606430dc320d4">seuil_</a>;
<a name="l00069"></a>00069             <span class="keywordflow">break</span>;
<a name="l00070"></a>00070           }
<a name="l00071"></a>00071         <span class="keywordflow">case</span> 1:
<a name="l00072"></a>00072           {
<a name="l00073"></a>00073             is &gt;&gt; <a class="code" href="classSolv__GCP__NS.html#ac75ff04d625128689c6b8c8ade054c40" title="Matrice_Morse_Sym non supporte.">solveur_poisson1</a>;
<a name="l00074"></a>00074             solveur_poisson1.<a class="code" href="classSolveurSys.html#a17fa90c93f514a6d2a898e682e724d3b" title="Donne un nom a l&#39;Objet_U Methode virtuelle a surcharger.">nommer</a>(<span class="stringliteral">&quot;poisson_solver1&quot;</span>);
<a name="l00075"></a>00075             <span class="keywordflow">break</span>;
<a name="l00076"></a>00076           }
<a name="l00077"></a>00077         <span class="keywordflow">case</span> 2:
<a name="l00078"></a>00078           {
<a name="l00079"></a>00079             is &gt;&gt; <a class="code" href="classSolv__GCP__NS.html#a25f29c2cef575aabcbc6b18dddb37486">solveur_poisson0</a>;
<a name="l00080"></a>00080             solveur_poisson0.<a class="code" href="classSolveurSys.html#a17fa90c93f514a6d2a898e682e724d3b" title="Donne un nom a l&#39;Objet_U Methode virtuelle a surcharger.">nommer</a>(<span class="stringliteral">&quot;poisson_solver0&quot;</span>);
<a name="l00081"></a>00081             <span class="keywordflow">break</span>;
<a name="l00082"></a>00082           }
<a name="l00083"></a>00083         <span class="keywordflow">case</span> 3:
<a name="l00084"></a>00084           {
<a name="l00085"></a>00085             <a class="code" href="classSolveurSys__base.html#a987e97740c779c1ab4192c3c1f1bbd5d">fixer_limpr</a>(1);
<a name="l00086"></a>00086             <span class="keywordflow">break</span>;
<a name="l00087"></a>00087           }
<a name="l00088"></a>00088         <span class="keywordflow">case</span> 4:
<a name="l00089"></a>00089           {
<a name="l00090"></a>00090             is &gt;&gt; <a class="code" href="classSolv__GCP__NS.html#a068a76a7b10253311ae3b24e5887a3c1">le_precond_</a>;
<a name="l00091"></a>00091             <span class="keywordflow">break</span>;
<a name="l00092"></a>00092           }
<a name="l00093"></a>00093         <span class="keywordflow">case</span> 5:
<a name="l00094"></a>00094           {
<a name="l00095"></a>00095             <a class="code" href="classSolveurSys__base.html#a987e97740c779c1ab4192c3c1f1bbd5d">fixer_limpr</a>(-1);
<a name="l00096"></a>00096             <span class="keywordflow">break</span>;
<a name="l00097"></a>00097           }
<a name="l00098"></a>00098         <span class="keywordflow">default</span> :
<a name="l00099"></a>00099           {
<a name="l00100"></a>00100             <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error when reading the parameters of the conjugate gradient SSOR &quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00101"></a>00101             <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;One expected &quot;</span> &lt;&lt; les_parametres &lt;&lt; <span class="stringliteral">&quot; instead of &quot;</span> &lt;&lt; motlu &lt;&lt; finl;
<a name="l00102"></a>00102             <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00103"></a>00103           }
<a name="l00104"></a>00104         }
<a name="l00105"></a>00105       is &gt;&gt; motlu;
<a name="l00106"></a>00106     }
<a name="l00107"></a>00107   <span class="keywordflow">return</span> is;
<a name="l00108"></a>00108 }
<a name="l00109"></a>00109 
<a name="l00110"></a><a class="code" href="Solv__GCP__NS_8cpp.html#ab40d0fdc5e4d6521200d423bd9aa2645">00110</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="Solv__GCP__NS_8cpp.html#ab40d0fdc5e4d6521200d423bd9aa2645">corriger</a>(<a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; X,
<a name="l00111"></a>00111                             <span class="keywordtype">double</span> alpha,
<a name="l00112"></a>00112                             <span class="keywordtype">double</span> beta,
<a name="l00113"></a>00113                             <span class="keyword">const</span> <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; X1,
<a name="l00114"></a>00114                             <span class="keyword">const</span> <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; X0,
<a name="l00115"></a>00115                             <span class="keywordtype">int</span> prems, <span class="keywordtype">int</span> n)
<a name="l00116"></a>00116 {
<a name="l00117"></a>00117   <span class="keywordtype">int</span> <a class="code" href="Nom_8cpp.html#a0e1ea19fb9fa7881d15d84eff4c090e1">sz</a>=prems+n;
<a name="l00118"></a>00118   <span class="keywordtype">int</span> i=0;
<a name="l00119"></a>00119   <span class="keywordflow">for</span>(; i&lt;prems; i++)
<a name="l00120"></a>00120     X(i)+=beta*X0(i);
<a name="l00121"></a>00121   <span class="keywordflow">for</span>(; i&lt;<a class="code" href="Nom_8cpp.html#a0e1ea19fb9fa7881d15d84eff4c090e1">sz</a>; i++)
<a name="l00122"></a>00122     X(i)+=alpha*X1(i-prems);
<a name="l00123"></a>00123 }
<a name="l00124"></a>00124 
<a name="l00125"></a>00125 
<a name="l00126"></a><a class="code" href="Solv__GCP__NS_8cpp.html#a8e4bab30677c40a2bfaa0e81b86e1375">00126</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="Solv__GCP__NS_8cpp.html#a8e4bab30677c40a2bfaa0e81b86e1375">injecter</a>(<span class="keyword">const</span> <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; X, <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; tmp,
<a name="l00127"></a>00127                             <span class="keywordtype">int</span> prems, <span class="keywordtype">int</span> n)
<a name="l00128"></a>00128 {
<a name="l00129"></a>00129   <span class="keywordtype">int</span> <a class="code" href="Nom_8cpp.html#a0e1ea19fb9fa7881d15d84eff4c090e1">sz</a>=prems+n;
<a name="l00130"></a>00130   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=prems; i&lt;<a class="code" href="Nom_8cpp.html#a0e1ea19fb9fa7881d15d84eff4c090e1">sz</a>; i++)
<a name="l00131"></a>00131     tmp(i)=X(i-prems);
<a name="l00132"></a>00132 }
<a name="l00133"></a><a class="code" href="Solv__GCP__NS_8cpp.html#a50f88402654f60390e92dcb5a88cfcdb">00133</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="Solv__GCP__NS_8cpp.html#a50f88402654f60390e92dcb5a88cfcdb">extraire</a>(<a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; X, <span class="keyword">const</span> <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; tmp,
<a name="l00134"></a>00134                             <span class="keywordtype">int</span> prems, <span class="keywordtype">int</span> n)
<a name="l00135"></a>00135 {
<a name="l00136"></a>00136   <span class="keywordtype">int</span> <a class="code" href="Nom_8cpp.html#a0e1ea19fb9fa7881d15d84eff4c090e1">sz</a>=prems+n;
<a name="l00137"></a>00137   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=prems; i&lt;<a class="code" href="Nom_8cpp.html#a0e1ea19fb9fa7881d15d84eff4c090e1">sz</a>; i++)
<a name="l00138"></a>00138     X(i-prems)=tmp(i);
<a name="l00139"></a>00139 }
<a name="l00140"></a>00140 
<a name="l00141"></a><a class="code" href="Solv__GCP__NS_8cpp.html#ab6aa1075b965c7713d8db20dd3a8e09b">00141</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="Solv__GCP__NS_8cpp.html#ab6aa1075b965c7713d8db20dd3a8e09b">erreur</a>()
<a name="l00142"></a>00142 {
<a name="l00143"></a>00143   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;The dedicated solver GCP_NS can be used only for blocks symetric matrixes&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00144"></a>00144   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;containing 2*2 blocks for VEF discretization P0+P1.&quot;</span> &lt;&lt; finl;
<a name="l00145"></a>00145   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00146"></a>00146 }
<a name="l00147"></a>00147 
<a name="l00148"></a><a class="code" href="classSolv__GCP__NS.html#a9664e3d751607a5bedc6e995b01eea51">00148</a> <span class="keywordtype">int</span> <a class="code" href="classSolv__GCP__NS.html#a5c58f2c5fa511f7ef0f5920b1544d091">Solv_GCP_NS::resoudre_systeme</a>(<span class="keyword">const</span> <a class="code" href="classMatrice__Base.html">Matrice_Base</a>&amp; matrice,
<a name="l00149"></a>00149                                   <span class="keyword">const</span> <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; secmem,
<a name="l00150"></a>00150                                   <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; solution,
<a name="l00151"></a>00151 
<a name="l00152"></a>00152                                   <span class="keywordtype">int</span> niter_max)
<a name="l00153"></a>00153 {
<a name="l00154"></a>00154 <span class="comment">// A00 X0 + A01 X1 = F0</span>
<a name="l00155"></a>00155 <span class="comment">// A10 X0 + A11 X1 = F1</span>
<a name="l00156"></a>00156 <span class="comment">// X1 = A11^(-1) (F1 - A10 X0)</span>
<a name="l00157"></a>00157 <span class="comment">// X0 = (A00 -A01 A11^(-1) A10) (F0 - A01 A11^(-1) F1)</span>
<a name="l00158"></a>00158 <span class="comment">// </span>
<a name="l00159"></a>00159 <span class="comment">// Gradient conjugue sur ce systeme preconditionne par A00</span>
<a name="l00160"></a>00160 <span class="comment">// </span>
<a name="l00161"></a>00161 <span class="comment">// Cerr &lt;&lt; &quot;resoudre_systeme : secmem&quot; &lt;&lt; secmem &lt;&lt; finl;</span>
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 <span class="comment">// int n = secmem.size();</span>
<a name="l00164"></a>00164   assert(solution.<a class="code" href="classDoubleVect.html#ad2d21b364e1c6559771970596a25c006" title="Identique a size_array()">size_totale</a>() == secmem.<a class="code" href="classDoubleVect.html#ad2d21b364e1c6559771970596a25c006" title="Identique a size_array()">size_totale</a>());
<a name="l00165"></a>00165   <span class="keyword">const</span> <span class="keywordtype">int</span> n = secmem.<a class="code" href="classDoubleVect.html#ad2d21b364e1c6559771970596a25c006" title="Identique a size_array()">size_totale</a>();
<a name="l00166"></a>00166 
<a name="l00167"></a>00167   <span class="keyword">const</span> <a class="code" href="classMatrice__Bloc__Sym.html">Matrice_Bloc_Sym</a>&amp; matbloc=<a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classMatrice__Bloc__Sym.html">Matrice_Bloc_Sym</a>, matrice);
<a name="l00168"></a>00168   <span class="keywordflow">if</span> (matbloc.<a class="code" href="classMatrice__Bloc.html#a02193255787b0ecae7988ca4eada3b4b" title="retourne N_">nb_bloc_lignes</a>()!=2 || matbloc.<a class="code" href="classMatrice__Bloc.html#a2436d61e9c5d9e364d22fd106349cf9a" title="retourne M_">nb_bloc_colonnes</a>()!=2) <a class="code" href="Solv__GCP__NS_8cpp.html#ab6aa1075b965c7713d8db20dd3a8e09b">erreur</a>();
<a name="l00169"></a>00169 
<a name="l00170"></a>00170   <span class="keyword">const</span> <a class="code" href="classMatrice__Base.html">Matrice_Base</a>&amp; A00=matbloc.<a class="code" href="classMatrice__Bloc__Sym.html#a1002ce880ea2b2fb48dae444097c9f7a" title="(0&lt;=i&lt;N , i&lt;=j&lt;M)">get_bloc</a>(0,0);
<a name="l00171"></a>00171   <span class="keyword">const</span> <a class="code" href="classMatrice__Base.html">Matrice_Base</a>&amp; A01=matbloc.<a class="code" href="classMatrice__Bloc__Sym.html#a1002ce880ea2b2fb48dae444097c9f7a" title="(0&lt;=i&lt;N , i&lt;=j&lt;M)">get_bloc</a>(0,1);
<a name="l00172"></a>00172   <span class="keyword">const</span> <a class="code" href="classMatrice__Base.html">Matrice_Base</a>&amp; A11=matbloc.<a class="code" href="classMatrice__Bloc__Sym.html#a1002ce880ea2b2fb48dae444097c9f7a" title="(0&lt;=i&lt;N , i&lt;=j&lt;M)">get_bloc</a>(1,1);
<a name="l00173"></a>00173   <span class="keywordtype">int</span> n0=A00.<a class="code" href="classMatrice__Base.html#a78420d19112a02c5808daa50151bbb09">nb_lignes</a>();
<a name="l00174"></a>00174   <span class="keywordtype">int</span> n1=A11.<a class="code" href="classMatrice__Base.html#a78420d19112a02c5808daa50151bbb09">nb_lignes</a>();
<a name="l00175"></a>00175   <span class="keywordtype">int</span> nmax= <a class="code" href="Double_8h.html#a1c45761573e6cbc97cfacac78d905016">max</a>(<a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(n), 100);
<a name="l00176"></a>00176   <span class="keywordtype">int</span> niter = 0;
<a name="l00177"></a>00177   <span class="keywordtype">double</span> dold,dnew,alfa;
<a name="l00178"></a>00178 
<a name="l00179"></a>00179   solution=0.0;
<a name="l00180"></a>00180 <span class="comment">// Creation de tableaux distribues X1 et F1 sur les sommets</span>
<a name="l00181"></a>00181   <a class="code" href="classConstDoubleTab__parts.html" title="This class allows to acces to individual sub-parts of const DoubleTab objects that have a MD_Vector_c...">ConstDoubleTab_parts</a> mo_solution(solution);
<a name="l00182"></a>00182   <a class="code" href="classDoubleVect.html">DoubleVect</a> X1=mo_solution[1];
<a name="l00183"></a>00183 <span class="comment">// DoubleVect X1;</span>
<a name="l00184"></a>00184 <span class="comment">// champ.domaine().creer_tableau_sommets(X1);</span>
<a name="l00185"></a>00185   <a class="code" href="classDoubleVect.html">DoubleVect</a> F1(X1);
<a name="l00186"></a>00186   <span class="keywordflow">if</span> (X1.<a class="code" href="classDoubleVect.html#ad2d21b364e1c6559771970596a25c006" title="Identique a size_array()">size_totale</a>()!=n1) <a class="code" href="Solv__GCP__NS_8cpp.html#ab6aa1075b965c7713d8db20dd3a8e09b">erreur</a>();
<a name="l00187"></a>00187 
<a name="l00188"></a>00188   <a class="code" href="classDoubleVect.html">DoubleVect</a> resu(solution);
<a name="l00189"></a>00189 
<a name="l00190"></a>00190 <span class="comment">// Creation de tableaux distribues X0 et F0 sur les elements</span>
<a name="l00191"></a>00191 <span class="comment">// DoubleVect X0;</span>
<a name="l00192"></a>00192 <span class="comment">// champ.domaine().creer_tableau_elements(X0);</span>
<a name="l00193"></a>00193 <span class="comment">// ConstDoubleTab_parts mo_solution(solution);</span>
<a name="l00194"></a>00194   <a class="code" href="classDoubleVect.html">DoubleVect</a> X0=mo_solution[0];
<a name="l00195"></a>00195   <a class="code" href="classDoubleVect.html">DoubleVect</a> F0(X0);
<a name="l00196"></a>00196   <span class="keywordflow">if</span> (X0.<a class="code" href="classDoubleVect.html#ad2d21b364e1c6559771970596a25c006" title="Identique a size_array()">size_totale</a>()!=n0) <a class="code" href="Solv__GCP__NS_8cpp.html#ab6aa1075b965c7713d8db20dd3a8e09b">erreur</a>();
<a name="l00197"></a>00197 
<a name="l00198"></a>00198 <span class="comment">// F0 :</span>
<a name="l00199"></a>00199   <a class="code" href="Solv__GCP__NS_8cpp.html#a50f88402654f60390e92dcb5a88cfcdb">extraire</a>(F0, secmem, 0, n0);
<a name="l00200"></a>00200   <a class="code" href="classDoubleVect.html">DoubleVect</a> residu(F0);
<a name="l00201"></a>00201 <span class="comment">// F1 :</span>
<a name="l00202"></a>00202   <a class="code" href="Solv__GCP__NS_8cpp.html#a50f88402654f60390e92dcb5a88cfcdb">extraire</a>(F1, secmem, n0, n1);
<a name="l00203"></a>00203 <span class="comment">// X1 = A11^(-1) F1</span>
<a name="l00204"></a>00204   <a class="code" href="classSolv__GCP__NS.html#ac75ff04d625128689c6b8c8ade054c40" title="Matrice_Morse_Sym non supporte.">solveur_poisson1</a>.<a class="code" href="classSolveurSys.html#a62ca198f0c5dc599e53b0535761e5138">resoudre_systeme</a>(A11, F1, X1);
<a name="l00205"></a>00205   <a class="code" href="Solv__GCP__NS_8cpp.html#a8e4bab30677c40a2bfaa0e81b86e1375">injecter</a>(X1, solution, n0, n1);
<a name="l00206"></a>00206 <span class="comment">// F0=A01 X1</span>
<a name="l00207"></a>00207   A01.<a class="code" href="classMatrice__Base.html#a05caa487a25a6d5e7fbd38d4b2f4ee1e" title="Multiplication d&#39;un vecteur par la matrice. Operation: r = A*x.">multvect</a>(X1, F0);
<a name="l00208"></a>00208 <span class="comment">// residu=-F0+A01 X1</span>
<a name="l00209"></a>00209   residu -= F0;
<a name="l00210"></a>00210   residu *=-1;
<a name="l00211"></a>00211   <a class="code" href="classDoubleVect.html">DoubleVect</a> g(F0);
<a name="l00212"></a>00212   <span class="keywordtype">double</span> <a class="code" href="Double_8h.html#ac842198e9490fae75825cab2a03eed2d">norme</a> = <a class="code" href="DoubleVect_8cpp.html#afaa33f0032aa927d8d54ff9fb002b749">mp_norme_vect</a>(residu);
<a name="l00213"></a>00213   <span class="keywordflow">if</span>(<a class="code" href="classSolv__GCP__NS.html#a068a76a7b10253311ae3b24e5887a3c1">le_precond_</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>())
<a name="l00214"></a>00214     <a class="code" href="classSolv__GCP__NS.html#a068a76a7b10253311ae3b24e5887a3c1">le_precond_</a>.<a class="code" href="classPrecond.html#a8032419807b7f624299a6b9f3ea02595">preconditionner</a>(A00,residu,g);
<a name="l00215"></a>00215   <span class="keywordflow">else</span>
<a name="l00216"></a>00216     <a class="code" href="classSolv__GCP__NS.html#a25f29c2cef575aabcbc6b18dddb37486">solveur_poisson0</a>.<a class="code" href="classSolveurSys.html#a62ca198f0c5dc599e53b0535761e5138">resoudre_systeme</a>(A00, residu, g);
<a name="l00217"></a>00217 
<a name="l00218"></a>00218   <a class="code" href="classDoubleVect.html">DoubleVect</a> p(g);
<a name="l00219"></a>00219   p *= -1.;
<a name="l00220"></a>00220 
<a name="l00221"></a>00221   dold = <a class="code" href="DoubleVect_8cpp.html#a07d13cbdadca6b60d5e128653f52a4bb">mp_prodscal</a>(residu,g);
<a name="l00222"></a>00222   dnew = dold;
<a name="l00223"></a>00223   <span class="keywordflow">if</span> (<a class="code" href="classSolveurSys__base.html#ab3ef68bcf4e1b402c52905aa78728aef">limpr</a>()&gt;-1)
<a name="l00224"></a>00224     <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;GCP NS residue = &quot;</span> &lt;&lt; norme &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00225"></a>00225   <span class="keywordtype">double</span> s=0;
<a name="l00226"></a>00226   <span class="keywordflow">while</span> ( ( norme &gt; <a class="code" href="classsolv__iteratif.html#a726974e9a0579e0c242606430dc320d4">seuil_</a> ) &amp;&amp; (niter++ &lt; nmax) )
<a name="l00227"></a>00227     {
<a name="l00228"></a>00228 <span class="comment">// F1=A10 p</span>
<a name="l00229"></a>00229       p.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l00230"></a>00230       A01.<a class="code" href="classMatrice__Base.html#a97ba9741b1b92c4494aaccbb1943c80d" title="Multiplication d&#39;un vecteur par la matrice transposee. Operation: r = AT*x.">multvectT</a>(p, F1);
<a name="l00231"></a>00231 <span class="comment">// X1=-A11^(-1) A10p</span>
<a name="l00232"></a>00232       <span class="keywordflow">if</span> ((<a class="code" href="classSolveurSys__base.html#ab3ef68bcf4e1b402c52905aa78728aef">limpr</a>()==1)&amp;&amp; (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">je_suis_maitre</a>())) <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;Solveur1: &quot;</span> ;
<a name="l00233"></a>00233       <a class="code" href="classSolv__GCP__NS.html#ac75ff04d625128689c6b8c8ade054c40" title="Matrice_Morse_Sym non supporte.">solveur_poisson1</a>.<a class="code" href="classSolveurSys.html#a62ca198f0c5dc599e53b0535761e5138">resoudre_systeme</a>(A11, F1, X1);
<a name="l00234"></a>00234       X1*=-1.;
<a name="l00235"></a>00235 <span class="comment">// F0=(A00  -A01 A11^(-1) A10) p</span>
<a name="l00236"></a>00236       X1.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l00237"></a>00237       A01.<a class="code" href="classMatrice__Base.html#a05caa487a25a6d5e7fbd38d4b2f4ee1e" title="Multiplication d&#39;un vecteur par la matrice. Operation: r = A*x.">multvect</a>(X1, F0);
<a name="l00238"></a>00238       A00.<a class="code" href="classMatrice__Base.html#a6ccb4d20d3877cf09f5178ff72af5406" title="Operation de multiplication-accumulation (saxpy) matrice vecteur. Operation: r = r + A*x...">ajouter_multvect</a>(p, F0);
<a name="l00239"></a>00239       s = <a class="code" href="DoubleVect_8cpp.html#a07d13cbdadca6b60d5e128653f52a4bb">mp_prodscal</a>(F0,p);
<a name="l00240"></a>00240       alfa = dold/(s);
<a name="l00241"></a>00241       <a class="code" href="Solv__GCP__NS_8cpp.html#ab40d0fdc5e4d6521200d423bd9aa2645">corriger</a>(solution, alfa, alfa, X1, p, n0, n1);
<a name="l00242"></a>00242       residu.<a class="code" href="classDoubleVect.html#a4da8824015866b68783677b1e80f1f9a" title="x+=alpha*y">ajoute</a>(alfa,F0);
<a name="l00243"></a>00243       norme = <a class="code" href="DoubleVect_8cpp.html#afaa33f0032aa927d8d54ff9fb002b749">mp_norme_vect</a>(residu);
<a name="l00244"></a>00244       <span class="keywordflow">if</span>(norme&gt;<a class="code" href="classsolv__iteratif.html#a726974e9a0579e0c242606430dc320d4">seuil_</a> &amp;&amp; dnew&gt;0)
<a name="l00245"></a>00245         {
<a name="l00246"></a>00246           <span class="keywordflow">if</span> ((<a class="code" href="classSolveurSys__base.html#ab3ef68bcf4e1b402c52905aa78728aef">limpr</a>()==1)&amp;&amp; (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">je_suis_maitre</a>())) <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;Solveur0: &quot;</span> ;
<a name="l00247"></a>00247           <span class="keywordflow">if</span>(<a class="code" href="classSolv__GCP__NS.html#a068a76a7b10253311ae3b24e5887a3c1">le_precond_</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>())
<a name="l00248"></a>00248             <a class="code" href="classSolv__GCP__NS.html#a068a76a7b10253311ae3b24e5887a3c1">le_precond_</a>.<a class="code" href="classPrecond.html#a8032419807b7f624299a6b9f3ea02595">preconditionner</a>(A00,residu,g);
<a name="l00249"></a>00249           <span class="keywordflow">else</span>
<a name="l00250"></a>00250             <a class="code" href="classSolv__GCP__NS.html#a25f29c2cef575aabcbc6b18dddb37486">solveur_poisson0</a>.<a class="code" href="classSolveurSys.html#a62ca198f0c5dc599e53b0535761e5138">resoudre_systeme</a>(A00, residu, g);
<a name="l00251"></a>00251           dnew = <a class="code" href="DoubleVect_8cpp.html#a07d13cbdadca6b60d5e128653f52a4bb">mp_prodscal</a>(residu,g);
<a name="l00252"></a>00252           p *= (dnew/dold);
<a name="l00253"></a>00253           p -= g;
<a name="l00254"></a>00254           dold = dnew;
<a name="l00255"></a>00255           <span class="keywordflow">if</span> (dnew &lt; 0)
<a name="l00256"></a>00256             {
<a name="l00257"></a>00257               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error : dnew&lt;0 in GCP NS solver.&quot;</span> &lt;&lt; finl;
<a name="l00258"></a>00258               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Try to reduce the threshold value of solveur0&quot;</span> &lt;&lt; finl;
<a name="l00259"></a>00259               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;to a value inferior to those of the GCP NS solver.&quot;</span> &lt;&lt; finl;
<a name="l00260"></a>00260               <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00261"></a>00261             }
<a name="l00262"></a>00262         }
<a name="l00263"></a>00263       <span class="keywordflow">if</span> ((<a class="code" href="classSolveurSys__base.html#ab3ef68bcf4e1b402c52905aa78728aef">limpr</a>()==1)&amp;&amp; (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">je_suis_maitre</a>()))
<a name="l00264"></a>00264         {
<a name="l00265"></a>00265           <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;GCP NS residue = &quot;</span> &lt;&lt; norme &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; finl;
<a name="l00266"></a>00266           <span class="keywordflow">if</span> ((niter % 15) == 0) <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; finl ;
<a name="l00267"></a>00267         }
<a name="l00268"></a>00268     }
<a name="l00269"></a>00269   <span class="keywordflow">if</span>(norme &gt; <a class="code" href="classsolv__iteratif.html#a726974e9a0579e0c242606430dc320d4">seuil_</a>)
<a name="l00270"></a>00270     {
<a name="l00271"></a>00271       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;No convergence after : &quot;</span> &lt;&lt; niter &lt;&lt; <span class="stringliteral">&quot; iterations\n&quot;</span>;
<a name="l00272"></a>00272       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Residue : &quot;</span>&lt;&lt; norme &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00273"></a>00273     }
<a name="l00274"></a>00274   solution.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l00275"></a>00275   <span class="keywordflow">return</span>(niter);
<a name="l00276"></a>00276 }
<a name="l00277"></a>00277 
<a name="l00278"></a>00278 <span class="keywordtype">int</span> <a class="code" href="classSolv__GCP__NS.html#a5c58f2c5fa511f7ef0f5920b1544d091">Solv_GCP_NS::</a>
<a name="l00279"></a><a class="code" href="classSolv__GCP__NS.html#a5c58f2c5fa511f7ef0f5920b1544d091">00279</a> <a class="code" href="classSolv__GCP__NS.html#a5c58f2c5fa511f7ef0f5920b1544d091">resoudre_systeme</a>(<span class="keyword">const</span> <a class="code" href="classMatrice__Base.html">Matrice_Base</a>&amp; la_matrice,
<a name="l00280"></a>00280                  <span class="keyword">const</span> <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; secmem,
<a name="l00281"></a>00281                  <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; solution
<a name="l00282"></a>00282                 )
<a name="l00283"></a>00283 {
<a name="l00284"></a>00284   <span class="keywordflow">return</span> <a class="code" href="classSolv__GCP__NS.html#a5c58f2c5fa511f7ef0f5920b1544d091">resoudre_systeme</a>(la_matrice, secmem, solution,  1000000);
<a name="l00285"></a>00285 }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 
<a name="l00288"></a>00288 
<a name="l00289"></a>00289 
<a name="l00290"></a>00290 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:23 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
