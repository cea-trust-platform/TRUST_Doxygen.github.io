<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/Kernel/Geometrie/Decoupeur/Decouper.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/Kernel/Geometrie/Decoupeur/Decouper.cpp</div>  </div>
</div>
<div class="contents">
<a href="Decouper_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (c) 2021, CEA</span>
<a name="l00003"></a>00003 <span class="comment">* All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment">* 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00007"></a>00007 <span class="comment">* 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00008"></a>00008 <span class="comment">* 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<a name="l00011"></a>00011 <span class="comment">* IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;</span>
<a name="l00012"></a>00012 <span class="comment">* OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// File:        Decouper.cpp</span>
<a name="l00018"></a>00018 <span class="comment">// Directory:   $TRUST_ROOT/src/Kernel/Geometrie/Decoupeur</span>
<a name="l00019"></a>00019 <span class="comment">// Version:     /main/21</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;<a class="code" href="Decouper_8h.html">Decouper.h</a>&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;<a class="code" href="Domaine_8h.html">Domaine.h</a>&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="DomaineCutter_8h.html">DomaineCutter.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="Postraitement__lata_8h.html">Postraitement_lata.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="EChaine_8h.html">EChaine.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="SFichier_8h.html">SFichier.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="Param_8h.html">Param.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="communications_8h.html">communications.h</a>&gt;</span>
<a name="l00030"></a>00030 
<a name="l00031"></a><a class="code" href="Decouper_8cpp.html#a74e1cd56c0697ad4d5fa8ceefcd14574">00031</a> <a class="code" href="Op__Diff__CoviMAC__Face_8cpp.html#aa86ec8ba612a969d9b4370b775037144">Implemente_instanciable</a>(<a class="code" href="classDecouper.html" title="Interprete Decouper. Aucun algorithme ici, uniquement lecture de parametres dans le fichier ...">Decouper</a>,<span class="stringliteral">&quot;Decouper|Partition&quot;</span>,<a class="code" href="classInterprete.html" title="Classe de base des objets &quot;interprete&quot;. Ces objets definissent des actions a realiser lorsqu&#39;on les...">Interprete</a>);
<a name="l00032"></a>00032 
<a name="l00033"></a><a class="code" href="classDecouper.html#a7e8c7495a5d12d40c6665c63924ae513">00033</a> <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classDecouper.html#a7e8c7495a5d12d40c6665c63924ae513" title="Ecriture de l&#39;objet sur un flot de sortie Methode a surcharger.">Decouper::printOn</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os)<span class="keyword"> const</span>
<a name="l00034"></a>00034 <span class="keyword"></span>{
<a name="l00035"></a>00035   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00036"></a>00036   <span class="keywordflow">return</span> os;
<a name="l00037"></a>00037 }
<a name="l00038"></a>00038 
<a name="l00039"></a><a class="code" href="classDecouper.html#a6d86d53ae27450114f2018d07d3f6eed">00039</a> <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classDecouper.html#a6d86d53ae27450114f2018d07d3f6eed" title="Lecture d&#39;un Objet_U sur un flot d&#39;entree Methode a surcharger.">Decouper::readOn</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00040"></a>00040 {
<a name="l00041"></a>00041   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00042"></a>00042   <span class="keywordflow">return</span> is;
<a name="l00043"></a>00043 }
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="comment">// Exception: si le domaine n&#39;a pas ete trouve, exit.</span>
<a name="l00046"></a>00046 <span class="comment">//</span>
<a name="l00047"></a>00047 <span class="comment">//</span><span class="comment"></span>
<a name="l00048"></a>00048 <span class="comment">//! Cherche le domaine de nom &quot;le_nom_domaine&quot; parmi les objets connus&lt;br&gt;de l&#39;interprete et renvoie une ref a ce domaine.</span>
<a name="l00049"></a><a class="code" href="classDecouper.html#a13f0f563699053b39b94aa79ab0b3d04">00049</a> <span class="comment"></span><span class="keyword">const</span> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; <a class="code" href="classDecouper.html#a13f0f563699053b39b94aa79ab0b3d04" title="Cherche le domaine de nom &quot;le_nom_domaine&quot; parmi les objets connus de l&#39;interprete et renvoie une r...">Decouper::find_domain</a>(<span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; le_nom_domaine)
<a name="l00050"></a>00050 {
<a name="l00051"></a>00051   <span class="keyword">const</span> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a> * domaine_ptr = 0;
<a name="l00052"></a>00052 
<a name="l00053"></a>00053   <span class="keywordflow">if</span> (<a class="code" href="classInterprete.html#ae5b09c3b61cd8b789437a0822a26a573" title="Renvoie 1 si l&#39;objet existe, 0 sinon voir Interprete_bloc::objet_global_existant()">objet_existant</a>(le_nom_domaine))
<a name="l00054"></a>00054     {
<a name="l00055"></a>00055       <span class="keyword">const</span> <a class="code" href="classObjet__U.html" title="classe Objet_U Cette classe est la classe de base des Objets de TRUST Dans les classes derivees de Ob...">Objet_U</a>&amp; objet_domaine = <a class="code" href="classInterprete.html#a3ca248609f0b72eac68baca14621b4ee" title="Voir Interprete_bloc::objet_global() BM: la classe Interprete n&#39;est pas le meilleur endroit pour cett...">objet</a>(le_nom_domaine);
<a name="l00056"></a>00056       <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>, objet_domaine))
<a name="l00057"></a>00057         domaine_ptr = &amp; <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>, objet_domaine);
<a name="l00058"></a>00058     }
<a name="l00059"></a>00059 
<a name="l00060"></a>00060   <span class="keywordflow">if</span> (domaine_ptr == 0)
<a name="l00061"></a>00061     {
<a name="l00062"></a>00062       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Decouper::interpreter\n &quot;</span>
<a name="l00063"></a>00063            &lt;&lt; <span class="stringliteral">&quot; Syntax:\n Decouper DOMAINNAME { ... }\n &quot;</span>;
<a name="l00064"></a>00064       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; le_nom_domaine &lt;&lt; <span class="stringliteral">&quot; is not a domain known&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00065"></a>00065       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00066"></a>00066     }
<a name="l00067"></a>00067   <span class="keywordflow">return</span> *domaine_ptr;
<a name="l00068"></a>00068 }
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 <span class="comment">//</span><span class="comment"></span>
<a name="l00071"></a>00071 <span class="comment">//! lecture du partitionneur dans le jeu de donnees&lt;br&gt;(lecture du type et des parametres et initialisation de d_part)</span>
<a name="l00072"></a><a class="code" href="Decouper_8cpp.html#a75a550050a5ce7e1d97b8c7660689d95">00072</a> <span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="Decouper_8cpp.html#a75a550050a5ce7e1d97b8c7660689d95" title="lecture du partitionneur dans le jeu de donnees&lt;br&gt;(lecture du type et des parametres et initialisati...">lire_partitionneur</a>(<a class="code" href="Deriv_8h.html#a4b39337b42cbf2fddeba7868ced6f860" title="Soit une classe Type_base qui derive de Objet_U. DERIV(T) est une petite classe contenant un pointeur...">DERIV</a>(<a class="code" href="classPartitionneur__base.html" title="Classe de base des partitionneurs de domaine&lt;br&gt;(pour decouper un maillage avant un calcul parallele)...">Partitionneur_base</a>) &amp; d_part,
<a name="l00073"></a>00073                                <span class="keyword">const</span> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; domaine, <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00074"></a>00074 {
<a name="l00075"></a>00075   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> n;
<a name="l00076"></a>00076   is &gt;&gt; n;
<a name="l00077"></a>00077   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> type_partitionneur(<span class="stringliteral">&quot;Partitionneur_&quot;</span>);
<a name="l00078"></a>00078   type_partitionneur += n;
<a name="l00079"></a>00079   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Creation of a partitioner of type: &quot;</span> &lt;&lt; type_partitionneur &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00080"></a>00080   d_part.typer(type_partitionneur);
<a name="l00081"></a>00081 <span class="comment">// En cas d&#39;echec (si le nom du type est invalide) : exit</span>
<a name="l00082"></a>00082   <span class="keywordflow">if</span> (! d_part.non_nul())
<a name="l00083"></a>00083     <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 <span class="comment">// Initialisation des parametres du partitionneur</span>
<a name="l00086"></a>00086   <a class="code" href="classPartitionneur__base.html" title="Classe de base des partitionneurs de domaine&lt;br&gt;(pour decouper un maillage avant un calcul parallele)...">Partitionneur_base</a>&amp; part = d_part.valeur();
<a name="l00087"></a>00087   part.<a class="code" href="classPartitionneur__base.html#a551ced6657f7cc3d3706e5d9c6af6799">associer_domaine</a>(domaine);
<a name="l00088"></a>00088   is &gt;&gt; part;
<a name="l00089"></a>00089 }
<a name="l00090"></a>00090 
<a name="l00091"></a><a class="code" href="Decouper_8cpp.html#ada9465f0a1b2174a75651a57a427d28f">00091</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="Decouper_8cpp.html#ada9465f0a1b2174a75651a57a427d28f">ecrire_fichier_decoupage</a>(<span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; nom_fichier_decoupage,
<a name="l00092"></a>00092                                      <span class="keyword">const</span> <a class="code" href="classIntVect.html">IntVect</a>&amp; elem_part,
<a name="l00093"></a>00093                                      <span class="keywordtype">int</span>&amp; nb_parts_tot)
<a name="l00094"></a>00094 {
<a name="l00095"></a>00095   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Writing of the splitting array at the format IntVect ascii\n&quot;</span>
<a name="l00096"></a>00096        &lt;&lt; <span class="stringliteral">&quot; in the file &quot;</span> &lt;&lt; nom_fichier_decoupage
<a name="l00097"></a>00097        &lt;&lt; <span class="stringliteral">&quot;\n(for each element, number of the destination processor)&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00098"></a>00098   <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a> file; <span class="comment">//!&lt; Fichier ascii</span>
<a name="l00099"></a>00099 <span class="comment"></span>  <span class="keywordflow">if</span> (! file.<a class="code" href="classSortie__Fichier__base.html#a7e75e18ed580cd4d45912ec202caa2b2">ouvrir</a>(nom_fichier_decoupage))
<a name="l00100"></a>00100     {
<a name="l00101"></a>00101       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Error in the opening of the file.&quot;</span> &lt;&lt; finl;
<a name="l00102"></a>00102       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00103"></a>00103     }
<a name="l00104"></a>00104   file &lt;&lt; elem_part;
<a name="l00105"></a>00105   file &lt;&lt; nb_parts_tot;
<a name="l00106"></a>00106 }
<a name="l00107"></a>00107 
<a name="l00108"></a><a class="code" href="Decouper_8cpp.html#a32e6cbbb4f367b16463cd9ca88648358">00108</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="Decouper_8cpp.html#a32e6cbbb4f367b16463cd9ca88648358">postraiter_decoupage</a>(<span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; nom_fichier_lata,
<a name="l00109"></a>00109                                  <span class="keyword">const</span> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; domaine,
<a name="l00110"></a>00110                                  <span class="keyword">const</span> <a class="code" href="classIntVect.html">IntVect</a>&amp; elem_part)
<a name="l00111"></a>00111 {
<a name="l00112"></a>00112   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Postprocessing of the splitting at the lata format: &quot;</span> &lt;&lt; nom_fichier_lata &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00113"></a>00113   <a class="code" href="classPostraitement__lata.html#a5a0f028169251f7e1736d60601ef77f9">Postraitement_lata::Format</a> format = <a class="code" href="classPostraitement__lata.html#a5a0f028169251f7e1736d60601ef77f9a3384124d5051d9c93ed5e30a57be2642">Postraitement_lata::BINAIRE</a>;
<a name="l00114"></a>00114   <a class="code" href="classPostraitement__lata.html#a08ea725ea30ac1458a855f9f0a0ffbc1">Postraitement_lata::ecrire_entete</a>(nom_fichier_lata,
<a name="l00115"></a>00115                                     <span class="stringliteral">&quot;Discretisation_inconnue&quot;</span>,
<a name="l00116"></a>00116                                     format);
<a name="l00117"></a>00117   <a class="code" href="classPostraitement__lata.html#abddde8cf0136be3345a4e3b6b0174997">Postraitement_lata::ecrire_zone</a>(nom_fichier_lata,
<a name="l00118"></a>00118                                   domaine.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0),
<a name="l00119"></a>00119                                   format);
<a name="l00120"></a>00120 
<a name="l00121"></a>00121   <a class="code" href="classPostraitement__lata.html#aa5c7fa28338c2ee6fdf95560687d0854">Postraitement_lata::ecrire_temps</a>(nom_fichier_lata,
<a name="l00122"></a>00122                                    0.,
<a name="l00123"></a>00123                                    format);
<a name="l00124"></a>00124   <span class="keyword">const</span> <span class="keywordtype">int</span> n = elem_part.<a class="code" href="classIntVect.html#ae17a73660093eb1d4e90fd8d0ec52670" title="Taille de l&#39;espace &quot;reel&quot; du vecteur. (si md_vector_ est nul, cette valeur est identique a size_arr...">size_reelle</a>();
<a name="l00125"></a>00125   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> data(n);
<a name="l00126"></a>00126   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
<a name="l00127"></a>00127     data(i) = elem_part[i];
<a name="l00128"></a>00128   <a class="code" href="classPostraitement__lata.html#ab2b823bb7b2fe7a93a029c1e48951d90">Postraitement_lata::ecrire_champ</a>(nom_fichier_lata,
<a name="l00129"></a>00129                                    <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(<span class="stringliteral">&quot;partition&quot;</span>),
<a name="l00130"></a>00130                                    <a class="code" href="classPostraitement__lata.html#a012d35ff1c9b7bb8a7c59587b4c3e4f0addb3b63849292cc4575b2ee02340dded">Postraitement_lata::CHAMP</a>,
<a name="l00131"></a>00131                                    <span class="charliteral">&#39;I&#39;</span>,
<a name="l00132"></a>00132                                    domaine.<a class="code" href="classDomaine.html#a87e2cdc035a26565e6fe481446aa4cd3" title="Renvoie le nom du domaine.">le_nom</a>(),
<a name="l00133"></a>00133                                    <span class="stringliteral">&quot;pb&quot;</span>,
<a name="l00134"></a>00134                                    0., <span class="comment">/* temps */</span>
<a name="l00135"></a>00135                                    <a class="code" href="classPostraitement__base.html#a6a43e4c7caaafa57902a067e706d56e9a72278646074c45c57de008b5deda3037">Postraitement_base::ELEMENTS</a>,
<a name="l00136"></a>00136                                    data,
<a name="l00137"></a>00137                                    format);
<a name="l00138"></a>00138 
<a name="l00139"></a>00139   <a class="code" href="classPostraitement__lata.html#a7376f8ed5a006562dfef2fafe49af0f6">Postraitement_lata::finir_lata</a>(nom_fichier_lata);
<a name="l00140"></a>00140 }
<a name="l00141"></a>00141 
<a name="l00142"></a><a class="code" href="Decouper_8cpp.html#aa424f851f2e63cd836edf90838b16221">00142</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="Decouper_8cpp.html#aa424f851f2e63cd836edf90838b16221">ecrire_sous_zones</a>(<span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; nom_zones_decoup,
<a name="l00143"></a>00143                               <span class="keyword">const</span> <a class="code" href="classDecouper.html#a6185c781230e9987f8d0ed3deba63c77">Decouper::ZonesFileOutputType</a> format,
<a name="l00144"></a>00144                               <span class="keyword">const</span> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; domaine,
<a name="l00145"></a>00145                               <a class="code" href="classIntVect.html">IntVect</a>&amp; elem_part,
<a name="l00146"></a>00146                               <span class="keyword">const</span> <span class="keywordtype">int</span> nb_parties,
<a name="l00147"></a>00147                               <span class="keyword">const</span> <span class="keywordtype">int</span> epaisseur_joint,
<a name="l00148"></a>00148                               <span class="keyword">const</span> <span class="keywordtype">int</span> reorder,
<a name="l00149"></a>00149                               <span class="keyword">const</span> <a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a>&amp; bords_periodiques,
<a name="l00150"></a>00150                               <span class="keyword">const</span> <a class="code" href="classStatic__Int__Lists.html" title="Cette classe permet de stocker des listes d&#39;entiers accessibles en temps constant. La taille des listes ne peut pas changer sans perdre le contenu (ce sont des listes statiques). Exemple: Static_Int_List l; ArrOfInt tailles(3); tailles[0] = 2; tailles[1] = 3; tailles[2] = 0; // On reserve la memoire pour trois listes de taille 2, 3 et 0: l.set_list_sizes(tailles); // On affecte une valeur au deuxieme element de la premiere liste: l.set_value(0,1,765); // Affiche la valeur Cout &lt;&lt; l(0,1);.">Static_Int_Lists</a>* som_raccord)
<a name="l00151"></a>00151 {
<a name="l00152"></a>00152   <a class="code" href="classDomaineCutter.html" title="Classe outil permettant de generer des sous-domaines pour un calcul parallele a partir d&#39;un domaine d...">DomaineCutter</a> cutter;
<a name="l00153"></a>00153   cutter.<a class="code" href="classDomaineCutter.html#a700d1294c0ad188e96dcfbd5903ae974" title="Prepare les structures de donnees pour la construction des sous-domaines en fonction d&#39;un decoupage f...">initialiser</a>(domaine, elem_part, nb_parties, epaisseur_joint,
<a name="l00154"></a>00154                      bords_periodiques);
<a name="l00155"></a>00155 <span class="comment">// Reflexion provisoire:</span>
<a name="l00156"></a>00156 <span class="comment">// Les joints sont construits dans ecrire_zones -&gt; construire_sous_domaine</span>
<a name="l00157"></a>00157 <span class="comment">// Donc apres renumerotation des PEs et donc de elem_part, il faudrait</span>
<a name="l00158"></a>00158 <span class="comment">// reinitialiser ? Ou bien, tout renumeroter apres le calcul des joints...</span>
<a name="l00159"></a>00159 <span class="comment">// Cela parait mieux...</span>
<a name="l00160"></a>00160   cutter.<a class="code" href="classDomaineCutter.html#a77aab8be2856e40a5788398e36f411cc" title="Generation de tous les sous-domaines du calcul et ecriture sur disque des fichiers basename_000n...">ecrire_zones</a>(nom_zones_decoup, format, elem_part, reorder, som_raccord);
<a name="l00161"></a>00161 }
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 <span class="comment">// XD partition interprete decouper -1 Class for parallel calculation to cut a domain for each processor. By default, this keyword is commented in the reference test cases.</span>
<a name="l00164"></a>00164 <span class="comment">// XD attr domaine ref_domaine domaine 0 Name of the domain to be cut.</span>
<a name="l00165"></a>00165 <span class="comment">// XD attr bloc_decouper bloc_decouper bloc_decouper 0 Description how to cut a domain.</span>
<a name="l00166"></a>00166 <span class="comment">// XD bloc_decouper objet_lecture nul 1 Auxiliary class to cut a domain.</span>
<a name="l00167"></a>00167 <span class="comment">// XD attr partitionneur|Partition_tool partitionneur_deriv partitionneur 1 Defines the partitionning algorithm (the effective C++ object used is \&#39;Partitionneur_ALGORITHM_NAME\&#39;).</span>
<a name="l00168"></a>00168 <span class="comment">// XD attr larg_joint entier larg_joint 1 This keyword specifies the thickness of the virtual ghost zone (data known by one processor though not owned by it). The default value is 1 and is generally correct for all algorithms except the QUICK convection scheme that require a thickness of 2. Since the 1.5.5 version, the VEF discretization imply also a thickness of 2 (except VEF P0). Any non-zero positive value can be used, but the amount of data to store and exchange between processors grows quickly with the thickness.</span>
<a name="l00169"></a>00169 <span class="comment">// XD attr nom_zones|zones_name chaine nom_zones 1 Name of the files containing the different partition of the domain. The files will be : NL2 name_0001.Zones NL2 name_0002.Zones NL2 ... NL2 name_000n.Zones. If this keyword is not specified, the geometry is not written on disk (you might just want to generate a \&#39;ecrire_decoupage\&#39; or \&#39;ecrire_lata\&#39;).</span>
<a name="l00170"></a>00170 <span class="comment">// XD attr ecrire_decoupage chaine ecrire_decoupage 1 After having called the partitionning algorithm, the resulting partition is written on disk in the specified filename. See also partitionneur Fichier_Decoupage. This keyword is useful to change the partition numbers: first, you write the partition into a file with the option ecrire_decoupage. This file contains the zone number for each element\&#39;s mesh. Then you can easily permute zone numbers in this file. Then read the new partition to create the .Zones files with the Fichier_Decoupage keyword.</span>
<a name="l00171"></a>00171 <span class="comment">// XD attr ecrire_lata chaine ecrire_lata 1 not_set</span>
<a name="l00172"></a>00172 <span class="comment">// XD attr nb_parts_tot entier nb_parts_tot 1 Keyword to generates N .Zone files, instead of the default number M obtained after the partitionning algorithm. N must be greater or equal to M. This option might be used to perform coupled parallel computations. Supplemental empty zones from M to N-1 are created. This keyword is used when you want to run a parallel calculation on several domains with for example, 2 processors on a first domain and 10 on the second domain because the first domain is very small compare to second one. You will write Nb_parts 2 and Nb_parts_tot 10 for the first domain and Nb_parts 10 for the second domain.</span>
<a name="l00173"></a>00173 <span class="comment">// XD attr periodique listchaine periodique 1 N BOUNDARY_NAME_1 BOUNDARY_NAME_2 ... : N is the number of boundary names given. Periodic boundaries must be declared by this method. The partitionning algorithm will ensure that facing nodes and faces in the periodic boundaries are located on the same processor.</span>
<a name="l00174"></a>00174 <span class="comment">// XD attr reorder entier reorder 1 If this option is set to 1 (0 by default), the partition is renumbered in order that the processes which communicate the most are nearer on the network. This may slighlty improves parallel performance.</span>
<a name="l00175"></a>00175 <span class="comment">// XD attr single_hdf rien single_hdf 1 Optional keyword to enable you to write the partitioned zones in a single file in hdf5 format.</span>
<a name="l00176"></a>00176 <span class="comment">// XD attr print_more_infos entier print_more_infos 1 If this option is set to 1 (0 by default), print infos about number of remote elements (ghosts) and additional infos about the quality of partitionning. Warning, it slows down the cutting operations.</span>
<a name="l00177"></a>00177 <span class="keywordtype">int</span> <a class="code" href="classDecouper.html#a3547db48cde6991d341216127bff3091">Decouper::print_more_infos</a> = 0;
<a name="l00178"></a><a class="code" href="classDecouper.html#aa089400ecc006ae4f3a77e4ff24406b1">00178</a> <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classDecouper.html#aa089400ecc006ae4f3a77e4ff24406b1">Decouper::interpreter</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00179"></a>00179 {
<a name="l00180"></a>00180   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Decouper : Splitting of a domain&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00181"></a>00181 <span class="comment">// lecture des parametres</span>
<a name="l00182"></a>00182   <a class="code" href="classDecouper.html#acbfd311885da46f9dca8c81acb10c95a">lire</a>(is);
<a name="l00183"></a>00183 
<a name="l00184"></a>00184 <span class="comment">// generation de la partition</span>
<a name="l00185"></a>00185   <a class="code" href="classIntVect.html">IntVect</a> elem_part;
<a name="l00186"></a>00186   <a class="code" href="classPartitionneur__base.html" title="Classe de base des partitionneurs de domaine&lt;br&gt;(pour decouper un maillage avant un calcul parallele)...">Partitionneur_base</a>&amp; partitionneur = <a class="code" href="classDecouper.html#a3ba898b500383a9137d7ecd7178524c1">deriv_partitionneur</a>.<a class="code" href="classDeriv__Partitionneur__base.html#ac84ecc9cf1069472b6f18c128b39e88c">valeur</a>();
<a name="l00187"></a>00187   partitionneur.<a class="code" href="classPartitionneur__base.html#a8c5fddc21234d7b0d8e419eb830839d6">declarer_bords_periodiques</a>(<a class="code" href="classDecouper.html#ae7fbc13a7014c33e9f1f62f188851a8f">liste_bords_periodiques</a>);
<a name="l00188"></a>00188   partitionneur.<a class="code" href="classPartitionneur__base.html#a935ded45a41fb13b1e65bd5372274e3e">construire_partition</a>(elem_part,<a class="code" href="classDecouper.html#a96999dd3deedf3150b4c2550d7d71e40">nb_parts_tot</a>);
<a name="l00189"></a>00189 
<a name="l00190"></a>00190 <span class="comment">// ecriture</span>
<a name="l00191"></a>00191   <a class="code" href="classDecouper.html#aebb362178e7bdad770c9f60f19a8c88a">ecrire</a>(elem_part, {});
<a name="l00192"></a>00192 
<a name="l00193"></a>00193   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;End of the interpreter Decouper&quot;</span> &lt;&lt; finl;
<a name="l00194"></a>00194   <span class="keywordflow">return</span> is;
<a name="l00195"></a>00195 }
<a name="l00196"></a>00196 
<a name="l00197"></a>00197 
<a name="l00198"></a><a class="code" href="classDecouper.html#acbfd311885da46f9dca8c81acb10c95a">00198</a> <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classDecouper.html#acbfd311885da46f9dca8c81acb10c95a">Decouper::lire</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00199"></a>00199 {
<a name="l00200"></a>00200 <span class="comment">// Lecture du nom du domaine a decouper:</span>
<a name="l00201"></a>00201   is &gt;&gt; <a class="code" href="classDecouper.html#acefeab1531bd844d2e7e79b3b98e000c">nom_domaine</a>;
<a name="l00202"></a>00202   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Domain name to split : &quot;</span> &lt;&lt; nom_domaine &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00203"></a>00203   <a class="code" href="classDecouper.html#a9091c6fa11fcd00ee91ed25989a00067">ref_domaine</a> = <a class="code" href="classDecouper.html#a13f0f563699053b39b94aa79ab0b3d04" title="Cherche le domaine de nom &quot;le_nom_domaine&quot; parmi les objets connus de l&#39;interprete et renvoie une r...">find_domain</a>(nom_domaine);
<a name="l00204"></a>00204 <span class="comment">// Avant de decouper on imprime des infos</span>
<a name="l00205"></a>00205   <a class="code" href="classDecouper.html#a9091c6fa11fcd00ee91ed25989a00067">ref_domaine</a>-&gt;imprimer();
<a name="l00206"></a>00206 
<a name="l00207"></a>00207   <a class="code" href="classParam.html" title="Defined below in this file.">Param</a> param(<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>());
<a name="l00208"></a>00208   param.<a class="code" href="classParam.html#a8d8bcddfd8087e577ffbb170c68e4f88">ajouter_non_std</a>(<span class="stringliteral">&quot;partitionneur|partition_tool&quot;</span>,(<span class="keyword">this</span>),<a class="code" href="classParam.html#aa4ad0ca1d49bc5f2ebc5fc83ee9df384aaf5b6dfac1c5970478525407cc6ac572">Param::REQUIRED</a>);
<a name="l00209"></a>00209   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;larg_joint&quot;</span>,&amp;<a class="code" href="classDecouper.html#a392c0f8324f327eb5d50150e16983615">epaisseur_joint</a>);
<a name="l00210"></a>00210   param.<a class="code" href="classParam.html#a6363f31c467c06512aee2f004abac69d">ajouter_condition</a>(<span class="stringliteral">&quot;value_of_larg_joint_ge_1&quot;</span>,<span class="stringliteral">&quot;The joint thickness must greater or equal to 1.&quot;</span>);
<a name="l00211"></a>00211   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;nom_zones|zones_name&quot;</span>,&amp;<a class="code" href="classDecouper.html#a80869df148387777ae9798f67612f178">nom_zones_decoup</a>);
<a name="l00212"></a>00212   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;ecrire_decoupage&quot;</span>,&amp;<a class="code" href="classDecouper.html#a66b6242aa86164c40888250e89da0cca">nom_fichier_decoupage</a>);
<a name="l00213"></a>00213   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;ecrire_lata&quot;</span>,&amp;<a class="code" href="classDecouper.html#afdb421bb1c4d3e292a23759c6d5ab6aa">nom_fichier_lata</a>);
<a name="l00214"></a>00214   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;nb_parts_tot&quot;</span>,&amp;<a class="code" href="classDecouper.html#a96999dd3deedf3150b4c2550d7d71e40">nb_parts_tot</a>);
<a name="l00215"></a>00215   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;reorder&quot;</span>,&amp;<a class="code" href="classDecouper.html#a4e46abb9eee4d079241027352a1fc5cc">reorder</a>);
<a name="l00216"></a>00216   param.<a class="code" href="classParam.html#ae3d50612a0014a9d58e6e035a65f20e5">ajouter_flag</a>(<span class="stringliteral">&quot;single_hdf&quot;</span>,&amp;<a class="code" href="classDecouper.html#a3e25c66efd5e3159bd4f49bfa1fc608f">format_hdf</a>);
<a name="l00217"></a>00217   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;periodique&quot;</span>,&amp;<a class="code" href="classDecouper.html#ae7fbc13a7014c33e9f1f62f188851a8f">liste_bords_periodiques</a>);
<a name="l00218"></a>00218   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;print_more_infos&quot;</span>,&amp;Decouper::print_more_infos);
<a name="l00219"></a>00219   param.<a class="code" href="classParam.html#aa9d44fc51b4a08b357733a97dc7acaad" title="Read the is input with the parameters (defined with the Param object) inside: { ... } Example, to read: { a 1 b 2 } Param param(que_suis_je()); int a,b; param.ajouter(&quot;a&quot;,&amp;a); param.ajouter(&quot;b&quot;,&amp;b); param.lire_avec_accolades_depuis(is);.">lire_avec_accolades_depuis</a>(is);
<a name="l00220"></a>00220   <span class="keywordflow">return</span> is;
<a name="l00221"></a>00221 }
<a name="l00222"></a>00222 
<a name="l00223"></a>00223 
<a name="l00224"></a><a class="code" href="classDecouper.html#aebb362178e7bdad770c9f60f19a8c88a">00224</a> <span class="keywordtype">void</span> <a class="code" href="classDecouper.html#aebb362178e7bdad770c9f60f19a8c88a">Decouper::ecrire</a>(<a class="code" href="classIntVect.html">IntVect</a>&amp; elem_part, <span class="keyword">const</span> <a class="code" href="classStatic__Int__Lists.html" title="Cette classe permet de stocker des listes d&#39;entiers accessibles en temps constant. La taille des listes ne peut pas changer sans perdre le contenu (ce sont des listes statiques). Exemple: Static_Int_List l; ArrOfInt tailles(3); tailles[0] = 2; tailles[1] = 3; tailles[2] = 0; // On reserve la memoire pour trois listes de taille 2, 3 et 0: l.set_list_sizes(tailles); // On affecte une valeur au deuxieme element de la premiere liste: l.set_value(0,1,765); // Affiche la valeur Cout &lt;&lt; l(0,1);.">Static_Int_Lists</a>* som_raccord)
<a name="l00225"></a>00225 {
<a name="l00226"></a>00226 <span class="comment">// Calcul du nombre de parties generees par le partitionneur</span>
<a name="l00227"></a>00227   <span class="keywordtype">int</span> nb_parties = 0;
<a name="l00228"></a>00228   <span class="keywordflow">if</span> (elem_part.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>() &gt; 0)
<a name="l00229"></a>00229     nb_parties = <a class="code" href="ArrOfDouble_8cpp.html#a95241fccf4bed7fb7a4e2340b7735f14" title="Retourne la valeur maximale.">max_array</a>(elem_part) + 1;
<a name="l00230"></a>00230   nb_parties = <a class="code" href="classProcess.html#a1e9d9f9899b71927cfafae14c7bd048d" title="Calcule le max de x sur tous les processeurs du groupe courant. Remarques : Cette methode doit etre a...">mp_max</a>(nb_parties);
<a name="l00231"></a>00231   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;The partitioner has generated &quot;</span> &lt;&lt; nb_parties &lt;&lt; <span class="stringliteral">&quot; parts.&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00232"></a>00232 
<a name="l00233"></a>00233 <span class="comment">// Prise en compte de la directive nb_parts_tot</span>
<a name="l00234"></a>00234   <span class="keywordflow">if</span> (<a class="code" href="classDecouper.html#a96999dd3deedf3150b4c2550d7d71e40">nb_parts_tot</a> &gt;= 0)
<a name="l00235"></a>00235     {
<a name="l00236"></a>00236       <span class="keywordflow">if</span> (nb_parties &gt; <a class="code" href="classDecouper.html#a96999dd3deedf3150b4c2550d7d71e40">nb_parts_tot</a>)
<a name="l00237"></a>00237         {
<a name="l00238"></a>00238           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error: nb_parts_tot is less than the number of parts generated by the partitioner.&quot;</span>
<a name="l00239"></a>00239                &lt;&lt; finl;
<a name="l00240"></a>00240           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00241"></a>00241         }
<a name="l00242"></a>00242       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Number of parts requested : &quot;</span> &lt;&lt; <a class="code" href="classDecouper.html#a96999dd3deedf3150b4c2550d7d71e40">nb_parts_tot</a>
<a name="l00243"></a>00243            &lt;&lt; <span class="stringliteral">&quot;\nGeneration of &quot;</span> &lt;&lt; <a class="code" href="classDecouper.html#a96999dd3deedf3150b4c2550d7d71e40">nb_parts_tot</a> - nb_parties &lt;&lt; <span class="stringliteral">&quot; empty parts.&quot;</span> &lt;&lt; finl;
<a name="l00244"></a>00244       nb_parties = <a class="code" href="classDecouper.html#a96999dd3deedf3150b4c2550d7d71e40">nb_parts_tot</a>;
<a name="l00245"></a>00245     }
<a name="l00246"></a>00246 <span class="comment">// Force un seul fichier .Zones au dela d&#39;un certain nombre de rangs MPI:</span>
<a name="l00247"></a>00247   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#a0028ba29b8998170a85d2e0c00293b78">Process::force_single_file</a>(nb_parties, <a class="code" href="classDecouper.html#a80869df148387777ae9798f67612f178">nom_zones_decoup</a>+<span class="stringliteral">&quot;.Zones&quot;</span>))
<a name="l00248"></a>00248     <a class="code" href="classDecouper.html#a3e25c66efd5e3159bd4f49bfa1fc608f">format_hdf</a> = 1;
<a name="l00249"></a>00249 
<a name="l00250"></a>00250   <span class="keywordflow">if</span> (<a class="code" href="classDecouper.html#a66b6242aa86164c40888250e89da0cca">nom_fichier_decoupage</a> != <span class="stringliteral">&quot;?&quot;</span>)
<a name="l00251"></a>00251     <a class="code" href="Decouper_8cpp.html#ada9465f0a1b2174a75651a57a427d28f">ecrire_fichier_decoupage</a>(<a class="code" href="classDecouper.html#a66b6242aa86164c40888250e89da0cca">nom_fichier_decoupage</a>, elem_part, <a class="code" href="classDecouper.html#a96999dd3deedf3150b4c2550d7d71e40">nb_parts_tot</a>);
<a name="l00252"></a>00252 
<a name="l00253"></a>00253   <span class="keywordflow">if</span> (<a class="code" href="classDecouper.html#a80869df148387777ae9798f67612f178">nom_zones_decoup</a> != <span class="stringliteral">&quot;?&quot;</span>)
<a name="l00254"></a>00254     {
<a name="l00255"></a>00255       <a class="code" href="classDecouper.html#a6185c781230e9987f8d0ed3deba63c77">Decouper::ZonesFileOutputType</a> typ;
<a name="l00256"></a>00256       <span class="keywordflow">if</span> (<a class="code" href="classDecouper.html#a6b066775726cad0bc9aa2b6994f0c2fb">format_binaire</a>) typ = <a class="code" href="classDecouper.html#a6185c781230e9987f8d0ed3deba63c77abb1fd046c875d348a8c0a151ca4a060a">BINARY_MULTIPLE</a>;
<a name="l00257"></a>00257       <span class="keywordflow">if</span> (<a class="code" href="classDecouper.html#a3e25c66efd5e3159bd4f49bfa1fc608f">format_hdf</a>) typ = <a class="code" href="classDecouper.html#a6185c781230e9987f8d0ed3deba63c77ab6eb35dc70963341302e570b944c7b44">HDF5_SINGLE</a>;
<a name="l00258"></a>00258       <a class="code" href="Decouper_8cpp.html#aa424f851f2e63cd836edf90838b16221">ecrire_sous_zones</a>(<a class="code" href="classDecouper.html#a80869df148387777ae9798f67612f178">nom_zones_decoup</a>, typ,
<a name="l00259"></a>00259                         <a class="code" href="classDecouper.html#a9091c6fa11fcd00ee91ed25989a00067">ref_domaine</a>.<a class="code" href="classRef__Domaine.html#a89e1c374ada79faa2c7e9a76c3393ad8">valeur</a>(), elem_part, nb_parties, <a class="code" href="classDecouper.html#a392c0f8324f327eb5d50150e16983615">epaisseur_joint</a>, <a class="code" href="classDecouper.html#a4e46abb9eee4d079241027352a1fc5cc">reorder</a>,
<a name="l00260"></a>00260                         <a class="code" href="classDecouper.html#ae7fbc13a7014c33e9f1f62f188851a8f">liste_bords_periodiques</a>, som_raccord);
<a name="l00261"></a>00261     }
<a name="l00262"></a>00262 
<a name="l00263"></a>00263   <span class="keywordflow">if</span> (<a class="code" href="classDecouper.html#afdb421bb1c4d3e292a23759c6d5ab6aa">nom_fichier_lata</a> != <span class="stringliteral">&quot;?&quot;</span>)
<a name="l00264"></a>00264     <a class="code" href="Decouper_8cpp.html#a32e6cbbb4f367b16463cd9ca88648358">postraiter_decoupage</a>(<a class="code" href="classDecouper.html#afdb421bb1c4d3e292a23759c6d5ab6aa">nom_fichier_lata</a>, <a class="code" href="classDecouper.html#a9091c6fa11fcd00ee91ed25989a00067">ref_domaine</a>.<a class="code" href="classRef__Domaine.html#a89e1c374ada79faa2c7e9a76c3393ad8">valeur</a>(), elem_part);
<a name="l00265"></a>00265 
<a name="l00266"></a>00266   <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;\nQuality of partitioning --------------------------------------------&quot;</span> &lt;&lt; finl;
<a name="l00267"></a>00267   <span class="keywordtype">int</span> total_elem = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(elem_part.<a class="code" href="classIntVect.html#ae17a73660093eb1d4e90fd8d0ec52670" title="Taille de l&#39;espace &quot;reel&quot; du vecteur. (si md_vector_ est nul, cette valeur est identique a size_arr...">size_reelle</a>());
<a name="l00268"></a>00268   <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;\nTotal number of elements = &quot;</span> &lt;&lt; total_elem &lt;&lt; finl;
<a name="l00269"></a>00269   <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;Number of Zones : &quot;</span> &lt;&lt; nb_parties &lt;&lt; finl;
<a name="l00270"></a>00270 
<a name="l00271"></a>00271   <span class="keywordflow">if</span> (Decouper::print_more_infos)
<a name="l00272"></a>00272     {
<a name="l00273"></a>00273       <a class="code" href="classDoubleVect.html">DoubleVect</a> A(nb_parties);
<a name="l00274"></a>00274       A = 0;
<a name="l00275"></a>00275       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; elem_part.<a class="code" href="classIntVect.html#ae17a73660093eb1d4e90fd8d0ec52670" title="Taille de l&#39;espace &quot;reel&quot; du vecteur. (si md_vector_ est nul, cette valeur est identique a size_arr...">size_reelle</a>(); i++)
<a name="l00276"></a>00276         A(elem_part[i]) = A(elem_part[i]) + 1;
<a name="l00277"></a>00277 
<a name="l00278"></a>00278       <span class="keywordflow">if</span>(<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l00279"></a>00279         {
<a name="l00280"></a>00280           <span class="keywordflow">for</span>(<span class="keywordtype">int</span> proc=1; proc&lt;<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>(); proc++)
<a name="l00281"></a>00281             {
<a name="l00282"></a>00282               <a class="code" href="classDoubleVect.html">DoubleVect</a> tmp(nb_parties);
<a name="l00283"></a>00283               tmp = 0;
<a name="l00284"></a>00284               <a class="code" href="communications_8cpp.html#a729d9499913e22a5f0db62ef07b9793f">recevoir</a>(tmp, proc, 0, proc+2005);
<a name="l00285"></a>00285 
<a name="l00286"></a>00286               <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i_part=0; i_part&lt;nb_parties; i_part++)
<a name="l00287"></a>00287                 A(i_part) += tmp(i_part);
<a name="l00288"></a>00288             }
<a name="l00289"></a>00289 
<a name="l00290"></a>00290 
<a name="l00291"></a>00291           <span class="keywordtype">double</span> mean_element_zone = total_elem/nb_parties;
<a name="l00292"></a>00292           <span class="keywordflow">if</span> (mean_element_zone&gt;0)
<a name="l00293"></a>00293             {
<a name="l00294"></a>00294               <span class="keywordtype">double</span> load_imbalance = double(<a class="code" href="DoubleVect_8cpp.html#a6471e7e85cb0b00b67bd7ca9bb362371">local_max_vect</a>(A) / mean_element_zone);
<a name="l00295"></a>00295               <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;Number of cells per Zone (min/mean/max) : &quot;</span> &lt;&lt; <a class="code" href="DoubleVect_8cpp.html#a17be200c713a7031ede99b28391daa52">local_min_vect</a>(A) &lt;&lt; <span class="stringliteral">&quot; / &quot;</span> &lt;&lt; mean_element_zone &lt;&lt; <span class="stringliteral">&quot; / &quot;</span>
<a name="l00296"></a>00296                    &lt;&lt; <a class="code" href="DoubleVect_8cpp.html#a6471e7e85cb0b00b67bd7ca9bb362371">local_max_vect</a>(A) &lt;&lt; <span class="stringliteral">&quot; Load imbalance: &quot;</span> &lt;&lt; load_imbalance &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span> &lt;&lt; finl;
<a name="l00297"></a>00297 
<a name="l00298"></a>00298             }
<a name="l00299"></a>00299         }
<a name="l00300"></a>00300       <span class="keywordflow">else</span>
<a name="l00301"></a>00301         <a class="code" href="communications_8cpp.html#af9feb6405277b375b2ebcbfaec9f8af3">envoyer</a>(A, <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>(), 0, <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>()+2005);
<a name="l00302"></a>00302 
<a name="l00303"></a>00303 
<a name="l00304"></a>00304 <span class="comment">// we could do it as below, but if nb_parties is big, it would involve a lot of collective communication</span>
<a name="l00305"></a>00305 <span class="comment">// for (int i = 0; i &lt; nb_parties; i++)</span>
<a name="l00306"></a>00306 <span class="comment">// A[i] = Process::mp_sum(A[i]);</span>
<a name="l00307"></a>00307 
<a name="l00308"></a>00308 
<a name="l00309"></a>00309     }
<a name="l00310"></a>00310 
<a name="l00311"></a>00311   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;End of the interpreter Decouper&quot;</span> &lt;&lt; finl;
<a name="l00312"></a>00312   <span class="keywordflow">if</span> (<a class="code" href="classDecouper.html#a4e46abb9eee4d079241027352a1fc5cc">reorder</a>==0 &amp;&amp; nb_parties&gt;128)
<a name="l00313"></a>00313     {
<a name="l00314"></a>00314       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Performance tip: You could add \&quot;reorder 1\&quot; option to have less distance between communicating processes on the network.&quot;</span> &lt;&lt; finl;
<a name="l00315"></a>00315       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Add also \&quot;Ecrire_lata filename\&quot; to post-process the partition numeration and see the difference.&quot;</span> &lt;&lt; finl;
<a name="l00316"></a>00316     }
<a name="l00317"></a>00317 }
<a name="l00318"></a>00318 
<a name="l00319"></a><a class="code" href="classDecouper.html#a2307e1a1c92a93a18d3d19f6eddaa286">00319</a> <span class="keywordtype">int</span> <a class="code" href="classDecouper.html#a2307e1a1c92a93a18d3d19f6eddaa286" title="Lecture des parametres de type non simple d&#39;un objet_U a partir d&#39;un flot d&#39;entree.">Decouper::lire_motcle_non_standard</a>(<span class="keyword">const</span> <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>&amp; mot, <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00320"></a>00320 {
<a name="l00321"></a>00321   <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> motlu;
<a name="l00322"></a>00322   <span class="keywordflow">if</span> (mot==<span class="stringliteral">&quot;partitionneur|partition_tool&quot;</span>)
<a name="l00323"></a>00323     {
<a name="l00324"></a>00324       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;domaine = &quot;</span>&lt;&lt;<a class="code" href="classDecouper.html#acefeab1531bd844d2e7e79b3b98e000c">nom_domaine</a>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00325"></a>00325       <span class="keyword">const</span> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; domaine = <a class="code" href="classDecouper.html#a13f0f563699053b39b94aa79ab0b3d04" title="Cherche le domaine de nom &quot;le_nom_domaine&quot; parmi les objets connus de l&#39;interprete et renvoie une r...">find_domain</a>(<a class="code" href="classDecouper.html#acefeab1531bd844d2e7e79b3b98e000c">nom_domaine</a>);
<a name="l00326"></a>00326       <a class="code" href="Decouper_8cpp.html#a75a550050a5ce7e1d97b8c7660689d95" title="lecture du partitionneur dans le jeu de donnees&lt;br&gt;(lecture du type et des parametres et initialisati...">lire_partitionneur</a>(<a class="code" href="classDecouper.html#a3ba898b500383a9137d7ecd7178524c1">deriv_partitionneur</a>,domaine,is);
<a name="l00327"></a>00327       <span class="keywordflow">return</span> 1;
<a name="l00328"></a>00328     }
<a name="l00329"></a>00329   <span class="keywordflow">else</span>
<a name="l00330"></a>00330     {
<a name="l00331"></a>00331       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; mot &lt;&lt; <span class="stringliteral">&quot; is not a keyword understood by &quot;</span> &lt;&lt; <a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; <span class="stringliteral">&quot; in lire_motcle_non_standard&quot;</span>&lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00332"></a>00332       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00333"></a>00333     }
<a name="l00334"></a>00334   <span class="keywordflow">return</span> -1;
<a name="l00335"></a>00335 }
<a name="l00336"></a>00336 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:17 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
