<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/Kernel/Geometrie/Scatter.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/Kernel/Geometrie/Scatter.cpp</div>  </div>
</div>
<div class="contents">
<a href="Scatter_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (c) 2021, CEA</span>
<a name="l00003"></a>00003 <span class="comment">* All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment">* 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00007"></a>00007 <span class="comment">* 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00008"></a>00008 <span class="comment">* 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<a name="l00011"></a>00011 <span class="comment">* IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;</span>
<a name="l00012"></a>00012 <span class="comment">* OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// File:        Scatter.cpp</span>
<a name="l00018"></a>00018 <span class="comment">// Directory:   $TRUST_ROOT/src/Kernel/Geometrie</span>
<a name="l00019"></a>00019 <span class="comment">// Version:     /main/73</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="Scatter_8h.html">Scatter.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="Domaine_8h.html">Domaine.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="LecFicDistribueBin_8h.html">LecFicDistribueBin.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="Statistiques_8h.html">Statistiques.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="DoubleTabs_8h.html">DoubleTabs.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="Connectivite__som__elem_8h.html">Connectivite_som_elem.h</a>&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;<a class="code" href="Schema__Comm_8h.html">Schema_Comm.h</a>&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;<a class="code" href="Faces__builder_8h.html">Faces_builder.h</a>&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;<a class="code" href="Zone__VF_8h.html">Zone_VF.h</a>&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;<a class="code" href="Reordonner__faces__periodiques_8h.html">Reordonner_faces_periodiques.h</a>&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;<a class="code" href="Postraitement__lata_8h.html">Postraitement_lata.h</a>&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;<a class="code" href="communications_8h.html">communications.h</a>&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;<a class="code" href="MD__Vector__tools_8h.html">MD_Vector_tools.h</a>&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;<a class="code" href="MD__Vector__std_8h.html">MD_Vector_std.h</a>&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;unistd.h&gt;</span> <span class="comment">//!&lt; PGI</span>
<a name="l00039"></a>00039 <span class="comment"></span><span class="preprocessor">#include &lt;<a class="code" href="Poly__geom__base_8h.html">Poly_geom_base.h</a>&gt;</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;<a class="code" href="Entree__Brute_8h.html">Entree_Brute.h</a>&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;hdf5.h&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;<a class="code" href="Comm__Group__MPI_8h.html">Comm_Group_MPI.h</a>&gt;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;<a class="code" href="FichierHDFPar_8h.html">FichierHDFPar.h</a>&gt;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &lt;<a class="code" href="LecFicDiffuse_8h.html">LecFicDiffuse.h</a>&gt;</span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;<a class="code" href="EFichierBin_8h.html">EFichierBin.h</a>&gt;</span>
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="keyword">extern</span> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="Scatter_8cpp.html#a5aa23d1c4a41bce37e5e06efb5e8c9e1" title="&lt; PGI">interprete_scatter_counter_</a>;
<a name="l00050"></a>00050 
<a name="l00051"></a><a class="code" href="Scatter_8cpp.html#a6b0bce9d4399a0b851de1bf50e6e0761">00051</a> <a class="code" href="Declare__Inst_8h.html#afcab3f7633508e92f2077d767e19bc60">Implemente_instanciable_sans_constructeur</a>(<a class="code" href="classScatter.html">Scatter</a>,<span class="stringliteral">&quot;Scatter&quot;</span>,<a class="code" href="classInterprete.html" title="Classe de base des objets &quot;interprete&quot;. Ces objets definissent des actions a realiser lorsqu&#39;on les...">Interprete</a>);
<a name="l00052"></a><a class="code" href="classScatter.html#a97e6291a932815a6cafbed40d6c98c4a">00052</a> <a class="code" href="classScatter.html#a97e6291a932815a6cafbed40d6c98c4a">Scatter::Scatter</a>()
<a name="l00053"></a>00053 {}
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="comment">// Precondition:</span>
<a name="l00056"></a>00056 <span class="comment">// Parametre: Sortie&amp; os</span>
<a name="l00057"></a>00057 <span class="comment">// Signification: un flot de sortie</span>
<a name="l00058"></a>00058 <span class="comment">// Valeurs par defaut:</span>
<a name="l00059"></a>00059 <span class="comment">// Contraintes:</span>
<a name="l00060"></a>00060 <span class="comment">// Acces: entree/sortie</span>
<a name="l00061"></a>00061 <span class="comment">// Exception:</span>
<a name="l00062"></a>00062 <span class="comment">// Effets de bord:</span>
<a name="l00063"></a>00063 <span class="comment">// Postcondition: la methode ne modifie pas l&#39;objet</span>
<a name="l00064"></a>00064 <span class="comment">//</span><span class="comment"></span>
<a name="l00065"></a>00065 <span class="comment">//! Simple appel a: Interprete::printOn(Sortie\&amp;)</span>
<a name="l00066"></a>00066 <span class="comment"></span><span class="comment">/** \return Sortie\&amp;&lt;br&gt;</span>
<a name="l00067"></a>00067 <span class="comment">Signification: le flot de sortie modifie&lt;br&gt;</span>
<a name="l00068"></a>00068 <span class="comment">Contraintes: */</span>
<a name="l00069"></a><a class="code" href="classScatter.html#a9e06b9a31bb668cffc13a5e817272345">00069</a> <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classScatter.html#a9e06b9a31bb668cffc13a5e817272345" title="Simple appel a: Interprete::printOn(Sortie&amp;)">Scatter::printOn</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os)<span class="keyword"> const</span>
<a name="l00070"></a>00070 <span class="keyword"></span>{
<a name="l00071"></a>00071   <span class="keywordflow">return</span> <a class="code" href="classScatter.html#a9e06b9a31bb668cffc13a5e817272345" title="Simple appel a: Interprete::printOn(Sortie&amp;)">Interprete::printOn</a>(os);
<a name="l00072"></a>00072 }
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 <span class="comment">// Precondition:</span>
<a name="l00076"></a>00076 <span class="comment">// Parametre: Entree&amp; is</span>
<a name="l00077"></a>00077 <span class="comment">// Signification: un flot d&#39;entree</span>
<a name="l00078"></a>00078 <span class="comment">// Valeurs par defaut:</span>
<a name="l00079"></a>00079 <span class="comment">// Contraintes:</span>
<a name="l00080"></a>00080 <span class="comment">// Acces: entree/sortie</span>
<a name="l00081"></a>00081 <span class="comment">// Exception:</span>
<a name="l00082"></a>00082 <span class="comment">// Effets de bord:</span>
<a name="l00083"></a>00083 <span class="comment">// Postcondition:</span>
<a name="l00084"></a>00084 <span class="comment">//</span><span class="comment"></span>
<a name="l00085"></a>00085 <span class="comment">//! Simple appel a: Interprete::readOn(Entree\&amp;)</span>
<a name="l00086"></a>00086 <span class="comment"></span><span class="comment">/** \return Entree\&amp;&lt;br&gt;</span>
<a name="l00087"></a>00087 <span class="comment">Signification: le flot d&#39;entree modifie&lt;br&gt;</span>
<a name="l00088"></a>00088 <span class="comment">Contraintes: */</span>
<a name="l00089"></a><a class="code" href="classScatter.html#ad7c35f0d98c6d4de8511f87743fe5dbc">00089</a> <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classScatter.html#ad7c35f0d98c6d4de8511f87743fe5dbc" title="Simple appel a: Interprete::readOn(Entree&amp;)">Scatter::readOn</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00090"></a>00090 {
<a name="l00091"></a>00091   <span class="keywordflow">return</span> <a class="code" href="classScatter.html#ad7c35f0d98c6d4de8511f87743fe5dbc" title="Simple appel a: Interprete::readOn(Entree&amp;)">Interprete::readOn</a>(is);
<a name="l00092"></a>00092 }
<a name="l00093"></a>00093 
<a name="l00094"></a>00094 <span class="comment">// Description :</span>
<a name="l00095"></a>00095 <span class="comment">// Renvoi le domaine associe</span>
<a name="l00096"></a><a class="code" href="classScatter.html#ac33aacdb609dcc870faeb93500ed017f">00096</a> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; <a class="code" href="classScatter.html#ac33aacdb609dcc870faeb93500ed017f">Scatter::domaine</a>()
<a name="l00097"></a>00097 {
<a name="l00098"></a>00098   <span class="keywordflow">return</span> <a class="code" href="classScatter.html#a82a0e561610415e2f6c5615846a96f87">le_domaine</a>.<a class="code" href="classRef__Domaine.html#a89e1c374ada79faa2c7e9a76c3393ad8">valeur</a>();
<a name="l00099"></a>00099 }
<a name="l00100"></a>00100 
<a name="l00101"></a><a class="code" href="Scatter_8cpp.html#a600ea51e50b762812904598f72bc12b6">00101</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="Scatter_8cpp.html#a600ea51e50b762812904598f72bc12b6">dump_lata</a>(<span class="keyword">const</span> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom)
<a name="l00102"></a>00102 {
<a name="l00103"></a>00103   <span class="keyword">const</span> <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone = dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0);
<a name="l00104"></a>00104   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_joints = zone.<a class="code" href="classZone.html#ab096afb61e89705709a4ae6d3576a644" title="Renvoie le nombre de joints de la zone.">nb_joints</a>();
<a name="l00105"></a>00105 
<a name="l00106"></a>00106   <span class="keyword">const</span> <a class="code" href="classComm__Group.html" title=": Cette classe decrit un groupe de processeurs sur lesquels une portion de code s&#39;execute simultaneme...">Comm_Group</a> *cg = 0;
<a name="l00107"></a>00107   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> nom_fichier_lata(<span class="stringliteral">&quot;espaces_virtuels&quot;</span>);
<a name="l00108"></a>00108   <a class="code" href="classPostraitement__lata.html#a5a0f028169251f7e1736d60601ef77f9">Postraitement_lata::Format</a> format = <a class="code" href="classPostraitement__lata.html#a5a0f028169251f7e1736d60601ef77f9a3384124d5051d9c93ed5e30a57be2642">Postraitement_lata::BINAIRE</a>;
<a name="l00109"></a>00109   <a class="code" href="classPostraitement__lata.html#a08ea725ea30ac1458a855f9f0a0ffbc1">Postraitement_lata::ecrire_entete</a>(nom_fichier_lata,
<a name="l00110"></a>00110                                     <span class="stringliteral">&quot;Discretisation_inconnue&quot;</span>,
<a name="l00111"></a>00111                                     format, cg);
<a name="l00112"></a>00112   <a class="code" href="classPostraitement__lata.html#abddde8cf0136be3345a4e3b6b0174997">Postraitement_lata::ecrire_zone</a>(nom_fichier_lata,
<a name="l00113"></a>00113                                   zone,
<a name="l00114"></a>00114                                   format, cg);
<a name="l00115"></a>00115 
<a name="l00116"></a>00116   <a class="code" href="classPostraitement__lata.html#aa5c7fa28338c2ee6fdf95560687d0854">Postraitement_lata::ecrire_temps</a>(nom_fichier_lata,
<a name="l00117"></a>00117                                    0.,
<a name="l00118"></a>00118                                    format, cg);
<a name="l00119"></a>00119   <span class="keyword">const</span> <span class="keywordtype">int</span> n = zone.<a class="code" href="classZone.html#a7f249429803b27139a1c54436f6164a5" title="Renvoie le nombre d&#39;elements de la zone.">nb_elem</a>();
<a name="l00120"></a>00120   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> data(n);
<a name="l00121"></a>00121   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ij = 0; ij &lt; nb_joints; ij++)
<a name="l00122"></a>00122     {
<a name="l00123"></a>00123       <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; t1 = zone.<a class="code" href="classZone.html#acec4c61032df8b55a95f9e7197ef6e3c" title="Renvoie le i-ieme joint de la zone&lt;br&gt;(version const)">joint</a>(ij).<a class="code" href="classJoint.html#a3f49fb1150967b436a115a7373ab27a0" title="Renvoie les informations de joint pour le type demande.">joint_item</a>(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926ae32de3a01fdb3ad6c506b8058a7f6173">Joint::ELEMENT</a>).<a class="code" href="classJoint__Items.html#ae51b330de79fcaae9c88166e3eee7cb8" title="Voir items_distants_.">items_distants</a>();
<a name="l00124"></a>00124       data = 0.;
<a name="l00125"></a>00125       {
<a name="l00126"></a>00126         <span class="keyword">const</span> <span class="keywordtype">int</span> nt1 = t1.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00127"></a>00127         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nt1; i++)
<a name="l00128"></a>00128           data(t1[i]) += 1;
<a name="l00129"></a>00129       }
<a name="l00130"></a>00130       <a class="code" href="classPostraitement__lata.html#ab2b823bb7b2fe7a93a029c1e48951d90">Postraitement_lata::ecrire_champ</a>(nom_fichier_lata,
<a name="l00131"></a>00131                                        <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(<span class="stringliteral">&quot;partition&quot;</span>) + <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(zone.<a class="code" href="classZone.html#acec4c61032df8b55a95f9e7197ef6e3c" title="Renvoie le i-ieme joint de la zone&lt;br&gt;(version const)">joint</a>(ij).<a class="code" href="classJoint.html#a0952bc5c7805434ccd8cd5c9b01e3747" title="Renvoie PEvoisin (numero de la zone voisine)">PEvoisin</a>()),
<a name="l00132"></a>00132                                        <a class="code" href="classPostraitement__lata.html#a012d35ff1c9b7bb8a7c59587b4c3e4f0addb3b63849292cc4575b2ee02340dded">Postraitement_lata::CHAMP</a>,
<a name="l00133"></a>00133                                        <span class="charliteral">&#39;I&#39;</span>,
<a name="l00134"></a>00134                                        dom.<a class="code" href="classDomaine.html#a87e2cdc035a26565e6fe481446aa4cd3" title="Renvoie le nom du domaine.">le_nom</a>(),
<a name="l00135"></a>00135                                        <span class="stringliteral">&quot;pb&quot;</span>,
<a name="l00136"></a>00136                                        0., <span class="comment">/* temps */</span>
<a name="l00137"></a>00137                                        <a class="code" href="classPostraitement__base.html#a6a43e4c7caaafa57902a067e706d56e9a72278646074c45c57de008b5deda3037">Postraitement_base::ELEMENTS</a>,
<a name="l00138"></a>00138                                        data,
<a name="l00139"></a>00139                                        format);
<a name="l00140"></a>00140     }
<a name="l00141"></a>00141 }
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 <span class="comment">//</span>
<a name="l00144"></a>00144 <span class="comment">//</span>
<a name="l00145"></a>00145 <span class="comment">//</span>
<a name="l00146"></a>00146 <span class="comment">//</span>
<a name="l00147"></a>00147 <span class="comment">//</span>
<a name="l00148"></a>00148 <span class="comment">//</span><span class="comment"></span>
<a name="l00149"></a>00149 <span class="comment">//! Lit et complete un domaine parallele selon les motcles lus&lt;br&gt;dans le jeu de donnees. Format:&lt;br&gt;Scatter [debug] file_name domain_name&lt;br&gt;On lit les sommets, les elements et les sommets et faces de joint,&lt;br&gt;On construit les espaces distants et virtuels en fonction&lt;br&gt;de l&#39;epaisseur de joint.</span>
<a name="l00150"></a><a class="code" href="classScatter.html#ada2699448b4deae55f43998af585d603">00150</a> <span class="comment"></span><a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classScatter.html#ada2699448b4deae55f43998af585d603" title="Lit et complete un domaine parallele selon les motcles lus dans le jeu de donnees. Format: Scatter [debug] file_name domain_name On lit les sommets, les elements et les sommets et faces de joint, On construit les espaces distants et virtuels en fonction de l&#39;epaisseur de joint.">Scatter::interpreter</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00151"></a>00151 {
<a name="l00152"></a>00152 <span class="comment">// Nom des fichiers de decoupage : nomentree.xxxx</span>
<a name="l00153"></a>00153   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> nomentree;
<a name="l00154"></a>00154   is &gt;&gt; nomentree;
<a name="l00155"></a>00155   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>()==1)
<a name="l00156"></a>00156     {
<a name="l00157"></a>00157       <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> n(nomentree);
<a name="l00158"></a>00158       <span class="keywordflow">if</span> (n != <span class="stringliteral">&quot;;&quot;</span> &amp;&amp; n != <span class="stringliteral">&quot;unlock;&quot;</span>)
<a name="l00159"></a>00159         {
<a name="l00160"></a>00160           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error ! You ran a sequential calculation and can&#39;t use Scatter keyword here. Run a parallel calculation or remove this keyword.&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00161"></a>00161           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00162"></a>00162         }
<a name="l00163"></a>00163       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Scatter: preparing domain structure\n&quot;</span>
<a name="l00164"></a>00164            &lt;&lt; <span class="stringliteral">&quot; (this is workaround for bugged domain operators that don&#39;t do it)&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00165"></a>00165       <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> nomdomaine;
<a name="l00166"></a>00166       is &gt;&gt; nomdomaine;
<a name="l00167"></a>00167       <a class="code" href="classObjet__U.html" title="classe Objet_U Cette classe est la classe de base des Objets de TRUST Dans les classes derivees de Ob...">Objet_U</a>&amp; obj = <a class="code" href="classInterprete.html#a3ca248609f0b72eac68baca14621b4ee" title="Voir Interprete_bloc::objet_global() BM: la classe Interprete n&#39;est pas le meilleur endroit pour cett...">objet</a>(nomdomaine);
<a name="l00168"></a>00168       <span class="keywordflow">if</span>(!<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>, obj))
<a name="l00169"></a>00169         {
<a name="l00170"></a>00170           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;obj : &quot;</span> &lt;&lt; obj &lt;&lt; <span class="stringliteral">&quot; is not an object of type Domain !&quot;</span> &lt;&lt; finl;
<a name="l00171"></a>00171           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00172"></a>00172         }
<a name="l00173"></a>00173       <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>, obj);
<a name="l00174"></a>00174       <span class="keywordflow">if</span> (n == <span class="stringliteral">&quot;;&quot;</span>)
<a name="l00175"></a>00175         <a class="code" href="classScatter.html#a1874139ffd29d5a68191bc7828d3a5bd" title="cree des descripteurs sequentiels pour les tableaux sommets et elements du domaine (necessaire car Sc...">init_sequential_domain</a>(dom);
<a name="l00176"></a>00176       <span class="keywordflow">else</span>
<a name="l00177"></a>00177         <a class="code" href="classScatter.html#a8cf934a9b5f7ecb7ef89f61c09804f45" title="methode utilisee par les interpretes qui modifient le domaine&lt;br&gt;(sequentiel), detruit les descripteu...">uninit_sequential_domain</a>(dom);
<a name="l00178"></a>00178       <span class="keywordflow">return</span> is;
<a name="l00179"></a>00179     }
<a name="l00180"></a>00180 <span class="comment">// Pour debugger sur linux en parallele</span>
<a name="l00181"></a>00181 <span class="preprocessor">#ifdef linux</span>
<a name="l00182"></a>00182 <span class="preprocessor"></span>  <span class="keyword">static</span> <span class="keywordtype">int</span> gdb_non_lance=1;
<a name="l00183"></a>00183   <span class="keywordtype">char</span>* TRUST_GDB=getenv(<span class="stringliteral">&quot;TRUST_GDB&quot;</span>);
<a name="l00184"></a>00184   <span class="keywordflow">if</span> (gdb_non_lance &amp;&amp; ((<a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>)nomentree==<span class="stringliteral">&quot;DEBUG&quot;</span> || TRUST_GDB!=NULL))
<a name="l00185"></a>00185     {
<a name="l00186"></a>00186       gdb_non_lance=0;
<a name="l00187"></a>00187       <span class="keywordflow">if</span> ((<a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>)nomentree==<span class="stringliteral">&quot;DEBUG&quot;</span>) is &gt;&gt; nomentree;
<a name="l00188"></a>00188       <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">je_suis_maitre</a>())
<a name="l00189"></a>00189         {
<a name="l00190"></a>00190           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Enter \&quot;return\&quot; to this window after&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00191"></a>00191           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;typing \&quot;cont\&quot; in other gdb windows.&quot;</span> &lt;&lt; finl;
<a name="l00192"></a>00192           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; (int)system (<span class="stringliteral">&quot;sh -c read ok&quot;</span>) &lt;&lt; finl;
<a name="l00193"></a>00193         }
<a name="l00194"></a>00194       <span class="keywordflow">else</span>
<a name="l00195"></a>00195         {
<a name="l00196"></a>00196           <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> getpidn((<span class="keywordtype">int</span>)getpid());
<a name="l00197"></a>00197           <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> cmdfile=getpidn;
<a name="l00198"></a>00198           <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> command0=<span class="stringliteral">&quot;echo attach &quot;</span>;
<a name="l00199"></a>00199           command0+=getpidn;
<a name="l00200"></a>00200           command0+=<span class="stringliteral">&quot; &gt; &quot;</span>;
<a name="l00201"></a>00201           command0+=cmdfile;
<a name="l00202"></a>00202           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; (int)system(command0) &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00203"></a>00203           command0=<span class="stringliteral">&quot; ls -l /proc/&quot;</span>;
<a name="l00204"></a>00204           command0+=getpidn;
<a name="l00205"></a>00205           command0+=<span class="stringliteral">&quot;/exe | awk &#39;{print $NF}&#39; &gt; execname&quot;</span>;
<a name="l00206"></a>00206           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; (int)system(command0) &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00207"></a>00207           <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> command=<span class="stringliteral">&quot;[ -f /usr/X11R6/bin/xterm ] &amp;&amp; x=\&quot;/usr/X11R6/bin/xterm -exec gdb -x \&quot;;&quot;</span>;
<a name="l00208"></a>00208           command+=<span class="stringliteral">&quot;[ -f /usr/bin/konsole ] &amp;&amp; x=\&quot;/usr/bin/konsole -e gdb -x \&quot;;&quot;</span>;
<a name="l00209"></a>00209           command+=<span class="stringliteral">&quot;$x &quot;</span>;
<a name="l00210"></a>00210           command+=cmdfile;
<a name="l00211"></a>00211           command+=<span class="stringliteral">&quot; `cat execname` &quot;</span>;
<a name="l00212"></a>00212           command+=<span class="stringliteral">&quot; &amp;&quot;</span>;
<a name="l00213"></a>00213           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;command: &quot;</span> &lt;&lt;command&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00214"></a>00214           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; (int)system(command) &lt;&lt; finl;
<a name="l00215"></a>00215         }
<a name="l00216"></a>00216     }
<a name="l00217"></a>00217 <span class="preprocessor">#endif</span>
<a name="l00218"></a>00218 <span class="preprocessor"></span>  <a class="code" href="classProcess.html#aa9e74a5c06a68ea38298a08ea401e7b1" title="Synchronise tous les processeurs du groupe courant&lt;br&gt;(attend que tous les processeurs soient arrives...">barrier</a>();
<a name="l00219"></a>00219 
<a name="l00220"></a>00220   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l00221"></a>00221     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Execution of the Scatter module.&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00222"></a>00222 
<a name="l00223"></a>00223   <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#affcd058809786918ed173aaf681d0843">begin_count</a>(interprete_scatter_counter_);
<a name="l00224"></a>00224 
<a name="l00225"></a>00225 <span class="comment">// On recupere le domaine:</span>
<a name="l00226"></a>00226   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> nomdomaine;
<a name="l00227"></a>00227   is &gt;&gt; nomdomaine;
<a name="l00228"></a>00228   <a class="code" href="classObjet__U.html" title="classe Objet_U Cette classe est la classe de base des Objets de TRUST Dans les classes derivees de Ob...">Objet_U</a>&amp; obj = <a class="code" href="classInterprete.html#a3ca248609f0b72eac68baca14621b4ee" title="Voir Interprete_bloc::objet_global() BM: la classe Interprete n&#39;est pas le meilleur endroit pour cett...">objet</a>(nomdomaine);
<a name="l00229"></a>00229   <span class="keywordflow">if</span>(!<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>, obj))
<a name="l00230"></a>00230     {
<a name="l00231"></a>00231       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;obj : &quot;</span> &lt;&lt; obj &lt;&lt; <span class="stringliteral">&quot; is not an object of type Domain !&quot;</span> &lt;&lt; finl;
<a name="l00232"></a>00232       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00233"></a>00233     }
<a name="l00234"></a>00234   <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>, obj);
<a name="l00235"></a>00235   <a class="code" href="classScatter.html#a82a0e561610415e2f6c5615846a96f87">le_domaine</a> = dom;
<a name="l00236"></a>00236 
<a name="l00237"></a>00237 <span class="comment">// Lecture des fichiers de decoupage :</span>
<a name="l00238"></a>00238   <a class="code" href="classProcess.html#aa9e74a5c06a68ea38298a08ea401e7b1" title="Synchronise tous les processeurs du groupe courant&lt;br&gt;(attend que tous les processeurs soient arrives...">barrier</a>();
<a name="l00239"></a>00239   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l00240"></a>00240     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Reading the domain&quot;</span> &lt;&lt; finl;
<a name="l00241"></a>00241 
<a name="l00242"></a>00242   <a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a> liste_bords_periodiques;
<a name="l00243"></a>00243   <a class="code" href="classScatter.html#a0c740e8b05e31947a4f49d630f1302ec" title="Lit le domaine dans le fichier de nom &quot;nomentree&quot;, de type LecFicDistribueBin ou LecFicDistribue Form...">lire_domaine</a>(nomentree, liste_bords_periodiques);
<a name="l00244"></a>00244 
<a name="l00245"></a>00245   <a class="code" href="classProcess.html#aa9e74a5c06a68ea38298a08ea401e7b1" title="Synchronise tous les processeurs du groupe courant&lt;br&gt;(attend que tous les processeurs soient arrives...">barrier</a>();
<a name="l00246"></a>00246   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Calculation of renum_items_communs for the nodes&quot;</span> &lt;&lt; finl;
<a name="l00247"></a>00247   <a class="code" href="classScatter.html#a21f166c05df9be1fc1f02b0604624fe5" title="On suppose que chaque joint[i].joint_item(type_item).items_communs() contient les indices locaux des ...">calculer_renum_items_communs</a>(dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>(), <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>);
<a name="l00248"></a>00248 
<a name="l00249"></a>00249 <span class="comment">// Pas encore code: on verifie que les sommets communs ont des coordonnees identiques</span>
<a name="l00250"></a>00250 <span class="comment">// sur tous les processeurs.</span>
<a name="l00251"></a>00251 <span class="comment">// check_sommets_joints(dom);</span>
<a name="l00252"></a>00252 
<a name="l00253"></a>00253   <a class="code" href="classProcess.html#aa9e74a5c06a68ea38298a08ea401e7b1" title="Synchronise tous les processeurs du groupe courant&lt;br&gt;(attend que tous les processeurs soient arrives...">barrier</a>();
<a name="l00254"></a>00254   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Construire_structures_paralleles&quot;</span> &lt;&lt; finl;
<a name="l00255"></a>00255   <a class="code" href="classScatter.html#af6b88297583bd92c6ca3814bc532b8be" title="Construction des structures paralleles du domaine et de la zone (determination des elements distants ...">construire_structures_paralleles</a>(dom, liste_bords_periodiques);
<a name="l00256"></a>00256 
<a name="l00257"></a>00257   <span class="keywordflow">if</span> (0)
<a name="l00258"></a>00258     <a class="code" href="Scatter_8cpp.html#a600ea51e50b762812904598f72bc12b6">dump_lata</a>(dom);
<a name="l00259"></a>00259 
<a name="l00260"></a>00260   <a class="code" href="classProcess.html#aa9e74a5c06a68ea38298a08ea401e7b1" title="Synchronise tous les processeurs du groupe courant&lt;br&gt;(attend que tous les processeurs soient arrives...">barrier</a>();
<a name="l00261"></a>00261   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;End Distribue_zones&quot;</span> &lt;&lt; finl;
<a name="l00262"></a>00262 
<a name="l00263"></a>00263   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;\nQuality of partitioning --------------------------------------------&quot;</span> &lt;&lt; finl;
<a name="l00264"></a>00264   <span class="keywordtype">int</span> total_nb_elem = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a7f249429803b27139a1c54436f6164a5" title="Renvoie le nombre d&#39;elements de la zone.">nb_elem</a>());
<a name="l00265"></a>00265   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;\nTotal number of elements = &quot;</span> &lt;&lt; total_nb_elem &lt;&lt; finl;
<a name="l00266"></a>00266   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Number of Zones : &quot;</span> &lt;&lt; <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>() &lt;&lt; finl;
<a name="l00267"></a>00267   <span class="keywordtype">double</span> min_element_zone = <a class="code" href="classProcess.html#a05de57db7288d95f9e67046af585d5ff" title="Calcule le min de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">mp_min</a>(dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a7f249429803b27139a1c54436f6164a5" title="Renvoie le nombre d&#39;elements de la zone.">nb_elem</a>());
<a name="l00268"></a>00268   <span class="keywordtype">double</span> max_element_zone = <a class="code" href="classProcess.html#a1e9d9f9899b71927cfafae14c7bd048d" title="Calcule le max de x sur tous les processeurs du groupe courant. Remarques : Cette methode doit etre a...">mp_max</a>(dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a7f249429803b27139a1c54436f6164a5" title="Renvoie le nombre d&#39;elements de la zone.">nb_elem</a>());
<a name="l00269"></a>00269   <span class="keywordtype">double</span> mean_element_zone = total_nb_elem / <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l00270"></a>00270   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Min number of elements on a Zone = &quot;</span> &lt;&lt; min_element_zone &lt;&lt; finl;
<a name="l00271"></a>00271   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Max number of elements on a Zone = &quot;</span> &lt;&lt; max_element_zone &lt;&lt; finl;
<a name="l00272"></a>00272   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Mean number of elements per Zone = &quot;</span> &lt;&lt; (int)(mean_element_zone) &lt;&lt; finl;
<a name="l00273"></a>00273   <span class="keywordtype">double</span> load_imbalance = max_element_zone / mean_element_zone;
<a name="l00274"></a>00274   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Load imbalance = &quot;</span> &lt;&lt; load_imbalance &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span> &lt;&lt; finl;
<a name="l00275"></a>00275 
<a name="l00276"></a>00276   <a class="code" href="classElem__geom__base.html" title="Classe Elem_geom_base Cette classe est la classe de base pour la definition d&#39;elements geometriques c...">Elem_geom_base</a>&amp; elem=dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a18cf83cd0f9c368dcfa32fb802a0ac94" title="Renvoie un element geometrique du type de ceux qui constituent la zone. (version const)">type_elem</a>().<a class="code" href="classDeriv__Elem__geom__base.html#a384b487459a33f9f521fb16539ec81de">valeur</a>();
<a name="l00277"></a>00277   <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classPoly__geom__base.html" title=": class Poly_geom_base &lt;Description of class Poly_geom_base&gt;">Poly_geom_base</a>,elem))
<a name="l00278"></a>00278     {
<a name="l00279"></a>00279       <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classPoly__geom__base.html" title=": class Poly_geom_base &lt;Description of class Poly_geom_base&gt;">Poly_geom_base</a>,elem).compute_virtual_index();
<a name="l00280"></a>00280     }
<a name="l00281"></a>00281   <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a0faf52d1b518f5b0b2177f22efcc222d" title="Arret du compteur counter_id. On ajoute quantity a la somme des &#39;quantity&#39; (par defaut 0) stockees po...">end_count</a>(interprete_scatter_counter_);
<a name="l00282"></a>00282   <span class="keywordflow">if</span>(<a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>()==0)
<a name="l00283"></a>00283     {
<a name="l00284"></a>00284       <span class="keywordtype">double</span> temps = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a21c24113a2042f33ce1134b473ebc1ac">last_time</a>(interprete_scatter_counter_);
<a name="l00285"></a>00285       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Scatter time : &quot;</span> &lt;&lt; temps &lt;&lt; finl;
<a name="l00286"></a>00286     }
<a name="l00287"></a>00287 
<a name="l00288"></a>00288   <span class="keywordflow">return</span> is;
<a name="l00289"></a>00289 }
<a name="l00290"></a>00290 
<a name="l00291"></a>00291 <span class="comment">//</span>
<a name="l00292"></a>00292 <span class="comment">//</span>
<a name="l00293"></a>00293 <span class="comment">//</span>
<a name="l00294"></a>00294 <span class="comment">//</span>
<a name="l00295"></a>00295 <span class="comment">//</span><span class="comment"></span>
<a name="l00296"></a>00296 <span class="comment">//! Merged zones receive joints information from their neighbours&lt;br&gt;to ensure that their common items (vertices) appear in the same order&lt;br&gt;If it&#39;s not the case, the merged zone reorders its common items so that it matches the neighbour&#39;s order&lt;br&gt;When 2 neighbouring zones have each been merged,&lt;br&gt;only the processor with the lowest rank proceeds to reordering</span>
<a name="l00297"></a><a class="code" href="classScatter.html#a86c9311713284ed6591da95c7eb9411d">00297</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classScatter.html#a86c9311713284ed6591da95c7eb9411d" title="Merged zones receive joints information from their neighbours to ensure that their common items (vert...">Scatter::check_consistancy_remote_items</a>(<a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom, <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; mergedZones)
<a name="l00298"></a>00298 {
<a name="l00299"></a>00299   <span class="keyword">const</span> <a class="code" href="classJoints.html" title="Classe Joints Cette classe represente une liste d&#39;objet de type Joint.">Joints</a>&amp; joints     = dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>();
<a name="l00300"></a>00300   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_joints = joints.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>();
<a name="l00301"></a>00301 
<a name="l00302"></a>00302   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; coords = dom.<a class="code" href="classDomaine.html#a0846ac03a10b65c4df911fe35a19c02f" title="Renvoie le nombre total de sommets.">les_sommets</a>();
<a name="l00303"></a>00303   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> liste_send;
<a name="l00304"></a>00304   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> liste_recv;
<a name="l00305"></a>00305   liste_send.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00306"></a>00306   liste_recv.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00307"></a>00307 
<a name="l00308"></a>00308   <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; moi = <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>();
<a name="l00309"></a>00309   <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; myZoneWasMerged = mergedZones[moi];
<a name="l00310"></a>00310 
<a name="l00311"></a>00311   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_joint = 0; i_joint &lt; nb_joints; i_joint++)
<a name="l00312"></a>00312     {
<a name="l00313"></a>00313 
<a name="l00314"></a>00314       <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; pe_voisin = joints[i_joint].PEvoisin();
<a name="l00315"></a>00315       <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; neighbourZoneWasMerged = mergedZones[pe_voisin];
<a name="l00316"></a>00316       <span class="keywordflow">if</span>(myZoneWasMerged &amp;&amp; neighbourZoneWasMerged)
<a name="l00317"></a>00317         {
<a name="l00318"></a>00318           <span class="keywordflow">if</span>(pe_voisin &lt; moi)
<a name="l00319"></a>00319             liste_recv.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(pe_voisin);
<a name="l00320"></a>00320           <span class="keywordflow">else</span>
<a name="l00321"></a>00321             liste_send.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(pe_voisin);
<a name="l00322"></a>00322         }
<a name="l00323"></a>00323       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(myZoneWasMerged &amp;&amp; !neighbourZoneWasMerged)
<a name="l00324"></a>00324         liste_recv.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(pe_voisin);
<a name="l00325"></a>00325       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!myZoneWasMerged &amp;&amp; neighbourZoneWasMerged)
<a name="l00326"></a>00326         liste_send.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(pe_voisin);
<a name="l00327"></a>00327       <span class="keywordflow">else</span>
<a name="l00328"></a>00328         {
<a name="l00329"></a>00329 <span class="comment">// nothing to exchange</span>
<a name="l00330"></a>00330         }
<a name="l00331"></a>00331     }
<a name="l00332"></a>00332 
<a name="l00333"></a>00333   <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>) coord_items_locaux(nb_joints);
<a name="l00334"></a>00334   <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>) coord_items_distants(nb_joints);
<a name="l00335"></a>00335   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_joint = 0; i_joint &lt; nb_joints; i_joint++)
<a name="l00336"></a>00336     {
<a name="l00337"></a>00337       <span class="keyword">const</span> <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp; joint     = joints[i_joint];
<a name="l00338"></a>00338       <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; items_communs = joint.<a class="code" href="classJoint.html#a3f49fb1150967b436a115a7373ab27a0" title="Renvoie les informations de joint pour le type demande.">joint_item</a>(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>).<a class="code" href="classJoint__Items.html#a435fb1629f6dafb089605913517e73c4" title="Voir items_communs_.">items_communs</a>();
<a name="l00339"></a>00339       <span class="keyword">const</span> <span class="keywordtype">int</span> nb_items_communs = items_communs.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00340"></a>00340 
<a name="l00341"></a>00341       <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp;   coord   = coord_items_locaux[i_joint];
<a name="l00342"></a>00342       coord.<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(nb_items_communs, <a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>);
<a name="l00343"></a>00343       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_items_communs; i++)
<a name="l00344"></a>00344         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; j++)
<a name="l00345"></a>00345           coord(i,j) = coords(items_communs[i], j);
<a name="l00346"></a>00346     }
<a name="l00347"></a>00347 
<a name="l00348"></a>00348 <span class="comment">// Envoi des coordonnees locales au processeur voisin</span>
<a name="l00349"></a>00349   {
<a name="l00350"></a>00350     <a class="code" href="classSchema__Comm.html">Schema_Comm</a> schema_comm;
<a name="l00351"></a>00351     schema_comm.<a class="code" href="classSchema__Comm.html#ad11c9b47999c294c26ae4df8d2bbd57b" title="Definit la liste des processeurs a qui on va envoyer et de qui on va recevoir des donnees...">set_send_recv_pe_list</a>(liste_send, liste_recv);
<a name="l00352"></a>00352     schema_comm.<a class="code" href="classSchema__Comm.html#ac617b53de22748cdd9fa30a0cfd0f4a8" title="Statut passe a WRITING Autorise si status_ == WRITING:">begin_comm</a>();
<a name="l00353"></a>00353     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_joints; i++)
<a name="l00354"></a>00354       {
<a name="l00355"></a>00355         <span class="keyword">const</span> <span class="keywordtype">int</span> pe_voisin = joints[i].PEvoisin();
<a name="l00356"></a>00356         <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; neighbourZoneWasMerged = mergedZones[pe_voisin];
<a name="l00357"></a>00357         <span class="keywordflow">if</span>( neighbourZoneWasMerged &amp;&amp; !(myZoneWasMerged &amp;&amp; pe_voisin&lt;moi) )
<a name="l00358"></a>00358           {
<a name="l00359"></a>00359             <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; buffer = schema_comm.<a class="code" href="classSchema__Comm.html#a6c771eae3b46250ae0d2f0126a7d8065" title="renvoie le buffer correspondant au processeur num_PE pour y entasser des donnees a envoyer...">send_buffer</a>(pe_voisin);
<a name="l00360"></a>00360             buffer &lt;&lt; coord_items_locaux[i];
<a name="l00361"></a>00361           }
<a name="l00362"></a>00362       }
<a name="l00363"></a>00363     schema_comm.<a class="code" href="classSchema__Comm.html#abca0e8ac6c2b742d26f3cfaee0690c72" title="Statut passe a EXCHANGED.">echange_taille_et_messages</a>();
<a name="l00364"></a>00364 
<a name="l00365"></a>00365     <span class="keywordflow">if</span>(myZoneWasMerged)
<a name="l00366"></a>00366       {
<a name="l00367"></a>00367         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_joints; i++)
<a name="l00368"></a>00368           {
<a name="l00369"></a>00369             <span class="keyword">const</span> <span class="keywordtype">int</span> pe_voisin = joints[i].PEvoisin();
<a name="l00370"></a>00370             <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; neighbourZoneWasMerged = mergedZones[pe_voisin];
<a name="l00371"></a>00371             <span class="keywordflow">if</span>(!(neighbourZoneWasMerged &amp;&amp; pe_voisin&gt;moi))
<a name="l00372"></a>00372               {
<a name="l00373"></a>00373                 <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; buffer = schema_comm.<a class="code" href="classSchema__Comm.html#a0c056eb81ab8fd513912b336b4d13a1a" title="renvoie le buffer correspondant au processeur num_PE pour y lire les donnees recues. Le schema doit etre dans l&#39;etat EXCHANGED.">recv_buffer</a>(pe_voisin);
<a name="l00374"></a>00374                 buffer &gt;&gt; coord_items_distants[i];
<a name="l00375"></a>00375               }
<a name="l00376"></a>00376           }
<a name="l00377"></a>00377       }
<a name="l00378"></a>00378 
<a name="l00379"></a>00379     schema_comm.<a class="code" href="classSchema__Comm.html#a73a981f88b6ffebc150fb46c5cce75d9" title="Statut passe a RESET Accesseurs:">end_comm</a>();
<a name="l00380"></a>00380   }
<a name="l00381"></a>00381 
<a name="l00382"></a>00382 <span class="comment">// check if the vertices in my joints appear in the same order as my neighbour joint</span>
<a name="l00383"></a>00383   <span class="keywordflow">if</span>(myZoneWasMerged)
<a name="l00384"></a>00384     {
<a name="l00385"></a>00385       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_joint = 0; i_joint &lt; nb_joints; i_joint++)
<a name="l00386"></a>00386         {
<a name="l00387"></a>00387 
<a name="l00388"></a>00388           <span class="keyword">const</span> <span class="keywordtype">int</span> pe_voisin = joints[i_joint].PEvoisin();
<a name="l00389"></a>00389           <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; neighbourZoneWasMerged = mergedZones[pe_voisin];
<a name="l00390"></a>00390           <span class="keywordflow">if</span>(neighbourZoneWasMerged &amp;&amp; pe_voisin&gt;moi)
<a name="l00391"></a>00391             <span class="keywordflow">continue</span>;
<a name="l00392"></a>00392           <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; items_communs = dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>()[i_joint].set_joint_item(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>).set_items_communs();
<a name="l00393"></a>00393           <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> old_items_communs = joints[i_joint].joint_item(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>).items_communs();
<a name="l00394"></a>00394           <span class="keyword">const</span> <span class="keywordtype">int</span>     nb_items      = items_communs.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00395"></a>00395           <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; coord_voisin = coord_items_distants[i_joint];
<a name="l00396"></a>00396           <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; my_coord = coord_items_locaux[i_joint];
<a name="l00397"></a>00397           assert(my_coord.<a class="code" href="classArrOfDouble.html#a3c3b33bea0e88b87315c21ee94bee05f" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>() ==  coord_voisin.<a class="code" href="classArrOfDouble.html#a3c3b33bea0e88b87315c21ee94bee05f" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>());
<a name="l00398"></a>00398           <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;nb_items; i++)
<a name="l00399"></a>00399             {
<a name="l00400"></a>00400               <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j&lt;nb_items; j++)
<a name="l00401"></a>00401                 {
<a name="l00402"></a>00402                   <span class="keywordtype">int</span> ok=1;
<a name="l00403"></a>00403                   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> dir=0; dir&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">Objet_U::dimension</a>; dir++)
<a name="l00404"></a>00404                     ok=ok&amp;&amp;(<a class="code" href="Double_8h.html#ac86f5f350b0f95fd8c34b0ac8d720f6f">est_egal</a>(coord_voisin(i,dir),my_coord(j,dir)));
<a name="l00405"></a>00405                   <span class="keywordflow">if</span> (ok)
<a name="l00406"></a>00406                     {
<a name="l00407"></a>00407                       items_communs[i] = old_items_communs[j];
<a name="l00408"></a>00408                       <span class="keywordflow">break</span>;
<a name="l00409"></a>00409                     }
<a name="l00410"></a>00410                 }
<a name="l00411"></a>00411             }
<a name="l00412"></a>00412         }
<a name="l00413"></a>00413     }
<a name="l00414"></a>00414 }
<a name="l00415"></a>00415 
<a name="l00416"></a>00416 
<a name="l00417"></a>00417 <span class="comment">//</span>
<a name="l00418"></a>00418 <span class="comment">//</span>
<a name="l00419"></a>00419 <span class="comment">//</span><span class="comment"></span>
<a name="l00420"></a>00420 <span class="comment">//! Does the exact same thing as the readOn of the class Domaine&lt;br&gt;but without collective communication&lt;br&gt;Necessary when the processors don&#39;t have the same numbers of file to read</span>
<a name="l00421"></a><a class="code" href="classScatter.html#ad8cdf7a8e4ad0065e9c3e1351aec8a1b">00421</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classScatter.html#ad8cdf7a8e4ad0065e9c3e1351aec8a1b" title="Does the exact same thing as the readOn of the class Domaine but without collective communication Nec...">Scatter::readDomainWithoutCollComm</a>(<a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom, <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; fic )
<a name="l00422"></a>00422 {
<a name="l00423"></a>00423   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;reading vertices...&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00424"></a>00424   dom.<a class="code" href="classDomaine.html#a5ebe2a9e34ba2e1b8b54541e7418e08b" title="only read vertices from the stream s">read_vertices</a>(fic);
<a name="l00425"></a>00425 
<a name="l00426"></a>00426   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Done !\nreading zones...&quot;</span> &lt;&lt; finl;
<a name="l00427"></a>00427 
<a name="l00428"></a>00428   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> accouverte=<span class="stringliteral">&quot;{&quot;</span>;
<a name="l00429"></a>00429   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> accfermee=<span class="stringliteral">&quot;}&quot;</span>;
<a name="l00430"></a>00430   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> virgule=<span class="stringliteral">&quot;,&quot;</span>;
<a name="l00431"></a>00431   <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> nom;
<a name="l00432"></a>00432   fic &gt;&gt; nom;
<a name="l00433"></a>00433   <span class="keywordflow">if</span>(nom!=(<span class="keyword">const</span> <span class="keywordtype">char</span>*)<span class="stringliteral">&quot;vide&quot;</span>)
<a name="l00434"></a>00434     {
<a name="l00435"></a>00435       <span class="keywordflow">if</span> (nom!=accouverte)
<a name="l00436"></a>00436         {
<a name="l00437"></a>00437           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error while reading a list.&quot;</span> &lt;&lt; finl;
<a name="l00438"></a>00438           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;One expected an opened bracket { to start.&quot;</span> &lt;&lt; finl;
<a name="l00439"></a>00439           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00440"></a>00440         }
<a name="l00441"></a>00441       <span class="keywordflow">while</span>(1)
<a name="l00442"></a>00442         {
<a name="l00443"></a>00443           <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a> zone_tmp;
<a name="l00444"></a>00444           zone_tmp.<a class="code" href="classZone.html#a6a0068f3a0e3b45340f9dcbcef01e00a" title="read zone from the input stream">read_zone</a>(fic);
<a name="l00445"></a>00445           dom.<a class="code" href="classDomaine.html#a6204a2b89860bfd74ca2858d1d8750bf" title="Ajoute une Sous_Zone au domaine.">add</a>(zone_tmp);
<a name="l00446"></a>00446 
<a name="l00447"></a>00447           fic &gt;&gt; nom;
<a name="l00448"></a>00448           <span class="keywordflow">if</span>(nom==accfermee)
<a name="l00449"></a>00449             <span class="keywordflow">break</span>;
<a name="l00450"></a>00450           <span class="keywordflow">if</span>(nom!=virgule)
<a name="l00451"></a>00451             {
<a name="l00452"></a>00452               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; nom &lt;&lt; <span class="stringliteral">&quot; one expected a &#39;,&#39; or a &#39;}&#39;&quot;</span> &lt;&lt; finl;
<a name="l00453"></a>00453               <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00454"></a>00454             }
<a name="l00455"></a>00455         }
<a name="l00456"></a>00456 
<a name="l00457"></a>00457     }
<a name="l00458"></a>00458   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Done!&quot;</span> &lt;&lt; finl;
<a name="l00459"></a>00459 }
<a name="l00460"></a>00460 
<a name="l00461"></a>00461 <span class="comment">//</span><span class="comment"></span>
<a name="l00462"></a>00462 <span class="comment">//! Merging dom_to_add with dom</span>
<a name="l00463"></a><a class="code" href="classScatter.html#ace98ccb7d5fd754b2ae527ce96876977">00463</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classScatter.html#ace98ccb7d5fd754b2ae527ce96876977" title="Merging dom_to_add with dom.">Scatter::mergeDomains</a>(<a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom, <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom_to_add)
<a name="l00464"></a>00464 {
<a name="l00465"></a>00465   <span class="keywordtype">int</span> old_nb_elems = dom.<a class="code" href="classDomaine.html#a9f3fc389a1310d1fc8b4b27976855376" title="Renvoie le nombre de zone du domaine.">nb_zones</a>() ? dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a7f249429803b27139a1c54436f6164a5" title="Renvoie le nombre d&#39;elements de la zone.">nb_elem</a>() : 0;
<a name="l00466"></a>00466 <span class="comment">// merging vertices</span>
<a name="l00467"></a>00467   <a class="code" href="classIntVect.html">IntVect</a> nums;
<a name="l00468"></a>00468   <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone=dom.<a class="code" href="classDomaine.html#a6204a2b89860bfd74ca2858d1d8750bf" title="Ajoute une Sous_Zone au domaine.">add</a>(dom_to_add.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0));
<a name="l00469"></a>00469   zone.<a class="code" href="classZone.html#a68a215145852861f2d513c959f52a1a5" title="Specifie le domaine dont la zone fait partie.">associer_domaine</a>(dom);
<a name="l00470"></a>00470   dom.<a class="code" href="classDomaine.html#a9e067ee24e1952315722374190c8cb06" title="Ajoute des noeuds au domaine avec elimination des noeuds double au retour nums contient les nouveaux ...">ajouter</a>(dom_to_add.<a class="code" href="classDomaine.html#aecd32c3eecc15cce7d1a0e468dadbf96" title="Renvoie le tableau des coordonnees des noeuds (sommets). (acces en lecture)">coord_sommets</a>(), nums);
<a name="l00471"></a>00471   <a class="code" href="classScatter.html#a8cf934a9b5f7ecb7ef89f61c09804f45" title="methode utilisee par les interpretes qui modifient le domaine&lt;br&gt;(sequentiel), detruit les descripteu...">Scatter::uninit_sequential_domain</a>(dom);
<a name="l00472"></a>00472   zone.<a class="code" href="classZone.html#ade842749f28689fdf39c3a5ea2757e3f" title="Renumerotation des noeuds: Le noeud de numero k devient le noeud de numero Les_Nums[k].">renum</a>(nums);
<a name="l00473"></a>00473   zone.<a class="code" href="classZone.html#ac59b5ace8b4112340624d4b1cb9aa627" title="Renumerotation des noeuds et des elements presents dans les items communs des joints Le noeud de nume...">renum_joint_common_items</a>(nums, old_nb_elems);
<a name="l00474"></a>00474   zone.<a class="code" href="classZone.html#a68a215145852861f2d513c959f52a1a5" title="Specifie le domaine dont la zone fait partie.">associer_domaine</a>(dom);
<a name="l00475"></a>00475 
<a name="l00476"></a>00476   <span class="keywordflow">if</span>(dom.<a class="code" href="classDomaine.html#a1a2b46771e991fe1d8a68bbb13a96cd0">zones</a>().<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>() &gt; 1)
<a name="l00477"></a>00477     {
<a name="l00478"></a>00478       <span class="keywordtype">int</span> new_nb_elems = dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a7f249429803b27139a1c54436f6164a5" title="Renvoie le nombre d&#39;elements de la zone.">nb_elem</a>();
<a name="l00479"></a>00479 <span class="comment">// merging zones</span>
<a name="l00480"></a>00480       dom.<a class="code" href="classDomaine.html#a1a2b46771e991fe1d8a68bbb13a96cd0">zones</a>().<a class="code" href="classZones.html#aa1bcac020bceac5afecd16add50cc364" title="Merge all the zones of my processor in a single one is not tested when the zones are dispatched on mu...">merge</a>();
<a name="l00481"></a>00481 
<a name="l00482"></a>00482 <span class="comment">// merging common vertices and remote items</span>
<a name="l00483"></a>00483       <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; nb_joints = dom_to_add.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#ab096afb61e89705709a4ae6d3576a644" title="Renvoie le nombre de joints de la zone.">nb_joints</a>();
<a name="l00484"></a>00484       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_joint = 0; i_joint &lt; nb_joints; i_joint++)
<a name="l00485"></a>00485         {
<a name="l00486"></a>00486           <span class="keyword">const</span> <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp; joint_to_add  = dom_to_add.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>()[i_joint];
<a name="l00487"></a>00487 
<a name="l00488"></a>00488           <span class="keywordtype">int</span> my_joint_index = 0;
<a name="l00489"></a>00489           <span class="keywordflow">while</span>(joint_to_add.<a class="code" href="classJoint.html#a0952bc5c7805434ccd8cd5c9b01e3747" title="Renvoie PEvoisin (numero de la zone voisine)">PEvoisin</a>() != dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>()[my_joint_index].PEvoisin())
<a name="l00490"></a>00490             my_joint_index++;
<a name="l00491"></a>00491 
<a name="l00492"></a>00492           <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; sommets_to_add = joint_to_add.<a class="code" href="classJoint.html#a3f49fb1150967b436a115a7373ab27a0" title="Renvoie les informations de joint pour le type demande.">joint_item</a>(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>).<a class="code" href="classJoint__Items.html#a435fb1629f6dafb089605913517e73c4" title="Voir items_communs_.">items_communs</a>();
<a name="l00493"></a>00493           <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; items_communs = dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>()[my_joint_index].set_joint_item(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>).set_items_communs();
<a name="l00494"></a>00494           items_communs.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00495"></a>00495           <span class="keywordflow">for</span>(<span class="keywordtype">int</span> index=0; index&lt;sommets_to_add.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>(); index++)
<a name="l00496"></a>00496             items_communs.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(nums[sommets_to_add[index]]);
<a name="l00497"></a>00497           items_communs.<a class="code" href="classArrOfInt.html#a62f590c7e6998144131b7dbd8eb9a2a1" title="Tri des valeurs du tableau dans l&#39;ordre croissant et suppresion des doublons La fonction utilisee est...">array_trier_retirer_doublons</a>();
<a name="l00498"></a>00498 
<a name="l00499"></a>00499           <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; elements_to_add = joint_to_add.<a class="code" href="classJoint.html#a3f49fb1150967b436a115a7373ab27a0" title="Renvoie les informations de joint pour le type demande.">joint_item</a>(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926ae32de3a01fdb3ad6c506b8058a7f6173">Joint::ELEMENT</a>).<a class="code" href="classJoint__Items.html#ae51b330de79fcaae9c88166e3eee7cb8" title="Voir items_distants_.">items_distants</a>();
<a name="l00500"></a>00500           <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; items_distants = dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>()[my_joint_index].set_joint_item(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926ae32de3a01fdb3ad6c506b8058a7f6173">Joint::ELEMENT</a>).set_items_distants();
<a name="l00501"></a>00501           items_distants.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00502"></a>00502           <span class="keywordflow">for</span>(<span class="keywordtype">int</span> index=0; index&lt;elements_to_add.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>(); index++)
<a name="l00503"></a>00503             items_distants.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(new_nb_elems + elements_to_add[index]);
<a name="l00504"></a>00504         }
<a name="l00505"></a>00505     }
<a name="l00506"></a>00506 }
<a name="l00507"></a>00507 
<a name="l00508"></a>00508 <span class="comment">//</span>
<a name="l00509"></a>00509 <span class="comment">//</span>
<a name="l00510"></a>00510 <span class="comment">//</span>
<a name="l00511"></a>00511 <span class="comment">//</span><span class="comment"></span>
<a name="l00512"></a>00512 <span class="comment">//! Lit le domaine dans le fichier de nom &quot;nomentree&quot;,&lt;br&gt;de type LecFicDistribueBin ou LecFicDistribue&lt;br&gt;Format attendu : Domaine::ReadOn&lt;br&gt;La zone est renommee comme le domaine (pour lance_test_seq_par)</span>
<a name="l00513"></a><a class="code" href="classScatter.html#a0c740e8b05e31947a4f49d630f1302ec">00513</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classScatter.html#a0c740e8b05e31947a4f49d630f1302ec" title="Lit le domaine dans le fichier de nom &quot;nomentree&quot;, de type LecFicDistribueBin ou LecFicDistribue Form...">Scatter::lire_domaine</a>(<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; nomentree, <a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a>&amp; liste_bords_periodiques)
<a name="l00514"></a>00514 {
<a name="l00515"></a>00515 <span class="comment">// On determine si le fichier est au nouveau format ou a l&#39;ancien</span>
<a name="l00516"></a>00516   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l00517"></a>00517     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Reading geometry from .Zones file(s) ...&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00518"></a>00518   <a class="code" href="classProcess.html#aa9e74a5c06a68ea38298a08ea401e7b1" title="Synchronise tous les processeurs du groupe courant&lt;br&gt;(attend que tous les processeurs soient arrives...">barrier</a>(); <span class="comment">//!&lt; Attendre que le message soit affiche</span>
<a name="l00519"></a>00519 <span class="comment"></span>
<a name="l00520"></a>00520   <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom = <a class="code" href="classScatter.html#ac33aacdb609dcc870faeb93500ed017f">domaine</a>();
<a name="l00521"></a>00521 
<a name="l00522"></a>00522   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> copy(nomentree);
<a name="l00523"></a>00523   copy = copy.<a class="code" href="classNom.html#a49a5c6438b6efe73ab314900c60a329c" title="Insere _prefix000n (n=me() ou nproc()) dans un nom de fichier (par ex:toto.titi) pour donner toto_pre...">nom_me</a>(<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>(), <span class="stringliteral">&quot;p&quot;</span>, 1);
<a name="l00524"></a>00524 
<a name="l00525"></a>00525 <span class="comment">// bool is_hdf = FichierHDF::is_hdf5(copy);</span>
<a name="l00526"></a>00526   <a class="code" href="classLecFicDiffuse.html" title="Cette classe implemente les operateurs et les methodes virtuelles de la classe EFichier de la facon s...">LecFicDiffuse</a> <a class="code" href="Op__Grad__EF_8cpp.html#abc0897c211f7aa4541da5833388f868b">test</a>;
<a name="l00527"></a>00527   <span class="keywordtype">bool</span> is_hdf = test.<a class="code" href="classLecFicDiffuse.html#a2e4f3199de5e1b47edcffc68952c7be8" title="Ouverture du fichier. Cette methode doit etre appelee par tous les processeurs du groupe...">ouvrir</a>(copy) &amp;&amp; <a class="code" href="classFichierHDF.html#a0ad22bc624e64d0fecd33abb64b4881a">FichierHDF::is_hdf5</a>(copy);
<a name="l00528"></a>00528 
<a name="l00529"></a>00529   <span class="keyword">static</span> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> stats = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(0 <span class="comment">/* Level */</span>, <span class="stringliteral">&quot;Scatter::lire_domaine&quot;</span>, 0 <span class="comment">/* Group */</span>);
<a name="l00530"></a>00530 
<a name="l00531"></a>00531   <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#affcd058809786918ed173aaf681d0843">begin_count</a>(stats);
<a name="l00532"></a>00532   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> mergedZones(<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>());
<a name="l00533"></a>00533   mergedZones = 0;
<a name="l00534"></a>00534   <span class="keywordtype">bool</span> domain_not_built = <span class="keyword">true</span>;
<a name="l00535"></a>00535   <span class="keywordflow">if</span> (is_hdf)
<a name="l00536"></a>00536     {
<a name="l00537"></a>00537       <a class="code" href="classFichierHDFPar.html" title="Parallel collective version of FichierHDF, to be used for all concurrent reading/writing on HDF files...">FichierHDFPar</a> fic_hdf;
<a name="l00538"></a>00538 <span class="comment">// FichierHDF fic_hdf;</span>
<a name="l00539"></a>00539       nomentree = copy;
<a name="l00540"></a>00540       fic_hdf.<a class="code" href="classFichierHDF.html#a55803f961da3af25680be6cec26e85ec">open</a>(nomentree, <span class="keyword">true</span>);
<a name="l00541"></a>00541 
<a name="l00542"></a>00542       std::string dname = <span class="stringliteral">&quot;/zone_&quot;</span>  + std::to_string(<a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>());
<a name="l00543"></a>00543       <span class="keywordtype">bool</span> ok = fic_hdf.<a class="code" href="classFichierHDF.html#a5731b503f5e1472ad9ab934f759dcf7b">exists</a>(dname.c_str());
<a name="l00544"></a>00544       <span class="keywordflow">if</span>(!ok)
<a name="l00545"></a>00545         {
<a name="l00546"></a>00546           mergedZones = 1;
<a name="l00547"></a>00547           <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>(); i++)
<a name="l00548"></a>00548             {
<a name="l00549"></a>00549               <a class="code" href="classEntree__Brute.html" title="An Entree whose main source of data is an arbitrary binary buffer set using the set_data() method...">Entree_Brute</a> data_part;
<a name="l00550"></a>00550               <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a> part_dom;
<a name="l00551"></a>00551               std::string tmp = dname + <span class="stringliteral">&quot;_&quot;</span> + std::to_string(i);
<a name="l00552"></a>00552 
<a name="l00553"></a>00553               <span class="keywordtype">bool</span> exists = fic_hdf.<a class="code" href="classFichierHDF.html#a5731b503f5e1472ad9ab934f759dcf7b">exists</a>(tmp.c_str());
<a name="l00554"></a>00554               <span class="keywordflow">if</span>(exists)
<a name="l00555"></a>00555                 {
<a name="l00556"></a>00556                   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> dataset_name(dname.c_str());
<a name="l00557"></a>00557                   fic_hdf.<a class="code" href="classFichierHDF.html#a4b1e63bb02aebe3cd085af22cdd870af">read_dataset</a>(dataset_name, i, data_part);
<a name="l00558"></a>00558                   <a class="code" href="classScatter.html#ad8cdf7a8e4ad0065e9c3e1351aec8a1b" title="Does the exact same thing as the readOn of the class Domaine but without collective communication Nec...">readDomainWithoutCollComm</a>( part_dom, data_part );
<a name="l00559"></a>00559                   <a class="code" href="classScatter.html#ace98ccb7d5fd754b2ae527ce96876977" title="Merging dom_to_add with dom.">mergeDomains</a>(dom, part_dom);
<a name="l00560"></a>00560 
<a name="l00561"></a>00561 <span class="comment">// Renseigne dans quel fichier le domaine a ete lu</span>
<a name="l00562"></a>00562                   dom.<a class="code" href="classDomaine.html#a092a7a09cc39770fb7549ff29fcd8c8e">set_fichier_lu</a>(nomentree);
<a name="l00563"></a>00563                   data_part &gt;&gt; liste_bords_periodiques;
<a name="l00564"></a>00564                   domain_not_built = <span class="keyword">false</span>;
<a name="l00565"></a>00565                 }
<a name="l00566"></a>00566               <span class="keywordflow">else</span>
<a name="l00567"></a>00567                 <span class="keywordflow">break</span>;
<a name="l00568"></a>00568 
<a name="l00569"></a>00569             }
<a name="l00570"></a>00570         }
<a name="l00571"></a>00571       <span class="keywordflow">else</span>
<a name="l00572"></a>00572         {
<a name="l00573"></a>00573           <a class="code" href="classEntree__Brute.html" title="An Entree whose main source of data is an arbitrary binary buffer set using the set_data() method...">Entree_Brute</a> data;
<a name="l00574"></a>00574           fic_hdf.<a class="code" href="classFichierHDF.html#a4b1e63bb02aebe3cd085af22cdd870af">read_dataset</a>(<span class="stringliteral">&quot;/zone&quot;</span>, <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>(), data);
<a name="l00575"></a>00575 
<a name="l00576"></a>00576 <span class="comment">// Feed TRUST objects:</span>
<a name="l00577"></a>00577           <a class="code" href="classScatter.html#ad8cdf7a8e4ad0065e9c3e1351aec8a1b" title="Does the exact same thing as the readOn of the class Domaine but without collective communication Nec...">readDomainWithoutCollComm</a>(dom, data);
<a name="l00578"></a>00578           dom.<a class="code" href="classDomaine.html#a1a2b46771e991fe1d8a68bbb13a96cd0">zones</a>().<a class="code" href="classZones.html#a858a7732989d35d6899c47857ac135a6" title="Associe toutes les zones de la liste au domaine specifie.">associer_domaine</a>(dom);
<a name="l00579"></a>00579           dom.<a class="code" href="classDomaine.html#a092a7a09cc39770fb7549ff29fcd8c8e">set_fichier_lu</a>(nomentree);
<a name="l00580"></a>00580           data &gt;&gt; liste_bords_periodiques;
<a name="l00581"></a>00581           domain_not_built = <span class="keyword">false</span>;
<a name="l00582"></a>00582         }
<a name="l00583"></a>00583 
<a name="l00584"></a>00584       fic_hdf.<a class="code" href="classFichierHDF.html#ac5d8eb389ee60109c2d60029f442487f">close</a>();
<a name="l00585"></a>00585     }
<a name="l00586"></a>00586   <span class="keywordflow">else</span>
<a name="l00587"></a>00587     {
<a name="l00588"></a>00588       <a class="code" href="classLecFicDistribueBin.html" title="Lecture dans un fichier au format binaire. Cette classe implemente les operateurs et les methodes vir...">LecFicDistribueBin</a> fichier_binaire;
<a name="l00589"></a>00589       <span class="keywordtype">int</span> isSingleZone = fichier_binaire.<a class="code" href="classLecFicDistribue.html#a2186b78886c1a8630c7f69af03141087" title="Ouvre le fichier avec les parametres mode et prot donnes Ces parametres sont les parametres de la met...">ouvrir</a>(nomentree);
<a name="l00590"></a>00590       <span class="keywordflow">if</span> (!isSingleZone)
<a name="l00591"></a>00591         {
<a name="l00592"></a>00592           mergedZones = 1;
<a name="l00593"></a>00593           <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> nomentree_with_suffix=nomentree.<a class="code" href="classNom.html#a49a5c6438b6efe73ab314900c60a329c" title="Insere _prefix000n (n=me() ou nproc()) dans un nom de fichier (par ex:toto.titi) pour donner toto_pre...">nom_me</a>(<a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>());
<a name="l00594"></a>00594           <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>(); i++)
<a name="l00595"></a>00595             {
<a name="l00596"></a>00596               <a class="code" href="classEFichierBin.html" title="Lecture dans un fichier d&#39;objets ecrits au format binaire.">EFichierBin</a> fichier_binaire_part;
<a name="l00597"></a>00597               <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a> part_dom;
<a name="l00598"></a>00598               std::string tmp = nomentree_with_suffix.<a class="code" href="classNom.html#aad3086ebfdd912dadd099cd05cc45ee9">getPrefix</a>(<span class="stringliteral">&quot;.Zones&quot;</span>).<a class="code" href="classNom.html#a855d8cd96b5c73c2aa55cb7c0a870640">getString</a>();
<a name="l00599"></a>00599               tmp += <span class="stringliteral">&quot;_&quot;</span>;
<a name="l00600"></a>00600               tmp += std::to_string(i);
<a name="l00601"></a>00601               tmp += <span class="stringliteral">&quot;.Zones&quot;</span>;
<a name="l00602"></a>00602               <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> nomentree_part(tmp.c_str());
<a name="l00603"></a>00603               <span class="keywordtype">int</span> ok = fichier_binaire_part.<a class="code" href="classEntree__Fichier__base.html#a8e34b235668e94f335cc9ab18dd4e427">ouvrir</a>(nomentree_part);
<a name="l00604"></a>00604               <span class="keywordflow">if</span>(ok)
<a name="l00605"></a>00605                 {
<a name="l00606"></a>00606                   <a class="code" href="classScatter.html#ad8cdf7a8e4ad0065e9c3e1351aec8a1b" title="Does the exact same thing as the readOn of the class Domaine but without collective communication Nec...">readDomainWithoutCollComm</a>( part_dom, fichier_binaire_part );
<a name="l00607"></a>00607                   <a class="code" href="classScatter.html#ace98ccb7d5fd754b2ae527ce96876977" title="Merging dom_to_add with dom.">mergeDomains</a>(dom, part_dom);
<a name="l00608"></a>00608 
<a name="l00609"></a>00609 <span class="comment">// Renseigne dans quel fichier le domaine a ete lu</span>
<a name="l00610"></a>00610                   dom.<a class="code" href="classDomaine.html#a092a7a09cc39770fb7549ff29fcd8c8e">set_fichier_lu</a>(nomentree);
<a name="l00611"></a>00611                   fichier_binaire_part &gt;&gt; liste_bords_periodiques;
<a name="l00612"></a>00612                   fichier_binaire_part.<a class="code" href="classEntree__Fichier__base.html#aca9165bc1712c1057b4d4b91a7ea4fb4">close</a>();
<a name="l00613"></a>00613                   domain_not_built = <span class="keyword">false</span>;
<a name="l00614"></a>00614                 }
<a name="l00615"></a>00615               <span class="keywordflow">else</span>
<a name="l00616"></a>00616                 <span class="keywordflow">break</span>;
<a name="l00617"></a>00617             }
<a name="l00618"></a>00618         }
<a name="l00619"></a>00619       <span class="keywordflow">else</span>
<a name="l00620"></a>00620         {
<a name="l00621"></a>00621           <a class="code" href="classScatter.html#ad8cdf7a8e4ad0065e9c3e1351aec8a1b" title="Does the exact same thing as the readOn of the class Domaine but without collective communication Nec...">readDomainWithoutCollComm</a>(dom, fichier_binaire );
<a name="l00622"></a>00622 
<a name="l00623"></a>00623           dom.<a class="code" href="classDomaine.html#a1a2b46771e991fe1d8a68bbb13a96cd0">zones</a>().<a class="code" href="classZones.html#a858a7732989d35d6899c47857ac135a6" title="Associe toutes les zones de la liste au domaine specifie.">associer_domaine</a>(dom);
<a name="l00624"></a>00624 <span class="comment">// Renseigne dans quel fichier le domaine a ete lu</span>
<a name="l00625"></a>00625           dom.<a class="code" href="classDomaine.html#a092a7a09cc39770fb7549ff29fcd8c8e">set_fichier_lu</a>(nomentree);
<a name="l00626"></a>00626           fichier_binaire &gt;&gt; liste_bords_periodiques;
<a name="l00627"></a>00627           fichier_binaire.<a class="code" href="classEntree__Fichier__base.html#aca9165bc1712c1057b4d4b91a7ea4fb4">close</a>();
<a name="l00628"></a>00628           domain_not_built = <span class="keyword">false</span>;
<a name="l00629"></a>00629         }
<a name="l00630"></a>00630     }
<a name="l00631"></a>00631 
<a name="l00632"></a>00632   <span class="keywordflow">if</span>(domain_not_built)
<a name="l00633"></a>00633     {
<a name="l00634"></a>00634       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Scatter::lire_domaine\n&quot;</span>;
<a name="l00635"></a>00635       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;The domain on the current process hasn&#39;t been built&quot;</span> &lt;&lt; finl;
<a name="l00636"></a>00636       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;The number of processes you mentionned is probaly higher than the number of zones&quot;</span> &lt;&lt; finl;
<a name="l00637"></a>00637       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00638"></a>00638     }
<a name="l00639"></a>00639 
<a name="l00640"></a>00640 <span class="comment">// Verification sanitaire: nombre de processeurs = nombre de zones</span>
<a name="l00641"></a>00641 <span class="comment">// (on verifie qu&#39;il n&#39;y a pas de joint avec un processeur inexistant)</span>
<a name="l00642"></a>00642 <span class="comment">// (le check precedent n&#39;est pas suffisant:</span>
<a name="l00643"></a>00643 <span class="comment">// il verifie seulement que le nombre de processeurs n&#39;est pas superieur au nombre de zones)</span>
<a name="l00644"></a>00644   {
<a name="l00645"></a>00645 
<a name="l00646"></a>00646     <span class="keyword">const</span> <a class="code" href="classJoints.html" title="Classe Joints Cette classe represente une liste d&#39;objet de type Joint.">Joints</a>&amp; joints = dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>();
<a name="l00647"></a>00647     <span class="keyword">const</span> <span class="keywordtype">int</span> nb_joints = joints.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>();
<a name="l00648"></a>00648     <span class="keywordtype">int</span> max_pe_voisin = 0;
<a name="l00649"></a>00649     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_joints; i++)
<a name="l00650"></a>00650       {
<a name="l00651"></a>00651         <span class="keyword">const</span> <span class="keywordtype">int</span> pe_voisin = joints[i].PEvoisin();
<a name="l00652"></a>00652         <span class="keywordflow">if</span> (pe_voisin &gt;= max_pe_voisin)
<a name="l00653"></a>00653           max_pe_voisin = pe_voisin;
<a name="l00654"></a>00654       }
<a name="l00655"></a>00655 
<a name="l00656"></a>00656     max_pe_voisin = (int) <a class="code" href="classProcess.html#a1e9d9f9899b71927cfafae14c7bd048d" title="Calcule le max de x sur tous les processeurs du groupe courant. Remarques : Cette methode doit etre a...">mp_max</a>(max_pe_voisin);
<a name="l00657"></a>00657     <span class="keywordtype">double</span> ok=1;
<a name="l00658"></a>00658     <span class="keywordflow">if</span> (max_pe_voisin &gt;= <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">nproc</a>()) ok=0;
<a name="l00659"></a>00659     <span class="keywordflow">if</span> (!ok)
<a name="l00660"></a>00660       {
<a name="l00661"></a>00661         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Scatter::lire_domaine\n&quot;</span>
<a name="l00662"></a>00662              &lt;&lt; <span class="stringliteral">&quot;The domain has been partitioned with at least &quot;</span> &lt;&lt; max_pe_voisin &lt;&lt; <span class="stringliteral">&quot; &quot;</span>
<a name="l00663"></a>00663              &lt;&lt; <span class="stringliteral">&quot;zones whereas the number of processes asked is &quot;</span> &lt;&lt; <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>() &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; finl;
<a name="l00664"></a>00664         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;The number of zones and number of processes must match.&quot;</span> &lt;&lt; finl;
<a name="l00665"></a>00665         <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00666"></a>00666       }
<a name="l00667"></a>00667   }
<a name="l00668"></a>00668 
<a name="l00669"></a>00669 <span class="comment">// tri des joints dans l&#39;ordre croissant des procs</span>
<a name="l00670"></a>00670   <a class="code" href="classJoints.html" title="Classe Joints Cette classe represente une liste d&#39;objet de type Joint.">Joints</a>&amp; joints = dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>();
<a name="l00671"></a>00671   <a class="code" href="classScatter.html#ac5dd6d7661490708649976cde509f480" title="Tri des joints dans l&#39;ordre croissant des processeurs.">trier_les_joints</a>(joints);
<a name="l00672"></a>00672   <a class="code" href="communications_8cpp.html#a5ceda011ec527d63b691f62cd2fb61c8">envoyer_all_to_all</a>(mergedZones, mergedZones);
<a name="l00673"></a>00673   <a class="code" href="classScatter.html#a86c9311713284ed6591da95c7eb9411d" title="Merged zones receive joints information from their neighbours to ensure that their common items (vert...">check_consistancy_remote_items</a>( dom, mergedZones );
<a name="l00674"></a>00674   dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a7299f36361dd10ed56d008143f517bfe" title="associate the read objects to the zone and check that the reading objects are coherent">check_zone</a>();
<a name="l00675"></a>00675 
<a name="l00676"></a>00676 <span class="comment">// PL : pas tout a fait exact le nombre affiche de sommets, on compte plusieurs fois les sommets des joints...</span>
<a name="l00677"></a>00677   <span class="keywordtype">int</span> nbsom = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">mp_sum</a>(dom.<a class="code" href="classDomaine.html#a0846ac03a10b65c4df911fe35a19c02f" title="Renvoie le nombre total de sommets.">les_sommets</a>().<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0));
<a name="l00678"></a>00678   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Number of nodes: &quot;</span> &lt;&lt; nbsom &lt;&lt; finl;
<a name="l00679"></a>00679 
<a name="l00680"></a>00680   <a class="code" href="classScatter.html#a1874139ffd29d5a68191bc7828d3a5bd" title="cree des descripteurs sequentiels pour les tableaux sommets et elements du domaine (necessaire car Sc...">init_sequential_domain</a>(dom);
<a name="l00681"></a>00681 
<a name="l00682"></a>00682 <span class="comment">// merged zones need to reorder faces of periodic borders</span>
<a name="l00683"></a>00683   <span class="keyword">const</span> <span class="keywordtype">int</span> myZoneWasMerged = mergedZones[<a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>()];
<a name="l00684"></a>00684   <span class="keywordflow">if</span>(myZoneWasMerged)
<a name="l00685"></a>00685     {
<a name="l00686"></a>00686       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> bord_perio = 0; bord_perio &lt; liste_bords_periodiques.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>(); bord_perio++)
<a name="l00687"></a>00687         {
<a name="l00688"></a>00688           <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> bp_nom = liste_bords_periodiques(bord_perio);
<a name="l00689"></a>00689           <a class="code" href="classBord.html" title="Classe Bord Cette classe represente un bord d&#39;une zone, c&#39;est un type de frontiere&lt;br&gt;(derive de Fronti...">Bord</a>&amp; bord = dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#af2f1e6a14af55249979da674e7aac11a" title="Renvoie le i-ieme bord de la zone&lt;br&gt;(version const)">bord</a>(bp_nom);
<a name="l00690"></a>00690           <span class="keywordflow">if</span>(bord.<a class="code" href="classFrontiere.html#aa073fe9dbdddde59471ee7032b256aa2" title="Renvoie le nombre de faces de la frontiere.">nb_faces</a>() == 0)
<a name="l00691"></a>00691             <span class="keywordflow">continue</span>;
<a name="l00692"></a>00692 
<a name="l00693"></a>00693           <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> direction_perio(<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>);
<a name="l00694"></a>00694           <a class="code" href="classReordonner__faces__periodiques.html#ad93560d3838d3516deb892d88b47dedf">Reordonner_faces_periodiques::chercher_direction_perio</a>(direction_perio, dom, bp_nom);
<a name="l00695"></a>00695           <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; faces = bord.<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a07b8d8db9e3d656b93a21a49c063430c">les_sommets</a>();
<a name="l00696"></a>00696           <span class="keywordtype">double</span> epsilon = <a class="code" href="classObjet__U.html#a7447e25c68cc8d3a1c06cf99f0565cff">precision_geom</a>;
<a name="l00697"></a>00697           <a class="code" href="classReordonner__faces__periodiques.html#a3d177f6fcafb470513dad54fe4d9f79a" title="Reordonne le tableau &quot;faces&quot; selon la convention des faces periodiques: D&#39;abord les faces d&#39;une ext...">Reordonner_faces_periodiques::reordonner_faces_periodiques</a>(dom, faces, direction_perio, epsilon);
<a name="l00698"></a>00698         }
<a name="l00699"></a>00699     }
<a name="l00700"></a>00700 
<a name="l00701"></a>00701   <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a0faf52d1b518f5b0b2177f22efcc222d" title="Arret du compteur counter_id. On ajoute quantity a la somme des &#39;quantity&#39; (par defaut 0) stockees po...">end_count</a>(stats);
<a name="l00702"></a>00702   <a class="code" href="classProcess.html#aa9e74a5c06a68ea38298a08ea401e7b1" title="Synchronise tous les processeurs du groupe courant&lt;br&gt;(attend que tous les processeurs soient arrives...">barrier</a>();
<a name="l00703"></a>00703 }
<a name="l00704"></a>00704 
<a name="l00705"></a>00705 <span class="comment">// Precondition:</span>
<a name="l00706"></a>00706 <span class="comment">// - Les joints(i).faces et joints(i).sommets doivent etre remplis</span>
<a name="l00707"></a>00707 <span class="comment">// - Les joints(i).joint_item(Joint::SOMMET).items_communs()</span>
<a name="l00708"></a>00708 <span class="comment">// doivent etre remplis.</span>
<a name="l00709"></a>00709 <span class="comment">//</span>
<a name="l00710"></a>00710 <span class="comment">//</span>
<a name="l00711"></a>00711 <span class="comment">//</span>
<a name="l00712"></a>00712 <span class="comment">//</span><span class="comment"></span>
<a name="l00713"></a>00713 <span class="comment">//! Construction des structures paralleles du domaine et de la zone&lt;br&gt;(determination des elements distants en fonction de l&#39;epaisseur de joint,&lt;br&gt;determination des sommets distants,&lt;br&gt;creation des sommets et des elements virtuels)</span>
<a name="l00714"></a><a class="code" href="classScatter.html#af6b88297583bd92c6ca3814bc532b8be">00714</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classScatter.html#af6b88297583bd92c6ca3814bc532b8be" title="Construction des structures paralleles du domaine et de la zone (determination des elements distants ...">Scatter::construire_structures_paralleles</a>(<a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom, <span class="keyword">const</span> <a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a>&amp; liste_bords_periodiques)
<a name="l00715"></a>00715 {
<a name="l00716"></a>00716 <span class="comment">// D&#39;abord: supprimer les structures &quot;sequentielles&quot; associees aux sommets et elements lors de la lecture:</span>
<a name="l00717"></a>00717   {
<a name="l00718"></a>00718     <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a> md_nul;
<a name="l00719"></a>00719     dom.<a class="code" href="classDomaine.html#a0846ac03a10b65c4df911fe35a19c02f" title="Renvoie le nombre total de sommets.">les_sommets</a>().<a class="code" href="classDoubleTab.html#a2f40241acb678b0dd0dac7ee4f421b1d" title="associe le md_vector au vecteur (voir DoubleVect::set_md_vector()) dimension(0) sera initialise a md_...">set_md_vector</a>(md_nul);
<a name="l00720"></a>00720     dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#ac115e8342be89afb882b7b61cc343267" title="Renvoie le tableau des sommets des elements.">les_elems</a>().<a class="code" href="classIntTab.html#a02470d5d5921700f4daee05a5b3d2601" title="associe le md_vector au vecteur (voir IntVect::set_md_vector()) dimension(0) sera initialise a md_vec...">set_md_vector</a>(md_nul);
<a name="l00721"></a>00721   }
<a name="l00722"></a>00722 
<a name="l00723"></a>00723 <span class="comment">// L&#39;ordre d&#39;appel est important:</span>
<a name="l00724"></a>00724   <a class="code" href="classScatter.html#a589c34e38a91b69c2e4b43c77bf2bd9d" title="Remplissage du tableau &quot;espace_distant()&quot; des elements dans les joints. C&#39;est ici qu&#39;on determine l...">calculer_espace_distant_elements</a>(dom);
<a name="l00725"></a>00725 
<a name="l00726"></a>00726   <span class="keywordflow">if</span> (liste_bords_periodiques.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>() &gt; 0)
<a name="l00727"></a>00727     <a class="code" href="classScatter.html#a07723d3697739057d469082a4c4a554f" title="Les algorithmes actuels pour le periodique (assembleur P1B, OpDivElem P1B) ont besoin que pour chaque...">corriger_espace_distant_elements_perio</a>(dom, liste_bords_periodiques);
<a name="l00728"></a>00728 
<a name="l00729"></a>00729   <a class="code" href="classScatter.html#ab8e91081aefb68562533279f2446e988" title="!&lt; Description Pour un item geometrique &quot;type_item&quot;, remplit le champ nb_items_virtuels_ des joints ...">calculer_nb_items_virtuels</a>(dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>(), <a class="code" href="Champ__Generique__base_8h.html#a2228f5f8d54732b2077779d47c6f5ffba3d10bfe84917127ab3347aa5c6309f33">Joint::ELEMENT</a>);
<a name="l00730"></a>00730 
<a name="l00731"></a>00731 <span class="comment">// Determination des sommets distants en fonction des elements distants</span>
<a name="l00732"></a>00732   <a class="code" href="classScatter.html#a9cbfa7bf4fe3b741a56309931f4cf752" title="En fonction de l&#39;espace distant des elements, calcule l&#39;espace distant des sommets. Pour chaque joint, on envoie au processeur voisin l&#39;ensemble des sommets de tous les elements du joint. C&#39;est le processeur proprietaire du sommet&lt;br&gt;(plus petit pe qui le possede) qui le met dans son espace distant. Attention, on cree de nouveaux joints. On remplit les tableaux dom.zone(0).faces_joint(i).joint_item(Joint::SOMMET).items_distants();.">calculer_espace_distant_sommets</a>(dom, liste_bords_periodiques);
<a name="l00733"></a>00733 
<a name="l00734"></a>00734 <span class="comment">// Creation des espaces distants virtuels et items communs pour les tableaux</span>
<a name="l00735"></a>00735 <span class="comment">// sommets et elements:</span>
<a name="l00736"></a>00736   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; sommets = dom.<a class="code" href="classDomaine.html#a0846ac03a10b65c4df911fe35a19c02f" title="Renvoie le nombre total de sommets.">les_sommets</a>();
<a name="l00737"></a>00737   <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; elements = dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#ac115e8342be89afb882b7b61cc343267" title="Renvoie le tableau des sommets des elements.">les_elems</a>();
<a name="l00738"></a>00738   <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a> md_sommets, md_elements;
<a name="l00739"></a>00739   <a class="code" href="classScatter.html#ae226bc9cab92d0a02b88e2fe014e4a44" title="construction d&#39;un MD_Vector_std a partir des informations de joint du domaine pour le type d&#39;item dem...">construire_md_vector</a>(dom, sommets.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0), <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>, md_sommets);
<a name="l00740"></a>00740   <a class="code" href="classScatter.html#ae226bc9cab92d0a02b88e2fe014e4a44" title="construction d&#39;un MD_Vector_std a partir des informations de joint du domaine pour le type d&#39;item dem...">construire_md_vector</a>(dom, elements.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0), <a class="code" href="Champ__Generique__base_8h.html#a2228f5f8d54732b2077779d47c6f5ffba3d10bfe84917127ab3347aa5c6309f33">Joint::ELEMENT</a>, md_elements);
<a name="l00741"></a>00741   <a class="code" href="MD__Vector__tools_8cpp.html#aff1ed2791dba1a76fdb300920147cfdf">MD_Vector_tools::creer_tableau_distribue</a>(md_sommets, sommets);
<a name="l00742"></a>00742   sommets.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l00743"></a>00743   <a class="code" href="classScatter.html#a33c68e7eff97ee92b457b50e8e3ad58d" title="Construit la structure items_communs + espaces virtuels d&#39;un tableau contenant des indices d&#39;items ge...">construire_espace_virtuel_traduction</a>(md_elements <span class="comment">/* type index */</span>,
<a name="l00744"></a>00744                                        md_sommets <span class="comment">/* type valeur */</span>,
<a name="l00745"></a>00745                                        elements);
<a name="l00746"></a>00746 <span class="comment">// Reordonner les faces de joint (correspondance implicite avec le pe voisin)</span>
<a name="l00747"></a>00747   <a class="code" href="classScatter.html#a0a86d55709f7e53fcf40a09de74033cf" title="Reordonne les faces de joint de sorte qu&#39;elles apparaissent dans le meme ordre sur chaque couple de p...">reordonner_faces_de_joint</a>(dom);
<a name="l00748"></a>00748 }
<a name="l00749"></a>00749 
<a name="l00750"></a>00750 <span class="comment">//</span><span class="comment"></span>
<a name="l00751"></a>00751 <span class="comment">//! Tri des joints dans l&#39;ordre croissant des processeurs</span>
<a name="l00752"></a><a class="code" href="classScatter.html#ac5dd6d7661490708649976cde509f480">00752</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classScatter.html#ac5dd6d7661490708649976cde509f480" title="Tri des joints dans l&#39;ordre croissant des processeurs.">Scatter::trier_les_joints</a>(<a class="code" href="classJoints.html" title="Classe Joints Cette classe represente une liste d&#39;objet de type Joint.">Joints</a>&amp; joints)
<a name="l00753"></a>00753 {
<a name="l00754"></a>00754   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_joints = joints.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>();
<a name="l00755"></a>00755   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> pe_voisins(nb_joints);
<a name="l00756"></a>00756   <span class="keywordtype">int</span> i;
<a name="l00757"></a>00757   <span class="keywordflow">for</span> (i = 0; i &lt; nb_joints; i++)
<a name="l00758"></a>00758     pe_voisins[i] = joints[i].PEvoisin();
<a name="l00759"></a>00759   pe_voisins.<a class="code" href="classArrOfInt.html#abb0f48cf5a4be4b70edcc90baaebd521" title="Tri des valeurs du tableau dans l&#39;ordre croissant. La fonction utilisee est qsort de stdlib (elle est...">ordonne_array</a>();
<a name="l00760"></a>00760 <span class="comment">// Copie la liste des joints</span>
<a name="l00761"></a>00761   <a class="code" href="classJoints.html" title="Classe Joints Cette classe represente une liste d&#39;objet de type Joint.">Joints</a> anciens_joints(joints);
<a name="l00762"></a>00762   <span class="keywordflow">for</span> (i = 0; i &lt; nb_joints; i++)
<a name="l00763"></a>00763     {
<a name="l00764"></a>00764 <span class="comment">// On traite le processeur pe_voisin:</span>
<a name="l00765"></a>00765       <span class="keyword">const</span> <span class="keywordtype">int</span> pe_voisin = pe_voisins[i];
<a name="l00766"></a>00766 <span class="comment">// Ou est le joint avec ce processeur dans l&#39;ancienne liste ?</span>
<a name="l00767"></a>00767       <span class="keywordtype">int</span> i_old;
<a name="l00768"></a>00768       <span class="keywordflow">for</span> (i_old = 0; i_old &lt; nb_joints; i_old++)
<a name="l00769"></a>00769         <span class="keywordflow">if</span> (anciens_joints[i_old].PEvoisin() == pe_voisin)
<a name="l00770"></a>00770           <span class="keywordflow">break</span>;
<a name="l00771"></a>00771       assert(i_old &lt; nb_joints);
<a name="l00772"></a>00772       joints[i] = anciens_joints[i_old];
<a name="l00773"></a>00773     }
<a name="l00774"></a>00774 }
<a name="l00775"></a>00775 
<a name="l00776"></a>00776 <span class="comment"></span>
<a name="l00777"></a>00777 <span class="comment">//! Methode outil pour retirer les doublons dans un tableau.</span>
<a name="l00778"></a><a class="code" href="Scatter_8cpp.html#a23c4d19dc90caae2323f04de90621709">00778</a> <span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="Scatter_8cpp.html#a23c4d19dc90caae2323f04de90621709" title="Methode outil pour retirer les doublons dans un tableau.">array_trier_retirer_doublons</a>(<a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; array)
<a name="l00779"></a>00779 {
<a name="l00780"></a>00780   <span class="keyword">const</span> <span class="keywordtype">int</span> size_ = array.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00781"></a>00781   <span class="keywordflow">if</span> (size_ == 0)
<a name="l00782"></a>00782     <span class="keywordflow">return</span>;
<a name="l00783"></a>00783 <span class="comment">// Tri dans l&#39;ordre croissant</span>
<a name="l00784"></a>00784   array.<a class="code" href="classArrOfInt.html#abb0f48cf5a4be4b70edcc90baaebd521" title="Tri des valeurs du tableau dans l&#39;ordre croissant. La fonction utilisee est qsort de stdlib (elle est...">ordonne_array</a>();
<a name="l00785"></a>00785 <span class="comment">// Retire les doublons</span>
<a name="l00786"></a>00786   <span class="keywordtype">int</span> new_size_ = 1;
<a name="l00787"></a>00787   <span class="keywordtype">int</span> last_value = array[0];
<a name="l00788"></a>00788   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; size_; i++)
<a name="l00789"></a>00789     {
<a name="l00790"></a>00790       <span class="keywordflow">if</span> (array[i] != last_value)
<a name="l00791"></a>00791         {
<a name="l00792"></a>00792           array[new_size_] = last_value = array[i];
<a name="l00793"></a>00793           new_size_++;
<a name="l00794"></a>00794         }
<a name="l00795"></a>00795     }
<a name="l00796"></a>00796   array.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(new_size_);
<a name="l00797"></a>00797 }
<a name="l00798"></a>00798 
<a name="l00799"></a>00799 
<a name="l00800"></a>00800 <span class="comment">//</span>
<a name="l00801"></a>00801 <span class="comment">//</span>
<a name="l00802"></a>00802 <span class="comment">//</span>
<a name="l00803"></a>00803 <span class="comment">//</span>
<a name="l00804"></a>00804 <span class="comment">//</span><span class="comment"></span>
<a name="l00805"></a>00805 <span class="comment">//! Retire de &quot;sorted_array&quot; les elements qui figurent dans &quot;sorted_elements&quot;.&lt;br&gt;Les deux tableaux doivent etre initialement ordonnes dans l&#39;ordre croissant.&lt;br&gt;Exemple:&lt;br&gt;En entree sorted_array=[1,4,9,10,12,18], sorted_elements=[3,5,9,10,18,25]&lt;br&gt;En sortie sorted_array=[1,4,12]</span>
<a name="l00806"></a><a class="code" href="Scatter_8cpp.html#ab0ae6267baccb3a639f4a8ff795edd35">00806</a> <span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="Scatter_8cpp.html#ab0ae6267baccb3a639f4a8ff795edd35" title="Retire de &quot;sorted_array&quot; les elements qui figurent dans &quot;sorted_elements&quot;. Les deux tableaux doiv...">array_retirer_elements</a>(<a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; sorted_array, <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; sorted_elements_list)
<a name="l00807"></a>00807 {
<a name="l00808"></a>00808   <span class="keywordtype">int</span> i_read;      <span class="comment">//!&lt; Index dans sorted_array (en lecture)</span>
<a name="l00809"></a>00809 <span class="comment"></span>  <span class="keywordtype">int</span> i_write = 0; <span class="comment">//!&lt; Index dans sorted_array (la ou on ecrit)</span>
<a name="l00810"></a>00810 <span class="comment"></span>  <span class="keywordtype">int</span> j = 0;       <span class="comment">//!&lt; Index dans sorted_elements</span>
<a name="l00811"></a>00811 <span class="comment"></span>  <span class="keyword">const</span> <span class="keywordtype">int</span> n = sorted_array.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00812"></a>00812   <span class="keyword">const</span> <span class="keywordtype">int</span> m = sorted_elements_list.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00813"></a>00813   <span class="keywordflow">if</span> (m == 0)
<a name="l00814"></a>00814     <span class="keywordflow">return</span>;
<a name="l00815"></a>00815 
<a name="l00816"></a>00816   <span class="keywordtype">int</span> j_value = sorted_elements_list[j];
<a name="l00817"></a>00817   <span class="keywordflow">for</span> (i_read = 0; i_read &lt; n; i_read++)
<a name="l00818"></a>00818     {
<a name="l00819"></a>00819 <span class="comment">// Tableau trie ?</span>
<a name="l00820"></a>00820       assert(i_read == 0 || sorted_array[i_read] &gt; sorted_array[i_read-1]);
<a name="l00821"></a>00821       <span class="keyword">const</span> <span class="keywordtype">int</span> i_value = sorted_array[i_read];
<a name="l00822"></a>00822 
<a name="l00823"></a>00823 <span class="comment">// On avance dans la liste sorted_elements jusqu&#39;a trouver ou depasser</span>
<a name="l00824"></a>00824 <span class="comment">// l&#39;element i_value</span>
<a name="l00825"></a>00825       <span class="keywordflow">while</span> ((j_value &lt; i_value) &amp;&amp; (j &lt; m))
<a name="l00826"></a>00826         {
<a name="l00827"></a>00827           j++;
<a name="l00828"></a>00828           <span class="keywordflow">if</span> (j == m)
<a name="l00829"></a>00829             <span class="keywordflow">break</span>;
<a name="l00830"></a>00830           assert(sorted_elements_list[j] &gt; j_value); <span class="comment">//!&lt; Tableau trie ?</span>
<a name="l00831"></a>00831 <span class="comment"></span>          j_value = sorted_elements_list[j];
<a name="l00832"></a>00832         }
<a name="l00833"></a>00833 
<a name="l00834"></a>00834       <span class="keywordflow">if</span> (j == m || j_value != i_value)
<a name="l00835"></a>00835         {
<a name="l00836"></a>00836 <span class="comment">// i_value ne figure pas dans le tableau sorted_elements, on le garde</span>
<a name="l00837"></a>00837           sorted_array[i_write] = i_value;
<a name="l00838"></a>00838           i_write++;
<a name="l00839"></a>00839         }
<a name="l00840"></a>00840     }
<a name="l00841"></a>00841   sorted_array.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(i_write);
<a name="l00842"></a>00842 }
<a name="l00843"></a>00843 
<a name="l00844"></a>00844 
<a name="l00845"></a>00845 
<a name="l00846"></a>00846 <span class="comment">// Si un joint avec le &quot;pe&quot; existe, renvoie son indice,</span>
<a name="l00847"></a>00847 <span class="comment">// sion cree un nouveau joint et renvoie son indice.</span>
<a name="l00848"></a><a class="code" href="Scatter_8cpp.html#aad63bf1e3d986487b1fa8bc7e482c368">00848</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="Scatter_8cpp.html#aad63bf1e3d986487b1fa8bc7e482c368">ajouter_joint</a>(<a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone, <span class="keywordtype">int</span> pe)
<a name="l00849"></a>00849 {
<a name="l00850"></a>00850   <a class="code" href="classJoints.html" title="Classe Joints Cette classe represente une liste d&#39;objet de type Joint.">Joints</a>&amp; joints = zone.<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>();
<a name="l00851"></a>00851   <span class="keyword">const</span> <span class="keywordtype">int</span> i_joint = joints.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>();
<a name="l00852"></a>00852 
<a name="l00853"></a>00853   {
<a name="l00854"></a>00854     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; i_joint; i++)
<a name="l00855"></a>00855       <span class="keywordflow">if</span> (joints[i].PEvoisin() == pe)
<a name="l00856"></a>00856         <span class="keywordflow">return</span> i;
<a name="l00857"></a>00857   }
<a name="l00858"></a>00858 
<a name="l00859"></a>00859   <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp; joint = joints.<a class="code" href="classList__Joint.html#af5bca88a907fbe4086842805696cfe2f">add</a>(<a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>());
<a name="l00860"></a>00860   joint.<a class="code" href="classFrontiere.html#a714e3cc26d7e59f3a65d80de23ea21ac" title="Donne un nom a la frontiere.">nommer</a>(<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(<span class="stringliteral">&quot;Joint_&quot;</span>)+<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(pe));
<a name="l00861"></a>00861   joint.<a class="code" href="classFrontiere.html#af927b5d4fc1fd086ba91e916f61badee" title="Associe la frontiere a la zone dont elle depend.">associer_zone</a>(zone);
<a name="l00862"></a>00862   <span class="keywordtype">int</span> ep = (i_joint &gt; 0) ? joints[0].epaisseur() : 1;
<a name="l00863"></a>00863   joint.<a class="code" href="classJoint.html#a130c206de5fddabf173bb3e4604cefa3" title="Fixe l&#39;epaisseur du joint.">affecte_epaisseur</a>(ep);
<a name="l00864"></a>00864   joint.<a class="code" href="classJoint.html#a3c4ef6a648dd0b5d4aa072a1f4e3c64e" title="Fixe le numero du PE voisin.">affecte_PEvoisin</a>(pe);
<a name="l00865"></a>00865 
<a name="l00866"></a>00866 <span class="comment">// Initialiser tous les tableaux des joints supplementaires.</span>
<a name="l00867"></a>00867 <span class="comment">// Note BM: pour bien faire, il faudrait initialiser uniquement</span>
<a name="l00868"></a>00868 <span class="comment">// certains tableaux (ceux qui sont deja initialises pour les</span>
<a name="l00869"></a>00869 <span class="comment">// joints existants), mais c&#39;est plus complique a faire...</span>
<a name="l00870"></a>00870   {
<a name="l00871"></a>00871     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> t = 0; t &lt; 5; t++)
<a name="l00872"></a>00872       {
<a name="l00873"></a>00873         <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926">Joint::Type_Item</a> type;
<a name="l00874"></a>00874         <span class="keywordflow">switch</span>(t)
<a name="l00875"></a>00875           {
<a name="l00876"></a>00876           <span class="keywordflow">case</span> 0:
<a name="l00877"></a>00877             type = <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>;
<a name="l00878"></a>00878             <span class="keywordflow">break</span>;
<a name="l00879"></a>00879           <span class="keywordflow">case</span> 1:
<a name="l00880"></a>00880             type = <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926ae32de3a01fdb3ad6c506b8058a7f6173">Joint::ELEMENT</a>;
<a name="l00881"></a>00881             <span class="keywordflow">break</span>;
<a name="l00882"></a>00882           <span class="keywordflow">case</span> 2:
<a name="l00883"></a>00883             type = <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926ab255b88987fc7f64c215c958cbe2af6b">Joint::FACE</a>;
<a name="l00884"></a>00884             <span class="keywordflow">break</span>;
<a name="l00885"></a>00885           <span class="keywordflow">case</span> 3:
<a name="l00886"></a>00886             type = <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a7816c69408b98e1161f1f54e7b6b1cb4">Joint::ARETE</a>;
<a name="l00887"></a>00887             <span class="keywordflow">break</span>;
<a name="l00888"></a>00888           <span class="keywordflow">case</span> 4:
<a name="l00889"></a>00889             type = <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926af1ca60fd524298b1cb3e07b26a2d63c8">Joint::FACE_FRONT</a>;
<a name="l00890"></a>00890             <span class="keywordflow">break</span>;
<a name="l00891"></a>00891           <span class="keywordflow">default</span>:
<a name="l00892"></a>00892             <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Scatter.cpp : ajouter_joint&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00893"></a>00893 <span class="comment">// Pour eviter le warning suivant sur gcc 3.4:</span>
<a name="l00894"></a>00894 <span class="comment">// Scatter.cpp:416: warning: &#39;type&#39; might be used uninitialized in this function</span>
<a name="l00895"></a>00895             type = <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>;
<a name="l00896"></a>00896             <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00897"></a>00897           }
<a name="l00898"></a>00898         <a class="code" href="classJoint__Items.html" title="Joint_Items contient les informations de distribution parallele d&#39;un item geometrique particulier ave...">Joint_Items</a>&amp; data = joint.<a class="code" href="classJoint.html#aa1c4d729a3017082d26907d82ad1d7de" title="Renvoie les informations de joint pour un type d&#39;item geometrique donne, pour remplissage des structu...">set_joint_item</a>(type);
<a name="l00899"></a>00899         data.<a class="code" href="classJoint__Items.html#aa01c4601d506c658f4f1d45e66951ce0" title="Renvoie le tableau items_communs_ pour le remplir. (BM: ce tableau n&#39;est pas encore rempli)...">set_items_communs</a>();
<a name="l00900"></a>00900         data.<a class="code" href="classJoint__Items.html#a13add264f4ad36ef4bddbfc1b7bdb817" title="Renvoie le tableau items_distants_ pour le remplir Voir Scatter::calculer_espace_distant, Scatter::calculer_espace_distant_faces_frontieres, Scatter::calculer_espace_distant_elements.">set_items_distants</a>();
<a name="l00901"></a>00901         data.<a class="code" href="classJoint__Items.html#a956b3926baa83e9d5ab9848adf7f822a" title="Voir nb_items_virtuels_ Voir Scatter::calculer_nb_items_virtuels.">set_nb_items_virtuels</a>(0);
<a name="l00902"></a>00902         data.<a class="code" href="classJoint__Items.html#a95cc27c0fd65e2444a468df69a211057" title="Voir renum_items_communs_ Voir Scatter::calculer_colonne0_renum_faces_communes Scatter::construire_co...">set_renum_items_communs</a>().<a class="code" href="classIntTab.html#a22e6bed6826b3688d4d0181cbf3b7a38" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(0,2);
<a name="l00903"></a>00903       }
<a name="l00904"></a>00904   }
<a name="l00905"></a>00905 
<a name="l00906"></a>00906   <span class="keywordflow">return</span> i_joint;
<a name="l00907"></a>00907 }
<a name="l00908"></a>00908 
<a name="l00909"></a>00909 
<a name="l00910"></a>00910 <span class="comment">// Precondition:</span>
<a name="l00911"></a>00911 <span class="comment">// Methode a appeler simultanement par tous les processeurs.</span>
<a name="l00912"></a>00912 <span class="comment">//</span>
<a name="l00913"></a>00913 <span class="comment">//</span>
<a name="l00914"></a>00914 <span class="comment">//</span>
<a name="l00915"></a>00915 <span class="comment">//</span>
<a name="l00916"></a>00916 <span class="comment">//</span>
<a name="l00917"></a>00917 <span class="comment">//</span>
<a name="l00918"></a>00918 <span class="comment">//</span>
<a name="l00919"></a>00919 <span class="comment">//</span>
<a name="l00920"></a>00920 <span class="comment">//</span>
<a name="l00921"></a>00921 <span class="comment">//</span>
<a name="l00922"></a>00922 <span class="comment">//</span>
<a name="l00923"></a>00923 <span class="comment">//</span>
<a name="l00924"></a>00924 <span class="comment">//</span>
<a name="l00925"></a>00925 <span class="comment">//</span>
<a name="l00926"></a>00926 <span class="comment">//</span>
<a name="l00927"></a>00927 <span class="comment">//</span>
<a name="l00928"></a>00928 <span class="comment">//</span>
<a name="l00929"></a>00929 <span class="comment">//</span>
<a name="l00930"></a>00930 <span class="comment">//</span>
<a name="l00931"></a>00931 <span class="comment">//</span>
<a name="l00932"></a>00932 <span class="comment">//</span>
<a name="l00933"></a>00933 <span class="comment">//</span>
<a name="l00934"></a>00934 <span class="comment">//</span>
<a name="l00935"></a>00935 <span class="comment">//</span><span class="comment"></span>
<a name="l00936"></a>00936 <span class="comment">//! Determination des items distants en fonction d&#39;une liste d&#39;items&lt;br&gt;a envoyer et de listes d&#39;items communs.&lt;br&gt;exemple:&lt;br&gt;calculer_espace_distant_sommets&lt;br&gt;calculer_espace_distant_faces&lt;br&gt;Pour les sommets: les &quot;items_to_send&quot; sont les sommets des elements distants,&lt;br&gt;Si le processeur A veut que le processeur B connaisse le sommet i,&lt;br&gt;il faut que le processeur qui possede le sommet l&#39;envoie a B.&lt;br&gt;Le processeur qui &quot;possede&quot; le sommet est le plus petit parmi les PEs&lt;br&gt;qui partagent ce sommet (item commun) (requis pour pouvoir faire&lt;br&gt;echange_item_commun et echange_espace_virtuel en une seule passe).&lt;br&gt;De plus, si plusieurs processeurs demandent a envoyer le meme sommet&lt;br&gt;au meme processeur, il ne faut l&#39;inserer qu&#39;une seule fois dans l&#39;espace&lt;br&gt;distant.&lt;br&gt;Parametre: joints&lt;br&gt;Signification: les joints dans lesquels on veut calculer un espace distant&lt;br&gt;Parametre: nb_items_reels&lt;br&gt;Signification: le nombre d&#39;items reels (sommets, faces, ...)&lt;br&gt;Parametre: items_to_send&lt;br&gt;Signification: un vecteur de &quot;nproc()&quot; tableaux, pour chaque processeur,&lt;br&gt;la liste des items qu&#39;on veut lui envoyer (exemple:tous les sommets des&lt;br&gt;elements distants, ou toutes les faces)&lt;br&gt;Parametre: type_item&lt;br&gt;Signification: les items dont on veut calculer l&#39;espace distant</span>
<a name="l00937"></a><a class="code" href="classScatter.html#aa160f8c25dcf4bf1aa2cd9ead7cf51e3">00937</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classScatter.html#aa160f8c25dcf4bf1aa2cd9ead7cf51e3" title="Determination des items distants en fonction d&#39;une liste d&#39;items a envoyer et de listes d&#39;items commu...">Scatter::calculer_espace_distant</a>(<a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp;                  zone,
<a name="l00938"></a>00938                                       <span class="keyword">const</span> <span class="keywordtype">int</span>           nb_items_reels,
<a name="l00939"></a>00939                                       <span class="keyword">const</span> <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>) &amp; items_to_send,
<a name="l00940"></a>00940                                       <span class="keyword">const</span> <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926">Joint::Type_Item</a> type_item)
<a name="l00941"></a>00941 {
<a name="l00942"></a>00942   assert(items_to_send.size() == <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>());
<a name="l00943"></a>00943 
<a name="l00944"></a>00944   <a class="code" href="classProcess.html#a57e0f54b11e6eaadbea224fa904b18dd" title="Renvoie un objet statique de type Sortie qui sert de journal d&#39;evenements. Si message_level &lt;= verbose...">Process::Journal</a>() &lt;&lt; <span class="stringliteral">&quot;Scatter::calculer_espace_distant type_item=&quot;</span>
<a name="l00945"></a>00945                      &lt;&lt; (int)type_item &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00946"></a>00946 
<a name="l00947"></a>00947   <a class="code" href="classJoints.html" title="Classe Joints Cette classe represente une liste d&#39;objet de type Joint.">Joints</a>&amp; joints = zone.<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>();
<a name="l00948"></a>00948 
<a name="l00949"></a>00949 <span class="comment">// D&#39;abord, on determine pour tous les items le numero du PE proprietaire:</span>
<a name="l00950"></a>00950 <span class="comment">// Pour chaque item du domaine:</span>
<a name="l00951"></a>00951 <span class="comment">// colonne 0 : indice du item sur le PE proprietaire (index_on_pe_owner)</span>
<a name="l00952"></a>00952 <span class="comment">// colonne 1 : numero du PE proprietaire (le plus petit pe qui partage l&#39;item)</span>
<a name="l00953"></a>00953   <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a> num_global_items(nb_items_reels, 2);
<a name="l00954"></a>00954   {
<a name="l00955"></a>00955     <span class="keywordtype">int</span> i;
<a name="l00956"></a>00956     <span class="keyword">const</span> <span class="keywordtype">int</span> moi = <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>();
<a name="l00957"></a>00957     <span class="keywordflow">for</span> (i = 0; i &lt; nb_items_reels; i++)
<a name="l00958"></a>00958       {
<a name="l00959"></a>00959         num_global_items(i, 0) = i;
<a name="l00960"></a>00960         num_global_items(i, 1) = moi;
<a name="l00961"></a>00961       }
<a name="l00962"></a>00962     <span class="keyword">const</span> <span class="keywordtype">int</span> nb_joints = joints.<a class="code" href="classIntVect.html#ad90cfd411cbbd631ccf1935bb36f7c40" title="Identique a size_reelle()">size</a>();
<a name="l00963"></a>00963     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_joint = 0; i_joint &lt; nb_joints; i_joint++)
<a name="l00964"></a>00964       {
<a name="l00965"></a>00965         <span class="keyword">const</span> <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp;   joint              = joints[i_joint];
<a name="l00966"></a>00966         <span class="keyword">const</span> <span class="keywordtype">int</span>   pe_voisin          = joint.<a class="code" href="classJoint.html#a0952bc5c7805434ccd8cd5c9b01e3747" title="Renvoie PEvoisin (numero de la zone voisine)">PEvoisin</a>();
<a name="l00967"></a>00967         <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; renum_items_communs= joint.<a class="code" href="classJoint.html#a3f49fb1150967b436a115a7373ab27a0" title="Renvoie les informations de joint pour le type demande.">joint_item</a>(type_item).<a class="code" href="classJoint__Items.html#a11b6064b7fd16c1366c4c1e3a88ac2a5" title="Voir renum_items_communs_.">renum_items_communs</a>();
<a name="l00968"></a>00968         <span class="keyword">const</span> <span class="keywordtype">int</span>   nb_items_communs   = renum_items_communs.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00969"></a>00969         <span class="keywordflow">for</span> (i = 0; i &lt; nb_items_communs; i++)
<a name="l00970"></a>00970           {
<a name="l00971"></a>00971             <span class="keyword">const</span> <span class="keywordtype">int</span> num_item_distant = renum_items_communs(i, 0);
<a name="l00972"></a>00972             <span class="keyword">const</span> <span class="keywordtype">int</span> num_item_local   = renum_items_communs(i, 1);
<a name="l00973"></a>00973             <span class="keyword">const</span> <span class="keywordtype">int</span> pe_actuel = num_global_items(num_item_local, 1);
<a name="l00974"></a>00974             <span class="keywordflow">if</span> (pe_voisin &lt; pe_actuel)
<a name="l00975"></a>00975               {
<a name="l00976"></a>00976                 num_global_items(num_item_local, 0) = num_item_distant;
<a name="l00977"></a>00977                 num_global_items(num_item_local, 1) = pe_voisin;
<a name="l00978"></a>00978               }
<a name="l00979"></a>00979           }
<a name="l00980"></a>00980       }
<a name="l00981"></a>00981   }
<a name="l00982"></a>00982 
<a name="l00983"></a>00983   <a class="code" href="classSchema__Comm.html">Schema_Comm</a> schema_comm;
<a name="l00984"></a>00984   <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">nproc</a> = <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l00985"></a>00985 
<a name="l00986"></a>00986 <span class="comment">// Premiere etape : on envoie au processeur proprietaire des items</span>
<a name="l00987"></a>00987 <span class="comment">// la liste des items qu&#39;il faut envoyer et a quel processeur il</span>
<a name="l00988"></a>00988 <span class="comment">// faut les envoyer.</span>
<a name="l00989"></a>00989 <span class="comment">// Si le processeur A doit envoyer l&#39;element E au processeur B,</span>
<a name="l00990"></a>00990 <span class="comment">// et que cet element utilise un item S qui appartient au processeur C,</span>
<a name="l00991"></a>00991 <span class="comment">// alors on envoie a C le message :</span>
<a name="l00992"></a>00992 <span class="comment">// &quot;tu dois mettre le item S dans l&#39;espace distant du processeur B&quot;</span>
<a name="l00993"></a>00993 
<a name="l00994"></a>00994 <span class="comment">// On prepare un schema de communication entre les voisins:</span>
<a name="l00995"></a>00995 <span class="comment">// Processeur emetteur : le processeur qui possede l&#39;element distant,</span>
<a name="l00996"></a>00996 <span class="comment">// Processeur recepteur: le processeur qui possede un item de l&#39;element.</span>
<a name="l00997"></a>00997 <span class="comment">// Ces processeurs sont voisins par les joints existants.</span>
<a name="l00998"></a>00998   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_joints = joints.size();
<a name="l00999"></a>00999   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> liste_voisins(nb_joints);
<a name="l01000"></a>01000 <span class="comment">// int i_joint;</span>
<a name="l01001"></a>01001   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_joint = 0; i_joint &lt; nb_joints; i_joint++)
<a name="l01002"></a>01002     liste_voisins[i_joint] = joints[i_joint].PEvoisin();
<a name="l01003"></a>01003 
<a name="l01004"></a>01004   schema_comm.<a class="code" href="classSchema__Comm.html#ad11c9b47999c294c26ae4df8d2bbd57b" title="Definit la liste des processeurs a qui on va envoyer et de qui on va recevoir des donnees...">set_send_recv_pe_list</a>(liste_voisins, liste_voisins, 1 <span class="comment">/* me_to_me */</span>);
<a name="l01005"></a>01005   schema_comm.<a class="code" href="classSchema__Comm.html#ac617b53de22748cdd9fa30a0cfd0f4a8" title="Statut passe a WRITING Autorise si status_ == WRITING:">begin_comm</a>();
<a name="l01006"></a>01006   {
<a name="l01007"></a>01007 <span class="comment">// et pour chaque item a envoyer, on envoie au processeur qui possede l&#39;item (pe_item_owner):</span>
<a name="l01008"></a>01008 <span class="comment">// - l&#39;indice local du item chez lui (item_distant),</span>
<a name="l01009"></a>01009 <span class="comment">// - le numero du processeur a qui il doit l&#39;envoyer (pe_destination)</span>
<a name="l01010"></a>01010     <span class="keyword">const</span> <span class="keywordtype">int</span> nb_procs = <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l01011"></a>01011     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> pe_destination = 0; pe_destination &lt; nb_procs; pe_destination++)
<a name="l01012"></a>01012       {
<a name="l01013"></a>01013         <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; items    = items_to_send[pe_destination];
<a name="l01014"></a>01014         <span class="keyword">const</span> <span class="keywordtype">int</span>     nb_items = items.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l01015"></a>01015         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_item = 0; i_item &lt; nb_items; i_item++)
<a name="l01016"></a>01016           {
<a name="l01017"></a>01017             <span class="keyword">const</span> <span class="keywordtype">int</span> item          = items[i_item];
<a name="l01018"></a>01018             <span class="keyword">const</span> <span class="keywordtype">int</span> item_distant  = num_global_items(item, 0);
<a name="l01019"></a>01019             <span class="keyword">const</span> <span class="keywordtype">int</span> pe_item_owner = num_global_items(item, 1);
<a name="l01020"></a>01020 <span class="comment">// On envoie le numero du item distant et dans quel joint il</span>
<a name="l01021"></a>01021 <span class="comment">// faut le mettre.</span>
<a name="l01022"></a>01022 <span class="comment">// Si pe_joint == pe_destination, litem est forcement deja</span>
<a name="l01023"></a>01023 <span class="comment">// connu par l&#39;autre processeur, inutile de l&#39;envoyer</span>
<a name="l01024"></a>01024             <span class="keywordflow">if</span> (pe_item_owner != pe_destination)
<a name="l01025"></a>01025               schema_comm.<a class="code" href="classSchema__Comm.html#a6c771eae3b46250ae0d2f0126a7d8065" title="renvoie le buffer correspondant au processeur num_PE pour y entasser des donnees a envoyer...">send_buffer</a>(pe_item_owner) &lt;&lt; item_distant &lt;&lt; pe_destination;
<a name="l01026"></a>01026           }
<a name="l01027"></a>01027       }
<a name="l01028"></a>01028   }
<a name="l01029"></a>01029 
<a name="l01030"></a>01030 <span class="comment">// Echange des messages</span>
<a name="l01031"></a>01031   schema_comm.<a class="code" href="classSchema__Comm.html#abca0e8ac6c2b742d26f3cfaee0690c72" title="Statut passe a EXCHANGED.">echange_taille_et_messages</a>();
<a name="l01032"></a>01032 
<a name="l01033"></a>01033 <span class="comment">// Reception des items distants. On lit tous les buffers et on</span>
<a name="l01034"></a>01034 <span class="comment">// range les items dans &quot;items_distants&quot; par processeur destination.</span>
<a name="l01035"></a>01035 <span class="comment">// Pour chaque processeur voisin, la liste des items distants a envoyer:</span>
<a name="l01036"></a>01036   <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>) items_distants(nproc);
<a name="l01037"></a>01037   {
<a name="l01038"></a>01038 <span class="comment">// Pour append_array</span>
<a name="l01039"></a>01039     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> pe = 0; pe &lt; <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">nproc</a>; pe++)
<a name="l01040"></a>01040       items_distants[pe].set_smart_resize(1);
<a name="l01041"></a>01041   }
<a name="l01042"></a>01042 
<a name="l01043"></a>01043 <span class="comment">// Boucle sur tous les processeurs (pe_source) qui m&#39;ont envoye des messages:</span>
<a name="l01044"></a>01044 <span class="comment">// On boucle sur les processeurs voisins, plus moi-meme:</span>
<a name="l01045"></a>01045   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_source = 0; i_source &lt; nb_joints + 1; i_source++)
<a name="l01046"></a>01046     {
<a name="l01047"></a>01047       <span class="keyword">const</span> <span class="keywordtype">int</span> pe_source =
<a name="l01048"></a>01048         (i_source &lt; nb_joints) ? liste_voisins[i_source] : <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>();
<a name="l01049"></a>01049 
<a name="l01050"></a>01050       <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; buffer = schema_comm.<a class="code" href="classSchema__Comm.html#a0c056eb81ab8fd513912b336b4d13a1a" title="renvoie le buffer correspondant au processeur num_PE pour y lire les donnees recues. Le schema doit etre dans l&#39;etat EXCHANGED.">recv_buffer</a>(pe_source);
<a name="l01051"></a>01051 <span class="comment">// Boucle &quot;tant que le buffer n&#39;est pas vide&quot;</span>
<a name="l01052"></a>01052       <span class="keywordflow">while</span>(1)
<a name="l01053"></a>01053         {
<a name="l01054"></a>01054           <span class="keywordtype">int</span> item_distant; <span class="comment">//!&lt; Indice du item distant</span>
<a name="l01055"></a>01055 <span class="comment"></span>          <span class="keywordtype">int</span> pe_distant;   <span class="comment">//!&lt; Numero du pe a qui il faut envoyer le item</span>
<a name="l01056"></a>01056 <span class="comment"></span>          buffer &gt;&gt; item_distant &gt;&gt; pe_distant;
<a name="l01057"></a>01057           <span class="keywordflow">if</span> (buffer.<a class="code" href="classEntree.html#abcd397cb0b99fbe7c6f01047d8cec89c">eof</a>())
<a name="l01058"></a>01058             <span class="keywordflow">break</span>;
<a name="l01059"></a>01059           assert(pe_distant != <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>());
<a name="l01060"></a>01060           <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; array = items_distants[pe_distant];
<a name="l01061"></a>01061           array.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(item_distant);
<a name="l01062"></a>01062         }
<a name="l01063"></a>01063     }
<a name="l01064"></a>01064   schema_comm.<a class="code" href="classSchema__Comm.html#a73a981f88b6ffebc150fb46c5cce75d9" title="Statut passe a RESET Accesseurs:">end_comm</a>();
<a name="l01065"></a>01065 
<a name="l01066"></a>01066 <span class="comment">// On retire les doublons et les items deja connus par le processeur voisin:</span>
<a name="l01067"></a>01067   {
<a name="l01068"></a>01068 <span class="comment">// Liste des joints correspondant a chaque pe</span>
<a name="l01069"></a>01069     <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> joint_of_pe(nproc);
<a name="l01070"></a>01070     joint_of_pe = -1;
<a name="l01071"></a>01071     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_joint = 0; i_joint &lt; nb_joints; i_joint++)
<a name="l01072"></a>01072       {
<a name="l01073"></a>01073         <span class="keyword">const</span> <span class="keywordtype">int</span> pe = joints[i_joint].PEvoisin();
<a name="l01074"></a>01074         joint_of_pe[pe] = i_joint;
<a name="l01075"></a>01075       }
<a name="l01076"></a>01076 <span class="comment">// Liste des items deja connus par le processeur voisin (items communs)</span>
<a name="l01077"></a>01077 <span class="comment">// tries dans l&#39;ordre croissant</span>
<a name="l01078"></a>01078     <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> items_communs_tri;
<a name="l01079"></a>01079     items_communs_tri.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l01080"></a>01080     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> pe = 0; pe &lt; <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">nproc</a>; pe++)
<a name="l01081"></a>01081       {
<a name="l01082"></a>01082         <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; items = items_distants[pe];
<a name="l01083"></a>01083 <span class="comment">// Retirer les doublons:</span>
<a name="l01084"></a>01084         <a class="code" href="Scatter_8cpp.html#a23c4d19dc90caae2323f04de90621709" title="Methode outil pour retirer les doublons dans un tableau.">array_trier_retirer_doublons</a>(items);
<a name="l01085"></a>01085 <span class="comment">// Retirer les items deja connus:</span>
<a name="l01086"></a>01086         <span class="keyword">const</span> <span class="keywordtype">int</span> i_joint = joint_of_pe[pe];
<a name="l01087"></a>01087         <span class="keywordflow">if</span> (i_joint &gt;= 0)
<a name="l01088"></a>01088           {
<a name="l01089"></a>01089             items_communs_tri =
<a name="l01090"></a>01090               joints[i_joint].joint_item(type_item).items_communs();
<a name="l01091"></a>01091             items_communs_tri.<a class="code" href="classArrOfInt.html#abb0f48cf5a4be4b70edcc90baaebd521" title="Tri des valeurs du tableau dans l&#39;ordre croissant. La fonction utilisee est qsort de stdlib (elle est...">ordonne_array</a>();
<a name="l01092"></a>01092             <a class="code" href="Scatter_8cpp.html#ab0ae6267baccb3a639f4a8ff795edd35" title="Retire de &quot;sorted_array&quot; les elements qui figurent dans &quot;sorted_elements&quot;. Les deux tableaux doiv...">array_retirer_elements</a>(items, items_communs_tri);
<a name="l01093"></a>01093           }
<a name="l01094"></a>01094         <span class="keywordflow">else</span>
<a name="l01095"></a>01095           {
<a name="l01096"></a>01096 <span class="comment">// Pas d&#39;item commun avec ce pe.</span>
<a name="l01097"></a>01097           }
<a name="l01098"></a>01098       }
<a name="l01099"></a>01099   }
<a name="l01100"></a>01100 
<a name="l01101"></a>01101 <span class="comment">// Des espaces distants peuvent etre crees sur des processeurs avec</span>
<a name="l01102"></a>01102 <span class="comment">// qui il n&#39;existe pas encore de joint. On ajoute les nouveaux joints.</span>
<a name="l01103"></a>01103   {
<a name="l01104"></a>01104     <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> nouveaux_voisins;
<a name="l01105"></a>01105     nouveaux_voisins.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l01106"></a>01106     <span class="keywordtype">int</span> i;
<a name="l01107"></a>01107     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">nproc</a>; i++)
<a name="l01108"></a>01108       <span class="keywordflow">if</span> (items_distants[i].size_array() &gt; 0)
<a name="l01109"></a>01109         nouveaux_voisins.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(i);
<a name="l01110"></a>01110 
<a name="l01111"></a>01111 <span class="comment">// On ajoute les nouveaux joints</span>
<a name="l01112"></a>01112     <a class="code" href="classScatter.html#a472e9375c5a64518e7b50542d2209995" title="Ajoute des joints avec tous les pe de pe_voisins. Pour que l&#39;ensemble des joints soit symetrique...">ajouter_joints</a>(zone, nouveaux_voisins);
<a name="l01113"></a>01113     <a class="code" href="classProcess.html#a57e0f54b11e6eaadbea224fa904b18dd" title="Renvoie un objet statique de type Sortie qui sert de journal d&#39;evenements. Si message_level &lt;= verbose...">Process::Journal</a>() &lt;&lt; <span class="stringliteral">&quot; News joints created : (ArrOfInt) &quot;</span>
<a name="l01114"></a>01114                        &lt;&lt; nouveaux_voisins &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01115"></a>01115   }
<a name="l01116"></a>01116 
<a name="l01117"></a>01117   <a class="code" href="classJoints.html" title="Classe Joints Cette classe represente une liste d&#39;objet de type Joint.">Joints</a>&amp; joints_non_const = zone.<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>();
<a name="l01118"></a>01118   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_new_joints = joints_non_const.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>();
<a name="l01119"></a>01119 <span class="comment">// Remplissage des tableaux d&#39;items distants</span>
<a name="l01120"></a>01120   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_joint = 0; i_joint &lt; nb_new_joints; i_joint++)
<a name="l01121"></a>01121     {
<a name="l01122"></a>01122       <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp; joint = joints_non_const[i_joint];
<a name="l01123"></a>01123       <span class="keyword">const</span> <span class="keywordtype">int</span> pe = joint.<a class="code" href="classJoint.html#a0952bc5c7805434ccd8cd5c9b01e3747" title="Renvoie PEvoisin (numero de la zone voisine)">PEvoisin</a>();
<a name="l01124"></a>01124       <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; joint_items_distants = joint.<a class="code" href="classJoint.html#aa1c4d729a3017082d26907d82ad1d7de" title="Renvoie les informations de joint pour un type d&#39;item geometrique donne, pour remplissage des structu...">set_joint_item</a>(type_item).<a class="code" href="classJoint__Items.html#a13add264f4ad36ef4bddbfc1b7bdb817" title="Renvoie le tableau items_distants_ pour le remplir Voir Scatter::calculer_espace_distant, Scatter::calculer_espace_distant_faces_frontieres, Scatter::calculer_espace_distant_elements.">set_items_distants</a>();
<a name="l01125"></a>01125       joint_items_distants = items_distants[pe];
<a name="l01126"></a>01126       <a class="code" href="classProcess.html#a57e0f54b11e6eaadbea224fa904b18dd" title="Renvoie un objet statique de type Sortie qui sert de journal d&#39;evenements. Si message_level &lt;= verbose...">Process::Journal</a>() &lt;&lt; <span class="stringliteral">&quot; Joint with PE:&quot;</span> &lt;&lt; pe
<a name="l01127"></a>01127                          &lt;&lt; <span class="stringliteral">&quot; Number of remote items : &quot;</span>
<a name="l01128"></a>01128                          &lt;&lt; joint_items_distants.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>() &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01129"></a>01129     }
<a name="l01130"></a>01130 <span class="comment">// Remplissage du nombre d&#39;items virtuels</span>
<a name="l01131"></a>01131   <a class="code" href="classScatter.html#ab8e91081aefb68562533279f2446e988" title="!&lt; Description Pour un item geometrique &quot;type_item&quot;, remplit le champ nb_items_virtuels_ des joints ...">calculer_nb_items_virtuels</a>(joints_non_const, type_item);
<a name="l01132"></a>01132 }
<a name="l01133"></a><a class="code" href="Scatter_8cpp.html#a554d338bda1a27579f9fb08e6a0168b9">01133</a> <span class="keyword">inline</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> <a class="code" href="Scatter_8cpp.html#a554d338bda1a27579f9fb08e6a0168b9">endian</a>()
<a name="l01134"></a>01134 {
<a name="l01135"></a>01135   <span class="keywordtype">int</span> x = 1;
<a name="l01136"></a>01136   <span class="keywordflow">if</span>(*(<span class="keywordtype">char</span> *)&amp;x == 1)
<a name="l01137"></a>01137     <span class="keywordflow">return</span> <span class="stringliteral">&quot;little-endian&quot;</span>;
<a name="l01138"></a>01138   <span class="keywordflow">else</span>
<a name="l01139"></a>01139     <span class="keywordflow">return</span> <span class="stringliteral">&quot;big-endian&quot;</span>;
<a name="l01140"></a>01140 }
<a name="l01141"></a>01141 <span class="comment">// Precondition:</span>
<a name="l01142"></a>01142 <span class="comment">// Methode a appeler simultanement par tous les processeurs.</span>
<a name="l01143"></a>01143 <span class="comment">//</span>
<a name="l01144"></a>01144 <span class="comment">//</span>
<a name="l01145"></a>01145 <span class="comment">//</span>
<a name="l01146"></a>01146 <span class="comment">//</span>
<a name="l01147"></a>01147 <span class="comment">//</span>
<a name="l01148"></a>01148 <span class="comment">//</span>
<a name="l01149"></a>01149 <span class="comment">//</span><span class="comment"></span>
<a name="l01150"></a>01150 <span class="comment">//! Ajoute des joints avec tous les pe de pe_voisins.&lt;br&gt;Pour que l&#39;ensemble des joints soit symetrique,&lt;br&gt;on en cree aussi un joint sur le processeur destination:&lt;br&gt;Si A ajoute un joint avec B, alors B ajoute un joint avec A.&lt;br&gt;On trie les joints par ordre croissant du numero de PE.&lt;br&gt;ATTENTION: les joints sont donc reordonnes !&lt;br&gt;On met dans pe_voisins la liste des joints effectivement crees.</span>
<a name="l01151"></a><a class="code" href="classScatter.html#a472e9375c5a64518e7b50542d2209995">01151</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classScatter.html#a472e9375c5a64518e7b50542d2209995" title="Ajoute des joints avec tous les pe de pe_voisins. Pour que l&#39;ensemble des joints soit symetrique...">Scatter::ajouter_joints</a>(<a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone,
<a name="l01152"></a>01152                              <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; pe_voisins)
<a name="l01153"></a>01153 {
<a name="l01154"></a>01154   <a class="code" href="classJoints.html" title="Classe Joints Cette classe represente une liste d&#39;objet de type Joint.">Joints</a>&amp; joints = zone.<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>();
<a name="l01155"></a>01155   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> liste_pe;
<a name="l01156"></a>01156   pe_voisins.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l01157"></a>01157   liste_pe.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l01158"></a>01158 <span class="comment">// Rendre les joints symetriques (si A-&gt;B alors B-&gt;A) :</span>
<a name="l01159"></a>01159   {
<a name="l01160"></a>01160 <span class="comment">// On met dans liste pe la &quot;transposee&quot; de la liste des pe_voisins:</span>
<a name="l01161"></a>01161 <span class="comment">// liste des processeurs chez qui mon numero est dans &quot;pe_voisins&quot;.</span>
<a name="l01162"></a>01162     <a class="code" href="communications_8cpp.html#a38c9e2f958081bff6f390b56ec939523" title="Calcule la transposee d&#39;une liste de processeurs: On construit le tableau dest_list tel que: x est da...">reverse_send_recv_pe_list</a>(pe_voisins, liste_pe);
<a name="l01163"></a>01163     <span class="keyword">const</span> <span class="keywordtype">int</span> n = liste_pe.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l01164"></a>01164 <span class="comment">// On concatene les deux listes.</span>
<a name="l01165"></a>01165     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
<a name="l01166"></a>01166       pe_voisins.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(liste_pe[i]);
<a name="l01167"></a>01167     <a class="code" href="Scatter_8cpp.html#a23c4d19dc90caae2323f04de90621709" title="Methode outil pour retirer les doublons dans un tableau.">array_trier_retirer_doublons</a>(pe_voisins);
<a name="l01168"></a>01168     liste_pe.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(0);
<a name="l01169"></a>01169   }
<a name="l01170"></a>01170 <span class="comment">// On retire de pe_voisins les pe pour lesquels un joint existe deja</span>
<a name="l01171"></a>01171   {
<a name="l01172"></a>01172     <span class="keyword">const</span> <span class="keywordtype">int</span> n = joints.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>();
<a name="l01173"></a>01173     liste_pe.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(n);
<a name="l01174"></a>01174     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
<a name="l01175"></a>01175       liste_pe[i] = joints[i].PEvoisin();
<a name="l01176"></a>01176     <a class="code" href="Scatter_8cpp.html#ab0ae6267baccb3a639f4a8ff795edd35" title="Retire de &quot;sorted_array&quot; les elements qui figurent dans &quot;sorted_elements&quot;. Les deux tableaux doiv...">array_retirer_elements</a>(pe_voisins, liste_pe);
<a name="l01177"></a>01177   }
<a name="l01178"></a>01178 <span class="comment">// Ajouter les nouveaux joints et trier par ordre croissant</span>
<a name="l01179"></a>01179 <span class="comment">// Aujourd&#39;hui (2/11/2005) Liste::inserer ne permet pas d&#39;inserer</span>
<a name="l01180"></a>01180 <span class="comment">// en debut de liste. Donc inutilisable. Methode bourrin:</span>
<a name="l01181"></a>01181   {
<a name="l01182"></a>01182     <span class="keyword">const</span> <span class="keywordtype">int</span> n = pe_voisins.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l01183"></a>01183     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
<a name="l01184"></a>01184       <a class="code" href="Scatter_8cpp.html#aad63bf1e3d986487b1fa8bc7e482c368">ajouter_joint</a>(zone, pe_voisins[i]);
<a name="l01185"></a>01185     <a class="code" href="classScatter.html#ac5dd6d7661490708649976cde509f480" title="Tri des joints dans l&#39;ordre croissant des processeurs.">trier_les_joints</a>(joints);
<a name="l01186"></a>01186   }
<a name="l01187"></a>01187 }
<a name="l01188"></a>01188 
<a name="l01189"></a>01189 <span class="comment">// Precondition: les elements distants et les items_communs du type_item</span>
<a name="l01190"></a>01190 <span class="comment">// doivent avoir ete remplis.</span>
<a name="l01191"></a>01191 <span class="comment">//</span>
<a name="l01192"></a>01192 <span class="comment">//</span>
<a name="l01193"></a>01193 <span class="comment">//</span>
<a name="l01194"></a>01194 <span class="comment">//</span>
<a name="l01195"></a>01195 <span class="comment">//</span>
<a name="l01196"></a>01196 <span class="comment">//</span>
<a name="l01197"></a>01197 <span class="comment">//</span>
<a name="l01198"></a>01198 <span class="comment">//</span>
<a name="l01199"></a>01199 <span class="comment">//</span>
<a name="l01200"></a>01200 <span class="comment">//</span>
<a name="l01201"></a>01201 <span class="comment">//</span>
<a name="l01202"></a>01202 <span class="comment">//</span>
<a name="l01203"></a>01203 <span class="comment">//</span>
<a name="l01204"></a>01204 <span class="comment">//</span>
<a name="l01205"></a>01205 <span class="comment">//</span>
<a name="l01206"></a>01206 <span class="comment">//</span>
<a name="l01207"></a>01207 <span class="comment">//</span>
<a name="l01208"></a>01208 <span class="comment">//</span>
<a name="l01209"></a>01209 <span class="comment">//</span>
<a name="l01210"></a>01210 <span class="comment">//</span>
<a name="l01211"></a>01211 <span class="comment">//</span>
<a name="l01212"></a>01212 <span class="comment">//</span>
<a name="l01213"></a>01213 <span class="comment">//</span>
<a name="l01214"></a>01214 <span class="comment">//</span>
<a name="l01215"></a>01215 <span class="comment">//</span>
<a name="l01216"></a>01216 <span class="comment">//</span>
<a name="l01217"></a>01217 <span class="comment">//</span><span class="comment"></span>
<a name="l01218"></a>01218 <span class="comment">//! Methode generique pour calculer l&#39;espace distant d&#39;un type d&#39;items geometrique&lt;br&gt;(sommet, face, arete) en fonction de l&#39;espace distant des elements:&lt;br&gt;Les &quot;type_item&quot; distants (pour type_item = sommet face ou arete) sont&lt;br&gt;les &quot;type_item&quot; attaches aux elements distants.&lt;br&gt;Exemple : les sommets distants sont tous les sommets de tous les elements&lt;br&gt;distants.&lt;br&gt;Voir aussi:&lt;br&gt;Scatter::calculer_espace_distant_sommets&lt;br&gt;Scatter::calculer_espace_distant_faces&lt;br&gt;Parametre: zone&lt;br&gt;Signification: bah, la zone quoi...&lt;br&gt;Parametre: type_item&lt;br&gt;Signification: le type des items dont on veut calculer l&#39;espace distant&lt;br&gt;Parametre: connectivite_elem_item&lt;br&gt;Signification: le tableau qui donne pour chaque element de la zone les&lt;br&gt;indices des items de cet element. On n&#39;utilise que la partie reele du&lt;br&gt;tableau (logiquement, la partie virtuelle n&#39;existe pas encore).&lt;br&gt;(exemple: zone().les_elems() pour type_item==SOMMET ou zone_VF().face_sommets()&lt;br&gt;pour type_item==FACE)&lt;br&gt;Parametre: nb_items_reels&lt;br&gt;Signification: le nombre de &quot;type_item&quot; reels&lt;br&gt;Parametre: items_lies&lt;br&gt;Signification: si le tableau est non vide, il doit etre de taille nb_items_reels.&lt;br&gt;Dans ce cas, il permet de forcer la propriete suivante :&lt;br&gt;&quot;si l&#39;item i est distant, alors l&#39;item items_lies[i] est distant aussi&quot;.&lt;br&gt;Ce tableau est utilise pour inclure les sommets periodiques virtuels associes.&lt;br&gt;(voir calculer_espace_distant_sommets).</span>
<a name="l01219"></a><a class="code" href="Scatter_8cpp.html#aaf22a425af9ec9c52eca3d13f3ecea9f">01219</a> <span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="Scatter_8cpp.html#aaf22a425af9ec9c52eca3d13f3ecea9f" title="Methode generique pour calculer l&#39;espace distant d&#39;un type d&#39;items geometrique&lt;br&gt;(sommet, face, arete) en fonction de l&#39;espace distant des elements: Les &quot;type_item&quot; distants (pour type_item = sommet face ou arete) sont les &quot;type_item&quot; attaches aux elements distants. Exemple : les sommets distants sont tous les sommets de tous les elements distants. Voir aussi: Scatter::calculer_espace_distant_sommets Scatter::calculer_espace_distant_faces Parametre: zone Signification: bah, la zone quoi... Parametre: type_item Signification: le type des items dont on veut calculer l&#39;espace distant Parametre: connectivite_elem_item Signification: le tableau qui donne pour chaque element de la zone les indices des items de cet element. On n&#39;utilise que la partie reele du tableau (logiquement, la partie virtuelle n&#39;existe pas encore). (exemple: zone().les_elems() pour type_item==SOMMET ou zone_VF().face_sommets() pour type_item==FACE) Parametre: nb_items_reels Signification: le nombre de &quot;type_item&quot; reels Parametre: items_lies Signification: si le tableau est non vide, il doit etre de taille nb_items_reels. Dans ce cas, il permet de forcer la propriete suivante : &quot;si l&#39;item i est distant, alors l&#39;item items_lies[i] est distant aussi&quot;. Ce tableau est utilise pour inclure les sommets periodiques virtuels associes. (voir calculer_espace_distant_sommets).">calculer_espace_distant_item</a>(<a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; la_zone,
<a name="l01220"></a>01220                                          <span class="keyword">const</span> <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926">Joint::Type_Item</a> type_item,
<a name="l01221"></a>01221                                          <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; connectivite_elem_item,
<a name="l01222"></a>01222                                          <span class="keyword">const</span> <span class="keywordtype">int</span> nb_items_reels,
<a name="l01223"></a>01223                                          <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; items_lies)
<a name="l01224"></a>01224 {
<a name="l01225"></a>01225   <span class="keyword">const</span> <a class="code" href="classJoints.html" title="Classe Joints Cette classe represente une liste d&#39;objet de type Joint.">Joints</a>&amp; joints                 = la_zone.<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>();
<a name="l01226"></a>01226   <span class="keyword">const</span> <span class="keywordtype">int</span>   nb_joints              = joints.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>();
<a name="l01227"></a>01227   <span class="keyword">const</span> <span class="keywordtype">int</span>   nproc                  = <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l01228"></a>01228   <span class="keyword">const</span> <span class="keywordtype">int</span>   nb_items_par_element   = connectivite_elem_item.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1);
<a name="l01229"></a>01229 <span class="comment">// Les type_item a envoyer a chaque processeur:</span>
<a name="l01230"></a>01230   <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>) items_to_send(nproc);
<a name="l01231"></a>01231 <span class="comment">// Un tableau temporaire;</span>
<a name="l01232"></a>01232   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> liste_items;
<a name="l01233"></a>01233   liste_items.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l01234"></a>01234 
<a name="l01235"></a>01235 <span class="comment">// Est-ce qu&#39;il y a des items lies ?</span>
<a name="l01236"></a>01236   <span class="keyword">const</span> <span class="keywordtype">int</span> flag_items_lies = (items_lies.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>() &gt; 0);
<a name="l01237"></a>01237   assert(flag_items_lies == 0 || items_lies.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>() == nb_items_reels);
<a name="l01238"></a>01238 
<a name="l01239"></a>01239 
<a name="l01240"></a>01240   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_joint = 0; i_joint &lt; nb_joints; i_joint++)
<a name="l01241"></a>01241     {
<a name="l01242"></a>01242       <span class="keyword">const</span> <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp;     joint          = joints[i_joint];
<a name="l01243"></a>01243       <span class="keyword">const</span> <span class="keywordtype">int</span>     pe_voisin      = joint.<a class="code" href="classJoint.html#a0952bc5c7805434ccd8cd5c9b01e3747" title="Renvoie PEvoisin (numero de la zone voisine)">PEvoisin</a>();
<a name="l01244"></a>01244       <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; esp_dist_elems = joint.<a class="code" href="classJoint.html#a3f49fb1150967b436a115a7373ab27a0" title="Renvoie les informations de joint pour le type demande.">joint_item</a>(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926ae32de3a01fdb3ad6c506b8058a7f6173">Joint::ELEMENT</a>).<a class="code" href="classJoint__Items.html#ae51b330de79fcaae9c88166e3eee7cb8" title="Voir items_distants_.">items_distants</a>();
<a name="l01245"></a>01245       <span class="keyword">const</span> <span class="keywordtype">int</span>     nb_elems_dist  = esp_dist_elems.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l01246"></a>01246       liste_items.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(0);
<a name="l01247"></a>01247 <span class="comment">// On met dans liste_items tous les items de tous les elements</span>
<a name="l01248"></a>01248 <span class="comment">// qui sont dans esp_dist_elems:</span>
<a name="l01249"></a>01249       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_elem = 0; i_elem &lt; nb_elems_dist; i_elem++)
<a name="l01250"></a>01250         {
<a name="l01251"></a>01251           <span class="keyword">const</span> <span class="keywordtype">int</span> elem = esp_dist_elems[i_elem];
<a name="l01252"></a>01252           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_item = 0; i_item &lt; nb_items_par_element; i_item++)
<a name="l01253"></a>01253             {
<a name="l01254"></a>01254               <span class="keyword">const</span> <span class="keywordtype">int</span> item = connectivite_elem_item(elem, i_item);
<a name="l01255"></a>01255               <span class="keywordflow">if</span> (item&gt;-1)
<a name="l01256"></a>01256                 {
<a name="l01257"></a>01257                   liste_items.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(item);
<a name="l01258"></a>01258 <span class="comment">// Si un item est lie a l&#39;item courant, on envoie aussi l&#39;item lie.</span>
<a name="l01259"></a>01259                   <span class="keywordflow">if</span> (flag_items_lies)
<a name="l01260"></a>01260                     {
<a name="l01261"></a>01261                       <span class="keyword">const</span> <span class="keywordtype">int</span> item_lie = items_lies[item];
<a name="l01262"></a>01262                       <span class="keywordflow">if</span> (item_lie != item)
<a name="l01263"></a>01263                         {
<a name="l01264"></a>01264                           assert(item_lie &gt;= 0 &amp;&amp; item_lie &lt; nb_items_reels);
<a name="l01265"></a>01265                           assert(items_lies[item_lie] == item_lie); <span class="comment">//!&lt; chaine de liaisons interdite</span>
<a name="l01266"></a>01266 <span class="comment"></span>                          liste_items.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(item_lie);
<a name="l01267"></a>01267                         }
<a name="l01268"></a>01268                     }
<a name="l01269"></a>01269                 }
<a name="l01270"></a>01270             }
<a name="l01271"></a>01271         }
<a name="l01272"></a>01272       <a class="code" href="Scatter_8cpp.html#a23c4d19dc90caae2323f04de90621709" title="Methode outil pour retirer les doublons dans un tableau.">array_trier_retirer_doublons</a>(liste_items);
<a name="l01273"></a>01273 <span class="comment">// Ces items doivent etre envoyes au processeur voisin:</span>
<a name="l01274"></a>01274       items_to_send[pe_voisin] = liste_items;
<a name="l01275"></a>01275     }
<a name="l01276"></a>01276 <span class="comment">// Calcul des espaces distants en fonction de &quot;items_to_send&quot;</span>
<a name="l01277"></a>01277   <a class="code" href="classScatter.html#aa160f8c25dcf4bf1aa2cd9ead7cf51e3" title="Determination des items distants en fonction d&#39;une liste d&#39;items a envoyer et de listes d&#39;items commu...">Scatter::calculer_espace_distant</a>(la_zone, nb_items_reels, items_to_send, type_item);
<a name="l01278"></a>01278 }
<a name="l01279"></a>01279 
<a name="l01280"></a>01280 <span class="comment">//</span>
<a name="l01281"></a>01281 <span class="comment">//</span>
<a name="l01282"></a>01282 <span class="comment">//</span>
<a name="l01283"></a>01283 <span class="comment">//</span>
<a name="l01284"></a>01284 <span class="comment">//</span>
<a name="l01285"></a>01285 <span class="comment">//</span>
<a name="l01286"></a>01286 <span class="comment">//</span>
<a name="l01287"></a>01287 <span class="comment">//</span><span class="comment"></span>
<a name="l01288"></a>01288 <span class="comment">//! En fonction de l&#39;espace distant des elements, calcule l&#39;espace&lt;br&gt;distant des sommets. Pour chaque joint, on envoie au processeur voisin&lt;br&gt;l&#39;ensemble des sommets de tous les elements du joint.&lt;br&gt;C&#39;est le processeur proprietaire du sommet&lt;br&gt;(plus petit pe qui le possede) qui le met dans son espace distant.&lt;br&gt;Attention, on cree de nouveaux joints.&lt;br&gt;On remplit les tableaux&lt;br&gt;dom.zone(0).faces_joint(i).joint_item(Joint::SOMMET).items_distants();</span>
<a name="l01289"></a><a class="code" href="classScatter.html#a9cbfa7bf4fe3b741a56309931f4cf752">01289</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classScatter.html#a9cbfa7bf4fe3b741a56309931f4cf752" title="En fonction de l&#39;espace distant des elements, calcule l&#39;espace distant des sommets. Pour chaque joint, on envoie au processeur voisin l&#39;ensemble des sommets de tous les elements du joint. C&#39;est le processeur proprietaire du sommet&lt;br&gt;(plus petit pe qui le possede) qui le met dans son espace distant. Attention, on cree de nouveaux joints. On remplit les tableaux dom.zone(0).faces_joint(i).joint_item(Joint::SOMMET).items_distants();.">Scatter::calculer_espace_distant_sommets</a>(<a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom, <span class="keyword">const</span> <a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a>&amp; liste_bords_perio)
<a name="l01290"></a>01290 {
<a name="l01291"></a>01291   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l01292"></a>01292     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Scatter::calculer_espace_distant_sommets : start&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01293"></a>01293 
<a name="l01294"></a>01294   <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp;          zone                  = dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0);
<a name="l01295"></a>01295   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; connectivite_elem_som = zone.<a class="code" href="classZone.html#ac115e8342be89afb882b7b61cc343267" title="Renvoie le tableau des sommets des elements.">les_elems</a>();
<a name="l01296"></a>01296   <span class="keyword">const</span> <span class="keywordtype">int</span>   nb_sommets_reels      = dom.<a class="code" href="classDomaine.html#abc4abc8b8db5bebeb161fae4162a89ce" title="Renvoie le nombre de sommets.">nb_som</a>();
<a name="l01297"></a>01297 
<a name="l01298"></a>01298   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> renum_som_perio(nb_sommets_reels);
<a name="l01299"></a>01299 <span class="comment">// Initialisation du tableau renum_som_perio</span>
<a name="l01300"></a>01300   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_sommets_reels; i++)
<a name="l01301"></a>01301     renum_som_perio[i] = i;
<a name="l01302"></a>01302   <a class="code" href="classReordonner__faces__periodiques.html#aee6a67196132bed17c8d786d6c39316c">Reordonner_faces_periodiques::renum_som_perio</a>(dom, liste_bords_perio, renum_som_perio,
<a name="l01303"></a>01303                                                 0 <span class="comment">/* ne pas calculer pour les sommets virtuels */</span>);
<a name="l01304"></a>01304 
<a name="l01305"></a>01305   <a class="code" href="Scatter_8cpp.html#aaf22a425af9ec9c52eca3d13f3ecea9f" title="Methode generique pour calculer l&#39;espace distant d&#39;un type d&#39;items geometrique&lt;br&gt;(sommet, face, arete) en fonction de l&#39;espace distant des elements: Les &quot;type_item&quot; distants (pour type_item = sommet face ou arete) sont les &quot;type_item&quot; attaches aux elements distants. Exemple : les sommets distants sont tous les sommets de tous les elements distants. Voir aussi: Scatter::calculer_espace_distant_sommets Scatter::calculer_espace_distant_faces Parametre: zone Signification: bah, la zone quoi... Parametre: type_item Signification: le type des items dont on veut calculer l&#39;espace distant Parametre: connectivite_elem_item Signification: le tableau qui donne pour chaque element de la zone les indices des items de cet element. On n&#39;utilise que la partie reele du tableau (logiquement, la partie virtuelle n&#39;existe pas encore). (exemple: zone().les_elems() pour type_item==SOMMET ou zone_VF().face_sommets() pour type_item==FACE) Parametre: nb_items_reels Signification: le nombre de &quot;type_item&quot; reels Parametre: items_lies Signification: si le tableau est non vide, il doit etre de taille nb_items_reels. Dans ce cas, il permet de forcer la propriete suivante : &quot;si l&#39;item i est distant, alors l&#39;item items_lies[i] est distant aussi&quot;. Ce tableau est utilise pour inclure les sommets periodiques virtuels associes. (voir calculer_espace_distant_sommets).">calculer_espace_distant_item</a>(zone,
<a name="l01306"></a>01306                                <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>,
<a name="l01307"></a>01307                                connectivite_elem_som,
<a name="l01308"></a>01308                                nb_sommets_reels,
<a name="l01309"></a>01309                                renum_som_perio);
<a name="l01310"></a>01310 }
<a name="l01311"></a>01311 
<a name="l01312"></a>01312 <span class="comment">//</span><span class="comment"></span>
<a name="l01313"></a>01313 <span class="comment">//! Idem que Scatter::calculer_espace_distant_sommets pour les faces</span>
<a name="l01314"></a><a class="code" href="classScatter.html#af8e062885ea7bbeaffb320e7f718e282">01314</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classScatter.html#af8e062885ea7bbeaffb320e7f718e282" title="Idem que Scatter::calculer_espace_distant_sommets pour les faces.">Scatter::calculer_espace_distant_faces</a>(<a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone,
<a name="l01315"></a>01315                                             <span class="keyword">const</span> <span class="keywordtype">int</span> nb_faces_reelles,
<a name="l01316"></a>01316                                             <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; elem_faces)
<a name="l01317"></a>01317 {
<a name="l01318"></a>01318   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l01319"></a>01319     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Scatter::calculer_espace_distant_faces : start&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01320"></a>01320 
<a name="l01321"></a>01321   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> tableau_vide;
<a name="l01322"></a>01322 
<a name="l01323"></a>01323   <a class="code" href="Scatter_8cpp.html#aaf22a425af9ec9c52eca3d13f3ecea9f" title="Methode generique pour calculer l&#39;espace distant d&#39;un type d&#39;items geometrique&lt;br&gt;(sommet, face, arete) en fonction de l&#39;espace distant des elements: Les &quot;type_item&quot; distants (pour type_item = sommet face ou arete) sont les &quot;type_item&quot; attaches aux elements distants. Exemple : les sommets distants sont tous les sommets de tous les elements distants. Voir aussi: Scatter::calculer_espace_distant_sommets Scatter::calculer_espace_distant_faces Parametre: zone Signification: bah, la zone quoi... Parametre: type_item Signification: le type des items dont on veut calculer l&#39;espace distant Parametre: connectivite_elem_item Signification: le tableau qui donne pour chaque element de la zone les indices des items de cet element. On n&#39;utilise que la partie reele du tableau (logiquement, la partie virtuelle n&#39;existe pas encore). (exemple: zone().les_elems() pour type_item==SOMMET ou zone_VF().face_sommets() pour type_item==FACE) Parametre: nb_items_reels Signification: le nombre de &quot;type_item&quot; reels Parametre: items_lies Signification: si le tableau est non vide, il doit etre de taille nb_items_reels. Dans ce cas, il permet de forcer la propriete suivante : &quot;si l&#39;item i est distant, alors l&#39;item items_lies[i] est distant aussi&quot;. Ce tableau est utilise pour inclure les sommets periodiques virtuels associes. (voir calculer_espace_distant_sommets).">calculer_espace_distant_item</a>(zone,
<a name="l01324"></a>01324                                <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926ab255b88987fc7f64c215c958cbe2af6b">Joint::FACE</a>,
<a name="l01325"></a>01325                                elem_faces,
<a name="l01326"></a>01326                                nb_faces_reelles,
<a name="l01327"></a>01327                                tableau_vide);
<a name="l01328"></a>01328 }
<a name="l01329"></a>01329 
<a name="l01330"></a>01330 <span class="comment">//</span><span class="comment"></span>
<a name="l01331"></a>01331 <span class="comment">//! Idem que Scatter::calculer_espace_distant_sommets pour les aretes</span>
<a name="l01332"></a><a class="code" href="classScatter.html#a340353829751017d210326537f662b68">01332</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classScatter.html#a340353829751017d210326537f662b68" title="Idem que Scatter::calculer_espace_distant_sommets pour les aretes.">Scatter::calculer_espace_distant_aretes</a>(<a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone,
<a name="l01333"></a>01333                                              <span class="keyword">const</span> <span class="keywordtype">int</span> nb_aretes_reelles,
<a name="l01334"></a>01334                                              <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; elem_aretes)
<a name="l01335"></a>01335 {
<a name="l01336"></a>01336   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l01337"></a>01337     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Scatter::calculer_espace_distant_aretes : start&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01338"></a>01338   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> tableau_vide;
<a name="l01339"></a>01339   <a class="code" href="Scatter_8cpp.html#aaf22a425af9ec9c52eca3d13f3ecea9f" title="Methode generique pour calculer l&#39;espace distant d&#39;un type d&#39;items geometrique&lt;br&gt;(sommet, face, arete) en fonction de l&#39;espace distant des elements: Les &quot;type_item&quot; distants (pour type_item = sommet face ou arete) sont les &quot;type_item&quot; attaches aux elements distants. Exemple : les sommets distants sont tous les sommets de tous les elements distants. Voir aussi: Scatter::calculer_espace_distant_sommets Scatter::calculer_espace_distant_faces Parametre: zone Signification: bah, la zone quoi... Parametre: type_item Signification: le type des items dont on veut calculer l&#39;espace distant Parametre: connectivite_elem_item Signification: le tableau qui donne pour chaque element de la zone les indices des items de cet element. On n&#39;utilise que la partie reele du tableau (logiquement, la partie virtuelle n&#39;existe pas encore). (exemple: zone().les_elems() pour type_item==SOMMET ou zone_VF().face_sommets() pour type_item==FACE) Parametre: nb_items_reels Signification: le nombre de &quot;type_item&quot; reels Parametre: items_lies Signification: si le tableau est non vide, il doit etre de taille nb_items_reels. Dans ce cas, il permet de forcer la propriete suivante : &quot;si l&#39;item i est distant, alors l&#39;item items_lies[i] est distant aussi&quot;. Ce tableau est utilise pour inclure les sommets periodiques virtuels associes. (voir calculer_espace_distant_sommets).">calculer_espace_distant_item</a>(zone,
<a name="l01340"></a>01340                                <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a7816c69408b98e1161f1f54e7b6b1cb4">Joint::ARETE</a>,
<a name="l01341"></a>01341                                elem_aretes,
<a name="l01342"></a>01342                                nb_aretes_reelles,
<a name="l01343"></a>01343                                tableau_vide);
<a name="l01344"></a>01344 }
<a name="l01345"></a>01345 
<a name="l01346"></a>01346 <span class="comment">//</span>
<a name="l01347"></a>01347 <span class="comment">//</span>
<a name="l01348"></a>01348 <span class="comment">//</span>
<a name="l01349"></a>01349 <span class="comment">//</span>
<a name="l01350"></a>01350 <span class="comment">//</span>
<a name="l01351"></a>01351 <span class="comment">//</span><span class="comment"></span>
<a name="l01352"></a>01352 <span class="comment">//! On suppose que chaque joint[i].joint_item(type_item).items_communs()&lt;br&gt;contient les indices locaux des items de joint communs dans le meme&lt;br&gt;ordre sur les deux processeurs (local et voisin)&lt;br&gt;On remplit renum_items_communs :&lt;br&gt;colonne 0=contenu du tableau items_communs sur le PE voisin&lt;br&gt;colonne 1=contenu du tableau items_communs sur le PE local</span>
<a name="l01353"></a><a class="code" href="classScatter.html#a21f166c05df9be1fc1f02b0604624fe5">01353</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classScatter.html#a21f166c05df9be1fc1f02b0604624fe5" title="On suppose que chaque joint[i].joint_item(type_item).items_communs() contient les indices locaux des ...">Scatter::calculer_renum_items_communs</a>(<a class="code" href="classJoints.html" title="Classe Joints Cette classe represente une liste d&#39;objet de type Joint.">Joints</a>&amp; joints,
<a name="l01354"></a>01354                                            <span class="keyword">const</span> <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926">Joint::Type_Item</a> type_item)
<a name="l01355"></a>01355 {
<a name="l01356"></a>01356 <span class="comment">// Il suffit d&#39;envoyer au voisin le tableau _faces dans l&#39;ordre</span>
<a name="l01357"></a>01357 <span class="comment">// pour qu&#39;il ait les indices des faces sur l&#39;autre pe.</span>
<a name="l01358"></a>01358 
<a name="l01359"></a>01359   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_joints = joints.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>();
<a name="l01360"></a>01360   <span class="keywordtype">int</span>       i_joint;
<a name="l01361"></a>01361   <a class="code" href="classSchema__Comm.html">Schema_Comm</a>  schema_comm;
<a name="l01362"></a>01362   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> liste_voisins(nb_joints);
<a name="l01363"></a>01363   <span class="keywordflow">for</span> (i_joint = 0; i_joint &lt; nb_joints; i_joint++)
<a name="l01364"></a>01364     liste_voisins[i_joint] = joints[i_joint].PEvoisin();
<a name="l01365"></a>01365   schema_comm.<a class="code" href="classSchema__Comm.html#ad11c9b47999c294c26ae4df8d2bbd57b" title="Definit la liste des processeurs a qui on va envoyer et de qui on va recevoir des donnees...">set_send_recv_pe_list</a>(liste_voisins, liste_voisins);
<a name="l01366"></a>01366 
<a name="l01367"></a>01367   schema_comm.<a class="code" href="classSchema__Comm.html#ac617b53de22748cdd9fa30a0cfd0f4a8" title="Statut passe a WRITING Autorise si status_ == WRITING:">begin_comm</a>();
<a name="l01368"></a>01368 
<a name="l01369"></a>01369   <span class="keywordflow">for</span> (i_joint = 0; i_joint &lt; nb_joints; i_joint++)
<a name="l01370"></a>01370     {
<a name="l01371"></a>01371       <span class="keyword">const</span> <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp; joint     = joints[i_joint];
<a name="l01372"></a>01372       <span class="keyword">const</span> <span class="keywordtype">int</span>  pe_voisin = joint.<a class="code" href="classJoint.html#a0952bc5c7805434ccd8cd5c9b01e3747" title="Renvoie PEvoisin (numero de la zone voisine)">PEvoisin</a>();
<a name="l01373"></a>01373       <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; items_communs =
<a name="l01374"></a>01374         joint.<a class="code" href="classJoint.html#a3f49fb1150967b436a115a7373ab27a0" title="Renvoie les informations de joint pour le type demande.">joint_item</a>(type_item).<a class="code" href="classJoint__Items.html#a435fb1629f6dafb089605913517e73c4" title="Voir items_communs_.">items_communs</a>();
<a name="l01375"></a>01375       schema_comm.<a class="code" href="classSchema__Comm.html#a6c771eae3b46250ae0d2f0126a7d8065" title="renvoie le buffer correspondant au processeur num_PE pour y entasser des donnees a envoyer...">send_buffer</a>(pe_voisin) &lt;&lt; items_communs;
<a name="l01376"></a>01376     }
<a name="l01377"></a>01377 
<a name="l01378"></a>01378   schema_comm.<a class="code" href="classSchema__Comm.html#abca0e8ac6c2b742d26f3cfaee0690c72" title="Statut passe a EXCHANGED.">echange_taille_et_messages</a>();
<a name="l01379"></a>01379 
<a name="l01380"></a>01380 <span class="comment">// Le tableau items communs recu du pe voisin:</span>
<a name="l01381"></a>01381   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> items_communs_voisin;
<a name="l01382"></a>01382   items_communs_voisin.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l01383"></a>01383 
<a name="l01384"></a>01384   <span class="keywordflow">for</span> (i_joint = 0; i_joint &lt; nb_joints; i_joint++)
<a name="l01385"></a>01385     {
<a name="l01386"></a>01386       <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp;           joint         = joints[i_joint];
<a name="l01387"></a>01387       <span class="keyword">const</span> <span class="keywordtype">int</span>     pe_voisin     = joint.<a class="code" href="classJoint.html#a0952bc5c7805434ccd8cd5c9b01e3747" title="Renvoie PEvoisin (numero de la zone voisine)">PEvoisin</a>();
<a name="l01388"></a>01388       <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; items_communs = joint.<a class="code" href="classJoint.html#a3f49fb1150967b436a115a7373ab27a0" title="Renvoie les informations de joint pour le type demande.">joint_item</a>(type_item).<a class="code" href="classJoint__Items.html#a435fb1629f6dafb089605913517e73c4" title="Voir items_communs_.">items_communs</a>();
<a name="l01389"></a>01389       <span class="keyword">const</span> <span class="keywordtype">int</span>     nb_items      = items_communs.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l01390"></a>01390       schema_comm.<a class="code" href="classSchema__Comm.html#a0c056eb81ab8fd513912b336b4d13a1a" title="renvoie le buffer correspondant au processeur num_PE pour y lire les donnees recues. Le schema doit etre dans l&#39;etat EXCHANGED.">recv_buffer</a>(pe_voisin) &gt;&gt; items_communs_voisin;
<a name="l01391"></a>01391 
<a name="l01392"></a>01392       assert(nb_items == items_communs_voisin.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>());
<a name="l01393"></a>01393 
<a name="l01394"></a>01394       <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; renum_items_communs = joint.<a class="code" href="classJoint.html#aa1c4d729a3017082d26907d82ad1d7de" title="Renvoie les informations de joint pour un type d&#39;item geometrique donne, pour remplissage des structu...">set_joint_item</a>(type_item).<a class="code" href="classJoint__Items.html#a95cc27c0fd65e2444a468df69a211057" title="Voir renum_items_communs_ Voir Scatter::calculer_colonne0_renum_faces_communes Scatter::construire_co...">set_renum_items_communs</a>();
<a name="l01395"></a>01395       renum_items_communs.<a class="code" href="classIntTab.html#a22e6bed6826b3688d4d0181cbf3b7a38" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(nb_items, 2);
<a name="l01396"></a>01396 <span class="comment">// L&#39;indice de la face de joint sur l&#39;autre PE est dans tmp(i,1)</span>
<a name="l01397"></a>01397       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_items; i++)
<a name="l01398"></a>01398         {
<a name="l01399"></a>01399           renum_items_communs(i,0) = items_communs_voisin[i];
<a name="l01400"></a>01400           renum_items_communs(i,1) = items_communs[i];
<a name="l01401"></a>01401         }
<a name="l01402"></a>01402     }
<a name="l01403"></a>01403 
<a name="l01404"></a>01404   schema_comm.<a class="code" href="classSchema__Comm.html#a73a981f88b6ffebc150fb46c5cce75d9" title="Statut passe a RESET Accesseurs:">end_comm</a>();
<a name="l01405"></a>01405 }
<a name="l01406"></a>01406 
<a name="l01407"></a>01407 <span class="comment">//</span><span class="comment"></span>
<a name="l01408"></a>01408 <span class="comment">//! construction d&#39;un MD_Vector_std a partir des informations de joint du domaine&lt;br&gt;pour le type d&#39;item demande.</span>
<a name="l01409"></a><a class="code" href="classScatter.html#ae226bc9cab92d0a02b88e2fe014e4a44">01409</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classScatter.html#ae226bc9cab92d0a02b88e2fe014e4a44" title="construction d&#39;un MD_Vector_std a partir des informations de joint du domaine pour le type d&#39;item dem...">Scatter::construire_md_vector</a>(<span class="keyword">const</span> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom, <span class="keywordtype">int</span> nb_items_reels, <span class="keyword">const</span> <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926">Joint::Type_Item</a> type_item, <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a>&amp; md_vector)
<a name="l01410"></a>01410 {
<a name="l01411"></a>01411   <span class="keyword">const</span> <a class="code" href="classJoints.html" title="Classe Joints Cette classe represente une liste d&#39;objet de type Joint.">Joints</a>&amp; joints  = dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>();
<a name="l01412"></a>01412   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_joints = joints.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>();
<a name="l01413"></a>01413 
<a name="l01414"></a>01414   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> pe_voisins(nb_joints);
<a name="l01415"></a>01415   <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>) items_to_send(nb_joints);
<a name="l01416"></a>01416   <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>) items_to_recv(nb_joints);
<a name="l01417"></a>01417   <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>) blocs_to_recv(nb_joints);
<a name="l01418"></a>01418 
<a name="l01419"></a>01419 <span class="comment">// drapeau indique si l&#39;item (commun) est recu d&#39;un processeur</span>
<a name="l01420"></a>01420   <a class="code" href="classArrOfBit.html">ArrOfBit</a> flags(nb_items_reels);
<a name="l01421"></a>01421   flags = 0;
<a name="l01422"></a>01422 
<a name="l01423"></a>01423   <span class="keywordtype">int</span> nitems_tot = nb_items_reels;
<a name="l01424"></a>01424   <span class="keyword">const</span> <span class="keywordtype">int</span> moi = <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">me</a>();
<a name="l01425"></a>01425 
<a name="l01426"></a>01426   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_joint = 0; i_joint &lt; nb_joints; i_joint++)
<a name="l01427"></a>01427     {
<a name="l01428"></a>01428       <span class="keyword">const</span> <span class="keywordtype">int</span> pe = joints[i_joint].PEvoisin();
<a name="l01429"></a>01429       pe_voisins[i_joint] = pe;
<a name="l01430"></a>01430       <span class="keyword">const</span> <a class="code" href="classJoint__Items.html" title="Joint_Items contient les informations de distribution parallele d&#39;un item geometrique particulier ave...">Joint_Items</a>&amp; joint = joints[i_joint].joint_item(type_item);
<a name="l01431"></a>01431       {
<a name="l01432"></a>01432 <span class="comment">// Traitement des items communs</span>
<a name="l01433"></a>01433         <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; items_communs = joint.<a class="code" href="classJoint__Items.html#a435fb1629f6dafb089605913517e73c4" title="Voir items_communs_.">items_communs</a>();
<a name="l01434"></a>01434         <span class="keyword">const</span> <span class="keywordtype">int</span> n = items_communs.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l01435"></a>01435 
<a name="l01436"></a>01436 <span class="comment">// Les joints doivent arriver dans l&#39;ordre croissant du numero de pe</span>
<a name="l01437"></a>01437 <span class="comment">// sinon l&#39;algo suivant ne marche pas:</span>
<a name="l01438"></a>01438         assert((i_joint == 0) || (pe &gt; joints[i_joint-1].PEvoisin()));
<a name="l01439"></a>01439         <span class="keywordflow">if</span> (pe &gt; moi)
<a name="l01440"></a>01440           {
<a name="l01441"></a>01441 <span class="comment">// Je dois envoyer ces items au processeur voisin</span>
<a name="l01442"></a>01442             <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; dest = items_to_send[i_joint];
<a name="l01443"></a>01443             dest.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l01444"></a>01444             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
<a name="l01445"></a>01445               {
<a name="l01446"></a>01446                 <span class="keyword">const</span> <span class="keywordtype">int</span> item = items_communs[i];
<a name="l01447"></a>01447                 <span class="keywordflow">if</span> (!flags[item])
<a name="l01448"></a>01448                   {
<a name="l01449"></a>01449 <span class="comment">// item pas recu d&#39;un processeur</span>
<a name="l01450"></a>01450                     dest.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(item);
<a name="l01451"></a>01451                   }
<a name="l01452"></a>01452               }
<a name="l01453"></a>01453           }
<a name="l01454"></a>01454         <span class="keywordflow">else</span>
<a name="l01455"></a>01455           {
<a name="l01456"></a>01456 <span class="comment">// Je recois cet item d&#39;un autre processeur</span>
<a name="l01457"></a>01457             <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; dest = items_to_recv[i_joint];
<a name="l01458"></a>01458             dest.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l01459"></a>01459             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
<a name="l01460"></a>01460               {
<a name="l01461"></a>01461                 <span class="keyword">const</span> <span class="keywordtype">int</span> item = items_communs[i];
<a name="l01462"></a>01462                 <span class="keywordflow">if</span> (!flags.<a class="code" href="classArrOfBit.html#a68b08edd2eebc91e7bd7d34ec81f6cd2" title="Renvoie la valeur du bit e, puis met le bit e a 1.">testsetbit</a>(item))
<a name="l01463"></a>01463                   {
<a name="l01464"></a>01464 <span class="comment">// item pas encore recu d&#39;un processeur</span>
<a name="l01465"></a>01465                     dest.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(item);
<a name="l01466"></a>01466                   }
<a name="l01467"></a>01467               }
<a name="l01468"></a>01468           }
<a name="l01469"></a>01469       }
<a name="l01470"></a>01470 <span class="comment">// Traitement des items distants et virtuels</span>
<a name="l01471"></a>01471       {
<a name="l01472"></a>01472         <span class="keyword">const</span> <span class="keywordtype">int</span> nitems_virt = joint.<a class="code" href="classJoint__Items.html#aaaea01b8fe49417e565fff9700cacf2e" title="Voir nb_items_virtuels_.">nb_items_virtuels</a>();
<a name="l01473"></a>01473         <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; dest = blocs_to_recv[i_joint];
<a name="l01474"></a>01474         <span class="keywordflow">if</span> (nitems_virt &gt; 0)
<a name="l01475"></a>01475           {
<a name="l01476"></a>01476             dest.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(2, <a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ffaf6ae9ba7eb51c5f298ce693345b3ec68">Array_base::NOCOPY_NOINIT</a>);
<a name="l01477"></a>01477 <span class="comment">// Definition du bloc d&#39;items virtuels pour le processeur voisin</span>
<a name="l01478"></a>01478             dest[0] = nitems_tot;
<a name="l01479"></a>01479             dest[1] = nitems_tot + nitems_virt;
<a name="l01480"></a>01480             nitems_tot += nitems_virt;
<a name="l01481"></a>01481           }
<a name="l01482"></a>01482       }
<a name="l01483"></a>01483       {
<a name="l01484"></a>01484         <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; items_distants = joint.<a class="code" href="classJoint__Items.html#ae51b330de79fcaae9c88166e3eee7cb8" title="Voir items_distants_.">items_distants</a>();
<a name="l01485"></a>01485         <span class="keyword">const</span> <span class="keywordtype">int</span> n = items_distants.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l01486"></a>01486         <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; dest = items_to_send[i_joint];
<a name="l01487"></a>01487         <span class="keyword">const</span> <span class="keywordtype">int</span> index = dest.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l01488"></a>01488         dest.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(index + n, <a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ffac85954f9768f1ed2b14e58cea8ddb7c5">Array_base::COPY_NOINIT</a>); <span class="comment">//!&lt; copier les anciennes valeurs !</span>
<a name="l01489"></a>01489 <span class="comment"></span>        dest.<a class="code" href="classArrOfInt.html#a195c644d98bf2da2fe4f8aede4e02262" title="Copie les elements source[first_element_source + i] dans les elements (*this)[first_element_dest + i]...">inject_array</a>(items_distants, n, index <span class="comment">/* dest index */</span>, 0 <span class="comment">/* src index */</span>);
<a name="l01490"></a>01490       }
<a name="l01491"></a>01491     }
<a name="l01492"></a>01492 
<a name="l01493"></a>01493   <a class="code" href="classMD__Vector__std.html" title="C&#39;est le plus simple des descripteurs, utilise pour les tableaux de valeurs aux sommets, elements, faces, aretes, faces de bord, etc... Il supporte la notion d&#39;items &quot;communs&quot; (sommets du maillage partages entre plusieurs processeurs) et d&#39;items &quot;distants&quot; et &quot;virtuels&quot; (sommets, elements dans l&#39;epaisseur de joint). Voir aussi MD_Vector_composite (descripteur compose d&#39;une reunion de plusieurs descripteurs, pour le P1Bulle par exemple)">MD_Vector_std</a> md(nitems_tot, nb_items_reels, pe_voisins, items_to_send, items_to_recv, blocs_to_recv);
<a name="l01494"></a>01494   md_vector.<a class="code" href="classMD__Vector.html#a063644dd8ca62e707a2d059eedeb58a7" title="construction d&#39;un objet MD_Vector par copie d&#39;un objet existant. C&#39;est la methode recommandee pour cr...">copy</a>(md);
<a name="l01495"></a>01495 
<a name="l01496"></a>01496 <span class="comment">// Verification que le md_vector est valide (tailles en send correspondant aux tailles en recv)</span>
<a name="l01497"></a>01497   <span class="keywordflow">if</span> (<a class="code" href="communications_8cpp.html#a40943dd8a0e3ea77b7f2e7d404d9cd53" title="renvoie le drapeau Comm_Group::check_enabled(). Ce drapeau indique si le code tourne en mode DEBUG du...">comm_check_enabled</a>())
<a name="l01498"></a>01498     {
<a name="l01499"></a>01499       <a class="code" href="classIntVect.html">IntVect</a> toto;
<a name="l01500"></a>01500       <a class="code" href="MD__Vector__tools_8cpp.html#aff1ed2791dba1a76fdb300920147cfdf">MD_Vector_tools::creer_tableau_distribue</a>(md_vector, toto);
<a name="l01501"></a>01501       toto = 0;
<a name="l01502"></a>01502       toto.<a class="code" href="classIntVect.html#ad12bea67621d1a0ee82b27c9a37ca4ef">echange_espace_virtuel</a>();
<a name="l01503"></a>01503     }
<a name="l01504"></a>01504 }
<a name="l01505"></a>01505 
<a name="l01506"></a>01506 <span class="comment">// Fonction tri (selon la premiere colonne du tableau)</span>
<a name="l01507"></a><a class="code" href="Scatter_8cpp.html#a944250a2c83f0a472deb1c18072b9b69">01507</a> <span class="keyword">static</span> <a class="code" href="arch_8h.html#a1caaf369d9c5f0817dbaa76b43b8d87b">True_int</a> <a class="code" href="Scatter_8cpp.html#a944250a2c83f0a472deb1c18072b9b69">fct_tri_table_inverse</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *ptr1, <span class="keyword">const</span> <span class="keywordtype">void</span> *ptr2)
<a name="l01508"></a>01508 {
<a name="l01509"></a>01509   <span class="keyword">const</span> <span class="keywordtype">int</span> i1 = *(<span class="keywordtype">int</span>*)ptr1;
<a name="l01510"></a>01510   <span class="keyword">const</span> <span class="keywordtype">int</span> i2 = *(<span class="keywordtype">int</span>*)ptr2;
<a name="l01511"></a>01511 <span class="preprocessor">#ifdef INT_is_64_</span>
<a name="l01512"></a>01512 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (i1 == i2)
<a name="l01513"></a>01513     <span class="keywordflow">return</span> 0;
<a name="l01514"></a>01514   <span class="keywordflow">if</span> (i1&gt;i2)
<a name="l01515"></a>01515     <span class="keywordflow">return</span> 1;
<a name="l01516"></a>01516   <span class="keywordflow">return</span> -1;
<a name="l01517"></a>01517 <span class="preprocessor">#else</span>
<a name="l01518"></a>01518 <span class="preprocessor"></span>  <span class="keywordflow">return</span> i1 - i2;
<a name="l01519"></a>01519 <span class="preprocessor">#endif</span>
<a name="l01520"></a>01520 <span class="preprocessor"></span>
<a name="l01521"></a>01521 }
<a name="l01522"></a>01522 
<a name="l01523"></a>01523 <span class="comment">//</span>
<a name="l01524"></a>01524 <span class="comment">//</span>
<a name="l01525"></a>01525 <span class="comment">//</span>
<a name="l01526"></a>01526 <span class="comment">//</span><span class="comment"></span>
<a name="l01527"></a>01527 <span class="comment">//! Cette classe fournit les outils pour construire l&#39;espace&lt;br&gt;virtuel d&#39;un tableau contenant des indices d&#39;entites geometriques&lt;br&gt;(sommets, elements, faces). Elle gere en particulier la&lt;br&gt;renumerotation des elements virtuels.</span>
<a name="l01528"></a><a class="code" href="classTraduction__Indice__Global__Local.html">01528</a> <span class="comment"></span><span class="keyword">class </span><a class="code" href="classTraduction__Indice__Global__Local.html" title="Cette classe fournit les outils pour construire l&#39;espace virtuel d&#39;un tableau contenant des indices d...">Traduction_Indice_Global_Local</a>
<a name="l01529"></a>01529 {
<a name="l01530"></a>01530 <span class="keyword">public</span>:
<a name="l01531"></a><a class="code" href="classTraduction__Indice__Global__Local.html#ada36c0c489ea95db3bb8401f84d55c3a">01531</a>   <a class="code" href="classTraduction__Indice__Global__Local.html#ada36c0c489ea95db3bb8401f84d55c3a">Traduction_Indice_Global_Local</a>() {};
<a name="l01532"></a>01532   <span class="keywordtype">void</span> <a class="code" href="classTraduction__Indice__Global__Local.html#af8aae1bb5e815066c64937bde87b7e8a" title="Initialise le dictionnaire Precontition: Les espaces distants des entites utilisees doivent avoir ete...">initialiser</a>(<span class="keyword">const</span> <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a>&amp; md_items);
<a name="l01533"></a>01533   <span class="keywordtype">void</span> <a class="code" href="classTraduction__Indice__Global__Local.html#aa13ac6b9ecba36b9701c46cbb11d06c4">reset</a>();
<a name="l01534"></a>01534   <span class="keywordtype">void</span> <a class="code" href="classTraduction__Indice__Global__Local.html#a633b4d9dc27e092f08bb2918401a4c7b" title="Transforme les indices locaux en indices globaux a l&#39;aide la &quot;table_&quot; (voir initialiser). On fait : Pour debut &lt;= i &lt; debut+nb indices_globaux[i] = table_[indices_locaux[i]] si indices_locaux[i] &lt; 0 alors indices_globaux[i] = -1.">traduire_indice_local_vers_global</a>(<span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; indices_locaux, <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; indices_globaux, <span class="keywordtype">int</span> n) <span class="keyword">const</span>;
<a name="l01535"></a>01535   <span class="keywordtype">int</span> <a class="code" href="classTraduction__Indice__Global__Local.html#af7d70b1f6312872791271392881768d5" title="Pour debut &lt;= i &lt; debut+nb indices_locaux[i] = chercher l&#39;indice local de &quot;indices_globaux[i]&quot; Parame...">traduire_indice_global_vers_local</a>(<span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; indices_globaux, <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; indices_locaux) <span class="keyword">const</span>;
<a name="l01536"></a>01536   <span class="keywordtype">int</span> <a class="code" href="classTraduction__Indice__Global__Local.html#a9a0510ebef5ce63dcfcf00e35c0578c3" title="A partir d&#39;un tableau dont la structure d&#39;espace virtuel est initialisee&lt;br&gt;(descripteurs elements dist...">traduire_espace_virtuel</a>(<a class="code" href="classIntVect.html">IntVect</a>&amp; tableau) <span class="keyword">const</span>;
<a name="l01537"></a>01537 
<a name="l01538"></a>01538   <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="classTraduction__Indice__Global__Local.html#a837fb55e45b63ed0ed16085b7f4c9c0d" title="Cherche i tel que table_inverse(i, 0) == sommet_global, et renvoie table_inverse(i, 1) (l&#39;indice local du sommet). Si le sommet n&#39;est pas trouve dans la table, renvoie -1. La table_inverse doit etre triee par ordre croissant de la colonne 0. La table_inverse ne doit pas avoir d&#39;espace virtuel.">chercher_table_inverse</a>(<span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; table_inverse,
<a name="l01539"></a>01539                                     <span class="keyword">const</span> <span class="keywordtype">int</span> sommet_global);
<a name="l01540"></a>01540 
<a name="l01541"></a>01541 <span class="keyword">private</span>:
<a name="l01542"></a>01542 <span class="comment">// Metadata des indices qu&#39;on va renumeroter :</span>
<a name="l01543"></a><a class="code" href="classTraduction__Indice__Global__Local.html#a83ba597c1d6ef619bdda41ea9345f610">01543</a>   <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a> <a class="code" href="classTraduction__Indice__Global__Local.html#a83ba597c1d6ef619bdda41ea9345f610">md_items_</a>;
<a name="l01544"></a><a class="code" href="classTraduction__Indice__Global__Local.html#ab93ee6d07d2960f8d6fe8b67cb3f6852">01544</a>   <span class="keywordtype">int</span> <a class="code" href="classTraduction__Indice__Global__Local.html#ab93ee6d07d2960f8d6fe8b67cb3f6852">premier_indice_global_</a>;
<a name="l01545"></a>01545 <span class="comment">// Tableau distribue (avec espaces virtuels et items communs)</span>
<a name="l01546"></a>01546 <span class="comment">// contenant pour toutes les entites a indexer  (reelles et virtuelles)</span>
<a name="l01547"></a>01547 <span class="comment">// un indice global.</span>
<a name="l01548"></a>01548 <span class="comment">// (si type_table_==SOMMETS, table_[i] est l&#39;indice global du sommet i)</span>
<a name="l01549"></a><a class="code" href="classTraduction__Indice__Global__Local.html#a8a3ff36f74660ae806875731ecfcf73a">01549</a>   <a class="code" href="classIntVect.html">IntVect</a> <a class="code" href="classTraduction__Indice__Global__Local.html#a8a3ff36f74660ae806875731ecfcf73a">table_</a>;
<a name="l01550"></a>01550 <span class="comment">// Table permettant d&#39;inverser la numerotation, classee par ordre</span>
<a name="l01551"></a>01551 <span class="comment">// croissant de l&#39;indice global :</span>
<a name="l01552"></a>01552 <span class="comment">// * colonne 0 : l&#39;indice global de l&#39;entite</span>
<a name="l01553"></a>01553 <span class="comment">// * colonne 1 : l&#39;indice local de l&#39;entite</span>
<a name="l01554"></a><a class="code" href="classTraduction__Indice__Global__Local.html#ac70085221bd16c6595310480c5756da9">01554</a>   <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a> <a class="code" href="classTraduction__Indice__Global__Local.html#ac70085221bd16c6595310480c5756da9">table_inverse_</a>;
<a name="l01555"></a>01555 };
<a name="l01556"></a>01556 
<a name="l01557"></a>01557 <span class="comment">//</span>
<a name="l01558"></a>01558 <span class="comment">//</span>
<a name="l01559"></a>01559 <span class="comment">//</span><span class="comment"></span>
<a name="l01560"></a>01560 <span class="comment">//! Initialise le dictionnaire&lt;br&gt;Precontition:&lt;br&gt;Les espaces distants des entites utilisees doivent avoir ete calculees</span>
<a name="l01561"></a><a class="code" href="classTraduction__Indice__Global__Local.html#af8aae1bb5e815066c64937bde87b7e8a">01561</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classTraduction__Indice__Global__Local.html#af8aae1bb5e815066c64937bde87b7e8a" title="Initialise le dictionnaire Precontition: Les espaces distants des entites utilisees doivent avoir ete...">Traduction_Indice_Global_Local::initialiser</a>(<span class="keyword">const</span> <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a>&amp; md_items)
<a name="l01562"></a>01562 {
<a name="l01563"></a>01563   <a class="code" href="classTraduction__Indice__Global__Local.html#a83ba597c1d6ef619bdda41ea9345f610">md_items_</a> = md_items;
<a name="l01564"></a>01564 
<a name="l01565"></a>01565 <span class="comment">// Construction de &quot;table&quot; : on cree un numero global pour les entites reelles</span>
<a name="l01566"></a>01566 <span class="comment">// (indice de l&#39;entite + nombre total d&#39;entites sur les processeurs de rang inferieur)</span>
<a name="l01567"></a>01567 <span class="comment">// puis on echange l&#39;espace virtuel de ce tableau, on obtient pour chaque entite</span>
<a name="l01568"></a>01568 <span class="comment">// reelle ou virtuelle son numero global.</span>
<a name="l01569"></a>01569 
<a name="l01570"></a>01570   <a class="code" href="classTraduction__Indice__Global__Local.html#a8a3ff36f74660ae806875731ecfcf73a">table_</a>.<a class="code" href="classIntVect.html#a273976ecf3d2d4fdbdc48ab446027e8e" title="met l&#39;objet dans l&#39;etat obtenu par le constructeur par defaut. (voir ArrOfInt::reset())">reset</a>();
<a name="l01571"></a>01571   <a class="code" href="MD__Vector__tools_8cpp.html#aff1ed2791dba1a76fdb300920147cfdf">MD_Vector_tools::creer_tableau_distribue</a>(md_items, <a class="code" href="classTraduction__Indice__Global__Local.html#a8a3ff36f74660ae806875731ecfcf73a">table_</a>);
<a name="l01572"></a>01572 
<a name="l01573"></a>01573   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_entites = md_items.<a class="code" href="classMD__Vector.html#a41324dfaa7a973091d0a8276908d10e2">valeur</a>().<a class="code" href="classMD__Vector__base.html#a27d5ace2aee5ecf1d78accb7b321108d">get_nb_items_tot</a>();
<a name="l01574"></a>01574   <span class="keyword">const</span> <span class="keywordtype">int</span> decal = <a class="code" href="communications_8cpp.html#a13b5bdc7cfe14771b52a033b1ecbc071" title="Calul de la somme partielle de i sur les processeurs 0 a me()-1 (renvoie 0 sur le processeur 0)...">mppartial_sum</a>(nb_entites);
<a name="l01575"></a>01575   <a class="code" href="classTraduction__Indice__Global__Local.html#ab93ee6d07d2960f8d6fe8b67cb3f6852">premier_indice_global_</a> = decal;
<a name="l01576"></a>01576 
<a name="l01577"></a>01577   <span class="keywordtype">int</span> i;
<a name="l01578"></a>01578   <span class="keywordflow">for</span> (i = 0; i &lt; nb_entites; i++)
<a name="l01579"></a>01579     <a class="code" href="classTraduction__Indice__Global__Local.html#a8a3ff36f74660ae806875731ecfcf73a">table_</a>[i] = i + decal;
<a name="l01580"></a>01580   <a class="code" href="classTraduction__Indice__Global__Local.html#a8a3ff36f74660ae806875731ecfcf73a">table_</a>.<a class="code" href="classIntVect.html#ad12bea67621d1a0ee82b27c9a37ca4ef">echange_espace_virtuel</a>();
<a name="l01581"></a>01581 
<a name="l01582"></a>01582 <span class="comment">// Construction de la table_inverse contenant les indices non triviaux</span>
<a name="l01583"></a>01583 <span class="comment">// (pour lesquels table_[i] != i + decal apres l&#39;echange)</span>
<a name="l01584"></a>01584 <span class="comment">// tri par ordre croissant du numero global.</span>
<a name="l01585"></a>01585   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_entites_tot = <a class="code" href="classTraduction__Indice__Global__Local.html#a8a3ff36f74660ae806875731ecfcf73a">table_</a>.<a class="code" href="classIntVect.html#afa716e1f0a1f0f74f4f73e95b5651412" title="Identique a size_array()">size_totale</a>();
<a name="l01586"></a>01586   <a class="code" href="classTraduction__Indice__Global__Local.html#ac70085221bd16c6595310480c5756da9">table_inverse_</a>.<a class="code" href="classIntTab.html#a22e6bed6826b3688d4d0181cbf3b7a38" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(0, 2);
<a name="l01587"></a>01587   <a class="code" href="classTraduction__Indice__Global__Local.html#ac70085221bd16c6595310480c5756da9">table_inverse_</a>.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l01588"></a>01588   <span class="keywordflow">for</span> (i = 0; i &lt; nb_entites_tot; i++)
<a name="l01589"></a>01589     {
<a name="l01590"></a>01590       <span class="keywordflow">if</span> (<a class="code" href="classTraduction__Indice__Global__Local.html#a8a3ff36f74660ae806875731ecfcf73a">table_</a>[i] != i + decal)
<a name="l01591"></a>01591         <a class="code" href="classTraduction__Indice__Global__Local.html#ac70085221bd16c6595310480c5756da9">table_inverse_</a>.<a class="code" href="classIntTab.html#ac0af4eac42ca46facc05f985c3ef05c6" title="Adds 1 to dimension_tot(0) and puts a in the added line.">append_line</a>(<a class="code" href="classTraduction__Indice__Global__Local.html#a8a3ff36f74660ae806875731ecfcf73a">table_</a>[i], i);
<a name="l01592"></a>01592     }
<a name="l01593"></a>01593 <span class="comment">// insure se plaint .. regarder si il a raison</span>
<a name="l01594"></a>01594   <span class="keywordflow">if</span> (<a class="code" href="classTraduction__Indice__Global__Local.html#ac70085221bd16c6595310480c5756da9">table_inverse_</a>.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>()&gt;0)
<a name="l01595"></a>01595     qsort(<a class="code" href="classTraduction__Indice__Global__Local.html#ac70085221bd16c6595310480c5756da9">table_inverse_</a>.<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>(),
<a name="l01596"></a>01596           <a class="code" href="classTraduction__Indice__Global__Local.html#ac70085221bd16c6595310480c5756da9">table_inverse_</a>.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0),
<a name="l01597"></a>01597           2 * <span class="keyword">sizeof</span>(int),
<a name="l01598"></a>01598           <a class="code" href="Scatter_8cpp.html#a944250a2c83f0a472deb1c18072b9b69">fct_tri_table_inverse</a>);
<a name="l01599"></a>01599 }
<a name="l01600"></a>01600 
<a name="l01601"></a><a class="code" href="classTraduction__Indice__Global__Local.html#aa13ac6b9ecba36b9701c46cbb11d06c4">01601</a> <span class="keywordtype">void</span> <a class="code" href="classTraduction__Indice__Global__Local.html#aa13ac6b9ecba36b9701c46cbb11d06c4">Traduction_Indice_Global_Local::reset</a>()
<a name="l01602"></a>01602 {
<a name="l01603"></a>01603   <a class="code" href="classTraduction__Indice__Global__Local.html#a83ba597c1d6ef619bdda41ea9345f610">md_items_</a>.<a class="code" href="classMD__Vector.html#aa8b6d80c076feecf7373552d58489e22" title="Detache le pointeur de l&#39;objet pointe et decremente le compteur de ref. Si le compteur est nul...">detach</a>();
<a name="l01604"></a>01604   <a class="code" href="classTraduction__Indice__Global__Local.html#a8a3ff36f74660ae806875731ecfcf73a">table_</a>.<a class="code" href="classIntVect.html#a273976ecf3d2d4fdbdc48ab446027e8e" title="met l&#39;objet dans l&#39;etat obtenu par le constructeur par defaut. (voir ArrOfInt::reset())">reset</a>();
<a name="l01605"></a>01605   <a class="code" href="classTraduction__Indice__Global__Local.html#ac70085221bd16c6595310480c5756da9">table_inverse_</a>.<a class="code" href="classIntTab.html#ac66710ddde96fe2745f341a0166b3b34" title="met le tableau dans l&#39;etat obtenu par le constructeur par defaut voir IntVect::reset()">reset</a>();
<a name="l01606"></a>01606 }
<a name="l01607"></a>01607 
<a name="l01608"></a>01608 <span class="comment">//</span>
<a name="l01609"></a>01609 <span class="comment">//</span>
<a name="l01610"></a>01610 <span class="comment">//</span>
<a name="l01611"></a>01611 <span class="comment">//</span>
<a name="l01612"></a>01612 <span class="comment">//</span><span class="comment"></span>
<a name="l01613"></a>01613 <span class="comment">//! Cherche i tel que table_inverse(i, 0) == sommet_global,&lt;br&gt;et renvoie table_inverse(i, 1) (l&#39;indice local du sommet).&lt;br&gt;Si le sommet n&#39;est pas trouve dans la table, renvoie -1.&lt;br&gt;La table_inverse doit etre triee par ordre croissant de la colonne 0.&lt;br&gt;La table_inverse ne doit pas avoir d&#39;espace virtuel.</span>
<a name="l01614"></a><a class="code" href="classTraduction__Indice__Global__Local.html#a837fb55e45b63ed0ed16085b7f4c9c0d">01614</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="classTraduction__Indice__Global__Local.html#a837fb55e45b63ed0ed16085b7f4c9c0d" title="Cherche i tel que table_inverse(i, 0) == sommet_global, et renvoie table_inverse(i, 1) (l&#39;indice local du sommet). Si le sommet n&#39;est pas trouve dans la table, renvoie -1. La table_inverse doit etre triee par ordre croissant de la colonne 0. La table_inverse ne doit pas avoir d&#39;espace virtuel.">Traduction_Indice_Global_Local::chercher_table_inverse</a>(<span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; table_inverse,
<a name="l01615"></a>01615                                                            <span class="keyword">const</span> <span class="keywordtype">int</span> sommet_global)
<a name="l01616"></a>01616 {
<a name="l01617"></a>01617 <span class="comment">// Algorithme : recherche par dichotomie:</span>
<a name="l01618"></a>01618   <span class="keywordtype">int</span> imin = 0;
<a name="l01619"></a>01619   <span class="keywordtype">int</span> imax = table_inverse.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0) - 1;
<a name="l01620"></a>01620 <span class="comment">// Si un seul element dans la table, on ne passe pas dans while</span>
<a name="l01621"></a>01621 <span class="comment">// (donc initialisation a table_inverse(0, 0))</span>
<a name="l01622"></a>01622 <span class="comment">// Sinon, si aucun element, il ne faut pas que valeur == sommet_global,</span>
<a name="l01623"></a>01623 <span class="comment">// sinon, valeur quelconque, elle sera ecrasee dans le while.</span>
<a name="l01624"></a>01624   <span class="keywordtype">int</span> <a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>;
<a name="l01625"></a>01625   <span class="keywordflow">if</span> (imax == 0)
<a name="l01626"></a>01626     valeur = table_inverse(0, 0);
<a name="l01627"></a>01627   <span class="keywordflow">else</span>
<a name="l01628"></a>01628     valeur = sommet_global - 1;
<a name="l01629"></a>01629 
<a name="l01630"></a>01630   <span class="keywordflow">while</span> (imax &gt; imin)
<a name="l01631"></a>01631     {
<a name="l01632"></a>01632       <span class="keyword">const</span> <span class="keywordtype">int</span> milieu = (imin + imax) &gt;&gt; 1; <span class="comment">//!&lt; (min+max)/2</span>
<a name="l01633"></a>01633 <span class="comment"></span>      valeur = table_inverse(milieu, 0);
<a name="l01634"></a>01634       <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="communications_8cpp.html#aedeafb71cede98447e03249a15284305">compare</a> = valeur - sommet_global;
<a name="l01635"></a>01635       <span class="keywordflow">if</span> (compare &lt; 0)
<a name="l01636"></a>01636         imin = milieu + 1;
<a name="l01637"></a>01637       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (compare &gt; 0)
<a name="l01638"></a>01638         imax = milieu - 1;
<a name="l01639"></a>01639       <span class="keywordflow">else</span>
<a name="l01640"></a>01640         imin = imax = milieu;
<a name="l01641"></a>01641     }
<a name="l01642"></a>01642   <span class="keywordtype">int</span> resu = -1;
<a name="l01643"></a>01643   valeur = table_inverse(imin, 0);
<a name="l01644"></a>01644   <span class="keywordflow">if</span> (valeur == sommet_global)
<a name="l01645"></a>01645     resu = table_inverse(imin, 1);
<a name="l01646"></a>01646   <span class="keywordflow">return</span> resu;
<a name="l01647"></a>01647 }
<a name="l01648"></a>01648 
<a name="l01649"></a>01649 <span class="comment">//</span>
<a name="l01650"></a>01650 <span class="comment">//</span>
<a name="l01651"></a>01651 <span class="comment">//</span>
<a name="l01652"></a>01652 <span class="comment">//</span>
<a name="l01653"></a>01653 <span class="comment">//</span><span class="comment"></span>
<a name="l01654"></a>01654 <span class="comment">//! Transforme les indices locaux en indices globaux a l&#39;aide la&lt;br&gt;&quot;table_&quot; (voir initialiser). On fait :&lt;br&gt;Pour debut &lt;= i &lt; debut+nb&lt;br&gt;indices_globaux[i] = table_[indices_locaux[i]]&lt;br&gt;si indices_locaux[i] &lt; 0 alors indices_globaux[i] = -1</span>
<a name="l01655"></a><a class="code" href="classTraduction__Indice__Global__Local.html#a633b4d9dc27e092f08bb2918401a4c7b">01655</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classTraduction__Indice__Global__Local.html#a633b4d9dc27e092f08bb2918401a4c7b" title="Transforme les indices locaux en indices globaux a l&#39;aide la &quot;table_&quot; (voir initialiser). On fait : Pour debut &lt;= i &lt; debut+nb indices_globaux[i] = table_[indices_locaux[i]] si indices_locaux[i] &lt; 0 alors indices_globaux[i] = -1.">Traduction_Indice_Global_Local::traduire_indice_local_vers_global</a>(
<a name="l01656"></a>01656   <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; indices_locaux,
<a name="l01657"></a>01657   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; indices_globaux,
<a name="l01658"></a>01658   <span class="keywordtype">int</span> nb_items_a_traiter)<span class="keyword"> const</span>
<a name="l01659"></a>01659 <span class="keyword"></span>{
<a name="l01660"></a>01660   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_items_a_traiter; i++)
<a name="l01661"></a>01661     {
<a name="l01662"></a>01662       <span class="keyword">const</span> <span class="keywordtype">int</span> i_loc = indices_locaux[i];
<a name="l01663"></a>01663       <span class="keyword">const</span> <span class="keywordtype">int</span> i_glob = (i_loc &lt; 0) ? -1 : <a class="code" href="classTraduction__Indice__Global__Local.html#a8a3ff36f74660ae806875731ecfcf73a">table_</a>[i_loc];
<a name="l01664"></a>01664       indices_globaux[i] = i_glob;
<a name="l01665"></a>01665     }
<a name="l01666"></a>01666 }
<a name="l01667"></a>01667 
<a name="l01668"></a>01668 <span class="comment">//</span>
<a name="l01669"></a>01669 <span class="comment">//</span>
<a name="l01670"></a>01670 <span class="comment">//</span>
<a name="l01671"></a>01671 <span class="comment">//</span>
<a name="l01672"></a>01672 <span class="comment">//</span>
<a name="l01673"></a>01673 <span class="comment">//</span>
<a name="l01674"></a>01674 <span class="comment">//</span>
<a name="l01675"></a>01675 <span class="comment">//</span>
<a name="l01676"></a>01676 <span class="comment">//</span><span class="comment"></span>
<a name="l01677"></a>01677 <span class="comment">//! Pour debut &lt;= i &lt; debut+nb&lt;br&gt;indices_locaux[i] = chercher l&#39;indice local de &quot;indices_globaux[i]&quot;&lt;br&gt;Parametre: indices_globaux&lt;br&gt;Signification: le tableau des indices globaux a traduire&lt;br&gt;Parametre: indices_locaux&lt;br&gt;Signification: en sortie, les indices locaux ou -1 si l&#39;indice global&lt;br&gt;n&#39;a pas ete trouve.&lt;br&gt;Valeur de retour: nombre d&#39;indices non trouves (indices globaux qui&lt;br&gt;ne correspondent a aucun indice local).</span>
<a name="l01678"></a><a class="code" href="classTraduction__Indice__Global__Local.html#af7d70b1f6312872791271392881768d5">01678</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="classTraduction__Indice__Global__Local.html#af7d70b1f6312872791271392881768d5" title="Pour debut &lt;= i &lt; debut+nb indices_locaux[i] = chercher l&#39;indice local de &quot;indices_globaux[i]&quot; Parame...">Traduction_Indice_Global_Local::traduire_indice_global_vers_local</a>(
<a name="l01679"></a>01679   <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; indices_globaux,
<a name="l01680"></a>01680   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; indices_locaux)<span class="keyword"> const</span>
<a name="l01681"></a>01681 <span class="keyword"></span>{
<a name="l01682"></a>01682   assert(indices_globaux.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>() == indices_locaux.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>());
<a name="l01683"></a>01683   <span class="keywordtype">int</span> i;
<a name="l01684"></a>01684   <span class="keywordtype">int</span> nb_erreurs = 0;
<a name="l01685"></a>01685   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_indices = indices_globaux.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l01686"></a>01686   <span class="keyword">const</span> <span class="keywordtype">int</span> size_table = <a class="code" href="classTraduction__Indice__Global__Local.html#a8a3ff36f74660ae806875731ecfcf73a">table_</a>.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l01687"></a>01687   <span class="keywordflow">for</span> (i = 0; i &lt; nb_indices; i++)
<a name="l01688"></a>01688     {
<a name="l01689"></a>01689       <span class="keyword">const</span> <span class="keywordtype">int</span> i_glob = indices_globaux[i];
<a name="l01690"></a>01690       <span class="keywordtype">int</span> i_loc;
<a name="l01691"></a>01691       <span class="keywordflow">if</span> (i_glob &lt; 0)
<a name="l01692"></a>01692         {
<a name="l01693"></a>01693 <span class="comment">// Indice negatif, on considere que c&#39;est normal,</span>
<a name="l01694"></a>01694 <span class="comment">// c&#39;est un marqueur &quot;indice vide&quot;.</span>
<a name="l01695"></a>01695           i_loc = -1;
<a name="l01696"></a>01696         }
<a name="l01697"></a>01697       <span class="keywordflow">else</span>
<a name="l01698"></a>01698         {
<a name="l01699"></a>01699 <span class="comment">// On teste si l&#39;item n&#39;est pas renumerote</span>
<a name="l01700"></a>01700           i_loc = i_glob - <a class="code" href="classTraduction__Indice__Global__Local.html#ab93ee6d07d2960f8d6fe8b67cb3f6852">premier_indice_global_</a>;
<a name="l01701"></a>01701           <span class="keywordflow">if</span> (i_loc &lt; 0 || i_loc &gt;= size_table || <a class="code" href="classTraduction__Indice__Global__Local.html#a8a3ff36f74660ae806875731ecfcf73a">table_</a>[i_loc] != i_glob)
<a name="l01702"></a>01702             {
<a name="l01703"></a>01703 <span class="comment">// non, il faut inverser la table:</span>
<a name="l01704"></a>01704               i_loc = <a class="code" href="classTraduction__Indice__Global__Local.html#a837fb55e45b63ed0ed16085b7f4c9c0d" title="Cherche i tel que table_inverse(i, 0) == sommet_global, et renvoie table_inverse(i, 1) (l&#39;indice local du sommet). Si le sommet n&#39;est pas trouve dans la table, renvoie -1. La table_inverse doit etre triee par ordre croissant de la colonne 0. La table_inverse ne doit pas avoir d&#39;espace virtuel.">chercher_table_inverse</a>(<a class="code" href="classTraduction__Indice__Global__Local.html#ac70085221bd16c6595310480c5756da9">table_inverse_</a>, i_glob);
<a name="l01705"></a>01705             }
<a name="l01706"></a>01706           <span class="keywordflow">if</span> (i_loc &lt; 0)
<a name="l01707"></a>01707             nb_erreurs++;
<a name="l01708"></a>01708         }
<a name="l01709"></a>01709       indices_locaux[i] = i_loc;
<a name="l01710"></a>01710     }
<a name="l01711"></a>01711   <span class="keywordflow">return</span> nb_erreurs;
<a name="l01712"></a>01712 }
<a name="l01713"></a>01713 
<a name="l01714"></a>01714 <span class="comment">//</span>
<a name="l01715"></a>01715 <span class="comment">//</span>
<a name="l01716"></a>01716 <span class="comment">//</span>
<a name="l01717"></a>01717 <span class="comment">//</span>
<a name="l01718"></a>01718 <span class="comment">//</span>
<a name="l01719"></a>01719 <span class="comment">//</span>
<a name="l01720"></a>01720 <span class="comment">//</span>
<a name="l01721"></a>01721 <span class="comment">//</span>
<a name="l01722"></a>01722 <span class="comment">//</span>
<a name="l01723"></a>01723 <span class="comment">//</span><span class="comment"></span>
<a name="l01724"></a>01724 <span class="comment">//! A partir d&#39;un tableau dont la structure d&#39;espace virtuel est initialisee&lt;br&gt;(descripteurs elements distants et virtuels, items communs)&lt;br&gt;et contenant des indices compatibles avec le contenu des tables&lt;br&gt;(indices de sommets ou d&#39;elements selon type_table_),&lt;br&gt;on remplit les elements virtuels du &quot;tableau&quot; en fonction des elements&lt;br&gt;distants et on traduit les indices en indices locaux.&lt;br&gt;(exemple, voir construire_espace_virtuel_elements et&lt;br&gt;construire_espace_virtuel_faces).&lt;br&gt;Valeur de retour: nombre d&#39;indices qui n&#39;ont pas pu etre traduits&lt;br&gt;(par exemple, le sommet reference n&#39;existe pas sur le processeur voisin)</span>
<a name="l01725"></a><a class="code" href="classTraduction__Indice__Global__Local.html#a9a0510ebef5ce63dcfcf00e35c0578c3">01725</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="classTraduction__Indice__Global__Local.html#a9a0510ebef5ce63dcfcf00e35c0578c3" title="A partir d&#39;un tableau dont la structure d&#39;espace virtuel est initialisee&lt;br&gt;(descripteurs elements dist...">Traduction_Indice_Global_Local::traduire_espace_virtuel</a>(<a class="code" href="classIntVect.html">IntVect</a>&amp; tableau)<span class="keyword"> const</span>
<a name="l01726"></a>01726 <span class="keyword"></span>{
<a name="l01727"></a>01727 <span class="comment">// On cree une copie du tableau, dans laquelle on met les indices globaux:</span>
<a name="l01728"></a>01728   <a class="code" href="classIntVect.html">IntVect</a> indices_globaux;
<a name="l01729"></a>01729 <span class="comment">// Ne copier que la structure</span>
<a name="l01730"></a>01730   indices_globaux.<a class="code" href="classIntVect.html#a94564e16be1ede0879c6aea2dfc810af" title="copie de la structure et des valeurs (si opt==COPY_INIT) du tableau v. Attention, v doit vraiment etr...">copy</a>(tableau, <a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ffaf6ae9ba7eb51c5f298ce693345b3ec68">ArrOfInt::NOCOPY_NOINIT</a>);
<a name="l01731"></a>01731 
<a name="l01732"></a>01732   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_items_reels    = tableau.<a class="code" href="classIntVect.html#ae17a73660093eb1d4e90fd8d0ec52670" title="Taille de l&#39;espace &quot;reel&quot; du vecteur. (si md_vector_ est nul, cette valeur est identique a size_arr...">size_reelle</a>();
<a name="l01733"></a>01733   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_items_tot      = tableau.<a class="code" href="classIntVect.html#afa716e1f0a1f0f74f4f73e95b5651412" title="Identique a size_array()">size_totale</a>();
<a name="l01734"></a>01734   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_items_virtuels = nb_items_tot - nb_items_reels;
<a name="l01735"></a>01735 
<a name="l01736"></a>01736 <span class="comment">// On traduit les items reels en indices globaux:</span>
<a name="l01737"></a>01737   <a class="code" href="classTraduction__Indice__Global__Local.html#a633b4d9dc27e092f08bb2918401a4c7b" title="Transforme les indices locaux en indices globaux a l&#39;aide la &quot;table_&quot; (voir initialiser). On fait : Pour debut &lt;= i &lt; debut+nb indices_globaux[i] = table_[indices_locaux[i]] si indices_locaux[i] &lt; 0 alors indices_globaux[i] = -1.">traduire_indice_local_vers_global</a>(tableau, indices_globaux, nb_items_reels);
<a name="l01738"></a>01738 <span class="comment">// On remplit les cases virtuelles</span>
<a name="l01739"></a>01739   indices_globaux.<a class="code" href="classIntVect.html#ad12bea67621d1a0ee82b27c9a37ca4ef">echange_espace_virtuel</a>();
<a name="l01740"></a>01740 
<a name="l01741"></a>01741 <span class="comment">// On retraduit uniquement les items virtuels du &quot;tableau&quot; en indices locaux:</span>
<a name="l01742"></a>01742   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> src;
<a name="l01743"></a>01743   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> dest;
<a name="l01744"></a>01744   src.<a class="code" href="classArrOfInt.html#acdd0214cc8f6c95882e5032b9e3121ea" title="Fait pointer le tableau vers les memes donnees qu&#39;un tableau existant. Le tableau sera du meme type q...">ref_array</a>(indices_globaux, nb_items_reels <span class="comment">/*debut*/</span>, nb_items_virtuels <span class="comment">/*taille*/</span>);
<a name="l01745"></a>01745   dest.<a class="code" href="classArrOfInt.html#acdd0214cc8f6c95882e5032b9e3121ea" title="Fait pointer le tableau vers les memes donnees qu&#39;un tableau existant. Le tableau sera du meme type q...">ref_array</a>(tableau, nb_items_reels <span class="comment">/*debut*/</span>, nb_items_virtuels <span class="comment">/*taille*/</span>);
<a name="l01746"></a>01746   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_erreurs = <a class="code" href="classTraduction__Indice__Global__Local.html#af7d70b1f6312872791271392881768d5" title="Pour debut &lt;= i &lt; debut+nb indices_locaux[i] = chercher l&#39;indice local de &quot;indices_globaux[i]&quot; Parame...">traduire_indice_global_vers_local</a>(src, dest);
<a name="l01747"></a>01747   <span class="keywordflow">return</span> nb_erreurs;
<a name="l01748"></a>01748 }
<a name="l01749"></a>01749 
<a name="l01750"></a>01750 <span class="comment">//</span>
<a name="l01751"></a>01751 <span class="comment">//</span>
<a name="l01752"></a>01752 <span class="comment">//</span>
<a name="l01753"></a>01753 <span class="comment">//</span>
<a name="l01754"></a>01754 <span class="comment">//</span>
<a name="l01755"></a>01755 <span class="comment">//</span>
<a name="l01756"></a>01756 <span class="comment">//</span>
<a name="l01757"></a>01757 <span class="comment">//</span>
<a name="l01758"></a>01758 <span class="comment">//</span>
<a name="l01759"></a>01759 <span class="comment">//</span>
<a name="l01760"></a>01760 <span class="comment">//</span><span class="comment"></span>
<a name="l01761"></a>01761 <span class="comment">//! Construit la structure items_communs + espaces virtuels d&#39;un tableau contenant&lt;br&gt;des indices d&#39;items geometriques, indexe par un autre type d&#39;item geometrique.&lt;br&gt;Exemple: tableau indexe par md_indice, contenant des indices md_valeur:&lt;br&gt;type_indice  type_valeur   exemple de tableau:&lt;br&gt;element      sommet       zone.les_elems()&lt;br&gt;face         sommet       faces_sommets&lt;br&gt;element      face         elem_faces&lt;br&gt;face         element      faces_voisins&lt;br&gt;element      element      ?&lt;br&gt;element      arete        elem_aretes&lt;br&gt;Nb_valeurs_max est le nombre d&#39;items reels de type &quot;type_valeur&quot;.</span>
<a name="l01762"></a><a class="code" href="classScatter.html#a33c68e7eff97ee92b457b50e8e3ad58d">01762</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classScatter.html#a33c68e7eff97ee92b457b50e8e3ad58d" title="Construit la structure items_communs + espaces virtuels d&#39;un tableau contenant des indices d&#39;items ge...">Scatter::construire_espace_virtuel_traduction</a>(<span class="keyword">const</span> <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a>&amp; md_indice,
<a name="l01763"></a>01763                                                    <span class="keyword">const</span> <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a>&amp; md_valeur,
<a name="l01764"></a>01764                                                    <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; tableau,
<a name="l01765"></a>01765                                                    <span class="keyword">const</span> <span class="keywordtype">int</span> error_is_fatal)
<a name="l01766"></a>01766 {
<a name="l01767"></a>01767   <span class="keywordflow">if</span> (tableau.<a class="code" href="classIntTab.html#a71e9b9ddc1793094b1b3f109377952b1" title="Returns the total dimensions of the multi-dimensionnal array, including virtual items (used in parall...">dimension_tot</a>(0) != md_indice.<a class="code" href="classMD__Vector.html#a41324dfaa7a973091d0a8276908d10e2">valeur</a>().<a class="code" href="classMD__Vector__base.html#ade0ef13d456f8aa11d02f51fd7912145">get_nb_items_reels</a>()
<a name="l01768"></a>01768       &amp;&amp; (tableau.<a class="code" href="classIntTab.html#a71e9b9ddc1793094b1b3f109377952b1" title="Returns the total dimensions of the multi-dimensionnal array, including virtual items (used in parall...">dimension_tot</a>(0) != md_indice.<a class="code" href="classMD__Vector.html#a41324dfaa7a973091d0a8276908d10e2">valeur</a>().<a class="code" href="classMD__Vector__base.html#a27d5ace2aee5ecf1d78accb7b321108d">get_nb_items_tot</a>()))
<a name="l01769"></a>01769     {
<a name="l01770"></a>01770       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;[PE &quot;</span> &lt;&lt; <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>()
<a name="l01771"></a>01771            &lt;&lt; <span class="stringliteral">&quot;] Error in Scatter::construire_espace_virtuel_traduction\n&quot;</span>
<a name="l01772"></a>01772            &lt;&lt; <span class="stringliteral">&quot; the array does not have the good dimension on input&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01773"></a>01773       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l01774"></a>01774     }
<a name="l01775"></a>01775 <span class="comment">// Construction du dictionnaire indice global/indice local</span>
<a name="l01776"></a>01776 <span class="comment">// pour les valeurs du tableau</span>
<a name="l01777"></a>01777   <a class="code" href="classTraduction__Indice__Global__Local.html" title="Cette classe fournit les outils pour construire l&#39;espace virtuel d&#39;un tableau contenant des indices d...">Traduction_Indice_Global_Local</a> dictionnaire_indices;
<a name="l01778"></a>01778   dictionnaire_indices.<a class="code" href="classTraduction__Indice__Global__Local.html#af8aae1bb5e815066c64937bde87b7e8a" title="Initialise le dictionnaire Precontition: Les espaces distants des entites utilisees doivent avoir ete...">initialiser</a>(md_valeur);
<a name="l01779"></a>01779 
<a name="l01780"></a>01780 <span class="comment">// Construit la structure d&#39;espaces virtuels du &quot;tableau&quot;</span>
<a name="l01781"></a>01781   <span class="keywordflow">if</span> (!(tableau.<a class="code" href="classIntVect.html#ae74e1fee6aca124d32718267e33a40c6">get_md_vector</a>() == md_indice))
<a name="l01782"></a>01782     <a class="code" href="MD__Vector__tools_8cpp.html#aff1ed2791dba1a76fdb300920147cfdf">MD_Vector_tools::creer_tableau_distribue</a>(md_indice, tableau, <a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ffac85954f9768f1ed2b14e58cea8ddb7c5">Array_base::COPY_NOINIT</a>);
<a name="l01783"></a>01783 
<a name="l01784"></a>01784 <span class="comment">// Remplissage des valeurs vituelles du &quot;tableau&quot;</span>
<a name="l01785"></a>01785   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_erreurs =
<a name="l01786"></a>01786     dictionnaire_indices.<a class="code" href="classTraduction__Indice__Global__Local.html#a9a0510ebef5ce63dcfcf00e35c0578c3" title="A partir d&#39;un tableau dont la structure d&#39;espace virtuel est initialisee&lt;br&gt;(descripteurs elements dist...">traduire_espace_virtuel</a>(tableau);
<a name="l01787"></a>01787 
<a name="l01788"></a>01788   <span class="keywordflow">if</span> (nb_erreurs &gt; 0 &amp;&amp; error_is_fatal)
<a name="l01789"></a>01789     {
<a name="l01790"></a>01790       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;[PE &quot;</span> &lt;&lt; <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>()
<a name="l01791"></a>01791            &lt;&lt; <span class="stringliteral">&quot;] Error in Scatter::construire_espace_virtuel_traduction\n&quot;</span>
<a name="l01792"></a>01792            &lt;&lt; <span class="stringliteral">&quot; some indices of values were not found in\n&quot;</span>
<a name="l01793"></a>01793            &lt;&lt; <span class="stringliteral">&quot; the local area : it missing virtual items&quot;</span>
<a name="l01794"></a>01794            &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01795"></a>01795       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l01796"></a>01796     }
<a name="l01797"></a>01797 }
<a name="l01798"></a>01798 
<a name="l01799"></a>01799 
<a name="l01800"></a>01800 <span class="comment">// Precondition:</span>
<a name="l01801"></a>01801 <span class="comment">// Les sommets distants doivent avoir ete calcules (utilisation du dictionnaire)</span>
<a name="l01802"></a>01802 <span class="comment">//</span>
<a name="l01803"></a>01803 <span class="comment">//</span>
<a name="l01804"></a>01804 <span class="comment">//</span>
<a name="l01805"></a>01805 <span class="comment">//</span><span class="comment"></span>
<a name="l01806"></a>01806 <span class="comment">//! Reordonne les faces de joint de sorte qu&#39;elles apparaissent dans le meme&lt;br&gt;ordre sur chaque couple de processeur voisin. En pratique, pour un couple&lt;br&gt;pe1 &lt; pe2, pe1 envoie ses faces de joint a pe2 et pe2 les traduit en indices&lt;br&gt;de sommets locaux. Les faces de joint du PE2 ne sont donc pas utilisees.</span>
<a name="l01807"></a><a class="code" href="classScatter.html#a0a86d55709f7e53fcf40a09de74033cf">01807</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classScatter.html#a0a86d55709f7e53fcf40a09de74033cf" title="Reordonne les faces de joint de sorte qu&#39;elles apparaissent dans le meme ordre sur chaque couple de p...">Scatter::reordonner_faces_de_joint</a>(<a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom)
<a name="l01808"></a>01808 {
<a name="l01809"></a>01809 <span class="comment">// Construction du dictionnaire indice global/indice local</span>
<a name="l01810"></a>01810 <span class="comment">// pour les sommets du domaine:</span>
<a name="l01811"></a>01811   <a class="code" href="classTraduction__Indice__Global__Local.html" title="Cette classe fournit les outils pour construire l&#39;espace virtuel d&#39;un tableau contenant des indices d...">Traduction_Indice_Global_Local</a> dictionnaire_indices;
<a name="l01812"></a>01812   dictionnaire_indices.<a class="code" href="classTraduction__Indice__Global__Local.html#af8aae1bb5e815066c64937bde87b7e8a" title="Initialise le dictionnaire Precontition: Les espaces distants des entites utilisees doivent avoir ete...">initialiser</a>(dom.<a class="code" href="classDomaine.html#a0846ac03a10b65c4df911fe35a19c02f" title="Renvoie le nombre total de sommets.">les_sommets</a>().<a class="code" href="classDoubleVect.html#a0d16d30580c90526e4895388fb44be5d">get_md_vector</a>());
<a name="l01813"></a>01813 
<a name="l01814"></a>01814   <a class="code" href="classSchema__Comm.html">Schema_Comm</a> schema_comm;
<a name="l01815"></a>01815   <a class="code" href="classJoints.html" title="Classe Joints Cette classe represente une liste d&#39;objet de type Joint.">Joints</a>&amp;      joints    = dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>();
<a name="l01816"></a>01816   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_joints = joints.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>();
<a name="l01817"></a>01817   <span class="keyword">const</span> <span class="keywordtype">int</span> moi       = <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>();
<a name="l01818"></a>01818   <span class="keywordtype">int</span>       i_joint;
<a name="l01819"></a>01819 
<a name="l01820"></a>01820 <span class="comment">// Remplissage des listes de destinataires:</span>
<a name="l01821"></a>01821 <span class="comment">// on envoie aux voisins de rang superieur et on recoit des voisins de rang inf.</span>
<a name="l01822"></a>01822   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> send_list;
<a name="l01823"></a>01823   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> recv_list;
<a name="l01824"></a>01824   send_list.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l01825"></a>01825   recv_list.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l01826"></a>01826 
<a name="l01827"></a>01827   <span class="keywordflow">for</span> (i_joint = 0; i_joint &lt; nb_joints; i_joint++)
<a name="l01828"></a>01828     {
<a name="l01829"></a>01829       <span class="keyword">const</span> <span class="keywordtype">int</span> pe_voisin = joints[i_joint].PEvoisin();
<a name="l01830"></a>01830       <span class="keywordflow">if</span> (pe_voisin &gt; moi)
<a name="l01831"></a>01831         send_list.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(pe_voisin);
<a name="l01832"></a>01832       <span class="keywordflow">else</span>
<a name="l01833"></a>01833         recv_list.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(pe_voisin);
<a name="l01834"></a>01834     }
<a name="l01835"></a>01835 
<a name="l01836"></a>01836   schema_comm.<a class="code" href="classSchema__Comm.html#ad11c9b47999c294c26ae4df8d2bbd57b" title="Definit la liste des processeurs a qui on va envoyer et de qui on va recevoir des donnees...">set_send_recv_pe_list</a>(send_list, recv_list);
<a name="l01837"></a>01837 
<a name="l01838"></a>01838   schema_comm.<a class="code" href="classSchema__Comm.html#ac617b53de22748cdd9fa30a0cfd0f4a8" title="Statut passe a WRITING Autorise si status_ == WRITING:">begin_comm</a>();
<a name="l01839"></a>01839 <span class="comment">// Envoi des faces de joint, traduites en indices de sommets globaux</span>
<a name="l01840"></a>01840   <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a> faces_num_global;
<a name="l01841"></a>01841   faces_num_global.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l01842"></a>01842   <span class="keywordflow">for</span> (i_joint = 0; i_joint &lt; nb_joints; i_joint++)
<a name="l01843"></a>01843     {
<a name="l01844"></a>01844       <span class="keyword">const</span> <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp;   joint         = joints[i_joint];
<a name="l01845"></a>01845       <span class="keyword">const</span> <span class="keywordtype">int</span>   pe_voisin     = joint.<a class="code" href="classJoint.html#a0952bc5c7805434ccd8cd5c9b01e3747" title="Renvoie PEvoisin (numero de la zone voisine)">PEvoisin</a>();
<a name="l01846"></a>01846       <span class="keywordflow">if</span> (pe_voisin &gt; moi)
<a name="l01847"></a>01847         {
<a name="l01848"></a>01848           <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; faces_sommets = joint.<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a07b8d8db9e3d656b93a21a49c063430c">les_sommets</a>();
<a name="l01849"></a>01849           <span class="keywordflow">if</span> (faces_sommets.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0) &gt; 0)
<a name="l01850"></a>01850             {
<a name="l01851"></a>01851               faces_num_global.<a class="code" href="classIntTab.html#a22e6bed6826b3688d4d0181cbf3b7a38" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(faces_sommets.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0), faces_sommets.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1));
<a name="l01852"></a>01852               dictionnaire_indices.<a class="code" href="classTraduction__Indice__Global__Local.html#a633b4d9dc27e092f08bb2918401a4c7b" title="Transforme les indices locaux en indices globaux a l&#39;aide la &quot;table_&quot; (voir initialiser). On fait : Pour debut &lt;= i &lt; debut+nb indices_globaux[i] = table_[indices_locaux[i]] si indices_locaux[i] &lt; 0 alors indices_globaux[i] = -1.">traduire_indice_local_vers_global</a>(faces_sommets,
<a name="l01853"></a>01853                                                                      faces_num_global,
<a name="l01854"></a>01854                                                                      faces_sommets.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>());
<a name="l01855"></a>01855             }
<a name="l01856"></a>01856           <span class="keywordflow">else</span>
<a name="l01857"></a>01857             faces_num_global.<a class="code" href="classIntTab.html#a22e6bed6826b3688d4d0181cbf3b7a38" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(0);
<a name="l01858"></a>01858 
<a name="l01859"></a>01859           schema_comm.<a class="code" href="classSchema__Comm.html#a6c771eae3b46250ae0d2f0126a7d8065" title="renvoie le buffer correspondant au processeur num_PE pour y entasser des donnees a envoyer...">send_buffer</a>(pe_voisin) &lt;&lt; faces_num_global;
<a name="l01860"></a>01860         }
<a name="l01861"></a>01861     }
<a name="l01862"></a>01862   schema_comm.<a class="code" href="classSchema__Comm.html#abca0e8ac6c2b742d26f3cfaee0690c72" title="Statut passe a EXCHANGED.">echange_taille_et_messages</a>();
<a name="l01863"></a>01863 <span class="comment">// Reception des faces de joint et traduction en indices locaux</span>
<a name="l01864"></a>01864   <span class="keywordflow">for</span> (i_joint = 0; i_joint &lt; nb_joints; i_joint++)
<a name="l01865"></a>01865     {
<a name="l01866"></a>01866       <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp;       joint     = joints[i_joint];
<a name="l01867"></a>01867       <span class="keyword">const</span> <span class="keywordtype">int</span> pe_voisin = joint.<a class="code" href="classJoint.html#a0952bc5c7805434ccd8cd5c9b01e3747" title="Renvoie PEvoisin (numero de la zone voisine)">PEvoisin</a>();
<a name="l01868"></a>01868       <span class="keywordflow">if</span> (pe_voisin &lt; moi)
<a name="l01869"></a>01869         {
<a name="l01870"></a>01870           <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; faces_sommets = joint.<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a07b8d8db9e3d656b93a21a49c063430c">les_sommets</a>();
<a name="l01871"></a>01871           schema_comm.<a class="code" href="classSchema__Comm.html#a0c056eb81ab8fd513912b336b4d13a1a" title="renvoie le buffer correspondant au processeur num_PE pour y lire les donnees recues. Le schema doit etre dans l&#39;etat EXCHANGED.">recv_buffer</a>(pe_voisin) &gt;&gt; faces_num_global;
<a name="l01872"></a>01872           <span class="keywordflow">if</span> (faces_sommets.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0) != faces_num_global.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0))
<a name="l01873"></a>01873             {
<a name="l01874"></a>01874               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;[PE &quot;</span> &lt;&lt; moi
<a name="l01875"></a>01875                    &lt;&lt; <span class="stringliteral">&quot;] Error in Scatter::reordonner_faces_de_joint:\n&quot;</span>
<a name="l01876"></a>01876                    &lt;&lt; <span class="stringliteral">&quot; the number of joint faces is not identical to the PE &quot;</span>
<a name="l01877"></a>01877                    &lt;&lt; pe_voisin &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01878"></a>01878               <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l01879"></a>01879             }
<a name="l01880"></a>01880           <span class="keyword">const</span> <span class="keywordtype">int</span> nb_erreurs =
<a name="l01881"></a>01881             dictionnaire_indices.<a class="code" href="classTraduction__Indice__Global__Local.html#af7d70b1f6312872791271392881768d5" title="Pour debut &lt;= i &lt; debut+nb indices_locaux[i] = chercher l&#39;indice local de &quot;indices_globaux[i]&quot; Parame...">traduire_indice_global_vers_local</a>(faces_num_global,
<a name="l01882"></a>01882                                                                    faces_sommets);
<a name="l01883"></a>01883           <span class="keywordflow">if</span> (nb_erreurs &gt; 0)
<a name="l01884"></a>01884             {
<a name="l01885"></a>01885               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;[PE &quot;</span> &lt;&lt; moi
<a name="l01886"></a>01886                    &lt;&lt; <span class="stringliteral">&quot;] Error in Scatter::reordonner_faces_de_joint:\n&quot;</span>
<a name="l01887"></a>01887                    &lt;&lt; <span class="stringliteral">&quot; The faces of the joint with PE &quot;</span> &lt;&lt; pe_voisin
<a name="l01888"></a>01888                    &lt;&lt; <span class="stringliteral">&quot; use of unknown nodes&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01889"></a>01889               <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l01890"></a>01890             }
<a name="l01891"></a>01891         }
<a name="l01892"></a>01892     }
<a name="l01893"></a>01893   schema_comm.<a class="code" href="classSchema__Comm.html#a73a981f88b6ffebc150fb46c5cce75d9" title="Statut passe a RESET Accesseurs:">end_comm</a>();
<a name="l01894"></a>01894 }
<a name="l01895"></a>01895 
<a name="l01896"></a>01896 <span class="comment">//</span>
<a name="l01897"></a>01897 <span class="comment">//</span><span class="comment"></span>
<a name="l01898"></a>01898 <span class="comment">//! Methode outil: renvoie une liste complete de tous les&lt;br&gt;sommets de joint (sommets des faces + sommets isoles), triee et&lt;br&gt;sans doublons</span>
<a name="l01899"></a><a class="code" href="Scatter_8cpp.html#a4286544562bceff2d921dc707678463f">01899</a> <span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="Scatter_8cpp.html#a4286544562bceff2d921dc707678463f" title="Methode outil: renvoie une liste complete de tous les sommets de joint (sommets des faces + sommets i...">calculer_liste_complete_sommets_joint</a>(<span class="keyword">const</span> <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp; joint, <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; liste_sommets)
<a name="l01900"></a>01900 {
<a name="l01901"></a>01901   liste_sommets = joint.<a class="code" href="classJoint.html#a3f49fb1150967b436a115a7373ab27a0" title="Renvoie les informations de joint pour le type demande.">joint_item</a>(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>).<a class="code" href="classJoint__Items.html#a435fb1629f6dafb089605913517e73c4" title="Voir items_communs_.">items_communs</a>();
<a name="l01902"></a>01902 <span class="preprocessor">#if 0</span>
<a name="l01903"></a>01903 <span class="preprocessor"></span>  liste_sommets.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l01904"></a>01904 <span class="comment">// On prend tous les sommets des faces de joint:</span>
<a name="l01905"></a>01905   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; som_faces = joint.<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a07b8d8db9e3d656b93a21a49c063430c">les_sommets</a>();
<a name="l01906"></a>01906   liste_sommets = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>,som_faces);
<a name="l01907"></a>01907 <span class="comment">// On ajoute tous les sommets isoles :</span>
<a name="l01908"></a>01908   <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; som_isoles = joint.sommets();
<a name="l01909"></a>01909   <span class="keyword">const</span> <span class="keywordtype">int</span> n = som_isoles.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l01910"></a>01910   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
<a name="l01911"></a>01911     liste_sommets.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(som_isoles[i]);
<a name="l01912"></a>01912 <span class="comment">// Retirer les doublons de la liste</span>
<a name="l01913"></a>01913   <a class="code" href="Scatter_8cpp.html#a23c4d19dc90caae2323f04de90621709" title="Methode outil pour retirer les doublons dans un tableau.">array_trier_retirer_doublons</a>(liste_sommets);
<a name="l01914"></a>01914 <span class="preprocessor">#endif</span>
<a name="l01915"></a>01915 <span class="preprocessor"></span>}
<a name="l01916"></a>01916 
<a name="l01917"></a><a class="code" href="Scatter_8cpp.html#a161e660f58270346277422596ef9c7b3">01917</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="Scatter_8cpp.html#a161e660f58270346277422596ef9c7b3">arete_de_sommets_Si_et_Sj</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; Si, <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; Sj, <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; arete, <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; aretes_som)
<a name="l01918"></a>01918 {
<a name="l01919"></a>01919   <span class="keywordflow">if</span> ( (aretes_som(arete,0) == Si &amp;&amp; aretes_som(arete,1) == Sj)
<a name="l01920"></a>01920        || (aretes_som(arete,1) == Si &amp;&amp; aretes_som(arete,0) == Sj) )
<a name="l01921"></a>01921     <span class="keywordflow">return</span> 1;
<a name="l01922"></a>01922   <span class="keywordflow">else</span>
<a name="l01923"></a>01923     <span class="keywordflow">return</span> 0;
<a name="l01924"></a>01924 }
<a name="l01925"></a>01925 
<a name="l01926"></a>01926 <span class="comment">//</span>
<a name="l01927"></a>01927 <span class="comment">//</span><span class="comment"></span>
<a name="l01928"></a>01928 <span class="comment">//! Methode outil: renvoie une liste complete de tous les&lt;br&gt;aretes de joint (aretes des faces + aretes isolees), triee et&lt;br&gt;sans doublons</span>
<a name="l01929"></a><a class="code" href="Scatter_8cpp.html#a984d3b204fb849a38f321769e58a5ef1">01929</a> <span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="Scatter_8cpp.html#a984d3b204fb849a38f321769e58a5ef1" title="Methode outil: renvoie une liste complete de tous les aretes de joint (aretes des faces + aretes isol...">calculer_liste_complete_aretes_joint</a>(<span class="keyword">const</span> <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp; joint, <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; liste_aretes)
<a name="l01930"></a>01930 {
<a name="l01931"></a>01931 <span class="comment">// Construction de la liste des aretes communes liste_aretes</span>
<a name="l01932"></a>01932   liste_aretes.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l01933"></a>01933 <span class="comment">//</span>
<a name="l01934"></a>01934 <span class="comment">// Recherche des aretes de joint sur les faces de joint</span>
<a name="l01935"></a>01935 <span class="comment">//</span>
<a name="l01936"></a>01936   <span class="keywordtype">int</span> nb_faces_joint=joint.<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a64d898edb20c3687d357018f1821c50a" title="Renvoie le nombre de Faces.">nb_faces</a>();
<a name="l01937"></a>01937   <span class="keywordtype">int</span> nb_som_faces=joint.<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a1361d27e4c8b239c48de671fad23428c" title="Renvoie le nombre de sommet par face.">nb_som_faces</a>();
<a name="l01938"></a>01938   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; sommet=joint.<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a07b8d8db9e3d656b93a21a49c063430c">les_sommets</a>();
<a name="l01939"></a>01939   <span class="keyword">const</span> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom=joint.<a class="code" href="classFrontiere.html#a510866aace5f3ed9482553db1a08a3c9" title="Renvoie la Zone associee a la frontiere. (version const)">zone</a>().<a class="code" href="classZone.html#a379ad2206b5a13a4f4f3df6d44c7546a" title="Renvoie le domaine dont la zone fait partie. (version const)">domaine</a>();
<a name="l01940"></a>01940   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; coord=dom.<a class="code" href="classDomaine.html#aecd32c3eecc15cce7d1a0e468dadbf96" title="Renvoie le tableau des coordonnees des noeuds (sommets). (acces en lecture)">coord_sommets</a>();
<a name="l01941"></a>01941   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; aretes_som=joint.<a class="code" href="classFrontiere.html#a510866aace5f3ed9482553db1a08a3c9" title="Renvoie la Zone associee a la frontiere. (version const)">zone</a>().<a class="code" href="classZone.html#affa60690e1b372fa4c01d6088267dbe4" title="renvoie le tableau de connectivite aretes/sommets.">aretes_som</a>();
<a name="l01942"></a>01942   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> aretes(1);
<a name="l01943"></a>01943   <span class="keywordtype">int</span> <a class="code" href="Memoire_8cpp.html#ade857a99d48bcb8cfaa57c4cd8d7d2e8">compteur</a>=0;
<a name="l01944"></a>01944   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> positions(1,<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">Objet_U::dimension</a>);
<a name="l01945"></a>01945   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> som_faces(nb_faces_joint*nb_som_faces);
<a name="l01946"></a>01946 <span class="comment">// On parcourt 2 a 2 les sommets de chaque face du joint</span>
<a name="l01947"></a>01947   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> face=0; face&lt;nb_faces_joint; face++)
<a name="l01948"></a>01948     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nb_som_faces; i++)
<a name="l01949"></a>01949       {
<a name="l01950"></a>01950         <span class="keywordtype">int</span> Si = sommet(face,i);
<a name="l01951"></a>01951         som_faces(face*nb_som_faces+i)=Si;
<a name="l01952"></a>01952         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=i; j&lt;nb_som_faces; j++)
<a name="l01953"></a>01953           {
<a name="l01954"></a>01954             <span class="keywordtype">int</span> Sj = sommet(face,j);
<a name="l01955"></a>01955 <span class="comment">// Calcul du point C entre 2 sommets Si et Sj</span>
<a name="l01956"></a>01956             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> comp=0; comp&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">Objet_U::dimension</a>; comp++)
<a name="l01957"></a>01957               positions(0,comp)=0.5*(coord(Si,comp)+coord(Sj,comp));
<a name="l01958"></a>01958             dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a94575800622f4900d6c92289f01c5fa5">chercher_aretes</a>(positions,aretes);
<a name="l01959"></a>01959 <span class="comment">// Si on trouve une arete dont le centre coincide avec le point C</span>
<a name="l01960"></a>01960 <span class="comment">// et dont les sommets sont identiques a Si et Sj, on ajoute l&#39;arete a la liste</span>
<a name="l01961"></a>01961             <span class="keywordflow">if</span> (aretes(0)&gt;=0 &amp;&amp; <a class="code" href="Scatter_8cpp.html#a161e660f58270346277422596ef9c7b3">arete_de_sommets_Si_et_Sj</a>(Si, Sj, aretes[0], aretes_som))
<a name="l01962"></a>01962               {
<a name="l01963"></a>01963                 compteur++;
<a name="l01964"></a>01964                 liste_aretes.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(aretes[0]);
<a name="l01965"></a>01965               }
<a name="l01966"></a>01966           }
<a name="l01967"></a>01967       }
<a name="l01968"></a>01968   <a class="code" href="classProcess.html#a57e0f54b11e6eaadbea224fa904b18dd" title="Renvoie un objet statique de type Sortie qui sert de journal d&#39;evenements. Si message_level &lt;= verbose...">Process::Journal</a>() &lt;&lt; <span class="stringliteral">&quot;common edges found on faces of joint with &quot;</span> &lt;&lt; joint.<a class="code" href="classJoint.html#a0952bc5c7805434ccd8cd5c9b01e3747" title="Renvoie PEvoisin (numero de la zone voisine)">PEvoisin</a>() &lt;&lt; <span class="stringliteral">&quot; :&quot;</span> &lt;&lt; compteur &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01969"></a>01969 <span class="comment">//</span>
<a name="l01970"></a>01970 <span class="comment">// Recherche des aretes de joint isolees sur les sommets de joints isoles</span>
<a name="l01971"></a>01971 <span class="comment">//</span>
<a name="l01972"></a>01972 <span class="comment">// joint.sommets() contient parfois tous les sommets !</span>
<a name="l01973"></a>01973 <span class="comment">// Donc on construit un tableau som_isoles</span>
<a name="l01974"></a>01974   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> som_isoles;
<a name="l01975"></a>01975 <span class="comment">// Met tous les sommets dans som_isoles (isoles+issus des faces de joint):</span>
<a name="l01976"></a>01976   <a class="code" href="Scatter_8cpp.html#a4286544562bceff2d921dc707678463f" title="Methode outil: renvoie une liste complete de tous les sommets de joint (sommets des faces + sommets i...">calculer_liste_complete_sommets_joint</a>(joint, som_isoles);
<a name="l01977"></a>01977 <span class="comment">// On trie som_faces et on supprime les doublons</span>
<a name="l01978"></a>01978   <a class="code" href="Scatter_8cpp.html#a23c4d19dc90caae2323f04de90621709" title="Methode outil pour retirer les doublons dans un tableau.">array_trier_retirer_doublons</a>(som_faces);
<a name="l01979"></a>01979 <span class="comment">// Supprime tous les sommets de som_isoles contenus dans som_faces</span>
<a name="l01980"></a>01980   <a class="code" href="Scatter_8cpp.html#ab0ae6267baccb3a639f4a8ff795edd35" title="Retire de &quot;sorted_array&quot; les elements qui figurent dans &quot;sorted_elements&quot;. Les deux tableaux doiv...">array_retirer_elements</a>(som_isoles, som_faces);
<a name="l01981"></a>01981 <span class="comment">// Supprime les sommets des faces de joint</span>
<a name="l01982"></a>01982   <span class="keyword">const</span> <span class="keywordtype">int</span> n = som_isoles.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l01983"></a>01983   <a class="code" href="classProcess.html#a57e0f54b11e6eaadbea224fa904b18dd" title="Renvoie un objet statique de type Sortie qui sert de journal d&#39;evenements. Si message_level &lt;= verbose...">Process::Journal</a>() &lt;&lt; <span class="stringliteral">&quot;number of isolated nodes: &quot;</span> &lt;&lt; n &lt;&lt; finl;
<a name="l01984"></a>01984   <a class="code" href="classProcess.html#a57e0f54b11e6eaadbea224fa904b18dd" title="Renvoie un objet statique de type Sortie qui sert de journal d&#39;evenements. Si message_level &lt;= verbose...">Process::Journal</a>() &lt;&lt; <span class="stringliteral">&quot;number of nodes of faces of joint: &quot;</span> &lt;&lt; 3*sommet.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0) &lt;&lt; finl;
<a name="l01985"></a>01985 
<a name="l01986"></a>01986   compteur=0;
<a name="l01987"></a>01987 <span class="comment">// On parcourt 2 a 2 les sommets isoles</span>
<a name="l01988"></a>01988   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
<a name="l01989"></a>01989     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = i; j &lt; n; j++)
<a name="l01990"></a>01990       {
<a name="l01991"></a>01991 <span class="comment">// Calcul du point C entre 2 sommets Si et Sj</span>
<a name="l01992"></a>01992         <span class="keywordtype">int</span> Si = som_isoles(i);
<a name="l01993"></a>01993         <span class="keywordtype">int</span> Sj = som_isoles(j);
<a name="l01994"></a>01994         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> comp=0; comp&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">Objet_U::dimension</a>; comp++)
<a name="l01995"></a>01995           positions(0,comp)=0.5*(coord(Si,comp)+coord(Sj,comp));
<a name="l01996"></a>01996         dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a94575800622f4900d6c92289f01c5fa5">chercher_aretes</a>(positions,aretes);
<a name="l01997"></a>01997 <span class="comment">// Si on trouve une arete dont le centre coincide avec le point C</span>
<a name="l01998"></a>01998 <span class="comment">// et dont les sommets sont identiques a Si et Sj, on ajoute l&#39;arete a la liste</span>
<a name="l01999"></a>01999         <span class="keywordflow">if</span> (aretes(0)&gt;=0 &amp;&amp; <a class="code" href="Scatter_8cpp.html#a161e660f58270346277422596ef9c7b3">arete_de_sommets_Si_et_Sj</a>(Si, Sj, aretes[0], aretes_som))
<a name="l02000"></a>02000           {
<a name="l02001"></a>02001             compteur++;
<a name="l02002"></a>02002             liste_aretes.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(aretes[0]);
<a name="l02003"></a>02003           }
<a name="l02004"></a>02004       }
<a name="l02005"></a>02005   <a class="code" href="classProcess.html#a57e0f54b11e6eaadbea224fa904b18dd" title="Renvoie un objet statique de type Sortie qui sert de journal d&#39;evenements. Si message_level &lt;= verbose...">Process::Journal</a>() &lt;&lt; <span class="stringliteral">&quot;common edges found isolated on joint with &quot;</span> &lt;&lt; joint.<a class="code" href="classJoint.html#a0952bc5c7805434ccd8cd5c9b01e3747" title="Renvoie PEvoisin (numero de la zone voisine)">PEvoisin</a>() &lt;&lt; <span class="stringliteral">&quot; :&quot;</span> &lt;&lt; compteur &lt;&lt; finl;
<a name="l02006"></a>02006 <span class="comment">// Retirer les doublons de la liste</span>
<a name="l02007"></a>02007   <a class="code" href="Scatter_8cpp.html#a23c4d19dc90caae2323f04de90621709" title="Methode outil pour retirer les doublons dans un tableau.">array_trier_retirer_doublons</a>(liste_aretes);
<a name="l02008"></a>02008 }
<a name="l02009"></a>02009 
<a name="l02010"></a><a class="code" href="Scatter_8cpp.html#a9ce09df49a63406b606ce247e3880d96">02010</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="Scatter_8cpp.html#a9ce09df49a63406b606ce247e3880d96">calculer_liste_complete_items_joint</a>(<span class="keyword">const</span> <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp; joint, <span class="keyword">const</span> <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926">Joint::Type_Item</a> type_item, <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; liste_items)
<a name="l02011"></a>02011 {
<a name="l02012"></a>02012   <span class="keywordflow">switch</span>(type_item)
<a name="l02013"></a>02013     {
<a name="l02014"></a>02014     <span class="keywordflow">case</span> <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>:
<a name="l02015"></a>02015       <a class="code" href="Scatter_8cpp.html#a4286544562bceff2d921dc707678463f" title="Methode outil: renvoie une liste complete de tous les sommets de joint (sommets des faces + sommets i...">calculer_liste_complete_sommets_joint</a>(joint, liste_items);
<a name="l02016"></a>02016       <span class="keywordflow">break</span>;
<a name="l02017"></a>02017     <span class="keywordflow">case</span> <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a7816c69408b98e1161f1f54e7b6b1cb4">Joint::ARETE</a>:
<a name="l02018"></a>02018       <a class="code" href="Scatter_8cpp.html#a984d3b204fb849a38f321769e58a5ef1" title="Methode outil: renvoie une liste complete de tous les aretes de joint (aretes des faces + aretes isol...">calculer_liste_complete_aretes_joint</a>(joint, liste_items);
<a name="l02019"></a>02019       <span class="keywordflow">break</span>;
<a name="l02020"></a>02020     <span class="keywordflow">default</span>:
<a name="l02021"></a>02021       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Scatter::calculer_liste_complete_items_joint&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l02022"></a>02022       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Type of item not expected.&quot;</span> &lt;&lt; finl;
<a name="l02023"></a>02023       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l02024"></a>02024     }
<a name="l02025"></a>02025 }
<a name="l02026"></a>02026 
<a name="l02027"></a>02027 <span class="comment">//</span>
<a name="l02028"></a>02028 <span class="comment">//</span>
<a name="l02029"></a>02029 <span class="comment">//</span>
<a name="l02030"></a>02030 <span class="comment">//</span>
<a name="l02031"></a>02031 <span class="comment">//</span>
<a name="l02032"></a>02032 <span class="comment">//</span>
<a name="l02033"></a>02033 <span class="comment">//</span><span class="comment"></span>
<a name="l02034"></a>02034 <span class="comment">//! Les algorithmes actuels pour le periodique (assembleur P1B, OpDivElem P1B)&lt;br&gt;ont besoin que pour chaque face virtuelle periodique, la face opposee soit&lt;br&gt;aussi virtuelle. Ceci n&#39;est pas assure a la sortie de la methode&lt;br&gt;calculer_elements_distants. Cette methode ajoute aux elements distants les&lt;br&gt;elements manquants pour assurer cette condition:&lt;br&gt;Si un element est distant pour un PE donne est voisin d&#39;une face periodique,&lt;br&gt;on ajoute a l&#39;espace distant l&#39;element adjacent a la face opposee.</span>
<a name="l02035"></a><a class="code" href="classScatter.html#a07723d3697739057d469082a4c4a554f">02035</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classScatter.html#a07723d3697739057d469082a4c4a554f" title="Les algorithmes actuels pour le periodique (assembleur P1B, OpDivElem P1B) ont besoin que pour chaque...">Scatter::corriger_espace_distant_elements_perio</a>(<a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom,
<a name="l02036"></a>02036                                                      <span class="keyword">const</span> <a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a>&amp; liste_bords_periodiques)
<a name="l02037"></a>02037 {
<a name="l02038"></a>02038   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l02039"></a>02039     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Correction of remote spaces of the elements for the periodic faces&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l02040"></a>02040 
<a name="l02041"></a>02041   <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone = dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0);
<a name="l02042"></a>02042   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_elem = zone.<a class="code" href="classZone.html#a7f249429803b27139a1c54436f6164a5" title="Renvoie le nombre d&#39;elements de la zone.">nb_elem</a>();
<a name="l02043"></a>02043   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; les_elems = zone.<a class="code" href="classZone.html#ac115e8342be89afb882b7b61cc343267" title="Renvoie le tableau des sommets des elements.">les_elems</a>();
<a name="l02044"></a>02044 
<a name="l02045"></a>02045 <span class="comment">// Ce tableau contiendra pour un bord periodique donne:</span>
<a name="l02046"></a>02046 <span class="comment">// si l&#39;element i est adjacent a une face de ce bord,</span>
<a name="l02047"></a>02047 <span class="comment">// element_oppose[i] est le numero de l&#39;element adjacent a la face</span>
<a name="l02048"></a>02048 <span class="comment">// opposee sur ce bord.</span>
<a name="l02049"></a>02049 <span class="comment">// -1 sinon.</span>
<a name="l02050"></a>02050   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> element_oppose(nb_elem);
<a name="l02051"></a>02051 
<a name="l02052"></a>02052   <a class="code" href="classStatic__Int__Lists.html" title="Cette classe permet de stocker des listes d&#39;entiers accessibles en temps constant. La taille des listes ne peut pas changer sans perdre le contenu (ce sont des listes statiques). Exemple: Static_Int_List l; ArrOfInt tailles(3); tailles[0] = 2; tailles[1] = 3; tailles[2] = 0; // On reserve la memoire pour trois listes de taille 2, 3 et 0: l.set_list_sizes(tailles); // On affecte une valeur au deuxieme element de la premiere liste: l.set_value(0,1,765); // Affiche la valeur Cout &lt;&lt; l(0,1);.">Static_Int_Lists</a> connectivite_som_elem;
<a name="l02053"></a>02053   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_sommets = dom.<a class="code" href="classDomaine.html#abc4abc8b8db5bebeb161fae4162a89ce" title="Renvoie le nombre de sommets.">nb_som</a>();
<a name="l02054"></a>02054   <a class="code" href="Connectivite__som__elem_8cpp.html#a82161461a228e43ae236c31101ff3ce6" title="construction de la structure som_elem pour la zone donnee On cree pour chaque sommet i la liste des e...">construire_connectivite_som_elem</a>(nb_sommets,
<a name="l02055"></a>02055                                    les_elems,
<a name="l02056"></a>02056                                    connectivite_som_elem,
<a name="l02057"></a>02057                                    0 <span class="comment">/* ne pas inclure les sommets virtuels */</span>);
<a name="l02058"></a>02058 
<a name="l02059"></a>02059   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_som_face = zone.<a class="code" href="classZone.html#a18cf83cd0f9c368dcfa32fb802a0ac94" title="Renvoie un element geometrique du type de ceux qui constituent la zone. (version const)">type_elem</a>().<a class="code" href="classElem__geom.html#ab55aa8b4ec6aa60cfde5d5fc134c5333" title="Appel a l&#39;objet sous-jacent Renvoie le nombre de sommets des faces du type specifie.">nb_som_face</a>();
<a name="l02060"></a>02060   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> une_face(nb_som_face);
<a name="l02061"></a>02061   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> elems_voisins;
<a name="l02062"></a>02062   elems_voisins.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l02063"></a>02063 
<a name="l02064"></a>02064   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_joints = zone.<a class="code" href="classZone.html#ab096afb61e89705709a4ae6d3576a644" title="Renvoie le nombre de joints de la zone.">nb_joints</a>();
<a name="l02065"></a>02065   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_bords_perio = liste_bords_periodiques.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>();
<a name="l02066"></a>02066 
<a name="l02067"></a>02067 <span class="comment">// Marqueurs des elements distants existants:</span>
<a name="l02068"></a>02068   <a class="code" href="classArrOfBit.html">ArrOfBit</a> marqueurs_elements_distants(nb_elem);
<a name="l02069"></a>02069   marqueurs_elements_distants = 0;
<a name="l02070"></a>02070 
<a name="l02071"></a>02071 <span class="comment">// Le fait d&#39;ajouter un element dans un espace distant pour un bord donne</span>
<a name="l02072"></a>02072 <span class="comment">// peut entrainer un probleme sur un autre bord (l&#39;element oppose de l&#39;element</span>
<a name="l02073"></a>02073 <span class="comment">// ainsi ajoute peut manquer pour une autre direction de periodicite).</span>
<a name="l02074"></a>02074 <span class="comment">// Il faut dont iterer jusqu&#39;a ce que plus rien ne bouge</span>
<a name="l02075"></a>02075   <span class="keywordtype">int</span> nb_elements_ajoutes = 0;
<a name="l02076"></a>02076   <span class="keywordflow">do</span>
<a name="l02077"></a>02077     {
<a name="l02078"></a>02078       nb_elements_ajoutes = 0;
<a name="l02079"></a>02079       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_bord_perio = 0; i_bord_perio &lt; nb_bords_perio; i_bord_perio++)
<a name="l02080"></a>02080         {
<a name="l02081"></a>02081           <span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; nom_bord = liste_bords_periodiques[i_bord_perio];
<a name="l02082"></a>02082           <span class="keyword">const</span> <a class="code" href="classBord.html" title="Classe Bord Cette classe represente un bord d&#39;une zone, c&#39;est un type de frontiere&lt;br&gt;(derive de Fronti...">Bord</a>&amp; bord = zone.<a class="code" href="classZone.html#af2f1e6a14af55249979da674e7aac11a" title="Renvoie le i-ieme bord de la zone&lt;br&gt;(version const)">bord</a>(nom_bord);
<a name="l02083"></a>02083           <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; faces_sommets = bord.<a class="code" href="classFrontiere.html#a6d1f96137ddae39a46985a8c3e53bcf5" title="Renvoie les sommets des faces de la frontiere.">les_sommets_des_faces</a>();
<a name="l02084"></a>02084           <span class="keyword">const</span> <span class="keywordtype">int</span> nb_faces = bord.<a class="code" href="classFrontiere.html#aa073fe9dbdddde59471ee7032b256aa2" title="Renvoie le nombre de faces de la frontiere.">nb_faces</a>();
<a name="l02085"></a>02085 
<a name="l02086"></a>02086 <span class="comment">// Premiere etape, reperer les element opposes pour ce bord periodique</span>
<a name="l02087"></a>02087 <span class="comment">// On boucle sur la premiere moitie de la frontiere.</span>
<a name="l02088"></a>02088 <span class="comment">// ATTENTION: on suppose que les faces de bords sont ordonnees : d&#39;abord toutes les faces</span>
<a name="l02089"></a>02089 <span class="comment">// d&#39;un cote du domaine periodique, puis, dans le meme ordre, les faces opposees.</span>
<a name="l02090"></a>02090           element_oppose = -1;
<a name="l02091"></a>02091 
<a name="l02092"></a>02092           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_face = 0; i_face &lt; nb_faces / 2; i_face++)
<a name="l02093"></a>02093             {
<a name="l02094"></a>02094 <span class="comment">// Pour chaque face, trouver l&#39;element adjacent a cette face et a la face opposee</span>
<a name="l02095"></a>02095 <span class="comment">// Boucle sur la face et la face opposee</span>
<a name="l02096"></a>02096               <span class="keywordtype">int</span> elem0 = -1; <span class="comment">//!&lt; Les deux elements opposes de cette face periodique</span>
<a name="l02097"></a>02097 <span class="comment"></span>              <span class="keywordtype">int</span> elem1 = -1;
<a name="l02098"></a>02098               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> quel_cote = 0; quel_cote &lt; 2; quel_cote++)
<a name="l02099"></a>02099                 {
<a name="l02100"></a>02100                   <span class="keyword">const</span> <span class="keywordtype">int</span> face = i_face + quel_cote * nb_faces / 2;
<a name="l02101"></a>02101                   <span class="keywordtype">int</span> i;
<a name="l02102"></a>02102                   <span class="keywordflow">for</span> (i = 0; i &lt; nb_som_face; i++)
<a name="l02103"></a>02103                     une_face[i] = faces_sommets(face, i);
<a name="l02104"></a>02104                   <a class="code" href="Connectivite__som__elem_8cpp.html#afccbadf5344a16154a56b33dbddf88c1" title="Cherche les elements qui contiennent tous les sommets du tableau sommets_to_find (permet de trouver l...">find_adjacent_elements</a>(connectivite_som_elem, une_face, elems_voisins);
<a name="l02105"></a>02105                   <span class="keyword">const</span> <span class="keywordtype">int</span> n = elems_voisins.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l02106"></a>02106                   <span class="keywordflow">if</span> (n != 1)
<a name="l02107"></a>02107                     {
<a name="l02108"></a>02108                       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Scatter::corriger_espace_distant_elements_perio: \n&quot;</span>
<a name="l02109"></a>02109                            &lt;&lt; <span class="stringliteral">&quot; The face &quot;</span> &lt;&lt; i_face &lt;&lt; <span class="stringliteral">&quot; of boundary &quot;</span> &lt;&lt; nom_bord &lt;&lt; <span class="stringliteral">&quot; has &quot;</span>
<a name="l02110"></a>02110                            &lt;&lt; n &lt;&lt; <span class="stringliteral">&quot; neighbors.&quot;</span> &lt;&lt; finl;
<a name="l02111"></a>02111                       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l02112"></a>02112                     }
<a name="l02113"></a>02113                   <span class="keywordflow">if</span> (quel_cote == 0)
<a name="l02114"></a>02114                     elem0 = elems_voisins[0];
<a name="l02115"></a>02115                   <span class="keywordflow">else</span>
<a name="l02116"></a>02116                     elem1 = elems_voisins[0];
<a name="l02117"></a>02117                 }
<a name="l02118"></a>02118               element_oppose[elem0] = elem1;
<a name="l02119"></a>02119               element_oppose[elem1] = elem0;
<a name="l02120"></a>02120             }
<a name="l02121"></a>02121 <span class="comment">// Deuxieme etape: parcourir les elements distants. Si un element distant est</span>
<a name="l02122"></a>02122 <span class="comment">// dans les elements jumeaux, ajouter l&#39;autre jumeau dans les elements distants</span>
<a name="l02123"></a>02123           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_joint = 0; i_joint &lt; nb_joints; i_joint++)
<a name="l02124"></a>02124             {
<a name="l02125"></a>02125               <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; elements_distants = zone.<a class="code" href="classZone.html#acec4c61032df8b55a95f9e7197ef6e3c" title="Renvoie le i-ieme joint de la zone&lt;br&gt;(version const)">joint</a>(i_joint).<a class="code" href="classJoint.html#aa1c4d729a3017082d26907d82ad1d7de" title="Renvoie les informations de joint pour un type d&#39;item geometrique donne, pour remplissage des structu...">set_joint_item</a>(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926ae32de3a01fdb3ad6c506b8058a7f6173">Joint::ELEMENT</a>).<a class="code" href="classJoint__Items.html#a13add264f4ad36ef4bddbfc1b7bdb817" title="Renvoie le tableau items_distants_ pour le remplir Voir Scatter::calculer_espace_distant, Scatter::calculer_espace_distant_faces_frontieres, Scatter::calculer_espace_distant_elements.">set_items_distants</a>();
<a name="l02126"></a>02126               <span class="keywordtype">int</span> n = elements_distants.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l02127"></a>02127 <span class="comment">// Marquer les elements distants existants:</span>
<a name="l02128"></a>02128               <span class="keywordtype">int</span> i;
<a name="l02129"></a>02129               <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)
<a name="l02130"></a>02130                 {
<a name="l02131"></a>02131                   <span class="keyword">const</span> <span class="keywordtype">int</span> elem = elements_distants[i];
<a name="l02132"></a>02132                   marqueurs_elements_distants.<a class="code" href="classArrOfBit.html#a5c339cfd9dea141737e127131e52aaae" title="Met le bit e a 1.">setbit</a>(elem);
<a name="l02133"></a>02133                 }
<a name="l02134"></a>02134               elements_distants.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l02135"></a>02135               <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)
<a name="l02136"></a>02136                 {
<a name="l02137"></a>02137                   <span class="keyword">const</span> <span class="keywordtype">int</span> elem = elements_distants[i];
<a name="l02138"></a>02138                   <span class="keyword">const</span> <span class="keywordtype">int</span> elem_oppose = element_oppose[elem];
<a name="l02139"></a>02139                   <span class="keywordflow">if</span> (elem_oppose &gt;= 0 &amp;&amp; (!marqueurs_elements_distants.<a class="code" href="classArrOfBit.html#a68b08edd2eebc91e7bd7d34ec81f6cd2" title="Renvoie la valeur du bit e, puis met le bit e a 1.">testsetbit</a>(elem_oppose)))
<a name="l02140"></a>02140                     {
<a name="l02141"></a>02141                       elements_distants.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(elem_oppose);
<a name="l02142"></a>02142                       nb_elements_ajoutes++;
<a name="l02143"></a>02143                     }
<a name="l02144"></a>02144                 }
<a name="l02145"></a>02145 <span class="comment">// Remettre a zero le tableau de marqueurs:</span>
<a name="l02146"></a>02146               n = elements_distants.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l02147"></a>02147               <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)
<a name="l02148"></a>02148                 {
<a name="l02149"></a>02149                   <span class="keyword">const</span> <span class="keywordtype">int</span> elem = elements_distants[i];
<a name="l02150"></a>02150                   marqueurs_elements_distants.<a class="code" href="classArrOfBit.html#ae92cc39c87cbf48111042b36e3641920" title="Met le bit e a 0.">clearbit</a>(elem);
<a name="l02151"></a>02151                 }
<a name="l02152"></a>02152             }
<a name="l02153"></a>02153         }
<a name="l02154"></a>02154 
<a name="l02155"></a>02155     }
<a name="l02156"></a>02156   <span class="keywordflow">while</span> (nb_elements_ajoutes &gt; 0);
<a name="l02157"></a>02157 <span class="comment">// Dernier tri des elements distants dans l&#39;ordre croissant</span>
<a name="l02158"></a>02158   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_joint = 0; i_joint &lt; nb_joints; i_joint++)
<a name="l02159"></a>02159     {
<a name="l02160"></a>02160       <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; elements_distants = zone.<a class="code" href="classZone.html#acec4c61032df8b55a95f9e7197ef6e3c" title="Renvoie le i-ieme joint de la zone&lt;br&gt;(version const)">joint</a>(i_joint).<a class="code" href="classJoint.html#aa1c4d729a3017082d26907d82ad1d7de" title="Renvoie les informations de joint pour un type d&#39;item geometrique donne, pour remplissage des structu...">set_joint_item</a>(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926ae32de3a01fdb3ad6c506b8058a7f6173">Joint::ELEMENT</a>).<a class="code" href="classJoint__Items.html#a13add264f4ad36ef4bddbfc1b7bdb817" title="Renvoie le tableau items_distants_ pour le remplir Voir Scatter::calculer_espace_distant, Scatter::calculer_espace_distant_faces_frontieres, Scatter::calculer_espace_distant_elements.">set_items_distants</a>();
<a name="l02161"></a>02161       elements_distants.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(0);
<a name="l02162"></a>02162       elements_distants.<a class="code" href="classArrOfInt.html#abb0f48cf5a4be4b70edcc90baaebd521" title="Tri des valeurs du tableau dans l&#39;ordre croissant. La fonction utilisee est qsort de stdlib (elle est...">ordonne_array</a>();
<a name="l02163"></a>02163     }
<a name="l02164"></a>02164 }
<a name="l02165"></a>02165 
<a name="l02166"></a>02166 <span class="comment">//</span>
<a name="l02167"></a>02167 <span class="comment">//</span>
<a name="l02168"></a>02168 <span class="comment">//</span>
<a name="l02169"></a>02169 <span class="comment">//</span>
<a name="l02170"></a>02170 <span class="comment">//</span>
<a name="l02171"></a>02171 <span class="comment">//</span>
<a name="l02172"></a>02172 <span class="comment">//</span>
<a name="l02173"></a>02173 <span class="comment">//</span>
<a name="l02174"></a>02174 <span class="comment">//</span>
<a name="l02175"></a>02175 <span class="comment">//</span>
<a name="l02176"></a>02176 <span class="comment">//</span>
<a name="l02177"></a>02177 <span class="comment">//</span>
<a name="l02178"></a>02178 <span class="comment">//</span>
<a name="l02179"></a>02179 <span class="comment">//</span>
<a name="l02180"></a>02180 <span class="comment">//</span>
<a name="l02181"></a>02181 <span class="comment">//</span>
<a name="l02182"></a>02182 <span class="comment">//</span><span class="comment"></span>
<a name="l02183"></a>02183 <span class="comment">//! Remplissage du tableau &quot;espace_distant()&quot; des elements dans les joints.&lt;br&gt;C&#39;est ici qu&#39;on determine les elements de joint en fonction de l&#39;epaisseur de joint.&lt;br&gt;Le tableau espace_distant contient les&lt;br&gt;indices locaux des elements distants (a envoyer aux processeurs voisins)&lt;br&gt;Pour un joint d&#39;epaisseur 1, ce sont tous les elements voisins d&#39;un&lt;br&gt;sommet de joint (sommet sur un face de joint ou sommet isole).&lt;br&gt;Pour un joint d&#39;epaisseur n&gt;1, ce sont tous les elements voisins d&#39;un&lt;br&gt;sommet d&#39;un element du joint d&#39;epaisseur n-1.&lt;br&gt;Le voisinage s&#39;entend sur le domaine global (toutes zones confondues)&lt;br&gt;Historique: premiere version B.Mathieu le 16/01/2007.&lt;br&gt;Il existe une methode qui determine les elements distants au moment du decoupage&lt;br&gt;(DomaineCutter::construire_elements_distants_ssdom).&lt;br&gt;La methode ci-dessous a ete validee par comparaison avec la methode du decoupeur.&lt;br&gt;Les sorties ont ete verifiees pour des epaisseurs jusqu&#39;a 5 sur des maillages tetra.&lt;br&gt;La difficulte de l&#39;algorithme est d&#39;obtenir les elements virtuels d&#39;epaisseur &gt; 1 qui se&lt;br&gt;trouvent sur des sous-domaines qui ne sont pas en contact direct avec le sous-domaine&lt;br&gt;local. Difficulte resolue par l&#39;algorithme ci-dessous.</span>
<a name="l02184"></a><a class="code" href="classScatter.html#a589c34e38a91b69c2e4b43c77bf2bd9d">02184</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classScatter.html#a589c34e38a91b69c2e4b43c77bf2bd9d" title="Remplissage du tableau &quot;espace_distant()&quot; des elements dans les joints. C&#39;est ici qu&#39;on determine l...">Scatter::calculer_espace_distant_elements</a>(<a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom)
<a name="l02185"></a>02185 {
<a name="l02186"></a>02186   <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp;        zone         = dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0);
<a name="l02187"></a>02187   <span class="keyword">const</span> <span class="keywordtype">int</span> nbjoints    = zone.<a class="code" href="classZone.html#ab096afb61e89705709a4ae6d3576a644" title="Renvoie le nombre de joints de la zone.">nb_joints</a>();
<a name="l02188"></a>02188   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_som_elem  = zone.<a class="code" href="classZone.html#ae0b34a93b9ae8146df2d1884157afe9f" title="Renvoie le nombre de sommets des elements geometriques constituants la zone. Tous les elements de la ...">nb_som_elem</a>();
<a name="l02189"></a>02189   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; les_elems    = zone.<a class="code" href="classZone.html#ac115e8342be89afb882b7b61cc343267" title="Renvoie le tableau des sommets des elements.">les_elems</a>();
<a name="l02190"></a>02190   <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">nproc</a>        = <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l02191"></a>02191 <span class="comment">// PL on doit avoir la meme epaisseur_joint sur chaque processeur pour l&#39;algorithme suivant</span>
<a name="l02192"></a>02192 <span class="comment">// utilisant un echange de donnees avec schema_comm.begin_comm() schema_comm.end_comm()</span>
<a name="l02193"></a>02193 <span class="comment">// sinon il y&#39;a un blocage en mode debug a cause de la sortie de la ligne 1866 (voir cas Quasi_Comp_Coupl_Incomp)</span>
<a name="l02194"></a>02194 <span class="comment">// const int epaisseur_joint = (nb_joints &gt; 0) ? zone.joint(0).epaisseur() : 1;</span>
<a name="l02195"></a>02195   <span class="keyword">const</span> <span class="keywordtype">int</span> epaisseur_joint = (int) <a class="code" href="classProcess.html#a1e9d9f9899b71927cfafae14c7bd048d" title="Calcule le max de x sur tous les processeurs du groupe courant. Remarques : Cette methode doit etre a...">mp_max</a>((nbjoints &gt; 0) ? zone.<a class="code" href="classZone.html#acec4c61032df8b55a95f9e7197ef6e3c" title="Renvoie le i-ieme joint de la zone&lt;br&gt;(version const)">joint</a>(0).<a class="code" href="classJoint.html#a67445a0294ff0e77d2d990ba0f493a17" title="Renvoie l&#39;epaisseur du joint.">epaisseur</a>() : 1);
<a name="l02196"></a>02196 
<a name="l02197"></a>02197   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l02198"></a>02198     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Calculation of remote space of elements : thickness &quot;</span> &lt;&lt; epaisseur_joint &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l02199"></a>02199 
<a name="l02200"></a>02200 <span class="comment">// L&#39;algorithme repose sur la construction progressive du tableau &quot;liste_sommets&quot;.</span>
<a name="l02201"></a>02201 <span class="comment">// liste_sommets(pe) contient a un instant donne la liste des sommets possedes par me()</span>
<a name="l02202"></a>02202 <span class="comment">// dont le &quot;pe&quot; veut connaitre les elements voisins.</span>
<a name="l02203"></a>02203 <span class="comment">// Chaque pe commence par reclamer ses elements voisins directs, c&#39;est a dire les elements</span>
<a name="l02204"></a>02204 <span class="comment">// voisins des sommets de joint. On sait qu&#39;il voudra ensuite les elements voisins des elements</span>
<a name="l02205"></a>02205 <span class="comment">// ainsi trouves, donc on ajoutera aux listes les sommets des elements distants trouves</span>
<a name="l02206"></a>02206 <span class="comment">// a l&#39;iteration precedente.</span>
<a name="l02207"></a>02207   <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>) liste_sommets(nproc);
<a name="l02208"></a>02208 
<a name="l02209"></a>02209 <span class="comment">// Pour chaque processeur, la liste des elements locaux qu&#39;il faut lui envoyer</span>
<a name="l02210"></a>02210   <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>) elements_distants(nproc);
<a name="l02211"></a>02211   {
<a name="l02212"></a>02212 <span class="comment">// smart_resize car on va faire append_array sur ces tableaux</span>
<a name="l02213"></a>02213     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">nproc</a>; i++)
<a name="l02214"></a>02214       {
<a name="l02215"></a>02215         liste_sommets[i].set_smart_resize(1);
<a name="l02216"></a>02216         elements_distants[i].set_smart_resize(1);
<a name="l02217"></a>02217       }
<a name="l02218"></a>02218   }
<a name="l02219"></a>02219 
<a name="l02220"></a>02220   <a class="code" href="classStatic__Int__Lists.html" title="Cette classe permet de stocker des listes d&#39;entiers accessibles en temps constant. La taille des listes ne peut pas changer sans perdre le contenu (ce sont des listes statiques). Exemple: Static_Int_List l; ArrOfInt tailles(3); tailles[0] = 2; tailles[1] = 3; tailles[2] = 0; // On reserve la memoire pour trois listes de taille 2, 3 et 0: l.set_list_sizes(tailles); // On affecte une valeur au deuxieme element de la premiere liste: l.set_value(0,1,765); // Affiche la valeur Cout &lt;&lt; l(0,1);.">Static_Int_Lists</a> som_elem;
<a name="l02221"></a>02221   {
<a name="l02222"></a>02222     <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l02223"></a>02223       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Nodes-elements connectivity ...&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l02224"></a>02224     <span class="keyword">const</span> <span class="keywordtype">int</span> nb_sommets = dom.<a class="code" href="classDomaine.html#abc4abc8b8db5bebeb161fae4162a89ce" title="Renvoie le nombre de sommets.">nb_som</a>();
<a name="l02225"></a>02225     <a class="code" href="Connectivite__som__elem_8cpp.html#a82161461a228e43ae236c31101ff3ce6" title="construction de la structure som_elem pour la zone donnee On cree pour chaque sommet i la liste des e...">construire_connectivite_som_elem</a>(nb_sommets,
<a name="l02226"></a>02226                                      les_elems,
<a name="l02227"></a>02227                                      som_elem,
<a name="l02228"></a>02228                                      0 <span class="comment">/* ne pas inclure les sommets virtuels */</span>);
<a name="l02229"></a>02229   }
<a name="l02230"></a>02230 
<a name="l02231"></a>02231   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> liste_pe_voisins(nbjoints);
<a name="l02232"></a>02232 
<a name="l02233"></a>02233 <span class="comment">// Initialisation de liste_pe_voisins et</span>
<a name="l02234"></a>02234 <span class="comment">// initialisation de la liste de sommets: chaque processeur requiert tous les elements</span>
<a name="l02235"></a>02235 <span class="comment">// voisins de ses sommets de joint. Le processeur local sait que pour l&#39;epaisseur 1,</span>
<a name="l02236"></a>02236 <span class="comment">// chaque processeur voisin par un joint veut connaitre tous les elements voisins</span>
<a name="l02237"></a>02237 <span class="comment">// des sommets de joint. Donc on met dans liste_sommets(pe) les sommets de joint avec ce pe,</span>
<a name="l02238"></a>02238 <span class="comment">// se sorte a lui envoyer les elements locaux voisins de ces sommets.</span>
<a name="l02239"></a>02239   {
<a name="l02240"></a>02240     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_joint = 0; i_joint &lt; nbjoints; i_joint++)
<a name="l02241"></a>02241       {
<a name="l02242"></a>02242         <span class="keyword">const</span> <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp; joint = zone.<a class="code" href="classZone.html#acec4c61032df8b55a95f9e7197ef6e3c" title="Renvoie le i-ieme joint de la zone&lt;br&gt;(version const)">joint</a>(i_joint);
<a name="l02243"></a>02243         <span class="keyword">const</span> <span class="keywordtype">int</span> pe = joint.<a class="code" href="classJoint.html#a0952bc5c7805434ccd8cd5c9b01e3747" title="Renvoie PEvoisin (numero de la zone voisine)">PEvoisin</a>();
<a name="l02244"></a>02244         liste_pe_voisins[i_joint] = pe;
<a name="l02245"></a>02245         <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; sommets_joint = joint.<a class="code" href="classJoint.html#a3f49fb1150967b436a115a7373ab27a0" title="Renvoie les informations de joint pour le type demande.">joint_item</a>(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>).<a class="code" href="classJoint__Items.html#a435fb1629f6dafb089605913517e73c4" title="Voir items_communs_.">items_communs</a>();
<a name="l02246"></a>02246         liste_sommets[pe] = sommets_joint;
<a name="l02247"></a>02247       }
<a name="l02248"></a>02248   }
<a name="l02249"></a>02249 
<a name="l02250"></a>02250 <span class="comment">// On va avoir besoin d&#39;un schema de communication ou chaque processeur envoie et recoit</span>
<a name="l02251"></a>02251 <span class="comment">// des donnees a ses voisins directs (voisins par un sommet)</span>
<a name="l02252"></a>02252   <a class="code" href="classSchema__Comm.html">Schema_Comm</a> schema_comm;
<a name="l02253"></a>02253   schema_comm.<a class="code" href="classSchema__Comm.html#ad11c9b47999c294c26ae4df8d2bbd57b" title="Definit la liste des processeurs a qui on va envoyer et de qui on va recevoir des donnees...">set_send_recv_pe_list</a>(liste_pe_voisins, liste_pe_voisins);
<a name="l02254"></a>02254 
<a name="l02255"></a>02255 <span class="comment">// On va avoir besoin d&#39;un acces rapide a la liste des processeurs qui partagent un</span>
<a name="l02256"></a>02256 <span class="comment">// sommet et a l&#39;indice de ce sommet sur ce processeur.</span>
<a name="l02257"></a>02257 <span class="comment">// Contenu de la structure:</span>
<a name="l02258"></a>02258 <span class="comment">// data_sommets_communs.get_list_size(sommet) = 2*le nombre de procs qui partagent le sommet</span>
<a name="l02259"></a>02259 <span class="comment">// data_sommets_communs(sommet, 2*i) = numero du pe voisin</span>
<a name="l02260"></a>02260 <span class="comment">// data_sommets_communs(sommet, 2*i+1) = indice du sommet sur ce pe.</span>
<a name="l02261"></a>02261   <a class="code" href="classStatic__Int__Lists.html" title="Cette classe permet de stocker des listes d&#39;entiers accessibles en temps constant. La taille des listes ne peut pas changer sans perdre le contenu (ce sont des listes statiques). Exemple: Static_Int_List l; ArrOfInt tailles(3); tailles[0] = 2; tailles[1] = 3; tailles[2] = 0; // On reserve la memoire pour trois listes de taille 2, 3 et 0: l.set_list_sizes(tailles); // On affecte une valeur au deuxieme element de la premiere liste: l.set_value(0,1,765); // Affiche la valeur Cout &lt;&lt; l(0,1);.">Static_Int_Lists</a> data_sommets_communs;
<a name="l02262"></a>02262 <span class="comment">// Remplissage : la structure n&#39;est utilisee que si l&#39;epaisseur de joint est &gt; 1</span>
<a name="l02263"></a>02263   <span class="keywordflow">if</span> (epaisseur_joint &gt; 1)
<a name="l02264"></a>02264     {
<a name="l02265"></a>02265       <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> count(dom.<a class="code" href="classDomaine.html#abc4abc8b8db5bebeb161fae4162a89ce" title="Renvoie le nombre de sommets.">nb_som</a>());
<a name="l02266"></a>02266 <span class="comment">// Etape 1 : avec combien de processeurs chaque sommet est-il partage ?</span>
<a name="l02267"></a>02267       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ijoint = 0; ijoint &lt; nbjoints; ijoint++)
<a name="l02268"></a>02268         {
<a name="l02269"></a>02269           <span class="keyword">const</span> <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp; joint = zone.<a class="code" href="classZone.html#acec4c61032df8b55a95f9e7197ef6e3c" title="Renvoie le i-ieme joint de la zone&lt;br&gt;(version const)">joint</a>(ijoint);
<a name="l02270"></a>02270           <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; sommets_joint = joint.<a class="code" href="classJoint.html#a3f49fb1150967b436a115a7373ab27a0" title="Renvoie les informations de joint pour le type demande.">joint_item</a>(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>).<a class="code" href="classJoint__Items.html#a435fb1629f6dafb089605913517e73c4" title="Voir items_communs_.">items_communs</a>();
<a name="l02271"></a>02271           <span class="keyword">const</span> <span class="keywordtype">int</span> n = sommets_joint.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l02272"></a>02272           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
<a name="l02273"></a>02273             {
<a name="l02274"></a>02274               <span class="keyword">const</span> <span class="keywordtype">int</span> som = sommets_joint[i];
<a name="l02275"></a>02275               count[som] += 2; <span class="comment">//!&lt; On stocke 2 entiers par sommets commun</span>
<a name="l02276"></a>02276 <span class="comment"></span>            }
<a name="l02277"></a>02277         }
<a name="l02278"></a>02278       data_sommets_communs.<a class="code" href="classStatic__Int__Lists.html#a60da63cb1970f5b87d1e1fdf6d65dcb2" title="detruit les listes existantes et en cree de nouvelles. On cree autant de listes que d&#39;elements dans l...">set_list_sizes</a>(count);
<a name="l02279"></a>02279       count = 0;
<a name="l02280"></a>02280 <span class="comment">// Etape 2 : remplissage de la structure:</span>
<a name="l02281"></a>02281       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ijoint = 0; ijoint &lt; nbjoints; ijoint++)
<a name="l02282"></a>02282         {
<a name="l02283"></a>02283           <span class="keyword">const</span> <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp; joint = zone.<a class="code" href="classZone.html#acec4c61032df8b55a95f9e7197ef6e3c" title="Renvoie le i-ieme joint de la zone&lt;br&gt;(version const)">joint</a>(ijoint);
<a name="l02284"></a>02284           <span class="keyword">const</span> <span class="keywordtype">int</span> pe = joint.<a class="code" href="classJoint.html#a0952bc5c7805434ccd8cd5c9b01e3747" title="Renvoie PEvoisin (numero de la zone voisine)">PEvoisin</a>();
<a name="l02285"></a>02285           <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; renum_sommets = joint.<a class="code" href="classJoint.html#a3f49fb1150967b436a115a7373ab27a0" title="Renvoie les informations de joint pour le type demande.">joint_item</a>(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>).<a class="code" href="classJoint__Items.html#a11b6064b7fd16c1366c4c1e3a88ac2a5" title="Voir renum_items_communs_.">renum_items_communs</a>();
<a name="l02286"></a>02286           <span class="keyword">const</span> <span class="keywordtype">int</span> n = renum_sommets.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l02287"></a>02287           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
<a name="l02288"></a>02288             {
<a name="l02289"></a>02289 <span class="comment">// Indice du sommet partage sur le pe voisin</span>
<a name="l02290"></a>02290               <span class="keyword">const</span> <span class="keywordtype">int</span> i_sommet_distant = renum_sommets(i, 0);
<a name="l02291"></a>02291 <span class="comment">// Indice du sommet partage sur ma zone locale</span>
<a name="l02292"></a>02292               <span class="keyword">const</span> <span class="keywordtype">int</span> i_sommet_local = renum_sommets(i, 1);
<a name="l02293"></a>02293               <span class="keyword">const</span> <span class="keywordtype">int</span> j = count[i_sommet_local]++;
<a name="l02294"></a>02294               data_sommets_communs.<a class="code" href="classStatic__Int__Lists.html#ab56f42945e3057185cc1086e1cbc1bbb" title="affecte la &quot;valeur&quot; au j-ieme element de la i-ieme liste avec 0 &lt;= i &lt; get_nb_lists() et 0 &lt;= j &lt; get...">set_value</a>(i_sommet_local, j*2, pe);
<a name="l02295"></a>02295               data_sommets_communs.<a class="code" href="classStatic__Int__Lists.html#ab56f42945e3057185cc1086e1cbc1bbb" title="affecte la &quot;valeur&quot; au j-ieme element de la i-ieme liste avec 0 &lt;= i &lt; get_nb_lists() et 0 &lt;= j &lt; get...">set_value</a>(i_sommet_local, j*2+1, i_sommet_distant);
<a name="l02296"></a>02296             }
<a name="l02297"></a>02297         }
<a name="l02298"></a>02298     }
<a name="l02299"></a>02299 
<a name="l02300"></a>02300 <span class="comment">// Boucle sur l&#39;epaisseur de joint:</span>
<a name="l02301"></a>02301 <span class="comment">// A l&#39;entree de la boucle, on suppose que liste_sommets contient, pour chaque processeur</span>
<a name="l02302"></a>02302 <span class="comment">// qui requiert des elements virtuels, la liste des sommets de me() dont il veut les voisins.</span>
<a name="l02303"></a>02303   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> epaisseur = 1; ; epaisseur++)
<a name="l02304"></a>02304     {
<a name="l02305"></a>02305       <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l02306"></a>02306         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Calculation of the thickness &quot;</span> &lt;&lt; epaisseur &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l02307"></a>02307 
<a name="l02308"></a>02308 <span class="comment">// Pour chaque liste de sommets, mettre dans les elements distants du meme processeur</span>
<a name="l02309"></a>02309 <span class="comment">// les elements voisins des sommets de la liste.</span>
<a name="l02310"></a>02310       <span class="keywordtype">int</span> pe;
<a name="l02311"></a>02311       <span class="keywordflow">for</span> (pe = 0; pe &lt; <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">nproc</a>; pe++)
<a name="l02312"></a>02312         {
<a name="l02313"></a>02313           <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; elems_dist = elements_distants[pe];
<a name="l02314"></a>02314           <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; sommets = liste_sommets[pe];
<a name="l02315"></a>02315           elems_dist.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(0);
<a name="l02316"></a>02316           <span class="keyword">const</span> <span class="keywordtype">int</span> nb_som_liste = sommets.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l02317"></a>02317           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> isom = 0; isom &lt; nb_som_liste; isom++)
<a name="l02318"></a>02318             {
<a name="l02319"></a>02319               <span class="keyword">const</span> <span class="keywordtype">int</span> som = sommets[isom];
<a name="l02320"></a>02320               <span class="keywordflow">if</span> (som&lt;0)
<a name="l02321"></a>02321                 <span class="keywordflow">continue</span>;
<a name="l02322"></a>02322               <span class="keyword">const</span> <span class="keywordtype">int</span> nb_elem_som = som_elem.<a class="code" href="classStatic__Int__Lists.html#adbf6903737c3c30bf87e05b29f5a5b56" title="renvoie le nombre d&#39;elements de la liste i">get_list_size</a>(som);
<a name="l02323"></a>02323               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ielem = 0; ielem &lt; nb_elem_som; ielem++)
<a name="l02324"></a>02324                 {
<a name="l02325"></a>02325                   <span class="keyword">const</span> <span class="keywordtype">int</span> elem = som_elem(som, ielem);
<a name="l02326"></a>02326                   elems_dist.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(elem);
<a name="l02327"></a>02327                 }
<a name="l02328"></a>02328             }
<a name="l02329"></a>02329           <a class="code" href="Scatter_8cpp.html#a23c4d19dc90caae2323f04de90621709" title="Methode outil pour retirer les doublons dans un tableau.">array_trier_retirer_doublons</a>(elems_dist);
<a name="l02330"></a>02330         }
<a name="l02331"></a>02331 
<a name="l02332"></a>02332 <span class="comment">// La suite est la mise a jour de liste_sommets pour l&#39;iteration suivante.</span>
<a name="l02333"></a>02333 <span class="comment">// Inutile de le faire si on est a la derniere iteration:</span>
<a name="l02334"></a>02334       <span class="keywordflow">if</span> (epaisseur == epaisseur_joint)
<a name="l02335"></a>02335         <span class="keywordflow">break</span>;
<a name="l02336"></a>02336 
<a name="l02337"></a>02337 <span class="comment">// Mettre dans les listes de sommets les sommets des elements distants trouves</span>
<a name="l02338"></a>02338       <span class="keywordflow">for</span> (pe = 0; pe &lt; <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">nproc</a>; pe++)
<a name="l02339"></a>02339         {
<a name="l02340"></a>02340           <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; sommets = liste_sommets[pe];
<a name="l02341"></a>02341           <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; elems_dist = elements_distants[pe];
<a name="l02342"></a>02342           sommets.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(0);
<a name="l02343"></a>02343           <span class="keyword">const</span> <span class="keywordtype">int</span> nb_elems_dist = elems_dist.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l02344"></a>02344           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ielem = 0; ielem &lt; nb_elems_dist; ielem++)
<a name="l02345"></a>02345             {
<a name="l02346"></a>02346               <span class="keyword">const</span> <span class="keywordtype">int</span> elem = elems_dist[ielem];
<a name="l02347"></a>02347               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> isom = 0; isom &lt; nb_som_elem; isom++)
<a name="l02348"></a>02348                 {
<a name="l02349"></a>02349                   <span class="keyword">const</span> <span class="keywordtype">int</span> som = les_elems(elem, isom);
<a name="l02350"></a>02350                   sommets.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(som);
<a name="l02351"></a>02351                 }
<a name="l02352"></a>02352             }
<a name="l02353"></a>02353           <a class="code" href="Scatter_8cpp.html#a23c4d19dc90caae2323f04de90621709" title="Methode outil pour retirer les doublons dans un tableau.">array_trier_retirer_doublons</a>(sommets);
<a name="l02354"></a>02354         }
<a name="l02355"></a>02355 <span class="comment">// Parcourir les listes de sommets. Pour chaque sommet, s&#39;il est de joint,</span>
<a name="l02356"></a>02356 <span class="comment">// envoyer aux processeurs possedant ce sommet une requete &quot;le processeur i</span>
<a name="l02357"></a>02357 <span class="comment">// veut tous les voisins de ce sommet&quot;.</span>
<a name="l02358"></a>02358 <span class="comment">// Ne pas envoyer la requete au processeur &quot;i&quot; pour la liste &quot;i&quot;: il connait</span>
<a name="l02359"></a>02359 <span class="comment">// deja ses propres elements !</span>
<a name="l02360"></a>02360       schema_comm.<a class="code" href="classSchema__Comm.html#ac617b53de22748cdd9fa30a0cfd0f4a8" title="Statut passe a WRITING Autorise si status_ == WRITING:">begin_comm</a>();
<a name="l02361"></a>02361 <span class="comment">// Premiere phase de communication: empiler les donnees a envoyer dans des buffers</span>
<a name="l02362"></a>02362       <span class="keywordflow">for</span> (pe = 0; pe &lt; <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">nproc</a>; pe++)
<a name="l02363"></a>02363         {
<a name="l02364"></a>02364           <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; sommets = liste_sommets[pe];
<a name="l02365"></a>02365           <span class="keyword">const</span> <span class="keywordtype">int</span> nb_som_liste = sommets.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l02366"></a>02366           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> isom = 0; isom &lt; nb_som_liste; isom++)
<a name="l02367"></a>02367             {
<a name="l02368"></a>02368               <span class="keyword">const</span> <span class="keywordtype">int</span> i_sommet_local = sommets[isom];
<a name="l02369"></a>02369               <span class="keywordflow">if</span> (i_sommet_local&lt;0)
<a name="l02370"></a>02370                 <span class="keywordflow">continue</span>;
<a name="l02371"></a>02371               <span class="keyword">const</span> <span class="keywordtype">int</span> nb_pe_voisins = data_sommets_communs.<a class="code" href="classStatic__Int__Lists.html#adbf6903737c3c30bf87e05b29f5a5b56" title="renvoie le nombre d&#39;elements de la liste i">get_list_size</a>(i_sommet_local) / 2;
<a name="l02372"></a>02372               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_pe_voisins; i++)
<a name="l02373"></a>02373                 {
<a name="l02374"></a>02374                   <span class="keyword">const</span> <span class="keywordtype">int</span> pe_voisin = data_sommets_communs(i_sommet_local, i*2);
<a name="l02375"></a>02375 <span class="comment">// Indice du sommet sur le processeur voisin.</span>
<a name="l02376"></a>02376                   <span class="keyword">const</span> <span class="keywordtype">int</span> i_sommet_distant = data_sommets_communs(i_sommet_local, i*2+1);
<a name="l02377"></a>02377                   <span class="keywordflow">if</span> (pe_voisin != pe)
<a name="l02378"></a>02378                     {
<a name="l02379"></a>02379 <span class="comment">// Envoyer au processeur &quot;pe_voisin&quot; le message : &quot;le processeur PE a besoin</span>
<a name="l02380"></a>02380 <span class="comment">// des elements voisins du sommet i_sommet_distant&quot;</span>
<a name="l02381"></a>02381                       schema_comm.<a class="code" href="classSchema__Comm.html#a6c771eae3b46250ae0d2f0126a7d8065" title="renvoie le buffer correspondant au processeur num_PE pour y entasser des donnees a envoyer...">send_buffer</a>(pe_voisin) &lt;&lt; pe &lt;&lt; i_sommet_distant;
<a name="l02382"></a>02382                     }
<a name="l02383"></a>02383                 }
<a name="l02384"></a>02384             }
<a name="l02385"></a>02385         }
<a name="l02386"></a>02386       schema_comm.<a class="code" href="classSchema__Comm.html#abca0e8ac6c2b742d26f3cfaee0690c72" title="Statut passe a EXCHANGED.">echange_taille_et_messages</a>();
<a name="l02387"></a>02387       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_pevoisin = 0; i_pevoisin &lt; nbjoints; i_pevoisin++)
<a name="l02388"></a>02388         {
<a name="l02389"></a>02389           <span class="keyword">const</span> <span class="keywordtype">int</span> pe_voisin = liste_pe_voisins[i_pevoisin];
<a name="l02390"></a>02390           <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; buffer = schema_comm.<a class="code" href="classSchema__Comm.html#a0c056eb81ab8fd513912b336b4d13a1a" title="renvoie le buffer correspondant au processeur num_PE pour y lire les donnees recues. Le schema doit etre dans l&#39;etat EXCHANGED.">recv_buffer</a>(pe_voisin);
<a name="l02391"></a>02391           <span class="keywordflow">for</span> (;;)
<a name="l02392"></a>02392             {
<a name="l02393"></a>02393               <span class="keywordtype">int</span> pe2, sommet;
<a name="l02394"></a>02394 <span class="comment">// On recupere le message &quot;le processeur PE a besoin des elements voisins de SOMMET&quot;.</span>
<a name="l02395"></a>02395               buffer &gt;&gt; pe2 &gt;&gt; sommet;
<a name="l02396"></a>02396               <span class="keywordflow">if</span> (buffer.<a class="code" href="classEntree.html#abcd397cb0b99fbe7c6f01047d8cec89c">eof</a>())
<a name="l02397"></a>02397                 <span class="keywordflow">break</span>;
<a name="l02398"></a>02398               liste_sommets[pe2].append_array(sommet);
<a name="l02399"></a>02399             }
<a name="l02400"></a>02400         }
<a name="l02401"></a>02401       schema_comm.<a class="code" href="classSchema__Comm.html#a73a981f88b6ffebc150fb46c5cce75d9" title="Statut passe a RESET Accesseurs:">end_comm</a>();
<a name="l02402"></a>02402 <span class="comment">// Supprimer les doublons dans les listes de sommets</span>
<a name="l02403"></a>02403       <span class="keywordflow">for</span> (pe = 0; pe &lt; <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">nproc</a>; pe++)
<a name="l02404"></a>02404         {
<a name="l02405"></a>02405           <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; sommets = liste_sommets[pe];
<a name="l02406"></a>02406           <a class="code" href="Scatter_8cpp.html#a23c4d19dc90caae2323f04de90621709" title="Methode outil pour retirer les doublons dans un tableau.">array_trier_retirer_doublons</a>(sommets);
<a name="l02407"></a>02407         }
<a name="l02408"></a>02408     }
<a name="l02409"></a>02409 
<a name="l02410"></a>02410 <span class="comment">// Creation des nouveaux joints si besoin, et stockage des elements distants dans les joints</span>
<a name="l02411"></a>02411   {
<a name="l02412"></a>02412     <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> voisins;
<a name="l02413"></a>02413     voisins.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l02414"></a>02414 
<a name="l02415"></a>02415     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> pe = 0; pe &lt; <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">nproc</a>; pe++)
<a name="l02416"></a>02416       <span class="keywordflow">if</span> (elements_distants[pe].size_array() &gt; 0)
<a name="l02417"></a>02417         voisins.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(pe);
<a name="l02418"></a>02418     <a class="code" href="classScatter.html#a472e9375c5a64518e7b50542d2209995" title="Ajoute des joints avec tous les pe de pe_voisins. Pour que l&#39;ensemble des joints soit symetrique...">ajouter_joints</a>(zone, voisins);
<a name="l02419"></a>02419 
<a name="l02420"></a>02420 <span class="preprocessor">#ifdef CHECK_ALGO_ESPACE_VIRTUEL</span>
<a name="l02421"></a>02421 <span class="preprocessor"></span><span class="comment">// On n&#39;utilise pas les espaces virtuels calcules ci-dessus, on se</span>
<a name="l02422"></a>02422 <span class="comment">// contente de les comparer aux espaces virtuels calcules lors du decoupage</span>
<a name="l02423"></a>02423 <span class="comment">// par l&#39;algorithme sequentiel.</span>
<a name="l02424"></a>02424 <span class="comment">// Pour l&#39;instant, l&#39;algorithme parallele a l&#39;air de fonctionner sans probleme</span>
<a name="l02425"></a>02425 <span class="comment">// je desactive ce test. (Benoit Mathieu)</span>
<a name="l02426"></a>02426     <span class="keywordtype">int</span> <a class="code" href="Solv__GCP__NS_8cpp.html#ab6aa1075b965c7713d8db20dd3a8e09b">erreur</a> = 0;
<a name="l02427"></a>02427     <span class="keyword">const</span> <span class="keywordtype">int</span> nbjoints = zone.nbjoints();
<a name="l02428"></a>02428     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nbjoints; i++)
<a name="l02429"></a>02429       {
<a name="l02430"></a>02430         <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp; joint = zone.<a class="code" href="classZone.html#acec4c61032df8b55a95f9e7197ef6e3c" title="Renvoie le i-ieme joint de la zone&lt;br&gt;(version const)">joint</a>(i);
<a name="l02431"></a>02431         <span class="keyword">const</span> <span class="keywordtype">int</span> pe = joint.<a class="code" href="classJoint.html#a0952bc5c7805434ccd8cd5c9b01e3747" title="Renvoie PEvoisin (numero de la zone voisine)">PEvoisin</a>();
<a name="l02432"></a>02432         <span class="keywordflow">if</span> (!(joint.<a class="code" href="classJoint.html#a3f49fb1150967b436a115a7373ab27a0" title="Renvoie les informations de joint pour le type demande.">joint_item</a>(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926ae32de3a01fdb3ad6c506b8058a7f6173">Joint::ELEMENT</a>).<a class="code" href="classJoint__Items.html#ae51b330de79fcaae9c88166e3eee7cb8" title="Voir items_distants_.">items_distants</a>() == elements_distants[pe]))
<a name="l02433"></a>02433           {
<a name="l02434"></a>02434             <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Scatter, PE &quot;</span> &lt;&lt; <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>() &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l02435"></a>02435             <a class="code" href="classProcess.html#a57e0f54b11e6eaadbea224fa904b18dd" title="Renvoie un objet statique de type Sortie qui sert de journal d&#39;evenements. Si message_level &lt;= verbose...">Process::Journal</a>() &lt;&lt; <span class="stringliteral">&quot;Error scatter, remote elements pe &quot;</span> &lt;&lt; pe &lt;&lt; finl
<a name="l02436"></a>02436                                &lt;&lt; <span class="stringliteral">&quot; Splitting algorithm: &quot;</span> &lt;&lt; joint.<a class="code" href="classJoint.html#a3f49fb1150967b436a115a7373ab27a0" title="Renvoie les informations de joint pour le type demande.">joint_item</a>(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926ae32de3a01fdb3ad6c506b8058a7f6173">Joint::ELEMENT</a>).<a class="code" href="classJoint__Items.html#ae51b330de79fcaae9c88166e3eee7cb8" title="Voir items_distants_.">items_distants</a>()
<a name="l02437"></a>02437                                &lt;&lt; <span class="stringliteral">&quot; Scatter algorithm  : &quot;</span> &lt;&lt; elements_distants[pe] &lt;&lt; finl;
<a name="l02438"></a>02438 
<a name="l02439"></a>02439             erreur = 1;
<a name="l02440"></a>02440           }
<a name="l02441"></a>02441       }
<a name="l02442"></a>02442     <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">mp_sum</a>(erreur))
<a name="l02443"></a>02443       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l02444"></a>02444 <span class="preprocessor">#else</span>
<a name="l02445"></a>02445 <span class="preprocessor"></span><span class="comment">// Stockage du resultat</span>
<a name="l02446"></a>02446     <span class="keyword">const</span> <span class="keywordtype">int</span> nb_joints = zone.<a class="code" href="classZone.html#ab096afb61e89705709a4ae6d3576a644" title="Renvoie le nombre de joints de la zone.">nb_joints</a>();
<a name="l02447"></a>02447     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_joints; i++)
<a name="l02448"></a>02448       {
<a name="l02449"></a>02449         <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp; joint = zone.<a class="code" href="classZone.html#acec4c61032df8b55a95f9e7197ef6e3c" title="Renvoie le i-ieme joint de la zone&lt;br&gt;(version const)">joint</a>(i);
<a name="l02450"></a>02450         <span class="keyword">const</span> <span class="keywordtype">int</span> pe = joint.<a class="code" href="classJoint.html#a0952bc5c7805434ccd8cd5c9b01e3747" title="Renvoie PEvoisin (numero de la zone voisine)">PEvoisin</a>();
<a name="l02451"></a>02451         joint.<a class="code" href="classJoint.html#aa1c4d729a3017082d26907d82ad1d7de" title="Renvoie les informations de joint pour un type d&#39;item geometrique donne, pour remplissage des structu...">set_joint_item</a>(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926ae32de3a01fdb3ad6c506b8058a7f6173">Joint::ELEMENT</a>).<a class="code" href="classJoint__Items.html#a13add264f4ad36ef4bddbfc1b7bdb817" title="Renvoie le tableau items_distants_ pour le remplir Voir Scatter::calculer_espace_distant, Scatter::calculer_espace_distant_faces_frontieres, Scatter::calculer_espace_distant_elements.">set_items_distants</a>() = elements_distants[pe];
<a name="l02452"></a>02452       }
<a name="l02453"></a>02453 <span class="preprocessor">#endif</span>
<a name="l02454"></a>02454 <span class="preprocessor"></span>  }
<a name="l02455"></a>02455 }
<a name="l02456"></a>02456 
<a name="l02457"></a><a class="code" href="Scatter_8cpp.html#a09e112f8a32312a1675f7e33b94df122">02457</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="Scatter_8cpp.html#a09e112f8a32312a1675f7e33b94df122">fct_cmp_coord_dimension</a> = -1;
<a name="l02458"></a><a class="code" href="Scatter_8cpp.html#a81c1304205b09abc2acc284f8adc390c">02458</a> <span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code" href="Scatter_8cpp.html#a81c1304205b09abc2acc284f8adc390c">fct_cmp_coord_epsilon</a> = -1.;
<a name="l02459"></a>02459 
<a name="l02460"></a><a class="code" href="Scatter_8cpp.html#a06420c19a824af0906036ca04758d81c">02460</a> <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="arch_8h.html#a1caaf369d9c5f0817dbaa76b43b8d87b">True_int</a> <a class="code" href="Scatter_8cpp.html#a06420c19a824af0906036ca04758d81c">fct_cmp_coordonnees</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> * s1, <span class="keyword">const</span> <span class="keywordtype">double</span> *s2)
<a name="l02461"></a>02461 {
<a name="l02462"></a>02462   <span class="keyword">const</span> <span class="keywordtype">int</span> dim = <a class="code" href="Scatter_8cpp.html#a09e112f8a32312a1675f7e33b94df122">fct_cmp_coord_dimension</a>;
<a name="l02463"></a>02463   <span class="keyword">const</span> <span class="keywordtype">double</span> epsilon = <a class="code" href="Scatter_8cpp.html#a81c1304205b09abc2acc284f8adc390c">fct_cmp_coord_epsilon</a>;
<a name="l02464"></a>02464   assert(dim==2 || dim==3);
<a name="l02465"></a>02465   <span class="keywordflow">if</span> (s1[0] &lt; s2[0] - epsilon)
<a name="l02466"></a>02466     <span class="keywordflow">return</span> -1;
<a name="l02467"></a>02467   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s1[0] &gt; s2[0] + epsilon)
<a name="l02468"></a>02468     <span class="keywordflow">return</span> 1;
<a name="l02469"></a>02469   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s1[1] &lt; s2[1] - epsilon)
<a name="l02470"></a>02470     <span class="keywordflow">return</span> -1;
<a name="l02471"></a>02471   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s1[1] &gt; s2[1] + epsilon)
<a name="l02472"></a>02472     <span class="keywordflow">return</span> 1;
<a name="l02473"></a>02473   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dim&lt;3)
<a name="l02474"></a>02474     <span class="keywordflow">return</span> 0;
<a name="l02475"></a>02475   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s1[2] &lt; s2[2] - epsilon)
<a name="l02476"></a>02476     <span class="keywordflow">return</span> -1;
<a name="l02477"></a>02477   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s1[2] &gt; s2[2] + epsilon)
<a name="l02478"></a>02478     <span class="keywordflow">return</span> 1;
<a name="l02479"></a>02479   <span class="keywordflow">else</span>
<a name="l02480"></a>02480     <span class="keywordflow">return</span> 0;
<a name="l02481"></a>02481 }
<a name="l02482"></a>02482 
<a name="l02483"></a><a class="code" href="Scatter_8cpp.html#a107a2fbce3e368271c492cfcf7cfca10">02483</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> * <a class="code" href="Scatter_8cpp.html#a107a2fbce3e368271c492cfcf7cfca10">fct_cmp_coord_tableau</a> = 0;
<a name="l02484"></a>02484 <span class="comment">// Fonction de comparaison pour le tri d&#39;un tableau d&#39;indirection vers</span>
<a name="l02485"></a>02485 <span class="comment">// des coordonnees de sommets. Fonction appelee par qsort.</span>
<a name="l02486"></a>02486 <span class="comment">// ptr1 et ptr2 sont des adresses de deux entiers dans le tableau &quot;index&quot;</span>
<a name="l02487"></a>02487 <span class="comment">// Les coordonnees comparees sont dans le tableau *fct_cmp_coord_tableau</span>
<a name="l02488"></a><a class="code" href="Scatter_8cpp.html#a727b40392ca2280ef4b3f158a4225b48">02488</a> <span class="keyword">static</span> <a class="code" href="arch_8h.html#a1caaf369d9c5f0817dbaa76b43b8d87b">True_int</a> <a class="code" href="Scatter_8cpp.html#a727b40392ca2280ef4b3f158a4225b48">fct_cmp_index_coord</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> * ptr1, <span class="keyword">const</span> <span class="keywordtype">void</span> * ptr2)
<a name="l02489"></a>02489 {
<a name="l02490"></a>02490   <span class="keyword">const</span> <span class="keywordtype">int</span> i1 = *(<span class="keyword">const</span> <span class="keywordtype">int</span> *)ptr1;
<a name="l02491"></a>02491   <span class="keyword">const</span> <span class="keywordtype">int</span> i2 = *(<span class="keyword">const</span> <span class="keywordtype">int</span> *)ptr2;
<a name="l02492"></a>02492   <span class="keyword">const</span> <span class="keywordtype">double</span> * s1 = &amp; (*fct_cmp_coord_tableau)(i1,0);
<a name="l02493"></a>02493   <span class="keyword">const</span> <span class="keywordtype">double</span> * s2 = &amp; (*fct_cmp_coord_tableau)(i2,0);
<a name="l02494"></a>02494   <span class="keyword">const</span> <a class="code" href="arch_8h.html#a1caaf369d9c5f0817dbaa76b43b8d87b">True_int</a> resu = <a class="code" href="Scatter_8cpp.html#a06420c19a824af0906036ca04758d81c">fct_cmp_coordonnees</a>(s1, s2);
<a name="l02495"></a>02495   <span class="keywordflow">return</span> resu;
<a name="l02496"></a>02496 }
<a name="l02497"></a>02497 
<a name="l02498"></a>02498 <span class="comment">//</span>
<a name="l02499"></a>02499 <span class="comment">//</span>
<a name="l02500"></a>02500 <span class="comment">//</span>
<a name="l02501"></a>02501 <span class="comment">//</span>
<a name="l02502"></a>02502 <span class="comment">//</span>
<a name="l02503"></a>02503 <span class="comment">//</span>
<a name="l02504"></a>02504 <span class="comment">//</span>
<a name="l02505"></a>02505 <span class="comment">//</span>
<a name="l02506"></a>02506 <span class="comment">//</span>
<a name="l02507"></a>02507 <span class="comment">//</span>
<a name="l02508"></a>02508 <span class="comment">//</span>
<a name="l02509"></a>02509 <span class="comment">//</span>
<a name="l02510"></a>02510 <span class="comment">//</span><span class="comment"></span>
<a name="l02511"></a>02511 <span class="comment">//! Construit le tableau &quot;correspondance&quot; tel que&lt;br&gt;Pour 0 &lt;= i &lt; sommets2.size_array(),&lt;br&gt;Si sommet2(i) existe dans le tableau sommet1, alors&lt;br&gt;sommets2(i, ...) == sommets1(correspondance[i], ...)&lt;br&gt;Sinon&lt;br&gt;correspondance[i] = -1&lt;br&gt;L&#39;egalite est verifiee a epsilon pres en absolu (soit abs(x1-x2)&lt;epsilon)&lt;br&gt;L&#39;algorithme est generalement en n1*log(n1) + n2*log(n1)&lt;br&gt;(recherche basee sur un quicksort).&lt;br&gt;En cas d&#39;echec du tri, on utilise un algorithme en n1*n2.&lt;br&gt;Les tableaux sommets1 et sommets2 doivent etre de dimension 2&lt;br&gt;Le tableau correspondance doit etre de taille sommets2.size_array().&lt;br&gt;Valeur de retour: nombre de sommets de sommets2 non trouves dans le tableau sommets1.</span>
<a name="l02512"></a><a class="code" href="classScatter.html#a16a9000e31ccecd2438c8f05e41cc302">02512</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="classScatter.html#a16a9000e31ccecd2438c8f05e41cc302" title="Construit le tableau &quot;correspondance&quot; tel que Pour 0 &lt;= i &lt; sommets2.size_array(), Si sommet2(i) existe dans le tableau sommet1, alors sommets2(i, ...) == sommets1(correspondance[i], ...) Sinon correspondance[i] = -1 L&#39;egalite est verifiee a epsilon pres en absolu (soit abs(x1-x2)&lt;epsilon) L&#39;algorithme est generalement en n1*log(n1) + n2*log(n1) (recherche basee sur un quicksort). En cas d&#39;echec du tri, on utilise un algorithme en n1*n2. Les tableaux sommets1 et sommets2 doivent etre de dimension 2 Le tableau correspondance doit etre de taille sommets2.size_array(). Valeur de retour: nombre de sommets de sommets2 non trouves dans le tableau sommets1.">Scatter::Chercher_Correspondance</a>(<span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; sommets1, <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; sommets2,
<a name="l02513"></a>02513                                      <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; correspondance, <span class="keyword">const</span> <span class="keywordtype">double</span> epsilon)
<a name="l02514"></a>02514 {
<a name="l02515"></a>02515 <span class="comment">// Methode non threadsafe a cause des static. On teste</span>
<a name="l02516"></a>02516   <span class="keywordflow">if</span> (fct_cmp_coord_tableau)
<a name="l02517"></a>02517     {
<a name="l02518"></a>02518       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Thread error in Chercher_Correspondance&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l02519"></a>02519       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l02520"></a>02520     }
<a name="l02521"></a>02521   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_sommets1 = sommets1.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l02522"></a>02522   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_sommets2 = sommets2.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l02523"></a>02523 <span class="comment">// Precondition necessaire pour fct_cmp_index_coord</span>
<a name="l02524"></a>02524   assert(sommets1.<a class="code" href="classDoubleTab.html#ae6dda48778e7107e1beb723beef1f75b" title="Returns the number of dimensions of the array (&gt;= 1)">nb_dim</a>() == 2);
<a name="l02525"></a>02525   assert(sommets2.<a class="code" href="classDoubleTab.html#ae6dda48778e7107e1beb723beef1f75b" title="Returns the number of dimensions of the array (&gt;= 1)">nb_dim</a>() == 2);
<a name="l02526"></a>02526   assert(correspondance.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>() == nb_sommets2);
<a name="l02527"></a>02527   <span class="keywordflow">if</span> (nb_sommets1 &lt; 1)
<a name="l02528"></a>02528     {
<a name="l02529"></a>02529       correspondance = -1;
<a name="l02530"></a>02530       <span class="keywordflow">return</span> nb_sommets2;
<a name="l02531"></a>02531     }
<a name="l02532"></a>02532 
<a name="l02533"></a>02533   fct_cmp_coord_tableau   = &amp;sommets1;
<a name="l02534"></a>02534   fct_cmp_coord_dimension = sommets1.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1);
<a name="l02535"></a>02535   fct_cmp_coord_epsilon   = epsilon;
<a name="l02536"></a>02536 
<a name="l02537"></a>02537 <span class="comment">// Tableau d&#39;indirection trie, tel que les coordonnees sommets1(index[i], .) soient</span>
<a name="l02538"></a>02538 <span class="comment">// tiees dans l&#39;ordre lexicographique.</span>
<a name="l02539"></a>02539   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> index(nb_sommets1);
<a name="l02540"></a>02540   {
<a name="l02541"></a>02541     <span class="keywordtype">int</span> i;
<a name="l02542"></a>02542     <span class="keywordflow">for</span> (i = 0; i &lt; nb_sommets1; i++)
<a name="l02543"></a>02543       index[i] = i;
<a name="l02544"></a>02544   }
<a name="l02545"></a>02545 
<a name="l02546"></a>02546 <span class="comment">// Tri du tableau d&#39;index</span>
<a name="l02547"></a>02547 <span class="comment">// On trie les sommets par ordre lexicographique des coordonnees.</span>
<a name="l02548"></a>02548 <span class="comment">// Comme on fait un test a epsilon pres, le tri peut echouer:</span>
<a name="l02549"></a>02549 <span class="comment">// Si x=1, y=1.01, z=1.02 et epsilon=0.01, on a</span>
<a name="l02550"></a>02550 <span class="comment">// x==y (a epsilon pres)</span>
<a name="l02551"></a>02551 <span class="comment">// y==z (a epsilon pres)</span>
<a name="l02552"></a>02552 <span class="comment">// mais x!=z</span>
<a name="l02553"></a>02553 <span class="comment">// Donc la recherche par dichotomie peut echouer par la suite.</span>
<a name="l02554"></a>02554 
<a name="l02555"></a>02555   qsort(index.<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>(), nb_sommets1, <span class="keyword">sizeof</span>(int),
<a name="l02556"></a>02556         <a class="code" href="Scatter_8cpp.html#a727b40392ca2280ef4b3f158a4225b48">fct_cmp_index_coord</a>);
<a name="l02557"></a>02557 
<a name="l02558"></a>02558 <span class="comment">// Construction du tableau de correspondance tel que</span>
<a name="l02559"></a>02559 <span class="comment">// sommet1(correspondance[i], ...) == sommet2(i, ...)</span>
<a name="l02560"></a>02560   <span class="keywordtype">int</span> nb_sommets_non_trouves = 0;
<a name="l02561"></a>02561   <span class="keywordtype">int</span> nb_echec_dichotomie = 0;
<a name="l02562"></a>02562   {
<a name="l02563"></a>02563     <span class="keywordtype">int</span> i;
<a name="l02564"></a>02564     <span class="keywordflow">for</span> (i = 0; i &lt; nb_sommets2; i++)
<a name="l02565"></a>02565       {
<a name="l02566"></a>02566         <span class="keyword">const</span> <span class="keywordtype">double</span> * s2 = &amp; sommets2(i,0);
<a name="l02567"></a>02567         <span class="keywordtype">int</span> num_sommet = -1;
<a name="l02568"></a>02568 
<a name="l02569"></a>02569 <span class="comment">// D&#39;abord recherche du sommet dans le tableau sommets1 par dichotomie (bsearch)</span>
<a name="l02570"></a>02570         <span class="keywordtype">int</span> imin = 0;
<a name="l02571"></a>02571         <span class="keywordtype">int</span> imax = nb_sommets1 - 1;
<a name="l02572"></a>02572         <span class="keywordtype">int</span> resu_cmp = -1;
<a name="l02573"></a>02573         <span class="keywordtype">int</span> k = -1;
<a name="l02574"></a>02574         <span class="keywordflow">while</span> (imax &gt; imin)
<a name="l02575"></a>02575           {
<a name="l02576"></a>02576             <span class="keyword">const</span> <span class="keywordtype">int</span> milieu = (imin + imax) &gt;&gt; 1; <span class="comment">//!&lt; (min+max)/2</span>
<a name="l02577"></a>02577 <span class="comment"></span>            k = index[milieu];
<a name="l02578"></a>02578             <span class="keyword">const</span> <span class="keywordtype">double</span> * s1 = &amp; sommets1(k, 0);
<a name="l02579"></a>02579             resu_cmp = <a class="code" href="Scatter_8cpp.html#a06420c19a824af0906036ca04758d81c">fct_cmp_coordonnees</a>(s1, s2);
<a name="l02580"></a>02580             <span class="keywordflow">switch</span>(resu_cmp)
<a name="l02581"></a>02581               {
<a name="l02582"></a>02582               <span class="keywordflow">case</span> -1:
<a name="l02583"></a>02583                 imin = milieu + 1;
<a name="l02584"></a>02584                 <span class="keywordflow">break</span>; <span class="comment">//!&lt; s1&lt;s2</span>
<a name="l02585"></a>02585 <span class="comment"></span>              <span class="keywordflow">case</span> 1 :
<a name="l02586"></a>02586                 imax = milieu - 1;
<a name="l02587"></a>02587                 <span class="keywordflow">break</span>; <span class="comment">//!&lt; s1&gt;s2</span>
<a name="l02588"></a>02588 <span class="comment"></span>              <span class="keywordflow">default</span>:
<a name="l02589"></a>02589                 imin = imax = milieu;
<a name="l02590"></a>02590                 <span class="keywordflow">break</span>; <span class="comment">//!&lt; s1==s2</span>
<a name="l02591"></a>02591 <span class="comment"></span>              }
<a name="l02592"></a>02592           }
<a name="l02593"></a>02593         <span class="keywordflow">if</span> (resu_cmp != 0)
<a name="l02594"></a>02594           {
<a name="l02595"></a>02595             k = index[imin];
<a name="l02596"></a>02596             <span class="keyword">const</span> <span class="keywordtype">double</span> * s1 = &amp; sommets1(k, 0);
<a name="l02597"></a>02597             resu_cmp = <a class="code" href="Scatter_8cpp.html#a06420c19a824af0906036ca04758d81c">fct_cmp_coordonnees</a>(s1, s2);
<a name="l02598"></a>02598           }
<a name="l02599"></a>02599         <span class="keywordflow">if</span> (resu_cmp == 0)
<a name="l02600"></a>02600           {
<a name="l02601"></a>02601             num_sommet = k;
<a name="l02602"></a>02602           }
<a name="l02603"></a>02603         <span class="keywordflow">else</span>
<a name="l02604"></a>02604           {
<a name="l02605"></a>02605             nb_echec_dichotomie++;
<a name="l02606"></a>02606 <span class="comment">// Si echec, c&#39;est peut-etre que le tableau n&#39;est pas ordonne correctement</span>
<a name="l02607"></a>02607 <span class="comment">// =&gt; recherche du sommet en parcourant tout le tableau</span>
<a name="l02608"></a>02608             <span class="keywordtype">int</span> j;
<a name="l02609"></a>02609             <span class="keywordflow">for</span> (j = 0; j &lt; nb_sommets1; j++)
<a name="l02610"></a>02610               {
<a name="l02611"></a>02611                 <span class="keyword">const</span> <span class="keywordtype">double</span> * s1 = &amp; sommets1(j,0);
<a name="l02612"></a>02612                 resu_cmp = <a class="code" href="Scatter_8cpp.html#a06420c19a824af0906036ca04758d81c">fct_cmp_coordonnees</a>(s1, s2);
<a name="l02613"></a>02613                 <span class="keywordflow">if</span> (resu_cmp == 0)
<a name="l02614"></a>02614                   <span class="keywordflow">break</span>;
<a name="l02615"></a>02615               }
<a name="l02616"></a>02616             <span class="keywordflow">if</span> (j &lt; nb_sommets1)
<a name="l02617"></a>02617               num_sommet = j;
<a name="l02618"></a>02618             <span class="keywordflow">else</span>
<a name="l02619"></a>02619               nb_sommets_non_trouves++;
<a name="l02620"></a>02620           }
<a name="l02621"></a>02621 
<a name="l02622"></a>02622         correspondance[i] = num_sommet;
<a name="l02623"></a>02623       }
<a name="l02624"></a>02624   }
<a name="l02625"></a>02625   fct_cmp_coord_dimension = 0;
<a name="l02626"></a>02626   fct_cmp_coord_epsilon   = -1.;
<a name="l02627"></a>02627   fct_cmp_coord_tableau   = 0;
<a name="l02628"></a>02628 
<a name="l02629"></a>02629   <span class="keywordflow">if</span> (nb_echec_dichotomie &gt; 0)
<a name="l02630"></a>02630     <a class="code" href="classProcess.html#a57e0f54b11e6eaadbea224fa904b18dd" title="Renvoie un objet statique de type Sortie qui sert de journal d&#39;evenements. Si message_level &lt;= verbose...">Process::Journal</a>() &lt;&lt; <span class="stringliteral">&quot;Chercher_Correspondance Dichotomy failure rate &quot;</span>
<a name="l02631"></a>02631                        &lt;&lt; nb_echec_dichotomie &lt;&lt; <span class="stringliteral">&quot; / &quot;</span> &lt;&lt; nb_sommets2 &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l02632"></a>02632 
<a name="l02633"></a>02633   <span class="keywordflow">return</span> nb_sommets_non_trouves;
<a name="l02634"></a>02634 }
<a name="l02635"></a>02635 
<a name="l02636"></a>02636 <span class="comment">//</span>
<a name="l02637"></a>02637 <span class="comment">//</span>
<a name="l02638"></a>02638 <span class="comment">//</span>
<a name="l02639"></a>02639 <span class="comment">//</span>
<a name="l02640"></a>02640 <span class="comment">//</span>
<a name="l02641"></a>02641 <span class="comment">//</span>
<a name="l02642"></a>02642 <span class="comment">//</span>
<a name="l02643"></a>02643 <span class="comment">//</span>
<a name="l02644"></a>02644 <span class="comment">//</span>
<a name="l02645"></a>02645 <span class="comment">//</span>
<a name="l02646"></a>02646 <span class="comment">//</span>
<a name="l02647"></a>02647 <span class="comment">//</span>
<a name="l02648"></a>02648 <span class="comment">//</span>
<a name="l02649"></a>02649 <span class="comment">//</span>
<a name="l02650"></a>02650 <span class="comment">//</span><span class="comment"></span>
<a name="l02651"></a>02651 <span class="comment">//! Methode obsolete (utilisee avec l&#39;ancien decoupeur).&lt;br&gt;On suppose que le domaine contient les structures suivantes:&lt;br&gt;* zone(0).faces_joint[i].sommets()            (les sommets de joint isoles)&lt;br&gt;* zone(0).faces_joint[i].faces().les_sommets  (les sommets des faces de joint)&lt;br&gt;et que chaque processeur contient une portion d&#39;un domaine complet.&lt;br&gt;On remplit les tableaux joint_item(Joint::Type_Item).items_communs pour tous les joints de la&lt;br&gt;zone 0 du domaine et renum_items_communs.&lt;br&gt;Ordre d&#39;apparition des items : ordre croissant de l&#39;indice du&lt;br&gt;sommet sur le processeur de rang le plus petit&lt;br&gt;Cette methode doit etre appelee simultanement sur tous les processeurs&lt;br&gt;du groupe et ne s&#39;applique qu&#39;aux items ARETE et SOMMET&lt;br&gt;L&#39;algorithme utilise les coordonnees des items pour retrouver la&lt;br&gt;correspondance entre les items de joint.</span>
<a name="l02652"></a>02652 <span class="comment"></span>
<a name="l02653"></a><a class="code" href="classScatter.html#a06ae2df37becb17fe4e7b2e8c9c07cbd">02653</a> <span class="keywordtype">void</span> <a class="code" href="classScatter.html#a06ae2df37becb17fe4e7b2e8c9c07cbd" title="Methode obsolete (utilisee avec l&#39;ancien decoupeur). On suppose que le domaine contient les structure...">Scatter::construire_correspondance_items_par_coordonnees</a>(<a class="code" href="classJoints.html" title="Classe Joints Cette classe represente une liste d&#39;objet de type Joint.">Joints</a>&amp; joints, <span class="keyword">const</span> <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926">Joint::Type_Item</a> type_item, <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; coord_items)
<a name="l02654"></a>02654 {
<a name="l02655"></a>02655   <span class="keywordflow">switch</span>(type_item)
<a name="l02656"></a>02656     {
<a name="l02657"></a>02657     <span class="keywordflow">case</span> <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>:
<a name="l02658"></a>02658       ;
<a name="l02659"></a>02659       <span class="keywordflow">break</span>;
<a name="l02660"></a>02660     <span class="keywordflow">case</span> <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a7816c69408b98e1161f1f54e7b6b1cb4">Joint::ARETE</a>:
<a name="l02661"></a>02661       ;
<a name="l02662"></a>02662       <span class="keywordflow">break</span>;
<a name="l02663"></a>02663     <span class="keywordflow">default</span>:
<a name="l02664"></a>02664       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Scatter::construire_correspondance_items_par_coordonnees unusable for item &quot;</span>
<a name="l02665"></a>02665            &lt;&lt; (int)type_item
<a name="l02666"></a>02666            &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l02667"></a>02667       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l02668"></a>02668     }
<a name="l02669"></a>02669   <span class="keyword">const</span> <span class="keywordtype">int</span> dim = <a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">Objet_U::dimension</a>;
<a name="l02670"></a>02670   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_joints = joints.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>();
<a name="l02671"></a>02671 
<a name="l02672"></a>02672 <span class="comment">// Indices des items de joints dans le domaine sur mon processeur</span>
<a name="l02673"></a>02673   <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>)  indices_items_locaux(nb_joints);
<a name="l02674"></a>02674 <span class="comment">// Indices des items de joints dans le domaine sur le processeur voisin</span>
<a name="l02675"></a>02675   <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>)  indices_items_distants(nb_joints);
<a name="l02676"></a>02676 <span class="comment">// Coordonnees des items correspondants (dans le meme ordre que indices_items_xxx)</span>
<a name="l02677"></a>02677   <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>) coord_items_locaux(nb_joints);
<a name="l02678"></a>02678   <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>) coord_items_distants(nb_joints);
<a name="l02679"></a>02679 
<a name="l02680"></a>02680 <span class="comment">// Remplissage des tableaux indices_items_locaux</span>
<a name="l02681"></a>02681 <span class="comment">// et coord_items_locaux</span>
<a name="l02682"></a>02682   {
<a name="l02683"></a>02683     <span class="keywordtype">int</span> i_joint;
<a name="l02684"></a>02684     <span class="keywordflow">for</span> (i_joint = 0; i_joint &lt; nb_joints; i_joint++)
<a name="l02685"></a>02685       {
<a name="l02686"></a>02686         <span class="keyword">const</span> <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp; joint = joints[i_joint];
<a name="l02687"></a>02687         <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; items = indices_items_locaux[i_joint];
<a name="l02688"></a>02688 <span class="comment">// Remarque: **LISTE_TRI** les indices_items_locaux sont</span>
<a name="l02689"></a>02689 <span class="comment">// tries dans l&#39;ordre croissant:</span>
<a name="l02690"></a>02690         <a class="code" href="Scatter_8cpp.html#a9ce09df49a63406b606ce247e3880d96">calculer_liste_complete_items_joint</a>(joint, type_item, items);
<a name="l02691"></a>02691 
<a name="l02692"></a>02692         <span class="keyword">const</span> <span class="keywordtype">int</span> n       = items.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l02693"></a>02693         <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp;   coord   = coord_items_locaux[i_joint];
<a name="l02694"></a>02694         <span class="keywordtype">int</span> i, j;
<a name="l02695"></a>02695         coord.<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(n, dim);
<a name="l02696"></a>02696         <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)
<a name="l02697"></a>02697           <span class="keywordflow">for</span> (j = 0; j &lt; dim; j++)
<a name="l02698"></a>02698             coord(i,j) = coord_items(items[i], j);
<a name="l02699"></a>02699       }
<a name="l02700"></a>02700   }
<a name="l02701"></a>02701 
<a name="l02702"></a>02702 <span class="comment">// Envoi des indices et coordonnees locaux au processeur voisin</span>
<a name="l02703"></a>02703   {
<a name="l02704"></a>02704     <a class="code" href="classSchema__Comm.html">Schema_Comm</a> schema_comm;
<a name="l02705"></a>02705     <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> liste_pe_voisins(nb_joints);
<a name="l02706"></a>02706     <span class="keywordtype">int</span> i;
<a name="l02707"></a>02707     <span class="keywordflow">for</span> (i = 0; i &lt; nb_joints; i++)
<a name="l02708"></a>02708       liste_pe_voisins[i] = joints[i].PEvoisin();
<a name="l02709"></a>02709     schema_comm.<a class="code" href="classSchema__Comm.html#ad11c9b47999c294c26ae4df8d2bbd57b" title="Definit la liste des processeurs a qui on va envoyer et de qui on va recevoir des donnees...">set_send_recv_pe_list</a>(liste_pe_voisins, liste_pe_voisins);
<a name="l02710"></a>02710     schema_comm.<a class="code" href="classSchema__Comm.html#ac617b53de22748cdd9fa30a0cfd0f4a8" title="Statut passe a WRITING Autorise si status_ == WRITING:">begin_comm</a>();
<a name="l02711"></a>02711     <span class="keywordflow">for</span> (i = 0; i &lt; nb_joints; i++)
<a name="l02712"></a>02712       {
<a name="l02713"></a>02713         <span class="keyword">const</span> <span class="keywordtype">int</span> pe = liste_pe_voisins[i];
<a name="l02714"></a>02714         <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; buffer = schema_comm.<a class="code" href="classSchema__Comm.html#a6c771eae3b46250ae0d2f0126a7d8065" title="renvoie le buffer correspondant au processeur num_PE pour y entasser des donnees a envoyer...">send_buffer</a>(pe);
<a name="l02715"></a>02715         buffer &lt;&lt; indices_items_locaux[i];
<a name="l02716"></a>02716         buffer &lt;&lt; coord_items_locaux[i];
<a name="l02717"></a>02717       }
<a name="l02718"></a>02718     schema_comm.<a class="code" href="classSchema__Comm.html#abca0e8ac6c2b742d26f3cfaee0690c72" title="Statut passe a EXCHANGED.">echange_taille_et_messages</a>();
<a name="l02719"></a>02719     <span class="keywordflow">for</span> (i = 0; i &lt; nb_joints; i++)
<a name="l02720"></a>02720       {
<a name="l02721"></a>02721         <span class="keyword">const</span> <span class="keywordtype">int</span> pe = liste_pe_voisins[i];
<a name="l02722"></a>02722         <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; buffer = schema_comm.<a class="code" href="classSchema__Comm.html#a0c056eb81ab8fd513912b336b4d13a1a" title="renvoie le buffer correspondant au processeur num_PE pour y lire les donnees recues. Le schema doit etre dans l&#39;etat EXCHANGED.">recv_buffer</a>(pe);
<a name="l02723"></a>02723         buffer &gt;&gt; indices_items_distants[i];
<a name="l02724"></a>02724         buffer &gt;&gt; coord_items_distants[i];
<a name="l02725"></a>02725       }
<a name="l02726"></a>02726     schema_comm.<a class="code" href="classSchema__Comm.html#a73a981f88b6ffebc150fb46c5cce75d9" title="Statut passe a RESET Accesseurs:">end_comm</a>();
<a name="l02727"></a>02727   }
<a name="l02728"></a>02728 
<a name="l02729"></a>02729 <span class="comment">// Boucle sur les joints</span>
<a name="l02730"></a>02730   {
<a name="l02731"></a>02731 <span class="comment">// Cette fois, on modifie les joints (remplissage de renum_virt_loc)</span>
<a name="l02732"></a>02732     <span class="keyword">const</span> <span class="keywordtype">int</span> moi = <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>();
<a name="l02733"></a>02733     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_joint = 0; i_joint &lt; nb_joints; i_joint++)
<a name="l02734"></a>02734       {
<a name="l02735"></a>02735         <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp;           joint           = joints[i_joint];
<a name="l02736"></a>02736         <span class="keyword">const</span> <span class="keywordtype">int</span>     PEvoisin        = joint.<a class="code" href="classJoint.html#a0952bc5c7805434ccd8cd5c9b01e3747" title="Renvoie PEvoisin (numero de la zone voisine)">PEvoisin</a>();
<a name="l02737"></a>02737         <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; indices_locaux  = indices_items_locaux[i_joint];
<a name="l02738"></a>02738 <span class="comment">// ArrOfInt &amp;       indices_distants= indices_items_distants[i_joint];</span>
<a name="l02739"></a>02739         <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; coord_locaux    = coord_items_locaux[i_joint];
<a name="l02740"></a>02740         <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; coord_distants  = coord_items_distants[i_joint];
<a name="l02741"></a>02741         <span class="keyword">const</span> <span class="keywordtype">int</span> n = indices_locaux.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l02742"></a>02742         <span class="comment">/*</span>
<a name="l02743"></a>02743 <span class="comment">          if (n != indices_distants.size_array()) {</span>
<a name="l02744"></a>02744 <span class="comment">          Cerr &lt;&lt; &quot;Error in Scatter::remplir_renum_virt_loc on PE &quot;</span>
<a name="l02745"></a>02745 <span class="comment">          &lt;&lt; Process::me();</span>
<a name="l02746"></a>02746 <span class="comment">          Cerr &lt;&lt; &quot;\n Joint with PE &quot; &lt;&lt; joint.PEvoisin()</span>
<a name="l02747"></a>02747 <span class="comment">          &lt;&lt; &quot;\n Number of items &quot; &lt;&lt; type_item &lt;&lt; &quot; on my joint : &quot; &lt;&lt; n;</span>
<a name="l02748"></a>02748 <span class="comment">          Cerr &lt;&lt; &quot;\n Number of items &quot; &lt;&lt; type_item &lt;&lt; &quot; on the remote joint : &quot;</span>
<a name="l02749"></a>02749 <span class="comment">          &lt;&lt; indices_distants.size_array()</span>
<a name="l02750"></a>02750 <span class="comment">          &lt;&lt; finl;</span>
<a name="l02751"></a>02751 <span class="comment">          exit();</span>
<a name="l02752"></a>02752 <span class="comment">          } */</span>
<a name="l02753"></a>02753 <span class="comment">// Recherche des correspondances entre items</span>
<a name="l02754"></a>02754         <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> corresp(n);
<a name="l02755"></a>02755         <span class="keyword">const</span> <span class="keywordtype">double</span> epsilon = <a class="code" href="classObjet__U.html#a7447e25c68cc8d3a1c06cf99f0565cff">Objet_U::precision_geom</a>;
<a name="l02756"></a>02756         <a class="code" href="classScatter.html#a16a9000e31ccecd2438c8f05e41cc302" title="Construit le tableau &quot;correspondance&quot; tel que Pour 0 &lt;= i &lt; sommets2.size_array(), Si sommet2(i) existe dans le tableau sommet1, alors sommets2(i, ...) == sommets1(correspondance[i], ...) Sinon correspondance[i] = -1 L&#39;egalite est verifiee a epsilon pres en absolu (soit abs(x1-x2)&lt;epsilon) L&#39;algorithme est generalement en n1*log(n1) + n2*log(n1) (recherche basee sur un quicksort). En cas d&#39;echec du tri, on utilise un algorithme en n1*n2. Les tableaux sommets1 et sommets2 doivent etre de dimension 2 Le tableau correspondance doit etre de taille sommets2.size_array(). Valeur de retour: nombre de sommets de sommets2 non trouves dans le tableau sommets1.">Chercher_Correspondance</a>(coord_distants, coord_locaux, corresp, epsilon);
<a name="l02757"></a>02757 
<a name="l02758"></a>02758         <span class="keywordtype">int</span> nb_items_communs_trouves=0;
<a name="l02759"></a>02759         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; n; k++)
<a name="l02760"></a>02760           <span class="keywordflow">if</span> (corresp[k]&gt;=0) nb_items_communs_trouves++;
<a name="l02761"></a>02761 
<a name="l02762"></a>02762         <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; items_communs = joint.<a class="code" href="classJoint.html#aa1c4d729a3017082d26907d82ad1d7de" title="Renvoie les informations de joint pour un type d&#39;item geometrique donne, pour remplissage des structu...">set_joint_item</a>(type_item).<a class="code" href="classJoint__Items.html#aa01c4601d506c658f4f1d45e66951ce0" title="Renvoie le tableau items_communs_ pour le remplir. (BM: ce tableau n&#39;est pas encore rempli)...">set_items_communs</a>();
<a name="l02763"></a>02763         items_communs.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(nb_items_communs_trouves);
<a name="l02764"></a>02764         items_communs = -1;
<a name="l02765"></a>02765         <span class="keywordtype">int</span> i=0;
<a name="l02766"></a>02766         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; n; k++)
<a name="l02767"></a>02767           {
<a name="l02768"></a>02768             <span class="keyword">const</span> <span class="keywordtype">int</span> i_local = indices_locaux[k];
<a name="l02769"></a>02769 <span class="comment">// Le j-ieme item distant est identique au k-ieme item local</span>
<a name="l02770"></a>02770             <span class="keyword">const</span> <span class="keywordtype">int</span> j = corresp[k];
<a name="l02771"></a>02771 
<a name="l02772"></a>02772 <span class="comment">// Pas trouve ? Erreur possible</span>
<a name="l02773"></a>02773             <span class="keywordflow">if</span> (j &lt; 0)
<a name="l02774"></a>02774               {
<a name="l02775"></a>02775                 <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Scatter::remplir_renum_virt_loc on PE &quot;</span> &lt;&lt; moi &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>
<a name="l02776"></a>02776                      &lt;&lt; <span class="stringliteral">&quot;The item of type &quot;</span> &lt;&lt; (int)type_item &lt;&lt; <span class="stringliteral">&quot; number &quot;</span> &lt;&lt; i_local &lt;&lt; <span class="stringliteral">&quot; with coordinates &quot;</span>;
<a name="l02777"></a>02777                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k2 = 0; k2 &lt; dim; k2++)
<a name="l02778"></a>02778                   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; coord_locaux(i, k2) &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l02779"></a>02779                 <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a> &lt;&lt; <span class="stringliteral">&quot;was not found in the joint with the PE &quot;</span> &lt;&lt; PEvoisin &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l02780"></a>02780                 <span class="keywordflow">if</span> (type_item==3)
<a name="l02781"></a>02781                   {
<a name="l02782"></a>02782                     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;The searching algorithm of the isolated edges on a joint&quot;</span> &lt;&lt; finl;
<a name="l02783"></a>02783                     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;does not work yet in some cases. Two isolated nodes of a joint (example below&quot;</span> &lt;&lt; finl;
<a name="l02784"></a>02784                     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;joint between 0 and 2) can be those of an edge not belonging to this joint (below&quot;</span> &lt;&lt; finl;
<a name="l02785"></a>02785                     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;the edge belongs to the joint 0-1 but not 0-2):&quot;</span> &lt;&lt; finl;
<a name="l02786"></a>02786 <span class="comment">// Cerr &lt;&lt; &quot;  ________    &quot; &lt;&lt; finl;</span>
<a name="l02787"></a>02787 <span class="comment">// Cerr &lt;&lt; &quot;1\ 2/1\2 /1\  &quot; &lt;&lt; finl;</span>
<a name="l02788"></a>02788 <span class="comment">// Cerr &lt;&lt; &quot;__\/___\/___\ &quot; &lt;&lt; finl;</span>
<a name="l02789"></a>02789 <span class="comment">// Cerr &lt;&lt; &quot; 0/\ 0 /\ 0   &quot; &lt;&lt; finl;</span>
<a name="l02790"></a>02790 <span class="comment">// Cerr &lt;&lt; &quot; / 0\ / 0\    &quot; &lt;&lt; finl;</span>
<a name="l02791"></a>02791                     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;  ________      &quot;</span> &lt;&lt; finl;
<a name="l02792"></a>02792                     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;1\\ 2/1\\2 /1\\ &quot;</span> &lt;&lt; finl;
<a name="l02793"></a>02793                     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;__\\/___\\/___\\&quot;</span> &lt;&lt; finl;
<a name="l02794"></a>02794                     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; 0/\\ 0 /\\ 0   &quot;</span> &lt;&lt; finl;
<a name="l02795"></a>02795                     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; / 0\\ / 0\\    &quot;</span> &lt;&lt; finl;
<a name="l02796"></a>02796                     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; finl;
<a name="l02797"></a>02797                     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;One way to by-pass this problem is to split again your domain with&quot;</span> &lt;&lt; finl;
<a name="l02798"></a>02798                     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;different options of splitting or with another splitter to do not fall&quot;</span> &lt;&lt; finl;
<a name="l02799"></a>02799                     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;on the same configuration.&quot;</span> &lt;&lt; finl;
<a name="l02800"></a>02800                   }
<a name="l02801"></a>02801                 <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l02802"></a>02802               }
<a name="l02803"></a>02803             <span class="keywordflow">else</span>
<a name="l02804"></a>02804               {
<a name="l02805"></a>02805                 <span class="keywordflow">if</span> (moi &lt; PEvoisin)
<a name="l02806"></a>02806                   {
<a name="l02807"></a>02807 <span class="comment">// items communs dans l&#39;ordre des items de joint locaux:</span>
<a name="l02808"></a>02808                     items_communs[i] = i_local;
<a name="l02809"></a>02809 <span class="comment">// On verifie que c&#39;est bien l&#39;ordre croissant de l&#39;indice local</span>
<a name="l02810"></a>02810 <span class="comment">// (voir **LISTE_TRI**)</span>
<a name="l02811"></a>02811                     assert(i==0 || items_communs[i] &gt; items_communs[i-1]);
<a name="l02812"></a>02812                   }
<a name="l02813"></a>02813                 <span class="keywordflow">else</span>
<a name="l02814"></a>02814                   {
<a name="l02815"></a>02815 <span class="comment">// items communs dans l&#39;ordre des items sur le voisin:</span>
<a name="l02816"></a>02816                     assert(items_communs[j] &lt; 0);
<a name="l02817"></a>02817                     items_communs[j] = i_local;
<a name="l02818"></a>02818                   }
<a name="l02819"></a>02819                 i++;
<a name="l02820"></a>02820               }
<a name="l02821"></a>02821           }
<a name="l02822"></a>02822         assert(i==nb_items_communs_trouves);
<a name="l02823"></a>02823       }
<a name="l02824"></a>02824 <span class="comment">// Remplissage de renum_items_communs:</span>
<a name="l02825"></a>02825     <a class="code" href="classScatter.html#a21f166c05df9be1fc1f02b0604624fe5" title="On suppose que chaque joint[i].joint_item(type_item).items_communs() contient les indices locaux des ...">calculer_renum_items_communs</a>(joints, type_item);
<a name="l02826"></a>02826   }
<a name="l02827"></a>02827 }
<a name="l02828"></a>02828 
<a name="l02829"></a>02829 <span class="comment">//</span><span class="comment"></span>
<a name="l02830"></a>02830 <span class="comment">//! Construction des tableaux joint_item(Joint::SOMMET).items_communs de tous les joints de la zone(0) du domaine dom</span>
<a name="l02831"></a>02831 <span class="comment"></span>
<a name="l02832"></a><a class="code" href="classScatter.html#acafac38fc2983e19398c403a9235bb4c">02832</a> <span class="keywordtype">void</span> <a class="code" href="classScatter.html#acafac38fc2983e19398c403a9235bb4c" title="Construction des tableaux joint_item(Joint::SOMMET).items_communs de tous les joints de la zone(0) du...">Scatter::construire_correspondance_sommets_par_coordonnees</a>(<a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom)
<a name="l02833"></a>02833 {
<a name="l02834"></a>02834   <a class="code" href="classScatter.html#a06ae2df37becb17fe4e7b2e8c9c07cbd" title="Methode obsolete (utilisee avec l&#39;ancien decoupeur). On suppose que le domaine contient les structure...">construire_correspondance_items_par_coordonnees</a>(dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>(), <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>, dom.<a class="code" href="classDomaine.html#aecd32c3eecc15cce7d1a0e468dadbf96" title="Renvoie le tableau des coordonnees des noeuds (sommets). (acces en lecture)">coord_sommets</a>());
<a name="l02835"></a>02835 }
<a name="l02836"></a>02836 
<a name="l02837"></a>02837 <span class="comment">// Description</span>
<a name="l02838"></a>02838 <span class="comment">// Construction des tableaux joint_item(Joint::ARETE).items_communs de tous les joints de la zone</span>
<a name="l02839"></a>02839 
<a name="l02840"></a><a class="code" href="classScatter.html#a12daf3ea958d39cbeb04c87ec60369f7">02840</a> <span class="keywordtype">void</span> <a class="code" href="classScatter.html#a12daf3ea958d39cbeb04c87ec60369f7">Scatter::construire_correspondance_aretes_par_coordonnees</a>(<a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>&amp; zvf)
<a name="l02841"></a>02841 {
<a name="l02842"></a>02842   <a class="code" href="classScatter.html#a06ae2df37becb17fe4e7b2e8c9c07cbd" title="Methode obsolete (utilisee avec l&#39;ancien decoupeur). On suppose que le domaine contient les structure...">construire_correspondance_items_par_coordonnees</a>(zvf.<a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>().<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>(), <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a7816c69408b98e1161f1f54e7b6b1cb4">Joint::ARETE</a>, zvf.<a class="code" href="classZone__VF.html#a6ad5a2a03fc2cba4247a6ebe662b1320">xa</a>());
<a name="l02843"></a>02843 }
<a name="l02844"></a>02844 
<a name="l02845"></a><a class="code" href="Scatter_8cpp.html#a4c215e3cfff2963def44e300a58b513b">02845</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="Scatter_8cpp.html#a4c215e3cfff2963def44e300a58b513b">init_simple_md_vector</a>(<a class="code" href="classMD__Vector__std.html" title="C&#39;est le plus simple des descripteurs, utilise pour les tableaux de valeurs aux sommets, elements, faces, aretes, faces de bord, etc... Il supporte la notion d&#39;items &quot;communs&quot; (sommets du maillage partages entre plusieurs processeurs) et d&#39;items &quot;distants&quot; et &quot;virtuels&quot; (sommets, elements dans l&#39;epaisseur de joint). Voir aussi MD_Vector_composite (descripteur compose d&#39;une reunion de plusieurs descripteurs, pour le P1Bulle par exemple)">MD_Vector_std</a>&amp; md, <span class="keyword">const</span> <span class="keywordtype">int</span> n)
<a name="l02846"></a>02846 {
<a name="l02847"></a>02847   md.<a class="code" href="classMD__Vector__base2.html#ae222cd70f0be4da64d0aa7fcd89df0f4">nb_items_tot_</a> = n;
<a name="l02848"></a>02848   md.<a class="code" href="classMD__Vector__base2.html#a87c423fabd116249cb1dab31887193c9">nb_items_reels_</a> = n;
<a name="l02849"></a>02849   md.<a class="code" href="classMD__Vector__base2.html#a7cf9dbd94db6c0ba49e87681d207aef0">nb_items_seq_tot_</a> = n;
<a name="l02850"></a>02850   md.<a class="code" href="classMD__Vector__base2.html#a2bb5e578b35a03544342e963d2adec35">nb_items_seq_local_</a> = n;
<a name="l02851"></a>02851   md.<a class="code" href="classMD__Vector__base2.html#afb3898aebe081ff8c87759822946ece7">blocs_items_to_sum_</a>.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(2, <a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ffaf6ae9ba7eb51c5f298ce693345b3ec68">Array_base::NOCOPY_NOINIT</a>);
<a name="l02852"></a>02852   md.<a class="code" href="classMD__Vector__base2.html#afb3898aebe081ff8c87759822946ece7">blocs_items_to_sum_</a>[0] = 0;
<a name="l02853"></a>02853   md.<a class="code" href="classMD__Vector__base2.html#afb3898aebe081ff8c87759822946ece7">blocs_items_to_sum_</a>[1] = n;
<a name="l02854"></a>02854   md.<a class="code" href="classMD__Vector__base2.html#ac19dad1f73b786033a9911cbfe3ae440">blocs_items_to_compute_</a>.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(2, <a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ffaf6ae9ba7eb51c5f298ce693345b3ec68">Array_base::NOCOPY_NOINIT</a>);
<a name="l02855"></a>02855   md.<a class="code" href="classMD__Vector__base2.html#ac19dad1f73b786033a9911cbfe3ae440">blocs_items_to_compute_</a>[0] = 0;
<a name="l02856"></a>02856   md.<a class="code" href="classMD__Vector__base2.html#ac19dad1f73b786033a9911cbfe3ae440">blocs_items_to_compute_</a>[1] = n;
<a name="l02857"></a>02857 }
<a name="l02858"></a>02858 <span class="comment"></span>
<a name="l02859"></a>02859 <span class="comment">///!&lt; Description  Pour un item geometrique &quot;type_item&quot;, remplit le champ nb_items_virtuels_  des joints en fonction du nombre d&#39;items distants :  Le nombre d&#39;items virtuels sur un joint i du processeur j est le  nombre d&#39;items distants du joint j sur le processeur i.</span>
<a name="l02860"></a>02860 <span class="comment"></span><span class="comment">//</span>
<a name="l02861"></a>02861 <span class="comment">//</span>
<a name="l02862"></a>02862 <span class="comment">//</span>
<a name="l02863"></a>02863 <span class="comment">//</span>
<a name="l02864"></a><a class="code" href="classScatter.html#ab8e91081aefb68562533279f2446e988">02864</a> <span class="keywordtype">void</span> <a class="code" href="classScatter.html#ab8e91081aefb68562533279f2446e988" title="!&lt; Description Pour un item geometrique &quot;type_item&quot;, remplit le champ nb_items_virtuels_ des joints ...">Scatter::calculer_nb_items_virtuels</a>(<a class="code" href="classJoints.html" title="Classe Joints Cette classe represente une liste d&#39;objet de type Joint.">Joints</a>&amp; joints,
<a name="l02865"></a>02865                                          <span class="keyword">const</span> <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926">Joint::Type_Item</a> type_item)
<a name="l02866"></a>02866 {
<a name="l02867"></a>02867   <a class="code" href="classSchema__Comm.html">Schema_Comm</a> schema_comm;
<a name="l02868"></a>02868   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_joints = joints.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>();
<a name="l02869"></a>02869   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> liste_voisins(nb_joints);
<a name="l02870"></a>02870   <span class="keywordtype">int</span> i_joint;
<a name="l02871"></a>02871   <span class="keywordflow">for</span> (i_joint = 0; i_joint &lt; nb_joints; i_joint++)
<a name="l02872"></a>02872     liste_voisins[i_joint] = joints[i_joint].PEvoisin();
<a name="l02873"></a>02873 
<a name="l02874"></a>02874 <span class="comment">// On envoie le nombre d&#39;items distants au PE voisin</span>
<a name="l02875"></a>02875   schema_comm.<a class="code" href="classSchema__Comm.html#ad11c9b47999c294c26ae4df8d2bbd57b" title="Definit la liste des processeurs a qui on va envoyer et de qui on va recevoir des donnees...">set_send_recv_pe_list</a>(liste_voisins, liste_voisins);
<a name="l02876"></a>02876   schema_comm.<a class="code" href="classSchema__Comm.html#ac617b53de22748cdd9fa30a0cfd0f4a8" title="Statut passe a WRITING Autorise si status_ == WRITING:">begin_comm</a>();
<a name="l02877"></a>02877   <span class="keywordflow">for</span> (i_joint = 0; i_joint &lt; nb_joints; i_joint++)
<a name="l02878"></a>02878     {
<a name="l02879"></a>02879       <span class="keyword">const</span> <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp;        joint = joints[i_joint];
<a name="l02880"></a>02880       <span class="keyword">const</span> <a class="code" href="classJoint__Items.html" title="Joint_Items contient les informations de distribution parallele d&#39;un item geometrique particulier ave...">Joint_Items</a>&amp; items = joint.<a class="code" href="classJoint.html#a3f49fb1150967b436a115a7373ab27a0" title="Renvoie les informations de joint pour le type demande.">joint_item</a>(type_item);
<a name="l02881"></a>02881       <span class="keyword">const</span> <span class="keywordtype">int</span> n  = items.<a class="code" href="classJoint__Items.html#ae51b330de79fcaae9c88166e3eee7cb8" title="Voir items_distants_.">items_distants</a>().<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l02882"></a>02882       <span class="keyword">const</span> <span class="keywordtype">int</span> pe = joint.<a class="code" href="classJoint.html#a0952bc5c7805434ccd8cd5c9b01e3747" title="Renvoie PEvoisin (numero de la zone voisine)">PEvoisin</a>();
<a name="l02883"></a>02883       schema_comm.<a class="code" href="classSchema__Comm.html#a6c771eae3b46250ae0d2f0126a7d8065" title="renvoie le buffer correspondant au processeur num_PE pour y entasser des donnees a envoyer...">send_buffer</a>(pe) &lt;&lt; n;
<a name="l02884"></a>02884     }
<a name="l02885"></a>02885 <span class="comment">// Echange des messages</span>
<a name="l02886"></a>02886   schema_comm.<a class="code" href="classSchema__Comm.html#abca0e8ac6c2b742d26f3cfaee0690c72" title="Statut passe a EXCHANGED.">echange_taille_et_messages</a>();
<a name="l02887"></a>02887 <span class="comment">// Le PE voisin recoit ce nombre d&#39;items et le stocke.</span>
<a name="l02888"></a>02888   <span class="keywordflow">for</span> (i_joint = 0; i_joint &lt; nb_joints; i_joint++)
<a name="l02889"></a>02889     {
<a name="l02890"></a>02890       <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp;        joint = joints[i_joint];
<a name="l02891"></a>02891       <a class="code" href="classJoint__Items.html" title="Joint_Items contient les informations de distribution parallele d&#39;un item geometrique particulier ave...">Joint_Items</a>&amp; items = joint.<a class="code" href="classJoint.html#aa1c4d729a3017082d26907d82ad1d7de" title="Renvoie les informations de joint pour un type d&#39;item geometrique donne, pour remplissage des structu...">set_joint_item</a>(type_item);
<a name="l02892"></a>02892       <span class="keyword">const</span> <span class="keywordtype">int</span> pe = joint.<a class="code" href="classJoint.html#a0952bc5c7805434ccd8cd5c9b01e3747" title="Renvoie PEvoisin (numero de la zone voisine)">PEvoisin</a>();
<a name="l02893"></a>02893       <span class="keywordtype">int</span> n;
<a name="l02894"></a>02894       schema_comm.<a class="code" href="classSchema__Comm.html#a0c056eb81ab8fd513912b336b4d13a1a" title="renvoie le buffer correspondant au processeur num_PE pour y lire les donnees recues. Le schema doit etre dans l&#39;etat EXCHANGED.">recv_buffer</a>(pe) &gt;&gt; n;
<a name="l02895"></a>02895       items.<a class="code" href="classJoint__Items.html#a956b3926baa83e9d5ab9848adf7f822a" title="Voir nb_items_virtuels_ Voir Scatter::calculer_nb_items_virtuels.">set_nb_items_virtuels</a>(n);
<a name="l02896"></a>02896     }
<a name="l02897"></a>02897   schema_comm.<a class="code" href="classSchema__Comm.html#a73a981f88b6ffebc150fb46c5cce75d9" title="Statut passe a RESET Accesseurs:">end_comm</a>();
<a name="l02898"></a>02898 }
<a name="l02899"></a>02899 
<a name="l02900"></a>02900 <span class="comment">//</span>
<a name="l02901"></a>02901 <span class="comment">//</span><span class="comment"></span>
<a name="l02902"></a>02902 <span class="comment">//! cree des descripteurs sequentiels pour les tableaux sommets&lt;br&gt;et elements du domaine (necessaire car Scatter n&#39;est pas appele pour les&lt;br&gt;domaines en sequentiel)</span>
<a name="l02903"></a><a class="code" href="classScatter.html#a1874139ffd29d5a68191bc7828d3a5bd">02903</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classScatter.html#a1874139ffd29d5a68191bc7828d3a5bd" title="cree des descripteurs sequentiels pour les tableaux sommets et elements du domaine (necessaire car Sc...">Scatter::init_sequential_domain</a>(<a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom)
<a name="l02904"></a>02904 {
<a name="l02905"></a>02905   <a class="code" href="classMD__Vector__std.html" title="C&#39;est le plus simple des descripteurs, utilise pour les tableaux de valeurs aux sommets, elements, faces, aretes, faces de bord, etc... Il supporte la notion d&#39;items &quot;communs&quot; (sommets du maillage partages entre plusieurs processeurs) et d&#39;items &quot;distants&quot; et &quot;virtuels&quot; (sommets, elements dans l&#39;epaisseur de joint). Voir aussi MD_Vector_composite (descripteur compose d&#39;une reunion de plusieurs descripteurs, pour le P1Bulle par exemple)">MD_Vector_std</a> mdstd;
<a name="l02906"></a>02906   <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a> md;
<a name="l02907"></a>02907   <span class="keyword">const</span> <span class="keywordtype">int</span> nbsom = dom.<a class="code" href="classDomaine.html#abc4abc8b8db5bebeb161fae4162a89ce" title="Renvoie le nombre de sommets.">nb_som</a>();
<a name="l02908"></a>02908   <a class="code" href="Scatter_8cpp.html#a4c215e3cfff2963def44e300a58b513b">init_simple_md_vector</a>(mdstd, nbsom);
<a name="l02909"></a>02909   md.<a class="code" href="classMD__Vector.html#a063644dd8ca62e707a2d059eedeb58a7" title="construction d&#39;un objet MD_Vector par copie d&#39;un objet existant. C&#39;est la methode recommandee pour cr...">copy</a>(mdstd);
<a name="l02910"></a>02910   dom.<a class="code" href="classDomaine.html#a0846ac03a10b65c4df911fe35a19c02f" title="Renvoie le nombre total de sommets.">les_sommets</a>().<a class="code" href="classDoubleTab.html#a2f40241acb678b0dd0dac7ee4f421b1d" title="associe le md_vector au vecteur (voir DoubleVect::set_md_vector()) dimension(0) sera initialise a md_...">set_md_vector</a>(md);
<a name="l02911"></a>02911 
<a name="l02912"></a>02912   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_zones = dom.<a class="code" href="classDomaine.html#a9f3fc389a1310d1fc8b4b27976855376" title="Renvoie le nombre de zone du domaine.">nb_zones</a>();
<a name="l02913"></a>02913   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_zones; i++)
<a name="l02914"></a>02914     {
<a name="l02915"></a>02915       <span class="keyword">const</span> <span class="keywordtype">int</span> nb_elem = dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(i).<a class="code" href="classZone.html#a7f249429803b27139a1c54436f6164a5" title="Renvoie le nombre d&#39;elements de la zone.">nb_elem</a>();
<a name="l02916"></a>02916       <a class="code" href="Scatter_8cpp.html#a4c215e3cfff2963def44e300a58b513b">init_simple_md_vector</a>(mdstd, nb_elem);
<a name="l02917"></a>02917       md.<a class="code" href="classMD__Vector.html#a063644dd8ca62e707a2d059eedeb58a7" title="construction d&#39;un objet MD_Vector par copie d&#39;un objet existant. C&#39;est la methode recommandee pour cr...">copy</a>(mdstd);
<a name="l02918"></a>02918       dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(i).<a class="code" href="classZone.html#ac115e8342be89afb882b7b61cc343267" title="Renvoie le tableau des sommets des elements.">les_elems</a>().<a class="code" href="classIntTab.html#a02470d5d5921700f4daee05a5b3d2601" title="associe le md_vector au vecteur (voir IntVect::set_md_vector()) dimension(0) sera initialise a md_vec...">set_md_vector</a>(md);
<a name="l02919"></a>02919     }
<a name="l02920"></a>02920 }
<a name="l02921"></a>02921 
<a name="l02922"></a>02922 <span class="comment">//</span>
<a name="l02923"></a>02923 <span class="comment">//</span><span class="comment"></span>
<a name="l02924"></a>02924 <span class="comment">//! methode utilisee par les interpretes qui modifient le domaine&lt;br&gt;(sequentiel), detruit les descripteurs des sommets et elements pour permettre&lt;br&gt;la modification de ces tableaux.</span>
<a name="l02925"></a><a class="code" href="classScatter.html#a8cf934a9b5f7ecb7ef89f61c09804f45">02925</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classScatter.html#a8cf934a9b5f7ecb7ef89f61c09804f45" title="methode utilisee par les interpretes qui modifient le domaine&lt;br&gt;(sequentiel), detruit les descripteu...">Scatter::uninit_sequential_domain</a>(<a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom)
<a name="l02926"></a>02926 {
<a name="l02927"></a>02927   <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a> md; <span class="comment">//!&lt; descripteur nul</span>
<a name="l02928"></a>02928 <span class="comment"></span>  dom.<a class="code" href="classDomaine.html#a0846ac03a10b65c4df911fe35a19c02f" title="Renvoie le nombre total de sommets.">les_sommets</a>().<a class="code" href="classDoubleTab.html#a2f40241acb678b0dd0dac7ee4f421b1d" title="associe le md_vector au vecteur (voir DoubleVect::set_md_vector()) dimension(0) sera initialise a md_...">set_md_vector</a>(md);
<a name="l02929"></a>02929   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_zones = dom.<a class="code" href="classDomaine.html#a9f3fc389a1310d1fc8b4b27976855376" title="Renvoie le nombre de zone du domaine.">nb_zones</a>();
<a name="l02930"></a>02930   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_zones; i++)
<a name="l02931"></a>02931     {
<a name="l02932"></a>02932       dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(i).<a class="code" href="classZone.html#ac115e8342be89afb882b7b61cc343267" title="Renvoie le tableau des sommets des elements.">les_elems</a>().<a class="code" href="classIntTab.html#a02470d5d5921700f4daee05a5b3d2601" title="associe le md_vector au vecteur (voir IntVect::set_md_vector()) dimension(0) sera initialise a md_vec...">set_md_vector</a>(md);
<a name="l02933"></a>02933     }
<a name="l02934"></a>02934 }
<a name="l02935"></a>02935 
<a name="l02936"></a>02936 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:20 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
