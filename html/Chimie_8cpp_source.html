<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/ThHyd/Chimie/Chimie.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/ThHyd/Chimie/Chimie.cpp</div>  </div>
</div>
<div class="contents">
<a href="Chimie_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (c) 2015 - 2016, CEA</span>
<a name="l00003"></a>00003 <span class="comment">* All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment">* 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00007"></a>00007 <span class="comment">* 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00008"></a>00008 <span class="comment">* 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<a name="l00011"></a>00011 <span class="comment">* IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;</span>
<a name="l00012"></a>00012 <span class="comment">* OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// File:        Chimie.cpp</span>
<a name="l00018"></a>00018 <span class="comment">// Directory:   $TRUST_ROOT/src/ThHyd/Chimie</span>
<a name="l00019"></a>00019 <span class="comment">// Version:     /main/6</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="Chimie_8h.html">Chimie.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="Probleme__base_8h.html">Probleme_base.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="Motcle_8h.html">Motcle.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="Param_8h.html">Param.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="Parser__U_8h.html">Parser_U.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="Zone__VF_8h.html">Zone_VF.h</a>&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;<a class="code" href="Discretisation__base_8h.html">Discretisation_base.h</a>&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;<a class="code" href="Debog_8h.html">Debog.h</a>&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;<a class="code" href="Convection__Diffusion__Concentration_8h.html">Convection_Diffusion_Concentration.h</a>&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;<a class="code" href="dlsinterf_8h.html">dlsinterf.h</a>&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;<a class="code" href="Constituant_8h.html">Constituant.h</a>&gt;</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 
<a name="l00037"></a><a class="code" href="Chimie_8cpp.html#ad5825a71ffc975d5c47d3a5096ec00f1">00037</a> <a class="code" href="Op__Diff__CoviMAC__Face_8cpp.html#aa86ec8ba612a969d9b4370b775037144">Implemente_instanciable</a>(<a class="code" href="classChimie.html">Chimie</a>,<span class="stringliteral">&quot;Chimie&quot;</span>,<a class="code" href="classObjet__U.html" title="classe Objet_U Cette classe est la classe de base des Objets de TRUST Dans les classes derivees de Ob...">Objet_U</a>);
<a name="l00038"></a><a class="code" href="Chimie_8cpp.html#a393afbe02f4f15cf922b9742f3d22ba9">00038</a> <a class="code" href="MacVect_8h.html#a0c9b693e7e6836489732c32b7a972a03">Implemente_vect</a>(<a class="code" href="Ref_8h.html#aab5720a5c34da14028d0745e386aaa01">REF</a>(<a class="code" href="classChamp__Inc__base.html" title="Classe Champ_Inc_base Classe de base des champs inconnues qui sont les champs calcules par une equati...">Champ_Inc_base</a>));
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 
<a name="l00046"></a><a class="code" href="classChimie.html#ad1eb2cde6eda884da8fdf00753e201d1">00046</a> <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classChimie.html#ad1eb2cde6eda884da8fdf00753e201d1" title="Ecriture de l&#39;objet sur un flot de sortie Methode a surcharger.">Chimie::printOn</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os)<span class="keyword"> const</span>
<a name="l00047"></a>00047 <span class="keyword"></span>{
<a name="l00048"></a>00048   os&lt;&lt;(*this).le_nom()&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00049"></a>00049   os&lt;&lt;<a class="code" href="classChimie.html#aafb7de1d50046bf7bc29d81b1da78030">reactions_</a>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00050"></a>00050   <span class="keywordflow">return</span> os;
<a name="l00051"></a>00051 }
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="classChimie.html#a1aee6d5210eece0be15f18b905f53c21">00053</a> <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classChimie.html#a1aee6d5210eece0be15f18b905f53c21" title="Lecture d&#39;un Objet_U sur un flot d&#39;entree Methode a surcharger.">Chimie::readOn</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00054"></a>00054 {
<a name="l00055"></a>00055   <a class="code" href="classChimie.html#a526be31d311d6f22b6a393a16bcbf97d">modele_micro_melange_</a>=0;
<a name="l00056"></a>00056   <a class="code" href="classChimie.html#ae95e5b28a059aaffcc084d836fa6ac33">constante_modele_micro_melange_</a>=1.;
<a name="l00057"></a>00057   <a class="code" href="classParam.html" title="Defined below in this file.">Param</a> param(<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>());
<a name="l00058"></a>00058   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;reactions&quot;</span>,&amp;<a class="code" href="classChimie.html#aafb7de1d50046bf7bc29d81b1da78030">reactions_</a>,<a class="code" href="classParam.html#aa4ad0ca1d49bc5f2ebc5fc83ee9df384aaf5b6dfac1c5970478525407cc6ac572">Param::REQUIRED</a>);
<a name="l00059"></a>00059   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;modele_micro_melange&quot;</span>,&amp;<a class="code" href="classChimie.html#a526be31d311d6f22b6a393a16bcbf97d">modele_micro_melange_</a>);
<a name="l00060"></a>00060   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;constante_modele_micro_melange&quot;</span>,&amp;<a class="code" href="classChimie.html#ae95e5b28a059aaffcc084d836fa6ac33">constante_modele_micro_melange_</a>);
<a name="l00061"></a>00061   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;espece_en_competition_micro_melange&quot;</span>,&amp;<a class="code" href="classChimie.html#a07a35e6eb9eda6c5a8c2e4b172692f01">espece_en_competition_micro_melange_</a>);
<a name="l00062"></a>00062   param.<a class="code" href="classParam.html#aa9d44fc51b4a08b357733a97dc7acaad" title="Read the is input with the parameters (defined with the Param object) inside: { ... } Example, to read: { a 1 b 2 } Param param(que_suis_je()); int a,b; param.ajouter(&quot;a&quot;,&amp;a); param.ajouter(&quot;b&quot;,&amp;b); param.lire_avec_accolades_depuis(is);.">lire_avec_accolades_depuis</a>(is);
<a name="l00063"></a>00063   <span class="keywordflow">return</span> is;
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 }
<a name="l00066"></a>00066 
<a name="l00067"></a><a class="code" href="classChimie.html#a840753a481736d677d4bad76c3052449">00067</a> <span class="keywordtype">double</span> <a class="code" href="classChimie.html#a840753a481736d677d4bad76c3052449">Chimie::calculer_pas_de_temps</a>()<span class="keyword"> const</span>
<a name="l00068"></a>00068 <span class="keyword"></span>{
<a name="l00069"></a>00069   <span class="keywordtype">double</span> dt=1e30;
<a name="l00070"></a>00070   <span class="keywordtype">double</span> dt_reaction;
<a name="l00071"></a>00071   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classChimie.html#aafb7de1d50046bf7bc29d81b1da78030">reactions_</a>.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>(); i++) <span class="comment">//!&lt; boucle sur l&#39;ensemble des reactions</span>
<a name="l00072"></a>00072 <span class="comment"></span>    {
<a name="l00073"></a>00073       dt_reaction=<a class="code" href="classChimie.html#aafb7de1d50046bf7bc29d81b1da78030">reactions_</a>[i].calculer_pas_de_temps();
<a name="l00074"></a>00074       <span class="keywordflow">if</span>(i==0) <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a>&lt;&lt;<span class="stringliteral">&quot;Pour le(s) reaction(s), dt_max = &quot;</span>;
<a name="l00075"></a>00075       <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a>&lt;&lt;dt_reaction&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00076"></a>00076       <span class="keywordflow">if</span> (i==(<a class="code" href="classChimie.html#aafb7de1d50046bf7bc29d81b1da78030">reactions_</a>.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>()-1)) <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00077"></a>00077       dt=<a class="code" href="Double_8h.html#a2f8edc4561e9744ed4233b205fa7ec32">min</a>(dt,dt_reaction);
<a name="l00078"></a>00078     }
<a name="l00079"></a>00079 <span class="comment">// double dt_n=pb_-&gt;schema_temps().pas_de_temps();</span>
<a name="l00080"></a>00080 <span class="comment">// filtre Butterworth :</span>
<a name="l00081"></a>00081 <span class="comment">// alpha=1    -&gt; pas de filtre</span>
<a name="l00082"></a>00082 <span class="comment">// alpha-&gt;0   -&gt; tres filtre</span>
<a name="l00083"></a>00083 <span class="comment">// double alpha_Butterworth=1.;</span>
<a name="l00084"></a>00084 <span class="comment">// return (dt_n*(1.-alpha_Butterworth)+alpha_Butterworth*dt);</span>
<a name="l00085"></a>00085   <span class="keywordflow">return</span> dt;
<a name="l00086"></a>00086 }
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 
<a name="l00090"></a><a class="code" href="classChimie.html#a879d4fd372c9688892029835724e4a9e">00090</a> <span class="keywordtype">void</span>  <a class="code" href="classChimie.html#a879d4fd372c9688892029835724e4a9e">Chimie::completer</a>(<span class="keyword">const</span> <a class="code" href="classProbleme__base.html" title="classe Probleme_base C&#39;est un Probleme_U qui n&#39;est pas un couplage. Le role d&#39;un Probleme_base est la...">Probleme_base</a>&amp; pb)
<a name="l00091"></a>00091 {
<a name="l00092"></a>00092 <span class="comment">// si pas de reaction on ne fait rien</span>
<a name="l00093"></a>00093   <span class="keywordflow">if</span> (<a class="code" href="classChimie.html#aafb7de1d50046bf7bc29d81b1da78030">reactions_</a>.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>()==0)
<a name="l00094"></a>00094     <span class="keywordflow">return</span>;
<a name="l00095"></a>00095   <a class="code" href="classChimie.html#aceb92f4cad753d76f9c34761d8c462eb">pb_</a>=pb;
<a name="l00096"></a>00096 <span class="comment">// 1) determination du nombre de FM</span>
<a name="l00097"></a>00097   <span class="keywordtype">int</span> nb_fm=0;
<a name="l00098"></a>00098   <span class="keywordtype">int</span> nb_grains=0;
<a name="l00099"></a>00099   <span class="keywordtype">int</span> nb_concentration=0;
<a name="l00100"></a>00100 <span class="comment">// Motcles alias;</span>
<a name="l00101"></a>00101   <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> masses_molaires;
<a name="l00102"></a>00102   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n=0; n&lt;pb.<a class="code" href="classProbleme__base.html#abefceb0ac0d0b35d42a4daaa82a95f59">nombre_d_equations</a>(); n ++)
<a name="l00103"></a>00103     {
<a name="l00104"></a>00104 
<a name="l00105"></a>00105       <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classConvection__Diffusion__Concentration.html" title="classe Convection_Diffusion_Concentration Cas particulier de Convection_Diffusion_std pour un ou plus...">Convection_Diffusion_Concentration</a>,pb.<a class="code" href="classProbleme__base.html#ae97586575b7e510d7945ce3a894b806a">equation</a>(n)))
<a name="l00106"></a>00106         nb_concentration++;
<a name="l00107"></a>00107 
<a name="l00108"></a>00108     }
<a name="l00109"></a>00109 
<a name="l00110"></a>00110 <span class="comment">// 2 stockage des alias et des masses molaires</span>
<a name="l00111"></a>00111   masses_molaires.<a class="code" href="classArrOfDouble.html#a610464f4b3dccac6f814915b526783ed">resize_array</a>(nb_grains+nb_fm+nb_concentration);
<a name="l00112"></a>00112   <a class="code" href="classChimie.html#aa2347648dbfaf574784e276a933ff0ea">alias</a>.<a class="code" href="classvect__impl.html#ad841d6b676a796bae26ed2566b7b3b41">dimensionner</a>(nb_grains+nb_fm+nb_concentration);
<a name="l00113"></a>00113   <a class="code" href="classChimie.html#adb5f62794aea1e9d49c74636b91c3489">nb_grains_</a>=nb_grains;
<a name="l00114"></a>00114   <span class="keywordtype">int</span> nb=0;
<a name="l00115"></a>00115   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n=0; n&lt;pb.<a class="code" href="classProbleme__base.html#abefceb0ac0d0b35d42a4daaa82a95f59">nombre_d_equations</a>(); n ++)
<a name="l00116"></a>00116     {
<a name="l00117"></a>00117       <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classConvection__Diffusion__Concentration.html" title="classe Convection_Diffusion_Concentration Cas particulier de Convection_Diffusion_std pour un ou plus...">Convection_Diffusion_Concentration</a>,pb.<a class="code" href="classProbleme__base.html#ae97586575b7e510d7945ce3a894b806a">equation</a>(n)))
<a name="l00118"></a>00118         {
<a name="l00119"></a>00119           <span class="keyword">const</span> <a class="code" href="classConvection__Diffusion__Concentration.html" title="classe Convection_Diffusion_Concentration Cas particulier de Convection_Diffusion_std pour un ou plus...">Convection_Diffusion_Concentration</a>&amp; eq= <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classConvection__Diffusion__Concentration.html" title="classe Convection_Diffusion_Concentration Cas particulier de Convection_Diffusion_std pour un ou plus...">Convection_Diffusion_Concentration</a>,pb.<a class="code" href="classProbleme__base.html#ae97586575b7e510d7945ce3a894b806a">equation</a>(n));
<a name="l00120"></a>00120           masses_molaires[nb]=eq.<a class="code" href="classConvection__Diffusion__Concentration.html#aa9ee9da0482577c356b24ae199bc2170">masse_molaire</a>();
<a name="l00121"></a>00121           <a class="code" href="classChimie.html#aa2347648dbfaf574784e276a933ff0ea">alias</a>[nb]=eq.<a class="code" href="classConvection__Diffusion__Concentration.html#a92cd4fe57276ed5fca55cf00e6900d82" title="Renvoie le champ inconnue de l&#39;equation: la concentration. (version const)">inconnue</a>().<a class="code" href="classDeriv__Champ__Inc__base.html#a9e0b743a3e124e7114fa977b36b68225">valeur</a>().<a class="code" href="classField__base.html#ae1377124eabe8387aced762115b062bb" title="Renvoie le nom du champ.">le_nom</a>();
<a name="l00122"></a>00122           <a class="code" href="Ref_8h.html#aab5720a5c34da14028d0745e386aaa01">REF</a>(<a class="code" href="classChamp__Inc__base.html" title="Classe Champ_Inc_base Classe de base des champs inconnues qui sont les champs calcules par une equati...">Champ_Inc_base</a>) inco;
<a name="l00123"></a>00123           inco = eq.<a class="code" href="classConvection__Diffusion__Concentration.html#a92cd4fe57276ed5fca55cf00e6900d82" title="Renvoie le champ inconnue de l&#39;equation: la concentration. (version const)">inconnue</a>().<a class="code" href="classDeriv__Champ__Inc__base.html#a9e0b743a3e124e7114fa977b36b68225">valeur</a>();
<a name="l00124"></a>00124           <a class="code" href="classChimie.html#a928549d7af6472c0de9dfd6802b08cdc">liste_C_</a>.<a class="code" href="classVect__Ref__Champ__Inc__base.html#a287da0e395c94d18eb50d00c229e2a39">add</a>(inco);
<a name="l00125"></a>00125           nb++;
<a name="l00126"></a>00126         }
<a name="l00127"></a>00127     }
<a name="l00128"></a>00128   assert(<a class="code" href="classChimie.html#a8ff157e50f92435e986d98ed6d7a21ce">liste_ai_</a>.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>()==<a class="code" href="classChimie.html#adb5f62794aea1e9d49c74636b91c3489">nb_grains_</a>);
<a name="l00129"></a>00129 <span class="comment">// verification de l&#39;unicite des  alias</span>
<a name="l00130"></a>00130   <a class="code" href="classChimie.html#a8eb403ed13ee58a17ca8a23e0ea54ba8">marqueur_espece_en_competition_micro_melange_</a>=-1;
<a name="l00131"></a>00131   {
<a name="l00132"></a>00132     <a class="code" href="List_8h.html#a3149526fb499ddb08728c87daa32c5ad">LIST</a>(<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>) <a class="code" href="Op__Grad__EF_8cpp.html#abc0897c211f7aa4541da5833388f868b">test</a>;
<a name="l00133"></a>00133     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n=0; n&lt;<a class="code" href="classChimie.html#aa2347648dbfaf574784e276a933ff0ea">alias</a>.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>(); n++)
<a name="l00134"></a>00134       {
<a name="l00135"></a>00135         <span class="keywordtype">int</span> deja=<a class="code" href="Op__Grad__EF_8cpp.html#abc0897c211f7aa4541da5833388f868b">test</a>.contient(<a class="code" href="classChimie.html#aa2347648dbfaf574784e276a933ff0ea">alias</a>[n]);
<a name="l00136"></a>00136         <span class="keywordflow">if</span> (!deja)
<a name="l00137"></a>00137           <a class="code" href="Op__Grad__EF_8cpp.html#abc0897c211f7aa4541da5833388f868b">test</a>.add(<a class="code" href="classChimie.html#aa2347648dbfaf574784e276a933ff0ea">alias</a>[n]);
<a name="l00138"></a>00138         <span class="keywordflow">else</span>
<a name="l00139"></a>00139           {
<a name="l00140"></a>00140             <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<a class="code" href="classChimie.html#aa2347648dbfaf574784e276a933ff0ea">alias</a>[n] &lt;&lt;<span class="stringliteral">&quot; defini plusieurs fois !!!!!&quot;</span>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00141"></a>00141 <span class="comment">// Cerr&lt;&lt;test&lt;&lt; &quot; &quot;&lt;&lt;alias&lt;&lt;finl;</span>
<a name="l00142"></a>00142             <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00143"></a>00143           }
<a name="l00144"></a>00144         <span class="keywordflow">if</span> (<a class="code" href="classChimie.html#a07a35e6eb9eda6c5a8c2e4b172692f01">espece_en_competition_micro_melange_</a>!=<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>())
<a name="l00145"></a>00145           {
<a name="l00146"></a>00146             <span class="keywordflow">if</span> (<a class="code" href="classChimie.html#a07a35e6eb9eda6c5a8c2e4b172692f01">espece_en_competition_micro_melange_</a>==<a class="code" href="classChimie.html#aa2347648dbfaf574784e276a933ff0ea">alias</a>[n])
<a name="l00147"></a>00147               marqueur_espece_en_competition_micro_melange_=n;
<a name="l00148"></a>00148           }
<a name="l00149"></a>00149       }
<a name="l00150"></a>00150     assert(<a class="code" href="Op__Grad__EF_8cpp.html#abc0897c211f7aa4541da5833388f868b">test</a>.size()==nb_fm+<a class="code" href="classChimie.html#adb5f62794aea1e9d49c74636b91c3489">nb_grains_</a>+nb_concentration);
<a name="l00151"></a>00151   }
<a name="l00152"></a>00152   <span class="keywordflow">if</span> (<a class="code" href="classChimie.html#a07a35e6eb9eda6c5a8c2e4b172692f01">espece_en_competition_micro_melange_</a>!=<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>())
<a name="l00153"></a>00153     {
<a name="l00154"></a>00154       <span class="keywordflow">if</span> (marqueur_espece_en_competition_micro_melange_==-1)
<a name="l00155"></a>00155         {
<a name="l00156"></a>00156           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot; espece_en_competition_micro_melange non trouve: &quot;</span>&lt;&lt; <a class="code" href="classChimie.html#a07a35e6eb9eda6c5a8c2e4b172692f01">espece_en_competition_micro_melange_</a>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00157"></a>00157           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00158"></a>00158         }
<a name="l00159"></a>00159       <span class="keywordflow">else</span>
<a name="l00160"></a>00160         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot; marqueur_espece_en_competition_micro_melange &quot;</span>&lt;&lt;marqueur_espece_en_competition_micro_melange_&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00161"></a>00161     }
<a name="l00162"></a>00162   <span class="keywordflow">if</span>(<a class="code" href="ArrOfDouble_8cpp.html#abd3998749a1a8dab00dd6ac1798327fb" title="Retourne la valeur minimale.">min_array</a>(masses_molaires)&lt;0)
<a name="l00163"></a>00163     {
<a name="l00164"></a>00164       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt; <span class="stringliteral">&quot;pb avec les masses_molaires &quot;</span>&lt;&lt;masses_molaires&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00165"></a>00165       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00166"></a>00166     }
<a name="l00167"></a>00167   <span class="keywordflow">if</span> (<a class="code" href="classChimie.html#ae3cc3af864e13796764ea5a1dfbb21cc">liste_Y_</a>.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>()&gt;0)
<a name="l00168"></a>00168     {
<a name="l00169"></a>00169       <a class="code" href="classChimie.html#acae21dd4f30a77f5873b13e70c43f8b4">Puissance_volumique_</a>=(<a class="code" href="classChimie.html#ae3cc3af864e13796764ea5a1dfbb21cc">liste_Y_</a>[0].valeur().valeurs()); <span class="comment">//!&lt; dimensionnement du tableau...</span>
<a name="l00170"></a>00170 <span class="comment"></span>      <a class="code" href="classChimie.html#acae21dd4f30a77f5873b13e70c43f8b4">Puissance_volumique_</a>=0.;
<a name="l00171"></a>00171     }
<a name="l00172"></a>00172   <span class="keywordflow">else</span>
<a name="l00173"></a>00173     {
<a name="l00174"></a>00174       assert(<a class="code" href="classChimie.html#a928549d7af6472c0de9dfd6802b08cdc">liste_C_</a>.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>()!=0);
<a name="l00175"></a>00175     }
<a name="l00176"></a>00176 <span class="comment">// alias_=alias;</span>
<a name="l00177"></a>00177   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classChimie.html#aafb7de1d50046bf7bc29d81b1da78030">reactions_</a>.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>(); i++)
<a name="l00178"></a>00178     {
<a name="l00179"></a>00179       <a class="code" href="classChimie.html#aafb7de1d50046bf7bc29d81b1da78030">reactions_</a>[i].completer(<a class="code" href="classChimie.html#aa2347648dbfaf574784e276a933ff0ea">alias</a>,masses_molaires);
<a name="l00180"></a>00180     }
<a name="l00181"></a>00181 }
<a name="l00182"></a>00182 
<a name="l00183"></a><a class="code" href="classChimie.html#a10144c4d0e7329dc6ee269fac6e08276">00183</a> <span class="keywordtype">void</span> <a class="code" href="classChimie.html#a10144c4d0e7329dc6ee269fac6e08276">Chimie::discretiser</a>(<span class="keyword">const</span> <a class="code" href="classProbleme__base.html" title="classe Probleme_base C&#39;est un Probleme_U qui n&#39;est pas un couplage. Le role d&#39;un Probleme_base est la...">Probleme_base</a>&amp; pb)
<a name="l00184"></a>00184 {
<a name="l00185"></a>00185   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classChimie.html#aafb7de1d50046bf7bc29d81b1da78030">reactions_</a>.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>(); i++)
<a name="l00186"></a>00186     {
<a name="l00187"></a>00187       <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> <a class="code" href="Op__Grad__EF_8cpp.html#abc0897c211f7aa4541da5833388f868b">test</a>(<span class="stringliteral">&quot;omega_&quot;</span>);
<a name="l00188"></a>00188       test+=<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(i);
<a name="l00189"></a>00189       <a class="code" href="classChimie.html#aafb7de1d50046bf7bc29d81b1da78030">reactions_</a>[i].discretiser_omega(pb,test);
<a name="l00190"></a>00190     }
<a name="l00191"></a>00191 }
<a name="l00192"></a>00192 
<a name="l00193"></a><a class="code" href="classChimie.html#a4aa0318c40d436bcecf54c97f72689e3">00193</a> <span class="keywordtype">int</span> <a class="code" href="classChimie.html#a4aa0318c40d436bcecf54c97f72689e3">Chimie::preparer_calcul</a>()
<a name="l00194"></a>00194 {
<a name="l00195"></a>00195   <span class="keywordflow">return</span> 1;
<a name="l00196"></a>00196 }
<a name="l00197"></a>00197 
<a name="l00198"></a>00198 
<a name="l00199"></a>00199 
<a name="l00200"></a><a class="code" href="classChimie.html#a7d0e7af6883488d8f032ca7f32be392c">00200</a> <span class="keywordtype">void</span>  <a class="code" href="classChimie.html#a7d0e7af6883488d8f032ca7f32be392c">Chimie::mettre_a_jour</a>(<span class="keywordtype">double</span> temps)
<a name="l00201"></a>00201 {
<a name="l00202"></a>00202   <span class="keywordflow">if</span> (<a class="code" href="classChimie.html#aafb7de1d50046bf7bc29d81b1da78030">reactions_</a>.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>()==0) <span class="comment">//!&lt; pas de reaction</span>
<a name="l00203"></a>00203 <span class="comment"></span>    <span class="keywordflow">return</span>;
<a name="l00204"></a>00204 
<a name="l00205"></a>00205   <span class="keywordtype">double</span> dt=<a class="code" href="classChimie.html#aceb92f4cad753d76f9c34761d8c462eb">pb_</a>-&gt;schema_temps().pas_de_temps();
<a name="l00206"></a>00206 
<a name="l00207"></a>00207   <span class="keywordflow">if</span> (<a class="code" href="classChimie.html#a928549d7af6472c0de9dfd6802b08cdc">liste_C_</a>.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>())
<a name="l00208"></a>00208     {
<a name="l00209"></a>00209 <span class="comment">// On suppose qu&#39;il n&#39;y a pas de temperature pour l&#39;instant...</span>
<a name="l00210"></a>00210       <span class="keywordtype">int</span> old=0;
<a name="l00211"></a>00211       <span class="keywordtype">int</span> nbr=<a class="code" href="classChimie.html#aafb7de1d50046bf7bc29d81b1da78030">reactions_</a>.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>();
<a name="l00212"></a>00212       <span class="keywordflow">if</span> (old)
<a name="l00213"></a>00213         {
<a name="l00214"></a>00214           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nbr; i++)
<a name="l00215"></a>00215             {
<a name="l00216"></a>00216               <a class="code" href="classReaction.html">Reaction</a>&amp; reaction=<a class="code" href="classChimie.html#aafb7de1d50046bf7bc29d81b1da78030">reactions_</a>[i];
<a name="l00217"></a>00217               <span class="keywordtype">int</span> nb_sous_pas_de_temps_reaction=reaction.<a class="code" href="classReaction.html#af5607eb954ada443a388105bbbf318b9">nb_sous_pas_de_temps_reaction</a>();
<a name="l00218"></a>00218 
<a name="l00219"></a>00219               <span class="keyword">const</span> <span class="keywordtype">double</span> dt_chimie=dt/nb_sous_pas_de_temps_reaction;
<a name="l00220"></a>00220               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n=0; n&lt;nb_sous_pas_de_temps_reaction; n++)
<a name="l00221"></a>00221                 reaction.<a class="code" href="classReaction.html#a3b1cb92bd9ea0589e99090f40cc81c78">reagir</a>(<a class="code" href="classChimie.html#a928549d7af6472c0de9dfd6802b08cdc">liste_C_</a>,dt_chimie);
<a name="l00222"></a>00222             }
<a name="l00223"></a>00223 
<a name="l00224"></a>00224           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classChimie.html#a928549d7af6472c0de9dfd6802b08cdc">liste_C_</a>.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>(); i++)
<a name="l00225"></a>00225             <a class="code" href="classChimie.html#a928549d7af6472c0de9dfd6802b08cdc">liste_C_</a>[i].<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>().valeurs().echange_espace_virtuel();
<a name="l00226"></a>00226           <span class="keywordflow">return</span>;
<a name="l00227"></a>00227         }
<a name="l00228"></a>00228       <span class="keywordtype">int</span> vef=0;
<a name="l00229"></a>00229       <a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>&amp; zvf = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>,<a class="code" href="classChimie.html#a928549d7af6472c0de9dfd6802b08cdc">liste_C_</a>[0].<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>().equation().zone_dis().<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>());
<a name="l00230"></a>00230 <span class="comment">// if (sub_type(Zone_VEF, zvf))</span>
<a name="l00231"></a>00231       <span class="keywordflow">if</span> (zvf.<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>().<a class="code" href="classNom.html#a41b0ba18fb90d481c0828ed4372de8ee">debute_par</a>(<span class="stringliteral">&quot;Zone_VEF&quot;</span>))
<a name="l00232"></a>00232         vef=1;
<a name="l00233"></a>00233 
<a name="l00234"></a>00234       <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; face_voisins = zvf.<a class="code" href="classZone__VF.html#a49d4322f5585a8fa95748ca785b70702" title="renvoie l&#39;element voisin de numface dans la direction i. i=0 : dans le sens oppose de l&#39;axe orthogona...">face_voisins</a>();
<a name="l00235"></a>00235       <span class="keyword">const</span> <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a>&amp; volume=zvf.<a class="code" href="classZone__VF.html#aea771c835e561469d2d21dbca5fac1cf" title="renvoie le volume de la maille i.">volumes</a>();
<a name="l00236"></a>00236       <span class="keywordtype">int</span> newd=1;
<a name="l00237"></a>00237       <span class="keywordflow">if</span> (newd)
<a name="l00238"></a>00238         {
<a name="l00239"></a>00239           <span class="keywordtype">int</span> nbrtot=0;
<a name="l00240"></a>00240           <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> marq_contre(2*nbr);
<a name="l00241"></a>00241           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nbr; i++)
<a name="l00242"></a>00242             {
<a name="l00243"></a>00243               <a class="code" href="classReaction.html">Reaction</a>&amp; reaction=<a class="code" href="classChimie.html#aafb7de1d50046bf7bc29d81b1da78030">reactions_</a>[i];
<a name="l00244"></a>00244               marq_contre(nbrtot++)=i+1;
<a name="l00245"></a>00245               <span class="keywordflow">if</span> (reaction.<a class="code" href="classReaction.html#a400d5d750ff07ec6ecb9c2c6c2f0a254" title="prefacteur">contre_reaction_</a>&gt;0)
<a name="l00246"></a>00246                 marq_contre(nbrtot++)=-(i+1);
<a name="l00247"></a>00247 
<a name="l00248"></a>00248               <span class="keywordflow">if</span> ((reaction.<a class="code" href="classReaction.html#ac85c82adb4c576a9c3d31c1c71c74ab9">beta_</a>!=0)||(reaction.<a class="code" href="classReaction.html#a462b458c41064a1c433cd6bdee37e84e" title="en J/mol">Ea_</a>!=0)||((reaction.c_r_Ea_!=0)&amp;&amp;(reaction.<a class="code" href="classReaction.html#a400d5d750ff07ec6ecb9c2c6c2f0a254" title="prefacteur">contre_reaction_</a>&gt;0)))
<a name="l00249"></a>00249                 {
<a name="l00250"></a>00250                   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;Reaction :  Donnees incompatibles avec le fait que l on n a pas de temperature&quot;</span>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00251"></a>00251                   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;reaction&lt;&lt;finl;
<a name="l00252"></a>00252                   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00253"></a>00253                 }
<a name="l00254"></a>00254             }
<a name="l00255"></a>00255           marq_contre.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(nbrtot);
<a name="l00256"></a>00256 
<a name="l00257"></a>00257           <span class="keywordtype">int</span> nbc=<a class="code" href="classChimie.html#a928549d7af6472c0de9dfd6802b08cdc">liste_C_</a>.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>();
<a name="l00258"></a>00258 
<a name="l00259"></a>00259           <a class="code" href="arch_8h.html#a9b91c72ded7de2f0b393ea75de53929b">F77NAME</a>(<a class="code" href="dlsinterf_8h.html#ae50c7a4693ca6eff220ad349acbe69db">INITTAILLECOMMON</a>)(&amp;nbrtot,&amp;nbc);
<a name="l00260"></a>00260           <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> pstochio(nbc);
<a name="l00261"></a>00261           <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> pactivite(nbc);
<a name="l00262"></a>00262           <a class="code" href="arch_8h.html#a9b91c72ded7de2f0b393ea75de53929b">F77NAME</a>(<a class="code" href="dlsinterf_8h.html#a661784dc177271587781b7727d30321e">SETMARQUEUR</a>)(&amp;<a class="code" href="classChimie.html#a8eb403ed13ee58a17ca8a23e0ea54ba8">marqueur_espece_en_competition_micro_melange_</a>);
<a name="l00263"></a>00263           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nbrtot; i++)
<a name="l00264"></a>00264             {
<a name="l00265"></a>00265               <span class="keywordtype">int</span> ir=marq_contre(i);
<a name="l00266"></a>00266               <span class="keywordtype">int</span> ir2=ir;
<a name="l00267"></a>00267               <span class="keywordflow">if</span> (ir&lt;0) ir2=-ir2;
<a name="l00268"></a>00268               ir2-=1;
<a name="l00269"></a>00269               <a class="code" href="classReaction.html">Reaction</a>&amp; reaction=<a class="code" href="classChimie.html#aafb7de1d50046bf7bc29d81b1da78030">reactions_</a>[ir2];
<a name="l00270"></a>00270               pstochio=reaction.<a class="code" href="classReaction.html#aeecfd99d4d26fdfe7d4fb3505071a6e9">coeff_stoechio_</a>;
<a name="l00271"></a>00271               pactivite=0;
<a name="l00272"></a>00272 
<a name="l00273"></a>00273               <span class="keywordtype">double</span> <a class="code" href="common__chimie_8h.html#a9bf873a885e7409fec9a1b755a3c4854">cw</a>=reaction.<a class="code" href="classReaction.html#aaaf1c2066e06aa4b15608c5d8ebb0c88">constante_taux_reaction_</a>;
<a name="l00274"></a>00274               <span class="keywordflow">if</span> (ir&lt;0)
<a name="l00275"></a>00275                 {
<a name="l00276"></a>00276                   pstochio*=-1;
<a name="l00277"></a>00277                   assert(reaction.<a class="code" href="classReaction.html#a400d5d750ff07ec6ecb9c2c6c2f0a254" title="prefacteur">contre_reaction_</a>&gt;0);
<a name="l00278"></a>00278                   cw/=reaction.<a class="code" href="classReaction.html#a400d5d750ff07ec6ecb9c2c6c2f0a254" title="prefacteur">contre_reaction_</a>;
<a name="l00279"></a>00279                 }
<a name="l00280"></a>00280               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ic=0; ic&lt;nbc; ic++)
<a name="l00281"></a>00281                 {
<a name="l00282"></a>00282                   <span class="keywordflow">if</span> (pstochio[ic]&gt;0)
<a name="l00283"></a>00283                     pactivite(ic)=(int)reaction.<a class="code" href="classReaction.html#a536588bb0e0746f374aab18403446a46">coeff_activite_</a>[ic];
<a name="l00284"></a>00284                 }
<a name="l00285"></a>00285               <span class="keywordtype">int</span> ii=i+1;
<a name="l00286"></a>00286               <span class="keywordtype">int</span> avec_contre_reaction=(reaction.<a class="code" href="classReaction.html#a400d5d750ff07ec6ecb9c2c6c2f0a254" title="prefacteur">contre_reaction_</a>&gt;0);
<a name="l00287"></a>00287               <a class="code" href="arch_8h.html#a9b91c72ded7de2f0b393ea75de53929b">F77NAME</a>(<a class="code" href="dlsinterf_8h.html#af52ef1502997b6eca9faa93c04e2ec74">INITREACTIONCOMMON</a>)(&amp;(ii), pstochio.<a class="code" href="classArrOfDouble.html#a95357a1390c11dbd481d385257f2e983" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>(), pactivite.<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>(),&amp;avec_contre_reaction) ;
<a name="l00288"></a>00288               <a class="code" href="arch_8h.html#a9b91c72ded7de2f0b393ea75de53929b">F77NAME</a>(<a class="code" href="dlsinterf_8h.html#a7f7cadfd2357882b3ee8dc439bd64b18">SETCWREACTION</a>)(&amp;(ii), &amp;cw);
<a name="l00289"></a>00289 
<a name="l00290"></a>00290             }
<a name="l00291"></a>00291 <span class="comment">// F77NAME(PRINT_COMMON)();</span>
<a name="l00292"></a>00292 <span class="comment">// abort();</span>
<a name="l00293"></a>00293           <span class="keywordtype">int</span> mf=21;
<a name="l00294"></a>00294           <span class="keywordtype">int</span> lrw;
<a name="l00295"></a>00295           <span class="keywordtype">int</span> liw;
<a name="l00296"></a>00296           <span class="keywordflow">if</span> (mf==21)
<a name="l00297"></a>00297             {
<a name="l00298"></a>00298               liw=20+nbc;
<a name="l00299"></a>00299               lrw=22+9*nbc+nbc*nbc;
<a name="l00300"></a>00300             }
<a name="l00301"></a>00301           <span class="keywordflow">else</span>
<a name="l00302"></a>00302             <span class="keywordflow">throw</span>;
<a name="l00303"></a>00303           assert(mf==21);
<a name="l00304"></a>00304 
<a name="l00305"></a>00305 
<a name="l00306"></a>00306           <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> rwork(lrw);
<a name="l00307"></a>00307           <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> iwork(liw);
<a name="l00308"></a>00308 
<a name="l00309"></a>00309 
<a name="l00310"></a>00310           <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> <a class="code" href="common__chimie_8h.html#acc2ff2d2cfc56d8be575a38f67ac627e">tau_mel</a>;
<a name="l00311"></a>00311           <span class="keywordflow">if</span> (<a class="code" href="classChimie.html#a526be31d311d6f22b6a393a16bcbf97d">modele_micro_melange_</a>&gt;0)
<a name="l00312"></a>00312             {
<a name="l00313"></a>00313 
<a name="l00314"></a>00314               <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; visc_turb=<a class="code" href="classChimie.html#a928549d7af6472c0de9dfd6802b08cdc">liste_C_</a>[0].valeur().equation().probleme().get_champ(<span class="stringliteral">&quot;viscosite_turbulente&quot;</span>).valeurs();
<a name="l00315"></a>00315               tau_mel=visc_turb;
<a name="l00316"></a>00316               <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; D_moleculaire = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classConvection__Diffusion__Concentration.html" title="classe Convection_Diffusion_Concentration Cas particulier de Convection_Diffusion_std pour un ou plus...">Convection_Diffusion_Concentration</a>,<a class="code" href="classChimie.html#a928549d7af6472c0de9dfd6802b08cdc">liste_C_</a>[0].<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>().equation()).constituant().diffusivite_constituant().valeurs();
<a name="l00317"></a>00317               <span class="keywordtype">double</span> D_mol=0.;
<a name="l00318"></a>00318               <span class="keywordflow">if</span> (D_moleculaire.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0) == 1)
<a name="l00319"></a>00319                 D_mol = D_moleculaire(0, 0);
<a name="l00320"></a>00320               <span class="keywordflow">else</span>
<a name="l00321"></a>00321                 {
<a name="l00322"></a>00322                   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;D_mol pas code pour champ non uniforme&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00323"></a>00323                   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00324"></a>00324                 }
<a name="l00325"></a>00325               <span class="keywordtype">double</span> invsct=1./0.9;
<a name="l00326"></a>00326               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> element=0; element&lt;visc_turb.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0); element++)
<a name="l00327"></a>00327                 {
<a name="l00328"></a>00328                   <span class="keywordtype">double</span> delta=exp(log(volume[element])/<span class="keywordtype">double</span>(<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>));
<a name="l00329"></a>00329 <span class="comment">// Cerr&lt;&lt;&quot; iii &quot;&lt;&lt;delta&lt;&lt;&quot; &quot;&lt;&lt;D_mol&lt;&lt;finl;</span>
<a name="l00330"></a>00330                   <a class="code" href="common__chimie_8h.html#acc2ff2d2cfc56d8be575a38f67ac627e">tau_mel</a>(element)=<a class="code" href="classChimie.html#ae95e5b28a059aaffcc084d836fa6ac33">constante_modele_micro_melange_</a>*delta*delta/(D_mol+visc_turb(element)*invsct);
<a name="l00331"></a>00331                 }
<a name="l00332"></a>00332               tau_mel.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l00333"></a>00333             }
<a name="l00334"></a>00334           <span class="keywordtype">int</span> nb_elem=<a class="code" href="classChimie.html#a928549d7af6472c0de9dfd6802b08cdc">liste_C_</a>[0].valeur().valeurs().<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>();
<a name="l00335"></a>00335           <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> C(nbc);
<a name="l00336"></a>00336 
<a name="l00337"></a>00337           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> elem=0; elem&lt;nb_elem; elem++)
<a name="l00338"></a>00338             {
<a name="l00339"></a>00339 
<a name="l00340"></a>00340               <span class="keywordtype">double</span> tau_melange=-1;
<a name="l00341"></a>00341               <span class="keywordflow">if</span> (<a class="code" href="classChimie.html#a526be31d311d6f22b6a393a16bcbf97d">modele_micro_melange_</a>&gt;0)
<a name="l00342"></a>00342                 {
<a name="l00343"></a>00343                   <span class="keywordflow">if</span> (vef==0)
<a name="l00344"></a>00344                     tau_melange=<a class="code" href="common__chimie_8h.html#acc2ff2d2cfc56d8be575a38f67ac627e">tau_mel</a>(elem);
<a name="l00345"></a>00345                   <span class="keywordflow">else</span>
<a name="l00346"></a>00346                     {
<a name="l00347"></a>00347                       <span class="keywordflow">if</span> (face_voisins(elem,1)!=-1)
<a name="l00348"></a>00348                         tau_melange = 0.5*(<a class="code" href="common__chimie_8h.html#acc2ff2d2cfc56d8be575a38f67ac627e">tau_mel</a>(face_voisins(elem,0))+<a class="code" href="common__chimie_8h.html#acc2ff2d2cfc56d8be575a38f67ac627e">tau_mel</a>(face_voisins(elem,1)));
<a name="l00349"></a>00349                       <span class="keywordflow">else</span>
<a name="l00350"></a>00350                         tau_melange = (<a class="code" href="common__chimie_8h.html#acc2ff2d2cfc56d8be575a38f67ac627e">tau_mel</a>(face_voisins(elem,0)));
<a name="l00351"></a>00351                     }
<a name="l00352"></a>00352                 }
<a name="l00353"></a>00353 <span class="comment">// tau_melange &lt;0 pas pris en compte</span>
<a name="l00354"></a>00354 <span class="comment">// recuperation des valeurs initiales</span>
<a name="l00355"></a>00355               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nbc; i++)
<a name="l00356"></a>00356                 {
<a name="l00357"></a>00357                   C(i)=<a class="code" href="classChimie.html#a928549d7af6472c0de9dfd6802b08cdc">liste_C_</a>[i].valeur().valeurs()(elem);
<a name="l00358"></a>00358 
<a name="l00359"></a>00359                 }
<a name="l00360"></a>00360               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nbc; i++)
<a name="l00361"></a>00361                 {
<a name="l00362"></a>00362                   <span class="keywordflow">if</span> (C(i)&lt;0)
<a name="l00363"></a>00363                     {
<a name="l00364"></a>00364                       <span class="keywordflow">if</span> (C(i)&lt;-1e-5)
<a name="l00365"></a>00365                         {
<a name="l00366"></a>00366                           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot; on rabote C_&quot;</span>&lt;&lt;i&lt;&lt;<span class="stringliteral">&quot; dans la maille &quot;</span>&lt;&lt;elem&lt;&lt;<span class="stringliteral">&quot; dans la chimie !!!!!! &quot;</span>&lt;&lt;C(i)&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00367"></a>00367                           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00368"></a>00368                         }
<a name="l00369"></a>00369                       C(i)=0;
<a name="l00370"></a>00370                     }
<a name="l00371"></a>00371                 }
<a name="l00372"></a>00372               <span class="keywordtype">int</span> init=1;
<a name="l00373"></a>00373               <span class="keywordflow">if</span> (init)
<a name="l00374"></a>00374                 {
<a name="l00375"></a>00375 
<a name="l00376"></a>00376                 }
<a name="l00377"></a>00377               <span class="keywordtype">double</span> t=0,tout=dt;
<a name="l00378"></a>00378               <span class="keywordtype">int</span> itol=1;
<a name="l00379"></a>00379               <span class="keywordtype">double</span> rtol=0;
<a name="l00380"></a>00380               <span class="keywordtype">double</span> atol=1e-10;
<a name="l00381"></a>00381               <a class="code" href="arch_8h.html#a9b91c72ded7de2f0b393ea75de53929b">F77NAME</a>(<a class="code" href="dlsinterf_8h.html#a013ea79f34fd3874059e36e15c0d5ef7">DLSODECHIMIES</a>)(&amp;nbc, C.<a class="code" href="classArrOfDouble.html#a95357a1390c11dbd481d385257f2e983" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>(),&amp;t, &amp;tout,&amp;tau_melange, &amp;itol, &amp;rtol, &amp;atol, rwork.<a class="code" href="classArrOfDouble.html#a95357a1390c11dbd481d385257f2e983" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>(), &amp;lrw, iwork.<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>(), &amp;liw);
<a name="l00382"></a>00382 <span class="comment">// mise a jour des inconnues</span>
<a name="l00383"></a>00383               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classChimie.html#a928549d7af6472c0de9dfd6802b08cdc">liste_C_</a>.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>(); i++)
<a name="l00384"></a>00384                 <a class="code" href="classChimie.html#a928549d7af6472c0de9dfd6802b08cdc">liste_C_</a>[i].<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>().valeurs()(elem)=C(i);
<a name="l00385"></a>00385             }
<a name="l00386"></a>00386           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classChimie.html#a928549d7af6472c0de9dfd6802b08cdc">liste_C_</a>.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>(); i++)
<a name="l00387"></a>00387             <a class="code" href="classChimie.html#a928549d7af6472c0de9dfd6802b08cdc">liste_C_</a>[i].<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>().valeurs().echange_espace_virtuel();
<a name="l00388"></a>00388           <span class="keywordflow">return</span>;
<a name="l00389"></a>00389         }
<a name="l00390"></a>00390 <span class="comment">// on calcule le nb_sous_pas_temps_max</span>
<a name="l00391"></a>00391       <span class="keywordtype">int</span> nb_sous_pas_de_temps_reaction_max=1;
<a name="l00392"></a>00392       <span class="keywordtype">int</span> nbr_directe=0;
<a name="l00393"></a>00393 
<a name="l00394"></a>00394       <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> marq_directe(nbr);
<a name="l00395"></a>00395       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nbr; i++)
<a name="l00396"></a>00396         {
<a name="l00397"></a>00397           <a class="code" href="classReaction.html">Reaction</a>&amp; reaction=<a class="code" href="classChimie.html#aafb7de1d50046bf7bc29d81b1da78030">reactions_</a>[i];
<a name="l00398"></a>00398           <span class="keywordtype">int</span> nb_sous_pas_de_temps_reaction=reaction.<a class="code" href="classReaction.html#af5607eb954ada443a388105bbbf318b9">nb_sous_pas_de_temps_reaction</a>();
<a name="l00399"></a>00399           <span class="keywordflow">if</span> (nb_sous_pas_de_temps_reaction&gt;nb_sous_pas_de_temps_reaction_max)
<a name="l00400"></a>00400             nb_sous_pas_de_temps_reaction_max=nb_sous_pas_de_temps_reaction;
<a name="l00401"></a>00401           <span class="keywordflow">if</span> (reaction.<a class="code" href="classReaction.html#a400d5d750ff07ec6ecb9c2c6c2f0a254" title="prefacteur">contre_reaction_</a>&lt;=0)
<a name="l00402"></a>00402             marq_directe(nbr_directe++)=i;
<a name="l00403"></a>00403 
<a name="l00404"></a>00404           <span class="keywordflow">if</span> ((reaction.<a class="code" href="classReaction.html#ac85c82adb4c576a9c3d31c1c71c74ab9">beta_</a>!=0)||(reaction.<a class="code" href="classReaction.html#a462b458c41064a1c433cd6bdee37e84e" title="en J/mol">Ea_</a>!=0)||((reaction.c_r_Ea_!=0)&amp;&amp;(reaction.<a class="code" href="classReaction.html#a400d5d750ff07ec6ecb9c2c6c2f0a254" title="prefacteur">contre_reaction_</a>&gt;0)))
<a name="l00405"></a>00405             {
<a name="l00406"></a>00406               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;Reaction :  Donnees incompatibles avec le fait que l on n a pas de temperature&quot;</span>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00407"></a>00407               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;reaction&lt;&lt;finl;
<a name="l00408"></a>00408               <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00409"></a>00409             }
<a name="l00410"></a>00410         }
<a name="l00411"></a>00411       <span class="keyword">const</span> <span class="keywordtype">double</span> dt_chimie=dt/nb_sous_pas_de_temps_reaction_max;
<a name="l00412"></a>00412 
<a name="l00413"></a>00413       <span class="keywordtype">int</span> nbc=<a class="code" href="classChimie.html#a928549d7af6472c0de9dfd6802b08cdc">liste_C_</a>.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>();
<a name="l00414"></a>00414 
<a name="l00415"></a>00415 
<a name="l00416"></a>00416 <span class="comment">// double R_gaz_parfait=8.3143;</span>
<a name="l00417"></a>00417 
<a name="l00418"></a>00418       <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> C(nbc),C_tmp(nbc), proportion_eq(nbr_directe);
<a name="l00419"></a>00419 
<a name="l00420"></a>00420       <span class="keywordtype">int</span> nb_elem=<a class="code" href="classChimie.html#a928549d7af6472c0de9dfd6802b08cdc">liste_C_</a>[0].valeur().valeurs().<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>();
<a name="l00421"></a>00421       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> elem=0; elem&lt;nb_elem; elem++)
<a name="l00422"></a>00422         {
<a name="l00423"></a>00423 
<a name="l00424"></a>00424 
<a name="l00425"></a>00425 <span class="comment">// recuperation des valeurs initiales</span>
<a name="l00426"></a>00426           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nbc; i++)
<a name="l00427"></a>00427             {
<a name="l00428"></a>00428               C(i)=<a class="code" href="classChimie.html#a928549d7af6472c0de9dfd6802b08cdc">liste_C_</a>[i].valeur().valeurs()(elem);
<a name="l00429"></a>00429             }
<a name="l00430"></a>00430           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n=0; n&lt;nb_sous_pas_de_temps_reaction_max; n++)
<a name="l00431"></a>00431             {
<a name="l00432"></a>00432 <span class="comment">// rabotage eventuel</span>
<a name="l00433"></a>00433               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nbc; i++)
<a name="l00434"></a>00434                 <span class="keywordflow">if</span> (C(i)&lt;0)
<a name="l00435"></a>00435                   {
<a name="l00436"></a>00436                     <span class="keywordflow">if</span> (C(i)&lt;-1e-5)
<a name="l00437"></a>00437                       {
<a name="l00438"></a>00438                         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot; on rabote C_&quot;</span>&lt;&lt;i&lt;&lt;<span class="stringliteral">&quot; dans la maille &quot;</span>&lt;&lt;elem&lt;&lt;<span class="stringliteral">&quot; dans la chimie !!!!!! &quot;</span>&lt;&lt;C(i)&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00439"></a>00439                         <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00440"></a>00440                       }
<a name="l00441"></a>00441                     C(i)=0;
<a name="l00442"></a>00442                   }
<a name="l00443"></a>00443 <span class="comment">// calcul des proportions initiales des reactions non equilibre</span>
<a name="l00444"></a>00444 
<a name="l00445"></a>00445               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nbr_directe; i++)
<a name="l00446"></a>00446                 {
<a name="l00447"></a>00447                   <a class="code" href="classReaction.html">Reaction</a>&amp; reaction=<a class="code" href="classChimie.html#aafb7de1d50046bf7bc29d81b1da78030">reactions_</a>[marq_directe[i]];
<a name="l00448"></a>00448                   assert(reaction.<a class="code" href="classReaction.html#a400d5d750ff07ec6ecb9c2c6c2f0a254" title="prefacteur">contre_reaction_</a>&lt;=0);
<a name="l00449"></a>00449 
<a name="l00450"></a>00450                   <span class="keywordtype">double</span> proportion_directe;
<a name="l00451"></a>00451                   reaction.<a class="code" href="classReaction.html#ad303dc225e6a57e341fe861f86a170aa">calcul_proportion_implicite</a>(C_tmp,C,dt_chimie,1e-7,proportion_directe);
<a name="l00452"></a>00452                   <span class="keywordflow">if</span> (0)
<a name="l00453"></a>00453                     {
<a name="l00454"></a>00454                       <span class="keywordtype">double</span> proportion_directe2;
<a name="l00455"></a>00455                       reaction.<a class="code" href="classReaction.html#ad303dc225e6a57e341fe861f86a170aa">calcul_proportion_implicite</a>(C_tmp,C,dt_chimie,1e9,proportion_directe2);
<a name="l00456"></a>00456                       <span class="keywordflow">if</span> (proportion_directe==proportion_directe2)
<a name="l00457"></a>00457 
<a name="l00458"></a>00458                         {
<a name="l00459"></a>00459                           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00460"></a>00460                         }
<a name="l00461"></a>00461                     }
<a name="l00462"></a>00462 <span class="comment">// on utilise proportion_directe pour ne pas avoir la limitation par la securite</span>
<a name="l00463"></a>00463                   proportion_eq(i)=proportion_directe;
<a name="l00464"></a>00464 
<a name="l00465"></a>00465 
<a name="l00466"></a>00466                 }
<a name="l00467"></a>00467 <span class="comment">// pour chaque consitutant on regarde si il faut limiter ....</span>
<a name="l00468"></a>00468               <span class="keywordtype">double</span> securite=1-1e-6;
<a name="l00469"></a>00469               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c=0; c&lt;nbc; c++)
<a name="l00470"></a>00470                 {
<a name="l00471"></a>00471                   <span class="keywordtype">double</span> St=0;
<a name="l00472"></a>00472                   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nbr_directe; i++)
<a name="l00473"></a>00473                     {
<a name="l00474"></a>00474                       <a class="code" href="classReaction.html">Reaction</a>&amp; reaction=<a class="code" href="classChimie.html#aafb7de1d50046bf7bc29d81b1da78030">reactions_</a>[marq_directe[i]];
<a name="l00475"></a>00475                       assert(reaction.<a class="code" href="classReaction.html#a400d5d750ff07ec6ecb9c2c6c2f0a254" title="prefacteur">contre_reaction_</a>&lt;=0);
<a name="l00476"></a>00476                       <span class="keywordflow">if</span> (reaction.<a class="code" href="classReaction.html#a249304ec6c79e596b7f1b97cf0bc45ab">coeff_Y_</a>[c]&gt;0.)
<a name="l00477"></a>00477                         St+=proportion_eq(i)*reaction.<a class="code" href="classReaction.html#aeecfd99d4d26fdfe7d4fb3505071a6e9">coeff_stoechio_</a>[c];
<a name="l00478"></a>00478                     }
<a name="l00479"></a>00479 
<a name="l00480"></a>00480                   <span class="keywordtype">double</span> rapport=St/(securite);
<a name="l00481"></a>00481 <span class="comment">// Cerr&lt;&lt; c&lt;&lt;&quot; ici0b &quot;&lt;&lt; rapport &lt;&lt;&quot; st &quot;&lt;&lt;St&lt;&lt;&quot; &quot;&lt;&lt;C(c)&lt;&lt;finl;</span>
<a name="l00482"></a>00482 
<a name="l00483"></a>00483                   <span class="keywordflow">if</span> (rapport&gt;C(c))
<a name="l00484"></a>00484                     {
<a name="l00485"></a>00485 <span class="comment">// on risque de trop consommer .... on limite.</span>
<a name="l00486"></a>00486                       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt; c&lt;&lt;<span class="stringliteral">&quot; limite ici0 &quot;</span>&lt;&lt; rapport &lt;&lt;<span class="stringliteral">&quot; st &quot;</span>&lt;&lt;St&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;C(c)&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;C(c)/rapport&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00487"></a>00487 <span class="comment">// exit();</span>
<a name="l00488"></a>00488                       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nbr_directe; i++)
<a name="l00489"></a>00489                         {
<a name="l00490"></a>00490                           <a class="code" href="classReaction.html">Reaction</a>&amp; reaction=<a class="code" href="classChimie.html#aafb7de1d50046bf7bc29d81b1da78030">reactions_</a>[marq_directe[i]];
<a name="l00491"></a>00491                           assert(reaction.<a class="code" href="classReaction.html#a400d5d750ff07ec6ecb9c2c6c2f0a254" title="prefacteur">contre_reaction_</a>&lt;=0);
<a name="l00492"></a>00492 
<a name="l00493"></a>00493                           <span class="keywordflow">if</span> (reaction.<a class="code" href="classReaction.html#a249304ec6c79e596b7f1b97cf0bc45ab">coeff_Y_</a>[c]&gt;0.)
<a name="l00494"></a>00494                             proportion_eq(i)*=C(c)/rapport;
<a name="l00495"></a>00495 
<a name="l00496"></a>00496                         }
<a name="l00497"></a>00497                     }
<a name="l00498"></a>00498                 }
<a name="l00499"></a>00499 <span class="comment">// on fait reagir les reactions directes C(c)-=St;</span>
<a name="l00500"></a>00500               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c=0; c&lt;nbc; c++)
<a name="l00501"></a>00501                 {
<a name="l00502"></a>00502                   <span class="keywordtype">double</span> St=0;
<a name="l00503"></a>00503                   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nbr_directe; i++)
<a name="l00504"></a>00504                     {
<a name="l00505"></a>00505                       <a class="code" href="classReaction.html">Reaction</a>&amp; reaction=<a class="code" href="classChimie.html#aafb7de1d50046bf7bc29d81b1da78030">reactions_</a>[marq_directe[i]];
<a name="l00506"></a>00506                       assert(reaction.<a class="code" href="classReaction.html#a400d5d750ff07ec6ecb9c2c6c2f0a254" title="prefacteur">contre_reaction_</a>&lt;=0);
<a name="l00507"></a>00507                       <span class="keywordflow">if</span> (reaction.<a class="code" href="classReaction.html#a249304ec6c79e596b7f1b97cf0bc45ab">coeff_Y_</a>[c]!=0.)
<a name="l00508"></a>00508                         St+=proportion_eq(i)*reaction.<a class="code" href="classReaction.html#aeecfd99d4d26fdfe7d4fb3505071a6e9">coeff_stoechio_</a>[c];
<a name="l00509"></a>00509                     }
<a name="l00510"></a>00510 
<a name="l00511"></a>00511 <span class="comment">// Cerr&lt;&lt;C(c)&lt;&lt;&quot; &quot;&lt;&lt; c&lt;&lt; &quot; la  st &quot;&lt;&lt;St&lt;&lt;&quot; &quot;;</span>
<a name="l00512"></a>00512 <span class="comment">// assert(St&lt;=(C(c)*securite));</span>
<a name="l00513"></a>00513                   C(c)-=St;
<a name="l00514"></a>00514                   assert(C(c)&gt;=0);
<a name="l00515"></a>00515 <span class="comment">// Cerr&lt;&lt; C(c)&lt;&lt;finl;</span>
<a name="l00516"></a>00516 
<a name="l00517"></a>00517                 }
<a name="l00518"></a>00518 <span class="comment">// on taite maintenant les reactions equilibrees les unes apres les autres</span>
<a name="l00519"></a>00519 
<a name="l00520"></a>00520               securite=0.5;
<a name="l00521"></a>00521               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> reac=0; reac&lt;nbr; reac++)
<a name="l00522"></a>00522                 {
<a name="l00523"></a>00523                   <a class="code" href="classReaction.html">Reaction</a>&amp; reaction=<a class="code" href="classChimie.html#aafb7de1d50046bf7bc29d81b1da78030">reactions_</a>[reac];
<a name="l00524"></a>00524 
<a name="l00525"></a>00525                   <span class="keywordflow">if</span> (reaction.<a class="code" href="classReaction.html#a400d5d750ff07ec6ecb9c2c6c2f0a254" title="prefacteur">contre_reaction_</a>&gt;0)
<a name="l00526"></a>00526                     {
<a name="l00527"></a>00527                       <span class="keywordtype">double</span> proportion_directe;
<a name="l00528"></a>00528                       <span class="keywordtype">double</span> proportion=reaction.<a class="code" href="classReaction.html#ad303dc225e6a57e341fe861f86a170aa">calcul_proportion_implicite</a>(C_tmp, C,dt_chimie,1e-7,proportion_directe);
<a name="l00529"></a>00529                       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nbc; i++)
<a name="l00530"></a>00530                         <span class="keywordflow">if</span> (reaction.<a class="code" href="classReaction.html#a249304ec6c79e596b7f1b97cf0bc45ab">coeff_Y_</a>[i]!=0.) <span class="comment">//!&lt; c&#39;est un reactif ou un produit</span>
<a name="l00531"></a>00531 <span class="comment"></span>                          {
<a name="l00532"></a>00532                             C(i)=C(i)-proportion*reaction.<a class="code" href="classReaction.html#aeecfd99d4d26fdfe7d4fb3505071a6e9">coeff_stoechio_</a>[i];
<a name="l00533"></a>00533                           }
<a name="l00534"></a>00534                     }
<a name="l00535"></a>00535                 }
<a name="l00536"></a>00536             }
<a name="l00537"></a>00537 <span class="comment">// reaction.reagir(liste_C_,dt_chimie);</span>
<a name="l00538"></a>00538           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classChimie.html#a928549d7af6472c0de9dfd6802b08cdc">liste_C_</a>.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>(); i++)
<a name="l00539"></a>00539             <a class="code" href="classChimie.html#a928549d7af6472c0de9dfd6802b08cdc">liste_C_</a>[i].<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>().valeurs()(elem)=C(i);
<a name="l00540"></a>00540 
<a name="l00541"></a>00541         }
<a name="l00542"></a>00542 
<a name="l00543"></a>00543       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classChimie.html#a928549d7af6472c0de9dfd6802b08cdc">liste_C_</a>.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>(); i++)
<a name="l00544"></a>00544         <a class="code" href="classChimie.html#a928549d7af6472c0de9dfd6802b08cdc">liste_C_</a>[i].<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>().valeurs().echange_espace_virtuel();
<a name="l00545"></a>00545 
<a name="l00546"></a>00546       <span class="keywordflow">return</span>;
<a name="l00547"></a>00547     }
<a name="l00548"></a>00548   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;Chimie dispo qu&#39;avec des concentrations&quot;</span>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00549"></a>00549   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00550"></a>00550 
<a name="l00551"></a>00551 }
<a name="l00552"></a>00552 
<a name="l00553"></a><a class="code" href="classChimie.html#af97906af74a14acccfbf4606b0ccb845">00553</a> <span class="keyword">const</span> <a class="code" href="classChamp__base.html" title="classe Champ_base Cette classe est la base de la hierarchie des champs. Ses membres sont les attribut...">Champ_base</a>&amp; <a class="code" href="classChimie.html#af97906af74a14acccfbf4606b0ccb845">Chimie::get_champ</a>(<span class="keyword">const</span> <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>&amp; nom)<span class="keyword"> const</span>
<a name="l00554"></a>00554 <span class="keyword"></span>{
<a name="l00555"></a>00555   <span class="keywordtype">int</span> nb_reac=<a class="code" href="classChimie.html#aafb7de1d50046bf7bc29d81b1da78030">reactions_</a>.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>();
<a name="l00556"></a>00556   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nb_reac; i++)
<a name="l00557"></a>00557     {
<a name="l00558"></a>00558       <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> <a class="code" href="Op__Grad__EF_8cpp.html#abc0897c211f7aa4541da5833388f868b">test</a>(<span class="stringliteral">&quot;omega_&quot;</span>);
<a name="l00559"></a>00559       test+=<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(i);
<a name="l00560"></a>00560       <span class="keywordflow">if</span> (nom==test)
<a name="l00561"></a>00561         <span class="keywordflow">return</span> <a class="code" href="classChimie.html#aafb7de1d50046bf7bc29d81b1da78030">reactions_</a>[i].get_omega();
<a name="l00562"></a>00562     }
<a name="l00563"></a>00563 
<a name="l00564"></a>00564   <span class="keywordflow">throw</span> <a class="code" href="classChamps__compris__erreur.html">Champs_compris_erreur</a>();
<a name="l00565"></a>00565   <span class="keywordflow">return</span> <a class="code" href="classChimie.html#af97906af74a14acccfbf4606b0ccb845">get_champ</a>(nom);
<a name="l00566"></a>00566 }
<a name="l00567"></a>00567 
<a name="l00568"></a><a class="code" href="classChimie.html#a29c3c70537cce80f40362327744d2eee">00568</a> <span class="keywordtype">void</span> <a class="code" href="classChimie.html#a29c3c70537cce80f40362327744d2eee">Chimie::get_noms_champs_postraitables</a>(<a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a>&amp; nom,<a class="code" href="Champs__compris__interface_8h.html#a0e65ad13124ea2cb5e255b640464e35f">Option</a> opt)<span class="keyword"> const</span>
<a name="l00569"></a>00569 <span class="keyword"></span>{
<a name="l00570"></a>00570   <span class="keywordflow">if</span> (opt==<a class="code" href="Champs__compris__interface_8h.html#a0e65ad13124ea2cb5e255b640464e35fab6018339139b51a498dc44bd760766fc">DESCRIPTION</a>)
<a name="l00571"></a>00571     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot; Chimie :&quot;</span>;
<a name="l00572"></a>00572   <span class="keywordtype">int</span> nb_reac=<a class="code" href="classChimie.html#aafb7de1d50046bf7bc29d81b1da78030">reactions_</a>.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>();
<a name="l00573"></a>00573   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nb_reac; i++)
<a name="l00574"></a>00574     {
<a name="l00575"></a>00575       <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> <a class="code" href="Op__Grad__EF_8cpp.html#abc0897c211f7aa4541da5833388f868b">test</a>(<span class="stringliteral">&quot;omega_&quot;</span>);
<a name="l00576"></a>00576       test+=<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(i);
<a name="l00577"></a>00577       <span class="keywordflow">if</span> (opt==<a class="code" href="Champs__compris__interface_8h.html#a0e65ad13124ea2cb5e255b640464e35fab6018339139b51a498dc44bd760766fc">DESCRIPTION</a>)
<a name="l00578"></a>00578         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt; <a class="code" href="Op__Grad__EF_8cpp.html#abc0897c211f7aa4541da5833388f868b">test</a>;
<a name="l00579"></a>00579       <span class="keywordflow">else</span>
<a name="l00580"></a>00580         nom.<a class="code" href="classVect__Nom.html#ae20c0d0842c00756c1a2610fe0ca471f">add</a>(test);
<a name="l00581"></a>00581     }
<a name="l00582"></a>00582   <span class="keywordflow">if</span> (opt==<a class="code" href="Champs__compris__interface_8h.html#a0e65ad13124ea2cb5e255b640464e35fab6018339139b51a498dc44bd760766fc">DESCRIPTION</a>)
<a name="l00583"></a>00583     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00584"></a>00584 }
<a name="l00585"></a>00585 
<a name="l00586"></a>00586 <span class="comment">// Description : sauvegarde du terme source de temperature</span>
<a name="l00587"></a><a class="code" href="classChimie.html#a92b5dffbccb7cd9f4d2e492fe5aebd0d">00587</a> <span class="keywordtype">int</span> <a class="code" href="classChimie.html#a92b5dffbccb7cd9f4d2e492fe5aebd0d" title="Sauvegarde d&#39;un Objet_U sur un flot de sortie Methode a surcharger : retourne toujours 1 dans cette i...">Chimie::sauvegarder</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; fich)<span class="keyword"> const</span>
<a name="l00588"></a>00588 <span class="keyword"></span>{
<a name="l00589"></a>00589   <span class="keywordflow">return</span> 1;
<a name="l00590"></a>00590 }
<a name="l00591"></a>00591 
<a name="l00592"></a>00592 <span class="comment">// Description : reprise du terme source de temperature</span>
<a name="l00593"></a>00593 <span class="comment">// on est deja bien positionne ????</span>
<a name="l00594"></a><a class="code" href="classChimie.html#adfc0848b6251b3230dd3beaa381c6fc6">00594</a> <span class="keywordtype">int</span> <a class="code" href="classChimie.html#adfc0848b6251b3230dd3beaa381c6fc6" title="Reprise d&#39;un Objet_U sur un flot d&#39;entree Methode a surcharger : retourne toujours 1 dans cette imple...">Chimie::reprendre</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00595"></a>00595 {
<a name="l00596"></a>00596   <span class="keywordflow">return</span> 1;
<a name="l00597"></a>00597 
<a name="l00598"></a>00598 }
<a name="l00599"></a>00599 
<a name="l00600"></a>00600 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:31 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
