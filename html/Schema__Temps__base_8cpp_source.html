<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/Kernel/Framework/Schema_Temps_base.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/Kernel/Framework/Schema_Temps_base.cpp</div>  </div>
</div>
<div class="contents">
<a href="Schema__Temps__base_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (c) 2021, CEA</span>
<a name="l00003"></a>00003 <span class="comment">* All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment">* 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00007"></a>00007 <span class="comment">* 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00008"></a>00008 <span class="comment">* 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<a name="l00011"></a>00011 <span class="comment">* IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;</span>
<a name="l00012"></a>00012 <span class="comment">* OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// File:        Schema_Temps_base.cpp</span>
<a name="l00018"></a>00018 <span class="comment">// Directory:   $TRUST_ROOT/src/Kernel/Framework</span>
<a name="l00019"></a>00019 <span class="comment">// Version:     /main/102</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;<a class="code" href="Schema__Temps__base_8h.html">Schema_Temps_base.h</a>&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="Probleme__base_8h.html">Probleme_base.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="Equation_8h.html">Equation.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="LecFicDiffuse_8h.html">LecFicDiffuse.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="EcrFicCollecte_8h.html">EcrFicCollecte.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="Debog_8h.html">Debog.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="stat__counters_8h.html">stat_counters.h</a>&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;<a class="code" href="Param_8h.html">Param.h</a>&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;<a class="code" href="communications_8h.html">communications.h</a>&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;<a class="code" href="SFichier_8h.html">SFichier.h</a>&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;<a class="code" href="DoubleTab_8h.html">DoubleTab.h</a>&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;<a class="code" href="Matrice__Morse_8h.html">Matrice_Morse.h</a>&gt;</span> <span class="comment">//!&lt; necessaire pour visual</span>
<a name="l00036"></a>00036 <span class="comment"></span><span class="preprocessor">#include &lt;<a class="code" href="stat__counters_8h.html">stat_counters.h</a>&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;cfloat&gt;</span>
<a name="l00038"></a>00038 
<a name="l00039"></a><a class="code" href="Schema__Temps__base_8cpp.html#ad946030eec0cf8beb97b132bf15d310a">00039</a> <a class="code" href="Declare__Base_8h.html#a279604f97959498f17b67e986dfd4486">Implemente_base_sans_constructeur</a>(<a class="code" href="classSchema__Temps__base.html" title="classe Schema_Temps_base">Schema_Temps_base</a>,<span class="stringliteral">&quot;Schema_Temps_base&quot;</span>,<a class="code" href="classObjet__U.html" title="classe Objet_U Cette classe est la classe de base des Objets de TRUST Dans les classes derivees de Ob...">Objet_U</a>);
<a name="l00040"></a>00040 <span class="comment">// XD schema_temps_base objet_u schema_temps_base -1 Basic class for time schemes. This scheme will be associated with a problem and the equations of this problem.</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="keyword">static</span> <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a> <a class="code" href="Schema__Temps__base_8cpp.html#ac0fd0b8cb969aa4f0ce71884d584a107">dt_ev_</a>;
<a name="l00043"></a><a class="code" href="classSchema__Temps__base.html#a9786b3dc68f3eb4ed7d5973f5f27affc">00043</a> <span class="keywordtype">void</span> <a class="code" href="classSchema__Temps__base.html#a9786b3dc68f3eb4ed7d5973f5f27affc">Schema_Temps_base::initialize</a>()
<a name="l00044"></a>00044 {
<a name="l00045"></a>00045 <span class="comment">// GF je remets le calculer_pas_de_temps car des schemas en temps implicites s&#39;en servent pour dimensionner (en particulier ovap)</span>
<a name="l00046"></a>00046   <a class="code" href="classSchema__Temps__base.html#a6e2edfe46a7f27b6fc8f114d92c35dc2">pb_base</a>().<a class="code" href="classProbleme__base.html#a74469695e1681fcba4ef15614de8c463" title="Calcul la valeur du prochain pas de temps du probleme. On calcule le minimum des pas de temps des equ...">calculer_pas_de_temps</a>();
<a name="l00047"></a>00047 <span class="comment">// je le mets une deuxieme fois pour alternant....</span>
<a name="l00048"></a>00048   <a class="code" href="classSchema__Temps__base.html#a6e2edfe46a7f27b6fc8f114d92c35dc2">pb_base</a>().<a class="code" href="classProbleme__base.html#a74469695e1681fcba4ef15614de8c463" title="Calcul la valeur du prochain pas de temps du probleme. On calcule le minimum des pas de temps des equ...">calculer_pas_de_temps</a>();
<a name="l00049"></a>00049   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">je_suis_maitre</a>())
<a name="l00050"></a>00050     {
<a name="l00051"></a>00051       <span class="keywordflow">if</span> (!<a class="code" href="classSchema__Temps__base.html#aad898e70e4d89a9b47118b6969737d71">disable_dt_ev</a>())
<a name="l00052"></a>00052         {
<a name="l00053"></a>00053           <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> fichier(<a class="code" href="classObjet__U.html#a7c27c4f80259eeef76ff8fe2d3bc61f7" title="Renvoie une reference constante vers le nom du cas. Cette methode est statique.">nom_du_cas</a>()+<span class="stringliteral">&quot;.dt_ev&quot;</span>);
<a name="l00054"></a>00054           <span class="keyword">struct </span>stat f;
<a name="l00055"></a>00055 <span class="comment">// On initialise le fichier .dt_ev s&#39;il n&#39;existe pas ou si c&#39;est un demarrage de calcul sans reprise</span>
<a name="l00056"></a>00056           <span class="keywordflow">if</span> ((<a class="code" href="classSchema__Temps__base.html#abd3374c522a8fdb6e6c97eab14f95ed1">nb_pas_dt_</a>==0) &amp;&amp; ((stat(fichier,&amp;f)) || !(<a class="code" href="classSchema__Temps__base.html#a6e2edfe46a7f27b6fc8f114d92c35dc2">pb_base</a>().reprise_effectuee()==1)))
<a name="l00057"></a>00057             {
<a name="l00058"></a>00058               <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#a4fdd281fc1915333d2e44dce212439d7">schema_impr</a>())
<a name="l00059"></a>00059                 {
<a name="l00060"></a>00060                   dt_ev_.<a class="code" href="classSortie__Fichier__base.html#a7e75e18ed580cd4d45912ec202caa2b2">ouvrir</a>(fichier, ios::out);
<a name="l00061"></a>00061                   dt_ev_.<a class="code" href="classSortie__Fichier__base.html#a5ddd834ca9c766c24cc608cd03ef0e96">setf</a>(ios::scientific);
<a name="l00062"></a>00062                   dt_ev_ &lt;&lt; <span class="stringliteral">&quot;# temps\t\t dt\t\t facsec\t\t residu=max|Ri|\t dt_stab\t &quot;</span>;
<a name="l00063"></a>00063                 }
<a name="l00064"></a>00064               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classSchema__Temps__base.html#a6e2edfe46a7f27b6fc8f114d92c35dc2">pb_base</a>().<a class="code" href="classProbleme__base.html#abefceb0ac0d0b35d42a4daaa82a95f59">nombre_d_equations</a>(); i++)
<a name="l00065"></a>00065                 dt_ev_ &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a6e2edfe46a7f27b6fc8f114d92c35dc2">pb_base</a>().<a class="code" href="classProbleme__base.html#ae97586575b7e510d7945ce3a894b806a">equation</a>(i).<a class="code" href="classEquation__base.html#af86f7f88fba1214b9f1f185ce8eb4de2">expression_residu</a>();
<a name="l00066"></a>00066             }
<a name="l00067"></a>00067           <span class="keywordflow">else</span>
<a name="l00068"></a>00068             {
<a name="l00069"></a>00069               <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#a4fdd281fc1915333d2e44dce212439d7">schema_impr</a>())
<a name="l00070"></a>00070                 {
<a name="l00071"></a>00071                   dt_ev_.<a class="code" href="classSortie__Fichier__base.html#a7e75e18ed580cd4d45912ec202caa2b2">ouvrir</a>(fichier, ios::app);
<a name="l00072"></a>00072                   dt_ev_.<a class="code" href="classSortie__Fichier__base.html#a5ddd834ca9c766c24cc608cd03ef0e96">setf</a>(ios::scientific);
<a name="l00073"></a>00073                 }
<a name="l00074"></a>00074             }
<a name="l00075"></a>00075         }
<a name="l00076"></a>00076       <span class="keywordflow">if</span> (!<a class="code" href="classSchema__Temps__base.html#ae20402318209fd548fecbcb07e3bb596">disable_progress</a>() &amp;&amp; !<a class="code" href="classSchema__Temps__base.html#abbc30f1284a9491c2f55a08ea4a4f4c8">progress_</a>.<a class="code" href="classSortie__Fichier__base.html#acc0244cc2feedba886b643e9b3c295db">is_open</a>())
<a name="l00077"></a>00077         <a class="code" href="classSchema__Temps__base.html#abbc30f1284a9491c2f55a08ea4a4f4c8">progress_</a>.<a class="code" href="classSortie__Fichier__base.html#a7e75e18ed580cd4d45912ec202caa2b2">ouvrir</a>(<a class="code" href="classObjet__U.html#a7c27c4f80259eeef76ff8fe2d3bc61f7" title="Renvoie une reference constante vers le nom du cas. Cette methode est statique.">nom_du_cas</a>()+<span class="stringliteral">&quot;.progress&quot;</span>);
<a name="l00078"></a>00078     }
<a name="l00079"></a>00079 
<a name="l00080"></a>00080   <span class="keywordflow">if</span> ((<a class="code" href="classSchema__Temps__base.html#abd3374c522a8fdb6e6c97eab14f95ed1">nb_pas_dt_</a>==0) &amp;&amp; ( ((<a class="code" href="classSchema__Temps__base.html#a58accd37da9e610cd9c67b249ed914d1" title="mode calcul du pas de temps de depart">mode_dt_start_</a>==0) &amp;&amp; <a class="code" href="Double_8h.html#ac86f5f350b0f95fd8c34b0ac8d720f6f">est_egal</a>(<a class="code" href="classSchema__Temps__base.html#ab13482fd427c6008c91d0df5d3a7e07f">tinit_</a>,0.)) || (<a class="code" href="classSchema__Temps__base.html#a58accd37da9e610cd9c67b249ed914d1" title="mode calcul du pas de temps de depart">mode_dt_start_</a>==-1)) )
<a name="l00081"></a>00081     {
<a name="l00082"></a>00082 <span class="comment">// On divise par facsec_ car multiplication par facsec_ dans corriger_dt_calcule()</span>
<a name="l00083"></a>00083 <span class="comment">// quel que soit le mode d initialisation de dt_</span>
<a name="l00084"></a>00084       <a class="code" href="classSchema__Temps__base.html#a41d96b9bfd9ead46031343c31f9bfe5d" title="Pas de temps de calcul.">dt_</a>=<a class="code" href="classSchema__Temps__base.html#abc40918e7ff94cc1897d12b2f3bb1340" title="Pas de temps min fixe par l&#39;utilisateur.">dt_min_</a>/<a class="code" href="classSchema__Temps__base.html#a8cdc40f1adfd8ff29d7f9c75330920ee">facsec_</a>;
<a name="l00085"></a>00085     }
<a name="l00086"></a>00086   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#a58accd37da9e610cd9c67b249ed914d1" title="mode calcul du pas de temps de depart">mode_dt_start_</a>&gt;0)
<a name="l00087"></a>00087     {
<a name="l00088"></a>00088       <a class="code" href="classSchema__Temps__base.html#a41d96b9bfd9ead46031343c31f9bfe5d" title="Pas de temps de calcul.">dt_</a>=<a class="code" href="classSchema__Temps__base.html#a58accd37da9e610cd9c67b249ed914d1" title="mode calcul du pas de temps de depart">mode_dt_start_</a>/<a class="code" href="classSchema__Temps__base.html#a8cdc40f1adfd8ff29d7f9c75330920ee">facsec_</a>;
<a name="l00089"></a>00089     }
<a name="l00090"></a>00090   <span class="keywordflow">else</span>
<a name="l00091"></a>00091     {
<a name="l00092"></a>00092       <a class="code" href="classSchema__Temps__base.html#ad95c1e999ba471e5a95760e37aebb05f">mettre_a_jour_dt_stab</a>();
<a name="l00093"></a>00093       <a class="code" href="classSchema__Temps__base.html#a41d96b9bfd9ead46031343c31f9bfe5d" title="Pas de temps de calcul.">dt_</a>=<a class="code" href="classSchema__Temps__base.html#acf696ebda2c1019cde88306d1f0e412a" title="Pas de temps de stabilite.">dt_stab_</a>;
<a name="l00094"></a>00094     }
<a name="l00095"></a>00095   <a class="code" href="classSchema__Temps__base.html#acf696ebda2c1019cde88306d1f0e412a" title="Pas de temps de stabilite.">dt_stab_</a>=<a class="code" href="classSchema__Temps__base.html#a41d96b9bfd9ead46031343c31f9bfe5d" title="Pas de temps de calcul.">dt_</a>;
<a name="l00096"></a>00096   <a class="code" href="classSchema__Temps__base.html#a4b91db84965bb786c28df82647d1b6d5">dt_failed_</a> = DBL_MAX;
<a name="l00097"></a>00097 }
<a name="l00098"></a>00098 
<a name="l00099"></a><a class="code" href="classSchema__Temps__base.html#a7ecf5cca7b00dc0f4d457dd240d620cc">00099</a> <span class="keywordtype">double</span> <a class="code" href="classSchema__Temps__base.html#a7ecf5cca7b00dc0f4d457dd240d620cc">Schema_Temps_base::computeTimeStep</a>(<span class="keywordtype">bool</span>&amp; is_stop)<span class="keyword"> const</span>
<a name="l00100"></a>00100 <span class="keyword"></span>{
<a name="l00101"></a>00101 <span class="comment">// reevaluation de dt_max_ si fonction du temps</span>
<a name="l00102"></a>00102   <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#a27ac9c3e8c2ca6c9bbe5d063925586e3">dt_max_str_</a> != <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>())
<a name="l00103"></a>00103     {
<a name="l00104"></a>00104       <a class="code" href="classSchema__Temps__base.html#a3727f5065c31a88df3ce99f8d0a89238">dt_max_fn_</a>.<a class="code" href="classParser__U.html#a13c377b32b6c3ced39a14f83f94a8828">setVar</a>(0, <a class="code" href="classSchema__Temps__base.html#a5054df01edb6d4f7baec7e612d423834" title="Renvoie le temps courant.">temps_courant</a>());
<a name="l00105"></a>00105       <a class="code" href="classSchema__Temps__base.html#a55d7d507689898465bf9ce320446ba99" title="Pas de temps max fixe par l&#39;utilisateur.">dt_max_</a> = <a class="code" href="classSchema__Temps__base.html#a3727f5065c31a88df3ce99f8d0a89238">dt_max_fn_</a>.<a class="code" href="classParser__U.html#a61605bc1b85e466f884f1739e811b6b4">eval</a>();
<a name="l00106"></a>00106     }
<a name="l00107"></a>00107 
<a name="l00108"></a>00108   is_stop=<span class="keyword">false</span>;
<a name="l00109"></a>00109 <span class="comment">// Correction en premier du pas de temps</span>
<a name="l00110"></a>00110   <span class="keywordtype">double</span> dt = <a class="code" href="classSchema__Temps__base.html#acf696ebda2c1019cde88306d1f0e412a" title="Pas de temps de stabilite.">dt_stab_</a>;
<a name="l00111"></a>00111   <span class="keywordflow">if</span> (!<a class="code" href="classSchema__Temps__base.html#a9b045f8fd0d9066b1904ecb5c97290e3" title="Corrige le pas de temps calcule que l&#39;on passe en parametre et verifie qu&#39;il n&#39;est pas &quot;trop&quot; petit (...">corriger_dt_calcule</a>(dt)) <span class="comment">//!&lt; Change le contenu de dt</span>
<a name="l00112"></a>00112 <span class="comment"></span>    is_stop=<span class="keyword">true</span>;
<a name="l00113"></a>00113   dt = <a class="code" href="Double_8h.html#a2f8edc4561e9744ed4233b205fa7ec32">min</a>(dt, <a class="code" href="classSchema__Temps__base.html#a4b91db84965bb786c28df82647d1b6d5">dt_failed_</a> / sqrt(2)); <span class="comment">//pour provoquer une baisse de dt en cas d&#39;echec a la resolution precedente</span>
<a name="l00114"></a>00114   <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#ae6dd72bce33a443217b83f56a4da23a2">temps_courant_</a> &gt; <a class="code" href="classSchema__Temps__base.html#ab58cb017d1983269f669ef2facdd2bca">temps_precedent_</a>)
<a name="l00115"></a>00115     dt = <a class="code" href="Double_8h.html#a2f8edc4561e9744ed4233b205fa7ec32">min</a>(dt, (<a class="code" href="classSchema__Temps__base.html#ae6dd72bce33a443217b83f56a4da23a2">temps_courant_</a> - <a class="code" href="classSchema__Temps__base.html#ab58cb017d1983269f669ef2facdd2bca">temps_precedent_</a>) * <a class="code" href="classSchema__Temps__base.html#a945fcc0fbef49be036443abdc040ef70">dt_gf_</a>); <span class="comment">//pour ne pas remonter dt trop vite (comme facsec)</span>
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 <span class="comment">// Mise a jour immediate de l&#39;attribut dt_ afin que pas_de_temps()</span>
<a name="l00118"></a>00118 <span class="comment">// soit a jour tout le temps (en particulier au moment du postraitement)</span>
<a name="l00119"></a>00119 <span class="comment">// Ce n&#39;etait pas le cas pour les versions &lt;= 1.6.3 et les champs dependant</span>
<a name="l00120"></a>00120 <span class="comment">// de dt n&#39;etaient pas juste si facsec&lt;&gt;1</span>
<a name="l00121"></a>00121 <span class="comment">// dt_ = dt;</span>
<a name="l00122"></a>00122 
<a name="l00123"></a>00123   <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classSchema__Temps__base.html#a4231b9b624ea282ee8f9555e9ebc9139" title="Renvoie 1 si il y lieu de stopper le calcul pour differente raisons: - le temps final est atteint - l...">stop</a>())
<a name="l00124"></a>00124     {
<a name="l00125"></a>00125       is_stop=<span class="keyword">true</span>;
<a name="l00126"></a>00126       <span class="keywordflow">return</span> 0;
<a name="l00127"></a>00127     }
<a name="l00128"></a>00128   <span class="keywordflow">else</span>
<a name="l00129"></a>00129     <span class="keywordflow">return</span> dt;
<a name="l00130"></a>00130 }
<a name="l00131"></a>00131 
<a name="l00132"></a><a class="code" href="classSchema__Temps__base.html#a9917c2c7e04733506b1c46d0a463701a">00132</a> <span class="keywordtype">bool</span> <a class="code" href="classSchema__Temps__base.html#a9917c2c7e04733506b1c46d0a463701a">Schema_Temps_base::initTimeStep</a>(<span class="keywordtype">double</span> dt)
<a name="l00133"></a>00133 {
<a name="l00134"></a>00134 
<a name="l00135"></a>00135   <a class="code" href="classSchema__Temps__base.html#a41d96b9bfd9ead46031343c31f9bfe5d" title="Pas de temps de calcul.">dt_</a>=dt;
<a name="l00136"></a>00136   <a class="code" href="classSchema__Temps__base.html#ad03548e5c596dac08ccfa866faa5ec0b" title="Stationary reached by the problem using this scheme.">stationnaire_atteint_</a> = -1;
<a name="l00137"></a>00137   <a class="code" href="classSchema__Temps__base.html#addda9320fe85fd273e84fa0d09f12eef" title="Residu.">residu_</a>=0;
<a name="l00138"></a>00138 
<a name="l00139"></a>00139   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00140"></a>00140 }
<a name="l00141"></a>00141 
<a name="l00142"></a>00142 <span class="comment">//</span><span class="comment"></span>
<a name="l00143"></a>00143 <span class="comment">//! Calculate the U(n+1) unknown for each equation (if solved) of the problem with the selected time scheme</span>
<a name="l00144"></a><a class="code" href="classSchema__Temps__base.html#ac2664c716af1b7d2526580fae4cd9362">00144</a> <span class="comment"></span><span class="keywordtype">bool</span> <a class="code" href="classSchema__Temps__base.html#ac2664c716af1b7d2526580fae4cd9362" title="Calculate the U(n+1) unknown for each equation (if solved) of the problem with the selected time sche...">Schema_Temps_base::iterateTimeStep</a>(<span class="keywordtype">bool</span>&amp; converged)
<a name="l00145"></a>00145 {
<a name="l00146"></a>00146 <span class="comment">// Loop on the equations of the problem:</span>
<a name="l00147"></a>00147   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classSchema__Temps__base.html#a6e2edfe46a7f27b6fc8f114d92c35dc2">pb_base</a>().<a class="code" href="classProbleme__base.html#abefceb0ac0d0b35d42a4daaa82a95f59">nombre_d_equations</a>(); i++)
<a name="l00148"></a>00148     {
<a name="l00149"></a>00149       <a class="code" href="classEquation__base.html">Equation_base</a>&amp; equation=<a class="code" href="classSchema__Temps__base.html#a6e2edfe46a7f27b6fc8f114d92c35dc2">pb_base</a>().<a class="code" href="classProbleme__base.html#ae97586575b7e510d7945ce3a894b806a">equation</a>(i);
<a name="l00150"></a>00150 <span class="comment">// Calculate (if equation is solved) the unknown equation U(n+1)</span>
<a name="l00151"></a>00151 <span class="comment">// according to the selected time scheme:</span>
<a name="l00152"></a>00152       <span class="keywordflow">if</span> (!equation.<a class="code" href="classEquation__base.html#a0a497f27296625af895ffe40e48d109e">equation_non_resolue</a>())
<a name="l00153"></a>00153         <a class="code" href="classSchema__Temps__base.html#aaf384ecbdb1555490cad2f1779dd5a9c">faire_un_pas_de_temps_eqn_base</a>(equation);
<a name="l00154"></a>00154       <span class="keywordflow">else</span>
<a name="l00155"></a>00155         {
<a name="l00156"></a>00156           <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a>&lt;&lt; <span class="stringliteral">&quot;====================================================&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00157"></a>00157           <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a>&lt;&lt; equation.<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>()&lt;&lt;<span class="stringliteral">&quot; equation is not solved.&quot;</span>&lt;&lt;finl;
<a name="l00158"></a>00158           <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a>&lt;&lt; <span class="stringliteral">&quot;====================================================&quot;</span> &lt;&lt; finl;
<a name="l00159"></a>00159 <span class="comment">// On calcule une fois la derivee pour avoir les flux bord</span>
<a name="l00160"></a>00160           <span class="keywordflow">if</span> (equation.<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a247769eddf9c0bfcaabc50b8dd90d401" title="Renvoie le nombre de pas de temps effectues.">nb_pas_dt</a>()==0)
<a name="l00161"></a>00161             {
<a name="l00162"></a>00162               <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> inconnue_valeurs(equation.<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>());
<a name="l00163"></a>00163               equation.<a class="code" href="classEquation__base.html#a97aa87b0cf6205ef437a6774adf1bd47" title="Returns the time derivative of the unknown I of the equation: dI/dt = M-1*(sum(operators(I) + sources...">derivee_en_temps_inco</a>(inconnue_valeurs);
<a name="l00164"></a>00164             }
<a name="l00165"></a>00165         }
<a name="l00166"></a>00166     }
<a name="l00167"></a>00167   converged=<span class="keyword">true</span>;
<a name="l00168"></a>00168   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00169"></a>00169 }
<a name="l00170"></a>00170 
<a name="l00171"></a>00171 <span class="comment">// Precondition:</span>
<a name="l00172"></a>00172 <span class="comment">// Parametre:</span>
<a name="l00173"></a>00173 <span class="comment">// Signification:</span>
<a name="l00174"></a>00174 <span class="comment">// Valeurs par defaut:</span>
<a name="l00175"></a>00175 <span class="comment">// Contraintes:</span>
<a name="l00176"></a>00176 <span class="comment">// Acces:</span>
<a name="l00177"></a>00177 <span class="comment">// Exception:</span>
<a name="l00178"></a>00178 <span class="comment">// Effets de bord:</span>
<a name="l00179"></a>00179 <span class="comment">// Postcondition: la methode ne modifie pas l&#39;objet</span>
<a name="l00180"></a>00180 <span class="comment">//</span>
<a name="l00181"></a>00181 <span class="comment">//</span><span class="comment"></span>
<a name="l00182"></a>00182 <span class="comment">//! Renvoie 1 s&#39;il y a lieu d&#39;effectuer une impression (cf dt_impr)&lt;br&gt;Renvoie 0 sinon</span>
<a name="l00183"></a>00183 <span class="comment"></span><span class="comment">/** \return int&lt;br&gt;</span>
<a name="l00184"></a>00184 <span class="comment">Signification: 1 si il y lieu d&#39;effectuer une impression 0 sinon&lt;br&gt;</span>
<a name="l00185"></a>00185 <span class="comment">Contraintes: */</span>
<a name="l00186"></a><a class="code" href="classSchema__Temps__base.html#a7a2bf65aa65d7b2ddb7ccc0bc5fd0668">00186</a> <span class="keywordtype">int</span> <a class="code" href="classSchema__Temps__base.html#a7a2bf65aa65d7b2ddb7ccc0bc5fd0668" title="Renvoie 1 s&#39;il y a lieu d&#39;effectuer une impression (cf dt_impr) Renvoie 0 sinon.">Schema_Temps_base::limpr</a>()<span class="keyword"> const</span>
<a name="l00187"></a>00187 <span class="keyword"></span>{
<a name="l00188"></a>00188   <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#ab72294e6106b3c0eb25cb7e3e1f6fd56" title="Pas de temps d&#39;impression.">dt_impr_</a>&lt;=0)
<a name="l00189"></a>00189     <span class="keywordflow">return</span> 0; <span class="comment">//!&lt; Negative value for dt_impr : we never print</span>
<a name="l00190"></a>00190 <span class="comment"></span>  <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#abd3374c522a8fdb6e6c97eab14f95ed1">nb_pas_dt_</a>==0)
<a name="l00191"></a>00191     <span class="keywordflow">return</span> 0; <span class="comment">//!&lt; No solve cause 0 time step : we print nothing</span>
<a name="l00192"></a>00192 <span class="comment"></span>  <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#ab72294e6106b3c0eb25cb7e3e1f6fd56" title="Pas de temps d&#39;impression.">dt_impr_</a>&lt;=<a class="code" href="classSchema__Temps__base.html#a41d96b9bfd9ead46031343c31f9bfe5d" title="Pas de temps de calcul.">dt_</a>)
<a name="l00193"></a>00193     <span class="keywordflow">return</span> 1; <span class="comment">//!&lt; We print every time step if dt_impr is lower than dt</span>
<a name="l00194"></a>00194 <span class="comment"></span>  <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#abd3374c522a8fdb6e6c97eab14f95ed1">nb_pas_dt_</a>&lt;=1)
<a name="l00195"></a>00195     <span class="keywordflow">return</span> 1; <span class="comment">//!&lt; We print the first time step</span>
<a name="l00196"></a>00196 <span class="comment"></span>  <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#a51c0bc9f66a0a75d26b7685912945d0c">tmax_</a>&lt;=<a class="code" href="classSchema__Temps__base.html#ae6dd72bce33a443217b83f56a4da23a2">temps_courant_</a> || <a class="code" href="classSchema__Temps__base.html#a4cd1e401f61da498c719d2ff881d9552">nb_pas_dt_max_</a>&lt;=<a class="code" href="classSchema__Temps__base.html#abd3374c522a8fdb6e6c97eab14f95ed1">nb_pas_dt_</a> || <a class="code" href="classSchema__Temps__base.html#ae2c7d1e0a0f8c8ae49a80f110baf55df" title="Stationary reached by the calculation (means all the problems reach stationary)">stationnaires_atteints_</a>)
<a name="l00197"></a>00197     <span class="keywordflow">return</span> 1; <span class="comment">//!&lt; We print the last time step</span>
<a name="l00198"></a>00198 <span class="comment"></span>
<a name="l00199"></a>00199 <span class="comment">// 26/01/2010 : On utilise desormais la fonction &quot;modf(operation , &amp; partie entiere)&quot; de math.h</span>
<a name="l00200"></a>00200 <span class="comment">// Cette fonction decompose le resultat de &quot;operation&quot; en une partie entiere et une partie decimale.</span>
<a name="l00201"></a>00201 <span class="comment">// Ainsi, on ne transforme plus un double en int avec tout les risques que cela comporte.</span>
<a name="l00202"></a>00202 <span class="comment">// ex : modf(9/7,&amp;i) donne 1.000000 pour la partie entiere et 0.285714 pour le partie decimale</span>
<a name="l00203"></a>00203 <span class="comment">// </span>
<a name="l00204"></a>00204 <span class="comment">// epsilon permet d&#39;assurer que le resultat de l&#39;operation est independant de la precision machine :</span>
<a name="l00205"></a>00205 <span class="comment">// ex : 0.99999999/1.00000000 peut donner 0.99999999 ou 1.00000000 suivant les machines</span>
<a name="l00206"></a>00206 <span class="comment">// alors que</span>
<a name="l00207"></a>00207 <span class="comment">// ex : 0.99999999/1.00000000 + 1.e-8 donne tjrs 1.00000000.</span>
<a name="l00208"></a>00208   <span class="keywordtype">double</span> i, j, epsilon = 1.e-8;
<a name="l00209"></a>00209   modf(<a class="code" href="classSchema__Temps__base.html#ae6dd72bce33a443217b83f56a4da23a2">temps_courant_</a>/<a class="code" href="classSchema__Temps__base.html#ab72294e6106b3c0eb25cb7e3e1f6fd56" title="Pas de temps d&#39;impression.">dt_impr_</a> + epsilon, &amp;i);
<a name="l00210"></a>00210   modf(<a class="code" href="classSchema__Temps__base.html#ab58cb017d1983269f669ef2facdd2bca">temps_precedent_</a>/<a class="code" href="classSchema__Temps__base.html#ab72294e6106b3c0eb25cb7e3e1f6fd56" title="Pas de temps d&#39;impression.">dt_impr_</a> + epsilon, &amp;j);
<a name="l00211"></a>00211   <span class="keywordflow">return</span> ( i&gt;j );
<a name="l00212"></a>00212 }
<a name="l00213"></a>00213 
<a name="l00214"></a><a class="code" href="classSchema__Temps__base.html#a706a4d4501977124dd5f6cdb719ab2ee">00214</a> <span class="keywordtype">void</span> <a class="code" href="classSchema__Temps__base.html#a706a4d4501977124dd5f6cdb719ab2ee">Schema_Temps_base::validateTimeStep</a>()
<a name="l00215"></a>00215 {
<a name="l00216"></a>00216   <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#affcd058809786918ed173aaf681d0843">begin_count</a>(<a class="code" href="stat__counters_8cpp.html#ad0ff5c8b0553621de2a881e6965b6e52">mettre_a_jour_counter_</a>);
<a name="l00217"></a>00217 <span class="comment">// Update the problem:</span>
<a name="l00218"></a>00218   <a class="code" href="classProbleme__base.html" title="classe Probleme_base C&#39;est un Probleme_U qui n&#39;est pas un couplage. Le role d&#39;un Probleme_base est la...">Probleme_base</a>&amp; problem=<a class="code" href="classSchema__Temps__base.html#a6e2edfe46a7f27b6fc8f114d92c35dc2">pb_base</a>();
<a name="l00219"></a>00219   problem.<a class="code" href="classProbleme__base.html#a8644e9f76f6dfdd087eb56938997fc57" title="Effectue une mise a jour en temps du probleme. Effectue la mise a jour sur toutes les equations du pr...">mettre_a_jour</a>(<a class="code" href="classSchema__Temps__base.html#ae6dd72bce33a443217b83f56a4da23a2">temps_courant_</a>+<a class="code" href="classSchema__Temps__base.html#a41d96b9bfd9ead46031343c31f9bfe5d" title="Pas de temps de calcul.">dt_</a>);
<a name="l00220"></a>00220   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">je_suis_maitre</a>())
<a name="l00221"></a>00221     {
<a name="l00222"></a>00222       <span class="keywordflow">if</span> (!<a class="code" href="classSchema__Temps__base.html#aad898e70e4d89a9b47118b6969737d71">disable_dt_ev</a>())
<a name="l00223"></a>00223         {
<a name="l00224"></a>00224           <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#a4fdd281fc1915333d2e44dce212439d7">schema_impr</a>())
<a name="l00225"></a>00225             dt_ev_ &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#ae6dd72bce33a443217b83f56a4da23a2">temps_courant_</a> &lt;&lt; <span class="stringliteral">&quot;\t &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a41d96b9bfd9ead46031343c31f9bfe5d" title="Pas de temps de calcul.">dt_</a> &lt;&lt; <span class="stringliteral">&quot;\t &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a8cdc40f1adfd8ff29d7f9c75330920ee">facsec_</a> &lt;&lt;<span class="stringliteral">&quot;\t &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#addda9320fe85fd273e84fa0d09f12eef" title="Residu.">residu_</a> &lt;&lt; <span class="stringliteral">&quot;\t &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#acf696ebda2c1019cde88306d1f0e412a" title="Pas de temps de stabilite.">dt_stab_</a> &lt;&lt; <span class="stringliteral">&quot;\t &quot;</span>;
<a name="l00226"></a>00226           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classSchema__Temps__base.html#a6e2edfe46a7f27b6fc8f114d92c35dc2">pb_base</a>().<a class="code" href="classProbleme__base.html#abefceb0ac0d0b35d42a4daaa82a95f59">nombre_d_equations</a>(); i++)
<a name="l00227"></a>00227             <a class="code" href="classSchema__Temps__base.html#a6e2edfe46a7f27b6fc8f114d92c35dc2">pb_base</a>().<a class="code" href="classProbleme__base.html#ae97586575b7e510d7945ce3a894b806a">equation</a>(i).<a class="code" href="classEquation__base.html#a700f2903c7c3f2f73fdde7a45bfb03be">imprime_residu</a>(dt_ev_);
<a name="l00228"></a>00228         }
<a name="l00229"></a>00229 
<a name="l00230"></a>00230 <span class="comment">// Impression du temps CPU estime restant</span>
<a name="l00231"></a>00231       <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#a4fdd281fc1915333d2e44dce212439d7">schema_impr</a>())
<a name="l00232"></a>00232         {
<a name="l00233"></a>00233           <span class="keywordflow">if</span> ((<a class="code" href="classSchema__Temps__base.html#addda9320fe85fd273e84fa0d09f12eef" title="Residu.">residu_</a>&gt;0)&amp;&amp;(<a class="code" href="classSchema__Temps__base.html#a1e5d49638468e1bac6a94d50042fe193">residu_old_slope_</a>&gt;0))
<a name="l00234"></a>00234             <a class="code" href="classSchema__Temps__base.html#a63a1a1a4da33cfb8cce18fb7ac6761f5">cumul_slope_</a>+=(log(<a class="code" href="classSchema__Temps__base.html#addda9320fe85fd273e84fa0d09f12eef" title="Residu.">residu_</a>)-log(<a class="code" href="classSchema__Temps__base.html#a1e5d49638468e1bac6a94d50042fe193">residu_old_slope_</a>))/<a class="code" href="classSchema__Temps__base.html#a41d96b9bfd9ead46031343c31f9bfe5d" title="Pas de temps de calcul.">dt_</a>;
<a name="l00235"></a>00235           <a class="code" href="classSchema__Temps__base.html#a1e5d49638468e1bac6a94d50042fe193">residu_old_slope_</a>=<a class="code" href="classSchema__Temps__base.html#addda9320fe85fd273e84fa0d09f12eef" title="Residu.">residu_</a>;
<a name="l00236"></a>00236         }
<a name="l00237"></a>00237       <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#a4fdd281fc1915333d2e44dce212439d7">schema_impr</a>()&amp;&amp;(<a class="code" href="classSchema__Temps__base.html#a247769eddf9c0bfcaabc50b8dd90d401" title="Renvoie le nombre de pas de temps effectues.">nb_pas_dt</a>()&gt;0 &amp;&amp; <a class="code" href="classSchema__Temps__base.html#a0e4f67ef6086c09434ddc161668077b2" title="Renvoie le pas de temps (delta_t) courant.">pas_de_temps</a>()&gt;0))
<a name="l00238"></a>00238         {
<a name="l00239"></a>00239 <span class="comment">// On calcule le temps CPU moyen par pas de temps, inconvenient il peut varier fortement au cours du temps si divergence du calcul ou au contraire acceleration</span>
<a name="l00240"></a>00240 <span class="comment">// Mais Statistiques ne permet pas d&#39;avoir le temps CPU du dernier pas de temps (last_time appele ici renverrait le temps CPU depuis le debut du pas de temps)</span>
<a name="l00241"></a>00241 <span class="comment">// double cpu_per_timestep           = statistiques().last_time(temps_total_execution_counter_) / nb_pas_dt();</span>
<a name="l00242"></a>00242           <span class="keywordtype">double</span> nb_pas_selon_tmax          = (<a class="code" href="classSchema__Temps__base.html#a1c3b1eb35bf0fc0da015c27ec33b710a" title="Renvoie une reference sur le temps maximum.">temps_max</a>()-<a class="code" href="classSchema__Temps__base.html#a5054df01edb6d4f7baec7e612d423834" title="Renvoie le temps courant.">temps_courant</a>()) / <a class="code" href="classSchema__Temps__base.html#a0e4f67ef6086c09434ddc161668077b2" title="Renvoie le pas de temps (delta_t) courant.">pas_de_temps</a>();
<a name="l00243"></a>00243           <span class="keywordtype">double</span> nb_pas_selon_nb_pas_dt_max = <a class="code" href="classSchema__Temps__base.html#a27bf9c5a67bf4a1ddd036640ebcb26bc" title="Renvoie une reference sur le nombre de pas maxi.">nb_pas_dt_max</a>() - <a class="code" href="classSchema__Temps__base.html#a247769eddf9c0bfcaabc50b8dd90d401" title="Renvoie le nombre de pas de temps effectues.">nb_pas_dt</a>();
<a name="l00244"></a>00244           <span class="keywordtype">double</span> nb_pas_avant_fin= <a class="code" href="Double_8h.html#a04e03b7aad55468a8b8eae326087338a">dmin</a>(nb_pas_selon_tmax,nb_pas_selon_nb_pas_dt_max);
<a name="l00245"></a>00245 <span class="comment">// double seconds_to_finish  = nb_pas_avant_fin * cpu_per_timestep;</span>
<a name="l00246"></a>00246           <span class="keywordtype">double</span> dpercent=(1.-nb_pas_avant_fin/(nb_pas_avant_fin+ <a class="code" href="classSchema__Temps__base.html#a247769eddf9c0bfcaabc50b8dd90d401" title="Renvoie le nombre de pas de temps effectues.">nb_pas_dt</a>()));    <span class="comment">//!&lt; marche meme si c&#39;est ltemps max qui limite si la pente est &gt;0 on diverge ....</span>
<a name="l00247"></a>00247 <span class="comment"></span><span class="comment">//</span>
<a name="l00248"></a>00248           <span class="keywordflow">if</span> ((<a class="code" href="classSchema__Temps__base.html#ac3c38a091b9d8337e5e7352d14108ee6">seuil_statio_</a>&gt;0)&amp;&amp;(<a class="code" href="classSchema__Temps__base.html#a63a1a1a4da33cfb8cce18fb7ac6761f5">cumul_slope_</a>&lt;-1e-20) &amp;&amp; <a class="code" href="classSchema__Temps__base.html#ac3c38a091b9d8337e5e7352d14108ee6">seuil_statio_</a> &lt; <a class="code" href="classSchema__Temps__base.html#addda9320fe85fd273e84fa0d09f12eef" title="Residu.">residu_</a>) <span class="comment">//!&lt; dans un pb_couple on peut avoir (seuil_statio_ &gt; residu) pour un des problemes</span>
<a name="l00249"></a>00249 <span class="comment"></span>            {
<a name="l00250"></a>00250               <span class="keywordtype">double</span> distance= (-log(<a class="code" href="classSchema__Temps__base.html#addda9320fe85fd273e84fa0d09f12eef" title="Residu.">residu_</a>+1e-20)+log(<a class="code" href="classSchema__Temps__base.html#ac3c38a091b9d8337e5e7352d14108ee6">seuil_statio_</a>))/(<a class="code" href="classSchema__Temps__base.html#a63a1a1a4da33cfb8cce18fb7ac6761f5">cumul_slope_</a>)* <a class="code" href="classSchema__Temps__base.html#a247769eddf9c0bfcaabc50b8dd90d401" title="Renvoie le nombre de pas de temps effectues.">nb_pas_dt</a>();
<a name="l00251"></a>00251 
<a name="l00252"></a>00252 <span class="comment">// Cerr&lt;&lt;distance&lt;&lt;&quot; DDDDDD&quot;&lt;&lt;finl;</span>
<a name="l00253"></a>00253               <span class="keywordtype">double</span> dpercent2=<a class="code" href="classSchema__Temps__base.html#a5054df01edb6d4f7baec7e612d423834" title="Renvoie le temps courant.">temps_courant</a>()/(<a class="code" href="classSchema__Temps__base.html#a5054df01edb6d4f7baec7e612d423834" title="Renvoie le temps courant.">temps_courant</a>()+distance);
<a name="l00254"></a>00254               dpercent=<a class="code" href="Double_8h.html#aec69e4c89b77badf104ae9d6ae393b2c">dmax</a>(dpercent,dpercent2);
<a name="l00255"></a>00255             }
<a name="l00256"></a>00256           <span class="keywordtype">int</span> percent=int(dpercent*100);
<a name="l00257"></a>00257 
<a name="l00258"></a>00258           <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#a7a2bf65aa65d7b2ddb7ccc0bc5fd0668" title="Renvoie 1 s&#39;il y a lieu d&#39;effectuer une impression (cf dt_impr) Renvoie 0 sinon.">limpr</a>() )
<a name="l00259"></a>00259             {
<a name="l00260"></a>00260               <span class="keywordtype">double</span> seconds_to_finish  =  <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a21c24113a2042f33ce1134b473ebc1ac">last_time</a>(<a class="code" href="stat__counters_8cpp.html#a2cd262d038049f900ea193c706c476c3">temps_total_execution_counter_</a>)*(1.-dpercent)/dpercent;
<a name="l00261"></a>00261               <span class="keywordtype">int</span> integer_limit=(int)(pow(2.0,(<span class="keywordtype">double</span>)((<span class="keyword">sizeof</span>(<a class="code" href="arch_8h.html#a1caaf369d9c5f0817dbaa76b43b8d87b">True_int</a>)*8)-1))-1);
<a name="l00262"></a>00262               <span class="keywordflow">if</span> (seconds_to_finish&lt;integer_limit)
<a name="l00263"></a>00263                 {
<a name="l00264"></a>00264                   <span class="keywordtype">int</span> h  = int(seconds_to_finish/3600);
<a name="l00265"></a>00265                   <span class="keywordtype">int</span> mn = int((seconds_to_finish-3600*h)/60);
<a name="l00266"></a>00266                   <span class="keywordtype">int</span> s  = int(seconds_to_finish-3600*h-60*mn);
<a name="l00267"></a>00267                   <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a> &lt;&lt; <span class="stringliteral">&quot;Estimated CPU time to finish the run (according to &quot;</span> &lt;&lt; (nb_pas_selon_tmax&lt;nb_pas_selon_nb_pas_dt_max?<span class="stringliteral">&quot;tmax&quot;</span>:<span class="stringliteral">&quot;nb_pas_dt_max&quot;</span>) &lt;&lt; <span class="stringliteral">&quot; value) : &quot;</span>;
<a name="l00268"></a>00268                   <span class="keywordflow">if</span> (seconds_to_finish&lt;1)
<a name="l00269"></a>00269                     <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; seconds_to_finish &lt;&lt; <span class="stringliteral">&quot; s&quot;</span>;
<a name="l00270"></a>00270                   <span class="keywordflow">else</span>
<a name="l00271"></a>00271                     <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; h &lt;&lt; <span class="stringliteral">&quot;h&quot;</span> &lt;&lt; mn &lt;&lt; <span class="stringliteral">&quot;mn&quot;</span> &lt;&lt; s &lt;&lt; <span class="stringliteral">&quot;s&quot;</span>;
<a name="l00272"></a>00272 
<a name="l00273"></a>00273                   <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;. Progress: &quot;</span>&lt;&lt;(percent)&lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00274"></a>00274                 }
<a name="l00275"></a>00275             }
<a name="l00276"></a>00276           <span class="keywordflow">if</span> (!<a class="code" href="classSchema__Temps__base.html#ae20402318209fd548fecbcb07e3bb596">disable_progress</a>() &amp;&amp; <a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l00277"></a>00277             <a class="code" href="classSchema__Temps__base.html#abbc30f1284a9491c2f55a08ea4a4f4c8">progress_</a>&lt;&lt; (percent)&lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00278"></a>00278         }
<a name="l00279"></a>00279     }
<a name="l00280"></a>00280 <span class="comment">// Update time scheme:</span>
<a name="l00281"></a>00281   <a class="code" href="classSchema__Temps__base.html#acc7bc155d31abe8b073e931f43bbc399" title="Mise a jour du temps courant (t+=dt) et du nombre de pas de temps effectue (nb_pas_dt_++).">mettre_a_jour</a>();
<a name="l00282"></a>00282   <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a0faf52d1b518f5b0b2177f22efcc222d" title="Arret du compteur counter_id. On ajoute quantity a la somme des &#39;quantity&#39; (par defaut 0) stockees po...">end_count</a>(<a class="code" href="stat__counters_8cpp.html#ad0ff5c8b0553621de2a881e6965b6e52">mettre_a_jour_counter_</a>);
<a name="l00283"></a>00283   <a class="code" href="classSchema__Temps__base.html#a4b91db84965bb786c28df82647d1b6d5">dt_failed_</a> = DBL_MAX;
<a name="l00284"></a>00284 }
<a name="l00285"></a><a class="code" href="classSchema__Temps__base.html#ab106fd1df4dd6adb1b050693a06eaff5">00285</a> <span class="keywordtype">void</span> <a class="code" href="classSchema__Temps__base.html#ab106fd1df4dd6adb1b050693a06eaff5">Schema_Temps_base::terminate</a>()
<a name="l00286"></a>00286 {
<a name="l00287"></a>00287   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">je_suis_maitre</a>() &amp;&amp; !<a class="code" href="classSchema__Temps__base.html#ae20402318209fd548fecbcb07e3bb596">disable_progress</a>())
<a name="l00288"></a>00288     <a class="code" href="classSchema__Temps__base.html#abbc30f1284a9491c2f55a08ea4a4f4c8">progress_</a>&lt;&lt; (int)100&lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00289"></a>00289 }
<a name="l00290"></a>00290 
<a name="l00291"></a>00291 <span class="comment">// Precondition: validateTimeStep()</span>
<a name="l00292"></a>00292 <span class="comment">// Parametre: temps</span>
<a name="l00293"></a>00293 <span class="comment">// Signification: le temps a atteindre</span>
<a name="l00294"></a>00294 <span class="comment">// Valeurs par defaut:</span>
<a name="l00295"></a>00295 <span class="comment">// Contraintes:</span>
<a name="l00296"></a>00296 <span class="comment">// Acces:</span>
<a name="l00297"></a>00297 <span class="comment">// Exception:</span>
<a name="l00298"></a>00298 <span class="comment">// Effets de bord:</span>
<a name="l00299"></a>00299 <span class="comment">// Postcondition:</span>
<a name="l00300"></a>00300 <span class="comment">//</span><span class="comment"></span>
<a name="l00301"></a>00301 <span class="comment">//! Retourne 1 si lors du dernier pas de temps, le probleme n&#39;a pas evolue.</span>
<a name="l00302"></a>00302 <span class="comment"></span><span class="comment">/** \return 1 si le probleme n&#39;a pas evolue, 0 sinon.&lt;br&gt;</span>
<a name="l00303"></a>00303 <span class="comment">Signification:&lt;br&gt;</span>
<a name="l00304"></a>00304 <span class="comment">Contraintes: */</span>
<a name="l00305"></a><a class="code" href="classSchema__Temps__base.html#a5db611d7eb92f49bbc0562e547c5131c">00305</a> <span class="keywordtype">bool</span> <a class="code" href="classSchema__Temps__base.html#a5db611d7eb92f49bbc0562e547c5131c" title="Retourne 1 si lors du dernier pas de temps, le probleme n&#39;a pas evolue.">Schema_Temps_base::isStationary</a>()<span class="keyword"> const</span>
<a name="l00306"></a>00306 <span class="keyword"></span>{
<a name="l00307"></a>00307   <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#ad03548e5c596dac08ccfa866faa5ec0b" title="Stationary reached by the problem using this scheme.">stationnaire_atteint_</a> &amp;&amp; (<a class="code" href="classSchema__Temps__base.html#abd3374c522a8fdb6e6c97eab14f95ed1">nb_pas_dt_</a> &gt;= 2))
<a name="l00308"></a>00308     {
<a name="l00309"></a>00309       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;---------------------------------------------------------&quot;</span>
<a name="l00310"></a>00310            &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>
<a name="l00311"></a>00311            &lt;&lt; <span class="stringliteral">&quot;The problem &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a6e2edfe46a7f27b6fc8f114d92c35dc2">pb_base</a>().<a class="code" href="classProbleme__base.html#a58bc0b101f3f3f1d8522a9f41f1fad7b" title="surcharge Objet_U::le_nom() Renvoie le nom du probleme">le_nom</a>()
<a name="l00312"></a>00312            &lt;&lt; <span class="stringliteral">&quot; has reached the steady state&quot;</span>
<a name="l00313"></a>00313            &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00314"></a>00314       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00315"></a>00315     }
<a name="l00316"></a>00316   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00317"></a>00317 }
<a name="l00318"></a>00318 
<a name="l00319"></a><a class="code" href="classSchema__Temps__base.html#a5fa2d6fdaa5e161a4c28e579372dbd2f">00319</a> <span class="keywordtype">void</span> <a class="code" href="classSchema__Temps__base.html#a5fa2d6fdaa5e161a4c28e579372dbd2f">Schema_Temps_base::abortTimeStep</a>()
<a name="l00320"></a>00320 {
<a name="l00321"></a>00321   <a class="code" href="classProbleme__base.html" title="classe Probleme_base C&#39;est un Probleme_U qui n&#39;est pas un couplage. Le role d&#39;un Probleme_base est la...">Probleme_base</a>&amp; prob=<a class="code" href="classSchema__Temps__base.html#a6e2edfe46a7f27b6fc8f114d92c35dc2">pb_base</a>();
<a name="l00322"></a>00322   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;prob.<a class="code" href="classProbleme__base.html#abefceb0ac0d0b35d42a4daaa82a95f59">nombre_d_equations</a>(); i++)
<a name="l00323"></a>00323     prob.<a class="code" href="classProbleme__base.html#ae97586575b7e510d7945ce3a894b806a">equation</a>(i).<a class="code" href="classEquation__base.html#a643e4ffb873396a94d5f263fecccd9fc" title="Reinitialiser ce qui doit l&#39;etre. Cette methode est appelee lorsqu&#39;un pas de temps est abandonne...">abortTimeStep</a>();
<a name="l00324"></a>00324 
<a name="l00325"></a>00325   <a class="code" href="classSchema__Temps__base.html#a41d96b9bfd9ead46031343c31f9bfe5d" title="Pas de temps de calcul.">dt_</a> = prob.<a class="code" href="classProbleme__base.html#a74469695e1681fcba4ef15614de8c463" title="Calcul la valeur du prochain pas de temps du probleme. On calcule le minimum des pas de temps des equ...">calculer_pas_de_temps</a>();
<a name="l00326"></a>00326 }
<a name="l00327"></a>00327 
<a name="l00328"></a><a class="code" href="classSchema__Temps__base.html#a4f8fdd474836172881c9349eece9d567">00328</a> <span class="keywordtype">void</span> <a class="code" href="classSchema__Temps__base.html#a4f8fdd474836172881c9349eece9d567">Schema_Temps_base::associer_pb</a>(<span class="keyword">const</span> <a class="code" href="classProbleme__base.html" title="classe Probleme_base C&#39;est un Probleme_U qui n&#39;est pas un couplage. Le role d&#39;un Probleme_base est la...">Probleme_base</a>&amp; un_probleme)
<a name="l00329"></a>00329 {
<a name="l00330"></a>00330 <span class="comment">// assert(!mon_probleme.non_nul());</span>
<a name="l00331"></a>00331   <a class="code" href="classSchema__Temps__base.html#a99eb764548c21553a104134be803530d">mon_probleme</a>=un_probleme;
<a name="l00332"></a>00332 }
<a name="l00333"></a>00333 
<a name="l00334"></a>00334 
<a name="l00335"></a>00335 
<a name="l00336"></a><a class="code" href="classSchema__Temps__base.html#a40580afb2766399945c3bcae105be78e">00336</a> <span class="keywordtype">void</span> <a class="code" href="classSchema__Temps__base.html#a40580afb2766399945c3bcae105be78e">Schema_Temps_base::set_param</a>(<a class="code" href="classParam.html" title="Defined below in this file.">Param</a>&amp; param)
<a name="l00337"></a>00337 {
<a name="l00338"></a>00338   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;tinit&quot;</span>,&amp;<a class="code" href="classSchema__Temps__base.html#ab13482fd427c6008c91d0df5d3a7e07f">tinit_</a>); <span class="comment">//!&lt; XD_ADD_P double Value of initial calculation time (0 by default).</span>
<a name="l00339"></a>00339 <span class="comment"></span>  param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>( <span class="stringliteral">&quot;tmax&quot;</span>,&amp;<a class="code" href="classSchema__Temps__base.html#a51c0bc9f66a0a75d26b7685912945d0c">tmax_</a>); <span class="comment">//!&lt; XD_ADD_P double Time during which the calculation will be stopped (1e30s by default).</span>
<a name="l00340"></a>00340 <span class="comment"></span>  param.<a class="code" href="classParam.html#a8d8bcddfd8087e577ffbb170c68e4f88">ajouter_non_std</a>( <span class="stringliteral">&quot;tcpumax&quot;</span>,(<span class="keyword">this</span>)); <span class="comment">//!&lt; XD_ADD_P double CPU time limit (must be specified in hours) for which the calculation is stopped (1e30s by default).</span>
<a name="l00341"></a>00341 <span class="comment"></span>  param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>( <span class="stringliteral">&quot;dt_min&quot;</span>,&amp;<a class="code" href="classSchema__Temps__base.html#abc40918e7ff94cc1897d12b2f3bb1340" title="Pas de temps min fixe par l&#39;utilisateur.">dt_min_</a>); <span class="comment">//!&lt; XD_ADD_P double Minimum calculation time step (1e-16s by default).</span>
<a name="l00342"></a>00342 <span class="comment"></span>  param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>( <span class="stringliteral">&quot;dt_max&quot;</span>,&amp;<a class="code" href="classSchema__Temps__base.html#a27ac9c3e8c2ca6c9bbe5d063925586e3">dt_max_str_</a>); <span class="comment">//!&lt; XD_ADD_P chaine Maximum calculation time step as function of time (1e30s by default).</span>
<a name="l00343"></a>00343 <span class="comment"></span>  param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>( <span class="stringliteral">&quot;dt_sauv&quot;</span>,&amp;<a class="code" href="classSchema__Temps__base.html#a06f9a146ff9c587a5bbc1ce90c05bf5e">dt_sauv_</a>); <span class="comment">//!&lt; XD_ADD_P double Save time step value (1e30s by default). Every dt_sauv, fields are saved in the .sauv file. The file contains all the information saved over time. If this instruction is not entered, results are saved only upon calculation completion. To disable the writing of the .sauv files, you must specify 0. Note that dt_sauv is in terms of physical time (not cpu time).</span>
<a name="l00344"></a>00344 <span class="comment"></span>  param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>( <span class="stringliteral">&quot;dt_impr&quot;</span>,&amp;<a class="code" href="classSchema__Temps__base.html#ab72294e6106b3c0eb25cb7e3e1f6fd56" title="Pas de temps d&#39;impression.">dt_impr_</a>); <span class="comment">//!&lt; XD_ADD_P double Scheme parameter printing time step in time (1e30s by default). The time steps and the flux balances are printed (incorporated onto every side of processed domains) into the .out file.</span>
<a name="l00345"></a>00345 <span class="comment"></span>  param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>( <span class="stringliteral">&quot;facsec&quot;</span>,&amp;<a class="code" href="classSchema__Temps__base.html#a8cdc40f1adfd8ff29d7f9c75330920ee">facsec_</a>); <span class="comment">//!&lt; XD_ADD_P double Value assigned to the safety factor for the time step (1. by default). The time step calculated is multiplied by the safety factor. The first thing to try when a calculation does not converge with an explicit time scheme is to reduce the facsec to 0.5. NL2 Warning: Some schemes needs a facsec lower than 1 (0.5 is a good start), for example Schema_Adams_Bashforth_order_3.</span>
<a name="l00346"></a>00346 <span class="comment"></span>  param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>( <span class="stringliteral">&quot;seuil_statio&quot;</span>,&amp;<a class="code" href="classSchema__Temps__base.html#ac3c38a091b9d8337e5e7352d14108ee6">seuil_statio_</a>); <span class="comment">//!&lt; XD_ADD_P double Value of the convergence threshold (1e-12 by default). Problems using this type of time scheme converge when the derivatives dGi/dt NL1 of all the unknown transported values Gi have a combined absolute value less than this value. This is the keyword used to set the permanent rating threshold.</span>
<a name="l00347"></a>00347 <span class="comment"></span>  param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>( <span class="stringliteral">&quot;seuil_statio_relatif_deconseille&quot;</span>,&amp;<a class="code" href="classSchema__Temps__base.html#a03e1b245412eb5948b423a767c56cc58" title="Drapeau pour specifier si seuil_statio_ est une valeur absolue (defaut) ou relative.">seuil_statio_relatif_deconseille_</a>); <span class="comment">//!&lt; XD_ADD_P int not_set</span>
<a name="l00348"></a>00348 <span class="comment"></span>  param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>( <span class="stringliteral">&quot;diffusion_implicite&quot;</span>,&amp;<a class="code" href="classSchema__Temps__base.html#ae4de688b9f23027646164439fc484372">ind_diff_impl_</a>); <span class="comment">//!&lt; XD_ADD_P int Keyword to make the diffusive term in the Navier-Stokes equations implicit (in this case, it should be set to 1). The stability time step is then only based on the convection time step (dt=facsec*dt_convection). Thus, in some circumstances, an important gain is achieved with respect to the time step (large diffusion with respect to convection on tightened meshes). Caution: It is however recommended that the user avoids exceeding the convection time step by selecting a too large facsec value. Start with a facsec value of 1 and then increase it gradually if you wish to accelerate calculation. In addition, for a natural convection calculation with a zero initial velocity, in the first time step, the convection time is infinite and therefore dt=facsec*dt_max.</span>
<a name="l00349"></a>00349 <span class="comment"></span>  param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>( <span class="stringliteral">&quot;seuil_diffusion_implicite&quot;</span>,&amp;<a class="code" href="classSchema__Temps__base.html#ae529919fc4a729acc2d32c2b1a4aea2e">seuil_diff_impl_</a>); <span class="comment">//!&lt; XD_ADD_P double This keyword changes the default value (1e-6) of convergency criteria for the resolution by conjugate gradient used for implicit diffusion.</span>
<a name="l00350"></a>00350 <span class="comment"></span>  param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>( <span class="stringliteral">&quot;impr_diffusion_implicite&quot;</span>,&amp;<a class="code" href="classSchema__Temps__base.html#abc110a1311c48fd2d8bdb6724ce261a3">impr_diff_impl_</a>); <span class="comment">//!&lt; XD_ADD_P int Unactivate (default) or not the printing of the convergence during the resolution of the conjugate gradient.</span>
<a name="l00351"></a>00351 <span class="comment"></span>  param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>( <span class="stringliteral">&quot;no_error_if_not_converged_diffusion_implicite&quot;</span>,&amp;<a class="code" href="classSchema__Temps__base.html#a4ebe850f89c269e8fb2688b7108fbc32">no_error_if_not_converged_diff_impl_</a>); <span class="comment">//!&lt; XD_ADD_P int not_set</span>
<a name="l00352"></a>00352 <span class="comment"></span>  param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>( <span class="stringliteral">&quot;no_conv_subiteration_diffusion_implicite&quot;</span>,&amp;<a class="code" href="classSchema__Temps__base.html#a81850970a19d34f6271719508afeb3a9">no_conv_subiteration_diff_impl_</a>); <span class="comment">//!&lt; XD_ADD_P int not_set</span>
<a name="l00353"></a>00353 <span class="comment"></span>  param.<a class="code" href="classParam.html#a8d8bcddfd8087e577ffbb170c68e4f88">ajouter_non_std</a>( <span class="stringliteral">&quot;dt_start&quot;</span>,(<span class="keyword">this</span>)); <span class="comment">//!&lt; XD attr dt_start dt_start dt_start 1 dt_start dt_min : the first iteration is based on dt_min. NL2 dt_start dt_calc : the time step at first iteration is calculated in agreement with CFL condition. NL2 dt_start dt_fixe value : the first time step is fixed by the user (recommended when resuming calculation with Crank Nicholson temporal scheme to ensure continuity). NL2 By default, the first iteration is based on dt_calc. param.ajouter( &quot;nb_pas_dt_max&quot;,&amp;nb_pas_dt_max_); nb_pas_dt_max non standard pour valgrind</span>
<a name="l00354"></a>00354 <span class="comment"></span><span class="comment">//</span>
<a name="l00355"></a>00355 <span class="comment">//</span>
<a name="l00356"></a>00356   param.<a class="code" href="classParam.html#a8d8bcddfd8087e577ffbb170c68e4f88">ajouter_non_std</a>( <span class="stringliteral">&quot;nb_pas_dt_max&quot;</span>,(<span class="keyword">this</span>)); <span class="comment">//!&lt; XD_ADD_P int Maximum number of calculation time steps (1e9 by default).</span>
<a name="l00357"></a>00357 <span class="comment"></span>  param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>( <span class="stringliteral">&quot;niter_max_diffusion_implicite&quot;</span>,&amp;<a class="code" href="classSchema__Temps__base.html#a7f6317e09495e7c1c99e01c491a0878d">niter_max_diff_impl_</a>); <span class="comment">//!&lt; XD_ADD_P int This keyword changes the default value (number of unknowns) of the maximal iterations number in the conjugate gradient method used for implicit diffusion.</span>
<a name="l00358"></a>00358 <span class="comment"></span>  param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>( <span class="stringliteral">&quot;precision_impr&quot;</span>,&amp;<a class="code" href="classSchema__Temps__base.html#a1596902b83c3de53d94cbd03f9a614c8" title="Nombre de chiffres significatifs impression.">precision_impr_</a>); <span class="comment">//!&lt; XD_ADD_P int Optional keyword to define the digit number for flux values printed into .out files (by default 3).</span>
<a name="l00359"></a>00359 <span class="comment"></span>  param.<a class="code" href="classParam.html#a8d8bcddfd8087e577ffbb170c68e4f88">ajouter_non_std</a>( <span class="stringliteral">&quot;periode_sauvegarde_securite_en_heures&quot;</span>,(<span class="keyword">this</span>)); <span class="comment">//!&lt; XD_ADD_P double To change the default period (23 hours) between the save of the fields in .sauv file.</span>
<a name="l00360"></a>00360 <span class="comment"></span>  param.<a class="code" href="classParam.html#a8d8bcddfd8087e577ffbb170c68e4f88">ajouter_non_std</a>( <span class="stringliteral">&quot;no_check_disk_space&quot;</span>,(<span class="keyword">this</span>)); <span class="comment">//!&lt; XD_ADD_P flag To disable the check of the available amount of disk space during the calculation.</span>
<a name="l00361"></a>00361 <span class="comment"></span>  param.<a class="code" href="classParam.html#ae3d50612a0014a9d58e6e035a65f20e5">ajouter_flag</a>( <span class="stringliteral">&quot;disable_progress&quot;</span>,&amp;<a class="code" href="classSchema__Temps__base.html#a22b9fb1d3ad5f1e1a25941810947ea53" title="Flag to disable the writing of the .progress file.">disable_progress_</a>); <span class="comment">//!&lt; XD_ADD_P flag To disable the writing of the .progress file.</span>
<a name="l00362"></a>00362 <span class="comment"></span>  param.<a class="code" href="classParam.html#ae3d50612a0014a9d58e6e035a65f20e5">ajouter_flag</a>( <span class="stringliteral">&quot;disable_dt_ev&quot;</span>,&amp;<a class="code" href="classSchema__Temps__base.html#acc3e550d4186a0e1407ee8142a9e53f7" title="Flag to disable the writing of the .dt_ev file.">disable_dt_ev_</a>); <span class="comment">//!&lt; XD_ADD_P flag To disable the writing of the .dt_ev file.</span>
<a name="l00363"></a>00363 <span class="comment"></span>  param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>( <span class="stringliteral">&quot;gnuplot_header&quot;</span>,&amp;<a class="code" href="classSchema__Temps__base.html#ad4514188507072ae4cb3142a8c3864bd">gnuplot_header_</a>); <span class="comment">//!&lt; XD_ADD_P int Optional keyword to modify the header of the .out files. Allows to use the column title instead of columns number.</span>
<a name="l00364"></a>00364 <span class="comment"></span>}
<a name="l00365"></a>00365 <span class="comment">// Precondition:</span>
<a name="l00366"></a>00366 <span class="comment">// Parametre: Sortie&amp; os</span>
<a name="l00367"></a>00367 <span class="comment">// Signification: le flot de sortie</span>
<a name="l00368"></a>00368 <span class="comment">// Valeurs par defaut:</span>
<a name="l00369"></a>00369 <span class="comment">// Contraintes:</span>
<a name="l00370"></a>00370 <span class="comment">// Acces: sortie</span>
<a name="l00371"></a>00371 <span class="comment">// Exception:</span>
<a name="l00372"></a>00372 <span class="comment">// Effets de bord:</span>
<a name="l00373"></a>00373 <span class="comment">// Postcondition: la methode ne modifie pas l&#39;objet</span>
<a name="l00374"></a>00374 <span class="comment">//</span>
<a name="l00375"></a>00375 <span class="comment">//</span>
<a name="l00376"></a>00376 <span class="comment">//</span>
<a name="l00377"></a>00377 <span class="comment">//</span><span class="comment"></span>
<a name="l00378"></a>00378 <span class="comment">//! Surcharge Objet_U::printOn(Sortie\&amp;)&lt;br&gt;Imprime le schema en temps sur un flot de sortie.&lt;br&gt;!! Attention n&#39;est pas symetrique de la lecture !!&lt;br&gt;On ecrit les differents parametres du schema en temps.</span>
<a name="l00379"></a>00379 <span class="comment"></span><span class="comment">/** \return Sortie\&amp;&lt;br&gt;</span>
<a name="l00380"></a>00380 <span class="comment">Signification: le flot de sortie modifie&lt;br&gt;</span>
<a name="l00381"></a>00381 <span class="comment">Contraintes: */</span>
<a name="l00382"></a><a class="code" href="classSchema__Temps__base.html#acc4b58bf5e915fc12e5a1f331fc724b3">00382</a> <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classSchema__Temps__base.html#acc4b58bf5e915fc12e5a1f331fc724b3" title="Surcharge Objet_U::printOn(Sortie&amp;) Imprime le schema en temps sur un flot de sortie. !! Attention n&#39;est pas symetrique de la lecture !! On ecrit les differents parametres du schema en temps.">Schema_Temps_base::printOn</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os)<span class="keyword"> const</span>
<a name="l00383"></a>00383 <span class="keyword"></span>{
<a name="l00384"></a>00384   os &lt;&lt; <span class="stringliteral">&quot;dt &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a41d96b9bfd9ead46031343c31f9bfe5d" title="Pas de temps de calcul.">dt_</a> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00385"></a>00385   os &lt;&lt; <span class="stringliteral">&quot;temps_courant &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#ae6dd72bce33a443217b83f56a4da23a2">temps_courant_</a> &lt;&lt; finl ;
<a name="l00386"></a>00386   os &lt;&lt; <span class="stringliteral">&quot;tinit &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#ab13482fd427c6008c91d0df5d3a7e07f">tinit_</a> &lt;&lt; finl;
<a name="l00387"></a>00387   os &lt;&lt; <span class="stringliteral">&quot;tmax &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a51c0bc9f66a0a75d26b7685912945d0c">tmax_</a> &lt;&lt; finl ;
<a name="l00388"></a>00388   os &lt;&lt; <span class="stringliteral">&quot;tcpumax &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a9de23994659e75064d9951bbd46b5ed9">tcpumax_</a> &lt;&lt; finl ;
<a name="l00389"></a>00389   os &lt;&lt; <span class="stringliteral">&quot;nb_pas_dt &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#abd3374c522a8fdb6e6c97eab14f95ed1">nb_pas_dt_</a> &lt;&lt; finl;
<a name="l00390"></a>00390   os &lt;&lt; <span class="stringliteral">&quot;nb_pas_dt_max &quot;</span> &lt;&lt;  <a class="code" href="classSchema__Temps__base.html#a4cd1e401f61da498c719d2ff881d9552">nb_pas_dt_max_</a> &lt;&lt; finl;
<a name="l00391"></a>00391   os &lt;&lt; <span class="stringliteral">&quot;dt_min &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#abc40918e7ff94cc1897d12b2f3bb1340" title="Pas de temps min fixe par l&#39;utilisateur.">dt_min_</a> &lt;&lt; finl;
<a name="l00392"></a>00392   os &lt;&lt; <span class="stringliteral">&quot;dt_max &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a55d7d507689898465bf9ce320446ba99" title="Pas de temps max fixe par l&#39;utilisateur.">dt_max_</a> &lt;&lt; finl;
<a name="l00393"></a>00393   os &lt;&lt; <span class="stringliteral">&quot;facsec &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a8cdc40f1adfd8ff29d7f9c75330920ee">facsec_</a> &lt;&lt; finl;
<a name="l00394"></a>00394   os &lt;&lt; <span class="stringliteral">&quot;seuil_statio&quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#ac3c38a091b9d8337e5e7352d14108ee6">seuil_statio_</a> &lt;&lt; finl;
<a name="l00395"></a>00395   os &lt;&lt; <span class="stringliteral">&quot;seuil_statio_relatif_deconseille&quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a03e1b245412eb5948b423a767c56cc58" title="Drapeau pour specifier si seuil_statio_ est une valeur absolue (defaut) ou relative.">seuil_statio_relatif_deconseille_</a> &lt;&lt; finl;
<a name="l00396"></a>00396   os &lt;&lt; <span class="stringliteral">&quot;dt_sauv &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a06f9a146ff9c587a5bbc1ce90c05bf5e">dt_sauv_</a> &lt;&lt; finl;
<a name="l00397"></a>00397   os &lt;&lt; <span class="stringliteral">&quot;limite_cpu_sans_sauvegarde &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a686b5be98e2c5a666713f85652188b0e">limite_cpu_sans_sauvegarde_</a> &lt;&lt; finl;
<a name="l00398"></a>00398   os &lt;&lt; <span class="stringliteral">&quot;dt_impr &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#ab72294e6106b3c0eb25cb7e3e1f6fd56" title="Pas de temps d&#39;impression.">dt_impr_</a> &lt;&lt; finl;
<a name="l00399"></a>00399   os &lt;&lt; <span class="stringliteral">&quot;precision_impr &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a1596902b83c3de53d94cbd03f9a614c8" title="Nombre de chiffres significatifs impression.">precision_impr_</a> &lt;&lt; finl;
<a name="l00400"></a>00400   os &lt;&lt; <span class="stringliteral">&quot;stationnaire_atteint &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#ad03548e5c596dac08ccfa866faa5ec0b" title="Stationary reached by the problem using this scheme.">stationnaire_atteint_</a> &lt;&lt; finl;
<a name="l00401"></a>00401   os &lt;&lt; <span class="stringliteral">&quot;diffusion_implicite &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#ae4de688b9f23027646164439fc484372">ind_diff_impl_</a> &lt;&lt; finl ;
<a name="l00402"></a>00402   os &lt;&lt; <span class="stringliteral">&quot;seuil_diffusion_implicite &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#ae529919fc4a729acc2d32c2b1a4aea2e">seuil_diff_impl_</a> &lt;&lt; finl ;
<a name="l00403"></a>00403   os &lt;&lt; <span class="stringliteral">&quot;impr_diffusion_implicite &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#abc110a1311c48fd2d8bdb6724ce261a3">impr_diff_impl_</a> &lt;&lt; finl ;
<a name="l00404"></a>00404   os &lt;&lt; <span class="stringliteral">&quot;niter_max_diffusion_implicite &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a7f6317e09495e7c1c99e01c491a0878d">niter_max_diff_impl_</a> &lt;&lt; finl ;
<a name="l00405"></a>00405   os &lt;&lt; <span class="stringliteral">&quot;no_file_allocation &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a7c9adce0013f49c748143ab53e37dd81" title="1 = allocation espace disque (par defaut), 0 sinon">file_allocation_</a> &lt;&lt; finl ;
<a name="l00406"></a>00406   os &lt;&lt; <span class="stringliteral">&quot;disable_progress &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a22b9fb1d3ad5f1e1a25941810947ea53" title="Flag to disable the writing of the .progress file.">disable_progress_</a> &lt;&lt; finl ;
<a name="l00407"></a>00407   os &lt;&lt; <span class="stringliteral">&quot;disable_dt_ev &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#acc3e550d4186a0e1407ee8142a9e53f7" title="Flag to disable the writing of the .dt_ev file.">disable_dt_ev_</a> &lt;&lt; finl ;
<a name="l00408"></a>00408   os &lt;&lt; <span class="stringliteral">&quot;fin &quot;</span> &lt;&lt; finl;
<a name="l00409"></a>00409   <span class="keywordflow">return</span> os ;
<a name="l00410"></a>00410 }
<a name="l00411"></a>00411 
<a name="l00412"></a>00412 
<a name="l00413"></a>00413 <span class="comment">// Precondition:</span>
<a name="l00414"></a>00414 <span class="comment">// Parametre: Entree&amp; is</span>
<a name="l00415"></a>00415 <span class="comment">// Signification: le flot d&#39;entree</span>
<a name="l00416"></a>00416 <span class="comment">// Valeurs par defaut:</span>
<a name="l00417"></a>00417 <span class="comment">// Contraintes:</span>
<a name="l00418"></a>00418 <span class="comment">// Acces: entree/sortie</span>
<a name="l00419"></a>00419 <span class="comment">// Exception: accolade ouvrante attendue</span>
<a name="l00420"></a>00420 <span class="comment">// Exception: motclef inconnu a cet endroit</span>
<a name="l00421"></a>00421 <span class="comment">// Effets de bord:</span>
<a name="l00422"></a>00422 <span class="comment">// Postcondition: le schema en temps est lu</span>
<a name="l00423"></a>00423 <span class="comment">//</span>
<a name="l00424"></a>00424 <span class="comment">//</span>
<a name="l00425"></a>00425 <span class="comment">//</span>
<a name="l00426"></a>00426 <span class="comment">//</span>
<a name="l00427"></a>00427 <span class="comment">//</span>
<a name="l00428"></a>00428 <span class="comment">//</span>
<a name="l00429"></a>00429 <span class="comment">//</span>
<a name="l00430"></a>00430 <span class="comment">//</span><span class="comment"></span>
<a name="l00431"></a>00431 <span class="comment">//! Lecture d&#39;un schema en temps a partir d&#39;un flot d&#39;entree.&lt;br&gt;Le format de lecture attendu est le suivant:&lt;br&gt;{&lt;br&gt;[Motcle valeur_reelle]&lt;br&gt;}&lt;br&gt;Les mots clefs peuvent etre:&lt;br&gt;tinit, tmax, nb_pas_dt_max, dt_min, dt_max,&lt;br&gt;dt_sauv, dt_impr, facsec, seuil_statio,</span>
<a name="l00432"></a>00432 <span class="comment"></span><span class="comment">/** \return Entree\&amp;&lt;br&gt;</span>
<a name="l00433"></a>00433 <span class="comment">Signification: le flot d&#39;entree modifie&lt;br&gt;</span>
<a name="l00434"></a>00434 <span class="comment">Contraintes: */</span>
<a name="l00435"></a><a class="code" href="classSchema__Temps__base.html#ae0e4d857b7bc4684c70386177330cdf0">00435</a> <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classSchema__Temps__base.html#ae0e4d857b7bc4684c70386177330cdf0" title="Lecture d&#39;un schema en temps a partir d&#39;un flot d&#39;entree. Le format de lecture attendu est le suivant...">Schema_Temps_base::readOn</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00436"></a>00436 {
<a name="l00437"></a>00437   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;Reading of data for a &quot;</span>&lt;&lt;<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>()&lt;&lt;<span class="stringliteral">&quot; time scheme&quot;</span>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00438"></a>00438   <a class="code" href="classParam.html" title="Defined below in this file.">Param</a> param(<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>());
<a name="l00439"></a>00439   <a class="code" href="classSchema__Temps__base.html#a40580afb2766399945c3bcae105be78e">set_param</a>(param);
<a name="l00440"></a>00440   param.<a class="code" href="classParam.html#aa9d44fc51b4a08b357733a97dc7acaad" title="Read the is input with the parameters (defined with the Param object) inside: { ... } Example, to read: { a 1 b 2 } Param param(que_suis_je()); int a,b; param.ajouter(&quot;a&quot;,&amp;a); param.ajouter(&quot;b&quot;,&amp;b); param.lire_avec_accolades_depuis(is);.">lire_avec_accolades_depuis</a>(is);
<a name="l00441"></a>00441   <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#abc40918e7ff94cc1897d12b2f3bb1340" title="Pas de temps min fixe par l&#39;utilisateur.">dt_min_</a>==0)
<a name="l00442"></a>00442     {
<a name="l00443"></a>00443       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;dt_min has not been read or is set to 0.&quot;</span>&lt;&lt;finl;
<a name="l00444"></a>00444       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;Assign a value strictly positive to dt_min.&quot;</span>&lt;&lt;finl;
<a name="l00445"></a>00445       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00446"></a>00446     }
<a name="l00447"></a>00447   <a class="code" href="classSchema__Temps__base.html#ae6dd72bce33a443217b83f56a4da23a2">temps_courant_</a>=<a class="code" href="classSchema__Temps__base.html#ab13482fd427c6008c91d0df5d3a7e07f">tinit_</a>;
<a name="l00448"></a>00448   <a class="code" href="classSchema__Temps__base.html#ab58cb017d1983269f669ef2facdd2bca">temps_precedent_</a>=<a class="code" href="classSchema__Temps__base.html#ab13482fd427c6008c91d0df5d3a7e07f">tinit_</a>;
<a name="l00449"></a>00449   <a class="code" href="classSchema__Temps__base.html#a9cdfdb4baa01a6461f4cf7edc6c2b0a5">lu_</a>=1;
<a name="l00450"></a>00450   <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#a06f9a146ff9c587a5bbc1ce90c05bf5e">dt_sauv_</a> &lt;= 0.)
<a name="l00451"></a>00451     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;NO next backup, by security, because dt_sauv = &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a06f9a146ff9c587a5bbc1ce90c05bf5e">dt_sauv_</a> &lt;&lt; finl;
<a name="l00452"></a>00452   <span class="keywordflow">else</span>
<a name="l00453"></a>00453     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;The next backup, by security, will take place after &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a686b5be98e2c5a666713f85652188b0e">limite_cpu_sans_sauvegarde_</a>/3600 &lt;&lt; <span class="stringliteral">&quot; hours of calculation.&quot;</span> &lt;&lt; finl;
<a name="l00454"></a>00454   <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#a27ac9c3e8c2ca6c9bbe5d063925586e3">dt_max_str_</a> != <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>())
<a name="l00455"></a>00455     {
<a name="l00456"></a>00456       <a class="code" href="classSchema__Temps__base.html#a3727f5065c31a88df3ce99f8d0a89238">dt_max_fn_</a>.<a class="code" href="classParser__U.html#a3ff44eabf641cbcea9ca59f84167e2c1">setNbVar</a>(1);
<a name="l00457"></a>00457       <a class="code" href="classSchema__Temps__base.html#a3727f5065c31a88df3ce99f8d0a89238">dt_max_fn_</a>.<a class="code" href="classParser__U.html#a25d581b85688da391aa64117abf0a073">setString</a>(<a class="code" href="classSchema__Temps__base.html#a27ac9c3e8c2ca6c9bbe5d063925586e3">dt_max_str_</a>);
<a name="l00458"></a>00458       <a class="code" href="classSchema__Temps__base.html#a3727f5065c31a88df3ce99f8d0a89238">dt_max_fn_</a>.<a class="code" href="classParser__U.html#ae216b7daee6c4bb756423ffed5674293">addVar</a>(<span class="stringliteral">&quot;t&quot;</span>);
<a name="l00459"></a>00459       <a class="code" href="classSchema__Temps__base.html#a3727f5065c31a88df3ce99f8d0a89238">dt_max_fn_</a>.<a class="code" href="classParser__U.html#a441c2fd29f5d4370c0c7b6a1cdfe56d5">parseString</a>();
<a name="l00460"></a>00460       <a class="code" href="classSchema__Temps__base.html#a55d7d507689898465bf9ce320446ba99" title="Pas de temps max fixe par l&#39;utilisateur.">dt_max_</a> = <a class="code" href="classSchema__Temps__base.html#a3727f5065c31a88df3ce99f8d0a89238">dt_max_fn_</a>.<a class="code" href="classParser__U.html#a61605bc1b85e466f884f1739e811b6b4">eval</a>();
<a name="l00461"></a>00461     }
<a name="l00462"></a>00462   <span class="keywordflow">return</span> is ;
<a name="l00463"></a>00463 }
<a name="l00464"></a>00464 
<a name="l00465"></a><a class="code" href="classSchema__Temps__base.html#aa5d9d8e5a1611178a225b4efc67dbcaa">00465</a> <span class="keywordtype">int</span> <a class="code" href="classSchema__Temps__base.html#aa5d9d8e5a1611178a225b4efc67dbcaa" title="Lecture des parametres de type non simple d&#39;un objet_U a partir d&#39;un flot d&#39;entree.">Schema_Temps_base::lire_motcle_non_standard</a>(<span class="keyword">const</span> <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>&amp; mot, <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00466"></a>00466 {
<a name="l00467"></a>00467   <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> motlu;
<a name="l00468"></a>00468   <span class="keywordflow">if</span> (mot==<span class="stringliteral">&quot;dt_start&quot;</span>)
<a name="l00469"></a>00469     {
<a name="l00470"></a>00470       is&gt;&gt;motlu;
<a name="l00471"></a>00471       <a class="code" href="classMotcles.html" title="Un tableau d&#39;objets de la classe Motcle.">Motcles</a> les_mots2(4);
<a name="l00472"></a>00472       les_mots2[0]=<span class="stringliteral">&quot;dt_std&quot;</span>;
<a name="l00473"></a>00473       les_mots2[1]=<span class="stringliteral">&quot;dt_min&quot;</span>;
<a name="l00474"></a>00474       les_mots2[2]=<span class="stringliteral">&quot;dt_calc&quot;</span>;
<a name="l00475"></a>00475       les_mots2[3]=<span class="stringliteral">&quot;dt_fixe&quot;</span>;
<a name="l00476"></a>00476       <span class="keywordtype">int</span> rang2=les_mots2.<a class="code" href="classMotcles.html#afecd68f73e904bc129022a236ff6ab15">search</a>(motlu);
<a name="l00477"></a>00477       <span class="keywordflow">switch</span>(rang2)
<a name="l00478"></a>00478         {
<a name="l00479"></a>00479         <span class="keywordflow">case</span> 0:
<a name="l00480"></a>00480         <span class="keywordflow">case</span> 1:
<a name="l00481"></a>00481         <span class="keywordflow">case</span> 2:
<a name="l00482"></a>00482           {
<a name="l00483"></a>00483             <a class="code" href="classSchema__Temps__base.html#a58accd37da9e610cd9c67b249ed914d1" title="mode calcul du pas de temps de depart">mode_dt_start_</a>=-rang2;
<a name="l00484"></a>00484             <span class="keywordflow">break</span>;
<a name="l00485"></a>00485           }
<a name="l00486"></a>00486         <span class="keywordflow">case</span> 3:
<a name="l00487"></a>00487           {
<a name="l00488"></a>00488             is &gt;&gt;<a class="code" href="classSchema__Temps__base.html#a58accd37da9e610cd9c67b249ed914d1" title="mode calcul du pas de temps de depart">mode_dt_start_</a>;
<a name="l00489"></a>00489             <span class="keywordflow">break</span>;
<a name="l00490"></a>00490           }
<a name="l00491"></a>00491         <span class="keywordflow">default</span>:
<a name="l00492"></a>00492           {
<a name="l00493"></a>00493             <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot; We do not understand &quot;</span>&lt;&lt;motlu &lt;&lt;<span class="stringliteral">&quot;in Schema_Temps_base::lire_motcle_non_standard&quot;</span>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00494"></a>00494             <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;keywords understood &quot;</span>&lt;&lt;les_mots2&lt;&lt;finl;
<a name="l00495"></a>00495             <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00496"></a>00496           }
<a name="l00497"></a>00497         }
<a name="l00498"></a>00498       <span class="keywordflow">return</span> 1;
<a name="l00499"></a>00499     }
<a name="l00500"></a>00500   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mot==<span class="stringliteral">&quot;nb_pas_dt_max&quot;</span>)
<a name="l00501"></a>00501     <a class="code" href="classSchema__Temps__base.html#ae022cd6860a5fed1a26e18d4b9d45a07">lire_nb_pas_dt_max</a>(is);
<a name="l00502"></a>00502   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mot==<span class="stringliteral">&quot;periode_sauvegarde_securite_en_heures&quot;</span>)
<a name="l00503"></a>00503     <a class="code" href="classSchema__Temps__base.html#a10242dba9533cd4fac8dd3b729ccf889">lire_periode_sauvegarde_securite_en_heures</a>(is);
<a name="l00504"></a>00504   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mot==<span class="stringliteral">&quot;tcpumax&quot;</span>)
<a name="l00505"></a>00505     <a class="code" href="classSchema__Temps__base.html#ad7f6c264ce309872f0d3e88705c7cff9">lire_temps_cpu_max</a>(is);
<a name="l00506"></a>00506   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mot==<span class="stringliteral">&quot;no_check_disk_space&quot;</span>)
<a name="l00507"></a>00507     <a class="code" href="classSchema__Temps__base.html#a7c9adce0013f49c748143ab53e37dd81" title="1 = allocation espace disque (par defaut), 0 sinon">file_allocation_</a>=0;
<a name="l00508"></a>00508   <span class="keywordflow">else</span>
<a name="l00509"></a>00509     {
<a name="l00510"></a>00510       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; mot &lt;&lt; <span class="stringliteral">&quot; is not a keyword understood by &quot;</span> &lt;&lt; <a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; <span class="stringliteral">&quot; in lire_motcle_non_standard&quot;</span>&lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00511"></a>00511       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00512"></a>00512     }
<a name="l00513"></a>00513   <span class="keywordflow">return</span> -1;
<a name="l00514"></a>00514 }
<a name="l00515"></a>00515 
<a name="l00516"></a>00516 <span class="comment">// Description</span>
<a name="l00517"></a>00517 <span class="comment">// Lecture du nombre de pas de temps maximal</span>
<a name="l00518"></a><a class="code" href="classSchema__Temps__base.html#ae022cd6860a5fed1a26e18d4b9d45a07">00518</a> <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classSchema__Temps__base.html#ae022cd6860a5fed1a26e18d4b9d45a07">Schema_Temps_base::lire_nb_pas_dt_max</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00519"></a>00519 {
<a name="l00520"></a>00520   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l00521"></a>00521     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Reading of the maximum number of time steps&quot;</span>  &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00522"></a>00522   is &gt;&gt; <a class="code" href="classSchema__Temps__base.html#a4cd1e401f61da498c719d2ff881d9552">nb_pas_dt_max_</a>;
<a name="l00523"></a>00523   <span class="keywordflow">return</span> is;
<a name="l00524"></a>00524 }
<a name="l00525"></a>00525 
<a name="l00526"></a><a class="code" href="classSchema__Temps__base.html#a10242dba9533cd4fac8dd3b729ccf889">00526</a> <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classSchema__Temps__base.html#a10242dba9533cd4fac8dd3b729ccf889">Schema_Temps_base::lire_periode_sauvegarde_securite_en_heures</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00527"></a>00527 {
<a name="l00528"></a>00528   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l00529"></a>00529     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Reading of the safety backup period in hours&quot;</span>  &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00530"></a>00530   is &gt;&gt; <a class="code" href="classSchema__Temps__base.html#a6076cd514189bf072ea57b420d052a14">periode_cpu_sans_sauvegarde_</a>;
<a name="l00531"></a>00531   periode_cpu_sans_sauvegarde_*=3600; <span class="comment">//!&lt; Conversion en secondes</span>
<a name="l00532"></a>00532 <span class="comment"></span>  <a class="code" href="classSchema__Temps__base.html#a686b5be98e2c5a666713f85652188b0e">limite_cpu_sans_sauvegarde_</a> = <a class="code" href="classSchema__Temps__base.html#a6076cd514189bf072ea57b420d052a14">periode_cpu_sans_sauvegarde_</a>;
<a name="l00533"></a>00533   <span class="keywordflow">return</span> is;
<a name="l00534"></a>00534 }
<a name="l00535"></a>00535 
<a name="l00536"></a>00536 
<a name="l00537"></a><a class="code" href="classSchema__Temps__base.html#ad7f6c264ce309872f0d3e88705c7cff9">00537</a> <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classSchema__Temps__base.html#ad7f6c264ce309872f0d3e88705c7cff9">Schema_Temps_base::lire_temps_cpu_max</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00538"></a>00538 {
<a name="l00539"></a>00539   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l00540"></a>00540     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Reading the max cpu time allowed&quot;</span>  &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00541"></a>00541   is &gt;&gt; <a class="code" href="classSchema__Temps__base.html#a9de23994659e75064d9951bbd46b5ed9">tcpumax_</a>;
<a name="l00542"></a>00542   tcpumax_*=3600; <span class="comment">//!&lt; Conversion en secondes</span>
<a name="l00543"></a>00543 <span class="comment"></span>  <span class="keywordflow">return</span> is;
<a name="l00544"></a>00544 }
<a name="l00545"></a>00545 
<a name="l00546"></a>00546 <span class="comment">// Precondition:</span>
<a name="l00547"></a>00547 <span class="comment">// Parametre:</span>
<a name="l00548"></a>00548 <span class="comment">// Signification:</span>
<a name="l00549"></a>00549 <span class="comment">// Valeurs par defaut:</span>
<a name="l00550"></a>00550 <span class="comment">// Contraintes:</span>
<a name="l00551"></a>00551 <span class="comment">// Acces:</span>
<a name="l00552"></a>00552 <span class="comment">// </span>
<a name="l00553"></a>00553 <span class="comment">// Signification:</span>
<a name="l00554"></a>00554 <span class="comment">// Contraintes:</span>
<a name="l00555"></a>00555 <span class="comment">// Exception:</span>
<a name="l00556"></a>00556 <span class="comment">// Effets de bord:</span>
<a name="l00557"></a>00557 <span class="comment">// Postcondition: l&#39;objet est initialise</span>
<a name="l00558"></a>00558 <span class="comment">//</span>
<a name="l00559"></a>00559 <span class="comment">//</span><span class="comment"></span>
<a name="l00560"></a>00560 <span class="comment">//! Constructeur par defaut d&#39;un schema en temps.&lt;br&gt;Initialise differents membres de la classe.</span>
<a name="l00561"></a><a class="code" href="classSchema__Temps__base.html#a40375e2c7428f507d49c382bca2203c0">00561</a> <span class="comment"></span><a class="code" href="classSchema__Temps__base.html#a40375e2c7428f507d49c382bca2203c0" title="Constructeur par defaut d&#39;un schema en temps. Initialise differents membres de la classe...">Schema_Temps_base::Schema_Temps_base</a>()
<a name="l00562"></a>00562 {
<a name="l00563"></a>00563   <a class="code" href="classSchema__Temps__base.html#a9cdfdb4baa01a6461f4cf7edc6c2b0a5">lu_</a>=0;
<a name="l00564"></a>00564   <a class="code" href="classSchema__Temps__base.html#a41d96b9bfd9ead46031343c31f9bfe5d" title="Pas de temps de calcul.">dt_</a> = 0;
<a name="l00565"></a>00565   <a class="code" href="classSchema__Temps__base.html#ab13482fd427c6008c91d0df5d3a7e07f">tinit_</a> = -<a class="code" href="Double_8h.html#ae0ee0cebfad5968da0ad6cc7a49e16b6">DMAXFLOAT</a>;
<a name="l00566"></a>00566   <a class="code" href="classSchema__Temps__base.html#abc40918e7ff94cc1897d12b2f3bb1340" title="Pas de temps min fixe par l&#39;utilisateur.">dt_min_</a> = 1.e-16;
<a name="l00567"></a>00567   <a class="code" href="classSchema__Temps__base.html#a06f9a146ff9c587a5bbc1ce90c05bf5e">dt_sauv_</a> = <a class="code" href="classSchema__Temps__base.html#ab72294e6106b3c0eb25cb7e3e1f6fd56" title="Pas de temps d&#39;impression.">dt_impr_</a> = <a class="code" href="classSchema__Temps__base.html#a51c0bc9f66a0a75d26b7685912945d0c">tmax_</a> = <a class="code" href="classSchema__Temps__base.html#a55d7d507689898465bf9ce320446ba99" title="Pas de temps max fixe par l&#39;utilisateur.">dt_max_</a> = <a class="code" href="classSchema__Temps__base.html#a9de23994659e75064d9951bbd46b5ed9">tcpumax_</a> = 1.e30;
<a name="l00568"></a>00568   <a class="code" href="classSchema__Temps__base.html#a6076cd514189bf072ea57b420d052a14">periode_cpu_sans_sauvegarde_</a> = 23 * 3600; <span class="comment">//!&lt; Par defaut 23 heures</span>
<a name="l00569"></a>00569 <span class="comment"></span>  <a class="code" href="classSchema__Temps__base.html#a686b5be98e2c5a666713f85652188b0e">limite_cpu_sans_sauvegarde_</a> = <a class="code" href="classSchema__Temps__base.html#a6076cd514189bf072ea57b420d052a14">periode_cpu_sans_sauvegarde_</a>;
<a name="l00570"></a>00570   <a class="code" href="classSchema__Temps__base.html#a9fd6b5066d448973b2267715ff04a59d">temps_cpu_ecoule_</a> = 0;
<a name="l00571"></a>00571   <a class="code" href="classSchema__Temps__base.html#a1596902b83c3de53d94cbd03f9a614c8" title="Nombre de chiffres significatifs impression.">precision_impr_</a> = 8;
<a name="l00572"></a>00572   <a class="code" href="classSchema__Temps__base.html#ad03548e5c596dac08ccfa866faa5ec0b" title="Stationary reached by the problem using this scheme.">stationnaire_atteint_</a>=0;
<a name="l00573"></a>00573   <a class="code" href="classSchema__Temps__base.html#ae2c7d1e0a0f8c8ae49a80f110baf55df" title="Stationary reached by the calculation (means all the problems reach stationary)">stationnaires_atteints_</a>=0;
<a name="l00574"></a>00574   <a class="code" href="classSchema__Temps__base.html#addda9320fe85fd273e84fa0d09f12eef" title="Residu.">residu_</a>=0;
<a name="l00575"></a>00575   <a class="code" href="classSchema__Temps__base.html#a58accd37da9e610cd9c67b249ed914d1" title="mode calcul du pas de temps de depart">mode_dt_start_</a>=-2; <span class="comment">//!&lt; Nouveau 1.5.6 : desormais le premier pas de temps est calcule et ne vaut donc plus dt_min (par defaut, donc est equivalent a dt_start dt_calc)</span>
<a name="l00576"></a>00576 <span class="comment"></span>  <a class="code" href="classSchema__Temps__base.html#abd3374c522a8fdb6e6c97eab14f95ed1">nb_pas_dt_</a> = 0;
<a name="l00577"></a>00577   <a class="code" href="classSchema__Temps__base.html#aaa7239c54975a77b97140e0f10fbaa24">nb_impr_</a> = 0;
<a name="l00578"></a>00578   <a class="code" href="classSchema__Temps__base.html#a4cd1e401f61da498c719d2ff881d9552">nb_pas_dt_max_</a> = (int)(pow(2.0,(<span class="keywordtype">double</span>)((<span class="keyword">sizeof</span>(<a class="code" href="arch_8h.html#a1caaf369d9c5f0817dbaa76b43b8d87b">True_int</a>)*8)-1))-1);
<a name="l00579"></a>00579   <a class="code" href="classSchema__Temps__base.html#ac3c38a091b9d8337e5e7352d14108ee6">seuil_statio_</a> = 1.e-12;
<a name="l00580"></a>00580   <a class="code" href="classSchema__Temps__base.html#a03e1b245412eb5948b423a767c56cc58" title="Drapeau pour specifier si seuil_statio_ est une valeur absolue (defaut) ou relative.">seuil_statio_relatif_deconseille_</a> = 0;
<a name="l00581"></a>00581   <a class="code" href="classSchema__Temps__base.html#a8cdc40f1adfd8ff29d7f9c75330920ee">facsec_</a> = 1.;
<a name="l00582"></a>00582   <a class="code" href="classSchema__Temps__base.html#a61433017ae6332e21ce08b3e23e15706">ind_tps_final_atteint</a>=0;
<a name="l00583"></a>00583   <a class="code" href="classSchema__Temps__base.html#ad8830deb0623b35be3938aa68eec98cb">ind_nb_pas_dt_max_atteint</a>=0;
<a name="l00584"></a>00584   <a class="code" href="classSchema__Temps__base.html#a7db3258e20b7cea673db9f33bd9ad5ce">ind_temps_cpu_max_atteint</a>=0;
<a name="l00585"></a>00585   <a class="code" href="classSchema__Temps__base.html#ae4de688b9f23027646164439fc484372">ind_diff_impl_</a>=0 ;
<a name="l00586"></a>00586   <a class="code" href="classSchema__Temps__base.html#ae529919fc4a729acc2d32c2b1a4aea2e">seuil_diff_impl_</a>=1.e-6 ;
<a name="l00587"></a>00587   <a class="code" href="classSchema__Temps__base.html#abc110a1311c48fd2d8bdb6724ce261a3">impr_diff_impl_</a>=0;
<a name="l00588"></a>00588   <a class="code" href="classSchema__Temps__base.html#a81850970a19d34f6271719508afeb3a9">no_conv_subiteration_diff_impl_</a>=0;
<a name="l00589"></a>00589   <a class="code" href="classSchema__Temps__base.html#a4ebe850f89c269e8fb2688b7108fbc32">no_error_if_not_converged_diff_impl_</a>=0;
<a name="l00590"></a>00590   <a class="code" href="classSchema__Temps__base.html#a7f6317e09495e7c1c99e01c491a0878d">niter_max_diff_impl_</a> = 1000; <span class="comment">//!&lt; Above 100 iterations, diffusion implicit algorithm is may be diverging</span>
<a name="l00591"></a>00591 <span class="comment"></span>  <a class="code" href="classSchema__Temps__base.html#a77769643434734114555dfe45ef8ce28" title="1 si le schema a le droit d&#39;imprimer dans le .out et dt_ev">schema_impr_</a>=1;
<a name="l00592"></a>00592   <a class="code" href="classSchema__Temps__base.html#a7c9adce0013f49c748143ab53e37dd81" title="1 = allocation espace disque (par defaut), 0 sinon">file_allocation_</a>=0; <span class="comment">//!&lt; Desactive car pose probleme sur platine sur les gros maillages</span>
<a name="l00593"></a>00593 <span class="comment"></span>  <a class="code" href="classSchema__Temps__base.html#a1e5d49638468e1bac6a94d50042fe193">residu_old_slope_</a>=-1000;
<a name="l00594"></a>00594   <a class="code" href="classSchema__Temps__base.html#a63a1a1a4da33cfb8cce18fb7ac6761f5">cumul_slope_</a>=1e-20;
<a name="l00595"></a>00595   <a class="code" href="classSchema__Temps__base.html#a22b9fb1d3ad5f1e1a25941810947ea53" title="Flag to disable the writing of the .progress file.">disable_progress_</a> = 0;
<a name="l00596"></a>00596   <a class="code" href="classSchema__Temps__base.html#acc3e550d4186a0e1407ee8142a9e53f7" title="Flag to disable the writing of the .dt_ev file.">disable_dt_ev_</a> = 0;
<a name="l00597"></a>00597   <a class="code" href="classSchema__Temps__base.html#ad4514188507072ae4cb3142a8c3864bd">gnuplot_header_</a> = 0;
<a name="l00598"></a>00598   <a class="code" href="classSchema__Temps__base.html#a945fcc0fbef49be036443abdc040ef70">dt_gf_</a> = <a class="code" href="Double_8h.html#ae0ee0cebfad5968da0ad6cc7a49e16b6">DMAXFLOAT</a>;
<a name="l00599"></a>00599 }
<a name="l00600"></a>00600 <span class="comment">// Precondition:</span>
<a name="l00601"></a>00601 <span class="comment">// Parametre: Sortie&amp; os</span>
<a name="l00602"></a>00602 <span class="comment">// Signification: le flot de sortie</span>
<a name="l00603"></a>00603 <span class="comment">// Valeurs par defaut:</span>
<a name="l00604"></a>00604 <span class="comment">// Contraintes:</span>
<a name="l00605"></a>00605 <span class="comment">// Acces: entree/osrtie</span>
<a name="l00606"></a>00606 <span class="comment">// Exception:</span>
<a name="l00607"></a>00607 <span class="comment">// Effets de bord:</span>
<a name="l00608"></a>00608 <span class="comment">// Postcondition: la methode ne modifie pas l&#39;objet</span>
<a name="l00609"></a>00609 <span class="comment">//</span>
<a name="l00610"></a>00610 <span class="comment">//</span><span class="comment"></span>
<a name="l00611"></a>00611 <span class="comment">//! Impression du numero du pas de temps, la valeur du pas de temps.&lt;br&gt;et du temps courant.</span>
<a name="l00612"></a>00612 <span class="comment"></span><span class="comment">/** \return int&lt;br&gt;</span>
<a name="l00613"></a>00613 <span class="comment">Signification: renvoie toujours 0&lt;br&gt;</span>
<a name="l00614"></a>00614 <span class="comment">Contraintes: */</span>
<a name="l00615"></a><a class="code" href="classSchema__Temps__base.html#a4471a81ff9204abb2126f7146b8ad6f0">00615</a> <span class="keywordtype">int</span> <a class="code" href="classSchema__Temps__base.html#a4471a81ff9204abb2126f7146b8ad6f0" title="Impression du numero du pas de temps, la valeur du pas de temps. et du temps courant.">Schema_Temps_base::impr</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os)<span class="keyword"> const</span>
<a name="l00616"></a>00616 <span class="keyword"></span>{
<a name="l00617"></a>00617   os &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00618"></a>00618   os &lt;&lt; <span class="stringliteral">&quot;-------------------------------------------------------------------&quot;</span> &lt;&lt; finl;
<a name="l00619"></a>00619   os &lt;&lt; <span class="stringliteral">&quot;We finished treating the time step number &quot;</span>&lt;&lt; <a class="code" href="classSchema__Temps__base.html#abd3374c522a8fdb6e6c97eab14f95ed1">nb_pas_dt_</a> &lt;&lt; <span class="stringliteral">&quot; , for the time scheme ...&quot;</span> &lt;&lt; finl
<a name="l00620"></a>00620      &lt;&lt; <span class="stringliteral">&quot;   stable dt used = &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a41d96b9bfd9ead46031343c31f9bfe5d" title="Pas de temps de calcul.">dt_</a> &lt;&lt; finl <span class="comment">/* dt_stab_ peut etre ? c&#39;est pareil je pense */</span>
<a name="l00621"></a>00621      &lt;&lt; <span class="stringliteral">&quot;   time achieved (in seconds) = &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#ae6dd72bce33a443217b83f56a4da23a2">temps_courant_</a> &lt;&lt; finl;
<a name="l00622"></a>00622   <span class="keywordflow">return</span> 0;
<a name="l00623"></a>00623 }
<a name="l00624"></a>00624 
<a name="l00625"></a>00625 <span class="comment">// Precondition:</span>
<a name="l00626"></a>00626 <span class="comment">// Parametre: Sortie&amp; os</span>
<a name="l00627"></a>00627 <span class="comment">// Signification: le flot de sortie</span>
<a name="l00628"></a>00628 <span class="comment">// Valeurs par defaut:</span>
<a name="l00629"></a>00629 <span class="comment">// Contraintes:</span>
<a name="l00630"></a>00630 <span class="comment">// Acces: entree/sortie</span>
<a name="l00631"></a>00631 <span class="comment">// Exception:</span>
<a name="l00632"></a>00632 <span class="comment">// Effets de bord:</span>
<a name="l00633"></a>00633 <span class="comment">// Postcondition: la methode ne modifie pas l&#39;objet</span>
<a name="l00634"></a>00634 <span class="comment">//</span>
<a name="l00635"></a>00635 <span class="comment">//</span><span class="comment"></span>
<a name="l00636"></a>00636 <span class="comment">//! Impression du numero du pas de temps, la valeur du pas de temps.&lt;br&gt;et du temps courant.</span>
<a name="l00637"></a>00637 <span class="comment"></span><span class="comment">/** \return int&lt;br&gt;</span>
<a name="l00638"></a>00638 <span class="comment">Signification: renvoie toujours 0&lt;br&gt;</span>
<a name="l00639"></a>00639 <span class="comment">Contraintes: */</span>
<a name="l00640"></a><a class="code" href="classSchema__Temps__base.html#a36ef1e6dafab275ea1dd34f30f2cea19">00640</a> <span class="keywordtype">int</span> <a class="code" href="classSchema__Temps__base.html#a4471a81ff9204abb2126f7146b8ad6f0" title="Impression du numero du pas de temps, la valeur du pas de temps. et du temps courant.">Schema_Temps_base::impr</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os,<a class="code" href="classProbleme__base.html" title="classe Probleme_base C&#39;est un Probleme_U qui n&#39;est pas un couplage. Le role d&#39;un Probleme_base est la...">Probleme_base</a>&amp; pb)<span class="keyword"> const</span>
<a name="l00641"></a>00641 <span class="keyword"></span>{
<a name="l00642"></a>00642   os &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00643"></a>00643   os &lt;&lt; <span class="stringliteral">&quot; Problem : &quot;</span> &lt;&lt; pb.<a class="code" href="classProbleme__base.html#a58bc0b101f3f3f1d8522a9f41f1fad7b" title="surcharge Objet_U::le_nom() Renvoie le nom du probleme">le_nom</a>() &lt;&lt; finl;
<a name="l00644"></a>00644   os &lt;&lt; <span class="stringliteral">&quot;We treat the time step number &quot;</span>&lt;&lt; <a class="code" href="classSchema__Temps__base.html#abd3374c522a8fdb6e6c97eab14f95ed1">nb_pas_dt_</a> &lt;&lt; finl;
<a name="l00645"></a>00645   os &lt;&lt; <span class="stringliteral">&quot;   dt = &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a41d96b9bfd9ead46031343c31f9bfe5d" title="Pas de temps de calcul.">dt_</a> &lt;&lt; finl;
<a name="l00646"></a>00646   os &lt;&lt; <span class="stringliteral">&quot;   time = &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#ae6dd72bce33a443217b83f56a4da23a2">temps_courant_</a> &lt;&lt; finl;
<a name="l00647"></a>00647   os &lt;&lt; <span class="stringliteral">&quot;   time scheme : &quot;</span> &lt;&lt; pb.<a class="code" href="classProbleme__base.html#a0cf6c541e30cd21c3da32fc122cb0e2b" title="Renvoie le schema en temps associe au probleme. (si il est non nul) (version const)">schema_temps</a>() &lt;&lt; finl;
<a name="l00648"></a>00648   <span class="keywordflow">return</span> 0;
<a name="l00649"></a>00649 }
<a name="l00650"></a><a class="code" href="classSchema__Temps__base.html#a08f3422f2e3ca04020d653bd8dfe2d20">00650</a> <span class="keywordtype">int</span> <a class="code" href="classSchema__Temps__base.html#a4471a81ff9204abb2126f7146b8ad6f0" title="Impression du numero du pas de temps, la valeur du pas de temps. et du temps courant.">Schema_Temps_base::impr</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os,<span class="keyword">const</span> <a class="code" href="classProbleme__base.html" title="classe Probleme_base C&#39;est un Probleme_U qui n&#39;est pas un couplage. Le role d&#39;un Probleme_base est la...">Probleme_base</a>&amp; pb)<span class="keyword"> const</span>
<a name="l00651"></a>00651 <span class="keyword"></span>{
<a name="l00652"></a>00652   os &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00653"></a>00653   os &lt;&lt; <span class="stringliteral">&quot; Problem : &quot;</span> &lt;&lt; pb.<a class="code" href="classProbleme__base.html#a58bc0b101f3f3f1d8522a9f41f1fad7b" title="surcharge Objet_U::le_nom() Renvoie le nom du probleme">le_nom</a>() &lt;&lt; finl;
<a name="l00654"></a>00654   os &lt;&lt; <span class="stringliteral">&quot;We treat the time step number &quot;</span>&lt;&lt; <a class="code" href="classSchema__Temps__base.html#abd3374c522a8fdb6e6c97eab14f95ed1">nb_pas_dt_</a> &lt;&lt; finl;
<a name="l00655"></a>00655   os &lt;&lt; <span class="stringliteral">&quot;   dt = &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a41d96b9bfd9ead46031343c31f9bfe5d" title="Pas de temps de calcul.">dt_</a> &lt;&lt; finl;
<a name="l00656"></a>00656   os &lt;&lt; <span class="stringliteral">&quot;   time = &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#ae6dd72bce33a443217b83f56a4da23a2">temps_courant_</a> &lt;&lt; finl;
<a name="l00657"></a>00657   os &lt;&lt; <span class="stringliteral">&quot;   time scheme : &quot;</span> &lt;&lt; pb.<a class="code" href="classProbleme__base.html#a0cf6c541e30cd21c3da32fc122cb0e2b" title="Renvoie le schema en temps associe au probleme. (si il est non nul) (version const)">schema_temps</a>() &lt;&lt; finl;
<a name="l00658"></a>00658   <span class="keywordflow">return</span> 0;
<a name="l00659"></a>00659 }
<a name="l00660"></a>00660 
<a name="l00661"></a>00661 <span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {
<a name="l00662"></a>00662   <span class="keywordtype">int</span> <a class="code" href="Schema__Temps__base_8cpp.html#a4787a9eed4320d483411ac8cd832a401">ccc_tremain</a>(<span class="keywordtype">double</span>*);
<a name="l00663"></a>00663 }
<a name="l00664"></a>00664 <span class="comment">// Precondition:</span>
<a name="l00665"></a>00665 <span class="comment">// Parametre:</span>
<a name="l00666"></a>00666 <span class="comment">// Signification:</span>
<a name="l00667"></a>00667 <span class="comment">// Valeurs par defaut:</span>
<a name="l00668"></a>00668 <span class="comment">// Contraintes:</span>
<a name="l00669"></a>00669 <span class="comment">// Acces:</span>
<a name="l00670"></a>00670 <span class="comment">// Exception:</span>
<a name="l00671"></a>00671 <span class="comment">// Effets de bord:</span>
<a name="l00672"></a>00672 <span class="comment">// Postcondition:</span>
<a name="l00673"></a>00673 <span class="comment">//</span>
<a name="l00674"></a>00674 <span class="comment">//</span><span class="comment"></span>
<a name="l00675"></a>00675 <span class="comment">//! Mise a jour du temps courant (t+=dt)&lt;br&gt;et du nombre de pas de temps effectue (nb_pas_dt_++).</span>
<a name="l00676"></a>00676 <span class="comment"></span><span class="comment">/** \return int&lt;br&gt;</span>
<a name="l00677"></a>00677 <span class="comment">Signification: retourne toujours 1&lt;br&gt;</span>
<a name="l00678"></a>00678 <span class="comment">Contraintes: */</span>
<a name="l00679"></a><a class="code" href="classSchema__Temps__base.html#acc7bc155d31abe8b073e931f43bbc399">00679</a> <span class="keywordtype">int</span> <a class="code" href="classSchema__Temps__base.html#acc7bc155d31abe8b073e931f43bbc399" title="Mise a jour du temps courant (t+=dt) et du nombre de pas de temps effectue (nb_pas_dt_++).">Schema_Temps_base::mettre_a_jour</a>()
<a name="l00680"></a>00680 {
<a name="l00681"></a>00681 
<a name="l00682"></a>00682   <a class="code" href="classSchema__Temps__base.html#ab58cb017d1983269f669ef2facdd2bca">temps_precedent_</a> = <a class="code" href="classSchema__Temps__base.html#ae6dd72bce33a443217b83f56a4da23a2">temps_courant_</a>;
<a name="l00683"></a>00683   <a class="code" href="classSchema__Temps__base.html#ae6dd72bce33a443217b83f56a4da23a2">temps_courant_</a> += <a class="code" href="classSchema__Temps__base.html#a41d96b9bfd9ead46031343c31f9bfe5d" title="Pas de temps de calcul.">dt_</a>;
<a name="l00684"></a>00684   <a class="code" href="classSchema__Temps__base.html#abd3374c522a8fdb6e6c97eab14f95ed1">nb_pas_dt_</a>++;
<a name="l00685"></a>00685 <span class="comment">// Compute next time step stability:</span>
<a name="l00686"></a>00686   <a class="code" href="classSchema__Temps__base.html#ad95c1e999ba471e5a95760e37aebb05f">mettre_a_jour_dt_stab</a>();
<a name="l00687"></a>00687   <a class="code" href="communications_8cpp.html#a9e67e5ed9733705075e50eb6ea135279" title="en mode comm_check_enabled(), verifie que le parametre a la meme valeur sur tous les processeurs...">assert_parallel</a>(<a class="code" href="classSchema__Temps__base.html#acf696ebda2c1019cde88306d1f0e412a" title="Pas de temps de stabilite.">dt_stab_</a>);
<a name="l00688"></a>00688   <a class="code" href="communications_8cpp.html#a9e67e5ed9733705075e50eb6ea135279" title="en mode comm_check_enabled(), verifie que le parametre a la meme valeur sur tous les processeurs...">assert_parallel</a>(<a class="code" href="classSchema__Temps__base.html#ae6dd72bce33a443217b83f56a4da23a2">temps_courant_</a>);
<a name="l00689"></a>00689   <span class="keywordflow">if</span> (!<a class="code" href="classSchema__Temps__base.html#a61433017ae6332e21ce08b3e23e15706">ind_tps_final_atteint</a>)
<a name="l00690"></a>00690     <a class="code" href="classSchema__Temps__base.html#a61433017ae6332e21ce08b3e23e15706">ind_tps_final_atteint</a> = (<a class="code" href="classSchema__Temps__base.html#ae6dd72bce33a443217b83f56a4da23a2">temps_courant_</a> &gt;= <a class="code" href="classSchema__Temps__base.html#a51c0bc9f66a0a75d26b7685912945d0c">tmax_</a>);
<a name="l00691"></a>00691 
<a name="l00692"></a>00692   <span class="keywordflow">if</span> (!<a class="code" href="classSchema__Temps__base.html#ad8830deb0623b35be3938aa68eec98cb">ind_nb_pas_dt_max_atteint</a>)
<a name="l00693"></a>00693     <a class="code" href="classSchema__Temps__base.html#ad8830deb0623b35be3938aa68eec98cb">ind_nb_pas_dt_max_atteint</a> = (<a class="code" href="classSchema__Temps__base.html#abd3374c522a8fdb6e6c97eab14f95ed1">nb_pas_dt_</a> &gt;= <a class="code" href="classSchema__Temps__base.html#a4cd1e401f61da498c719d2ff881d9552">nb_pas_dt_max_</a>);
<a name="l00694"></a>00694 
<a name="l00695"></a>00695   <span class="keywordflow">if</span> (!<a class="code" href="classSchema__Temps__base.html#a7db3258e20b7cea673db9f33bd9ad5ce">ind_temps_cpu_max_atteint</a>)
<a name="l00696"></a>00696     <a class="code" href="classSchema__Temps__base.html#a7db3258e20b7cea673db9f33bd9ad5ce">ind_temps_cpu_max_atteint</a> = (<a class="code" href="classSchema__Temps__base.html#a9fd6b5066d448973b2267715ff04a59d">temps_cpu_ecoule_</a> &gt;= <a class="code" href="classSchema__Temps__base.html#a9de23994659e75064d9951bbd46b5ed9">tcpumax_</a>);
<a name="l00697"></a>00697 
<a name="l00698"></a>00698 <span class="comment">// On incremente limite_cpu_sans_sauvegarde_</span>
<a name="l00699"></a>00699   <span class="keywordflow">if</span> ( <a class="code" href="classSchema__Temps__base.html#a9fd6b5066d448973b2267715ff04a59d">temps_cpu_ecoule_</a> &gt; <a class="code" href="classSchema__Temps__base.html#a686b5be98e2c5a666713f85652188b0e">limite_cpu_sans_sauvegarde_</a> )
<a name="l00700"></a>00700     {
<a name="l00701"></a>00701       <a class="code" href="classSchema__Temps__base.html#a686b5be98e2c5a666713f85652188b0e">limite_cpu_sans_sauvegarde_</a> += <a class="code" href="classSchema__Temps__base.html#a6076cd514189bf072ea57b420d052a14">periode_cpu_sans_sauvegarde_</a>;
<a name="l00702"></a>00702 <span class="comment">// Finalement, on double la limite, ainsi par defaut sauvegarde de securite 10h, 20h, 40h, 80h, 160h,....</span>
<a name="l00703"></a>00703 <span class="comment">// limite_cpu_sans_sauvegarde_ = 2 * limite_cpu_sans_sauvegarde_;</span>
<a name="l00704"></a>00704       <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#a06f9a146ff9c587a5bbc1ce90c05bf5e">dt_sauv_</a> &lt;= 0.)
<a name="l00705"></a>00705         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;NO next backup, by security, because dt_sauv = &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a06f9a146ff9c587a5bbc1ce90c05bf5e">dt_sauv_</a> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00706"></a>00706       <span class="keywordflow">else</span>
<a name="l00707"></a>00707         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;The next backup, by security, will take place after &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a686b5be98e2c5a666713f85652188b0e">limite_cpu_sans_sauvegarde_</a>/3600 &lt;&lt; <span class="stringliteral">&quot; hours of calculation.&quot;</span> &lt;&lt; finl;
<a name="l00708"></a>00708     }
<a name="l00709"></a>00709 <span class="comment">// GF pour etre sur que tous les proc aient le meme temps ecoule</span>
<a name="l00710"></a>00710   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">je_suis_maitre</a>())
<a name="l00711"></a>00711     {
<a name="l00712"></a>00712       <a class="code" href="classSchema__Temps__base.html#a9fd6b5066d448973b2267715ff04a59d">temps_cpu_ecoule_</a> = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a21c24113a2042f33ce1134b473ebc1ac">last_time</a>(<a class="code" href="stat__counters_8cpp.html#a2cd262d038049f900ea193c706c476c3">temps_total_execution_counter_</a>);
<a name="l00713"></a>00713     }
<a name="l00714"></a>00714 
<a name="l00715"></a>00715   <a class="code" href="communications_8cpp.html#a2335b36078ae87e23dab400a6e129a3c">envoyer_broadcast</a>(<a class="code" href="classSchema__Temps__base.html#a9fd6b5066d448973b2267715ff04a59d">temps_cpu_ecoule_</a>,0);
<a name="l00716"></a>00716 
<a name="l00717"></a>00717 
<a name="l00718"></a>00718 <span class="preprocessor">#ifdef LIBCCC_USER</span>
<a name="l00719"></a>00719 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">je_suis_maitre</a>() &amp;&amp; <a class="code" href="classSchema__Temps__base.html#a7a2bf65aa65d7b2ddb7ccc0bc5fd0668" title="Renvoie 1 s&#39;il y a lieu d&#39;effectuer une impression (cf dt_impr) Renvoie 0 sinon.">limpr</a>())
<a name="l00720"></a>00720     {
<a name="l00721"></a>00721       <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;[CCRT] &quot;</span>;
<a name="l00722"></a>00722       <span class="keywordtype">double</span> second_remain;
<a name="l00723"></a>00723       <span class="keywordtype">int</span> error = <a class="code" href="Schema__Temps__base_8cpp.html#a4787a9eed4320d483411ac8cd832a401">ccc_tremain</a>(&amp;second_remain);
<a name="l00724"></a>00724       <span class="keywordflow">if</span>(!error)
<a name="l00725"></a>00725         {
<a name="l00726"></a>00726           <span class="keywordtype">int</span> hour_remain = (int)(second_remain/3600);
<a name="l00727"></a>00727           second_remain-=hour_remain*3600;
<a name="l00728"></a>00728           <span class="keywordtype">int</span> minute_remain = (int)(second_remain/60);
<a name="l00729"></a>00729           second_remain-=minute_remain*60;
<a name="l00730"></a>00730           <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; hour_remain &lt;&lt;<span class="stringliteral">&quot;h&quot;</span>&lt;&lt;minute_remain&lt;&lt;<span class="stringliteral">&quot;mn&quot;</span>&lt;&lt;second_remain&lt;&lt;<span class="stringliteral">&quot;s before job is killed on CCRT.&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00731"></a>00731         }
<a name="l00732"></a>00732       <span class="keywordflow">else</span>
<a name="l00733"></a>00733         <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;Error.&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00734"></a>00734     }
<a name="l00735"></a>00735 <span class="preprocessor">#endif</span>
<a name="l00736"></a>00736 <span class="preprocessor"></span>  <span class="keywordflow">return</span> 1;
<a name="l00737"></a>00737 }
<a name="l00738"></a>00738 <span class="comment">// Fait une sauvegarde de protection sur des runs de 24h sur machines du CCRT</span>
<a name="l00739"></a><a class="code" href="classSchema__Temps__base.html#a2992c454d4724b9fe6e9301e3e05c4d0">00739</a> <span class="keywordtype">int</span> <a class="code" href="classSchema__Temps__base.html#a2992c454d4724b9fe6e9301e3e05c4d0">Schema_Temps_base::lsauv</a>()<span class="keyword"> const</span>
<a name="l00740"></a>00740 <span class="keyword"></span>{
<a name="l00741"></a>00741   <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#a06f9a146ff9c587a5bbc1ce90c05bf5e">dt_sauv_</a> &lt;= 0.)
<a name="l00742"></a>00742     <span class="keywordflow">return</span> 0;
<a name="l00743"></a>00743   <span class="keywordflow">else</span>
<a name="l00744"></a>00744     {
<a name="l00745"></a>00745       <span class="keywordflow">if</span> ( <a class="code" href="classSchema__Temps__base.html#a9fd6b5066d448973b2267715ff04a59d">temps_cpu_ecoule_</a> &gt; <a class="code" href="classSchema__Temps__base.html#a686b5be98e2c5a666713f85652188b0e">limite_cpu_sans_sauvegarde_</a> )
<a name="l00746"></a>00746         {
<a name="l00747"></a>00747           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;After these &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a686b5be98e2c5a666713f85652188b0e">limite_cpu_sans_sauvegarde_</a>/3600 &lt;&lt; <span class="stringliteral">&quot; hours of calculation, a backup will be made by security.&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00748"></a>00748           <span class="keywordflow">return</span> 1;
<a name="l00749"></a>00749         }
<a name="l00750"></a>00750       <span class="keywordflow">else</span>
<a name="l00751"></a>00751         {
<a name="l00752"></a>00752           <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#a06f9a146ff9c587a5bbc1ce90c05bf5e">dt_sauv_</a>&lt;=<a class="code" href="classSchema__Temps__base.html#a41d96b9bfd9ead46031343c31f9bfe5d" title="Pas de temps de calcul.">dt_</a>)
<a name="l00753"></a>00753             <span class="keywordflow">return</span> 1;
<a name="l00754"></a>00754           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#a51c0bc9f66a0a75d26b7685912945d0c">tmax_</a>&lt;=<a class="code" href="classSchema__Temps__base.html#ae6dd72bce33a443217b83f56a4da23a2">temps_courant_</a> || <a class="code" href="classSchema__Temps__base.html#a4cd1e401f61da498c719d2ff881d9552">nb_pas_dt_max_</a>&lt;=<a class="code" href="classSchema__Temps__base.html#abd3374c522a8fdb6e6c97eab14f95ed1">nb_pas_dt_</a> || <a class="code" href="classSchema__Temps__base.html#ae2c7d1e0a0f8c8ae49a80f110baf55df" title="Stationary reached by the calculation (means all the problems reach stationary)">stationnaires_atteints_</a> || <a class="code" href="classSchema__Temps__base.html#a7db3258e20b7cea673db9f33bd9ad5ce">ind_temps_cpu_max_atteint</a> || <a class="code" href="classSchema__Temps__base.html#a753a697da5c097060eab9d3bff2d40d8" title="Renvoie 1 si le fichier (d&#39;extension) .stop contient un 1 Renvoie 0 sinon.">stop_lu</a>())
<a name="l00755"></a>00755             <span class="keywordflow">return</span> 1;
<a name="l00756"></a>00756           <span class="keywordflow">else</span>
<a name="l00757"></a>00757             {
<a name="l00758"></a>00758 <span class="comment">// Voir Schema_Temps_base::limpr pour information sur epsilon et modf</span>
<a name="l00759"></a>00759               <span class="keywordtype">double</span> i, j, epsilon = 1.e-8;
<a name="l00760"></a>00760               modf(<a class="code" href="classSchema__Temps__base.html#ae6dd72bce33a443217b83f56a4da23a2">temps_courant_</a>/<a class="code" href="classSchema__Temps__base.html#a06f9a146ff9c587a5bbc1ce90c05bf5e">dt_sauv_</a> + epsilon, &amp;i);
<a name="l00761"></a>00761               modf(<a class="code" href="classSchema__Temps__base.html#ab58cb017d1983269f669ef2facdd2bca">temps_precedent_</a>/<a class="code" href="classSchema__Temps__base.html#a06f9a146ff9c587a5bbc1ce90c05bf5e">dt_sauv_</a> + epsilon, &amp;j);
<a name="l00762"></a>00762               <span class="keywordflow">return</span> ( i&gt;j ) ;
<a name="l00763"></a>00763             }
<a name="l00764"></a>00764         }
<a name="l00765"></a>00765     }
<a name="l00766"></a>00766   <span class="keywordflow">return</span> 0;
<a name="l00767"></a>00767 }
<a name="l00768"></a>00768 
<a name="l00769"></a><a class="code" href="classSchema__Temps__base.html#ad95c1e999ba471e5a95760e37aebb05f">00769</a> <span class="keywordtype">void</span> <a class="code" href="classSchema__Temps__base.html#ad95c1e999ba471e5a95760e37aebb05f">Schema_Temps_base::mettre_a_jour_dt_stab</a>()
<a name="l00770"></a>00770 {
<a name="l00771"></a>00771   <a class="code" href="classSchema__Temps__base.html#ae73d6adc67b91d88e6bda286117d6fdb" title="Imprime le pas de temps sur un flot de sortie s&#39;il y a lieu.">imprimer</a>(<a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a>);
<a name="l00772"></a>00772   <a class="code" href="classSchema__Temps__base.html#acf696ebda2c1019cde88306d1f0e412a" title="Pas de temps de stabilite.">dt_stab_</a>=<a class="code" href="classSchema__Temps__base.html#a6e2edfe46a7f27b6fc8f114d92c35dc2">pb_base</a>().<a class="code" href="classProbleme__base.html#a74469695e1681fcba4ef15614de8c463" title="Calcul la valeur du prochain pas de temps du probleme. On calcule le minimum des pas de temps des equ...">calculer_pas_de_temps</a>();
<a name="l00773"></a>00773 }
<a name="l00774"></a>00774 <span class="comment">// Precondition:</span>
<a name="l00775"></a>00775 <span class="comment">// Parametre: Sortie&amp; os</span>
<a name="l00776"></a>00776 <span class="comment">// Signification: le flot de sortie</span>
<a name="l00777"></a>00777 <span class="comment">// Valeurs par defaut:</span>
<a name="l00778"></a>00778 <span class="comment">// Contraintes:</span>
<a name="l00779"></a>00779 <span class="comment">// Acces: entree/sortie</span>
<a name="l00780"></a>00780 <span class="comment">// </span>
<a name="l00781"></a>00781 <span class="comment">// Signification:</span>
<a name="l00782"></a>00782 <span class="comment">// Contraintes:</span>
<a name="l00783"></a>00783 <span class="comment">// Exception:</span>
<a name="l00784"></a>00784 <span class="comment">// Effets de bord:</span>
<a name="l00785"></a>00785 <span class="comment">// Postcondition: la methode ne modifie pas l&#39;objet</span>
<a name="l00786"></a>00786 <span class="comment">//</span><span class="comment"></span>
<a name="l00787"></a>00787 <span class="comment">//! Imprime le pas de temps sur un flot de sortie s&#39;il y a lieu.</span>
<a name="l00788"></a><a class="code" href="classSchema__Temps__base.html#ae73d6adc67b91d88e6bda286117d6fdb">00788</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classSchema__Temps__base.html#ae73d6adc67b91d88e6bda286117d6fdb" title="Imprime le pas de temps sur un flot de sortie s&#39;il y a lieu.">Schema_Temps_base::imprimer</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os)<span class="keyword"> const</span>
<a name="l00789"></a>00789 <span class="keyword"></span>{
<a name="l00790"></a>00790   <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#a7a2bf65aa65d7b2ddb7ccc0bc5fd0668" title="Renvoie 1 s&#39;il y a lieu d&#39;effectuer une impression (cf dt_impr) Renvoie 0 sinon.">limpr</a>())
<a name="l00791"></a>00791     {
<a name="l00792"></a>00792       <a class="code" href="classSchema__Temps__base.html#aaa7239c54975a77b97140e0f10fbaa24">nb_impr_</a>++;
<a name="l00793"></a>00793       <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">je_suis_maitre</a>() &amp;&amp; <a class="code" href="classSchema__Temps__base.html#a4fdd281fc1915333d2e44dce212439d7">schema_impr</a>())
<a name="l00794"></a>00794         {
<a name="l00795"></a>00795           <a class="code" href="classSchema__Temps__base.html#a4471a81ff9204abb2126f7146b8ad6f0" title="Impression du numero du pas de temps, la valeur du pas de temps. et du temps courant.">impr</a>(os);
<a name="l00796"></a>00796         }
<a name="l00797"></a>00797     }
<a name="l00798"></a>00798 }
<a name="l00799"></a>00799 
<a name="l00800"></a>00800 <span class="comment">// Precondition:</span>
<a name="l00801"></a>00801 <span class="comment">// Parametre: Sortie&amp; os</span>
<a name="l00802"></a>00802 <span class="comment">// Signification: le flot de sortie</span>
<a name="l00803"></a>00803 <span class="comment">// Valeurs par defaut:</span>
<a name="l00804"></a>00804 <span class="comment">// Contraintes:</span>
<a name="l00805"></a>00805 <span class="comment">// Acces: entree/sortie</span>
<a name="l00806"></a>00806 <span class="comment">// </span>
<a name="l00807"></a>00807 <span class="comment">// Signification:</span>
<a name="l00808"></a>00808 <span class="comment">// Contraintes:</span>
<a name="l00809"></a>00809 <span class="comment">// Exception:</span>
<a name="l00810"></a>00810 <span class="comment">// Effets de bord:</span>
<a name="l00811"></a>00811 <span class="comment">// Postcondition: la methode ne modifie pas l&#39;objet</span>
<a name="l00812"></a>00812 <span class="comment">//</span><span class="comment"></span>
<a name="l00813"></a>00813 <span class="comment">//! Imprime le pas de temps sur un flot de sortie s&#39;il y a lieu.</span>
<a name="l00814"></a><a class="code" href="classSchema__Temps__base.html#a0435379ca889ca63b628481011d8a569">00814</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classSchema__Temps__base.html#ae73d6adc67b91d88e6bda286117d6fdb" title="Imprime le pas de temps sur un flot de sortie s&#39;il y a lieu.">Schema_Temps_base::imprimer</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os, <a class="code" href="classProbleme__base.html" title="classe Probleme_base C&#39;est un Probleme_U qui n&#39;est pas un couplage. Le role d&#39;un Probleme_base est la...">Probleme_base</a>&amp; pb)<span class="keyword"> const</span>
<a name="l00815"></a>00815 <span class="keyword"></span>{
<a name="l00816"></a>00816   <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#a7a2bf65aa65d7b2ddb7ccc0bc5fd0668" title="Renvoie 1 s&#39;il y a lieu d&#39;effectuer une impression (cf dt_impr) Renvoie 0 sinon.">limpr</a>() &amp;&amp; <a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">je_suis_maitre</a>())
<a name="l00817"></a>00817     <a class="code" href="classSchema__Temps__base.html#a4471a81ff9204abb2126f7146b8ad6f0" title="Impression du numero du pas de temps, la valeur du pas de temps. et du temps courant.">impr</a>(os,pb);
<a name="l00818"></a>00818 }
<a name="l00819"></a><a class="code" href="classSchema__Temps__base.html#ab930685410a4974e531918245035f969">00819</a> <span class="keywordtype">void</span> <a class="code" href="classSchema__Temps__base.html#ae73d6adc67b91d88e6bda286117d6fdb" title="Imprime le pas de temps sur un flot de sortie s&#39;il y a lieu.">Schema_Temps_base::imprimer</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os, <span class="keyword">const</span> <a class="code" href="classProbleme__base.html" title="classe Probleme_base C&#39;est un Probleme_U qui n&#39;est pas un couplage. Le role d&#39;un Probleme_base est la...">Probleme_base</a>&amp; pb)<span class="keyword"> const</span>
<a name="l00820"></a>00820 <span class="keyword"></span>{
<a name="l00821"></a>00821   <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#a7a2bf65aa65d7b2ddb7ccc0bc5fd0668" title="Renvoie 1 s&#39;il y a lieu d&#39;effectuer une impression (cf dt_impr) Renvoie 0 sinon.">limpr</a>() &amp;&amp; <a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">je_suis_maitre</a>())
<a name="l00822"></a>00822     <a class="code" href="classSchema__Temps__base.html#a4471a81ff9204abb2126f7146b8ad6f0" title="Impression du numero du pas de temps, la valeur du pas de temps. et du temps courant.">impr</a>(os,pb);
<a name="l00823"></a>00823 }
<a name="l00824"></a>00824 
<a name="l00825"></a>00825 <span class="comment">// Precondition:</span>
<a name="l00826"></a>00826 <span class="comment">// Parametre: Sortie&amp; os</span>
<a name="l00827"></a>00827 <span class="comment">// Signification: le flot de sortie pour la sauvegarde</span>
<a name="l00828"></a>00828 <span class="comment">// Valeurs par defaut:</span>
<a name="l00829"></a>00829 <span class="comment">// Contraintes:</span>
<a name="l00830"></a>00830 <span class="comment">// Acces: entree/sortie</span>
<a name="l00831"></a>00831 <span class="comment">// </span>
<a name="l00832"></a>00832 <span class="comment">// Signification:</span>
<a name="l00833"></a>00833 <span class="comment">// Contraintes:</span>
<a name="l00834"></a>00834 <span class="comment">// Exception:</span>
<a name="l00835"></a>00835 <span class="comment">// Effets de bord:</span>
<a name="l00836"></a>00836 <span class="comment">// Postcondition: la methode ne modifie pas l&#39;objet</span>
<a name="l00837"></a>00837 <span class="comment">//</span>
<a name="l00838"></a>00838 <span class="comment">//</span><span class="comment"></span>
<a name="l00839"></a>00839 <span class="comment">//! Sauvegarde le temps courant et le nombre de pas de temps&lt;br&gt;sur un flot de sortie.</span>
<a name="l00840"></a><a class="code" href="classSchema__Temps__base.html#a40fdf5dd371dd6e1b0e970312c05ed38">00840</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="classSchema__Temps__base.html#a40fdf5dd371dd6e1b0e970312c05ed38" title="Sauvegarde le temps courant et le nombre de pas de temps sur un flot de sortie.">Schema_Temps_base::sauvegarder</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os)<span class="keyword"> const</span>
<a name="l00841"></a>00841 <span class="keyword"></span>{
<a name="l00842"></a>00842   <span class="keywordflow">return</span> 1;
<a name="l00843"></a>00843 }
<a name="l00844"></a>00844 
<a name="l00845"></a>00845 <span class="comment">// Precondition:</span>
<a name="l00846"></a>00846 <span class="comment">// Parametre: Entree&amp; is</span>
<a name="l00847"></a>00847 <span class="comment">// Signification: le flot d&#39;entree</span>
<a name="l00848"></a>00848 <span class="comment">// Valeurs par defaut:</span>
<a name="l00849"></a>00849 <span class="comment">// Contraintes:</span>
<a name="l00850"></a>00850 <span class="comment">// Acces: entree/sortie</span>
<a name="l00851"></a>00851 <span class="comment">// Exception:</span>
<a name="l00852"></a>00852 <span class="comment">// Effets de bord:</span>
<a name="l00853"></a>00853 <span class="comment">// Postcondition:</span>
<a name="l00854"></a>00854 <span class="comment">//</span>
<a name="l00855"></a>00855 <span class="comment">//</span><span class="comment"></span>
<a name="l00856"></a>00856 <span class="comment">//! Reprise (lecture) du temps courant et du nombre de pas de&lt;br&gt;temps effectues a partir d&#39;un flot d&#39;entree.</span>
<a name="l00857"></a>00857 <span class="comment"></span><span class="comment">/** \return int&lt;br&gt;</span>
<a name="l00858"></a>00858 <span class="comment">Signification: renvoie toujours 1&lt;br&gt;</span>
<a name="l00859"></a>00859 <span class="comment">Contraintes: */</span>
<a name="l00860"></a><a class="code" href="classSchema__Temps__base.html#a2e0f6debdf1ce5ad1a0bfa045e931e88">00860</a> <span class="keywordtype">int</span> <a class="code" href="classSchema__Temps__base.html#a2e0f6debdf1ce5ad1a0bfa045e931e88" title="Reprise (lecture) du temps courant et du nombre de pas de temps effectues a partir d&#39;un flot d&#39;entree...">Schema_Temps_base::reprendre</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00861"></a>00861 {
<a name="l00862"></a>00862   <span class="keywordflow">return</span> 1;
<a name="l00863"></a>00863 }
<a name="l00864"></a>00864 
<a name="l00865"></a>00865 <span class="comment">// Precondition:</span>
<a name="l00866"></a>00866 <span class="comment">// Parametre:</span>
<a name="l00867"></a>00867 <span class="comment">// Signification:</span>
<a name="l00868"></a>00868 <span class="comment">// Valeurs par defaut:</span>
<a name="l00869"></a>00869 <span class="comment">// Contraintes:</span>
<a name="l00870"></a>00870 <span class="comment">// Acces:</span>
<a name="l00871"></a>00871 <span class="comment">// Exception:</span>
<a name="l00872"></a>00872 <span class="comment">// Effets de bord:</span>
<a name="l00873"></a>00873 <span class="comment">// Postcondition: la methode ne modifie pas l&#39;objet</span>
<a name="l00874"></a>00874 <span class="comment">//</span>
<a name="l00875"></a>00875 <span class="comment">//</span><span class="comment"></span>
<a name="l00876"></a>00876 <span class="comment">//! Renvoie 1 si le fichier (d&#39;extension) .stop contient un 1&lt;br&gt;Renvoie 0 sinon</span>
<a name="l00877"></a>00877 <span class="comment"></span><span class="comment">/** \return int&lt;br&gt;</span>
<a name="l00878"></a>00878 <span class="comment">Signification: 1 si le fichier (d&#39;extension) .stop contient 1, 0 sinon&lt;br&gt;</span>
<a name="l00879"></a>00879 <span class="comment">Contraintes: */</span>
<a name="l00880"></a><a class="code" href="classSchema__Temps__base.html#a753a697da5c097060eab9d3bff2d40d8">00880</a> <span class="keywordtype">int</span> <a class="code" href="classSchema__Temps__base.html#a753a697da5c097060eab9d3bff2d40d8" title="Renvoie 1 si le fichier (d&#39;extension) .stop contient un 1 Renvoie 0 sinon.">Schema_Temps_base::stop_lu</a>()<span class="keyword"> const</span>
<a name="l00881"></a>00881 <span class="keyword"></span>{
<a name="l00882"></a>00882   <span class="keywordtype">int</span> stop_lu_l = 0;
<a name="l00883"></a>00883   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> nomfic(<a class="code" href="classObjet__U.html#a7c27c4f80259eeef76ff8fe2d3bc61f7" title="Renvoie une reference constante vers le nom du cas. Cette methode est statique.">nom_du_cas</a>());
<a name="l00884"></a>00884   nomfic+=<span class="stringliteral">&quot;.stop&quot;</span>;
<a name="l00885"></a>00885   <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#abd3374c522a8fdb6e6c97eab14f95ed1">nb_pas_dt_</a> &lt; 1)
<a name="l00886"></a>00886     {
<a name="l00887"></a>00887       <span class="keywordflow">if</span>(<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">je_suis_maitre</a>())
<a name="l00888"></a>00888         {
<a name="l00889"></a>00889           <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a> ficstop(nomfic);
<a name="l00890"></a>00890           ficstop &lt;&lt; stop_lu_l;
<a name="l00891"></a>00891         }
<a name="l00892"></a>00892     }
<a name="l00893"></a>00893   <span class="keywordflow">else</span>
<a name="l00894"></a>00894     {
<a name="l00895"></a>00895       <a class="code" href="classLecFicDiffuse.html" title="Cette classe implemente les operateurs et les methodes virtuelles de la classe EFichier de la facon s...">LecFicDiffuse</a> ficstop(nomfic);
<a name="l00896"></a>00896 <span class="comment">// On verifie s&#39;il reste de la place</span>
<a name="l00897"></a>00897 <span class="comment">// sur le disque en fonction de la</span>
<a name="l00898"></a>00898 <span class="comment">// taille du probleme estimee</span>
<a name="l00899"></a>00899 <span class="comment">// int ram=</span>
<a name="l00900"></a>00900 <span class="preprocessor">#ifdef HPPA</span>
<a name="l00901"></a>00901 <span class="preprocessor"></span>      <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> command(<span class="stringliteral">&quot;bdf&quot;</span>);
<a name="l00902"></a>00902 <span class="preprocessor">#else</span>
<a name="l00903"></a>00903 <span class="preprocessor"></span>      <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> command(<span class="stringliteral">&quot;df -k&quot;</span>);
<a name="l00904"></a>00904 <span class="preprocessor">#endif</span>
<a name="l00905"></a>00905 <span class="preprocessor"></span><span class="comment">// Essayer avec stat -f -t . | awk &#39;{print 4*$8}&#39; ? Ca semble plus rapide...</span>
<a name="l00906"></a>00906 <span class="comment">// Mieux : stat -f -t . | cut -d &quot; &quot; -f8</span>
<a name="l00907"></a>00907       command+=<span class="stringliteral">&quot; . | awk &#39;/\\//!&lt; &amp;&amp; /%/ {print $(NF-2)\&quot; Kbytes available sur \&quot; $NF}&#39;&quot;</span>; <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; system(command) &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00908"></a>00908 <span class="comment">//</span>
<a name="l00909"></a>00909       ficstop &gt;&gt; stop_lu_l;
<a name="l00910"></a>00910     }
<a name="l00911"></a>00911   <span class="keywordflow">return</span> stop_lu_l;
<a name="l00912"></a>00912 }
<a name="l00913"></a>00913 
<a name="l00914"></a>00914 <span class="comment">// Precondition:</span>
<a name="l00915"></a>00915 <span class="comment">// Parametre: double&amp; dt_calc</span>
<a name="l00916"></a>00916 <span class="comment">// Signification: le pas de temps calcule a verifier</span>
<a name="l00917"></a>00917 <span class="comment">// Valeurs par defaut:</span>
<a name="l00918"></a>00918 <span class="comment">// Contraintes:</span>
<a name="l00919"></a>00919 <span class="comment">// Acces: entree/sortie</span>
<a name="l00920"></a>00920 <span class="comment">// </span>
<a name="l00921"></a>00921 <span class="comment">// Signification:</span>
<a name="l00922"></a>00922 <span class="comment">// Contraintes:</span>
<a name="l00923"></a>00923 <span class="comment">// Exception: le pas de temps calcule est inferieur a dt_min</span>
<a name="l00924"></a>00924 <span class="comment">// Effets de bord:</span>
<a name="l00925"></a>00925 <span class="comment">// Postcondition:</span>
<a name="l00926"></a>00926 <span class="comment">//</span>
<a name="l00927"></a>00927 <span class="comment">//</span>
<a name="l00928"></a>00928 <span class="comment">//</span>
<a name="l00929"></a>00929 <span class="comment">//</span>
<a name="l00930"></a>00930 <span class="comment">//</span><span class="comment"></span>
<a name="l00931"></a>00931 <span class="comment">//! Corrige le pas de temps calcule que l&#39;on passe en parametre&lt;br&gt;et verifie qu&#39;il n&#39;est pas &quot;trop&quot; petit (&lt; dt-min_).&lt;br&gt;La correction est la suivante:&lt;br&gt;delta_t = min((facteur de securite * dt_calc), dt_max)&lt;br&gt;Et on verifie que delta_t est &quot;suffisamment&quot; plus grand que dt_min_.</span>
<a name="l00932"></a><a class="code" href="classSchema__Temps__base.html#a9b045f8fd0d9066b1904ecb5c97290e3">00932</a> <span class="comment"></span><span class="keywordtype">bool</span> <a class="code" href="classSchema__Temps__base.html#a9b045f8fd0d9066b1904ecb5c97290e3" title="Corrige le pas de temps calcule que l&#39;on passe en parametre et verifie qu&#39;il n&#39;est pas &quot;trop&quot; petit (...">Schema_Temps_base::corriger_dt_calcule</a>(<span class="keywordtype">double</span>&amp; dt_calc)<span class="keyword"> const</span>
<a name="l00933"></a>00933 <span class="keyword"></span>{
<a name="l00934"></a>00934 <span class="comment">// Print the RAM</span>
<a name="l00935"></a>00935   <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#a7a2bf65aa65d7b2ddb7ccc0bc5fd0668" title="Renvoie 1 s&#39;il y a lieu d&#39;effectuer une impression (cf dt_impr) Renvoie 0 sinon.">limpr</a>())
<a name="l00936"></a>00936     {
<a name="l00937"></a>00937       <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00938"></a>00938       <a class="code" href="classProcess.html#aa1142e848c81a78c28a061a6f45b4042">imprimer_ram_totale</a>();
<a name="l00939"></a>00939     }
<a name="l00940"></a>00940 <span class="comment">// Compute the time step dt as the minimal value between dt_max_ and stability time step (dt_stab) * security factor (facsec)</span>
<a name="l00941"></a>00941   <span class="keywordtype">double</span> dt = <a class="code" href="Double_8h.html#a2f8edc4561e9744ed4233b205fa7ec32">min</a> (<a class="code" href="classSchema__Temps__base.html#a55d7d507689898465bf9ce320446ba99" title="Pas de temps max fixe par l&#39;utilisateur.">dt_max_</a>, <a class="code" href="classSchema__Temps__base.html#acf696ebda2c1019cde88306d1f0e412a" title="Pas de temps de stabilite.">dt_stab_</a> * <a class="code" href="classSchema__Temps__base.html#a8cdc40f1adfd8ff29d7f9c75330920ee">facsec_</a>);
<a name="l00942"></a>00942   <span class="keywordflow">if</span> ((dt - <a class="code" href="classSchema__Temps__base.html#abc40918e7ff94cc1897d12b2f3bb1340" title="Pas de temps min fixe par l&#39;utilisateur.">dt_min_</a>)/(dt+<a class="code" href="Double_8h.html#a0a3fffa6d17ad8f7de4bb337c6266561">DMINFLOAT</a>) &lt; -1.e-6)
<a name="l00943"></a>00943     {
<a name="l00944"></a>00944 <span class="comment">// Calculation stops if time step dt is less than dt_min</span>
<a name="l00945"></a>00945       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;---------------------------------------------------------&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00946"></a>00946       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Problem with the time step &quot;</span> &lt;&lt; dt &lt;&lt; <span class="stringliteral">&quot; which is less than dt_min &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#abc40918e7ff94cc1897d12b2f3bb1340" title="Pas de temps min fixe par l&#39;utilisateur.">dt_min_</a> &lt;&lt; finl;
<a name="l00947"></a>00947       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Lower dt_min value or check why the time step decreases...&quot;</span> &lt;&lt; finl;
<a name="l00948"></a>00948       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Results are saved to provide help.&quot;</span> &lt;&lt; finl;
<a name="l00949"></a>00949       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;---------------------------------------------------------&quot;</span> &lt;&lt; finl;
<a name="l00950"></a>00950       <a class="code" href="classProbleme__base.html" title="classe Probleme_base C&#39;est un Probleme_U qui n&#39;est pas un couplage. Le role d&#39;un Probleme_base est la...">Probleme_base</a>&amp; pb = <a class="code" href="Cast_8h.html#ad3836a067c92103af8df5ad8f35959a6">ref_cast_non_const</a>(<a class="code" href="classProbleme__base.html" title="classe Probleme_base C&#39;est un Probleme_U qui n&#39;est pas un couplage. Le role d&#39;un Probleme_base est la...">Probleme_base</a>, <a class="code" href="classSchema__Temps__base.html#a99eb764548c21553a104134be803530d">mon_probleme</a>.<a class="code" href="classRef__Probleme__base.html#ae8c315c3e3321e765a5ca9c27e6322b5">valeur</a>());
<a name="l00951"></a>00951       pb.<a class="code" href="classProbleme__base.html#a92b16c8d3d7d0209476e77700afb0aad" title="Si force=1, effectue le postraitement sans tenir compte des frequences de postraitement. Le postraitement est mis a jour et les traitements eventuels sur les sondes, champs et statistiques sont effectues. Si force=0, tient compte des frequences d&#39;impression demandees.">postraiter</a>(1);
<a name="l00952"></a>00952       pb.<a class="code" href="classProbleme__base.html#aaea4bf58bdcc7a5bdd931da739a090ea" title="Ecriture sur fichier en vue d&#39;une reprise (sauvegarde)">sauver</a>();
<a name="l00953"></a>00953       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00954"></a>00954     }
<a name="l00955"></a>00955   dt_calc=dt;
<a name="l00956"></a>00956   <span class="keywordflow">return</span> 1;
<a name="l00957"></a>00957 }
<a name="l00958"></a>00958 
<a name="l00959"></a>00959 
<a name="l00960"></a>00960 <span class="comment">// Precondition:</span>
<a name="l00961"></a>00961 <span class="comment">// Parametre:</span>
<a name="l00962"></a>00962 <span class="comment">// Signification:</span>
<a name="l00963"></a>00963 <span class="comment">// Valeurs par defaut:</span>
<a name="l00964"></a>00964 <span class="comment">// Contraintes:</span>
<a name="l00965"></a>00965 <span class="comment">// Acces:</span>
<a name="l00966"></a>00966 <span class="comment">// Exception:</span>
<a name="l00967"></a>00967 <span class="comment">// Effets de bord:</span>
<a name="l00968"></a>00968 <span class="comment">// Postcondition:</span>
<a name="l00969"></a>00969 <span class="comment">//</span>
<a name="l00970"></a>00970 <span class="comment">//</span>
<a name="l00971"></a>00971 <span class="comment">//</span>
<a name="l00972"></a>00972 <span class="comment">//</span>
<a name="l00973"></a>00973 <span class="comment">//</span>
<a name="l00974"></a>00974 <span class="comment">//</span><span class="comment"></span>
<a name="l00975"></a>00975 <span class="comment">//! Renvoie 1 si il y lieu de stopper le calcul pour differente raisons:&lt;br&gt;- le temps final est atteint&lt;br&gt;- le nombre de pas de temps maximum est depasse&lt;br&gt;- l&#39;etat stationnaire est atteint&lt;br&gt;- indicateur d&#39;arret fichier (voir int Schema_Temps_base::stop_lu())&lt;br&gt;Renvoie 0 sinon</span>
<a name="l00976"></a>00976 <span class="comment"></span><span class="comment">/** \return int&lt;br&gt;</span>
<a name="l00977"></a>00977 <span class="comment">Signification: 1 si il y a lieu de stopper le calcul 0 sinon.&lt;br&gt;</span>
<a name="l00978"></a>00978 <span class="comment">Contraintes: */</span>
<a name="l00979"></a><a class="code" href="classSchema__Temps__base.html#a4231b9b624ea282ee8f9555e9ebc9139">00979</a> <span class="keywordtype">int</span> <a class="code" href="classSchema__Temps__base.html#a4231b9b624ea282ee8f9555e9ebc9139" title="Renvoie 1 si il y lieu de stopper le calcul pour differente raisons: - le temps final est atteint - l...">Schema_Temps_base::stop</a>()<span class="keyword"> const</span>
<a name="l00980"></a>00980 <span class="keyword"></span>{
<a name="l00981"></a>00981   <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#afe5bc179eeb8a6d0d49c0b1bf01723f6" title="Renvoie 1 si le temps final est atteint (ou depasse). Renvoie 1 si temps_courant_ &gt;= tmax Renvoie 0 s...">temps_final_atteint</a>())
<a name="l00982"></a>00982     {
<a name="l00983"></a>00983       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;---------------------------------------------------------&quot;</span>
<a name="l00984"></a>00984            &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>
<a name="l00985"></a>00985            &lt;&lt; <span class="stringliteral">&quot;The problem &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a6e2edfe46a7f27b6fc8f114d92c35dc2">pb_base</a>().<a class="code" href="classProbleme__base.html#a58bc0b101f3f3f1d8522a9f41f1fad7b" title="surcharge Objet_U::le_nom() Renvoie le nom du probleme">le_nom</a>()
<a name="l00986"></a>00986            &lt;&lt; <span class="stringliteral">&quot; wants to stop : final time reached&quot;</span>
<a name="l00987"></a>00987            &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00988"></a>00988       <span class="keywordflow">return</span> 1;
<a name="l00989"></a>00989     }
<a name="l00990"></a>00990 
<a name="l00991"></a>00991   <span class="keywordflow">if</span> ((<a class="code" href="classSchema__Temps__base.html#a36f08917939a3f349477a214db3c19d3" title="Renvoie 1 si (le nombre de pas de temps &gt;= nombre de pas de temps maximum). Renvoie 0 sinon...">nb_pas_dt_max_atteint</a>()) || <a class="code" href="classSchema__Temps__base.html#a4cd1e401f61da498c719d2ff881d9552">nb_pas_dt_max_</a>==0)
<a name="l00992"></a>00992     {
<a name="l00993"></a>00993       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;---------------------------------------------------------&quot;</span>
<a name="l00994"></a>00994            &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>
<a name="l00995"></a>00995            &lt;&lt; <span class="stringliteral">&quot;The problem &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a6e2edfe46a7f27b6fc8f114d92c35dc2">pb_base</a>().<a class="code" href="classProbleme__base.html#a58bc0b101f3f3f1d8522a9f41f1fad7b" title="surcharge Objet_U::le_nom() Renvoie le nom du probleme">le_nom</a>()
<a name="l00996"></a>00996            &lt;&lt; <span class="stringliteral">&quot; wants to stop : the maximum number of time steps reached&quot;</span>
<a name="l00997"></a>00997            &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00998"></a>00998       <span class="keywordflow">return</span> 1;
<a name="l00999"></a>00999     }
<a name="l01000"></a>01000 
<a name="l01001"></a>01001   <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#aedf8fd836c4a89a9eb076371c800a93b">temps_cpu_max_atteint</a>())
<a name="l01002"></a>01002     {
<a name="l01003"></a>01003       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;---------------------------------------------------------&quot;</span>
<a name="l01004"></a>01004            &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>
<a name="l01005"></a>01005            &lt;&lt; <span class="stringliteral">&quot;The problem &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a6e2edfe46a7f27b6fc8f114d92c35dc2">pb_base</a>().<a class="code" href="classProbleme__base.html#a58bc0b101f3f3f1d8522a9f41f1fad7b" title="surcharge Objet_U::le_nom() Renvoie le nom du probleme">le_nom</a>()
<a name="l01006"></a>01006            &lt;&lt; <span class="stringliteral">&quot; wants to stop : max cpu time reached&quot;</span>
<a name="l01007"></a>01007            &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01008"></a>01008       <span class="keywordflow">return</span> 1;
<a name="l01009"></a>01009     }
<a name="l01010"></a>01010 
<a name="l01011"></a>01011   <span class="keywordflow">if</span> (!<a class="code" href="Process_8cpp.html#a793f0cea0b470888001917e7bc49d680" title="Returns the disable_stop_ flag (Disable or not the writing of the .stop file)">get_disable_stop</a>())
<a name="l01012"></a>01012     {
<a name="l01013"></a>01013       <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#a753a697da5c097060eab9d3bff2d40d8" title="Renvoie 1 si le fichier (d&#39;extension) .stop contient un 1 Renvoie 0 sinon.">stop_lu</a>())
<a name="l01014"></a>01014         {
<a name="l01015"></a>01015           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;---------------------------------------------------------&quot;</span>
<a name="l01016"></a>01016                &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>
<a name="l01017"></a>01017                &lt;&lt; <span class="stringliteral">&quot;The problem &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a6e2edfe46a7f27b6fc8f114d92c35dc2">pb_base</a>().<a class="code" href="classProbleme__base.html#a58bc0b101f3f3f1d8522a9f41f1fad7b" title="surcharge Objet_U::le_nom() Renvoie le nom du probleme">le_nom</a>()
<a name="l01018"></a>01018                &lt;&lt; <span class="stringliteral">&quot; wants to stop : stop file detected&quot;</span>
<a name="l01019"></a>01019                &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01020"></a>01020           <span class="keywordflow">return</span> 1;
<a name="l01021"></a>01021         }
<a name="l01022"></a>01022     }
<a name="l01023"></a>01023   <span class="keywordflow">return</span> 0;
<a name="l01024"></a>01024 }
<a name="l01025"></a>01025 
<a name="l01026"></a>01026 
<a name="l01027"></a><a class="code" href="classSchema__Temps__base.html#a6e2edfe46a7f27b6fc8f114d92c35dc2">01027</a> <a class="code" href="classProbleme__base.html" title="classe Probleme_base C&#39;est un Probleme_U qui n&#39;est pas un couplage. Le role d&#39;un Probleme_base est la...">Probleme_base</a>&amp; <a class="code" href="classSchema__Temps__base.html#a6e2edfe46a7f27b6fc8f114d92c35dc2">Schema_Temps_base::pb_base</a>()
<a name="l01028"></a>01028 {
<a name="l01029"></a>01029   <span class="keywordflow">return</span> <a class="code" href="classSchema__Temps__base.html#a99eb764548c21553a104134be803530d">mon_probleme</a>.<a class="code" href="classRef__Probleme__base.html#ae8c315c3e3321e765a5ca9c27e6322b5">valeur</a>();
<a name="l01030"></a>01030 }
<a name="l01031"></a>01031 
<a name="l01032"></a><a class="code" href="classSchema__Temps__base.html#a279ecdd54c2bd1bd78d87cffd96a707a">01032</a> <span class="keyword">const</span> <a class="code" href="classProbleme__base.html" title="classe Probleme_base C&#39;est un Probleme_U qui n&#39;est pas un couplage. Le role d&#39;un Probleme_base est la...">Probleme_base</a>&amp; <a class="code" href="classSchema__Temps__base.html#a6e2edfe46a7f27b6fc8f114d92c35dc2">Schema_Temps_base::pb_base</a>()<span class="keyword"> const</span>
<a name="l01033"></a>01033 <span class="keyword"></span>{
<a name="l01034"></a>01034   <span class="keywordflow">return</span> <a class="code" href="classSchema__Temps__base.html#a99eb764548c21553a104134be803530d">mon_probleme</a>.<a class="code" href="classRef__Probleme__base.html#ae8c315c3e3321e765a5ca9c27e6322b5">valeur</a>();
<a name="l01035"></a>01035 }
<a name="l01036"></a>01036 
<a name="l01037"></a><a class="code" href="classSchema__Temps__base.html#ace73be0f7ccbd6ed6f7096ba277447fe">01037</a> <span class="keywordtype">void</span> <a class="code" href="classSchema__Temps__base.html#ace73be0f7ccbd6ed6f7096ba277447fe">Schema_Temps_base::ajouter_inertie</a>(<a class="code" href="classMatrice__Base.html">Matrice_Base</a>&amp; mat_morse,<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; secmem,<span class="keyword">const</span> <a class="code" href="classEquation__base.html">Equation_base</a>&amp; eqn)<span class="keyword"> const</span>
<a name="l01038"></a>01038 <span class="keyword"></span>{
<a name="l01039"></a>01039 <span class="comment">// codage pour euler_implicite</span>
<a name="l01040"></a>01040   <span class="keywordtype">double</span> dt=<a class="code" href="classSchema__Temps__base.html#a0e4f67ef6086c09434ddc161668077b2" title="Renvoie le pas de temps (delta_t) courant.">pas_de_temps</a>();
<a name="l01041"></a>01041 <span class="comment">// On ne penalise pas les matrices et les secmems meme dans les cas</span>
<a name="l01042"></a>01042 <span class="comment">// dirichlet , symetrie</span>
<a name="l01043"></a>01043   <span class="keywordtype">int</span> pen=0;
<a name="l01044"></a>01044   eqn.<a class="code" href="classEquation__base.html#adfedf474c07a92f6b2261ca2f1cee80e" title="Renvoie le solveur de masse associe a l&#39;equation.">solv_masse</a>().<a class="code" href="classSolveur__Masse.html#adc554d2f7efe81e71ff8995d4f2df8c7">ajouter_masse</a>(dt,mat_morse,pen); <span class="comment">//ordre important pour CoviMAC</span>
<a name="l01045"></a>01045   eqn.<a class="code" href="classEquation__base.html#adfedf474c07a92f6b2261ca2f1cee80e" title="Renvoie le solveur de masse associe a l&#39;equation.">solv_masse</a>().<a class="code" href="classSolveur__Masse.html#adc554d2f7efe81e71ff8995d4f2df8c7">ajouter_masse</a>(dt,secmem,eqn.<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().<a class="code" href="classChamp__Inc.html#ad4e16720f4575dceb8536c9f09635a3c" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps t-i.">passe</a>(),pen);
<a name="l01046"></a>01046 }
<a name="l01047"></a>01047 
<a name="l01048"></a>01048 <span class="keywordtype">void</span> <a class="code" href="classSchema__Temps__base.html#a929c9db57c971bbba038466053d2f6f7">Schema_Temps_base::ajouter_blocs</a>(<a class="code" href="Interface__blocs_8h.html#a68e4f5c4505f6b31305de844302660bb">matrices_t</a> matrices, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; secmem, <span class="keyword">const</span> <a class="code" href="classEquation__base.html">Equation_base</a>&amp; eqn, <span class="keyword">const</span> <a class="code" href="Interface__blocs_8h.html#a2d7480bf11fc9f791b1d2839fa30a5c3">tabs_t</a>&amp; semi_impl)<span class="keyword"> const</span>
<a name="l01049"></a>01049 <span class="keyword"></span>{
<a name="l01050"></a>01050   eqn.<a class="code" href="classEquation__base.html#adfedf474c07a92f6b2261ca2f1cee80e" title="Renvoie le solveur de masse associe a l&#39;equation.">solv_masse</a>().<a class="code" href="classDeriv__Solveur__Masse__base.html#ad9c6d7581b1979f3acb81c4d3da49edf">valeur</a>().<a class="code" href="classSolveur__Masse__base.html#ad8e0b443660af050c32d40eff5b09834">ajouter_blocs</a>(matrices, secmem, <a class="code" href="classSchema__Temps__base.html#a0e4f67ef6086c09434ddc161668077b2" title="Renvoie le pas de temps (delta_t) courant.">pas_de_temps</a>(), semi_impl, 1);
<a name="l01051"></a>01051 }
<a name="l01052"></a>01052 
<a name="l01053"></a>01053 <span class="comment">// Precondition:</span>
<a name="l01054"></a>01054 <span class="comment">// Parametre: double&amp; t</span>
<a name="l01055"></a>01055 <span class="comment">// Signification: le nouveau temps courant</span>
<a name="l01056"></a>01056 <span class="comment">// Valeurs par defaut:</span>
<a name="l01057"></a>01057 <span class="comment">// Contraintes: reference constante</span>
<a name="l01058"></a>01058 <span class="comment">// Acces:</span>
<a name="l01059"></a>01059 <span class="comment">// </span>
<a name="l01060"></a>01060 <span class="comment">// Signification:</span>
<a name="l01061"></a>01061 <span class="comment">// Contraintes:</span>
<a name="l01062"></a>01062 <span class="comment">// Exception:</span>
<a name="l01063"></a>01063 <span class="comment">// Effets de bord:</span>
<a name="l01064"></a>01064 <span class="comment">// Postcondition:</span>
<a name="l01065"></a>01065 <span class="comment">//</span>
<a name="l01066"></a>01066 <span class="comment">//</span><span class="comment"></span>
<a name="l01067"></a>01067 <span class="comment">//! //Actualisation de stationnaire_atteint_ et residu_&lt;br&gt;(critere residu_&lt;seuil_statio_)</span>
<a name="l01068"></a><a class="code" href="classSchema__Temps__base.html#ae688058ec9592383f84aeb6de1d56158">01068</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classSchema__Temps__base.html#ae688058ec9592383f84aeb6de1d56158" title="//Actualisation de stationnaire_atteint_ et residu_ (critere residu_&lt;seuil_statio_)">Schema_Temps_base::update_critere_statio</a>(<span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; tab_critere, <a class="code" href="classEquation__base.html">Equation_base</a>&amp; equation)
<a name="l01069"></a>01069 {
<a name="l01070"></a>01070   <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; residu_equation = equation.<a class="code" href="classEquation__base.html#a7a76cecb22f2acd998cd2f9a2f699f7b">get_residu</a>();
<a name="l01071"></a>01071 <span class="comment">// En fonction de la taille du tableau residu_equation</span>
<a name="l01072"></a>01072 <span class="comment">// on prend le max de tab_critere sur tout le tableau ou par colonne</span>
<a name="l01073"></a>01073   <span class="keywordtype">int</span> size = residu_equation.<a class="code" href="classArrOfDouble.html#a3c3b33bea0e88b87315c21ee94bee05f" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l01074"></a>01074   <span class="keywordflow">if</span> (size==0)
<a name="l01075"></a>01075     {
<a name="l01076"></a>01076       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Schema_Temps_base::update_critere_statio&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01077"></a>01077       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Array residu_equation has a null size&quot;</span> &lt;&lt; finl;
<a name="l01078"></a>01078       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classSchema__Temps__base.html#a6e2edfe46a7f27b6fc8f114d92c35dc2">pb_base</a>().<a class="code" href="classProbleme__base.html#abefceb0ac0d0b35d42a4daaa82a95f59">nombre_d_equations</a>(); i++)
<a name="l01079"></a>01079         <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#a6e2edfe46a7f27b6fc8f114d92c35dc2">pb_base</a>().<a class="code" href="classProbleme__base.html#ae97586575b7e510d7945ce3a894b806a">equation</a>(i).<a class="code" href="classEquation__base.html#a7a76cecb22f2acd998cd2f9a2f699f7b">get_residu</a>().<a class="code" href="classArrOfDouble.html#a3c3b33bea0e88b87315c21ee94bee05f" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>()==0)
<a name="l01080"></a>01080           {
<a name="l01081"></a>01081             <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;The equation of kind &quot;</span> &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a6e2edfe46a7f27b6fc8f114d92c35dc2">pb_base</a>().<a class="code" href="classProbleme__base.html#ae97586575b7e510d7945ce3a894b806a">equation</a>(i).<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; <span class="stringliteral">&quot; didn&#39;t size the array.&quot;</span> &lt;&lt; finl;
<a name="l01082"></a>01082             <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Please, contact TRUST support.&quot;</span> &lt;&lt; finl;
<a name="l01083"></a>01083             <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l01084"></a>01084           }
<a name="l01085"></a>01085     }
<a name="l01086"></a>01086   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (size==1)
<a name="l01087"></a>01087     residu_equation(0) = <a class="code" href="DoubleVect_8cpp.html#acb21ec8c0b3909c26b20e3f3455e0289">mp_max_abs_vect</a>(tab_critere);
<a name="l01088"></a>01088   <span class="keywordflow">else</span>
<a name="l01089"></a>01089     <a class="code" href="DoubleTab_8cpp.html#a45f3ed78ddbbca7ed00d97e33be19a22">mp_max_abs_tab</a>(tab_critere, residu_equation);
<a name="l01090"></a>01090 
<a name="l01091"></a>01091   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> tab_critere_abs(tab_critere);
<a name="l01092"></a>01092   <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; n = tab_critere_abs.<a class="code" href="classDoubleTab.html#a3eadd63f3ba20c1b454d760b430acbf7" title="Returns the total dimensions of the multi-dimensionnal array, including virtual items (used in parall...">dimension_tot</a>(0);
<a name="l01093"></a>01093   <span class="keywordflow">if</span>(size == 1)
<a name="l01094"></a>01094     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt; n; i++)
<a name="l01095"></a>01095       tab_critere_abs(i) = fabs(tab_critere_abs(i));
<a name="l01096"></a>01096   <span class="keywordflow">else</span>
<a name="l01097"></a>01097     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j&lt;size; j++)
<a name="l01098"></a>01098       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt; n; i++)
<a name="l01099"></a>01099         tab_critere_abs(i,j) = fabs(tab_critere_abs(i,j));
<a name="l01100"></a>01100 
<a name="l01101"></a>01101   equation.<a class="code" href="classEquation__base.html#aae551a48a69ac5091719a93afe59f9cc">set_residuals</a>(tab_critere_abs);
<a name="l01102"></a>01102 
<a name="l01103"></a>01103 <span class="comment">// On calcule le residu_initial_equation sur les 5 premiers pas de temps</span>
<a name="l01104"></a>01104   <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#a03e1b245412eb5948b423a767c56cc58" title="Drapeau pour specifier si seuil_statio_ est une valeur absolue (defaut) ou relative.">seuil_statio_relatif_deconseille_</a>)
<a name="l01105"></a>01105     {
<a name="l01106"></a>01106       <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; residu_initial_equation = equation.<a class="code" href="classEquation__base.html#a6e0b2000e5d5fb7d5a1588a41d1b0dd6">residu_initial</a>();
<a name="l01107"></a>01107       <span class="keywordflow">if</span> (<a class="code" href="classSchema__Temps__base.html#a247769eddf9c0bfcaabc50b8dd90d401" title="Renvoie le nombre de pas de temps effectues.">nb_pas_dt</a>()&lt;6)
<a name="l01108"></a>01108         {
<a name="l01109"></a>01109           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;size; i++)
<a name="l01110"></a>01110             residu_initial_equation(i) = residu_equation(i);
<a name="l01111"></a>01111 <span class="comment">// On ne prend plus le max car celui ci est parfois grand au premier pas de temps:</span>
<a name="l01112"></a>01112 <span class="comment">// residu_initial_equation(i) = max(residu_initial_equation(i), residu_equation(i));</span>
<a name="l01113"></a>01113         }
<a name="l01114"></a>01114 <span class="comment">// On normalise residu_equation par residu_initial_equation</span>
<a name="l01115"></a>01115       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;size; i++)
<a name="l01116"></a>01116         <span class="keywordflow">if</span> (residu_initial_equation(i)&gt;0)
<a name="l01117"></a>01117           residu_equation(i) /= residu_initial_equation(i);
<a name="l01118"></a>01118     }
<a name="l01119"></a>01119 <span class="comment">// double equation_residual = mp_max_abs_vect(residu_equation);</span>
<a name="l01120"></a>01120   <span class="keywordtype">double</span> equation_residual = <a class="code" href="DoubleVect_8cpp.html#aad339141fa6027fa3b627825a2407c12">local_max_abs_vect</a>(residu_equation);
<a name="l01121"></a>01121   <a class="code" href="classSchema__Temps__base.html#addda9320fe85fd273e84fa0d09f12eef" title="Residu.">residu_</a> = <a class="code" href="Double_8h.html#a1c45761573e6cbc97cfacac78d905016">max</a>(<a class="code" href="classSchema__Temps__base.html#addda9320fe85fd273e84fa0d09f12eef" title="Residu.">residu_</a>,equation_residual);
<a name="l01122"></a>01122   <a class="code" href="classSchema__Temps__base.html#a0919fb0885a396e98f578047cc1cc5e3">set_stationnaire_atteint</a>() *= ( equation_residual &lt; <a class="code" href="classSchema__Temps__base.html#ac3c38a091b9d8337e5e7352d14108ee6">seuil_statio_</a> );
<a name="l01123"></a>01123 }
<a name="l01124"></a>01124 
<a name="l01125"></a>01125 <span class="comment">// Impression du temps courant en tenant compte du dt</span>
<a name="l01126"></a>01126 <span class="comment">// pour la precision de l&#39;impression (utilise dans les operateurs)</span>
<a name="l01127"></a><a class="code" href="classSchema__Temps__base.html#afb4a13da2e8149defb5339ef005ef231">01127</a> <span class="keywordtype">void</span> <a class="code" href="classSchema__Temps__base.html#afb4a13da2e8149defb5339ef005ef231">Schema_Temps_base::imprimer_temps_courant</a>(<a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a>&amp; os)<span class="keyword"> const</span>
<a name="l01128"></a>01128 <span class="keyword"></span>{
<a name="l01129"></a>01129   <span class="keywordtype">int</span> precision_actuelle=os.<a class="code" href="classSortie__Fichier__base.html#a14d2f634a031fd5b1a9455a1bdfbf661">get_precision</a>();
<a name="l01130"></a>01130   <span class="keywordtype">int</span> precision_temps;
<a name="l01131"></a>01131   <span class="keywordflow">if</span> (!<a class="code" href="Double_8h.html#ac86f5f350b0f95fd8c34b0ac8d720f6f">est_egal</a>(<a class="code" href="classSchema__Temps__base.html#a5054df01edb6d4f7baec7e612d423834" title="Renvoie le temps courant.">temps_courant</a>(),0.))
<a name="l01132"></a>01132     precision_temps=<a class="code" href="Double_8h.html#a1c45761573e6cbc97cfacac78d905016">max</a>( precision_actuelle, (<span class="keywordtype">int</span>)(2+log10(1/<a class="code" href="Double_8h.html#aaecd4ca8a2fe69cc6568af2938b94d2e">dabs</a>(<a class="code" href="classSchema__Temps__base.html#a0e4f67ef6086c09434ddc161668077b2" title="Renvoie le pas de temps (delta_t) courant.">pas_de_temps</a>()))+(<span class="keywordtype">int</span>)(log10(<a class="code" href="Double_8h.html#aaecd4ca8a2fe69cc6568af2938b94d2e">dabs</a>(<a class="code" href="classSchema__Temps__base.html#a5054df01edb6d4f7baec7e612d423834" title="Renvoie le temps courant.">temps_courant</a>())))) );
<a name="l01133"></a>01133   <span class="keywordflow">else</span>
<a name="l01134"></a>01134     precision_temps=<a class="code" href="Double_8h.html#a1c45761573e6cbc97cfacac78d905016">max</a>( precision_actuelle, (<span class="keywordtype">int</span>)(2+log10(1/<a class="code" href="Double_8h.html#aaecd4ca8a2fe69cc6568af2938b94d2e">dabs</a>(<a class="code" href="classSchema__Temps__base.html#a0e4f67ef6086c09434ddc161668077b2" title="Renvoie le pas de temps (delta_t) courant.">pas_de_temps</a>()))) );
<a name="l01135"></a>01135   os.<a class="code" href="classSortie__Fichier__base.html#a489ca01946f4e2a7a9aa8f3a3d949b08">precision</a>(precision_temps);
<a name="l01136"></a>01136   os &lt;&lt; <a class="code" href="classSchema__Temps__base.html#a5054df01edb6d4f7baec7e612d423834" title="Renvoie le temps courant.">temps_courant</a>();
<a name="l01137"></a>01137   os.<a class="code" href="classSortie__Fichier__base.html#a489ca01946f4e2a7a9aa8f3a3d949b08">precision</a>(precision_actuelle);
<a name="l01138"></a>01138 }
<a name="l01139"></a>01139 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:16 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
