<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/Kernel/Utilitaires/stat_counters.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/Kernel/Utilitaires/stat_counters.cpp</div>  </div>
</div>
<div class="contents">
<a href="stat__counters_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (c) 2021, CEA</span>
<a name="l00003"></a>00003 <span class="comment">* All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment">* 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00007"></a>00007 <span class="comment">* 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00008"></a>00008 <span class="comment">* 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<a name="l00011"></a>00011 <span class="comment">* IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;</span>
<a name="l00012"></a>00012 <span class="comment">* OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// File:        stat_counters.cpp</span>
<a name="l00018"></a>00018 <span class="comment">// Directory:   $TRUST_ROOT/src/Kernel/Utilitaires</span>
<a name="l00019"></a>00019 <span class="comment">// Version:     /main/39</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;<a class="code" href="stat__counters_8h.html">stat_counters.h</a>&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="EcrFicCollecte_8h.html">EcrFicCollecte.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="Nom_8h.html">Nom.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="Double_8h.html">Double.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="SChaine_8h.html">SChaine.h</a>&gt;</span>
<a name="l00028"></a>00028 
<a name="l00029"></a><a class="code" href="stat__counters_8cpp.html#ad974fe981249f5e84fbf1683b012c9f8">00029</a> <span class="preprocessor">#define BUFLEN 100</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span>
<a name="l00031"></a>00031 <span class="comment">// Declaration des identifiants de compteurs</span>
<a name="l00032"></a>00032 
<a name="l00033"></a><a class="code" href="stat__counters_8h.html#a72b0d4b3469ad6354c83b3ca05a3cd26">00033</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#a72b0d4b3469ad6354c83b3ca05a3cd26">mpi_sendrecv_counter_</a>;
<a name="l00034"></a><a class="code" href="stat__counters_8h.html#ac5530206de46421879d71f612e05b217">00034</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#ac5530206de46421879d71f612e05b217">mpi_send_counter_</a>;
<a name="l00035"></a><a class="code" href="stat__counters_8h.html#a2c07f529bf1a42876875e881efc21e45">00035</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#a2c07f529bf1a42876875e881efc21e45">mpi_recv_counter_</a>;
<a name="l00036"></a><a class="code" href="stat__counters_8h.html#a5124c7c231089366dd4341827fab90f7">00036</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#a5124c7c231089366dd4341827fab90f7">mpi_bcast_counter_</a>;
<a name="l00037"></a><a class="code" href="stat__counters_8h.html#a53741c4f88fd2385db3365a9f5b00cec">00037</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#a53741c4f88fd2385db3365a9f5b00cec">mpi_alltoall_counter_</a>;
<a name="l00038"></a><a class="code" href="stat__counters_8h.html#a8e0d5616fa17fb32b1cf39ea24321f30">00038</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#a8e0d5616fa17fb32b1cf39ea24321f30">mpi_partialsum_counter_</a>;
<a name="l00039"></a><a class="code" href="stat__counters_8cpp.html#a0a96e0a28ac577cc24fbea6e69b36695">00039</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#a0a96e0a28ac577cc24fbea6e69b36695">mpi_sendrecv_io_counter_</a>;
<a name="l00040"></a><a class="code" href="stat__counters_8h.html#ac1c8738526e1896276b874fddfbc7b2f">00040</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#ac1c8738526e1896276b874fddfbc7b2f">mpi_sumdouble_counter_</a>;
<a name="l00041"></a><a class="code" href="stat__counters_8h.html#ad044a342f1b0c425c4f3f01ecd62d441">00041</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#ad044a342f1b0c425c4f3f01ecd62d441">mpi_mindouble_counter_</a>;
<a name="l00042"></a><a class="code" href="stat__counters_8h.html#ab2e1f6892d7627fd27b4bcc9cc9e1559">00042</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#ab2e1f6892d7627fd27b4bcc9cc9e1559">mpi_maxdouble_counter_</a>;
<a name="l00043"></a><a class="code" href="stat__counters_8h.html#a8068b7082243a49326eb9037e713fdd6">00043</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#a8068b7082243a49326eb9037e713fdd6">mpi_sumint_counter_</a>;
<a name="l00044"></a><a class="code" href="stat__counters_8h.html#a2b7d385a876eb702b1e0a9121e3165d5">00044</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#a2b7d385a876eb702b1e0a9121e3165d5">mpi_minint_counter_</a>;
<a name="l00045"></a><a class="code" href="stat__counters_8h.html#ab05b4986b9cb74b212631b42386663a3">00045</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#ab05b4986b9cb74b212631b42386663a3">mpi_maxint_counter_</a>;
<a name="l00046"></a><a class="code" href="stat__counters_8h.html#addb19222ff0bbe4318a7f2de393149e7">00046</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#addb19222ff0bbe4318a7f2de393149e7">mpi_barrier_counter_</a>;
<a name="l00047"></a>00047 
<a name="l00048"></a><a class="code" href="stat__counters_8h.html#ad1adaf02fb22ea330f54d28bd7db19d7">00048</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#ad1adaf02fb22ea330f54d28bd7db19d7">echange_vect_counter_</a>;
<a name="l00049"></a>00049 
<a name="l00050"></a><a class="code" href="stat__counters_8h.html#aa8807b96042dbfea9eeddb3dfdf08681">00050</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#aa8807b96042dbfea9eeddb3dfdf08681">solv_sys_counter_</a>;
<a name="l00051"></a><a class="code" href="stat__counters_8h.html#a1374e3dd206f6a5ece6b44542e3edc34">00051</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#a1374e3dd206f6a5ece6b44542e3edc34">solv_sys_petsc_counter_</a>;
<a name="l00052"></a><a class="code" href="stat__counters_8h.html#a2168c1792848c3548a21e9cd4aaf1747">00052</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="Equation__base_8cpp.html#a2168c1792848c3548a21e9cd4aaf1747">diffusion_implicite_counter_</a>;
<a name="l00053"></a>00053 
<a name="l00054"></a><a class="code" href="stat__counters_8h.html#a6510fb955193409e2208fbbffc276e1c">00054</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#a6510fb955193409e2208fbbffc276e1c">nut_counter_</a>;
<a name="l00055"></a><a class="code" href="stat__counters_8h.html#a5b8120c86d162ed2767fd3f762f6e06f">00055</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#a5b8120c86d162ed2767fd3f762f6e06f">dt_counter_</a>;
<a name="l00056"></a><a class="code" href="stat__counters_8h.html#aa1f2a890f82f735dab5bfc5180a5f667">00056</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#aa1f2a890f82f735dab5bfc5180a5f667">convection_counter_</a>;
<a name="l00057"></a><a class="code" href="stat__counters_8h.html#a0a1ebab9c2c54cd815b1e29dd604838d">00057</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#a0a1ebab9c2c54cd815b1e29dd604838d">diffusion_counter_</a>;
<a name="l00058"></a><a class="code" href="stat__counters_8h.html#a67e1c37bead9abdf721c20a376190e02">00058</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#a67e1c37bead9abdf721c20a376190e02">decay_counter_</a>;
<a name="l00059"></a><a class="code" href="stat__counters_8h.html#a0f13b59059133acfc60bb1df81b54b50">00059</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#a0f13b59059133acfc60bb1df81b54b50">gradient_counter_</a>;
<a name="l00060"></a><a class="code" href="stat__counters_8h.html#af4f8319157b9d0d29c270437ee830f77">00060</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#af4f8319157b9d0d29c270437ee830f77">divergence_counter_</a>;
<a name="l00061"></a><a class="code" href="stat__counters_8h.html#afd631ff17259d91b27d19f2ef8aef0dc">00061</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#afd631ff17259d91b27d19f2ef8aef0dc">source_counter_</a>;
<a name="l00062"></a><a class="code" href="stat__counters_8h.html#a62a4ba40c40d7fc279c826e09f6e242a">00062</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#a62a4ba40c40d7fc279c826e09f6e242a">postraitement_counter_</a>;
<a name="l00063"></a><a class="code" href="stat__counters_8h.html#a448d2e12d64f5db165c48df5c8c50fe0">00063</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#a448d2e12d64f5db165c48df5c8c50fe0">divers_counter_</a>;
<a name="l00064"></a><a class="code" href="stat__counters_8h.html#a5e968b838c61de525c8015d35dddeb70">00064</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#a5e968b838c61de525c8015d35dddeb70">sauvegarde_counter_</a>;
<a name="l00065"></a><a class="code" href="stat__counters_8h.html#a2ca5bd7d90e68eed7a8acf3c37fd3dfb">00065</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#a2ca5bd7d90e68eed7a8acf3c37fd3dfb">temporary_counter_</a>;
<a name="l00066"></a>00066 
<a name="l00067"></a><a class="code" href="Convection__Diffusion__Temperature_8cpp.html#a918aa9eada292ff09f7d2959342d3c2c">00067</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="Equation__base_8cpp.html#a918aa9eada292ff09f7d2959342d3c2c">assemblage_sys_counter_</a>;
<a name="l00068"></a><a class="code" href="stat__counters_8h.html#a45a442b6c61761d54c36fb1a357c7538">00068</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#a45a442b6c61761d54c36fb1a357c7538">update_vars_counter_</a>;
<a name="l00069"></a><a class="code" href="stat__counters_8h.html#a71c875c8f7cb63479a71fd94616053f2">00069</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#a71c875c8f7cb63479a71fd94616053f2">update_fields_counter_</a>;
<a name="l00070"></a><a class="code" href="stat__counters_8h.html#ad0ff5c8b0553621de2a881e6965b6e52">00070</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#ad0ff5c8b0553621de2a881e6965b6e52">mettre_a_jour_counter_</a>;
<a name="l00071"></a><a class="code" href="stat__counters_8h.html#ad7610207bfa4bda2fcba41d00f16fcf0">00071</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#ad7610207bfa4bda2fcba41d00f16fcf0">timestep_counter_</a>;
<a name="l00072"></a><a class="code" href="stat__counters_8h.html#a5aa23d1c4a41bce37e5e06efb5e8c9e1">00072</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="Scatter_8cpp.html#a5aa23d1c4a41bce37e5e06efb5e8c9e1" title="&lt; PGI">interprete_scatter_counter_</a>;
<a name="l00073"></a><a class="code" href="mon__main_8cpp.html#a2cd262d038049f900ea193c706c476c3">00073</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#a2cd262d038049f900ea193c706c476c3">temps_total_execution_counter_</a>;
<a name="l00074"></a><a class="code" href="mon__main_8cpp.html#a54292d516b078553c900dac14d31d813">00074</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#a54292d516b078553c900dac14d31d813">initialisation_calcul_counter_</a>;
<a name="l00075"></a>00075 
<a name="l00076"></a><a class="code" href="stat__counters_8h.html#ae53634a5d9963b9481961762d15d23b2">00076</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="EcrFicPartageMPIIO_8cpp.html#ae53634a5d9963b9481961762d15d23b2">IO_EcrireFicPartageMPIIO_counter_</a>;
<a name="l00077"></a><a class="code" href="stat__counters_8h.html#ac3170aa88556995818da56645453d290">00077</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="EcrFicPartage_8cpp.html#ac3170aa88556995818da56645453d290">IO_EcrireFicPartageBin_counter_</a>;
<a name="l00078"></a>00078 
<a name="l00079"></a><a class="code" href="stat__counters_8h.html#a0b22d8bb1162b491f7d0505b588a9d06">00079</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#a0b22d8bb1162b491f7d0505b588a9d06">m1</a>;
<a name="l00080"></a><a class="code" href="stat__counters_8h.html#a9290e69c380cbaf6beae71212dc01a26">00080</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#a9290e69c380cbaf6beae71212dc01a26">m2</a>;
<a name="l00081"></a><a class="code" href="stat__counters_8h.html#a2aa32ea77b1a924ad396d59cde4a1ff5">00081</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#a2aa32ea77b1a924ad396d59cde4a1ff5">m3</a>;
<a name="l00082"></a>00082 
<a name="l00083"></a><a class="code" href="stat__counters_8h.html#a28736787d5f8446b9fe692a064dd3595">00083</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#a28736787d5f8446b9fe692a064dd3595">probleme_fluide_</a>;
<a name="l00084"></a><a class="code" href="stat__counters_8h.html#a9c61c69637fa0a970ce5d7178dd29d27">00084</a> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="stat__counters_8cpp.html#a9c61c69637fa0a970ce5d7178dd29d27">probleme_combustible_</a>;
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 <span class="comment">// Initialisation des differents compteurs.</span>
<a name="l00087"></a>00087 <span class="comment">// L&#39;ordre d&#39;impression des compteurs est le meme que l&#39;ordre de creation.</span>
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 <span class="comment">// SVP : mettez une courte description de ce que mesure exactement</span>
<a name="l00090"></a>00090 <span class="comment">// le compteur (quelles operations) et quelle est la signification</span>
<a name="l00091"></a>00091 <span class="comment">// de la quantite sommee (quand elle n&#39;est pas nulle).</span>
<a name="l00092"></a>00092 <span class="comment">// </span>
<a name="l00093"></a>00093 
<a name="l00094"></a><a class="code" href="mon__main_8cpp.html#a8ff095bf8d9a9961935a7c2d8531cd48">00094</a> <span class="keywordtype">void</span> <a class="code" href="stat__counters_8cpp.html#a8ff095bf8d9a9961935a7c2d8531cd48" title="&lt; chdir pour PGI et AIX">declare_stat_counters</a>()
<a name="l00095"></a>00095 {
<a name="l00096"></a>00096 <span class="comment">// Creation de l&#39;objet statistiques</span>
<a name="l00097"></a>00097   <span class="keywordflow">if</span> (<a class="code" href="Statistiques_8cpp.html#a512a2b3ab1289af1ee1131d49e7a0d4b">les_statistiques_trio_U_nom_long_pour_decourager_l_utilisation_directe</a>)
<a name="l00098"></a>00098     {
<a name="l00099"></a>00099       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error : declare_stat_counters() has already been called &quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00100"></a>00100       assert(0);
<a name="l00101"></a>00101       <span class="keywordflow">return</span>;
<a name="l00102"></a>00102     }
<a name="l00103"></a>00103   <a class="code" href="Statistiques_8cpp.html#a512a2b3ab1289af1ee1131d49e7a0d4b">les_statistiques_trio_U_nom_long_pour_decourager_l_utilisation_directe</a>
<a name="l00104"></a>00104     = <span class="keyword">new</span> <a class="code" href="classStatistiques.html">Statistiques</a>;
<a name="l00105"></a>00105 
<a name="l00106"></a>00106 <span class="comment">// Niveau de debug par defaut</span>
<a name="l00107"></a>00107   <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a4cd169e5658c3181ed233bf3b4259d05">set_debug_level</a>(9);
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 <span class="comment">// Temps total d&#39;execution</span>
<a name="l00110"></a>00110 <span class="comment">// Ce compteur est declare en premier (on calcule les pourcentages)</span>
<a name="l00111"></a>00111 <span class="comment">// par rapport a celui-la dans Statistiques::dump()</span>
<a name="l00112"></a>00112   temps_total_execution_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(1, <span class="stringliteral">&quot;Temps total&quot;</span>, 0);
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 <span class="comment">// Initialisation du calcul (jusqu&#39;a l&#39;entree dans Resoudre)</span>
<a name="l00115"></a>00115   initialisation_calcul_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(1, <span class="stringliteral">&quot;Preparer calcul&quot;</span>, 0);
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 <span class="comment">// Boucle de calcul du pas de temps dans Resoudre::interpreter</span>
<a name="l00118"></a>00118   timestep_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(1, <span class="stringliteral">&quot;Resoudre (timestep loop)&quot;</span>, 0);
<a name="l00119"></a>00119 <span class="comment">// Appels a SolveurSys::resoudre_systeme</span>
<a name="l00120"></a>00120 <span class="comment">// quantity = nombre total d&#39;iterations des solveurs</span>
<a name="l00121"></a>00121   solv_sys_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(1, <span class="stringliteral">&quot;SolveurSys::resoudre_systeme&quot;</span>, 0);
<a name="l00122"></a>00122   solv_sys_petsc_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(1, <span class="stringliteral">&quot;Solveurpetsc::resoudre_systeme&quot;</span>, 0);
<a name="l00123"></a>00123   diffusion_implicite_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(1, <span class="stringliteral">&quot;Equation_base::Gradient_conjugue_diff_impl&quot;</span>, 0);
<a name="l00124"></a>00124 
<a name="l00125"></a>00125 <span class="comment">// Appels a differents operateurs:</span>
<a name="l00126"></a>00126   dt_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(1, <span class="stringliteral">&quot;Operateur::calculer_pas_de_temps&quot;</span>, 0);
<a name="l00127"></a>00127   nut_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(1, <span class="stringliteral">&quot;ModeleTurbulence*::mettre_a_jour&quot;</span>, 0);
<a name="l00128"></a>00128   convection_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(1, <span class="stringliteral">&quot;Operateur_Conv::ajouter/calculer&quot;</span>, 0);
<a name="l00129"></a>00129   diffusion_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(1, <span class="stringliteral">&quot;Operateur_Diff::ajouter/calculer&quot;</span>, 0);
<a name="l00130"></a>00130   decay_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(1, <span class="stringliteral">&quot;Operateur_Decr::ajouter/calculer&quot;</span>, 0);
<a name="l00131"></a>00131   gradient_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(1, <span class="stringliteral">&quot;Operateur_Grad::ajouter/calculer&quot;</span>, 0);
<a name="l00132"></a>00132   divergence_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(1, <span class="stringliteral">&quot;Operateur_Div::ajouter/calculer&quot;</span>, 0);
<a name="l00133"></a>00133   source_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(1, <span class="stringliteral">&quot;Source::ajouter/calculer&quot;</span>, 0);
<a name="l00134"></a>00134 
<a name="l00135"></a>00135 <span class="comment">// Postraitement</span>
<a name="l00136"></a>00136   postraitement_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(1, <span class="stringliteral">&quot;Pb_base::postraiter&quot;</span>, 0);
<a name="l00137"></a>00137   sauvegarde_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(1, <span class="stringliteral">&quot;Probleme_base::sauver&quot;</span>, 0);
<a name="l00138"></a>00138   temporary_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(1, <span class="stringliteral">&quot;temporary&quot;</span>, 0);
<a name="l00139"></a>00139 
<a name="l00140"></a>00140 <span class="comment">// Assemblage de la matrice</span>
<a name="l00141"></a>00141   assemblage_sys_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(1, <span class="stringliteral">&quot;Assembleur::assembler&quot;</span>, 0);
<a name="l00142"></a>00142   update_vars_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(1, <span class="stringliteral">&quot;Schema_Implicite_4eqs::update_vars&quot;</span>, 0);
<a name="l00143"></a>00143   update_fields_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(1, <span class="stringliteral">&quot;Probleme_Diphasique_base::updateGivenFields&quot;</span>, 0);
<a name="l00144"></a>00144   mettre_a_jour_counter_  = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(1, <span class="stringliteral">&quot;::mettre_a_jour&quot;</span>, 0);
<a name="l00145"></a>00145 
<a name="l00146"></a>00146 <span class="comment">// Divers</span>
<a name="l00147"></a>00147   divers_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(1, <span class="stringliteral">&quot;Divers&quot;</span>, 0);
<a name="l00148"></a>00148 
<a name="l00149"></a>00149 <span class="comment">// Marqueurs pouvant etre places n&#39;importe ou:</span>
<a name="l00150"></a>00150   m1 = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(1, <span class="stringliteral">&quot;m1&quot;</span>, 0);
<a name="l00151"></a>00151   m2 = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(1, <span class="stringliteral">&quot;m2&quot;</span>, 0);
<a name="l00152"></a>00152   m3 = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(1, <span class="stringliteral">&quot;m3&quot;</span>, 0);
<a name="l00153"></a>00153 
<a name="l00154"></a>00154 <span class="comment">// Problemes</span>
<a name="l00155"></a>00155   probleme_fluide_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(3 <span class="comment">/* Level */</span>, <span class="stringliteral">&quot;pb_fluide&quot;</span>, 0 <span class="comment">/* Group */</span>);
<a name="l00156"></a>00156   probleme_combustible_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(3 <span class="comment">/* Level */</span>, <span class="stringliteral">&quot;pb_combustible&quot;</span>, 0 <span class="comment">/* Group */</span>);
<a name="l00157"></a>00157 
<a name="l00158"></a>00158 <span class="comment">// Appels a DoubleVect::echange_espace_virtuel()</span>
<a name="l00159"></a>00159   echange_vect_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(2, <span class="stringliteral">&quot;DoubleVect/IntVect::echange_espace_virtuel&quot;</span>, 0, 1);
<a name="l00160"></a>00160 
<a name="l00161"></a>00161   mpi_sendrecv_counter_  = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(2, <span class="stringliteral">&quot;MPI_send_recv&quot;</span>, <span class="stringliteral">&quot;MPI_sendrecv&quot;</span>, 1);
<a name="l00162"></a>00162   mpi_send_counter_      = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(2, <span class="stringliteral">&quot;MPI_send&quot;</span>,      <span class="stringliteral">&quot;MPI_sendrecv&quot;</span>, 1);
<a name="l00163"></a>00163   mpi_recv_counter_      = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(2, <span class="stringliteral">&quot;MPI_recv&quot;</span>,      <span class="stringliteral">&quot;MPI_sendrecv&quot;</span>, 1);
<a name="l00164"></a>00164   mpi_bcast_counter_     = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(2, <span class="stringliteral">&quot;MPI_broadcast&quot;</span>, <span class="stringliteral">&quot;MPI_sendrecv&quot;</span>, 1);
<a name="l00165"></a>00165   mpi_alltoall_counter_  = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(2, <span class="stringliteral">&quot;MPI_alltoall&quot;</span>,  <span class="stringliteral">&quot;MPI_sendrecv&quot;</span>, 1);
<a name="l00166"></a>00166   mpi_partialsum_counter_= <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(2, <span class="stringliteral">&quot;MPI_partialsum&quot;</span>,<span class="stringliteral">&quot;MPI_allreduce&quot;</span>, 1);
<a name="l00167"></a>00167   mpi_sumdouble_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(2, <span class="stringliteral">&quot;MPI_sumdouble&quot;</span>, <span class="stringliteral">&quot;MPI_allreduce&quot;</span>, 1);
<a name="l00168"></a>00168   mpi_mindouble_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(2, <span class="stringliteral">&quot;MPI_mindouble&quot;</span>, <span class="stringliteral">&quot;MPI_allreduce&quot;</span>, 1);
<a name="l00169"></a>00169   mpi_maxdouble_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(2, <span class="stringliteral">&quot;MPI_maxdouble&quot;</span>, <span class="stringliteral">&quot;MPI_allreduce&quot;</span>, 1);
<a name="l00170"></a>00170   mpi_sumint_counter_    = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(2, <span class="stringliteral">&quot;MPI_sumint&quot;</span>,    <span class="stringliteral">&quot;MPI_allreduce&quot;</span>, 1);
<a name="l00171"></a>00171   mpi_minint_counter_    = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(2, <span class="stringliteral">&quot;MPI_minint&quot;</span>,    <span class="stringliteral">&quot;MPI_allreduce&quot;</span>, 1);
<a name="l00172"></a>00172   mpi_maxint_counter_    = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(2, <span class="stringliteral">&quot;MPI_maxint&quot;</span>,    <span class="stringliteral">&quot;MPI_allreduce&quot;</span>, 1);
<a name="l00173"></a>00173   mpi_barrier_counter_   = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(2, <span class="stringliteral">&quot;MPI_barrier&quot;</span>,   <span class="stringliteral">&quot;MPI_allreduce&quot;</span>, 1);
<a name="l00174"></a>00174 
<a name="l00175"></a>00175 <span class="comment">// Compte le temps d&#39;ecriture dans EcrireFicPartageXXX (gros volumes de donnees dans fichiers XYZ ou LATA)</span>
<a name="l00176"></a>00176 <span class="comment">// quantity = nombre d&#39;octets ecrits</span>
<a name="l00177"></a>00177   IO_EcrireFicPartageMPIIO_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(2, <span class="stringliteral">&quot;MPI_File_write_all&quot;</span>, <span class="stringliteral">&quot;IO&quot;</span>, 0); <span class="comment">//!&lt; Appels sur chaque process</span>
<a name="l00178"></a>00178 <span class="comment"></span>  IO_EcrireFicPartageBin_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(2, <span class="stringliteral">&quot;write&quot;</span>, <span class="stringliteral">&quot;IO&quot;</span>, 0); <span class="comment">//!&lt; Appel uniquement sur maitre, appels plus souvents car bufferise</span>
<a name="l00179"></a>00179 <span class="comment"></span>
<a name="l00180"></a>00180 <span class="comment">// Execution de Scatter::interpreter</span>
<a name="l00181"></a>00181   interprete_scatter_counter_ = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(2, <span class="stringliteral">&quot;Scatter&quot;</span>, 0);
<a name="l00182"></a>00182 
<a name="l00183"></a>00183   <span class="keywordflow">if</span>(<a class="code" href="Statistiques_8h.html#a7f6c434cd21697d3bafbdc2433f06c37">GET_COMM_DETAILS</a>)
<a name="l00184"></a>00184     <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#aeee98421824a65c16bfc1a2d7d3d124a">allocate_communication_tracking_times</a>();
<a name="l00185"></a>00185 
<a name="l00186"></a>00186 }
<a name="l00187"></a>00187 
<a name="l00188"></a><a class="code" href="mon__main_8cpp.html#a3adefe369eee13fb00171a86b31b84ff">00188</a> <span class="keywordtype">void</span> <a class="code" href="stat__counters_8cpp.html#a3adefe369eee13fb00171a86b31b84ff">end_stat_counters</a>()
<a name="l00189"></a>00189 {
<a name="l00190"></a>00190   <span class="keywordflow">if</span>(<a class="code" href="Statistiques_8h.html#a7f6c434cd21697d3bafbdc2433f06c37">GET_COMM_DETAILS</a>)
<a name="l00191"></a>00191     <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a058942e8d7a9f68ef7f1354b3bdb5a15">delete_communication_tracking_times</a>();
<a name="l00192"></a>00192 
<a name="l00193"></a>00193   <span class="keyword">delete</span>  <a class="code" href="Statistiques_8cpp.html#a512a2b3ab1289af1ee1131d49e7a0d4b">les_statistiques_trio_U_nom_long_pour_decourager_l_utilisation_directe</a>;
<a name="l00194"></a>00194   <a class="code" href="Statistiques_8cpp.html#a512a2b3ab1289af1ee1131d49e7a0d4b">les_statistiques_trio_U_nom_long_pour_decourager_l_utilisation_directe</a>=0;
<a name="l00195"></a>00195 
<a name="l00196"></a>00196 }
<a name="l00197"></a>00197 
<a name="l00198"></a>00198 <span class="comment">// Estimation du temps de latence MPI_allreduce</span>
<a name="l00199"></a><a class="code" href="stat__counters_8cpp.html#a410a9848b6bdc734b6c2946dde9f733d">00199</a> <span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code" href="stat__counters_8cpp.html#a410a9848b6bdc734b6c2946dde9f733d">estimate_allreduce</a>(<span class="keywordtype">double</span> max_bench_time)
<a name="l00200"></a>00200 {
<a name="l00201"></a>00201   <a class="code" href="classProcess.html#aa9e74a5c06a68ea38298a08ea401e7b1" title="Synchronise tous les processeurs du groupe courant&lt;br&gt;(attend que tous les processeurs soient arrives...">Process::barrier</a>();
<a name="l00202"></a>00202   <span class="keywordtype">double</span> t1 = <a class="code" href="classStatistiques.html#afce574b1c6577fa642d288f6a6bd0253" title="Cette methode renvoie un temps en secondes depuis une origine qui depend de la methode de mesure de l...">Statistiques::get_time_now</a>();
<a name="l00203"></a>00203   <span class="keywordtype">double</span> t2 = t1;
<a name="l00204"></a>00204   <span class="keywordtype">int</span> howmany = 100;
<a name="l00205"></a>00205   <span class="keywordtype">int</span> i = 0;
<a name="l00206"></a>00206   <span class="keywordflow">for</span> (i = 0; i &lt; howmany; i++)
<a name="l00207"></a>00207     <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>((<span class="keywordtype">int</span>)1);
<a name="l00208"></a>00208   t2 = <a class="code" href="classStatistiques.html#afce574b1c6577fa642d288f6a6bd0253" title="Cette methode renvoie un temps en secondes depuis une origine qui depend de la methode de mesure de l...">Statistiques::get_time_now</a>();
<a name="l00209"></a>00209   t2 = <a class="code" href="classProcess.html#a05de57db7288d95f9e67046af585d5ff" title="Calcule le min de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_min</a>(t2-t1);
<a name="l00210"></a>00210   <span class="keywordflow">return</span> t2 / (double) howmany;
<a name="l00211"></a>00211 }
<a name="l00212"></a>00212 
<a name="l00213"></a><a class="code" href="stat__counters_8cpp.html#ae1cac35c9759fce06e9c47737402267e">00213</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="stat__counters_8cpp.html#ae1cac35c9759fce06e9c47737402267e">write_stat_file</a>(<span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; msg, <span class="keyword">const</span> <a class="code" href="classStat__Results.html">Stat_Results</a>&amp; stat, <span class="keyword">const</span> <a class="code" href="classStat__Results.html">Stat_Results</a>&amp; pas_de_temps, <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a>&amp; stat_file)
<a name="l00214"></a>00214 {
<a name="l00215"></a>00215   <span class="keywordflow">if</span> (stat.<a class="code" href="classStat__Results.html#a94dd53d2de3c447c34b5ed4d7c5aae25">max_time</a>!=0)
<a name="l00216"></a>00216     {
<a name="l00217"></a>00217       stat_file &lt;&lt; <span class="stringliteral">&quot;Dont &quot;</span> &lt;&lt; msg &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l00218"></a>00218       <span class="keywordflow">if</span> (pas_de_temps.<a class="code" href="classStat__Results.html#a75a8974bd6d2cb5f01f4cc9ad3d5b8cd">max_count</a>&gt;0)
<a name="l00219"></a>00219         stat_file &lt;&lt; stat.<a class="code" href="classStat__Results.html#a94dd53d2de3c447c34b5ed4d7c5aae25">max_time</a>/pas_de_temps.<a class="code" href="classStat__Results.html#a75a8974bd6d2cb5f01f4cc9ad3d5b8cd">max_count</a>;
<a name="l00220"></a>00220       <span class="keywordflow">else</span>
<a name="l00221"></a>00221         stat_file &lt;&lt; stat.<a class="code" href="classStat__Results.html#a94dd53d2de3c447c34b5ed4d7c5aae25">max_time</a>;
<a name="l00222"></a>00222       stat_file &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; (int)(stat.<a class="code" href="classStat__Results.html#a94dd53d2de3c447c34b5ed4d7c5aae25">max_time</a>/pas_de_temps.<a class="code" href="classStat__Results.html#a94dd53d2de3c447c34b5ed4d7c5aae25">max_time</a>*100) &lt;&lt; <span class="stringliteral">&quot;%&quot;</span>;
<a name="l00223"></a>00223       <span class="keywordflow">if</span> (pas_de_temps.<a class="code" href="classStat__Results.html#a75a8974bd6d2cb5f01f4cc9ad3d5b8cd">max_count</a>&gt;0)
<a name="l00224"></a>00224         {
<a name="l00225"></a>00225           <span class="keywordtype">double</span> n = stat.<a class="code" href="classStat__Results.html#a75a8974bd6d2cb5f01f4cc9ad3d5b8cd">max_count</a>/pas_de_temps.<a class="code" href="classStat__Results.html#a75a8974bd6d2cb5f01f4cc9ad3d5b8cd">max_count</a>;
<a name="l00226"></a>00226           stat_file &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; n &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; (n==1?<span class="stringliteral">&quot;appel&quot;</span>:<span class="stringliteral">&quot;appels&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;/pas de temps)&quot;</span>;
<a name="l00227"></a>00227         }
<a name="l00228"></a>00228       stat_file &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00229"></a>00229     }
<a name="l00230"></a>00230 }
<a name="l00231"></a>00231 
<a name="l00232"></a><a class="code" href="stat__counters_8cpp.html#a3ca12afed43e5b0bcccb45836a75d31e">00232</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="stat__counters_8cpp.html#ae1cac35c9759fce06e9c47737402267e">write_stat_file</a>(<span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; msg, <span class="keyword">const</span> <a class="code" href="classStat__Results.html">Stat_Results</a>&amp; stat, <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a>&amp; stat_file)
<a name="l00233"></a>00233 {
<a name="l00234"></a>00234   <span class="keywordflow">if</span> (stat.<a class="code" href="classStat__Results.html#a94dd53d2de3c447c34b5ed4d7c5aae25">max_time</a>!=0)
<a name="l00235"></a>00235     {
<a name="l00236"></a>00236       stat_file &lt;&lt; <span class="stringliteral">&quot;Dont &quot;</span> &lt;&lt; msg &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l00237"></a>00237       stat_file &lt;&lt; stat.<a class="code" href="classStat__Results.html#a94dd53d2de3c447c34b5ed4d7c5aae25">max_time</a>;
<a name="l00238"></a>00238       stat_file &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00239"></a>00239     }
<a name="l00240"></a>00240 }
<a name="l00241"></a>00241 
<a name="l00242"></a><a class="code" href="stat__counters_8h.html#a15c34a54aac7b9ec82c9107f5c1c24fa">00242</a> <span class="keywordtype">void</span> <a class="code" href="stat__counters_8cpp.html#a15c34a54aac7b9ec82c9107f5c1c24fa">print_statistics_analyse</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="Reordonner__faces__periodiques_8cpp.html#a137d78a01e63d3b66d1b2ed0de0f4c4c">message</a>, <span class="keywordtype">int</span> mode_append)
<a name="l00243"></a>00243 {
<a name="l00244"></a>00244   assert(message);
<a name="l00245"></a>00245 
<a name="l00246"></a>00246   <a class="code" href="classStat__Results.html">Stat_Results</a> temps_total;
<a name="l00247"></a>00247   <a class="code" href="classStat__Results.html">Stat_Results</a> pas_de_temps;
<a name="l00248"></a>00248   <a class="code" href="classStat__Results.html">Stat_Results</a> solveur;
<a name="l00249"></a>00249   <a class="code" href="classStat__Results.html">Stat_Results</a> solveur_petsc;
<a name="l00250"></a>00250   <a class="code" href="classStat__Results.html">Stat_Results</a> diffusion_implicite;
<a name="l00251"></a>00251   <a class="code" href="classStat__Results.html">Stat_Results</a> dt;
<a name="l00252"></a>00252   <a class="code" href="classStat__Results.html">Stat_Results</a> nut;
<a name="l00253"></a>00253   <a class="code" href="classStat__Results.html">Stat_Results</a> convection;
<a name="l00254"></a>00254   <a class="code" href="classStat__Results.html">Stat_Results</a> diffusion;
<a name="l00255"></a>00255   <a class="code" href="classStat__Results.html">Stat_Results</a> decay;
<a name="l00256"></a>00256   <a class="code" href="classStat__Results.html">Stat_Results</a> gradient;
<a name="l00257"></a>00257   <a class="code" href="classStat__Results.html">Stat_Results</a> divergence;
<a name="l00258"></a>00258   <a class="code" href="classStat__Results.html">Stat_Results</a> source;
<a name="l00259"></a>00259   <a class="code" href="classStat__Results.html">Stat_Results</a> postraitement;
<a name="l00260"></a>00260   <a class="code" href="classStat__Results.html">Stat_Results</a> sauvegarde;
<a name="l00261"></a>00261   <a class="code" href="classStat__Results.html">Stat_Results</a> temporary;
<a name="l00262"></a>00262   <a class="code" href="classStat__Results.html">Stat_Results</a> divers;
<a name="l00263"></a>00263   <a class="code" href="classStat__Results.html">Stat_Results</a> assemblage;
<a name="l00264"></a>00264   <a class="code" href="classStat__Results.html">Stat_Results</a> update_vars;
<a name="l00265"></a>00265   <a class="code" href="classStat__Results.html">Stat_Results</a> update_fields;
<a name="l00266"></a>00266   <a class="code" href="classStat__Results.html">Stat_Results</a> mettre_a_jour;
<a name="l00267"></a>00267   <a class="code" href="classStat__Results.html">Stat_Results</a> echange_espace_virtuel;
<a name="l00268"></a>00268   <a class="code" href="classStat__Results.html">Stat_Results</a> comm_sendrecv;
<a name="l00269"></a>00269   <a class="code" href="classStat__Results.html">Stat_Results</a> comm_allreduce;
<a name="l00270"></a>00270   <a class="code" href="classStat__Results.html">Stat_Results</a> sendrecv;
<a name="l00271"></a>00271   <a class="code" href="classStat__Results.html">Stat_Results</a> marqueur1;
<a name="l00272"></a>00272   <a class="code" href="classStat__Results.html">Stat_Results</a> marqueur2;
<a name="l00273"></a>00273   <a class="code" href="classStat__Results.html">Stat_Results</a> marqueur3;
<a name="l00274"></a>00274   <a class="code" href="classStat__Results.html">Stat_Results</a> pb_fluide;
<a name="l00275"></a>00275   <a class="code" href="classStat__Results.html">Stat_Results</a> pb_combustible;
<a name="l00276"></a>00276   <a class="code" href="classStat__Results.html">Stat_Results</a> IO_seq, IO_par;
<a name="l00277"></a>00277 
<a name="l00278"></a>00278 <span class="comment">// Stop the counters</span>
<a name="l00279"></a>00279   <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a854ef63a0b657c147bb625bce97e4f4f">stop_counters</a>();
<a name="l00280"></a>00280 
<a name="l00281"></a>00281 <span class="comment">// Build the filename to print info:</span>
<a name="l00282"></a>00282   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> TU(<a class="code" href="classObjet__U.html#a7c27c4f80259eeef76ff8fe2d3bc61f7" title="Renvoie une reference constante vers le nom du cas. Cette methode est statique.">Objet_U::nom_du_cas</a>());
<a name="l00283"></a>00283   TU += <span class="stringliteral">&quot;.TU&quot;</span>;
<a name="l00284"></a>00284 
<a name="l00285"></a>00285 <span class="comment">// Print minimal infos:</span>
<a name="l00286"></a>00286   <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(temps_total_execution_counter_, temps_total);
<a name="l00287"></a>00287   <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(timestep_counter_, pas_de_temps);
<a name="l00288"></a>00288   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l00289"></a>00289     {
<a name="l00290"></a>00290 <span class="comment">// Ouverture du fichier principal (pour tous les processeurs)</span>
<a name="l00291"></a>00291       <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a> stat_file(TU,
<a name="l00292"></a>00292                          mode_append ? (ios::out | ios::app) : (ios::out));
<a name="l00293"></a>00293 
<a name="l00294"></a>00294       stat_file &lt;&lt; message &lt;&lt; <span class="stringliteral">&quot;\n\n&quot;</span>;
<a name="l00295"></a>00295       stat_file &lt;&lt; <span class="stringliteral">&quot;Temps total                       &quot;</span>
<a name="l00296"></a>00296                 &lt;&lt; temps_total.<a class="code" href="classStat__Results.html#a94dd53d2de3c447c34b5ed4d7c5aae25">max_time</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00297"></a>00297       stat_file &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00298"></a>00298     }
<a name="l00299"></a>00299 
<a name="l00300"></a>00300 <span class="comment">// If more than one time step:</span>
<a name="l00301"></a>00301   <span class="keywordflow">if</span> (pas_de_temps.<a class="code" href="classStat__Results.html#a75a8974bd6d2cb5f01f4cc9ad3d5b8cd">max_count</a> &gt; 0)
<a name="l00302"></a>00302     {
<a name="l00303"></a>00303       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(solv_sys_counter_, solveur);
<a name="l00304"></a>00304       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(solv_sys_petsc_counter_, solveur_petsc);
<a name="l00305"></a>00305       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(diffusion_implicite_counter_,
<a name="l00306"></a>00306                                diffusion_implicite);
<a name="l00307"></a>00307       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(dt_counter_, dt);
<a name="l00308"></a>00308       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(nut_counter_, nut);
<a name="l00309"></a>00309       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(convection_counter_, convection);
<a name="l00310"></a>00310       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(diffusion_counter_, diffusion);
<a name="l00311"></a>00311       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(decay_counter_, decay);
<a name="l00312"></a>00312       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(gradient_counter_, gradient);
<a name="l00313"></a>00313       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(divergence_counter_, divergence);
<a name="l00314"></a>00314       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(source_counter_, source);
<a name="l00315"></a>00315       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(postraitement_counter_, postraitement);
<a name="l00316"></a>00316       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(sauvegarde_counter_, sauvegarde);
<a name="l00317"></a>00317 
<a name="l00318"></a>00318       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(temporary_counter_, temporary);
<a name="l00319"></a>00319       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(assemblage_sys_counter_, assemblage);
<a name="l00320"></a>00320       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(update_vars_counter_, update_vars);
<a name="l00321"></a>00321       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(update_fields_counter_, update_fields);
<a name="l00322"></a>00322       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(mettre_a_jour_counter_, mettre_a_jour);
<a name="l00323"></a>00323       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(echange_vect_counter_, echange_espace_virtuel);
<a name="l00324"></a>00324       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a7f24347674a21d35dfe89f9bb1159455">get_stats_familly</a>(<span class="stringliteral">&quot;MPI_sendrecv&quot;</span>, comm_sendrecv);
<a name="l00325"></a>00325       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a7f24347674a21d35dfe89f9bb1159455">get_stats_familly</a>(<span class="stringliteral">&quot;MPI_allreduce&quot;</span>, comm_allreduce);
<a name="l00326"></a>00326       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(m1, marqueur1);
<a name="l00327"></a>00327       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(m2, marqueur2);
<a name="l00328"></a>00328       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(m3, marqueur3);
<a name="l00329"></a>00329       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(divers_counter_, divers);
<a name="l00330"></a>00330       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(probleme_fluide_, pb_fluide);
<a name="l00331"></a>00331       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(probleme_combustible_, pb_combustible);
<a name="l00332"></a>00332       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(IO_EcrireFicPartageBin_counter_, IO_seq);
<a name="l00333"></a>00333       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(IO_EcrireFicPartageMPIIO_counter_, IO_par);
<a name="l00334"></a>00334 
<a name="l00335"></a>00335       <span class="keywordflow">if</span> (<a class="code" href="Statistiques_8h.html#a7f6c434cd21697d3bafbdc2433f06c37">GET_COMM_DETAILS</a>)
<a name="l00336"></a>00336         {
<a name="l00337"></a>00337           <span class="keywordtype">int</span> nb_comm_counters = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#aaf2bb44b91707e74de0c71449f2fdc91">get_nb_comm_counters</a>();
<a name="l00338"></a>00338 
<a name="l00339"></a>00339           <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; nb_comm_counters; j++)
<a name="l00340"></a>00340             {
<a name="l00341"></a>00341               <span class="keywordtype">int</span> counter_id = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a78ae177921fa3b206e6306a0d782eb18">get_counter_id_from_index_in_comm_tracking_info</a>(j);
<a name="l00342"></a>00342               <span class="keyword">const</span> <span class="keywordtype">char</span> * familly = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a6eb7e07b408a25885a8f0fc540347e2c">get_counter_family</a>(counter_id);
<a name="l00343"></a>00343               <span class="keywordflow">if</span> (familly != 0)
<a name="l00344"></a>00344                 {
<a name="l00345"></a>00345                   <a class="code" href="classStat__Results.html">Stat_Results</a> com_j=<a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a3f4276aa8c867366d16dd5e59e6394f8">get_communication_tracking_info</a>(j, 0);
<a name="l00346"></a>00346                   <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;MPI_allreduce&quot;</span>, familly) == 0)
<a name="l00347"></a>00347                     {
<a name="l00348"></a>00348                       comm_allreduce.<a class="code" href="classStat__Results.html#a9ac46c2ac7225154b6893ac453e214ef">time</a> +=  com_j.<a class="code" href="classStat__Results.html#a9ac46c2ac7225154b6893ac453e214ef">time</a>;
<a name="l00349"></a>00349                       comm_allreduce.<a class="code" href="classStat__Results.html#a616f30fa3456aa88ed6b4c3f07c3f3d9">count</a> += com_j.<a class="code" href="classStat__Results.html#a616f30fa3456aa88ed6b4c3f07c3f3d9">count</a>;
<a name="l00350"></a>00350                       comm_allreduce.<a class="code" href="classStat__Results.html#affd1c9ac470125e25e499ca637e94f94">quantity</a> += com_j.<a class="code" href="classStat__Results.html#affd1c9ac470125e25e499ca637e94f94">quantity</a>;
<a name="l00351"></a>00351                     }
<a name="l00352"></a>00352                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;MPI_sendrecv&quot;</span>, familly) == 0)
<a name="l00353"></a>00353                     {
<a name="l00354"></a>00354                       comm_sendrecv.<a class="code" href="classStat__Results.html#a9ac46c2ac7225154b6893ac453e214ef">time</a> +=  com_j.<a class="code" href="classStat__Results.html#a9ac46c2ac7225154b6893ac453e214ef">time</a>;
<a name="l00355"></a>00355                       comm_sendrecv.<a class="code" href="classStat__Results.html#a616f30fa3456aa88ed6b4c3f07c3f3d9">count</a> += com_j.<a class="code" href="classStat__Results.html#a616f30fa3456aa88ed6b4c3f07c3f3d9">count</a>;
<a name="l00356"></a>00356                       comm_sendrecv.<a class="code" href="classStat__Results.html#affd1c9ac470125e25e499ca637e94f94">quantity</a> += com_j.<a class="code" href="classStat__Results.html#affd1c9ac470125e25e499ca637e94f94">quantity</a>;
<a name="l00357"></a>00357                     }
<a name="l00358"></a>00358                 }
<a name="l00359"></a>00359             }
<a name="l00360"></a>00360 
<a name="l00361"></a>00361           comm_allreduce.<a class="code" href="classStat__Results.html#a3a05bd3af5a7f6eac5d08c7cd4cdf3e8">compute_min_max_avg</a>();
<a name="l00362"></a>00362           comm_sendrecv.<a class="code" href="classStat__Results.html#a3a05bd3af5a7f6eac5d08c7cd4cdf3e8">compute_min_max_avg</a>();
<a name="l00363"></a>00363 
<a name="l00364"></a>00364           <span class="keywordtype">int</span> echange_espace_virtuel_id = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a9d583f199fceea865e1a064bc11ef0d4">get_counter_id_from_description</a>(<span class="stringliteral">&quot;DoubleVect/IntVect::echange_espace_virtuel&quot;</span>);
<a name="l00365"></a>00365           <span class="keywordtype">int</span> sendrecv_id = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a9d583f199fceea865e1a064bc11ef0d4">get_counter_id_from_description</a>(<span class="stringliteral">&quot;MPI_send_recv&quot;</span>);
<a name="l00366"></a>00366           <span class="keywordtype">int</span> echange_espace_virtuel_comm_id = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a74267755e9d140d541ab4e29a356da98">get_index_in_comm_tracking_info_from_counter_id</a>(echange_espace_virtuel_id);
<a name="l00367"></a>00367           <span class="keywordtype">int</span> sendrecv_comm_id = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a74267755e9d140d541ab4e29a356da98">get_index_in_comm_tracking_info_from_counter_id</a>(sendrecv_id);
<a name="l00368"></a>00368           echange_espace_virtuel = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a3f4276aa8c867366d16dd5e59e6394f8">get_communication_tracking_info</a>(echange_espace_virtuel_comm_id,0);
<a name="l00369"></a>00369           sendrecv = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a3f4276aa8c867366d16dd5e59e6394f8">get_communication_tracking_info</a>(sendrecv_comm_id,0);
<a name="l00370"></a>00370           echange_espace_virtuel.<a class="code" href="classStat__Results.html#a3a05bd3af5a7f6eac5d08c7cd4cdf3e8">compute_min_max_avg</a>();
<a name="l00371"></a>00371           sendrecv.<a class="code" href="classStat__Results.html#a3a05bd3af5a7f6eac5d08c7cd4cdf3e8">compute_min_max_avg</a>();
<a name="l00372"></a>00372 
<a name="l00373"></a>00373         }
<a name="l00374"></a>00374       <span class="keywordflow">else</span>
<a name="l00375"></a>00375         {
<a name="l00376"></a>00376           <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(echange_vect_counter_,
<a name="l00377"></a>00377                                    echange_espace_virtuel);
<a name="l00378"></a>00378           <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ab17d748f8771fe4ce1f9194348751ea6">get_stats</a>(mpi_sendrecv_counter_, sendrecv);
<a name="l00379"></a>00379 
<a name="l00380"></a>00380           <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a7f24347674a21d35dfe89f9bb1159455">get_stats_familly</a>(<span class="stringliteral">&quot;MPI_sendrecv&quot;</span>, comm_sendrecv);
<a name="l00381"></a>00381           <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a7f24347674a21d35dfe89f9bb1159455">get_stats_familly</a>(<span class="stringliteral">&quot;MPI_allreduce&quot;</span>, comm_allreduce);
<a name="l00382"></a>00382         }
<a name="l00383"></a>00383 
<a name="l00384"></a>00384       <span class="keywordtype">double</span> allreduce_peak_perf = 0.;
<a name="l00385"></a>00385 <span class="comment">// if (temps_total.max_time &gt; 10.)</span>
<a name="l00386"></a>00386       allreduce_peak_perf = <a class="code" href="stat__counters_8cpp.html#a410a9848b6bdc734b6c2946dde9f733d">estimate_allreduce</a>(0.1 <span class="comment">/* benchmark time */</span>);
<a name="l00387"></a>00387 
<a name="l00388"></a>00388 <span class="comment">// Estimation de la bande passante reseau (basee uniquement sur les operations</span>
<a name="l00389"></a>00389 <span class="comment">// send_recv_start / send_recv_finish)</span>
<a name="l00390"></a>00390 
<a name="l00391"></a>00391       <span class="keywordtype">double</span> bandwidth = 1.1e30;
<a name="l00392"></a>00392       <span class="keywordflow">if</span> (sendrecv.<a class="code" href="classStat__Results.html#a9ac46c2ac7225154b6893ac453e214ef">time</a> &gt; 0)
<a name="l00393"></a>00393         bandwidth = sendrecv.<a class="code" href="classStat__Results.html#affd1c9ac470125e25e499ca637e94f94">quantity</a> / (sendrecv.<a class="code" href="classStat__Results.html#a9ac46c2ac7225154b6893ac453e214ef">time</a> + <a class="code" href="Double_8h.html#a0a3fffa6d17ad8f7de4bb337c6266561">DMINFLOAT</a>);
<a name="l00394"></a>00394 
<a name="l00395"></a>00395       <span class="keywordtype">double</span> max_bandwidth = <a class="code" href="classProcess.html#a1e9d9f9899b71927cfafae14c7bd048d" title="Calcule le max de x sur tous les processeurs du groupe courant. Remarques : Cette methode doit etre a...">Process::mp_max</a>(bandwidth);
<a name="l00396"></a>00396 
<a name="l00397"></a>00397 <span class="comment">// Calcul du temps d&#39;attente du aux synchronisations</span>
<a name="l00398"></a>00398 <span class="comment">// On prend le temps total de communication et on retranche le temps</span>
<a name="l00399"></a>00399 <span class="comment">// theorique calcule a partir de allreduce_peak_perf et de la bande passante maxi</span>
<a name="l00400"></a>00400       <span class="keywordtype">double</span> theoric_comm_time = comm_allreduce.<a class="code" href="classStat__Results.html#a616f30fa3456aa88ed6b4c3f07c3f3d9">count</a> * allreduce_peak_perf
<a name="l00401"></a>00401                                  + comm_sendrecv.<a class="code" href="classStat__Results.html#affd1c9ac470125e25e499ca637e94f94">quantity</a> / (max_bandwidth + 1e-30);
<a name="l00402"></a>00402 <span class="comment">// Je suppose que le temps minimum pour realiser les communications sur un proc</span>
<a name="l00403"></a>00403 <span class="comment">// depend du processeur qui a le plus de donnees a envoyer:</span>
<a name="l00404"></a>00404       theoric_comm_time = <a class="code" href="classProcess.html#a1e9d9f9899b71927cfafae14c7bd048d" title="Calcule le max de x sur tous les processeurs du groupe courant. Remarques : Cette methode doit etre a...">Process::mp_max</a>(theoric_comm_time);
<a name="l00405"></a>00405 
<a name="l00406"></a>00406 
<a name="l00407"></a>00407       <span class="keywordtype">double</span> total_time_avg, total_time_max;
<a name="l00408"></a>00408       <span class="keywordflow">if</span>(<a class="code" href="Statistiques_8h.html#a1bcfabda5482a837da0f52c13f997a92">JUMP_3_FIRST_STEPS</a>)
<a name="l00409"></a>00409         {
<a name="l00410"></a>00410           total_time_avg = pas_de_temps.<a class="code" href="classStat__Results.html#a9ac46c2ac7225154b6893ac453e214ef">time</a>;
<a name="l00411"></a>00411           total_time_max = pas_de_temps.<a class="code" href="classStat__Results.html#a94dd53d2de3c447c34b5ed4d7c5aae25">max_time</a>;
<a name="l00412"></a>00412         }
<a name="l00413"></a>00413       <span class="keywordflow">else</span>
<a name="l00414"></a>00414         {
<a name="l00415"></a>00415           total_time_avg = temps_total.<a class="code" href="classStat__Results.html#a9ac46c2ac7225154b6893ac453e214ef">time</a>;
<a name="l00416"></a>00416           total_time_max = temps_total.<a class="code" href="classStat__Results.html#a94dd53d2de3c447c34b5ed4d7c5aae25">max_time</a>;
<a name="l00417"></a>00417         }
<a name="l00418"></a>00418 
<a name="l00419"></a>00419       <span class="keywordtype">double</span> wait_time = (comm_sendrecv.<a class="code" href="classStat__Results.html#a9ac46c2ac7225154b6893ac453e214ef">time</a> + comm_allreduce.<a class="code" href="classStat__Results.html#a9ac46c2ac7225154b6893ac453e214ef">time</a>)
<a name="l00420"></a>00420                          - theoric_comm_time;
<a name="l00421"></a>00421       <span class="keywordtype">double</span> wait_fraction;
<a name="l00422"></a>00422       <span class="keywordflow">if</span> (total_time_avg == 0)
<a name="l00423"></a>00423         wait_fraction = 0.;
<a name="l00424"></a>00424       <span class="keywordflow">else</span>
<a name="l00425"></a>00425         wait_fraction = wait_time / (total_time_avg + <a class="code" href="Double_8h.html#a0a3fffa6d17ad8f7de4bb337c6266561">DMINFLOAT</a>);
<a name="l00426"></a>00426       wait_fraction = 0.1 * floor(wait_fraction * 1000);
<a name="l00427"></a>00427       <span class="keywordflow">if</span> (wait_fraction &lt; 0.)
<a name="l00428"></a>00428         wait_fraction = 0.;
<a name="l00429"></a>00429       <span class="keywordflow">if</span> (wait_fraction &gt; 100.)
<a name="l00430"></a>00430         wait_fraction = 100.;
<a name="l00431"></a>00431 
<a name="l00432"></a>00432       <span class="keywordtype">double</span> max_wait_fraction = <a class="code" href="classProcess.html#a1e9d9f9899b71927cfafae14c7bd048d" title="Calcule le max de x sur tous les processeurs du groupe courant. Remarques : Cette methode doit etre a...">Process::mp_max</a>(wait_fraction);
<a name="l00433"></a>00433       <span class="keywordtype">double</span> min_wait_fraction = <a class="code" href="classProcess.html#a05de57db7288d95f9e67046af585d5ff" title="Calcule le min de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_min</a>(wait_fraction);
<a name="l00434"></a>00434       <span class="keywordtype">double</span> avg_wait_fraction = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(wait_fraction)
<a name="l00435"></a>00435                                  / <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l00436"></a>00436 
<a name="l00437"></a>00437       <span class="keywordtype">double</span> total_quantity = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(sauvegarde.<a class="code" href="classStat__Results.html#affd1c9ac470125e25e499ca637e94f94">quantity</a>);
<a name="l00438"></a>00438       <span class="keywordtype">int</span> debit_seq = IO_seq.<a class="code" href="classStat__Results.html#a94dd53d2de3c447c34b5ed4d7c5aae25">max_time</a>&gt;0 ? (int) (<a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(IO_seq.<a class="code" href="classStat__Results.html#affd1c9ac470125e25e499ca637e94f94">quantity</a>) / (1024 * 1024) / IO_seq.<a class="code" href="classStat__Results.html#a94dd53d2de3c447c34b5ed4d7c5aae25">max_time</a>) : 0;
<a name="l00439"></a>00439       <span class="keywordtype">int</span> debit_par = IO_par.<a class="code" href="classStat__Results.html#a94dd53d2de3c447c34b5ed4d7c5aae25">max_time</a>&gt;0 ? (int) (<a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(IO_par.<a class="code" href="classStat__Results.html#affd1c9ac470125e25e499ca637e94f94">quantity</a>) / (1024 * 1024) / IO_par.<a class="code" href="classStat__Results.html#a94dd53d2de3c447c34b5ed4d7c5aae25">max_time</a>) : 0;
<a name="l00440"></a>00440 
<a name="l00441"></a>00441 <span class="comment">// Print into .TU file</span>
<a name="l00442"></a>00442 
<a name="l00443"></a>00443       <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l00444"></a>00444         {
<a name="l00445"></a>00445           <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a> stat_file(TU, mode_append ? (ios::out | ios::app) : (ios::out));
<a name="l00446"></a>00446           <a class="code" href="stat__counters_8cpp.html#ae1cac35c9759fce06e9c47737402267e">write_stat_file</a>(<span class="stringliteral">&quot;probleme thermohydraulique  &quot;</span>, pb_fluide, temps_total, stat_file);
<a name="l00447"></a>00447           <a class="code" href="stat__counters_8cpp.html#ae1cac35c9759fce06e9c47737402267e">write_stat_file</a>(<span class="stringliteral">&quot;probleme combustible        &quot;</span>, pb_combustible, temps_total, stat_file);
<a name="l00448"></a>00448           stat_file &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00449"></a>00449           stat_file &lt;&lt; <span class="stringliteral">&quot;Timesteps                         &quot;</span> &lt;&lt; pas_de_temps.<a class="code" href="classStat__Results.html#a75a8974bd6d2cb5f01f4cc9ad3d5b8cd">max_count</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00450"></a>00450           stat_file &lt;&lt; <span class="stringliteral">&quot;Secondes / pas de temps           &quot;</span> &lt;&lt; pas_de_temps.<a class="code" href="classStat__Results.html#a94dd53d2de3c447c34b5ed4d7c5aae25">max_time</a> / pas_de_temps.<a class="code" href="classStat__Results.html#a75a8974bd6d2cb5f01f4cc9ad3d5b8cd">max_count</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00451"></a>00451           <a class="code" href="stat__counters_8cpp.html#ae1cac35c9759fce06e9c47737402267e">write_stat_file</a>(<span class="stringliteral">&quot;solveurs Ax=B               &quot;</span>, solveur, pas_de_temps, stat_file);
<a name="l00452"></a>00452           <a class="code" href="stat__counters_8cpp.html#ae1cac35c9759fce06e9c47737402267e">write_stat_file</a>(<span class="stringliteral">&quot;solveur diffusion_implicite &quot;</span>, diffusion_implicite, pas_de_temps, stat_file);
<a name="l00453"></a>00453           <a class="code" href="stat__counters_8cpp.html#ae1cac35c9759fce06e9c47737402267e">write_stat_file</a>(<span class="stringliteral">&quot;assemblage matrice_implicite&quot;</span>, assemblage, pas_de_temps, stat_file);
<a name="l00454"></a>00454           <a class="code" href="stat__counters_8cpp.html#ae1cac35c9759fce06e9c47737402267e">write_stat_file</a>(<span class="stringliteral">&quot;mettre_a_jour               &quot;</span>, mettre_a_jour, pas_de_temps, stat_file);
<a name="l00455"></a>00455           <a class="code" href="stat__counters_8cpp.html#ae1cac35c9759fce06e9c47737402267e">write_stat_file</a>(<span class="stringliteral">&quot;update_vars                 &quot;</span>, update_vars, pas_de_temps, stat_file);
<a name="l00456"></a>00456           <a class="code" href="stat__counters_8cpp.html#ae1cac35c9759fce06e9c47737402267e">write_stat_file</a>(<span class="stringliteral">&quot;update_fields               &quot;</span>, update_fields, pas_de_temps, stat_file);
<a name="l00457"></a>00457           <a class="code" href="stat__counters_8cpp.html#ae1cac35c9759fce06e9c47737402267e">write_stat_file</a>(<span class="stringliteral">&quot;operateurs convection       &quot;</span>, convection, pas_de_temps, stat_file);
<a name="l00458"></a>00458           <a class="code" href="stat__counters_8cpp.html#ae1cac35c9759fce06e9c47737402267e">write_stat_file</a>(<span class="stringliteral">&quot;operateurs diffusion        &quot;</span>, diffusion, pas_de_temps, stat_file);
<a name="l00459"></a>00459           <a class="code" href="stat__counters_8cpp.html#ae1cac35c9759fce06e9c47737402267e">write_stat_file</a>(<span class="stringliteral">&quot;operateurs decroissance     &quot;</span>, decay, pas_de_temps, stat_file);
<a name="l00460"></a>00460           <a class="code" href="stat__counters_8cpp.html#ae1cac35c9759fce06e9c47737402267e">write_stat_file</a>(<span class="stringliteral">&quot;operateurs gradient         &quot;</span>, gradient, pas_de_temps, stat_file);
<a name="l00461"></a>00461           <a class="code" href="stat__counters_8cpp.html#ae1cac35c9759fce06e9c47737402267e">write_stat_file</a>(<span class="stringliteral">&quot;operateurs divergence       &quot;</span>, divergence, pas_de_temps, stat_file);
<a name="l00462"></a>00462           <a class="code" href="stat__counters_8cpp.html#ae1cac35c9759fce06e9c47737402267e">write_stat_file</a>(<span class="stringliteral">&quot;operateurs source           &quot;</span>, source, pas_de_temps, stat_file);
<a name="l00463"></a>00463           <a class="code" href="stat__counters_8cpp.html#ae1cac35c9759fce06e9c47737402267e">write_stat_file</a>(<span class="stringliteral">&quot;operations postraitement    &quot;</span>, postraitement, pas_de_temps, stat_file);
<a name="l00464"></a>00464           <a class="code" href="stat__counters_8cpp.html#ae1cac35c9759fce06e9c47737402267e">write_stat_file</a>(<span class="stringliteral">&quot;calcul dt                   &quot;</span>, dt, pas_de_temps, stat_file);
<a name="l00465"></a>00465           <a class="code" href="stat__counters_8cpp.html#ae1cac35c9759fce06e9c47737402267e">write_stat_file</a>(<span class="stringliteral">&quot;modele turbulence           &quot;</span>, nut, pas_de_temps, stat_file);
<a name="l00466"></a>00466           <a class="code" href="stat__counters_8cpp.html#ae1cac35c9759fce06e9c47737402267e">write_stat_file</a>(<span class="stringliteral">&quot;operations sauvegarde       &quot;</span>, sauvegarde, pas_de_temps, stat_file);
<a name="l00467"></a>00467           <a class="code" href="stat__counters_8cpp.html#ae1cac35c9759fce06e9c47737402267e">write_stat_file</a>(<span class="stringliteral">&quot;marqueur1                   &quot;</span>, marqueur1, pas_de_temps, stat_file);
<a name="l00468"></a>00468           <a class="code" href="stat__counters_8cpp.html#ae1cac35c9759fce06e9c47737402267e">write_stat_file</a>(<span class="stringliteral">&quot;marqueur2                   &quot;</span>, marqueur2, pas_de_temps, stat_file);
<a name="l00469"></a>00469           <a class="code" href="stat__counters_8cpp.html#ae1cac35c9759fce06e9c47737402267e">write_stat_file</a>(<span class="stringliteral">&quot;marqueur3                   &quot;</span>, marqueur3, pas_de_temps, stat_file);
<a name="l00470"></a>00470           <a class="code" href="stat__counters_8cpp.html#ae1cac35c9759fce06e9c47737402267e">write_stat_file</a>(<span class="stringliteral">&quot;calcul divers               &quot;</span>, divers, pas_de_temps, stat_file);
<a name="l00471"></a>00471           <span class="keywordflow">if</span> (echange_espace_virtuel.<a class="code" href="classStat__Results.html#a75a8974bd6d2cb5f01f4cc9ad3d5b8cd">max_count</a> &gt; 0)
<a name="l00472"></a>00472             {
<a name="l00473"></a>00473               stat_file &lt;&lt; <span class="stringliteral">&quot;Nb echange_espace_virtuel / pas de temps &quot;</span>
<a name="l00474"></a>00474                         &lt;&lt; echange_espace_virtuel.<a class="code" href="classStat__Results.html#a75a8974bd6d2cb5f01f4cc9ad3d5b8cd">max_count</a> / pas_de_temps.<a class="code" href="classStat__Results.html#a75a8974bd6d2cb5f01f4cc9ad3d5b8cd">max_count</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00475"></a>00475             }
<a name="l00476"></a>00476           <span class="keywordflow">if</span> (comm_allreduce.<a class="code" href="classStat__Results.html#a75a8974bd6d2cb5f01f4cc9ad3d5b8cd">max_count</a> &gt; 0)
<a name="l00477"></a>00477             {
<a name="l00478"></a>00478               <span class="keywordtype">double</span> tmp = comm_allreduce.<a class="code" href="classStat__Results.html#a75a8974bd6d2cb5f01f4cc9ad3d5b8cd">max_count</a> / pas_de_temps.<a class="code" href="classStat__Results.html#a75a8974bd6d2cb5f01f4cc9ad3d5b8cd">max_count</a>;
<a name="l00479"></a>00479               stat_file &lt;&lt; <span class="stringliteral">&quot;Nb MPI_allreduce / pas de temps &quot;</span> &lt;&lt; tmp &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00480"></a>00480               <span class="keywordflow">if</span> (tmp &gt; 30)
<a name="l00481"></a>00481                 {
<a name="l00482"></a>00482                   stat_file
<a name="l00483"></a>00483                       &lt;&lt; <span class="stringliteral">&quot;-----------------------------------------------------------------------------------------------------------------------------------------&quot;</span>
<a name="l00484"></a>00484                       &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00485"></a>00485                   stat_file
<a name="l00486"></a>00486                       &lt;&lt; <span class="stringliteral">&quot;Warning: The number of MPI_allreduce calls per time step is high. Contact TRUST support if you plan to run massive parallel calculation.&quot;</span>
<a name="l00487"></a>00487                       &lt;&lt; finl;
<a name="l00488"></a>00488                   stat_file
<a name="l00489"></a>00489                       &lt;&lt; <span class="stringliteral">&quot;-----------------------------------------------------------------------------------------------------------------------------------------&quot;</span>
<a name="l00490"></a>00490                       &lt;&lt; finl;
<a name="l00491"></a>00491                 }
<a name="l00492"></a>00492             }
<a name="l00493"></a>00493           <span class="keywordflow">if</span> (solveur.<a class="code" href="classStat__Results.html#a75a8974bd6d2cb5f01f4cc9ad3d5b8cd">max_count</a> &gt; 0)
<a name="l00494"></a>00494             {
<a name="l00495"></a>00495               stat_file &lt;&lt; <span class="stringliteral">&quot;Nb solveur / pas de temps         &quot;</span>
<a name="l00496"></a>00496                         &lt;&lt; solveur.<a class="code" href="classStat__Results.html#a75a8974bd6d2cb5f01f4cc9ad3d5b8cd">max_count</a> / pas_de_temps.<a class="code" href="classStat__Results.html#a75a8974bd6d2cb5f01f4cc9ad3d5b8cd">max_count</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00497"></a>00497               <span class="keywordtype">double</span> avg_time = solveur.<a class="code" href="classStat__Results.html#a94dd53d2de3c447c34b5ed4d7c5aae25">max_time</a> / solveur.<a class="code" href="classStat__Results.html#a75a8974bd6d2cb5f01f4cc9ad3d5b8cd">max_count</a>;
<a name="l00498"></a>00498               stat_file &lt;&lt; <span class="stringliteral">&quot;Secondes / solveur                &quot;</span> &lt;&lt; avg_time
<a name="l00499"></a>00499                         &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00500"></a>00500               stat_file &lt;&lt; <span class="stringliteral">&quot;Iterations / solveur              &quot;</span>
<a name="l00501"></a>00501                         &lt;&lt; solveur.<a class="code" href="classStat__Results.html#aec36e8a11ca9889123bc5fc53d28b3ea">max_quantity</a> / solveur.<a class="code" href="classStat__Results.html#a75a8974bd6d2cb5f01f4cc9ad3d5b8cd">max_count</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00502"></a>00502             }
<a name="l00503"></a>00503           <span class="keywordflow">if</span> (sauvegarde.<a class="code" href="classStat__Results.html#a75a8974bd6d2cb5f01f4cc9ad3d5b8cd">max_count</a> &gt; 0)
<a name="l00504"></a>00504             {
<a name="l00505"></a>00505               <span class="keywordtype">char</span> s[20] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00506"></a>00506               stat_file &lt;&lt; <span class="stringliteral">&quot;Nb sauvegardes         : &quot;</span> &lt;&lt; sauvegarde.<a class="code" href="classStat__Results.html#a75a8974bd6d2cb5f01f4cc9ad3d5b8cd">max_count</a>
<a name="l00507"></a>00507                         &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00508"></a>00508               <span class="comment">/*              stat_file &lt;&lt; &quot;Secondes / sauvegarde  : &quot;</span>
<a name="l00509"></a>00509 <span class="comment">                                      &lt;&lt; sauvegarde.max_time / sauvegarde.max_count &lt;&lt; &quot;\n&quot;; */</span>
<a name="l00510"></a>00510               sprintf(s, <span class="stringliteral">&quot;%2.2f&quot;</span>, total_quantity / (sauvegarde.<a class="code" href="classStat__Results.html#a75a8974bd6d2cb5f01f4cc9ad3d5b8cd">max_count</a> * 1024 * 1024));
<a name="l00511"></a>00511               stat_file &lt;&lt; <span class="stringliteral">&quot;Data / sauvegarde [Mo] : &quot;</span> &lt;&lt; s &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00512"></a>00512               <span class="comment">/* stat_file &lt;&lt; &quot;Debit           [Mo/s] : &quot;</span>
<a name="l00513"></a>00513 <span class="comment">                        &lt;&lt; (int) (total_quantity / (1024 * 1024)</span>
<a name="l00514"></a>00514 <span class="comment">                                  / sauvegarde.max_time) &lt;&lt; &quot;\n&quot;; */</span>
<a name="l00515"></a>00515             }
<a name="l00516"></a>00516           stat_file &lt;&lt; <span class="stringliteral">&quot;I/O:&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00517"></a>00517           <span class="keywordflow">if</span> (debit_seq&gt;0) stat_file &lt;&lt; <span class="stringliteral">&quot;Debit write seq [Mo/s] : &quot;</span> &lt;&lt; debit_seq &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00518"></a>00518           <span class="keywordflow">if</span> (debit_par&gt;0) stat_file &lt;&lt; <span class="stringliteral">&quot;Debit write par [Mo/s] : &quot;</span> &lt;&lt; debit_par &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00519"></a>00519 
<a name="l00520"></a>00520           <span class="keywordflow">if</span> (comm_sendrecv.<a class="code" href="classStat__Results.html#a75a8974bd6d2cb5f01f4cc9ad3d5b8cd">max_count</a> &gt; 0)
<a name="l00521"></a>00521             {
<a name="l00522"></a>00522               <span class="keywordflow">if</span> (solveur_petsc.<a class="code" href="classStat__Results.html#a75a8974bd6d2cb5f01f4cc9ad3d5b8cd">max_count</a> &gt; 0)
<a name="l00523"></a>00523                 {
<a name="l00524"></a>00524                   stat_file
<a name="l00525"></a>00525                       &lt;&lt; <span class="stringliteral">&quot;---------------------------------------------------------------------------------------------------------&quot;</span>
<a name="l00526"></a>00526                       &lt;&lt; finl;
<a name="l00527"></a>00527                   stat_file
<a name="l00528"></a>00528                       &lt;&lt; <span class="stringliteral">&quot;Warning: One or several PETSc solvers are used and thus the communication time below are under-estimated.&quot;</span>
<a name="l00529"></a>00529                       &lt;&lt; finl;
<a name="l00530"></a>00530                   stat_file
<a name="l00531"></a>00531                       &lt;&lt; <span class="stringliteral">&quot;To print also the additional time spent in PETSc solvers, run the calculation with -log_summary option.&quot;</span>
<a name="l00532"></a>00532                       &lt;&lt; finl;
<a name="l00533"></a>00533                   stat_file
<a name="l00534"></a>00534                       &lt;&lt; <span class="stringliteral">&quot;---------------------------------------------------------------------------------------------------------&quot;</span>
<a name="l00535"></a>00535                       &lt;&lt; finl;
<a name="l00536"></a>00536                 }
<a name="l00537"></a>00537               <span class="keywordtype">double</span> fraction;
<a name="l00538"></a>00538               fraction = (comm_sendrecv.<a class="code" href="classStat__Results.html#a95d9ababbcf6e244207d7bec0ca67e84">avg_time</a> + comm_allreduce.<a class="code" href="classStat__Results.html#a95d9ababbcf6e244207d7bec0ca67e84">avg_time</a>)
<a name="l00539"></a>00539                          / (total_time_max + 0.001);
<a name="l00540"></a>00540               fraction = 0.1 * floor(fraction * 1000);
<a name="l00541"></a>00541               <span class="keywordflow">if</span> (fraction &gt; 100.)
<a name="l00542"></a>00542                 fraction = 100.;
<a name="l00543"></a>00543               stat_file &lt;&lt; <span class="stringliteral">&quot;Communications avg        &quot;</span> &lt;&lt; fraction
<a name="l00544"></a>00544                         &lt;&lt; <span class="stringliteral">&quot; % of total time\n&quot;</span>;
<a name="l00545"></a>00545               fraction = (comm_sendrecv.<a class="code" href="classStat__Results.html#a94dd53d2de3c447c34b5ed4d7c5aae25">max_time</a> + comm_allreduce.<a class="code" href="classStat__Results.html#a94dd53d2de3c447c34b5ed4d7c5aae25">max_time</a>)
<a name="l00546"></a>00546                          / (total_time_max + 0.001);
<a name="l00547"></a>00547               fraction = 0.1 * floor(fraction * 1000);
<a name="l00548"></a>00548               <span class="keywordflow">if</span> (fraction &gt; 100.)
<a name="l00549"></a>00549                 fraction = 100.;
<a name="l00550"></a>00550               stat_file &lt;&lt; <span class="stringliteral">&quot;Communications max        &quot;</span> &lt;&lt; fraction
<a name="l00551"></a>00551                         &lt;&lt; <span class="stringliteral">&quot; % of total time\n&quot;</span>;
<a name="l00552"></a>00552               fraction = (comm_sendrecv.<a class="code" href="classStat__Results.html#adf949d6c6658bccf46a263be04686a7a">min_time</a> + comm_allreduce.<a class="code" href="classStat__Results.html#adf949d6c6658bccf46a263be04686a7a">min_time</a>)
<a name="l00553"></a>00553                          / (total_time_max + 0.001);
<a name="l00554"></a>00554               fraction = 0.1 * floor(fraction * 1000);
<a name="l00555"></a>00555               stat_file &lt;&lt; <span class="stringliteral">&quot;Communications min        &quot;</span> &lt;&lt; fraction
<a name="l00556"></a>00556                         &lt;&lt; <span class="stringliteral">&quot; % of total time\n&quot;</span>;
<a name="l00557"></a>00557 
<a name="l00558"></a>00558               stat_file &lt;&lt; <span class="stringliteral">&quot;Network latency benchmark &quot;</span>;
<a name="l00559"></a>00559               <span class="keywordflow">if</span> (allreduce_peak_perf == 0.)
<a name="l00560"></a>00560                 stat_file
<a name="l00561"></a>00561                     &lt;&lt; <span class="stringliteral">&quot;not measured (total running time too short &lt;10s)\n&quot;</span>;
<a name="l00562"></a>00562               <span class="keywordflow">else</span>
<a name="l00563"></a>00563                 stat_file &lt;&lt; allreduce_peak_perf &lt;&lt; <span class="stringliteral">&quot; s\n&quot;</span>;
<a name="l00564"></a>00564 
<a name="l00565"></a>00565               stat_file &lt;&lt; <span class="stringliteral">&quot;Network bandwidth max     &quot;</span>
<a name="l00566"></a>00566                         &lt;&lt; max_bandwidth * 1.e-6 &lt;&lt; <span class="stringliteral">&quot; MB/s\n&quot;</span>;
<a name="l00567"></a>00567               stat_file &lt;&lt; <span class="stringliteral">&quot;Total network traffic     &quot;</span>
<a name="l00568"></a>00568                         &lt;&lt; comm_sendrecv.<a class="code" href="classStat__Results.html#a26d15e661803c10b0be24f02b5b6f978">avg_quantity</a> * <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>()
<a name="l00569"></a>00569                         / pas_de_temps.<a class="code" href="classStat__Results.html#a75a8974bd6d2cb5f01f4cc9ad3d5b8cd">max_count</a> * 1e-6
<a name="l00570"></a>00570                         &lt;&lt; <span class="stringliteral">&quot; MB / timestep\n&quot;</span>;
<a name="l00571"></a>00571               stat_file &lt;&lt; <span class="stringliteral">&quot;Average message size      &quot;</span>
<a name="l00572"></a>00572                         &lt;&lt; comm_sendrecv.<a class="code" href="classStat__Results.html#a26d15e661803c10b0be24f02b5b6f978">avg_quantity</a> / comm_sendrecv.<a class="code" href="classStat__Results.html#ac0bc2b3429e4545adcbb753c3edcdb44">avg_count</a>
<a name="l00573"></a>00573                         * 1e-3 &lt;&lt; <span class="stringliteral">&quot; kB\n&quot;</span>;
<a name="l00574"></a>00574               stat_file &lt;&lt; <span class="stringliteral">&quot;Min waiting time          &quot;</span> &lt;&lt; min_wait_fraction
<a name="l00575"></a>00575                         &lt;&lt; <span class="stringliteral">&quot; % of total time\n&quot;</span>;
<a name="l00576"></a>00576               stat_file &lt;&lt; <span class="stringliteral">&quot;Max waiting time          &quot;</span> &lt;&lt; max_wait_fraction
<a name="l00577"></a>00577                         &lt;&lt; <span class="stringliteral">&quot; % of total time\n&quot;</span>;
<a name="l00578"></a>00578               stat_file &lt;&lt; <span class="stringliteral">&quot;Avg waiting time          &quot;</span> &lt;&lt; avg_wait_fraction
<a name="l00579"></a>00579                         &lt;&lt; <span class="stringliteral">&quot; % of total time\n&quot;</span>;
<a name="l00580"></a>00580             }
<a name="l00581"></a>00581           stat_file &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00582"></a>00582           stat_file &lt;&lt; <span class="stringliteral">&quot;Timesteps = number of time steps\n&quot;</span>;
<a name="l00583"></a>00583           stat_file
<a name="l00584"></a>00584               &lt;&lt; <span class="stringliteral">&quot;Nb solveur = number of linear system resolutions\n&quot;</span>;
<a name="l00585"></a>00585           stat_file
<a name="l00586"></a>00586               &lt;&lt; <span class="stringliteral">&quot;Nb assemblage implicite = number of matrix assemblies for the implicit scheme\n&quot;</span>;
<a name="l00587"></a>00587           stat_file &lt;&lt; <span class="stringliteral">&quot;Iterations = average number of iterations of the solver\n&quot;</span>;
<a name="l00588"></a>00588           stat_file &lt;&lt; <span class="stringliteral">&quot;Communications = fraction of the time spent\n&quot;</span>;
<a name="l00589"></a>00589           stat_file
<a name="l00590"></a>00590               &lt;&lt; <span class="stringliteral">&quot;                 in communications between processors (excluding io files)\n&quot;</span>;
<a name="l00591"></a>00591           stat_file
<a name="l00592"></a>00592               &lt;&lt; <span class="stringliteral">&quot;Network latency = time of one mpsum measured by an internal bench over 0.1s\n&quot;</span>;
<a name="l00593"></a>00593           stat_file
<a name="l00594"></a>00594               &lt;&lt; <span class="stringliteral">&quot;Network bandwidth = maximum on all processors\n&quot;</span>;
<a name="l00595"></a>00595           stat_file
<a name="l00596"></a>00596               &lt;&lt; <span class="stringliteral">&quot;                    of the average bandwidth of send_recv operations\n&quot;</span>;
<a name="l00597"></a>00597           stat_file
<a name="l00598"></a>00598               &lt;&lt; <span class="stringliteral">&quot;Waiting time = estimation of the waiting time of the different processors\n\n&quot;</span>;
<a name="l00599"></a>00599           stat_file
<a name="l00600"></a>00600               &lt;&lt; <span class="stringliteral">&quot;Max_waiting_time big    =&gt; probably due to a bad partitioning\n&quot;</span>;
<a name="l00601"></a>00601           stat_file
<a name="l00602"></a>00602               &lt;&lt; <span class="stringliteral">&quot;Communications &gt; 30%    =&gt; too many processors or network too slow\n&quot;</span>;
<a name="l00603"></a>00603           stat_file &lt;&lt; finl;
<a name="l00604"></a>00604         }
<a name="l00605"></a>00605     }
<a name="l00606"></a>00606 <span class="comment">// Restart counters</span>
<a name="l00607"></a>00607   <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a9c05facd54b457e522edda7a77273e35">restart_counters</a>();
<a name="l00608"></a>00608 }
<a name="l00609"></a>00609 
<a name="l00610"></a>00610 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:28 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
