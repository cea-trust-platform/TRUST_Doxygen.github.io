<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: Solv_Petsc Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a>  </div>
  <div class="headertitle">
<div class="title">Solv_Petsc Class Reference</div>  </div>
</div>
<div class="contents">
<!-- doxytag: class="Solv_Petsc" --><!-- doxytag: inherits="SolveurSys_base" -->
<p><code>#include &lt;<a class="el" href="Solv__Petsc_8h_source.html">Solv_Petsc.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for Solv_Petsc:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classSolv__Petsc.png" usemap="#Solv_Petsc_map" alt=""/>
  <map id="Solv_Petsc_map" name="Solv_Petsc_map">
<area href="classSolveurSys__base.html" alt="SolveurSys_base" shape="rect" coords="60,112,171,136"/>
<area href="classObjet__U.html" title="classe Objet_U Cette classe est la classe de base des Objets de TRUST Dans les classes derivees de Ob..." alt="Objet_U" shape="rect" coords="60,56,171,80"/>
<area href="classProcess.html" title="Classe de base de TRUST (notamment Objet_U). Elle fournit quelques services de base accessibles de pa..." alt="Process" shape="rect" coords="60,0,171,24"/>
<area href="classSolv__AMGX.html" alt="Solv_AMGX" shape="rect" coords="0,224,111,248"/>
<area href="classSolv__Petsc__GPU.html" alt="Solv_Petsc_GPU" shape="rect" coords="121,224,232,248"/>
</map>
 </div></div>

<p><a href="classSolv__Petsc-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#a7bd2dfc9c0015eb7f0c6d395ab3216a8">taille_memoire</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#ae31a0568a126e0f38a6b3e961212c3b1">duplique</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="classType__info.html">Type_info</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#a5891704b11f18edf6ee99605a27d42c5">get_info</a> () const </td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Donne des informations sur le type de l'Objet_U.  <a href="#a5891704b11f18edf6ee99605a27d42c5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#a4e84a4f162efc695050b42614f156f18">Solv_Petsc</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#aba11b53a67c1aa8de4833ed5618a1855">~Solv_Petsc</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#a72437dd540e559da6f6827747036b920">solveur_direct</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#a93bea0874ab4fd2b24d063370db00dbe">resoudre_systeme</a> (const <a class="el" href="classMatrice__Base.html">Matrice_Base</a> &amp;, const <a class="el" href="classDoubleVect.html">DoubleVect</a> &amp;, <a class="el" href="classDoubleVect.html">DoubleVect</a> &amp;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#a0058b2973d709356eaf749c067bfcf9b">resoudre_systeme</a> (const <a class="el" href="classMatrice__Base.html">Matrice_Base</a> &amp;M, const <a class="el" href="classDoubleVect.html">DoubleVect</a> &amp;A, <a class="el" href="classDoubleVect.html">DoubleVect</a> &amp;B, int niter_max)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#a35a8ad922fb450f5b693f9ce1e31875c">create_solver</a> (<a class="el" href="classEntree.html">Entree</a> &amp;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#a34cc0b975e06dc6df27f2cc6d89da2dd">reset</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#aaea15e1fc789f7ab84b759b11e73b314">read_matrix</a> () const </td></tr>
<tr><td colspan="2"><h2><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classObjet__U.html">Objet_U</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#a1dcbcf1f662e6b6fcb02186c0d3a23bc">cree_instance</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="classType__info.html">Type_info</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#a087b00129cb3d32c0dc80b82448cc0b3">info</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Donne des informations sur le type de l'Objet_U.  <a href="#a087b00129cb3d32c0dc80b82448cc0b3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classSolv__Petsc.html">Solv_Petsc</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#a2342bd9d6104c4b2b3bad510c80dfa62">self_cast</a> (<a class="el" href="classObjet__U.html">Objet_U</a> &amp;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="classSolv__Petsc.html">Solv_Petsc</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#a43744d82ddacef9206d3ff4110d87a0e">self_cast</a> (const <a class="el" href="classObjet__U.html">Objet_U</a> &amp;)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">methode ajoutee pour caster en python  <a href="#a43744d82ddacef9206d3ff4110d87a0e"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="classType__info.html">Type_info</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#ad42f3219e151e30710029b64f9f3b5b7">info_obj</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#a7384c2681936b980c3fa393793e47e87">instance</a> = -1</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Nombre d'instances en cours de la classe.  <a href="#a7384c2681936b980c3fa393793e47e87"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#acc3475bd78fb4ceace2d10ff68de1dd8">numero_solveur</a> = 0</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Compte les solveurs crees et utilises pour le prefix des options.  <a href="#acc3475bd78fb4ceace2d10ff68de1dd8"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="classSortie.html">Sortie</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#adceae0b645dc68471855a23b96529ee9">printOn</a> (<a class="el" href="classSortie.html">Sortie</a> &amp;x) const </td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Ecriture de l'objet sur un flot de sortie<br/>
Methode a surcharger.  <a href="#adceae0b645dc68471855a23b96529ee9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="classEntree.html">Entree</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#a43058b9e8c6070b68572b20eaafc1a39">readOn</a> (<a class="el" href="classEntree.html">Entree</a> &amp;)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Lecture d'un <a class="el" href="classObjet__U.html" title="classe Objet_U Cette classe est la classe de base des Objets de TRUST Dans les classes derivees de Ob...">Objet_U</a> sur un flot d'entree<br/>
Methode a surcharger.  <a href="#a43058b9e8c6070b68572b20eaafc1a39"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="classNom.html">Nom</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#af626ce7ac5babfaf8333057766ac15cf">config</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> du fichier de config eventuel.  <a href="#af626ce7ac5babfaf8333057766ac15cf"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#aa05df5e1a45d2e1edff22af140336a05">solveur_direct_</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Pour savoir si l'on manipule un solveur direct et non iteratif.  <a href="#aa05df5e1a45d2e1edff22af140336a05"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classNom.html">Nom</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#a7a8cc27d5092ae780209ddb0059a2e29">chaine_lue_</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Chaine des mots cles lus.  <a href="#a7a8cc27d5092ae780209ddb0059a2e29"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#a9c92c7b3025ccb3f301489141a442211">read_matrix_</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Read constant matrix in a file.  <a href="#a9c92c7b3025ccb3f301489141a442211"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#a5f603c229087d42c8bb2fee48290526f">gpu_</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Utilisation des solveurs GPU de PETSc.  <a href="#a5f603c229087d42c8bb2fee48290526f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#a4a4d7d01f00900e4c2ad771be5e6725b">amgx_</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Utilisation des solveurs GPU de AMGX.  <a href="#a4a4d7d01f00900e4c2ad771be5e6725b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#a7244784294055ac6cd06c16d5d7264e7">amgx_initialized_</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Amgx initialise Options dev:  <a href="#a7244784294055ac6cd06c16d5d7264e7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#a1d87d8f7f3be6d318bc343e11059cde2">ignore_new_nonzero_</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#a895816a337ad6bc6fcdfb82037e6a837">rebuild_matrix_</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#a45df7a11f976ea94cbb622ae8fcbd181">allow_realloc_</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSolv__Petsc.html#af13cee34da6194e79945d3a950ee2ed0">clean_matrix_</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="Solv__Petsc_8h_source.html#l00046">46</a> of file <a class="el" href="Solv__Petsc_8h_source.html">Solv_Petsc.h</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a4e84a4f162efc695050b42614f156f18"></a><!-- doxytag: member="Solv_Petsc::Solv_Petsc" ref="a4e84a4f162efc695050b42614f156f18" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Solv_Petsc::Solv_Petsc </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Solv__Petsc_8h_source.html#l00176">176</a> of file <a class="el" href="Solv__Petsc_8h_source.html">Solv_Petsc.h</a>.</p>

<p>References <a class="el" href="Solv__Petsc_8h_source.html#l00095">instance</a>, and <a class="el" href="Solv__Petsc_8h_source.html#l00162">read_matrix_</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="classSolv__Petsc.html#a9c92c7b3025ccb3f301489141a442211" title="Read constant matrix in a file.">read_matrix_</a>=0;
<span class="preprocessor">#ifdef PETSCKSP_H</span>
<span class="preprocessor"></span>  initialize();
  <a class="code" href="classSolv__Petsc.html#a7384c2681936b980c3fa393793e47e87" title="Nombre d&#39;instances en cours de la classe.">instance</a>++;
<span class="comment">// Journal()&lt;&lt;&quot;creation solv_petsc &quot;&lt;&lt;instance&lt;&lt;finl;</span>
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div>
</div>
</div>
<a class="anchor" id="aba11b53a67c1aa8de4833ed5618a1855"></a><!-- doxytag: member="Solv_Petsc::~Solv_Petsc" ref="aba11b53a67c1aa8de4833ed5618a1855" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Solv_Petsc::~Solv_Petsc </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Solv__Petsc_8h_source.html#l00186">186</a> of file <a class="el" href="Solv__Petsc_8h_source.html">Solv_Petsc.h</a>.</p>

<p>References <a class="el" href="Solv__Petsc_8h_source.html#l00095">instance</a>, and <a class="el" href="Solv__Petsc_8h_source.html#l00192">reset()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="classSolv__Petsc.html#a34cc0b975e06dc6df27f2cc6d89da2dd">reset</a>();
  <a class="code" href="classSolv__Petsc.html#a7384c2681936b980c3fa393793e47e87" title="Nombre d&#39;instances en cours de la classe.">instance</a>--;
<span class="comment">// Journal()&lt;&lt;&quot; destr solv_petsc &quot;&lt;&lt;instance&lt;&lt;finl;</span>
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="af626ce7ac5babfaf8333057766ac15cf"></a><!-- doxytag: member="Solv_Petsc::config" ref="af626ce7ac5babfaf8333057766ac15cf" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classNom.html">Nom</a> Solv_Petsc::config </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><a class="el" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> du fichier de config eventuel. </p>

<p>Definition at line <a class="el" href="Solv__Petsc_8cpp_source.html#l01310">1310</a> of file <a class="el" href="Solv__Petsc_8cpp_source.html">Solv_Petsc.cpp</a>.</p>

<p>References <a class="el" href="Solv__Petsc_8h_source.html#l00164">amgx_</a>, <a class="el" href="Solv__Petsc_8h_source.html#l00095">instance</a>, and <a class="el" href="Objet__U_8cpp_source.html#l00310">Objet_U::nom_du_cas()</a>.</p>

<p>Referenced by <a class="el" href="Solv__Petsc_8cpp_source.html#l00087">create_solver()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> str(<a class="code" href="classObjet__U.html#a7c27c4f80259eeef76ff8fe2d3bc61f7" title="Renvoie une reference constante vers le nom du cas. Cette methode est statique.">Objet_U::nom_du_cas</a>());
  str+=<span class="stringliteral">&quot;_solver&quot;</span>;
  str+=(<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>)<a class="code" href="classSolv__Petsc.html#a7384c2681936b980c3fa393793e47e87" title="Nombre d&#39;instances en cours de la classe.">instance</a>;
  str+=<a class="code" href="classSolv__Petsc.html#a4a4d7d01f00900e4c2ad771be5e6725b" title="Utilisation des solveurs GPU de AMGX.">amgx_</a> ? <span class="stringliteral">&quot;.amgx&quot;</span> : <span class="stringliteral">&quot;.petsc&quot;</span>;
  <span class="keywordflow">return</span> str;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a35a8ad922fb450f5b693f9ce1e31875c"></a><!-- doxytag: member="Solv_Petsc::create_solver" ref="a35a8ad922fb450f5b693f9ce1e31875c" args="(Entree &amp;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Solv_Petsc::create_solver </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classEntree.html">Entree</a> &amp;&#160;</td>
          <td class="paramname"><em>entree</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Solv__Petsc_8cpp_source.html#l00087">87</a> of file <a class="el" href="Solv__Petsc_8cpp_source.html">Solv_Petsc.cpp</a>.</p>

<p>References <a class="el" href="Solv__Petsc_8h_source.html#l00170">allow_realloc_</a>, <a class="el" href="Solv__Petsc_8h_source.html#l00164">amgx_</a>, <a class="el" href="EntreeSortie_8h_source.html#l00032">Cerr</a>, <a class="el" href="Solv__Petsc_8cpp_source.html#l00066">check_not_defined()</a>, <a class="el" href="Solv__Petsc_8h_source.html#l00044">cholmod</a>, <a class="el" href="Solv__Petsc_8h_source.html#l00171">clean_matrix_</a>, <a class="el" href="Solv__Petsc_8h_source.html#l00044">cli</a>, <a class="el" href="Solv__Petsc_8cpp_source.html#l01310">config()</a>, <a class="el" href="PE__Groups_8h_source.html#l00054">PE_Groups::current_group()</a>, <a class="el" href="Solv__Petsc_8h_source.html#l00306">option::defined</a>, <a class="el" href="Objet__U_8h_source.html#l00079">Objet_U::dimension</a>, <a class="el" href="Objet__U_8h_source.html#l00115">Objet_U::disable_TU</a>, <a class="el" href="Double_8h_source.html#l00072">DMAXFLOAT</a>, <a class="el" href="Entree__Fichier__base_8cpp_source.html#l00128">Entree_Fichier_base::eof()</a>, <a class="el" href="Process_8cpp_source.html#l00223">Process::exit()</a>, <a class="el" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>, <a class="el" href="SolveurSys__base_8h_source.html#l00047">SolveurSys_base::fixer_limpr()</a>, <a class="el" href="Entree__Fichier__base_8cpp_source.html#l00057">Entree_Fichier_base::get_ifstream()</a>, <a class="el" href="PE__Groups_8cpp_source.html#l00187">PE_Groups::get_nb_groups()</a>, <a class="el" href="Solv__Petsc_8h_source.html#l00163">gpu_</a>, <a class="el" href="Solv__Petsc_8h_source.html#l00168">ignore_new_nonzero_</a>, <a class="el" href="Process_8cpp_source.html#l00095">Process::je_suis_maitre()</a>, <a class="el" href="SolveurSys__base_8h_source.html#l00056">SolveurSys_base::limpr()</a>, <a class="el" href="Solv__Petsc_8h_source.html#l00044">mumps</a>, <a class="el" href="Solv__Petsc_8h_source.html#l00307">option::name</a>, <a class="el" href="Solv__Petsc_8h_source.html#l00174">NB_IT_MAX_DEFINED</a>, <a class="el" href="Objet__U_8cpp_source.html#l00310">Objet_U::nom_du_cas()</a>, <a class="el" href="Objet__U_8cpp_source.html#l00445">Objet_U::nommer()</a>, <a class="el" href="Process_8cpp_source.html#l00109">Process::nproc()</a>, <a class="el" href="Solv__Petsc_8h_source.html#l00096">numero_solveur</a>, <a class="el" href="Solv__Petsc_8h_source.html#l00044">pastix</a>, <a class="el" href="Solv__Petsc_8h_source.html#l00044">petsc</a>, <a class="el" href="Solv__Petsc_8h_source.html#l00162">read_matrix_</a>, <a class="el" href="Solv__Petsc_8h_source.html#l00169">rebuild_matrix_</a>, <a class="el" href="Cast_8h_source.html#l00059">ref_cast</a>, <a class="el" href="SolveurSys__base_8h_source.html#l00099">SolveurSys_base::save_matrice_</a>, <a class="el" href="Motcle_8cpp_source.html#l00538">Motcles::search()</a>, <a class="el" href="Cast_8h_source.html#l00054">sub_type</a>, <a class="el" href="Solv__Petsc_8h_source.html#l00044">superlu_dist</a>, <a class="el" href="Solv__Petsc_8h_source.html#l00044">umfpack</a>, <a class="el" href="Source__Generique__Face__PolyMAC_8cpp_source.html#l00045">valeur()</a>, <a class="el" href="Solv__Petsc_8h_source.html#l00320">option_string::value()</a>, <a class="el" href="Solv__Petsc_8h_source.html#l00336">option_int::value()</a>, and <a class="el" href="Solv__Petsc_8h_source.html#l00352">option_double::value()</a>.</p>

<p>Referenced by <a class="el" href="Solv__Petsc__GPU_8cpp_source.html#l00035">Solv_Petsc_GPU::readOn()</a>, <a class="el" href="Solv__Petsc_8cpp_source.html#l00060">readOn()</a>, and <a class="el" href="Solv__AMGX_8cpp_source.html#l00036">Solv_AMGX::readOn()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (<a class="code" href="classSolv__Petsc.html#a4a4d7d01f00900e4c2ad771be5e6725b" title="Utilisation des solveurs GPU de AMGX.">amgx_</a>) <a class="code" href="Solv__Petsc_8cpp.html#ab3f078684998b83967d507d0f453f454">verbose</a> = <span class="keyword">true</span>;
<span class="preprocessor">#ifdef PETSCKSP_H</span>
<span class="preprocessor"></span>  lecture(entree);
  <a class="code" href="classEChaine.html" title="Une entree dont la source est une chaine de caracteres. Le constructeur cree sa propre copie de la ch...">EChaine</a> is(get_chaine_lue());

  <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> accolade_ouverte(<span class="stringliteral">&quot;{&quot;</span>);
  <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> accolade_fermee(<span class="stringliteral">&quot;}&quot;</span>);
  <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> pc(<span class="stringliteral">&quot;&quot;</span>);
  <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> motlu;
  <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> ksp;
  is &gt;&gt; ksp;   <span class="comment">//!&lt; On lit le solveur en premier puis les options du solveur: PETSC ksp { ... }</span>
<span class="comment"></span>  is &gt;&gt; motlu; <span class="comment">//!&lt; On lit l&#39;accolade</span>
<span class="comment"></span>  <span class="keywordflow">if</span> (motlu != accolade_ouverte)
    {
      <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error while reading the parameters of the solver of PETSC &quot;</span> &lt;&lt; ksp &lt;&lt; <span class="stringliteral">&quot; { ... }&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
      <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;We expected &quot;</span> &lt;&lt; accolade_ouverte &lt;&lt; <span class="stringliteral">&quot; instead of &quot;</span> &lt;&lt; motlu &lt;&lt; finl;
      <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
    }
<span class="comment">// Verification si Petsc est bien initialise (permet d&#39;eviter un crash en sequentiel sur les machines batch)</span>
  PetscBool isInitialized;
  PetscInitialized(&amp;isInitialized);
  <span class="keywordflow">if</span> (!isInitialized)
    {
      <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;On this queuing system cluster, you need to use mpirun even on sequential mode&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
      <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;(mpirun -np 1 ...) with a PETSc solver or the calculation will crash. &quot;</span> &lt;&lt; finl;
      <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;You can use the trust script as a workaround:&quot;</span> &lt;&lt; finl;
      <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;trust &quot;</span> &lt;&lt; <a class="code" href="classObjet__U.html#a7c27c4f80259eeef76ff8fe2d3bc61f7" title="Renvoie une reference constante vers le nom du cas. Cette methode est statique.">nom_du_cas</a>() &lt;&lt; finl;
      <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
    }

<span class="comment">// Creation du solveur et association avec le preconditionneur</span>
  <span class="keywordflow">if</span> (option_prefix_==<span class="stringliteral">&quot;??&quot;</span>) <span class="comment">//!&lt; Prefix non fixe</span>
<span class="comment"></span>    {
      <a class="code" href="classSolv__Petsc.html#acc3475bd78fb4ceace2d10ff68de1dd8" title="Compte les solveurs crees et utilises pour le prefix des options.">numero_solveur</a>++;
      option_prefix_=<span class="stringliteral">&quot;&quot;</span>;
      <span class="keywordflow">if</span> (<a class="code" href="classSolv__Petsc.html#acc3475bd78fb4ceace2d10ff68de1dd8" title="Compte les solveurs crees et utilises pour le prefix des options.">numero_solveur</a> &gt; 1)
        {
<span class="comment">// On cree un prefix pour les options si plus d&#39;un solveur pour les differencier. Exemple:</span>
<span class="comment">// premier solveur -ksp_type ... -pc_type ...</span>
<span class="comment">// deuxieme solveur -solver2_ksp_type ... -solver2_pc-type ...</span>
<span class="comment">// troisieme solveur -solveur3_ksp_type ...</span>
          option_prefix_ += <span class="stringliteral">&quot;solver&quot;</span>;
          option_prefix_ += (<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>) <a class="code" href="classSolv__Petsc.html#acc3475bd78fb4ceace2d10ff68de1dd8" title="Compte les solveurs crees et utilises pour le prefix des options.">numero_solveur</a>;
          option_prefix_ += <span class="stringliteral">&quot;_&quot;</span>;
        }
    }

  <span class="comment">/************************/</span>
  <span class="comment">/* Set PETSC_COMM_WORLD */</span>
  <span class="comment">/************************/</span>
<span class="comment">// Recuperation du communicateur du groupe courant</span>
<span class="preprocessor">#ifdef MPI_</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classComm__Group__MPI.html" title=": Classe Comm_Group_MPI, derivee de la classe abstraite Comm_Group. Cette classe represente un groupe...">Comm_Group_MPI</a>,<a class="code" href="classPE__Groups.html#ae6ca0277a58f2ab34ebfb3216578fa75" title="renvoie une reference au groupe de processeurs actif courant">PE_Groups::current_group</a>()))
    PETSC_COMM_WORLD = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classComm__Group__MPI.html" title=": Classe Comm_Group_MPI, derivee de la classe abstraite Comm_Group. Cette classe represente un groupe...">Comm_Group_MPI</a>,<a class="code" href="classPE__Groups.html#ae6ca0277a58f2ab34ebfb3216578fa75" title="renvoie une reference au groupe de processeurs actif courant">PE_Groups::current_group</a>()).get_mpi_comm();
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
  KSPCreate(PETSC_COMM_WORLD, &amp;SolveurPetsc_);
  KSPGetPC(SolveurPetsc_, &amp;PreconditionneurPetsc_);

<span class="comment">// Add options if PETSc solver is used:</span>
  <span class="keywordflow">if</span> (<a class="code" href="classPE__Groups.html#a6fe714bb78ca65d4731c8b95db492172">PE_Groups::get_nb_groups</a>()==1 &amp;&amp; !<a class="code" href="classObjet__U.html#a622f9039952e1be36aee2ac0c48955fc" title="Flag to disable the writing of the .TU files.">disable_TU</a> )
    {
<span class="comment">// _petsc.TU is only printed if one group calculation (e.g. Execute_parallel failed)</span>
      <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> petsc_TU(<span class="stringliteral">&quot;:&quot;</span>);
      petsc_TU+=<a class="code" href="classObjet__U.html#a7c27c4f80259eeef76ff8fe2d3bc61f7" title="Renvoie une reference constante vers le nom du cas. Cette methode est statique.">nom_du_cas</a>();
      petsc_TU+=<span class="stringliteral">&quot;_petsc.TU&quot;</span>;
      add_option(<span class="stringliteral">&quot;log_view&quot;</span>,petsc_TU);  <span class="comment">//!&lt; Monitor performances at the end of the calculation</span>
<span class="comment"></span>      PetscLogAllBegin();               <span class="comment">//!&lt; Necessary cause if not Event logs not printed in petsc_TU file ... I don&#39;t know why...</span>
<span class="comment"></span>    }
<span class="preprocessor">#ifdef NDEBUG</span>
<span class="preprocessor"></span><span class="comment">// PETSc 3.14 active par defaut les exceptions, on desactive en production ?</span>
<span class="comment">// PetscSetFPTrap(PETSC_FP_TRAP_OFF);</span>
<span class="comment">// Utiliser -fp_trap 0 a l&#39;execution plutot: Segfault vu sur petsc gmres { precond diag ... }</span>
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span><span class="comment">// add_option(&quot;on_error_abort&quot;,&quot;&quot;); // ne marche pas semble t&#39;il</span>
<span class="comment">// On doit pouvoir lire des mots cles de base (GCP, GMRES, CHOLESKY)</span>
<span class="comment">// mais egalement pouvoir appeler les options Petsc avec une chaine { -ksp_type cg -pc_type sor ... }</span>
<span class="comment">// Les options non reconnues doivent arreter le code</span>
<span class="comment">// Reprendre le formalisme de GCP { precond ssor { omega val } seuil val }</span>
  <a class="code" href="classMotcles.html" title="Un tableau d&#39;objets de la classe Motcle.">Motcles</a> les_solveurs(20);
  {
    les_solveurs[0] = <span class="stringliteral">&quot;CLI&quot;</span>;
    les_solveurs[1] = <span class="stringliteral">&quot;GCP&quot;</span>;
    les_solveurs[2] = <span class="stringliteral">&quot;GMRES&quot;</span>;
    les_solveurs[3] = <span class="stringliteral">&quot;CHOLESKY&quot;</span>;
    les_solveurs[4] = <span class="stringliteral">&quot;CHOLESKY_OUT_OF_CORE&quot;</span>;
    les_solveurs[5] = <span class="stringliteral">&quot;BICGSTAB&quot;</span>;
    les_solveurs[6] = <span class="stringliteral">&quot;IBICGSTAB&quot;</span>;
    les_solveurs[7] = <span class="stringliteral">&quot;CHOLESKY_SUPERLU&quot;</span>;
    les_solveurs[8] = <span class="stringliteral">&quot;PGMRES&quot;</span>;
    les_solveurs[9] = <span class="stringliteral">&quot;LU&quot;</span>;
    les_solveurs[10] = <span class="stringliteral">&quot;PIPECG&quot;</span>;
    les_solveurs[11] = <span class="stringliteral">&quot;CHOLESKY_LAPACK&quot;</span>;
    les_solveurs[12] = <span class="stringliteral">&quot;CHOLESKY_UMFPACK&quot;</span>;
    les_solveurs[13] = <span class="stringliteral">&quot;CHOLESKY_PASTIX&quot;</span>;
    les_solveurs[14] = <span class="stringliteral">&quot;CLI_VERBOSE&quot;</span>;
    les_solveurs[15] = <span class="stringliteral">&quot;CLI_QUIET&quot;</span>;
    les_solveurs[16] = <span class="stringliteral">&quot;CHOLESKY_MUMPS_BLR&quot;</span>;
    les_solveurs[17] = <span class="stringliteral">&quot;CHOLESKY_CHOLMOD&quot;</span>;
    les_solveurs[18] = <span class="stringliteral">&quot;PIPECG2&quot;</span>;
    les_solveurs[19] = <span class="stringliteral">&quot;FGMRES&quot;</span>;
  }
  <span class="keywordtype">int</span> solver_supported_on_gpu_by_petsc=0;
  <span class="keywordtype">int</span> solver_supported_on_gpu_by_amgx=0;
  <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> amgx_option=<span class="stringliteral">&quot;&quot;</span>;
  <span class="keywordtype">int</span> rang=les_solveurs.search(ksp);
  <a class="code" href="classObjet__U.html#a469dbcad1d4a98a67e4246dce8e264ad" title="Donne un nom a l&#39;Objet_U Methode virtuelle a surcharger.">nommer</a>(les_solveurs[rang]);
  <span class="keywordflow">switch</span>(rang)
    {
    <span class="keywordflow">case</span> 0:
    <span class="keywordflow">case</span> 14:
    <span class="keywordflow">case</span> 15:
      {
        <span class="keywordflow">if</span> (rang == 15) <a class="code" href="classSolveurSys__base.html#a987e97740c779c1ab4192c3c1f1bbd5d">fixer_limpr</a>(-1);  <span class="comment">//!&lt; Quiet</span>
<span class="comment"></span>        <span class="keywordflow">else</span> <a class="code" href="classSolveurSys__base.html#a987e97740c779c1ab4192c3c1f1bbd5d">fixer_limpr</a>(1); <span class="comment">//!&lt; On imprime le residu</span>
<span class="comment"></span>        solver_supported_on_gpu_by_petsc=1; <span class="comment">//!&lt; Not really, reserved to expert...</span>
<span class="comment"></span>        solver_supported_on_gpu_by_amgx=1;  <span class="comment">//!&lt; Not really, reserved to expert...</span>
<span class="comment"></span>        <span class="keywordflow">if</span> (<a class="code" href="classSolveurSys__base.html#ab3ef68bcf4e1b402c52905aa78728aef">limpr</a>() &gt;= 0) <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Reading of the &quot;</span> &lt;&lt; (<a class="code" href="classSolv__Petsc.html#a4a4d7d01f00900e4c2ad771be5e6725b" title="Utilisation des solveurs GPU de AMGX.">amgx_</a> ? <span class="stringliteral">&quot;AmgX&quot;</span> : <span class="stringliteral">&quot;Petsc&quot;</span>) &lt;&lt; <span class="stringliteral">&quot; commands:&quot;</span> &lt;&lt; finl;
        <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> <a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>;
        is &gt;&gt; motlu;
        <span class="keywordflow">if</span> (<a class="code" href="classSolv__Petsc.html#a4a4d7d01f00900e4c2ad771be5e6725b" title="Utilisation des solveurs GPU de AMGX.">amgx_</a>)
          {
            <span class="keywordflow">while</span> (motlu!=accolade_fermee)
              {
<span class="comment">// -config file.json</span>
                <span class="keywordflow">if</span> (motlu == <span class="stringliteral">&quot;-file&quot;</span>)
                  {
                    is &gt;&gt; motlu;
                    <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
                      {
                        <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Reading AmgX config file &quot;</span> &lt;&lt; motlu &lt;&lt; <span class="stringliteral">&quot; :&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
                        <a class="code" href="classEFichier.html" title="Fichier en lecture Cette classe est a la classe C++ ifstream ce que la classe Entree est a la classe ...">EFichier</a> config_amgx(motlu);
                        std::string line;
                        <span class="keywordflow">while</span> (!config_amgx.eof())
                          {
                            std::getline(config_amgx.get_ifstream(), line);
                            <span class="keywordflow">if</span> (line.find(<span class="stringliteral">&quot;#&quot;</span>) &amp;&amp; line.find(<span class="stringliteral">&quot;config_version&quot;</span>))
                              {
                                <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; line.c_str() &lt;&lt; finl;
                                amgx_option+=line.c_str();
                                amgx_option+=<span class="stringliteral">&quot;\n&quot;</span>;
                              }
                          }
                      }
                  }
                <span class="keywordflow">else</span>
                  {
                    amgx_option += motlu;
                    amgx_option += <span class="stringliteral">&quot;\n&quot;</span>;
                  }
                is &gt;&gt; motlu;
              }
          }
        <span class="keywordflow">else</span>
          <span class="keywordflow">while</span> (motlu!=accolade_fermee)
            {
              is &gt;&gt; <a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>;
<span class="comment">// &quot;-option val&quot; ou &quot;-option&quot; ?</span>
              <span class="keywordflow">if</span> (valeur.debute_par(<span class="stringliteral">&quot;-&quot;</span>) || valeur==accolade_fermee)
                {
                  add_option(motlu.suffix(<span class="stringliteral">&quot;-&quot;</span>), <span class="stringliteral">&quot;&quot;</span>, 1);
                  motlu = <a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>;
                }
              <span class="keywordflow">else</span>
                {
                  <span class="keywordflow">if</span> (motlu == <span class="stringliteral">&quot;-ksp_type&quot;</span> &amp;&amp; valeur==<span class="stringliteral">&quot;preonly&quot;</span>) <a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6">solveur_direct_</a>=<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6a1ff272a9a5361e482e6748be5e449bbd">cli</a>; <span class="comment">//!&lt; Activate direct solveur if using -ksp_preonly ...</span>
<span class="comment"></span>                  add_option(motlu.suffix(<span class="stringliteral">&quot;-&quot;</span>), <a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>, 1);
                  is &gt;&gt; motlu;
                }
            }
<span class="comment">// Pour faciliter le debugage:</span>
        <span class="keywordflow">if</span> (rang == 14) <span class="comment">//!&lt; Verbose</span>
<span class="comment"></span>          {
            add_option(<span class="stringliteral">&quot;ksp_view&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
            add_option(<span class="stringliteral">&quot;options_view&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
            add_option(<span class="stringliteral">&quot;options_left&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
          }

        <span class="keywordflow">break</span>;
      }
    <span class="keywordflow">case</span> 1:
      {
        KSPSetType(SolveurPetsc_, KSPCG);
<span class="comment">// Residu=||Ax-b|| comme dans TRUST pour GCP sinon on ne peut comparer les convergences</span>
        KSPSetNormType(SolveurPetsc_, KSP_NORM_UNPRECONDITIONED);
<span class="comment">// Merge the two inner products needed in CG into a single MPI_Allreduce() call:</span>
<span class="comment">// Gain interessant a partir de 4000 coeurs</span>
        <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>()&gt;=4000)
          {
<span class="comment">// add_option(&quot;ksp_cg_single_reduction&quot;,&quot;&quot;); Pour Petsc &lt; 3.3, la fonction KSPCGUseSingleReduction n&#39;etait pas disponible</span>
            KSPCGUseSingleReduction(SolveurPetsc_,(PetscBool)1);
          }
<span class="comment">// But It requires two extra work vectors than the conventional implementation in PETSc.</span>
        solver_supported_on_gpu_by_petsc=1;
        solver_supported_on_gpu_by_amgx=1;
        <span class="keywordflow">if</span> (<a class="code" href="classSolv__Petsc.html#a4a4d7d01f00900e4c2ad771be5e6725b" title="Utilisation des solveurs GPU de AMGX.">amgx_</a>) amgx_option+=<span class="stringliteral">&quot;solver(s)=PCG\n&quot;</span>; <span class="comment">//!&lt; CG avec preconditionnement if (amgx_) amgx_option+=&quot;solver(s)=PCGF\n&quot;; // Flexible CG avec preconditionnement</span>
<span class="comment"></span><span class="comment">//</span>
        <span class="keywordflow">break</span>;
      }
    <span class="keywordflow">case</span> 10:
      {
        KSPSetType(SolveurPetsc_, KSPPIPECG);
<span class="comment">// Residu=||Ax-b|| comme dans TRUST pour GCP sinon on ne peut comparer les convergences</span>
        KSPSetNormType(SolveurPetsc_, KSP_NORM_UNPRECONDITIONED);
        <span class="keywordflow">break</span>;
      }
    <span class="keywordflow">case</span> 18:
      {
        KSPSetType(SolveurPetsc_, KSPPIPECG2);
<span class="comment">// Residu=||Ax-b|| comme dans TRUST pour GCP sinon on ne peut comparer les convergences</span>
        KSPSetNormType(SolveurPetsc_, KSP_NORM_UNPRECONDITIONED);
        <span class="keywordflow">break</span>;
      }
    <span class="keywordflow">case</span> 2:
      {
        KSPSetType(SolveurPetsc_, KSPGMRES);
<span class="comment">// Le preconditionnement a droite permet que le residu utilise pour la convergence</span>
<span class="comment">// soit le residu reel ||Ax-b|| et non le residu preconditionne pour certains solveurs</span>
<span class="comment">// avec un preconditionnement a gauche (ex: GMRES). Ainsi, on peut comparer strictement</span>
<span class="comment">// les performances des solveurs (TRUST ou PETSC) entre eux</span>
        KSPSetPCSide(SolveurPetsc_, PC_RIGHT);
        KSPSetNormType(SolveurPetsc_, KSP_NORM_UNPRECONDITIONED);
        solver_supported_on_gpu_by_petsc=1;
        solver_supported_on_gpu_by_amgx=1;
        <span class="keywordflow">if</span> (<a class="code" href="classSolv__Petsc.html#a4a4d7d01f00900e4c2ad771be5e6725b" title="Utilisation des solveurs GPU de AMGX.">amgx_</a>)
          {
            amgx_option+=<span class="stringliteral">&quot;solver(s)=GMRES\n&quot;</span>; <span class="comment">//!&lt; GMRES</span>
<span class="comment"></span>            <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>(<span class="stringliteral">&quot;Gmres solver on GPU with AmgX fails to return a valid solution. Try GCP, BiCGSTAB or FGMRES solvers.&quot;</span>);
          }
        <span class="keywordflow">break</span>;
      }
    <span class="keywordflow">case</span> 19:
      {
        KSPSetType(SolveurPetsc_, KSPFGMRES);
        KSPSetPCSide(SolveurPetsc_, PC_RIGHT);
        KSPSetNormType(SolveurPetsc_, KSP_NORM_UNPRECONDITIONED);
        solver_supported_on_gpu_by_petsc=1;
        solver_supported_on_gpu_by_amgx=1;
        <span class="keywordflow">if</span> (<a class="code" href="classSolv__Petsc.html#a4a4d7d01f00900e4c2ad771be5e6725b" title="Utilisation des solveurs GPU de AMGX.">amgx_</a>) amgx_option+=<span class="stringliteral">&quot;solver(s)=FGMRES\n&quot;</span>; <span class="comment">//!&lt; FGMRES</span>
<span class="comment"></span>        <span class="keywordflow">break</span>;
      }
    <span class="keywordflow">case</span> 8:
      {
        KSPSetType(SolveurPetsc_, KSPPGMRES);
<span class="comment">// PGMRES ne peut etre que preconditionne a gauche (CAx=Cb)</span>
<span class="comment">// et on ne peut avoir que le residu preconditionne (||CAx-Cb||)</span>
<span class="comment">// -&gt; on ne peut comparer la convergence avec le GMRES...</span>
        KSPSetPCSide(SolveurPetsc_, PC_LEFT);
<span class="comment">// KSPSetNormType(SolveurPetsc, KSP_NORM_UNPRECONDITIONED);</span>
        solver_supported_on_gpu_by_petsc=1;
        <span class="keywordflow">break</span>;
      }
    <span class="keywordflow">case</span> 3:
    <span class="keywordflow">case</span> 4:
    <span class="keywordflow">case</span> 9:
    <span class="keywordflow">case</span> 16:
      {
<span class="comment">// Si MUMPS est present, on le prend par defaut (solveur_direct_=1) sinon SuperLU (solveur_direct_=2):</span>
<span class="preprocessor">#ifdef PETSC_HAVE_MUMPS</span>
<span class="preprocessor"></span>        <a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6">solveur_direct_</a> = <a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6a1cb49f862e7fcd552eed7f0145c86db1">mumps</a>;
<span class="comment">// Ajout de l&#39;option</span>
<span class="comment">// Par defaut le cas PAR_Canal_incline_VEF plante sur 4 processeurs si -mat_mumps_icntl_14 inferieur a 35...</span>
<span class="comment">// On revient a 75 car parfois VEF_258 plante... C&#39;est pas clair au niveau memoire...</span>
<span class="comment">// Passage a Petsc 3.3 necessite d&#39;augmenter a plus de 75 car sinon Aero_192 crashe...</span>
<span class="comment">// A 90, le cas les_Re180Pr071_T0Q_jdd2 plante sur forchat (32bits)</span>
<span class="comment">// On differencie sequentiel (peu de memoire, mais estimation juste)</span>
<span class="comment">// et le calcul parallele (voir peut etre une separation entre plus et moins de 16 processeurs...)</span>
<span class="comment">// Peut etre equiper le script trust d&#39;une detection des erreurs INFO(1)=-9 ...</span>
<span class="comment">// On passe de 35 a 40 pour faire passer le cas cavite_entrainee_2D_jdd2 (suite passage a MUMPS 5.2.0)</span>
        <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>() == 1)
          add_option(<span class="stringliteral">&quot;mat_mumps_icntl_14&quot;</span>, <span class="stringliteral">&quot;40&quot;</span>);
        <span class="keywordflow">else</span>
          add_option(<span class="stringliteral">&quot;mat_mumps_icntl_14&quot;</span>, <span class="stringliteral">&quot;90&quot;</span>);

<span class="comment">// Option out_of_core</span>
        <span class="keywordflow">if</span> (rang == 4) add_option(<span class="stringliteral">&quot;mat_mumps_icntl_22&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>);

<span class="comment">// Option BLR</span>
        <span class="keywordflow">if</span> (rang == 16)
          {
            <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>
                &lt;&lt; <span class="stringliteral">&quot;Activating BLR factorization. For more info, see http://mumps.enseeiht.fr/doc/userguide_5.1.2.pdf (page 18, 51, 52).&quot;</span>
                &lt;&lt; finl;
            add_option(<span class="stringliteral">&quot;mat_mumps_icntl_35&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>);
          }
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>        <a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6">solveur_direct_</a>=<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6ae182fa5e69fe3b70815223024f19cd1b">superlu_dist</a>;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        KSPSetType(SolveurPetsc_, KSPPREONLY);
        <span class="keywordflow">break</span>;
      }
    <span class="keywordflow">case</span> 5:
      {
        KSPSetType(SolveurPetsc_, KSPBCGS);
        solver_supported_on_gpu_by_petsc=1;
        solver_supported_on_gpu_by_amgx=1;
<span class="comment">// if (amgx_) amgx_option+=&quot;solver(s)=BICGSTAB\n&quot;; // BICGSTAB sans preconditionnement</span>
        <span class="keywordflow">if</span> (<a class="code" href="classSolv__Petsc.html#a4a4d7d01f00900e4c2ad771be5e6725b" title="Utilisation des solveurs GPU de AMGX.">amgx_</a>) amgx_option+=<span class="stringliteral">&quot;solver(s)=PBICGSTAB\n&quot;</span>; <span class="comment">//!&lt; BICGSTAB avec precondtionnement</span>
<span class="comment"></span>        <span class="keywordflow">break</span>;
      }
    <span class="keywordflow">case</span> 6:
      {
        KSPSetType(SolveurPetsc_, KSPIBCGS); <span class="comment">//!&lt; 1 point de synchro au lieu de 3 pour KSPBCGS Pour optimiser encore les comms, voir: http://www.mcs.anl.gov/petsc/petsc-as/snapshots/petsc-3.0.0/docs/manualpages/KSP/KSPIBCGS.html</span>
<span class="comment"></span><span class="comment">//</span>
<span class="comment">//</span>
        KSPSetLagNorm(SolveurPetsc_, PETSC_TRUE);
        <span class="keywordflow">break</span>;
      }
    <span class="keywordflow">case</span> 7:
      {
        <a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6">solveur_direct_</a>=<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6ae182fa5e69fe3b70815223024f19cd1b">superlu_dist</a>;
<span class="comment">// SuperLU_dist, parallel but not faster than MUMPS</span>
<span class="preprocessor">#ifdef PETSC_HAVE_OPENMP</span>
<span class="preprocessor"></span><span class="comment">// Version GPU disponible de SuperLU si OpenMP active (necessaire)</span>
        solver_supported_on_gpu_by_petsc=1;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        KSPSetType(SolveurPetsc_, KSPPREONLY);
        <span class="keywordflow">break</span>;
      }
    <span class="keywordflow">case</span> 11:
      {
        <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>()&gt;1) <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>(<span class="stringliteral">&quot;Cholesky_lapack can&#39;t be used for parallel calculation.&quot;</span>);
        <a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6">solveur_direct_</a>=<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6aaf77cfaeac95d5bb680e1b2603d23ae1">petsc</a>;
<span class="comment">// Lapack, old and slow (non pas vrai sur petites matrices d&#39;ordre 100 - 10000 !)</span>
        add_option(<span class="stringliteral">&quot;pc_factor_nonzeros_along_diagonal&quot;</span>, <span class="stringliteral">&quot;&quot;</span>); <span class="comment">//!&lt; Moins robuste que MUMPS pour un pivot nul donc on reordonne pour eviter</span>
<span class="comment"></span>        KSPSetType(SolveurPetsc_, KSPPREONLY);
        <span class="keywordflow">break</span>;
      }
    <span class="keywordflow">case</span> 12:
      {
        <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>()&gt;1) <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>(<span class="stringliteral">&quot;Cholesky_umfpack can&#39;t be used for parallel calculation.&quot;</span>);
        <a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6">solveur_direct_</a>=<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6ad25605924f9b1643dcc298a4eba5a84f">umfpack</a>;
<span class="comment">// Umfpack, sequential only but fast...</span>
        KSPSetType(SolveurPetsc_, KSPPREONLY);
<span class="comment">// more robustness</span>
        add_option(<span class="stringliteral">&quot;mat_umfpack_pivot_tolerance&quot;</span>,<span class="stringliteral">&quot;1.0&quot;</span>);
        <span class="keywordflow">break</span>;
      }
    <span class="keywordflow">case</span> 13:
      {
        <a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6">solveur_direct_</a>=<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6aa663c1c6ebfd318f067db896735d4481">pastix</a>;
<span class="comment">// Pastix supports sbaij but seems slow...</span>
        KSPSetType(SolveurPetsc_, KSPPREONLY);
        <span class="keywordflow">break</span>;
      }
    <span class="keywordflow">case</span> 17:
      {
        <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>()&gt;1) <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>(<span class="stringliteral">&quot;Cholesky_cholmod can&#39;t be used for parallel calculation.&quot;</span>);
        <a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6">solveur_direct_</a>=<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6abc3895945aa136c66ea71a53a6fae6c7">cholmod</a>;
<span class="comment">// Cholmod Cholesky (pas LU), sequentiel, supporte multi-GPU</span>
        <span class="keywordflow">if</span> (!matrice_symetrique_)
          {
            <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; ksp &lt;&lt; <span class="stringliteral">&quot; is only supported for symmetric linear system.&quot;</span> &lt;&lt; finl;
            <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
          }
        solver_supported_on_gpu_by_petsc=1;
        KSPSetType(SolveurPetsc_, KSPPREONLY);
        <span class="keywordflow">break</span>;
      }
    <span class="keywordflow">default</span>:
      {
        <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; ksp &lt;&lt; <span class="stringliteral">&quot; : solver not officially recognized by TRUST among those possible for the moment:&quot;</span> &lt;&lt; finl;
        <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; les_solveurs &lt;&lt; finl;
        <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;You can try to access directly to Petsc solvers with the command line:&quot;</span> &lt;&lt; finl;
        <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;PETSC CLI { -ksp_type solver_name -pc_type preconditioning_name -ksp_atol threshold -ksp_monitor }&quot;</span> &lt;&lt; finl;
        <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;See the reference manual for all Petsc options.&quot;</span> &lt;&lt; finl;
        <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
      }
    }

<span class="comment">// On verifie que le solveur est supporte sur GPU:</span>
  <span class="keywordflow">if</span> (<a class="code" href="classSolv__Petsc.html#a5f603c229087d42c8bb2fee48290526f" title="Utilisation des solveurs GPU de PETSc.">gpu_</a>)
    {
<span class="preprocessor">#ifdef PETSC_HAVE_CUDA</span>
<span class="preprocessor"></span>      <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;GPU capabilities of PETSc will be used.&quot;</span> &lt;&lt; finl;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>      <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;You can not use petsc_gpu keyword cause GPU&quot;</span> &lt;&lt; finl;
      <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;capabilities will not work on your workstation with PETSc.&quot;</span> &lt;&lt; finl;
      <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Check if you have a NVidia video card and its driver up to date.&quot;</span> &lt;&lt; finl;
      <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Check petsc.log file under $TRUST_ROOT/lib/src/LIBPETSC for more details.&quot;</span> &lt;&lt; finl;
      <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>      <span class="keywordflow">if</span> (solver_supported_on_gpu_by_petsc==0)
        {
          <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; les_solveurs[rang] &lt;&lt; <span class="stringliteral">&quot; is not supported yet by PETSc on GPU.&quot;</span> &lt;&lt; finl;
          <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
        }
    }
  <span class="keywordflow">if</span> (<a class="code" href="classSolv__Petsc.html#a4a4d7d01f00900e4c2ad771be5e6725b" title="Utilisation des solveurs GPU de AMGX.">amgx_</a>)
    {
<span class="preprocessor">#ifdef PETSC_HAVE_CUDA</span>
<span class="preprocessor"></span>      <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;GPU capabilities of AmgX will be used.&quot;</span> &lt;&lt; finl;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>      <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;You can not use amgx keyword cause GPU&quot;</span> &lt;&lt; finl;
      <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;capabilities will not work on your workstation with AmgX.&quot;</span> &lt;&lt; finl;
      <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Check if you have a NVidia video card and its driver up to date.&quot;</span> &lt;&lt; finl;
      <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Check petsc.log file under $TRUST_ROOT/lib/src/LIBPETSC for more details.&quot;</span> &lt;&lt; finl;
      <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>      <span class="keywordflow">if</span> (solver_supported_on_gpu_by_amgx==0)
        {
          <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; les_solveurs[rang] &lt;&lt; <span class="stringliteral">&quot; is not supported yet by AmgX on GPU.&quot;</span> &lt;&lt; finl;
          <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
        }
    }

  <span class="keywordtype">int</span> convergence_with_seuil=0; <span class="comment">//!&lt; Keyword to check the convergence via seuil or nb_it_max On continue a lire</span>
<span class="comment"></span><span class="comment">//</span>
  <span class="keywordflow">if</span> (motlu==accolade_ouverte)
    {
<span class="comment">// Temporaire essayer de faire converger les noms de parametres des differentes solveurs (GCP, GMRES,...)</span>
      <a class="code" href="classMotcles.html" title="Un tableau d&#39;objets de la classe Motcle.">Motcles</a> les_parametres_solveur(27);
      {
        les_parametres_solveur[0] = <span class="stringliteral">&quot;impr&quot;</span>;
        les_parametres_solveur[1] = <span class="stringliteral">&quot;seuil&quot;</span>; <span class="comment">//!&lt; Seuil absolu (atol)</span>
<span class="comment"></span>        les_parametres_solveur[2] = <span class="stringliteral">&quot;precond&quot;</span>;
        les_parametres_solveur[3] = <span class="stringliteral">&quot;precond_nul&quot;</span>; <span class="comment">//!&lt; To accept the TRUST syntax</span>
<span class="comment"></span>        les_parametres_solveur[4] = <span class="stringliteral">&quot;nb_it_max&quot;</span>;
        les_parametres_solveur[5] = <span class="stringliteral">&quot;save_matrix_petsc_format&quot;</span>;
        les_parametres_solveur[6] = <span class="stringliteral">&quot;factored_matrix&quot;</span>; <span class="comment">//!&lt; Experimental</span>
<span class="comment"></span>        les_parametres_solveur[7] = <span class="stringliteral">&quot;read_matrix&quot;</span>;
        les_parametres_solveur[8] = <span class="stringliteral">&quot;controle_residu&quot;</span>;
        les_parametres_solveur[9] = <span class="stringliteral">&quot;cli&quot;</span>;
        les_parametres_solveur[10] = <span class="stringliteral">&quot;ordering&quot;</span>;
        les_parametres_solveur[11] = <span class="stringliteral">&quot;petsc_decide&quot;</span>; <span class="comment">//!&lt; Experimental</span>
<span class="comment"></span>        les_parametres_solveur[12] = <span class="stringliteral">&quot;aij&quot;</span>;
        les_parametres_solveur[13] = <span class="stringliteral">&quot;nb_cpus&quot;</span>;
        les_parametres_solveur[14] = <span class="stringliteral">&quot;divtol&quot;</span>;
        les_parametres_solveur[15] = <span class="stringliteral">&quot;save_matrice|save_matrix&quot;</span>;
        les_parametres_solveur[16] = <span class="stringliteral">&quot;quiet&quot;</span>;
        les_parametres_solveur[17] = <span class="stringliteral">&quot;restart&quot;</span>;
        les_parametres_solveur[18] = <span class="stringliteral">&quot;cli_verbose&quot;</span>;
        les_parametres_solveur[19] = <span class="stringliteral">&quot;dropping_parameter&quot;</span>;
        les_parametres_solveur[20] = <span class="stringliteral">&quot;rtol&quot;</span>; <span class="comment">//!&lt; Seuil relatif</span>
<span class="comment"></span>        les_parametres_solveur[21] = <span class="stringliteral">&quot;atol&quot;</span>; <span class="comment">//!&lt; Seuil absolu &lt;=&gt; seuil</span>
<span class="comment"></span>        les_parametres_solveur[22] = <span class="stringliteral">&quot;ignore_new_nonzero&quot;</span>;
        les_parametres_solveur[23] = <span class="stringliteral">&quot;rebuild_matrix&quot;</span>;
        les_parametres_solveur[24] = <span class="stringliteral">&quot;allow_realloc&quot;</span>;
        les_parametres_solveur[25] = <span class="stringliteral">&quot;clean_matrix&quot;</span>;
        les_parametres_solveur[26] = <span class="stringliteral">&quot;save_matrix_mtx_format&quot;</span>;
      }
      <a class="code" href="classoption__double.html">option_double</a> omega(<span class="stringliteral">&quot;omega&quot;</span>,1.5);
      <a class="code" href="classoption__int.html">option_int</a>    level(<span class="stringliteral">&quot;level&quot;</span>,1);
      <a class="code" href="classoption__double.html">option_double</a> epsilon(<span class="stringliteral">&quot;epsilon&quot;</span>,0.1);
      <a class="code" href="classoption__string.html">option_string</a> ordering(<span class="stringliteral">&quot;ordering&quot;</span>,(<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>)<span class="stringliteral">&quot;&quot;</span>);
      controle_residu_=0;

      is &gt;&gt; motlu;
      <span class="keywordflow">while</span> (motlu!=accolade_fermee)
        {
          <span class="keywordflow">switch</span>(les_parametres_solveur.search(motlu))
            {
            <span class="keywordflow">case</span> 16:
              {
                <a class="code" href="classSolveurSys__base.html#a987e97740c779c1ab4192c3c1f1bbd5d">fixer_limpr</a>(-1);
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 0:
              {
                <a class="code" href="classSolveurSys__base.html#a987e97740c779c1ab4192c3c1f1bbd5d">fixer_limpr</a>(1);
<span class="comment">// Si MUMPS on ajoute des impressions sur la decomposition</span>
                <span class="keywordflow">if</span> (<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6">solveur_direct_</a>==<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6a1cb49f862e7fcd552eed7f0145c86db1">mumps</a>)
                  add_option(<span class="stringliteral">&quot;mat_mumps_icntl_4&quot;</span>,<span class="stringliteral">&quot;3&quot;</span>);
                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6">solveur_direct_</a>==<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6ae182fa5e69fe3b70815223024f19cd1b">superlu_dist</a>)
                  add_option(<span class="stringliteral">&quot;mat_superlu_dist_statprint&quot;</span>,<span class="stringliteral">&quot;&quot;</span>);
                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6">solveur_direct_</a>==<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6aaf77cfaeac95d5bb680e1b2603d23ae1">petsc</a>)
                  {}
                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6">solveur_direct_</a>==<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6ad25605924f9b1643dcc298a4eba5a84f">umfpack</a>)
                  add_option(<span class="stringliteral">&quot;mat_umfpack_prl&quot;</span>,<span class="stringliteral">&quot;2&quot;</span>);
                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6">solveur_direct_</a>==<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6aa663c1c6ebfd318f067db896735d4481">pastix</a>)
                  add_option(<span class="stringliteral">&quot;mat_pastix_verbose&quot;</span>,<span class="stringliteral">&quot;2&quot;</span>);
                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6">solveur_direct_</a>==<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6abc3895945aa136c66ea71a53a6fae6c7">cholmod</a>)
                  add_option(<span class="stringliteral">&quot;mat_cholmod_print&quot;</span>,<span class="stringliteral">&quot;3&quot;</span>);
                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6">solveur_direct_</a>)
                  {
                    <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;impr not coded yet for this direct solver.&quot;</span> &lt;&lt; finl;
                    <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
                  }
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 1:
            <span class="keywordflow">case</span> 21:
              {
                <span class="keywordflow">if</span> (<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6">solveur_direct_</a>)
                  {
                    <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Definition of &quot;</span> &lt;&lt; les_parametres_solveur(les_parametres_solveur.search(motlu)) &lt;&lt; <span class="stringliteral">&quot; is useless for a direct method.&quot;</span> &lt;&lt; finl;
                    <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Suppress the keyword.&quot;</span> &lt;&lt; finl;
                    <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
                  }
                is &gt;&gt; seuil_;
                convergence_with_seuil=1;
                <span class="keywordflow">if</span> (<a class="code" href="classSolv__Petsc.html#a4a4d7d01f00900e4c2ad771be5e6725b" title="Utilisation des solveurs GPU de AMGX.">amgx_</a>)
                  {
                    amgx_option+=<span class="stringliteral">&quot;s:convergence=ABSOLUTE\ns:tolerance=&quot;</span>;
                    amgx_option+=<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(seuil_,<span class="stringliteral">&quot;%e&quot;</span>)+<span class="stringliteral">&quot;\n&quot;</span>;
                  }
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 2:
              {
                is &gt;&gt; pc;
                is &gt;&gt; motlu;
                <span class="keywordflow">if</span> (motlu != accolade_ouverte)
                  {
                    <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error while reading the parameters of the PETSC preconditioner: precond &quot;</span> &lt;&lt; pc &lt;&lt; <span class="stringliteral">&quot; { ... }&quot;</span> &lt;&lt; finl;
                    <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;We expected &quot;</span> &lt;&lt; accolade_ouverte &lt;&lt; <span class="stringliteral">&quot; instead of &quot;</span> &lt;&lt; motlu &lt;&lt; finl;
                    <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
                  }
                is &gt;&gt; motlu;
                <span class="keywordflow">while</span> (motlu!=accolade_fermee)
                  {
                    <a class="code" href="classMotcles.html" title="Un tableau d&#39;objets de la classe Motcle.">Motcles</a> les_parametres_precond(4);
                    {
                      les_parametres_precond[0] = omega.name;
                      les_parametres_precond[1] = level.name;
                      les_parametres_precond[2] = epsilon.name;
                      les_parametres_precond[3] = ordering.name;
                    }
                    <span class="keywordtype">double</span> tmp_int;
                    <span class="keywordtype">double</span> tmp_double;
                    <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> tmp_string;
                    <span class="keywordflow">switch</span>(les_parametres_precond.search(motlu))
                      {
                      <span class="keywordflow">case</span> 0:
                        {
                          is &gt;&gt; tmp_double;
                          omega.value()=tmp_double;
                          omega.defined=1;
                          <span class="keywordflow">break</span>;
                        }
                      <span class="keywordflow">case</span> 1:
                        {
                          is &gt;&gt; tmp_int   ;
                          level.value()=(int)tmp_int;
                          level.defined=1;
                          <span class="keywordflow">if</span> (<a class="code" href="classSolv__Petsc.html#a4a4d7d01f00900e4c2ad771be5e6725b" title="Utilisation des solveurs GPU de AMGX.">amgx_</a>)
                            {
                              <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> ilu_sparsity_level=<span class="stringliteral">&quot;p:ilu_sparsity_level=&quot;</span>;
                              ilu_sparsity_level+=(<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>)level.value();
                              amgx_option+=ilu_sparsity_level+<span class="stringliteral">&quot;\n&quot;</span>;
                              <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> coloring_level=<span class="stringliteral">&quot;p:coloring_level=&quot;</span>; <span class="comment">//!&lt; 1 par defaut</span>
<span class="comment"></span>                              coloring_level+=<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(level.value()+1);    <span class="comment">//!&lt; Doit valoir ilu_sparsity_level+1 pour MULTICOLOT_INU (voir AmgX reference guide)</span>
<span class="comment"></span>                              amgx_option+=coloring_level+<span class="stringliteral">&quot;\n&quot;</span>;
                            }
                          <span class="keywordflow">break</span>;
                        }
                      <span class="keywordflow">case</span> 2:
                        {
                          is &gt;&gt; tmp_double;
                          epsilon.value()=tmp_double;
                          epsilon.defined=1;
                          <span class="keywordflow">break</span>;
                        }
                      <span class="keywordflow">case</span> 3:
                        {
                          is &gt;&gt; tmp_string;
                          ordering.value()=tmp_string;
                          ordering.defined=1;
                          <span class="keywordflow">break</span>;
                        }
                      <span class="keywordflow">default</span>:
                        {
                          <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; motlu &lt;&lt; <span class="stringliteral">&quot; : unrecognized option among all of those possible on Petsc preconditioner:&quot;</span> &lt;&lt; finl;
                          <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; les_parametres_precond &lt;&lt; finl;
                          <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
                        }
                      }
                    is &gt;&gt; motlu;
                  }
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 3:
              {
                pc=<span class="stringliteral">&quot;null&quot;</span>;
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 4:
              {
                is &gt;&gt; nb_it_max_;
                convergence_with_nb_it_max_=1;
                <span class="keywordflow">if</span> (<a class="code" href="classSolv__Petsc.html#a4a4d7d01f00900e4c2ad771be5e6725b" title="Utilisation des solveurs GPU de AMGX.">amgx_</a>)
                  {
                    amgx_option+=<span class="stringliteral">&quot;s:max_iters=&quot;</span>;
                    amgx_option+=<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(nb_it_max_)+<span class="stringliteral">&quot;\n&quot;</span>;
                  }
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 15:
              {
                <a class="code" href="classSolveurSys__base.html#a824322fe6a2c03aa986b8152aefcf14b" title="Drapeau pour savoir si un stockage disque est a refaire.">save_matrice_</a>=1;
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 5:
              {
<span class="comment">// on sauvegarde au format petsc</span>
                save_matrix_=1;
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 26:
              {
<span class="comment">// on sauvegarde au format matrix market</span>
                save_matrix_=2;
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 6:
              {
                <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>()&gt;1)
                  {
                    <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;factored_matrix option is not available for parallel calculation.&quot;</span> &lt;&lt; finl;
                    <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
                  }
                <span class="keywordflow">if</span> (<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6">solveur_direct_</a>!=<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6aaf77cfaeac95d5bb680e1b2603d23ae1">petsc</a>)
                  {
<span class="comment">// Switch to PETSc Cholesky cause MUMPS or SUPERLU don&#39;t give access to LU ?</span>
                    <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Only cholesky_lapack keyword may be used with the option factored_matrix.&quot;</span> &lt;&lt; finl;
                    <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
                  }
                is &gt;&gt; factored_matrix_;
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 7:
              {
                <a class="code" href="classSolv__Petsc.html#a9c92c7b3025ccb3f301489141a442211" title="Read constant matrix in a file.">read_matrix_</a>=1;
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 8:
              {
                is &gt;&gt; controle_residu_;
                <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Option controle_residu not implemented yet.&quot;</span> &lt;&lt; finl;
                <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 9:
              {
                is &gt;&gt; motlu; <span class="comment">//!&lt; On lit l&#39;accolade</span>
<span class="comment"></span>                <span class="keywordflow">if</span> (motlu != accolade_ouverte)
                  {
                    <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;We expected &quot;</span> &lt;&lt; accolade_ouverte &lt;&lt; <span class="stringliteral">&quot; instead of &quot;</span> &lt;&lt; motlu &lt;&lt; finl;
                    <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
                  }
                <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Reading of the Petsc commands:&quot;</span> &lt;&lt; finl;
                <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> <a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>;
                is &gt;&gt; motlu;
                <span class="keywordflow">while</span> (motlu!=accolade_fermee)
                  {
                    is &gt;&gt; <a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>;
<span class="comment">// &quot;-option val&quot; ou &quot;-option&quot; ?</span>
<span class="comment">// adding a test to support negative value</span>
                    <span class="keywordtype">bool</span> negative_value = is_number(valeur.getSuffix(<span class="stringliteral">&quot;-&quot;</span>).getString());
                    <span class="keywordflow">if</span> ((valeur.debute_par(<span class="stringliteral">&quot;-&quot;</span>) &amp;&amp; !negative_value) || valeur==accolade_fermee)
                      {
                        add_option(motlu.suffix(<span class="stringliteral">&quot;-&quot;</span>), <span class="stringliteral">&quot;&quot;</span>);
                        motlu = <a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>;
                      }
                    <span class="keywordflow">else</span>
                      {
                        add_option(motlu.suffix(<span class="stringliteral">&quot;-&quot;</span>), <a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>);
                        is &gt;&gt; motlu;
                      }
                  }
                <span class="keywordflow">if</span> (<a class="code" href="classSolveurSys__base.html#ab3ef68bcf4e1b402c52905aa78728aef">limpr</a>()&gt;-1)
                  <a class="code" href="classSolveurSys__base.html#a987e97740c779c1ab4192c3c1f1bbd5d">fixer_limpr</a>(1); <span class="comment">//!&lt; On imprime le residu si CLI Pour faciliter le debugage:</span>
<span class="comment"></span><span class="comment">//</span>
                <span class="keywordflow">if</span> (rang == 18) <span class="comment">//!&lt; Verbose</span>
<span class="comment"></span>                  {

                    add_option(<span class="stringliteral">&quot;ksp_view&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
                    add_option(<span class="stringliteral">&quot;options_view&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
                    add_option(<span class="stringliteral">&quot;options_left&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
                  }
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 10:
              {
                is &gt;&gt; motlu;
<span class="comment">// Si pas MUMPS on previent</span>
                <span class="keywordflow">if</span> (<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6">solveur_direct_</a>!=<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6a1cb49f862e7fcd552eed7f0145c86db1">mumps</a>)
                  {
                    <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Ordering keyword for a solver is limited to Cholesky only.&quot;</span> &lt;&lt; finl;
                    <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
                  }
                <a class="code" href="classMotcles.html" title="Un tableau d&#39;objets de la classe Motcle.">Motcles</a> mumps_ordering(6);
                {
<span class="comment">// NB: Il y&#39;a d&#39;autres ordering (voir doc MUMPS)</span>
                  mumps_ordering[0] = <span class="stringliteral">&quot;amd&quot;</span>;
                  mumps_ordering[1] = <span class="stringliteral">&quot;pt-scotch&quot;</span>;
                  mumps_ordering[2] = <span class="stringliteral">&quot;parmetis&quot;</span>;
                  mumps_ordering[3] = <span class="stringliteral">&quot;scotch&quot;</span>;
                  mumps_ordering[4] = <span class="stringliteral">&quot;pord&quot;</span>;
                  mumps_ordering[5] = <span class="stringliteral">&quot;metis&quot;</span>;
                }
                <span class="keywordtype">int</span> rang_mumps=mumps_ordering.search(motlu);
<span class="comment">// MUMPS fait un choix automatique par defaut (selon type et taille de la matrice, et nombre de processeurs) mais a savoir que:</span>
<span class="comment">// Sur le cas Cx et PAR_Cx 4 cores, Scotch en sequentiel et PT-Scotch en parallele sont les meilleurs choix</span>
<span class="comment">// Sur les gros cas, parfois Metis plus rapide pour A=LU et Scotch pour x=A-1B...</span>
                <span class="keywordflow">if</span> (rang_mumps==-1)
                  {
                    <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; motlu &lt;&lt; <span class="stringliteral">&quot; : unrecognized ordering from those available for the MUMPS solver Cholesky:&quot;</span> &lt;&lt; finl;
                    <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; mumps_ordering &lt;&lt; finl;
                    <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
                  }
                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rang_mumps==1 || rang_mumps==2)
                  {
                    <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>()==1)
                      {
                        <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;You can&#39;t use the parallel ordering &quot;</span> &lt;&lt; motlu &lt;&lt; <span class="stringliteral">&quot; during a sequential calculation.&quot;</span> &lt;&lt; finl;
                        <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
                      }
                    add_option(<span class="stringliteral">&quot;mat_mumps_icntl_28&quot;</span>,<span class="stringliteral">&quot;2&quot;</span>);  <span class="comment">//!&lt; Parallel analysis</span>
<span class="comment"></span>                    add_option(<span class="stringliteral">&quot;mat_mumps_icntl_29&quot;</span>,(<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>)rang_mumps);        <span class="comment">//!&lt; Parallel ordering</span>
<span class="comment"></span>                  }
                <span class="keywordflow">else</span>
                  {
                    add_option(<span class="stringliteral">&quot;mat_mumps_icntl_28&quot;</span>,<span class="stringliteral">&quot;1&quot;</span>);  <span class="comment">//!&lt; Sequential analysis</span>
<span class="comment"></span>                    add_option(<span class="stringliteral">&quot;mat_mumps_icntl_7&quot;</span>,(<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>)rang_mumps); <span class="comment">//!&lt; Sequential ordering</span>
<span class="comment"></span>                  }
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 11:
              {
                is &gt;&gt; petsc_decide_;
                different_partition_ = petsc_decide_; <span class="comment">//!&lt; If Petsc decides the matrix partition, the partition is often different than the TRUST partition</span>
<span class="comment"></span>                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 12:
              {
                mataij_=1;
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 13:
              {
                is &gt;&gt; motlu;
                is &gt;&gt; petsc_nb_cpus_;
                different_partition_ = 1; <span class="comment">//!&lt; If user decides a different number of CPUs to solve PETSc matrix, the matrix partition will be different than the TRUST partition</span>
<span class="comment"></span>                <span class="keywordflow">if</span> (motlu==<span class="stringliteral">&quot;first&quot;</span>)
                  petsc_cpus_selection_=1;
                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (motlu==<span class="stringliteral">&quot;every&quot;</span>)
                  petsc_cpus_selection_=2;
                <span class="keywordflow">else</span>
                  {
                    <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;We should read the option first or every after the keyword nb_cpus.&quot;</span> &lt;&lt; finl;
                    <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Or we read: &quot;</span> &lt;&lt; motlu &lt;&lt; finl;
                    <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
                  }
                <span class="keywordflow">if</span> (petsc_nb_cpus_&lt;1 || petsc_nb_cpus_&gt;<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>())
                  {
                    <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Incorrect number of CPUs selected for solving the PETSc matrix: &quot;</span> &lt;&lt; petsc_nb_cpus_ &lt;&lt; finl;
                    <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
                  }
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 14:
              {
                is &gt;&gt; divtol_; <span class="comment">//!&lt; See http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/KSP/KSPSetTolerances.html</span>
<span class="comment"></span>                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 17:
              {
                KSPType type_ksp_method;
                KSPGetType(SolveurPetsc_, &amp;type_ksp_method);
                <span class="keywordflow">if</span> ((<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>)type_ksp_method != <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(<span class="stringliteral">&quot;gmres&quot;</span>) &amp;&amp; ((<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>)type_ksp_method != <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(<span class="stringliteral">&quot;fgmres&quot;</span>)))
                  {
                    <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;restart option is available only with [f]gmres methods&quot;</span> &lt;&lt; finl;
                    <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
                  }
                <span class="keywordtype">int</span> restart_gmres;
                is &gt;&gt; restart_gmres;
                KSPGMRESSetRestart(SolveurPetsc_,restart_gmres);
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 19:
              {
<span class="comment">// Si pas MUMPS on previent</span>
                <span class="keywordflow">if</span> (<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6">solveur_direct_</a>!=<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6a1cb49f862e7fcd552eed7f0145c86db1">mumps</a>)
                  {
                    <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; les_parametres_solveur[rang] &lt;&lt; <span class="stringliteral">&quot; keyword for a solver is limited to &quot;</span> &lt;&lt; les_solveurs[14] &lt;&lt; <span class="stringliteral">&quot; only.&quot;</span> &lt;&lt; finl;
                    <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
                  }
                <span class="keywordtype">double</span> dropping_parameter;
                is &gt;&gt; dropping_parameter;
                add_option(<span class="stringliteral">&quot;mat_mumps_cntl_7&quot;</span>,dropping_parameter);    <span class="comment">//!&lt; Dropping parameter</span>
<span class="comment"></span>                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 20:
              {
                <span class="keywordflow">if</span> (<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6">solveur_direct_</a>)
                  {
                    <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Definition of &quot;</span> &lt;&lt; les_parametres_solveur(les_parametres_solveur.search(motlu)) &lt;&lt; <span class="stringliteral">&quot; is useless for a direct method.&quot;</span> &lt;&lt; finl;
                    <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Suppress the keyword.&quot;</span> &lt;&lt; finl;
                    <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
                  }
                is &gt;&gt; seuil_relatif_;
                convergence_with_seuil=1;
                <span class="keywordflow">if</span> (<a class="code" href="classSolv__Petsc.html#a4a4d7d01f00900e4c2ad771be5e6725b" title="Utilisation des solveurs GPU de AMGX.">amgx_</a>)
                  {
                    amgx_option+=<span class="stringliteral">&quot;s:convergence=RELATIVE_INI_CORE\ns:tolerance=&quot;</span>;
                    amgx_option+=<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(seuil_relatif_,<span class="stringliteral">&quot;%e&quot;</span>)+<span class="stringliteral">&quot;\n&quot;</span>;
                  }
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 22:
              <span class="keywordtype">int</span> flag;
              is &gt;&gt; flag;
              <a class="code" href="classSolv__Petsc.html#a1d87d8f7f3be6d318bc343e11059cde2">ignore_new_nonzero_</a> = (bool)flag;
              <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> 23:
              is &gt;&gt; flag;
              <a class="code" href="classSolv__Petsc.html#a895816a337ad6bc6fcdfb82037e6a837">rebuild_matrix_</a> = (bool)flag;
              <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> 24:
              is &gt;&gt; flag;
              <a class="code" href="classSolv__Petsc.html#a45df7a11f976ea94cbb622ae8fcbd181">allow_realloc_</a> = (bool)flag;
              <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> 25:
              is &gt;&gt; flag;
              <a class="code" href="classSolv__Petsc.html#af13cee34da6194e79945d3a950ee2ed0">clean_matrix_</a> = (bool)flag;
              <span class="keywordflow">break</span>;
            <span class="keywordflow">default</span>:
              {
                <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; motlu &lt;&lt; <span class="stringliteral">&quot; : unrecognized option from those available in the Petsc solver:&quot;</span> &lt;&lt; finl;
                <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; les_parametres_solveur &lt;&lt; finl;
                <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
              }
            }
          is &gt;&gt; motlu;
        }
<span class="comment">// Some checks</span>
      <span class="keywordflow">if</span> (petsc_decide_ &amp;&amp; petsc_cpus_selection_)
        {
          <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;You can&#39;t use petsc_decide and nb_cpus option together.&quot;</span> &lt;&lt; finl;
          <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
        }

      <span class="keywordtype">int</span> pc_supported_on_gpu_by_petsc=0;
      <span class="keywordtype">int</span> pc_supported_on_gpu_by_amgx=0;
      <a class="code" href="classMotcles.html" title="Un tableau d&#39;objets de la classe Motcle.">Motcles</a> les_precond(12);
      {
        les_precond[0] = <span class="stringliteral">&quot;NULL&quot;</span>;               <span class="comment">//!&lt; Pas de preconditionnement</span>
<span class="comment"></span>        les_precond[1] = <span class="stringliteral">&quot;ILU&quot;</span>;                <span class="comment">//!&lt; Incomplete LU</span>
<span class="comment"></span>        les_precond[2] = <span class="stringliteral">&quot;SSOR&quot;</span>;               <span class="comment">//!&lt; Symetric Successive Over Relaxation</span>
<span class="comment"></span>        les_precond[3] = <span class="stringliteral">&quot;EISENSTAT&quot;</span>;          <span class="comment">//!&lt; Symetric Successive Over Relaxation avec Eiseinstat trick</span>
<span class="comment"></span>        les_precond[4] = <span class="stringliteral">&quot;SPAI&quot;</span>;               <span class="comment">//!&lt; Sparse Approximate Inverse</span>
<span class="comment"></span>        les_precond[5] = <span class="stringliteral">&quot;PILUT&quot;</span>;              <span class="comment">//!&lt; Dual-threshold incomplete LU factorisation</span>
<span class="comment"></span>        les_precond[6] = <span class="stringliteral">&quot;DIAG&quot;</span>;               <span class="comment">//!&lt; Diagonal precondtioner</span>
<span class="comment"></span>        les_precond[7] = <span class="stringliteral">&quot;BOOMERAMG&quot;</span>;          <span class="comment">//!&lt; Multigrid preconditioner</span>
<span class="comment"></span>        les_precond[8] = <span class="stringliteral">&quot;BLOCK_JACOBI_ICC&quot;</span>;   <span class="comment">//!&lt; Block Jacobi ICC preconditioner (code dans PETSc, optimise)</span>
<span class="comment"></span>        les_precond[9] = <span class="stringliteral">&quot;BLOCK_JACOBI_ILU&quot;</span>;   <span class="comment">//!&lt; Block Jacobi ILU preconditioner (code dans PETSc, optimise)</span>
<span class="comment"></span>        les_precond[10] = <span class="stringliteral">&quot;C-AMG&quot;</span>;    <span class="comment">//!&lt; Classical AMG</span>
<span class="comment"></span>        les_precond[11] = <span class="stringliteral">&quot;SA-AMG&quot;</span>;   <span class="comment">//!&lt; Aggregated AMG</span>
<span class="comment"></span>      }

      <span class="keywordflow">if</span> (pc!=<span class="stringliteral">&quot;&quot;</span>)
        {
<span class="comment">// On empeche le choix d&#39;un preconditionneur avec une methode directe</span>
<span class="comment">// puisque celle ci EST le preconditionneur KSPREONLY</span>
          <span class="keywordflow">if</span> (<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6">solveur_direct_</a>)
            {
              <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Using precond keyword with a direct method like Cholesky is useless&quot;</span> &lt;&lt; finl;
              <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;because for PETSc the LU factorization is used as a preconditioner.&quot;</span> &lt;&lt; finl;
              <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
            }
<span class="comment">// Option du preconditionneur</span>
          rang = les_precond.search(pc);
          <span class="keywordflow">switch</span>(rang)
            {
            <span class="keywordflow">case</span> 0:
              {
                PCSetType(PreconditionneurPetsc_, PCNONE);
                pc_supported_on_gpu_by_petsc=1;
                solver_supported_on_gpu_by_amgx=1;
                <a class="code" href="Solv__Petsc_8cpp.html#a7316e7bc8604a4493102b9edb122675d">check_not_defined</a>(omega);
                <a class="code" href="Solv__Petsc_8cpp.html#a7316e7bc8604a4493102b9edb122675d">check_not_defined</a>(level);
                <a class="code" href="Solv__Petsc_8cpp.html#a7316e7bc8604a4493102b9edb122675d">check_not_defined</a>(epsilon);
                <a class="code" href="Solv__Petsc_8cpp.html#a7316e7bc8604a4493102b9edb122675d">check_not_defined</a>(ordering);
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 1:
              {
<span class="comment">// Cout &lt;&lt; &quot;See http://www.ncsa.uiuc.edu/UserInfo/Resources/Software/Math/HYPRE/docs-1.6.0/HYPRE_usr_manual/node33.html&quot; &lt;&lt; finl;</span>
<span class="comment">// Cout &lt;&lt; &quot;to have some advices on the incomplete LU factorisation level: ILU(level)&quot; &lt;&lt; finl;</span>
<span class="comment">// On n&#39;attaque pas le ILU de Petsc qui n&#39;est pas parallele</span>
<span class="comment">// On prend celui de Hypre (Euclid=PILU(k)) en passant par les commandes en ligne</span>
<span class="comment">// car peu de parametres peuvent etre fixes sinon</span>
<span class="comment">// PCSetType(PreconditionneurPetsc_, PCHYPRE);</span>
<span class="comment">// PCHYPRESetType(PreconditionneurPetsc_, &quot;euclid&quot;);</span>
<span class="comment">// add_option(&quot;pc_hypre_euclid_levels&quot;,(Nom)level.value());</span>
<span class="comment">// check_not_defined(omega);</span>
<span class="comment">// check_not_defined(epsilon);</span>
<span class="comment">// check_not_defined(ordering);</span>
<span class="comment">// </span>
<span class="comment">// CHANGES in the PETSc 3.6 version: Removed -pc_hypre_type euclid due to bit-rot</span>
                pc_supported_on_gpu_by_amgx=1;
                <span class="keywordflow">if</span> (<a class="code" href="classSolv__Petsc.html#a4a4d7d01f00900e4c2ad771be5e6725b" title="Utilisation des solveurs GPU de AMGX.">amgx_</a>)
                  {
                    amgx_option+=<span class="stringliteral">&quot;s:preconditioner(p)=MULTICOLOR_DILU\n&quot;</span>;
                  }
                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classSolv__Petsc.html#a5f603c229087d42c8bb2fee48290526f" title="Utilisation des solveurs GPU de PETSc.">gpu_</a>)
                  {
                    add_option(<span class="stringliteral">&quot;pc_type&quot;</span>,<span class="stringliteral">&quot;ilu&quot;</span>);
                    add_option(<span class="stringliteral">&quot;pc_factor_mat_solver_type&quot;</span>,<span class="stringliteral">&quot;cusparse&quot;</span>);
                    add_option(<span class="stringliteral">&quot;pc_factor_levels&quot;</span>,(<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>)level.value());
                  }
                <span class="keywordflow">else</span>
                  {
                    <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error: CHANGES in the PETSc 3.6 version: Removed -pc_hypre_type euclid due to bit-rot.&quot;</span>
                         &lt;&lt; finl;
                    <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;So the ILU { level k } preconditioner no longer available. &quot;</span> &lt;&lt; finl;
                    <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Change your data file.&quot;</span> &lt;&lt; finl;
                    <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
                  }
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 2:
              {
                PCSetType(PreconditionneurPetsc_, PCSOR);
                <span class="keywordflow">if</span> (omega.value()&gt;=1. &amp;&amp; omega.value()&lt;=2.)
                  {
                    PCSORSetOmega(PreconditionneurPetsc_, omega.value());
                  }
                <span class="keywordflow">else</span>
                  {
                    <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;omega value for SSOR should be between 1 and 2&quot;</span> &lt;&lt; finl;
                    <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
                  }
                pc_supported_on_gpu_by_amgx=1;
                <span class="keywordflow">if</span> (<a class="code" href="classSolv__Petsc.html#a4a4d7d01f00900e4c2ad771be5e6725b" title="Utilisation des solveurs GPU de AMGX.">amgx_</a>)
                  {
                    amgx_option+=<span class="stringliteral">&quot;s:preconditioner(p)=GS\n&quot;</span>; <span class="comment">//!&lt; Dans AMGX, c&#39;est un Gauss Seidel... MULTICOLOR_GS lent</span>
<span class="comment"></span>                    <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> relaxation_factor=<span class="stringliteral">&quot;p:relaxation_factor=&quot;</span>; <span class="comment">//!&lt; Defaut 0.9</span>
<span class="comment"></span>                    relaxation_factor+=<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(omega.value()-1); <span class="comment">//!&lt; Astuce moyenne... ToDo faire un GS ?</span>
<span class="comment"></span>                    amgx_option+=relaxation_factor+<span class="stringliteral">&quot;\n&quot;</span>;
                    <span class="keywordflow">if</span> (matrice_symetrique_) amgx_option+=<span class="stringliteral">&quot;p:symmetric_GS=1\n&quot;</span>;
                  }
                <a class="code" href="Solv__Petsc_8cpp.html#a7316e7bc8604a4493102b9edb122675d">check_not_defined</a>(level);
                <a class="code" href="Solv__Petsc_8cpp.html#a7316e7bc8604a4493102b9edb122675d">check_not_defined</a>(epsilon);
                <a class="code" href="Solv__Petsc_8cpp.html#a7316e7bc8604a4493102b9edb122675d">check_not_defined</a>(ordering);
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 3:
              {
                PCSetType(PreconditionneurPetsc_, PCEISENSTAT);
                <span class="keywordflow">if</span> (omega.value()&gt;=1. &amp;&amp; omega.value()&lt;=2.)
                  {
                    PCEisenstatSetOmega(PreconditionneurPetsc_, omega.value());
                  }
                <span class="keywordflow">else</span>
                  {
                    <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;omega value for EISENSTAT should be between 1 and 2&quot;</span> &lt;&lt; finl;
                    <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
                  }
                <a class="code" href="Solv__Petsc_8cpp.html#a7316e7bc8604a4493102b9edb122675d">check_not_defined</a>(level);
                <a class="code" href="Solv__Petsc_8cpp.html#a7316e7bc8604a4493102b9edb122675d">check_not_defined</a>(epsilon);
                <a class="code" href="Solv__Petsc_8cpp.html#a7316e7bc8604a4493102b9edb122675d">check_not_defined</a>(ordering);
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 4:
              {
                PCSetType(PreconditionneurPetsc_, PCHYPRE);
                PCHYPRESetType(PreconditionneurPetsc_, <span class="stringliteral">&quot;parasails&quot;</span>);
                add_option(<span class="stringliteral">&quot;pc_hypre_parasails_nlevels&quot;</span>,(<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>)level.value());     <span class="comment">//!&lt; Higher values of level [&gt;=0] leads to more accurate, but more expensive preconditioners (default 1)</span>
<span class="comment"></span>                add_option(<span class="stringliteral">&quot;pc_hypre_parasails_thresh&quot;</span>,(<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>)epsilon.value());   <span class="comment">//!&lt; Lower values of eps [0-1] leads to more accurate, but more expensive preconditioners (default 0.1)</span>
<span class="comment"></span>                add_option(<span class="stringliteral">&quot;pc_hypre_parasails_sym&quot;</span>,<span class="stringliteral">&quot;SPD&quot;</span>); <span class="comment">//!&lt; Matrice symetrique definie positive</span>
<span class="comment"></span>                <a class="code" href="Solv__Petsc_8cpp.html#a7316e7bc8604a4493102b9edb122675d">check_not_defined</a>(omega);
                <a class="code" href="Solv__Petsc_8cpp.html#a7316e7bc8604a4493102b9edb122675d">check_not_defined</a>(ordering);
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 5:
              {
                PCSetType(PreconditionneurPetsc_, PCHYPRE);
                PCHYPRESetType(PreconditionneurPetsc_, <span class="stringliteral">&quot;pilut&quot;</span>);
                add_option(<span class="stringliteral">&quot;pc_hypre_pilut_factorrowsize&quot;</span>,(<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>)level.value());        <span class="comment">//!&lt; Maximum nonzeros retained in each row of L and U (default 20)</span>
<span class="comment"></span>                add_option(<span class="stringliteral">&quot;pc_hypre_pilut_tol&quot;</span>,(<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>)epsilon.value());                <span class="comment">//!&lt; Values below the value are dropped in L and U (default 1.e-7)</span>
<span class="comment"></span>                <a class="code" href="Solv__Petsc_8cpp.html#a7316e7bc8604a4493102b9edb122675d">check_not_defined</a>(omega);
                <a class="code" href="Solv__Petsc_8cpp.html#a7316e7bc8604a4493102b9edb122675d">check_not_defined</a>(ordering);
<span class="comment">// </span>
<span class="comment">// ERROR VALGRIND</span>
<span class="comment">// Cerr &lt;&lt; &quot;Error VALGRIND with PETSc Dual Threashold Incomplete LU factorization.&quot; &lt;&lt; finl;</span>
<span class="comment">// Cerr &lt;&lt; &quot;So the PILUT { level k epsilon thresh } preconditioner no longer available. &quot; &lt;&lt; finl;</span>
<span class="comment">// Cerr &lt;&lt; &quot;Change your data file.&quot; &lt;&lt; finl;</span>
<span class="comment">// Process::exit();</span>
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 6:
              {
                PCSetType(PreconditionneurPetsc_, PCJACOBI);
                pc_supported_on_gpu_by_petsc=1;
                pc_supported_on_gpu_by_amgx=1;
                <span class="keywordflow">if</span> (<a class="code" href="classSolv__Petsc.html#a4a4d7d01f00900e4c2ad771be5e6725b" title="Utilisation des solveurs GPU de AMGX.">amgx_</a>)
                  {
                    amgx_option += <span class="stringliteral">&quot;s:preconditioner(p)=BLOCK_JACOBI\n&quot;</span>;
                    <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>(<span class="stringliteral">&quot;Diagonal preconditioner on GPI with AmgX is slow to converge. Try SSOR preconditioner.&quot;</span>);
                  }
                <a class="code" href="Solv__Petsc_8cpp.html#a7316e7bc8604a4493102b9edb122675d">check_not_defined</a>(omega);
                <a class="code" href="Solv__Petsc_8cpp.html#a7316e7bc8604a4493102b9edb122675d">check_not_defined</a>(level);
                <a class="code" href="Solv__Petsc_8cpp.html#a7316e7bc8604a4493102b9edb122675d">check_not_defined</a>(epsilon);
                <a class="code" href="Solv__Petsc_8cpp.html#a7316e7bc8604a4493102b9edb122675d">check_not_defined</a>(ordering);
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 9: <span class="comment">//!&lt; ilu</span>
<span class="comment"></span>            <span class="keywordflow">case</span> 8: <span class="comment">//!&lt; icc</span>
<span class="comment"></span>              {
                <span class="keywordflow">if</span> (rang==9) preconditionnement_non_symetrique_ = 1;
                pc_supported_on_gpu_by_amgx=1;
                pc_supported_on_gpu_by_petsc=1;
                <span class="keywordflow">if</span> (<a class="code" href="classSolv__Petsc.html#a4a4d7d01f00900e4c2ad771be5e6725b" title="Utilisation des solveurs GPU de AMGX.">amgx_</a>)
                  amgx_option+=<span class="stringliteral">&quot;s:preconditioner(p)=MULTICOLOR_DILU\n&quot;</span>; <span class="comment">//!&lt; MULTICOLOR_ILU plante...</span>
<span class="comment"></span>                <span class="keywordflow">else</span>
                  {
                    add_option(<span class="stringliteral">&quot;sub_pc_type&quot;</span>,rang==8 ? <span class="stringliteral">&quot;icc&quot;</span> : <span class="stringliteral">&quot;ilu&quot;</span>);
                    add_option(<span class="stringliteral">&quot;sub_pc_factor_levels&quot;</span>,(<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>)level.value());
<span class="comment">// On fixe le precondtionnement non symetrique pour appliquer eventuellement un ordering autre que celui par defaut (natural)</span>
<span class="comment">// Un ordering rcm peut ameliorer par exemple la convergence</span>
<span class="comment">// Voir le remplissage de la matrice avec -mat_view_draw -draw_pause -1</span>
                    <span class="keywordflow">if</span> (ordering.value()!=<span class="stringliteral">&quot;&quot;</span>)
                      {
                        add_option(<span class="stringliteral">&quot;sub_pc_factor_mat_ordering_type&quot;</span>,ordering.value());
<span class="comment">// Le preconditionnement natural (defaut) ne necessite pas une matrice de preconditionnement symetrique, les autres si:</span>
                        preconditionnement_non_symetrique_=1;
                      }

                  }
                PCSetType(PreconditionneurPetsc_, PCBJACOBI);
                <a class="code" href="Solv__Petsc_8cpp.html#a7316e7bc8604a4493102b9edb122675d">check_not_defined</a>(omega);
                <a class="code" href="Solv__Petsc_8cpp.html#a7316e7bc8604a4493102b9edb122675d">check_not_defined</a>(epsilon);
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 7:
              {
                PCSetType(PreconditionneurPetsc_, PCHYPRE);
                PCHYPRESetType(PreconditionneurPetsc_, <span class="stringliteral">&quot;boomeramg&quot;</span>); <span class="comment">//!&lt; Classical C-AMG Changement pc_hypre_boomeramg_relax_type_all pour PETSc 3.10, la matrice de preconditionnement etant seqaij, symetric-SOR/jacobi (defaut) provoque KSP_DIVERGED_INDEFINITE_PC Voir: https://lists.mcs.anl.gov/mailman/htdig/petsc-users/2012-December/015922.html</span>
<span class="comment"></span><span class="comment">//</span>
<span class="comment">//</span>
<span class="comment">//</span>
                add_option(<span class="stringliteral">&quot;pc_hypre_boomeramg_relax_type_all&quot;</span>, <span class="stringliteral">&quot;Jacobi&quot;</span>);
<span class="comment">// Voir https://mooseframework.inl.gov/application_development/hypre.html</span>
                <span class="keywordflow">if</span> (<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>==3) <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Warning, on massive parallel calculation for best performance, consider playing with -pc_hypre_boomeramg_strong_threshold 0.7 or 0.8 or 0.9&quot;</span> &lt;&lt; finl;
                <a class="code" href="Solv__Petsc_8cpp.html#a7316e7bc8604a4493102b9edb122675d">check_not_defined</a>(omega);
                <a class="code" href="Solv__Petsc_8cpp.html#a7316e7bc8604a4493102b9edb122675d">check_not_defined</a>(level);
                <a class="code" href="Solv__Petsc_8cpp.html#a7316e7bc8604a4493102b9edb122675d">check_not_defined</a>(epsilon);
                <a class="code" href="Solv__Petsc_8cpp.html#a7316e7bc8604a4493102b9edb122675d">check_not_defined</a>(ordering);
                <span class="comment">/*</span>
<span class="comment">                add_option(&quot;pc_hypre_boomeramg_max_iter&quot;,&quot;1&quot;);</span>
<span class="comment">                add_option(&quot;pc_hypre_boomeramg_strong_threshold&quot;,&quot;0.7&quot;);</span>
<span class="comment">                add_option(&quot;pc_hypre_boomeramg_grid_sweeps_up&quot;,&quot;1&quot;);</span>
<span class="comment">                add_option(&quot;pc_hypre_boomeramg_grid_sweeps_down&quot;,&quot;1&quot;);</span>
<span class="comment">                add_option(&quot;pc_hypre_boomeramg_agg_nl&quot;,&quot;2&quot;);</span>
<span class="comment">                add_option(&quot;pc_hypre_boomeramg_agg_num_paths&quot;,&quot;1&quot;);</span>
<span class="comment">                add_option(&quot;pc_hypre_boomeramg_max_levels&quot;,&quot;25&quot;);</span>
<span class="comment">                add_option(&quot;pc_hypre_boomeramg_coarsen_type&quot;,&quot;HMIS&quot;);</span>
<span class="comment">                add_option(&quot;pc_hypre_boomeramg_interp_type&quot;,&quot;ext+i&quot;);</span>
<span class="comment">                add_option(&quot;pc_hypre_boomeramg_P_max&quot;,&quot;2&quot;);</span>
<span class="comment">// Page 16: https://prace-ri.eu/wp-content/uploads/WP294-PETSc4FOAM-A-Library-to-plug-in-PETSc-into-the-OpenFOAM-Framework.pdf</span>
<span class="comment">                add_option(&quot;pc_hypre_boomeramg_truncfactor&quot;,&quot;0.2&quot;);*/</span>
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">case</span> 10: <span class="comment">//!&lt; Classical AMG</span>
<span class="comment"></span>            <span class="keywordflow">case</span> 11: <span class="comment">//!&lt; Aggregated AMG</span>
<span class="comment"></span>              {
                pc_supported_on_gpu_by_amgx=1;
                pc_supported_on_gpu_by_petsc=1;
                preconditionnement_non_symetrique_ = 1;
                <span class="keywordflow">if</span> (<a class="code" href="classSolv__Petsc.html#a4a4d7d01f00900e4c2ad771be5e6725b" title="Utilisation des solveurs GPU de AMGX.">amgx_</a>)
                  {
                    amgx_option+=<span class="stringliteral">&quot;s:preconditioner(p)=AMG\n&quot;</span>;
                    amgx_option+=<span class="stringliteral">&quot;s:use_scalar_norm=1\n&quot;</span>;
                    amgx_option+=<span class="stringliteral">&quot;p:error_scaling=0\n&quot;</span>;
                    amgx_option+=<span class="stringliteral">&quot;p:print_grid_stats=1\n&quot;</span>;
                    amgx_option+=<span class="stringliteral">&quot;p:max_iters=1\n&quot;</span>;
                    amgx_option+=<span class="stringliteral">&quot;p:cycle=V\n&quot;</span>;
                    amgx_option+=<span class="stringliteral">&quot;p:min_coarse_rows=2\n&quot;</span>;
                    amgx_option+=<span class="stringliteral">&quot;p:max_levels=100\n&quot;</span>;
                    amgx_option+=<span class="stringliteral">&quot;p:smoother(smoother)=BLOCK_JACOBI\n&quot;</span>;
                    amgx_option+=<span class="stringliteral">&quot;p:presweeps=1\n&quot;</span>;
                    amgx_option+=<span class="stringliteral">&quot;p:postsweeps=1\n&quot;</span>;
                    amgx_option+=<span class="stringliteral">&quot;p:coarsest_sweeps=1\n&quot;</span>;
                    amgx_option+=<span class="stringliteral">&quot;p:coarse_solver=DENSE_LU_SOLVER\n&quot;</span>;
                    amgx_option+=<span class="stringliteral">&quot;p:dense_lu_num_rows=2\n&quot;</span>;
                    <span class="keywordflow">if</span> (rang==10) <span class="comment">//!&lt; C-AMG</span>
<span class="comment"></span>                      {
                        amgx_option+=<span class="stringliteral">&quot;p:algorithm=CLASSICAL\n&quot;</span>;
                        amgx_option+=<span class="stringliteral">&quot;p:selector=HMIS\n&quot;</span>;
                        amgx_option+=<span class="stringliteral">&quot;p:interpolator=D2\n&quot;</span>;
                        amgx_option+=<span class="stringliteral">&quot;p:strength=AHAT\n&quot;</span>;
                      }
                    <span class="keywordflow">else</span> <span class="comment">//!&lt; SA-AMG</span>
<span class="comment"></span>                      {
                        amgx_option+=<span class="stringliteral">&quot;p:algorithm=AGGREGATION\n&quot;</span>;
                        amgx_option+=<span class="stringliteral">&quot;p:selector=SIZE_2\n&quot;</span>;
                        amgx_option+=<span class="stringliteral">&quot;p:max_matching_iterations=100000\n&quot;</span>;
                        amgx_option+=<span class="stringliteral">&quot;p:max_unassigned_percentage=0.0\n&quot;</span>;
                      }
                    amgx_option+=<span class="stringliteral">&quot;smoother:relaxation_factor=0.8\n&quot;</span>;
                  }
                <span class="keywordflow">else</span>
                  {
<span class="comment">// ToDo : trouver des parametres pour PETSc afin d&#39;avoir une comparaison possible CPU vs GPU (meme its par exemple):</span>
                    add_option(<span class="stringliteral">&quot;pc_type&quot;</span>,<span class="stringliteral">&quot;gamg&quot;</span>);
                    <span class="keywordflow">if</span> (rang==10) <span class="comment">//!&lt; C-AMG</span>
<span class="comment"></span>                      {
                        add_option(<span class="stringliteral">&quot;pc_gamg_type&quot;</span>,<span class="stringliteral">&quot;classical&quot;</span>);
                      }
                    <span class="keywordflow">else</span> <span class="comment">//!&lt; SA-AMG</span>
<span class="comment"></span>                      {
                        add_option(<span class="stringliteral">&quot;pc_gamg_type&quot;</span>,<span class="stringliteral">&quot;agg&quot;</span>);
                        add_option(<span class="stringliteral">&quot;pc_gamg_agg_nsmooths&quot;</span>,<span class="stringliteral">&quot;0&quot;</span>);
<span class="comment">// add_option(&quot;pc_gamg_agg_nsmooths&quot;,&quot;1&quot;); //Crash</span>
                      }
                  }
                <span class="keywordflow">break</span>;
              }
            <span class="keywordflow">default</span>:
              {
                <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; pc &lt;&lt; <span class="stringliteral">&quot; : preconditioner not officially recognized by TRUST among those possible for the moment:&quot;</span> &lt;&lt; finl;
                <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; les_precond &lt;&lt; finl;
                <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;You can try to access directly to Petsc preconditioners with the command line.&quot;</span> &lt;&lt; finl;
                <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;See the reference manual of Petsc to do this.&quot;</span> &lt;&lt; finl;
                <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
              }
            }
        }
      <span class="keywordflow">else</span>
        {
          <span class="keywordflow">if</span> (!<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6">solveur_direct_</a>)
            {
              <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;You forgot to define a preconditioner with the keyword precond.&quot;</span> &lt;&lt; finl;
              <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;If you don&#39;t want a preconditioner, add for the solver definition:&quot;</span> &lt;&lt; finl;
              <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;precond null&quot;</span> &lt;&lt; finl;
              <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
            }
          <span class="keywordflow">else</span>
            {
<span class="comment">// Pour un solveur direct le preconditionner EST le solveur:</span>
              pc_supported_on_gpu_by_petsc = solver_supported_on_gpu_by_petsc;
              pc_supported_on_gpu_by_amgx = solver_supported_on_gpu_by_amgx;
            }
        }
<span class="comment">// On verifie que les preconditionneurs sont supportes sur GPU:</span>
      <span class="keywordflow">if</span> (<a class="code" href="classSolv__Petsc.html#a5f603c229087d42c8bb2fee48290526f" title="Utilisation des solveurs GPU de PETSc.">gpu_</a> &amp;&amp; pc_supported_on_gpu_by_petsc==0)
        {
          <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; les_precond[rang] &lt;&lt; <span class="stringliteral">&quot; is not supported yet by PETSc on GPU.&quot;</span> &lt;&lt; finl;
          <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
        }
      <span class="keywordflow">if</span> (<a class="code" href="classSolv__Petsc.html#a4a4d7d01f00900e4c2ad771be5e6725b" title="Utilisation des solveurs GPU de AMGX.">amgx_</a> &amp;&amp; pc_supported_on_gpu_by_amgx==0)
        {
          <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; les_precond[rang] &lt;&lt; <span class="stringliteral">&quot; is not supported yet by AmgX on GPU.&quot;</span> &lt;&lt; finl;
          <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
        }
    }

<span class="comment">// On fixe des parametres du solveur et du preconditionneur selon que l&#39;on ait un solveur direct ou iteratif</span>
<span class="comment">// KSPSetInitialGuessNonzero : Resout Ax=B en supposant x nul ou non</span>
<span class="comment">// KSPSetTolerances : Pour fixer les criteres de convergence du solveur iteratif</span>
  <span class="keywordflow">if</span> (<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6">solveur_direct_</a>)
    {
      KSPSetInitialGuessNonzero(SolveurPetsc_, PETSC_FALSE);
      PCSetType(PreconditionneurPetsc_, PCLU);
    }
  <span class="keywordflow">else</span>
    {
      KSPSetInitialGuessNonzero(SolveurPetsc_, PETSC_TRUE);
      <span class="keywordflow">if</span> (convergence_with_nb_it_max_)
        {
          <span class="keywordflow">if</span> (convergence_with_seuil)
            {
              <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;You can only define solver convergence either by seuil or by nb_it_max.&quot;</span> &lt;&lt; finl;
              <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;So suppress seuil keyword or nb_it_max keyword.&quot;</span> &lt;&lt; finl;
              <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
            }
<span class="comment">// Convergence is defined with nb_it_max, the norm is checked after nb_it_max iterations:</span>
          seuil_ = <a class="code" href="Double_8h.html#ae0ee0cebfad5968da0ad6cc7a49e16b6">DMAXFLOAT</a>;
          add_option(<span class="stringliteral">&quot;ksp_check_norm_iteration&quot;</span>,(<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>)(nb_it_max_-1));
          nb_it_max_ = <a class="code" href="Solv__Petsc_8h.html#a6781e64c30c60e9d2a75349c3546c14b">NB_IT_MAX_DEFINED</a>;
        }
<span class="comment">// Convergence si residu(it) &lt; MAX (seuil_relatif_ * residu(0), seuil_);</span>
      <span class="keywordflow">if</span> (seuil_==0 &amp;&amp; seuil_relatif_==0) seuil_=1.e-12; <span class="comment">//!&lt; Si aucun seuil defini, on prend un seuil absolu de 1.e-12 (comme avant)</span>
<span class="comment"></span>      KSPSetTolerances(SolveurPetsc_, seuil_relatif_, seuil_, (divtol_==0 ? PETSC_DEFAULT : divtol_), nb_it_max_);
    }
<span class="comment">// Change le calcul du test de convergence relative (||Ax-b||/||Ax(0)-b|| au lieu de ||Ax-b||/||b||)</span>
<span class="comment">// Peu utilisee dans TRUST car on utilise la convergence sur la norme absolue</span>
<span class="comment">// Mais cela corrige une erreur KSP_DIVERGED_DTOL quand ||Ax-b||/||b||&gt;10000=div_tol par defaut dans PETSc (rencontree sur Etude REV_4)</span>
<span class="comment">// add_option(sys, &quot;ksp_converged_use_initial_residual_norm&quot;,1); // Before PETSc 3.5</span>
  KSPConvergedDefaultSetUIRNorm(SolveurPetsc_); <span class="comment">//!&lt; After PETSc 3.5, a function is available</span>
<span class="comment"></span>
<span class="comment">// Surcharge eventuelle par la ligne de commande</span>
  KSPSetOptionsPrefix(SolveurPetsc_, option_prefix_);
  KSPSetFromOptions(SolveurPetsc_);
  PCSetOptionsPrefix(PreconditionneurPetsc_, option_prefix_);
  PCSetFromOptions(PreconditionneurPetsc_);

<span class="comment">// Setting the names:</span>
  KSPType type_ksp;
  KSPGetType(SolveurPetsc_, &amp;type_ksp);
  type_ksp_=(<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>)type_ksp;

  PCType type_pc;
  PCGetType(PreconditionneurPetsc_, &amp;type_pc);
  type_pc_=(<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>)type_pc;

<span class="comment">// Creation du fichier de config .amgx (NB: les objets PETSc sont crees mais ne seront pas utilises)</span>
  <span class="keywordflow">if</span> (<a class="code" href="classSolv__Petsc.html#a4a4d7d01f00900e4c2ad771be5e6725b" title="Utilisation des solveurs GPU de AMGX.">amgx_</a> &amp;&amp; <a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
    {
      <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a> s(<a class="code" href="classSolv__Petsc.html#af626ce7ac5babfaf8333057766ac15cf" title="Nom du fichier de config eventuel.">config</a>());
<span class="comment">// Syntax: See https://github.com/NVIDIA/AMGX/raw/master/doc/AMGX_Reference.pdf</span>
      s &lt;&lt; <span class="stringliteral">&quot;# AmgX config file&quot;</span> &lt;&lt; finl &lt;&lt; <span class="stringliteral">&quot;config_version=2&quot;</span> &lt;&lt; finl &lt;&lt; amgx_option;
      <span class="keywordflow">if</span> (!amgx_option.contient(<span class="stringliteral">&quot;s:print_config&quot;</span>))     s &lt;&lt; <span class="stringliteral">&quot;s:print_config=1&quot;</span> &lt;&lt; finl;
      <span class="keywordflow">if</span> (!amgx_option.contient(<span class="stringliteral">&quot;s:store_res_history&quot;</span>)) s &lt;&lt; <span class="stringliteral">&quot;s:store_res_history=1&quot;</span> &lt;&lt; finl;
      <span class="keywordflow">if</span> (!amgx_option.contient(<span class="stringliteral">&quot;s:monitor_residual&quot;</span>))  s &lt;&lt; <span class="stringliteral">&quot;s:monitor_residual=1&quot;</span> &lt;&lt; finl;
      <span class="keywordflow">if</span> (!amgx_option.contient(<span class="stringliteral">&quot;s:print_solve_stats&quot;</span>)) s &lt;&lt; <span class="stringliteral">&quot;s:print_solve_stats=1&quot;</span> &lt;&lt; finl;
      <span class="keywordflow">if</span> (!amgx_option.contient(<span class="stringliteral">&quot;s:obtain_timings&quot;</span>))    s &lt;&lt; <span class="stringliteral">&quot;s:obtain_timings=1&quot;</span> &lt;&lt; finl;
      <span class="keywordflow">if</span> (!amgx_option.contient(<span class="stringliteral">&quot;s:max_iters&quot;</span>))         s &lt;&lt; <span class="stringliteral">&quot;s:max_iters=10000&quot;</span> &lt;&lt; finl; <span class="comment">//!&lt; 100 par defaut trop bas...</span>
<span class="comment"></span>      s &lt;&lt; <span class="stringliteral">&quot;# determinism_flag=1&quot;</span> &lt;&lt; finl; <span class="comment">//!&lt; Plus lent de 15% mais resultat deterministique et repetable</span>
<span class="comment"></span>      s &lt;&lt; <span class="stringliteral">&quot;# communicator=MPI_DIRECT&quot;</span> &lt;&lt; finl; <span class="comment">//!&lt; MPI_CUDA aware</span>
<span class="comment"></span>      <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Writing the AmgX config file: &quot;</span> &lt;&lt; <a class="code" href="classSolv__Petsc.html#af626ce7ac5babfaf8333057766ac15cf" title="Nom du fichier de config eventuel.">config</a>() &lt;&lt; finl;
    }
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>  <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error, the code is not built with PETSc support.&quot;</span> &lt;&lt; finl;
  <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Contact TRUST support.&quot;</span> &lt;&lt; finl;
  <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1dcbcf1f662e6b6fcb02186c0d3a23bc"></a><!-- doxytag: member="Solv_Petsc::cree_instance" ref="a1dcbcf1f662e6b6fcb02186c0d3a23bc" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classObjet__U.html">Objet_U</a> * Solv_Petsc::cree_instance </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented in <a class="el" href="classSolv__AMGX.html#a2e92938cfaaad582379a26f54216328b">Solv_AMGX</a>, and <a class="el" href="classSolv__Petsc__GPU.html#aa1e800e7f7a19c2e7a46cafce9d14593">Solv_Petsc_GPU</a>.</p>

<p>Definition at line <a class="el" href="Solv__Petsc_8cpp_source.html#l00050">50</a> of file <a class="el" href="Solv__Petsc_8cpp_source.html">Solv_Petsc.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="ae31a0568a126e0f38a6b3e961212c3b1"></a><!-- doxytag: member="Solv_Petsc::duplique" ref="ae31a0568a126e0f38a6b3e961212c3b1" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Solv_Petsc::duplique </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implements <a class="el" href="classSolveurSys__base.html#aaa95d97b4465988887c41e63bd7a88c6">SolveurSys_base</a>.</p>

<p>Reimplemented in <a class="el" href="classSolv__AMGX.html#af38933cb04269b9ed657bc8bcd6340c8">Solv_AMGX</a>, and <a class="el" href="classSolv__Petsc__GPU.html#a1201bb51610630de5bfddee2952f2bce">Solv_Petsc_GPU</a>.</p>

<p>Definition at line <a class="el" href="Solv__Petsc_8cpp_source.html#l00050">50</a> of file <a class="el" href="Solv__Petsc_8cpp_source.html">Solv_Petsc.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a5891704b11f18edf6ee99605a27d42c5"></a><!-- doxytag: member="Solv_Petsc::get_info" ref="a5891704b11f18edf6ee99605a27d42c5" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classType__info.html">Type_info</a> * Solv_Petsc::get_info </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Donne des informations sur le type de l'Objet_U. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>const Type_info*<br/>
 Signification: structure regroupant les informations sur le type de l'Objet_U<br/>
 Contraintes: </dd></dl>

<p>Reimplemented from <a class="el" href="classSolveurSys__base.html#a687dbcb7e9b470ca64b3d28d34d0d688">SolveurSys_base</a>.</p>

<p>Reimplemented in <a class="el" href="classSolv__AMGX.html#ac0ad97e52ef8ef85c676557253babcfb">Solv_AMGX</a>, and <a class="el" href="classSolv__Petsc__GPU.html#a5bf952648a807b5368a47763eef45017">Solv_Petsc_GPU</a>.</p>

<p>Definition at line <a class="el" href="Solv__Petsc_8cpp_source.html#l00050">50</a> of file <a class="el" href="Solv__Petsc_8cpp_source.html">Solv_Petsc.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a087b00129cb3d32c0dc80b82448cc0b3"></a><!-- doxytag: member="Solv_Petsc::info" ref="a087b00129cb3d32c0dc80b82448cc0b3" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classType__info.html">Type_info</a> * Solv_Petsc::info </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Donne des informations sur le type de l'Objet_U. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>const Type_info*<br/>
 Signification: structure regroupant les informations sur le type de l'Objet_U<br/>
 Contraintes: </dd></dl>

<p>Reimplemented from <a class="el" href="classSolveurSys__base.html#a209a57c94fc1a25d0f11f31ef036dfe4">SolveurSys_base</a>.</p>

<p>Reimplemented in <a class="el" href="classSolv__AMGX.html#a8c2a1377842a5a3ca5258c71490c1791">Solv_AMGX</a>, and <a class="el" href="classSolv__Petsc__GPU.html#add04c9c73e28b8746f02f818bcd95a77">Solv_Petsc_GPU</a>.</p>

<p>Definition at line <a class="el" href="Solv__Petsc_8cpp_source.html#l00050">50</a> of file <a class="el" href="Solv__Petsc_8cpp_source.html">Solv_Petsc.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="adceae0b645dc68471855a23b96529ee9"></a><!-- doxytag: member="Solv_Petsc::printOn" ref="adceae0b645dc68471855a23b96529ee9" args="(Sortie &amp;x) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classSortie.html">Sortie</a> &amp; Solv_Petsc::printOn </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classSortie.html">Sortie</a> &amp;&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td> const<code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Ecriture de l'objet sur un flot de sortie<br/>
Methode a surcharger. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd><a class="el" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp;<br/>
 Signification: flot de sortie modifie<br/>
 Contraintes: </dd></dl>

<p>Reimplemented from <a class="el" href="classSolveurSys__base.html#ae07d6f9692899e6c915ae6f18c830242">SolveurSys_base</a>.</p>

<p>Reimplemented in <a class="el" href="classSolv__AMGX.html#a4819ec8e97d758e6e1ead157bf208161">Solv_AMGX</a>, and <a class="el" href="classSolv__Petsc__GPU.html#a7041ec493e2a1238e79b7dba212257cc">Solv_Petsc_GPU</a>.</p>

<p>Definition at line <a class="el" href="Solv__Petsc_8cpp_source.html#l00053">53</a> of file <a class="el" href="Solv__Petsc_8cpp_source.html">Solv_Petsc.cpp</a>.</p>

<p>References <a class="el" href="Solv__Petsc_8h_source.html#l00161">chaine_lue_</a>.</p>
<div class="fragment"><pre class="fragment">{
  s &lt;&lt; <a class="code" href="classSolv__Petsc.html#a7a8cc27d5092ae780209ddb0059a2e29" title="Chaine des mots cles lus.">chaine_lue_</a>;
  <span class="keywordflow">return</span> s;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aaea15e1fc789f7ab84b759b11e73b314"></a><!-- doxytag: member="Solv_Petsc::read_matrix" ref="aaea15e1fc789f7ab84b759b11e73b314" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Solv_Petsc::read_matrix </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Solv__Petsc_8h_source.html#l00066">66</a> of file <a class="el" href="Solv__Petsc_8h_source.html">Solv_Petsc.h</a>.</p>

<p>References <a class="el" href="Solv__Petsc_8h_source.html#l00162">read_matrix_</a>.</p>
<div class="fragment"><pre class="fragment">  {
    <span class="keywordflow">return</span> <a class="code" href="classSolv__Petsc.html#a9c92c7b3025ccb3f301489141a442211" title="Read constant matrix in a file.">read_matrix_</a> == 1;
  }
</pre></div>
</div>
</div>
<a class="anchor" id="a43058b9e8c6070b68572b20eaafc1a39"></a><!-- doxytag: member="Solv_Petsc::readOn" ref="a43058b9e8c6070b68572b20eaafc1a39" args="(Entree &amp;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classEntree.html">Entree</a> &amp; Solv_Petsc::readOn </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classEntree.html">Entree</a> &amp;&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Lecture d'un <a class="el" href="classObjet__U.html" title="classe Objet_U Cette classe est la classe de base des Objets de TRUST Dans les classes derivees de Ob...">Objet_U</a> sur un flot d'entree<br/>
Methode a surcharger. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd><a class="el" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; s<br/>
 Signification: flot d'entree modifie<br/>
 Contraintes: </dd></dl>

<p>Reimplemented from <a class="el" href="classSolveurSys__base.html#aafbdb9c97a53176ba21f4788cfb90445">SolveurSys_base</a>.</p>

<p>Reimplemented in <a class="el" href="classSolv__AMGX.html#a1bc14743947df209e3eb50f53d612c96">Solv_AMGX</a>, and <a class="el" href="classSolv__Petsc__GPU.html#a6895aaef362a4db5babc6482a44e3dc5">Solv_Petsc_GPU</a>.</p>

<p>Definition at line <a class="el" href="Solv__Petsc_8cpp_source.html#l00060">60</a> of file <a class="el" href="Solv__Petsc_8cpp_source.html">Solv_Petsc.cpp</a>.</p>

<p>References <a class="el" href="Solv__Petsc_8cpp_source.html#l00087">create_solver()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="classSolv__Petsc.html#a35a8ad922fb450f5b693f9ce1e31875c">create_solver</a>(is);
  <span class="keywordflow">return</span> is;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a34cc0b975e06dc6df27f2cc6d89da2dd"></a><!-- doxytag: member="Solv_Petsc::reset" ref="a34cc0b975e06dc6df27f2cc6d89da2dd" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Solv_Petsc::reset </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Solv__Petsc_8h_source.html#l00192">192</a> of file <a class="el" href="Solv__Petsc_8h_source.html">Solv_Petsc.h</a>.</p>

<p>Referenced by <a class="el" href="Solv__Petsc_8h_source.html#l00186">~Solv_Petsc()</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="preprocessor">#ifdef PETSCKSP_H</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (SolveurPetsc_!=NULL)
    {
      KSPDestroy(&amp;SolveurPetsc_);
      finalize();
    }
  <span class="keywordflow">if</span> (MatricePetsc_!=NULL)
    {
<span class="comment">// Destruction des vecteurs</span>
      VecDestroy(&amp;SecondMembrePetsc_);
      VecDestroy(&amp;SolutionPetsc_);
      <span class="keywordflow">if</span> (LocalSolutionPetsc_!=NULL)
        {
          VecDestroy(&amp;LocalSolutionPetsc_);
          VecScatterDestroy(&amp;VecScatter_);
        }
<span class="comment">// Destruction matrice</span>
      MatDestroy(&amp;MatricePetsc_);
<span class="comment">// Destruction DM</span>
      <span class="keywordflow">if</span> (dm_!=NULL)
        DMDestroy(&amp;dm_);
    }
  initialize();
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div>
</div>
</div>
<a class="anchor" id="a93bea0874ab4fd2b24d063370db00dbe"></a><!-- doxytag: member="Solv_Petsc::resoudre_systeme" ref="a93bea0874ab4fd2b24d063370db00dbe" args="(const Matrice_Base &amp;, const DoubleVect &amp;, DoubleVect &amp;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Solv_Petsc::resoudre_systeme </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classMatrice__Base.html">Matrice_Base</a> &amp;&#160;</td>
          <td class="paramname"><em>la_matrice</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classDoubleVect.html">DoubleVect</a> &amp;&#160;</td>
          <td class="paramname"><em>secmem</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classDoubleVect.html">DoubleVect</a> &amp;&#160;</td>
          <td class="paramname"><em>solution</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implements <a class="el" href="classSolveurSys__base.html#a7c520c3aa574c8be3d3f27d4f700eac2">SolveurSys_base</a>.</p>

<p>Definition at line <a class="el" href="Solv__Petsc_8cpp_source.html#l01553">1553</a> of file <a class="el" href="Solv__Petsc_8cpp_source.html">Solv_Petsc.cpp</a>.</p>

<p>References <a class="el" href="ArrOfDouble_8h_source.html#l00379">ArrOfDouble::addr()</a>, <a class="el" href="ArrOfInt_8h_source.html#l00371">ArrOfInt::addr()</a>, <a class="el" href="Matrice__Base_8h_source.html#l00230">Matrice_Base::ajouter_multvect()</a>, <a class="el" href="Solv__Petsc_8h_source.html#l00164">amgx_</a>, <a class="el" href="Statistiques_8h_source.html#l00219">Statistiques::begin_count()</a>, <a class="el" href="Matrice__Bloc__Sym_8cpp_source.html#l00149">Matrice_Bloc_Sym::BlocSymToMatMorseSym()</a>, <a class="el" href="Matrice__Bloc_8cpp_source.html#l00636">Matrice_Bloc::BlocToMatMorse()</a>, <a class="el" href="EntreeSortie_8h_source.html#l00032">Cerr</a>, <a class="el" href="EntreeSortie_8h_source.html#l00033">Cout</a>, <a class="el" href="Matrice__Morse_8cpp_source.html#l00346">Matrice_Morse::dimensionner()</a>, <a class="el" href="DoubleVect_8cpp_source.html#l00277">DoubleVect::echange_espace_virtuel()</a>, <a class="el" href="Statistiques_8h_source.html#l00237">Statistiques::end_count()</a>, <a class="el" href="Process_8cpp_source.html#l00223">Process::exit()</a>, <a class="el" href="SolveurSys__base_8h_source.html#l00070">SolveurSys_base::fixer_nouvelle_matrice()</a>, <a class="el" href="Matrice__Bloc_8cpp_source.html#l00568">Matrice_Bloc::get_bloc()</a>, <a class="el" href="Matrice__Sym_8cpp_source.html#l00027">Matrice_Sym::get_est_definie()</a>, <a class="el" href="Solv__Petsc_8h_source.html#l00163">gpu_</a>, <a class="el" href="Solv__Petsc_8h_source.html#l00095">instance</a>, <a class="el" href="Process_8cpp_source.html#l00095">Process::je_suis_maitre()</a>, <a class="el" href="SolveurSys__base_8h_source.html#l00056">SolveurSys_base::limpr()</a>, <a class="el" href="ILU_8cpp_source.html#l00056">MorseSymToMorse()</a>, <a class="el" href="DoubleVect_8cpp_source.html#l02353">mp_norme_vect()</a>, <a class="el" href="Objet__U_8cpp_source.html#l00310">Objet_U::nom_du_cas()</a>, <a class="el" href="SolveurSys__base_8h_source.html#l00066">SolveurSys_base::nouvelle_matrice()</a>, <a class="el" href="Process_8cpp_source.html#l00109">Process::nproc()</a>, <a class="el" href="Objet__U_8cpp_source.html#l00132">Objet_U::que_suis_je()</a>, <a class="el" href="Solv__Petsc_8h_source.html#l00162">read_matrix_</a>, <a class="el" href="Cast_8h_source.html#l00059">ref_cast</a>, <a class="el" href="Cast_8h_source.html#l00062">ref_cast_non_const</a>, <a class="el" href="ArrOfDouble_8h_source.html#l00350">ArrOfDouble::size_array()</a>, <a class="el" href="stat__counters_8cpp_source.html#l00051">solv_sys_petsc_counter_</a>, <a class="el" href="Statistiques_8h_source.html#l00190">statistiques()</a>, <a class="el" href="Cast_8h_source.html#l00054">sub_type</a>, <a class="el" href="Op__Grad__EF_8cpp_source.html#l00099">test()</a>, and <a class="el" href="Deriv__Matrice__Base_8h_source.html#l00028">Deriv_Matrice_Base::valeur()</a>.</p>

<p>Referenced by <a class="el" href="Solv__Petsc_8h_source.html#l00060">resoudre_systeme()</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="preprocessor">#ifdef PETSCKSP_H</span>
<span class="preprocessor"></span><span class="comment">// Si on utilise un solver petsc on le signale pour les stats finales</span>
  <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#affcd058809786918ed173aaf681d0843">begin_count</a>(<a class="code" href="stat__counters_8cpp.html#a1374e3dd206f6a5ece6b44542e3edc34">solv_sys_petsc_counter_</a>);
  <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a0faf52d1b518f5b0b2177f22efcc222d" title="Arret du compteur counter_id. On ajoute quantity a la somme des &#39;quantity&#39; (par defaut 0) stockees po...">end_count</a>(<a class="code" href="stat__counters_8cpp.html#a1374e3dd206f6a5ece6b44542e3edc34">solv_sys_petsc_counter_</a>,1,1);
  std::clock_t start = std::clock();
  <span class="keywordflow">if</span> (<a class="code" href="classSolveurSys__base.html#a38702b1b2d16396977155f67cef5fe26">nouvelle_matrice</a>())
    {
      matrice_symetrique_ = 1;      <span class="comment">//!&lt; On suppose que la matrice est symetrique</span>
<span class="comment"></span>
<span class="comment">// Construction de la numerotation globale:</span>
      construit_renum(secmem);

<span class="comment">// Matrice morse intermedaire de conversion</span>
      <a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a> matrice_morse_intermediaire;
      <span class="keywordflow">if</span> (<a class="code" href="classSolv__Petsc.html#a9c92c7b3025ccb3f301489141a442211" title="Read constant matrix in a file.">read_matrix_</a>)
        {
<span class="comment">// New in 1.6.9, it is possible to read the matrix</span>
<span class="comment">// Read the PETSc matrix</span>
          RestoreMatrixFromFile();
          <span class="keywordtype">int</span> nb_local_rows, nb_local_cols;
          MatGetLocalSize(MatricePetsc_, &amp;nb_local_rows, &amp;nb_local_cols);
          <span class="keywordflow">if</span> (nb_local_rows != nb_items_to_keep_)
            {
              <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;The matrix read has &quot;</span> &lt;&lt; nb_local_rows &lt;&lt; <span class="stringliteral">&quot; local columns whereas&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
              <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;the RHS/Solution vectors have a size of &quot;</span> &lt;&lt; nb_items_to_keep_ &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; finl;
              <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Check your data file or the file containing the PETSc matrix.&quot;</span> &lt;&lt; finl;
              <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
            }
        }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classMatrice__Petsc.html">Matrice_Petsc</a>, la_matrice))
        {
<span class="comment">// Matrice deja au format Petsc</span>
          MatricePetsc_ = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classMatrice__Petsc.html">Matrice_Petsc</a>, la_matrice).getMat();
          <a class="code" href="classSolv__Petsc.html#a9c92c7b3025ccb3f301489141a442211" title="Read constant matrix in a file.">read_matrix_</a> = 1; <span class="comment">//!&lt; flag reutilise comme si on avait lu la matrice</span>
<span class="comment"></span>        }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classMatrice__Morse__Sym.html" title="Classe Matrice_Morse_Sym Represente une matrice M (creuse) symetrique stockee au format Morse Symetri...">Matrice_Morse_Sym</a>, la_matrice))
        {
<span class="comment">// Exemple: matrice de pression en VEFPreP1B</span>
          <span class="keyword">const</span> <a class="code" href="classMatrice__Morse__Sym.html" title="Classe Matrice_Morse_Sym Represente une matrice M (creuse) symetrique stockee au format Morse Symetri...">Matrice_Morse_Sym</a>&amp; matrice_morse_sym = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classMatrice__Morse__Sym.html" title="Classe Matrice_Morse_Sym Represente une matrice M (creuse) symetrique stockee au format Morse Symetri...">Matrice_Morse_Sym</a>, la_matrice);
          assert(matrice_morse_sym.<a class="code" href="classMatrice__Sym.html#a5cbcf1c7de27ffb81664ea574a37ebdc">get_est_definie</a>());
          <a class="code" href="ILU_8cpp.html#af795a7defe79185059ecd10e52645585">MorseSymToMorse</a>(matrice_morse_sym, matrice_morse_intermediaire);
        }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classMatrice__Bloc__Sym.html">Matrice_Bloc_Sym</a>, la_matrice))
        {
<span class="comment">// Exemple : matrice de pression en VEF P0+P1+Pa</span>
          <span class="keyword">const</span> <a class="code" href="classMatrice__Bloc__Sym.html">Matrice_Bloc_Sym</a>&amp; matrice = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classMatrice__Bloc__Sym.html">Matrice_Bloc_Sym</a>, la_matrice);
<span class="comment">// Conversion de la matrice Matrice_Bloc_Sym au format Matrice_Morse_Sym</span>
          <a class="code" href="classMatrice__Morse__Sym.html" title="Classe Matrice_Morse_Sym Represente une matrice M (creuse) symetrique stockee au format Morse Symetri...">Matrice_Morse_Sym</a> matrice_morse_sym;
          matrice.<a class="code" href="classMatrice__Bloc__Sym.html#a96c35afa279fe2fed65738f0afd7f16e">BlocSymToMatMorseSym</a>(matrice_morse_sym);
          <a class="code" href="ILU_8cpp.html#af795a7defe79185059ecd10e52645585">MorseSymToMorse</a>(matrice_morse_sym, matrice_morse_intermediaire);
          matrice_morse_sym.<a class="code" href="classMatrice__Morse.html#ae95f9ed88a8a3fc637cd2a705cead9c8" title="Size the matrix with n lines and n columns and nnz zero-values coefficients.">dimensionner</a>(0, 0); <span class="comment">//!&lt; Destruction de la matrice morse sym desormais inutile</span>
<span class="comment"></span>        }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a>, la_matrice))
        {
<span class="comment">// Exemple : matrice implicite</span>
          matrice_symetrique_ = 0;
        }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classMatrice__Bloc.html">Matrice_Bloc</a>, la_matrice))
        {
<span class="comment">// Exemple : matrice de pression en VDF</span>
          <span class="keyword">const</span> <a class="code" href="classMatrice__Bloc.html">Matrice_Bloc</a>&amp; matrice_bloc = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classMatrice__Bloc.html">Matrice_Bloc</a>, la_matrice);
          <span class="keywordflow">if</span> (!<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classMatrice__Morse__Sym.html" title="Classe Matrice_Morse_Sym Represente une matrice M (creuse) symetrique stockee au format Morse Symetri...">Matrice_Morse_Sym</a>, matrice_bloc.<a class="code" href="classMatrice__Bloc.html#a7ffa38f7b93454432b2df7c616ed0a4e">get_bloc</a>(0, 0).<a class="code" href="classDeriv__Matrice__Base.html#ae43f3a90ca16518c191f9e7d5ebef912">valeur</a>()))
            matrice_symetrique_ = 0;
          <span class="keywordflow">else</span>
            {
<span class="comment">// Pour un solveur direct, operation si la matrice n&#39;est pas definie (en incompressible VDF, rien n&#39;etait fait...)</span>
              <a class="code" href="classMatrice__Morse__Sym.html" title="Classe Matrice_Morse_Sym Represente une matrice M (creuse) symetrique stockee au format Morse Symetri...">Matrice_Morse_Sym</a>&amp; mat00 = <a class="code" href="Cast_8h.html#ad3836a067c92103af8df5ad8f35959a6">ref_cast_non_const</a>(<a class="code" href="classMatrice__Morse__Sym.html" title="Classe Matrice_Morse_Sym Represente une matrice M (creuse) symetrique stockee au format Morse Symetri...">Matrice_Morse_Sym</a>, matrice_bloc.<a class="code" href="classMatrice__Bloc.html#a7ffa38f7b93454432b2df7c616ed0a4e">get_bloc</a>(0, 0).<a class="code" href="classDeriv__Matrice__Base.html#ae43f3a90ca16518c191f9e7d5ebef912">valeur</a>());
              <span class="keywordflow">if</span> (<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6">solveur_direct_</a> &amp;&amp; mat00.<a class="code" href="classMatrice__Sym.html#a5cbcf1c7de27ffb81664ea574a37ebdc">get_est_definie</a>() == 0 &amp;&amp; <a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
                mat00(0, 0) *= 2;
            }
          matrice_bloc.<a class="code" href="classMatrice__Bloc.html#ae4f204b5e4a9e70301e459233150e07f">BlocToMatMorse</a>(matrice_morse_intermediaire);
        }
      <span class="keywordflow">else</span>
        {
          <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Solv_Petsc : Warning, we do not know yet treat a matrix of type &quot;</span> &lt;&lt; la_matrice.<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>()
               &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
          <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
        }
      <span class="keywordflow">if</span> (<a class="code" href="Solv__Petsc_8cpp.html#ab3f078684998b83967d507d0f453f454">verbose</a>) <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;[Petsc] Time to convert matrix: &quot;</span> &lt;&lt; (std::clock() - start) / (<span class="keywordtype">double</span>) CLOCKS_PER_SEC &lt;&lt; finl;

<span class="comment">// Verification stockage de la matrice</span>
      check_aij(matrice_morse_intermediaire);

      <span class="keywordtype">bool</span> la_matrice_est_morse_non_symetrique =
        <a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a>, la_matrice) &amp;&amp; !<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classMatrice__Morse__Sym.html" title="Classe Matrice_Morse_Sym Represente une matrice M (creuse) symetrique stockee au format Morse Symetri...">Matrice_Morse_Sym</a>, la_matrice);
      const Matrice_Morse&amp; matrice_morse = la_matrice_est_morse_non_symetrique ? <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(Matrice_Morse, la_matrice)
                                           : matrice_morse_intermediaire;

<span class="comment">// Verification stencil de la matrice</span>
      nouveau_stencil_ = (MatricePetsc_ == NULL ? true : check_stencil(matrice_morse));

      if (SecondMembrePetsc_ == NULL)
        {
<span class="comment">// Build x and b during the first matrix creation</span>
          Create_vectors(secmem);
<span class="comment">// Creation de Champs (fields) pour pouvoir utiliser des preconditionneurs PCFIELDSPLIT</span>
          Create_DM(secmem);
        }
<span class="comment">// Construit ou update la matrice</span>
      <span class="keywordflow">if</span> (nouveau_stencil_)
        Create_objects(matrice_morse);
      <span class="keywordflow">else</span>
        Update_matrix(MatricePetsc_, matrice_morse);
      <span class="keywordflow">if</span> (<a class="code" href="classSolveurSys__base.html#ab3ef68bcf4e1b402c52905aa78728aef">limpr</a>() == 1)
        {
          <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;Order of the PETSc matrix : &quot;</span> &lt;&lt; nb_rows_tot_ &lt;&lt; <span class="stringliteral">&quot; (~ &quot;</span>
               &lt;&lt; (petsc_cpus_selection_ ? (int) (nb_rows_tot_ / petsc_nb_cpus_) : nb_rows_)
               &lt;&lt; <span class="stringliteral">&quot; unknowns per PETSc process ) &quot;</span> &lt;&lt; (nouveau_stencil_ ? <span class="stringliteral">&quot;New stencil.&quot;</span> : <span class="stringliteral">&quot;Same stencil.&quot;</span>) &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
        }
    }
  start = std::clock();
<span class="comment">// Assemblage du second membre et de la solution</span>
<span class="comment">// ToDo calculer ix au moment de item_to_keep_</span>
  <span class="keywordtype">int</span> size=secmem.<a class="code" href="classArrOfDouble.html#a3c3b33bea0e88b87315c21ee94bee05f" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
  <span class="keywordtype">int</span> colonne_globale=decalage_local_global_;
  <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> ix(size);
  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;size; i++)
    <span class="keywordflow">if</span> (items_to_keep_[i])
      {
        ix[i] = colonne_globale;
        colonne_globale++;
      }
    <span class="keywordflow">else</span>
      ix[i] = -1;
  VecSetOption(SecondMembrePetsc_, VEC_IGNORE_NEGATIVE_INDICES, PETSC_TRUE);
  VecSetValues(SecondMembrePetsc_, size, ix.addr(), secmem.<a class="code" href="classArrOfDouble.html#a95357a1390c11dbd481d385257f2e983" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>(), INSERT_VALUES);
  VecSetOption(SolutionPetsc_, VEC_IGNORE_NEGATIVE_INDICES, PETSC_TRUE);
  VecSetValues(SolutionPetsc_, size, ix.addr(), solution.<a class="code" href="classArrOfDouble.html#a95357a1390c11dbd481d385257f2e983" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>(), INSERT_VALUES);
  VecAssemblyBegin(SecondMembrePetsc_);
  VecAssemblyEnd(SecondMembrePetsc_);
  VecAssemblyBegin(SolutionPetsc_);
  VecAssemblyEnd(SolutionPetsc_);
  <span class="keywordflow">if</span> (<a class="code" href="Solv__Petsc_8cpp.html#ab3f078684998b83967d507d0f453f454">verbose</a>) <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;[Petsc] Time to update vectors: &quot;</span> &lt;&lt; (std::clock() - start) / (<span class="keywordtype">double</span>) CLOCKS_PER_SEC &lt;&lt; finl;

<span class="comment">// VecView(SecondMembrePetsc_,PETSC_VIEWER_STDOUT_WORLD);</span>
<span class="comment">// VecView(SolutionPetsc_,PETSC_VIEWER_STDOUT_WORLD);</span>

<span class="comment">// Save the matrix and the RHS</span>
<span class="comment">// if the matrix has changed...</span>
  if (<a class="code" href="classSolveurSys__base.html#a38702b1b2d16396977155f67cef5fe26">nouvelle_matrice</a>())
    {
      start = std::clock();
      <span class="keywordflow">if</span> (save_matrix_==1)
        SaveObjectsToFile();
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (save_matrix_==2)
        {
<span class="comment">// Format matrix market ToDo : method</span>
          <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>()&gt;1) <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>(<span class="stringliteral">&quot;Error, matrix market format is not available yet in parallel.&quot;</span>);
          <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> filename(<a class="code" href="classObjet__U.html#a7c27c4f80259eeef76ff8fe2d3bc61f7" title="Renvoie une reference constante vers le nom du cas. Cette methode est statique.">Objet_U::nom_du_cas</a>());
          filename+=<span class="stringliteral">&quot;_matrix&quot;</span>;
          filename+=(<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>)<a class="code" href="classSolv__Petsc.html#a7384c2681936b980c3fa393793e47e87" title="Nombre d&#39;instances en cours de la classe.">instance</a>;
          filename+=<span class="stringliteral">&quot;.mtx&quot;</span>;
          <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a> mtx(filename);
          PetscInt rows;
          <span class="keyword">const</span> PetscInt *ia, *ja;
          PetscBool done;
          MatGetRowIJ(MatricePetsc_, 0, PETSC_FALSE, PETSC_FALSE, &amp;rows, &amp;ia, &amp;ja, &amp;done);
          <span class="keywordflow">if</span> (!done) <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>(<span class="stringliteral">&quot;Error in MatGetRowIJ&quot;</span>);
          PetscScalar *v;
          MatType mat_type;
          MatGetType(MatricePetsc_,&amp;mat_type);
          <span class="keywordflow">if</span> (strcmp(mat_type,MATSEQAIJ)==0)
            MatSeqAIJGetArray(MatricePetsc_, &amp;v);
          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(mat_type,MATSEQSBAIJ)==0)
            MatSeqSBAIJGetArray(MatricePetsc_, &amp;v);
          <span class="keywordflow">else</span> <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>(<span class="stringliteral">&quot;Matrix type not supported.&quot;</span>);
          <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Matrix (&quot;</span> &lt;&lt; rows &lt;&lt; <span class="stringliteral">&quot; lines) written into file with RHS and solution: &quot;</span> &lt;&lt; filename &lt;&lt; finl;
          mtx &lt;&lt; <span class="stringliteral">&quot;%%MatrixMarket matrix coordinate real general&quot;</span> &lt;&lt; finl;
          mtx &lt;&lt; <span class="stringliteral">&quot;%%AMGX rhs solution&quot;</span> &lt;&lt; finl;
          mtx &lt;&lt; rows &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; rows &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; ia[rows] &lt;&lt; finl;
          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> row=0; row&lt;rows; row++)
            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=ia[row]; j&lt;ia[row+1]; j++)
              mtx &lt;&lt; row+1 &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; ja[j]+1 &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; v[j] &lt;&lt; finl;
          mtx &lt;&lt; <span class="stringliteral">&quot;%%&quot;</span> &lt;&lt; finl &lt;&lt; <span class="stringliteral">&quot;%% optional rhs &quot;</span> &lt;&lt; secmem.<a class="code" href="classArrOfDouble.html#a3c3b33bea0e88b87315c21ee94bee05f" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>() &lt;&lt; finl;
          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;secmem.<a class="code" href="classArrOfDouble.html#a3c3b33bea0e88b87315c21ee94bee05f" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>(); i++)
            mtx &lt;&lt; secmem(i) &lt;&lt; finl;
          mtx &lt;&lt; <span class="stringliteral">&quot;%%&quot;</span> &lt;&lt; finl &lt;&lt; <span class="stringliteral">&quot;%% optional solution &quot;</span> &lt;&lt; solution.<a class="code" href="classArrOfDouble.html#a3c3b33bea0e88b87315c21ee94bee05f" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>() &lt;&lt; finl;
          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;solution.<a class="code" href="classArrOfDouble.html#a3c3b33bea0e88b87315c21ee94bee05f" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>(); i++)
            mtx &lt;&lt; solution(i) &lt;&lt; finl;
        }
      <span class="keywordflow">if</span> (save_matrix_ &amp;&amp; <a class="code" href="Solv__Petsc_8cpp.html#ab3f078684998b83967d507d0f453f454">verbose</a>) <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;[Petsc] Time to write matrix: &quot;</span> &lt;&lt; (std::clock() - start) / (<span class="keywordtype">double</span>) CLOCKS_PER_SEC &lt;&lt; finl;
    }
<span class="comment">//</span>
<span class="comment">// Solve the linear system</span>
<span class="comment">//</span>
  PetscLogStagePush(KSPSolve_Stage_);
  <span class="keywordtype">int</span> size_residu = nb_it_max_ + 1;
<span class="comment">// DoubleTrav residu(size_residu); // bad_alloc sur gros cas, curie pourquoi ?</span>
  <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> residu(size_residu);
  start = std::clock();
  <span class="keywordtype">int</span> nbiter = solve(residu);
  if (<a class="code" href="Solv__Petsc_8cpp.html#ab3f078684998b83967d507d0f453f454">verbose</a>) <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; &quot;[Petsc] <a class="code" href="classTime.html">Time</a> to solve system: &quot; &lt;&lt; (std::clock() - start) / (<span class="keywordtype">double</span>) CLOCKS_PER_SEC &lt;&lt; finl;
  if (<a class="code" href="classSolveurSys__base.html#ab3ef68bcf4e1b402c52905aa78728aef">limpr</a>()&gt;-1)
    {
      <span class="keywordtype">double</span> residu_relatif=(residu(0)&gt;0?residu(nbiter)/residu(0):residu(nbiter));
      <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; finl &lt;&lt; <span class="stringliteral">&quot;Final residue: &quot;</span> &lt;&lt; residu(nbiter) &lt;&lt; <span class="stringliteral">&quot; ( &quot;</span> &lt;&lt; residu_relatif &lt;&lt; <span class="stringliteral">&quot; )&quot;</span>&lt;&lt;finl;
    }

<span class="comment">// Recuperation de la solution</span>
  start = std::clock();
<span class="comment">// ToDo un seul VecGetValues comme VecSetValues</span>
  <span class="keywordflow">if</span> (different_partition_)
    {
<span class="comment">// TRUST and PETSc has different partition, a local vector LocalSolutionPetsc_ is gathered from the global vector SolutionPetsc_ :</span>
      VecScatterBegin(VecScatter_, SolutionPetsc_, LocalSolutionPetsc_, INSERT_VALUES, SCATTER_FORWARD);
      VecScatterEnd  (VecScatter_, SolutionPetsc_, LocalSolutionPetsc_, INSERT_VALUES, SCATTER_FORWARD);
<span class="comment">// Use the local vector to get the solution:</span>
      <span class="keywordtype">int</span> colonne_locale=0;
      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;size; i++)
        <span class="keywordflow">if</span> (items_to_keep_[i])
          {
            VecGetValues(LocalSolutionPetsc_, 1, &amp;colonne_locale, &amp;solution(i));
            colonne_locale++;
          }
      assert(nb_rows_==colonne_locale);
    }
  <span class="keywordflow">else</span>
    {
<span class="comment">// TRUST and PETSc has same partition, local solution can be accessed from the global vector:</span>
      VecGetValues(SolutionPetsc_, size, ix.addr(), solution.<a class="code" href="classArrOfDouble.html#a95357a1390c11dbd481d385257f2e983" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>());
    }
  solution.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
  <a class="code" href="classSolveurSys__base.html#afcf2c99ad548e18c61cdade93a2e1978">fixer_nouvelle_matrice</a>(0);
  <span class="keywordflow">if</span> (<a class="code" href="Solv__Petsc_8cpp.html#ab3f078684998b83967d507d0f453f454">verbose</a>) <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; finl &lt;&lt; <span class="stringliteral">&quot;[Petsc] Time to update solution: &quot;</span> &lt;&lt; (std::clock() - start) / (<span class="keywordtype">double</span>) CLOCKS_PER_SEC &lt;&lt; finl;
<span class="comment">// Calcul du vrai residu sur matrice initiale sur GPU:</span>
  if (<a class="code" href="classSolv__Petsc.html#a4a4d7d01f00900e4c2ad771be5e6725b" title="Utilisation des solveurs GPU de AMGX.">amgx_</a> || <a class="code" href="classSolv__Petsc.html#a5f603c229087d42c8bb2fee48290526f" title="Utilisation des solveurs GPU de PETSc.">gpu_</a>)
    {
      <a class="code" href="classDoubleVect.html">DoubleVect</a> <a class="code" href="Op__Grad__EF_8cpp.html#abc0897c211f7aa4541da5833388f868b">test</a>(secmem);
      <a class="code" href="Op__Grad__EF_8cpp.html#abc0897c211f7aa4541da5833388f868b">test</a>*=-1;
      la_matrice.<a class="code" href="classMatrice__Base.html#a6ccb4d20d3877cf09f5178ff72af5406" title="Operation de multiplication-accumulation (saxpy) matrice vecteur. Operation: r = r + A*x...">ajouter_multvect</a>(solution,<a class="code" href="Op__Grad__EF_8cpp.html#abc0897c211f7aa4541da5833388f868b">test</a>);
      <span class="keywordtype">double</span> vrai_residu = <a class="code" href="DoubleVect_8cpp.html#afaa33f0032aa927d8d54ff9fb002b749">mp_norme_vect</a>(<a class="code" href="Op__Grad__EF_8cpp.html#abc0897c211f7aa4541da5833388f868b">test</a>);
      <span class="keywordflow">if</span> (<a class="code" href="Solv__Petsc_8cpp.html#ab3f078684998b83967d507d0f453f454">verbose</a>) <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;||Ax-b||=&quot;</span> &lt;&lt; vrai_residu &lt;&lt; finl;
<span class="comment">// Verification de la solution sur la matrice initiale</span>
      <span class="keywordflow">if</span> (nbiter&gt;0 &amp;&amp; <a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
        {
          <span class="keywordtype">double</span> precision_machine=1.e-12;
          <span class="keywordflow">if</span> (residu(0)&gt;0 &amp;&amp; residu(nbiter)/residu(0)&gt;precision_machine &amp;&amp; vrai_residu&gt;10*residu(nbiter))
            {
              <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error, computed solution x is false !&quot;</span> &lt;&lt; finl;
              <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;True residual (&quot;</span> &lt;&lt; vrai_residu &lt;&lt; <span class="stringliteral">&quot;) is much higher than convergence residual (&quot;</span> &lt;&lt; residu(nbiter) &lt;&lt; <span class="stringliteral">&quot;) !&quot;</span> &lt;&lt; finl;
              <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
            }
        }
    }
  <span class="keywordflow">return</span> nbiter;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>  <span class="keywordflow">return</span> -1;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div>
</div>
</div>
<a class="anchor" id="a0058b2973d709356eaf749c067bfcf9b"></a><!-- doxytag: member="Solv_Petsc::resoudre_systeme" ref="a0058b2973d709356eaf749c067bfcf9b" args="(const Matrice_Base &amp;M, const DoubleVect &amp;A, DoubleVect &amp;B, int niter_max)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Solv_Petsc::resoudre_systeme </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classMatrice__Base.html">Matrice_Base</a> &amp;&#160;</td>
          <td class="paramname"><em>M</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classDoubleVect.html">DoubleVect</a> &amp;&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classDoubleVect.html">DoubleVect</a> &amp;&#160;</td>
          <td class="paramname"><em>B</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>niter_max</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="classSolveurSys__base.html#a8c42bf5160d595afada02074ccc7f91e">SolveurSys_base</a>.</p>

<p>Definition at line <a class="el" href="Solv__Petsc_8h_source.html#l00060">60</a> of file <a class="el" href="Solv__Petsc_8h_source.html">Solv_Petsc.h</a>.</p>

<p>References <a class="el" href="Solv__Petsc_8cpp_source.html#l01553">resoudre_systeme()</a>.</p>
<div class="fragment"><pre class="fragment">  {
    <span class="keywordflow">return</span> <a class="code" href="classSolv__Petsc.html#a93bea0874ab4fd2b24d063370db00dbe">resoudre_systeme</a>(M,A,B);
  };
</pre></div>
</div>
</div>
<a class="anchor" id="a2342bd9d6104c4b2b3bad510c80dfa62"></a><!-- doxytag: member="Solv_Petsc::self_cast" ref="a2342bd9d6104c4b2b3bad510c80dfa62" args="(Objet_U &amp;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classSolv__Petsc.html">Solv_Petsc</a> &amp; Solv_Petsc::self_cast </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classObjet__U.html">Objet_U</a> &amp;&#160;</td>
          <td class="paramname"><em>r</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="classSolveurSys__base.html#a3f439678e84851cbd4c84ce4ec8cfa88">SolveurSys_base</a>.</p>

<p>Reimplemented in <a class="el" href="classSolv__AMGX.html#a2a4b05566ac1db21ca1f325fa81f456a">Solv_AMGX</a>, and <a class="el" href="classSolv__Petsc__GPU.html#a0767edfadb645e00ce17e5efee22b28f">Solv_Petsc_GPU</a>.</p>

<p>Definition at line <a class="el" href="Solv__Petsc_8cpp_source.html#l00050">50</a> of file <a class="el" href="Solv__Petsc_8cpp_source.html">Solv_Petsc.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a43744d82ddacef9206d3ff4110d87a0e"></a><!-- doxytag: member="Solv_Petsc::self_cast" ref="a43744d82ddacef9206d3ff4110d87a0e" args="(const Objet_U &amp;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classSolv__Petsc.html">Solv_Petsc</a> &amp; Solv_Petsc::self_cast </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classObjet__U.html">Objet_U</a> &amp;&#160;</td>
          <td class="paramname"><em>obj</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>methode ajoutee pour caster en python </p>

<p>Reimplemented from <a class="el" href="classSolveurSys__base.html#a9f2d875f944f667eb18462c1f2f3cee2">SolveurSys_base</a>.</p>

<p>Reimplemented in <a class="el" href="classSolv__AMGX.html#ae7eb852bd84031648ee0255b14709ba4">Solv_AMGX</a>, and <a class="el" href="classSolv__Petsc__GPU.html#a1cf5f6355398bef6b9833ef45f857ff1">Solv_Petsc_GPU</a>.</p>

<p>Definition at line <a class="el" href="Solv__Petsc_8cpp_source.html#l00050">50</a> of file <a class="el" href="Solv__Petsc_8cpp_source.html">Solv_Petsc.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a72437dd540e559da6f6827747036b920"></a><!-- doxytag: member="Solv_Petsc::solveur_direct" ref="a72437dd540e559da6f6827747036b920" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Solv_Petsc::solveur_direct </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implements <a class="el" href="classSolveurSys__base.html#aea9eaa90ad23a5dfcace9d6cd74de4ea">SolveurSys_base</a>.</p>

<p>Definition at line <a class="el" href="Solv__Petsc_8h_source.html#l00055">55</a> of file <a class="el" href="Solv__Petsc_8h_source.html">Solv_Petsc.h</a>.</p>
<div class="fragment"><pre class="fragment">  {
    <span class="keywordflow">return</span> (<a class="code" href="Solv__Petsc_8h.html#a5a0a487c7e0e114f4d92a88e2a5808b6">solveur_direct_</a>&gt;0);
  };
</pre></div>
</div>
</div>
<a class="anchor" id="a7bd2dfc9c0015eb7f0c6d395ab3216a8"></a><!-- doxytag: member="Solv_Petsc::taille_memoire" ref="a7bd2dfc9c0015eb7f0c6d395ab3216a8" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned Solv_Petsc::taille_memoire </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implements <a class="el" href="classObjet__U.html#a0ee0946339f09a2c73c09fcda71c3be2">Objet_U</a>.</p>

<p>Reimplemented in <a class="el" href="classSolv__AMGX.html#ac665615741aede99b53e1900d9525fc3">Solv_AMGX</a>, and <a class="el" href="classSolv__Petsc__GPU.html#ae7087859e3ebe0e9e88bdcd6ca86e6eb">Solv_Petsc_GPU</a>.</p>

<p>Definition at line <a class="el" href="Solv__Petsc_8cpp_source.html#l00050">50</a> of file <a class="el" href="Solv__Petsc_8cpp_source.html">Solv_Petsc.cpp</a>.</p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a45df7a11f976ea94cbb622ae8fcbd181"></a><!-- doxytag: member="Solv_Petsc::allow_realloc_" ref="a45df7a11f976ea94cbb622ae8fcbd181" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classSolv__Petsc.html#a45df7a11f976ea94cbb622ae8fcbd181">Solv_Petsc::allow_realloc_</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Solv__Petsc_8h_source.html#l00170">170</a> of file <a class="el" href="Solv__Petsc_8h_source.html">Solv_Petsc.h</a>.</p>

<p>Referenced by <a class="el" href="Solv__Petsc_8cpp_source.html#l00087">create_solver()</a>.</p>

</div>
</div>
<a class="anchor" id="a4a4d7d01f00900e4c2ad771be5e6725b"></a><!-- doxytag: member="Solv_Petsc::amgx_" ref="a4a4d7d01f00900e4c2ad771be5e6725b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classSolv__Petsc.html#a4a4d7d01f00900e4c2ad771be5e6725b">Solv_Petsc::amgx_</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Utilisation des solveurs GPU de AMGX. </p>

<p>Definition at line <a class="el" href="Solv__Petsc_8h_source.html#l00164">164</a> of file <a class="el" href="Solv__Petsc_8h_source.html">Solv_Petsc.h</a>.</p>

<p>Referenced by <a class="el" href="Solv__Petsc_8cpp_source.html#l01310">config()</a>, <a class="el" href="Solv__Petsc_8cpp_source.html#l00087">create_solver()</a>, <a class="el" href="Solv__Petsc_8cpp_source.html#l01553">resoudre_systeme()</a>, and <a class="el" href="Solv__AMGX_8h_source.html#l00037">Solv_AMGX::Solv_AMGX()</a>.</p>

</div>
</div>
<a class="anchor" id="a7244784294055ac6cd06c16d5d7264e7"></a><!-- doxytag: member="Solv_Petsc::amgx_initialized_" ref="a7244784294055ac6cd06c16d5d7264e7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classSolv__Petsc.html#a7244784294055ac6cd06c16d5d7264e7">Solv_Petsc::amgx_initialized_</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Amgx initialise Options dev: </p>

<p>Definition at line <a class="el" href="Solv__Petsc_8h_source.html#l00166">166</a> of file <a class="el" href="Solv__Petsc_8h_source.html">Solv_Petsc.h</a>.</p>

</div>
</div>
<a class="anchor" id="a7a8cc27d5092ae780209ddb0059a2e29"></a><!-- doxytag: member="Solv_Petsc::chaine_lue_" ref="a7a8cc27d5092ae780209ddb0059a2e29" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classNom.html">Nom</a> <a class="el" href="classSolv__Petsc.html#a7a8cc27d5092ae780209ddb0059a2e29">Solv_Petsc::chaine_lue_</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Chaine des mots cles lus. </p>

<p>Definition at line <a class="el" href="Solv__Petsc_8h_source.html#l00161">161</a> of file <a class="el" href="Solv__Petsc_8h_source.html">Solv_Petsc.h</a>.</p>

<p>Referenced by <a class="el" href="Solv__Petsc__GPU_8cpp_source.html#l00028">Solv_Petsc_GPU::printOn()</a>, <a class="el" href="Solv__Petsc_8cpp_source.html#l00053">printOn()</a>, and <a class="el" href="Solv__AMGX_8cpp_source.html#l00030">Solv_AMGX::printOn()</a>.</p>

</div>
</div>
<a class="anchor" id="af13cee34da6194e79945d3a950ee2ed0"></a><!-- doxytag: member="Solv_Petsc::clean_matrix_" ref="af13cee34da6194e79945d3a950ee2ed0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classSolv__Petsc.html#af13cee34da6194e79945d3a950ee2ed0">Solv_Petsc::clean_matrix_</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Solv__Petsc_8h_source.html#l00171">171</a> of file <a class="el" href="Solv__Petsc_8h_source.html">Solv_Petsc.h</a>.</p>

<p>Referenced by <a class="el" href="Solv__Petsc_8cpp_source.html#l00087">create_solver()</a>.</p>

</div>
</div>
<a class="anchor" id="a5f603c229087d42c8bb2fee48290526f"></a><!-- doxytag: member="Solv_Petsc::gpu_" ref="a5f603c229087d42c8bb2fee48290526f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classSolv__Petsc.html#a5f603c229087d42c8bb2fee48290526f">Solv_Petsc::gpu_</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Utilisation des solveurs GPU de PETSc. </p>

<p>Definition at line <a class="el" href="Solv__Petsc_8h_source.html#l00163">163</a> of file <a class="el" href="Solv__Petsc_8h_source.html">Solv_Petsc.h</a>.</p>

<p>Referenced by <a class="el" href="Solv__Petsc_8cpp_source.html#l00087">create_solver()</a>, <a class="el" href="Solv__Petsc_8cpp_source.html#l01553">resoudre_systeme()</a>, and <a class="el" href="Solv__Petsc__GPU_8h_source.html#l00032">Solv_Petsc_GPU::Solv_Petsc_GPU()</a>.</p>

</div>
</div>
<a class="anchor" id="a1d87d8f7f3be6d318bc343e11059cde2"></a><!-- doxytag: member="Solv_Petsc::ignore_new_nonzero_" ref="a1d87d8f7f3be6d318bc343e11059cde2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classSolv__Petsc.html#a1d87d8f7f3be6d318bc343e11059cde2">Solv_Petsc::ignore_new_nonzero_</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Solv__Petsc_8h_source.html#l00168">168</a> of file <a class="el" href="Solv__Petsc_8h_source.html">Solv_Petsc.h</a>.</p>

<p>Referenced by <a class="el" href="Solv__Petsc_8cpp_source.html#l00087">create_solver()</a>.</p>

</div>
</div>
<a class="anchor" id="ad42f3219e151e30710029b64f9f3b5b7"></a><!-- doxytag: member="Solv_Petsc::info_obj" ref="ad42f3219e151e30710029b64f9f3b5b7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classType__info.html">Type_info</a> <a class="el" href="classSolv__Petsc.html#ad42f3219e151e30710029b64f9f3b5b7">Solv_Petsc::info_obj</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="classSolveurSys__base.html#a167e7e2a82985b5cbf226ecbc4dd6d20">SolveurSys_base</a>.</p>

<p>Reimplemented in <a class="el" href="classSolv__AMGX.html#a01b45b79059b699e08d7d93329c9c611">Solv_AMGX</a>, and <a class="el" href="classSolv__Petsc__GPU.html#aa23a0d79572eb2edaac26b74ee379cfa">Solv_Petsc_GPU</a>.</p>

<p>Definition at line <a class="el" href="Solv__Petsc_8h_source.html#l00049">49</a> of file <a class="el" href="Solv__Petsc_8h_source.html">Solv_Petsc.h</a>.</p>

</div>
</div>
<a class="anchor" id="a7384c2681936b980c3fa393793e47e87"></a><!-- doxytag: member="Solv_Petsc::instance" ref="a7384c2681936b980c3fa393793e47e87" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classSolv__Petsc.html#a7384c2681936b980c3fa393793e47e87">Solv_Petsc::instance</a> = -1<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Nombre d'instances en cours de la classe. </p>

<p>Definition at line <a class="el" href="Solv__Petsc_8h_source.html#l00095">95</a> of file <a class="el" href="Solv__Petsc_8h_source.html">Solv_Petsc.h</a>.</p>

<p>Referenced by <a class="el" href="Solv__Petsc_8cpp_source.html#l01310">config()</a>, <a class="el" href="Solv__Petsc_8cpp_source.html#l01553">resoudre_systeme()</a>, <a class="el" href="Solv__Petsc_8h_source.html#l00176">Solv_Petsc()</a>, and <a class="el" href="Solv__Petsc_8h_source.html#l00186">~Solv_Petsc()</a>.</p>

</div>
</div>
<a class="anchor" id="acc3475bd78fb4ceace2d10ff68de1dd8"></a><!-- doxytag: member="Solv_Petsc::numero_solveur" ref="acc3475bd78fb4ceace2d10ff68de1dd8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classSolv__Petsc.html#acc3475bd78fb4ceace2d10ff68de1dd8">Solv_Petsc::numero_solveur</a> = 0<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Compte les solveurs crees et utilises pour le prefix des options. </p>

<p>Definition at line <a class="el" href="Solv__Petsc_8h_source.html#l00096">96</a> of file <a class="el" href="Solv__Petsc_8h_source.html">Solv_Petsc.h</a>.</p>

<p>Referenced by <a class="el" href="Solv__Petsc_8cpp_source.html#l00087">create_solver()</a>.</p>

</div>
</div>
<a class="anchor" id="a9c92c7b3025ccb3f301489141a442211"></a><!-- doxytag: member="Solv_Petsc::read_matrix_" ref="a9c92c7b3025ccb3f301489141a442211" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classSolv__Petsc.html#a9c92c7b3025ccb3f301489141a442211">Solv_Petsc::read_matrix_</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Read constant matrix in a file. </p>

<p>Definition at line <a class="el" href="Solv__Petsc_8h_source.html#l00162">162</a> of file <a class="el" href="Solv__Petsc_8h_source.html">Solv_Petsc.h</a>.</p>

<p>Referenced by <a class="el" href="Solv__Petsc_8cpp_source.html#l00087">create_solver()</a>, <a class="el" href="Solv__Petsc_8h_source.html#l00066">read_matrix()</a>, <a class="el" href="Solv__Petsc_8cpp_source.html#l01553">resoudre_systeme()</a>, and <a class="el" href="Solv__Petsc_8h_source.html#l00176">Solv_Petsc()</a>.</p>

</div>
</div>
<a class="anchor" id="a895816a337ad6bc6fcdfb82037e6a837"></a><!-- doxytag: member="Solv_Petsc::rebuild_matrix_" ref="a895816a337ad6bc6fcdfb82037e6a837" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classSolv__Petsc.html#a895816a337ad6bc6fcdfb82037e6a837">Solv_Petsc::rebuild_matrix_</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Solv__Petsc_8h_source.html#l00169">169</a> of file <a class="el" href="Solv__Petsc_8h_source.html">Solv_Petsc.h</a>.</p>

<p>Referenced by <a class="el" href="Solv__Petsc_8cpp_source.html#l00087">create_solver()</a>.</p>

</div>
</div>
<a class="anchor" id="aa05df5e1a45d2e1edff22af140336a05"></a><!-- doxytag: member="Solv_Petsc::solveur_direct_" ref="aa05df5e1a45d2e1edff22af140336a05" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classSolv__Petsc.html#aa05df5e1a45d2e1edff22af140336a05">Solv_Petsc::solveur_direct_</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Pour savoir si l'on manipule un solveur direct et non iteratif. </p>

<p>Definition at line <a class="el" href="Solv__Petsc_8h_source.html#l00160">160</a> of file <a class="el" href="Solv__Petsc_8h_source.html">Solv_Petsc.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/Kernel/Math/SolvSys/<a class="el" href="Solv__Petsc_8h_source.html">Solv_Petsc.h</a></li>
<li>src/Kernel/Math/SolvSys/<a class="el" href="Solv__Petsc_8cpp_source.html">Solv_Petsc.cpp</a></li>
</ul>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:37:52 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
