<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/Kernel/Framework/Format_Post_Lata.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/Kernel/Framework/Format_Post_Lata.cpp</div>  </div>
</div>
<div class="contents">
<a href="Format__Post__Lata_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (c) 2021, CEA</span>
<a name="l00003"></a>00003 <span class="comment">* All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment">* 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00007"></a>00007 <span class="comment">* 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00008"></a>00008 <span class="comment">* 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<a name="l00011"></a>00011 <span class="comment">* IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;</span>
<a name="l00012"></a>00012 <span class="comment">* OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// File:        Format_Post_Lata.cpp</span>
<a name="l00018"></a>00018 <span class="comment">// Directory:   $TRUST_ROOT/src/Kernel/Framework</span>
<a name="l00019"></a>00019 <span class="comment">// Version:     /main/40</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;<a class="code" href="Format__Post__Lata_8h.html">Format_Post_Lata.h</a>&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;<a class="code" href="EcrFicPartageBin_8h.html">EcrFicPartageBin.h</a>&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="EcrFicPartageMPIIO_8h.html">EcrFicPartageMPIIO.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="Fichier__Lata_8h.html">Fichier_Lata.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="Param_8h.html">Param.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="communications_8h.html">communications.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="EFichier_8h.html">EFichier.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;string&gt;</span> <span class="comment">//!&lt; Necessaire avec xlC pour std::getline</span>
<a name="l00031"></a>00031 <span class="comment"></span>
<a name="l00032"></a><a class="code" href="Format__Post__Lata_8cpp.html#a61c36fb142dd75448bdc059eae3b8e97">00032</a> <a class="code" href="Declare__Inst_8h.html#afcab3f7633508e92f2077d767e19bc60">Implemente_instanciable_sans_constructeur</a>(<a class="code" href="classFormat__Post__Lata.html" title=": Classe de postraitement des champs euleriens au format lata.">Format_Post_Lata</a>,<span class="stringliteral">&quot;Format_Post_Lata_V2&quot;</span>,<a class="code" href="classFormat__Post__base.html" title="Classe de base des formats de postraitements pour les champs&lt;br&gt;(lata, med, lml, meshtv). Utilisation de la classe par l&#39;interface generique: -typer un objet format de postraitement -initialiser l objet format de postraitement -proceder a des operations de complement et verification -ecrire un domaine -ecrire_temps -ecrire_champ (un type de champ supporte: aux elements ou aux sommets, ou encore aux faces si on a ecrit les faces du domaine et si les faces sont supportees par le postraitement)">Format_Post_base</a>);
<a name="l00033"></a>00033 
<a name="l00034"></a><a class="code" href="Format__Post__Lata_8cpp.html#ab18839c853328b785784a699263ad3ee">00034</a> <span class="preprocessor">#define _LATA_INT_TYPE_ int</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span>
<a name="l00036"></a>00036 <span class="comment">//</span>
<a name="l00037"></a>00037 <span class="comment">//</span>
<a name="l00038"></a>00038 <span class="comment">//</span>
<a name="l00039"></a>00039 <span class="comment">//</span>
<a name="l00040"></a>00040 <span class="comment">//</span>
<a name="l00041"></a>00041 <span class="comment">//</span>
<a name="l00042"></a>00042 <span class="comment">//</span>
<a name="l00043"></a>00043 <span class="comment">//</span>
<a name="l00044"></a>00044 <span class="comment">//</span>
<a name="l00045"></a>00045 <span class="comment">//</span>
<a name="l00046"></a>00046 <span class="comment">//</span>
<a name="l00047"></a>00047 <span class="comment">//</span>
<a name="l00048"></a>00048 <span class="comment">//</span>
<a name="l00049"></a>00049 <span class="comment">//</span>
<a name="l00050"></a>00050 <span class="comment">//</span>
<a name="l00051"></a>00051 <span class="comment">//</span>
<a name="l00052"></a>00052 <span class="comment">//</span>
<a name="l00053"></a>00053 <span class="comment">//</span>
<a name="l00054"></a>00054 <span class="comment">//</span>
<a name="l00055"></a>00055 <span class="comment">//</span>
<a name="l00056"></a>00056 <span class="comment">//</span>
<a name="l00057"></a>00057 <span class="comment">//</span><span class="comment"></span>
<a name="l00058"></a>00058 <span class="comment">//! Construit un fichier de type EcrFicPartage(Bin) ou EcrFicPrive(Bin),&lt;br&gt;binaire ou pas selon le parametre &quot;format&quot;.&lt;br&gt;Si parallel==MULTIPLE_FILES, le fichier est de type EcrFicPrive(Bin).&lt;br&gt;Dans ce cas, chaque processeur ouvre un fichier different, dont&lt;br&gt;le nom est &quot;basename_XXXXXextension&quot;, ou XXXXX est egal a Process::me().&lt;br&gt;Tous les processeurs renverront is_master() == 1.&lt;br&gt;Si parallel==SINGLE_FILE est non nul, le fichier est de type EcrFicPartage(Bin).&lt;br&gt;Seul le processeur maitre ouvre le fichier, le nom du fichier est&lt;br&gt;&quot;basenameextension&quot;.&lt;br&gt;is_master() renverra 1 sur le maitre, 0 sur les autres processeurs.&lt;br&gt;Parametre:     basename&lt;br&gt;Signification: debut du nom du fichier&lt;br&gt;Parametre:     extension&lt;br&gt;Signification: fin du nom du fichier&lt;br&gt;Parametre:     mode_append&lt;br&gt;Signification: Si mode_append==ERASE, on ouvre en mode ecriture,&lt;br&gt;si mode_append==APPEND, on ouvre en mode append.&lt;br&gt;Parametre:     format&lt;br&gt;Signification: Determine si on ouvre en binaire ou pas.&lt;br&gt;(valeurs possibles: Format_Post_Lata::ASCII ou Format_Post_Lata::BINAIRE)&lt;br&gt;Parametre:     parallel&lt;br&gt;Signification: fichier unique partage ou plusieurs fichiers prives...</span>
<a name="l00059"></a><a class="code" href="classFichier__Lata.html#a4e94dc02f52379815aa8bd786c9f3c16">00059</a> <span class="comment"></span><a class="code" href="classFichier__Lata.html#a4e94dc02f52379815aa8bd786c9f3c16" title="Construit un fichier de type EcrFicPartage(Bin) ou EcrFicPrive(Bin), binaire ou pas selon le parametr...">Fichier_Lata::Fichier_Lata</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * basename, <span class="keyword">const</span> <span class="keywordtype">char</span> * extension,
<a name="l00060"></a>00060                            <a class="code" href="classFichier__Lata.html#afadf4963467b3123d9e9ec312644cb48">Mode</a> mode_append,
<a name="l00061"></a>00061                            <a class="code" href="classFormat__Post__Lata.html#a8698c5e7e825c54749a7365f7ffff53c">Format_Post_Lata::Format</a> format,
<a name="l00062"></a>00062                            <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94">Format_Post_Lata::Options_Para</a> parallel) :
<a name="l00063"></a>00063   filename_(<span class="stringliteral">&quot;&quot;</span>),
<a name="l00064"></a>00064   fichier_(0),
<a name="l00065"></a>00065   is_parallel_(0)
<a name="l00066"></a>00066 {
<a name="l00067"></a>00067   <span class="keywordtype">char</span> s[20] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00068"></a>00068 
<a name="l00069"></a>00069   <span class="keywordflow">switch</span>(parallel)
<a name="l00070"></a>00070     {
<a name="l00071"></a>00071     <span class="keywordflow">case</span> <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94a23ea36f7593e2b91825cd82fa150b5e4">Format_Post_Lata::SINGLE_FILE_MPIIO</a>:
<a name="l00072"></a>00072     <span class="keywordflow">case</span> <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94a448f17201fc397a7da69a62ae0637043">Format_Post_Lata::SINGLE_FILE</a>:
<a name="l00073"></a>00073       {
<a name="l00074"></a>00074         <a class="code" href="classFichier__Lata.html#af56e687eb76326f30b3a31eae524ceb3">is_parallel_</a> = 1;
<a name="l00075"></a>00075         <a class="code" href="classFichier__Lata.html#a37bcfe5d3baae24dc288388268a9c7df">filename_</a> = basename;
<a name="l00076"></a>00076         <a class="code" href="classFichier__Lata.html#a37bcfe5d3baae24dc288388268a9c7df">filename_</a> += extension;
<a name="l00077"></a>00077 <span class="comment">// Pour un calcul sequentiel, on ouvre un fichier SFichier</span>
<a name="l00078"></a>00078 <span class="comment">// pour ne pas bufferiser en memoire</span>
<a name="l00079"></a>00079         <span class="keywordflow">if</span>  (<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>() == 1)
<a name="l00080"></a>00080           <a class="code" href="classFichier__Lata.html#a21152a1ead7a67d50b7f198fe6ed223b">fichier_</a> = <span class="keyword">new</span> <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a>;
<a name="l00081"></a>00081         <span class="keywordflow">else</span>
<a name="l00082"></a>00082           {
<a name="l00083"></a>00083             <span class="keywordflow">if</span> (format == <a class="code" href="classFormat__Post__Lata.html#a8698c5e7e825c54749a7365f7ffff53ca2d3fa963128b6785fca8a03841962e16">Format_Post_Lata::BINAIRE</a> &amp;&amp; parallel == <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94a23ea36f7593e2b91825cd82fa150b5e4">Format_Post_Lata::SINGLE_FILE_MPIIO</a>)
<a name="l00084"></a>00084               <a class="code" href="classFichier__Lata.html#a21152a1ead7a67d50b7f198fe6ed223b">fichier_</a> = <span class="keyword">new</span> <a class="code" href="classEcrFicPartageMPIIO.html" title="Class to use MPI-IO to write in a single file.">EcrFicPartageMPIIO</a>;
<a name="l00085"></a>00085             <span class="keywordflow">else</span>
<a name="l00086"></a>00086               <a class="code" href="classFichier__Lata.html#a21152a1ead7a67d50b7f198fe6ed223b">fichier_</a> = <span class="keyword">new</span> <a class="code" href="classEcrFicPartage.html">EcrFicPartage</a>;
<a name="l00087"></a>00087           }
<a name="l00088"></a>00088         <span class="keywordflow">break</span>;
<a name="l00089"></a>00089       }
<a name="l00090"></a>00090     <span class="keywordflow">case</span> <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94aef0c737cbac106d4baaade24e94e5028">Format_Post_Lata::MULTIPLE_FILES</a>:
<a name="l00091"></a>00091       {
<a name="l00092"></a>00092         <a class="code" href="classFichier__Lata.html#af56e687eb76326f30b3a31eae524ceb3">is_parallel_</a> = 0;
<a name="l00093"></a>00093         <a class="code" href="classFichier__Lata.html#a21152a1ead7a67d50b7f198fe6ed223b">fichier_</a> = <span class="keyword">new</span> <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a>;
<a name="l00094"></a>00094         <span class="keyword">const</span> <span class="keywordtype">int</span> moi = <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>();
<a name="l00095"></a>00095         sprintf(s, <span class="stringliteral">&quot;_%05d&quot;</span>, (<a class="code" href="arch_8h.html#a1caaf369d9c5f0817dbaa76b43b8d87b">True_int</a>)moi);
<a name="l00096"></a>00096         <span class="keywordflow">break</span>;
<a name="l00097"></a>00097       }
<a name="l00098"></a>00098     <span class="keywordflow">default</span>:
<a name="l00099"></a>00099       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Fichier_Lata::Fichier_Lata: parallel option not supported &quot;</span> &lt;&lt; (int)parallel &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00100"></a>00100       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00101"></a>00101     }
<a name="l00102"></a>00102   <a class="code" href="classFichier__Lata.html#a37bcfe5d3baae24dc288388268a9c7df">filename_</a> = basename;
<a name="l00103"></a>00103   <a class="code" href="classFichier__Lata.html#a37bcfe5d3baae24dc288388268a9c7df">filename_</a> += s;
<a name="l00104"></a>00104   <a class="code" href="classFichier__Lata.html#a37bcfe5d3baae24dc288388268a9c7df">filename_</a> += extension;
<a name="l00105"></a>00105 
<a name="l00106"></a>00106   <span class="keywordflow">switch</span>(format)
<a name="l00107"></a>00107     {
<a name="l00108"></a>00108     <span class="keywordflow">case</span> <a class="code" href="classFormat__Post__Lata.html#a8698c5e7e825c54749a7365f7ffff53ca64e753afccaf02de631ef2ad18733aab">Format_Post_Lata::ASCII</a>:
<a name="l00109"></a>00109       <a class="code" href="classFichier__Lata.html#a21152a1ead7a67d50b7f198fe6ed223b">fichier_</a>-&gt;<a class="code" href="classSortie.html#a1b830c79a55971e0ae7281d13e06cb44" title="Change le mode d&#39;ecriture du fichier. Cette methode peut etre appelee n&#39;importe quand. Attention cependant pour les fichiers Ecrire_Fichier_Partage : il faut faire le changement uniquement au debut de l&#39;ecriture d&#39;un bloc, juste apres syncfile() (sinon, mauvaise traduction des retours a la ligne lors du syncfile suivant).">set_bin</a>(0);
<a name="l00110"></a>00110       <span class="keywordflow">break</span>;
<a name="l00111"></a>00111     <span class="keywordflow">case</span> <a class="code" href="classFormat__Post__Lata.html#a8698c5e7e825c54749a7365f7ffff53ca2d3fa963128b6785fca8a03841962e16">Format_Post_Lata::BINAIRE</a>:
<a name="l00112"></a>00112       <a class="code" href="classFichier__Lata.html#a21152a1ead7a67d50b7f198fe6ed223b">fichier_</a>-&gt;<a class="code" href="classSortie.html#a1b830c79a55971e0ae7281d13e06cb44" title="Change le mode d&#39;ecriture du fichier. Cette methode peut etre appelee n&#39;importe quand. Attention cependant pour les fichiers Ecrire_Fichier_Partage : il faut faire le changement uniquement au debut de l&#39;ecriture d&#39;un bloc, juste apres syncfile() (sinon, mauvaise traduction des retours a la ligne lors du syncfile suivant).">set_bin</a>(1);
<a name="l00113"></a>00113       <span class="keywordflow">break</span>;
<a name="l00114"></a>00114     <span class="keywordflow">default</span>:
<a name="l00115"></a>00115       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Fichier_Lata::Fichier_Lata: format not supported &quot;</span> &lt;&lt; (int)format &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00116"></a>00116       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00117"></a>00117     }
<a name="l00118"></a>00118 
<a name="l00119"></a>00119 
<a name="l00120"></a>00120   <a class="code" href="arch_8h.html#a58aa6cef3a754a92479a2fb744a5f538" title="Gestion des dependances machines pour l&#39;appel a FORTRAN La macro F77DECLARE(TOTO) permet de declarer ...">IOS_OPEN_MODE</a> mode = ios::out;
<a name="l00121"></a>00121   <span class="keywordflow">switch</span>(mode_append)
<a name="l00122"></a>00122     {
<a name="l00123"></a>00123     <span class="keywordflow">case</span> <a class="code" href="classFichier__Lata.html#afadf4963467b3123d9e9ec312644cb48aafea5adb55ed5ecc0b957884c5e754c1">ERASE</a>:
<a name="l00124"></a>00124       mode = ios::out;
<a name="l00125"></a>00125       <span class="keywordflow">break</span>;
<a name="l00126"></a>00126     <span class="keywordflow">case</span> <a class="code" href="classFichier__Lata.html#afadf4963467b3123d9e9ec312644cb48ad9db95f97d41cea9e4338af8876bd408">APPEND</a>:
<a name="l00127"></a>00127       mode = ios::out | ios::app;
<a name="l00128"></a>00128       <span class="keywordflow">break</span>;
<a name="l00129"></a>00129     <span class="keywordflow">default</span>:
<a name="l00130"></a>00130       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Fichier_Lata::Fichier_Lata: open mode not supported &quot;</span> &lt;&lt; (int)mode_append &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00131"></a>00131       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00132"></a>00132     }
<a name="l00133"></a>00133 <span class="comment">// if (Process::je_suis_maitre() || parallel==Format_Post_Lata::MULTIPLE_FILES)</span>
<a name="l00134"></a>00134   {
<a name="l00135"></a>00135     <span class="keywordtype">int</span> ok = <a class="code" href="classFichier__Lata.html#a21152a1ead7a67d50b7f198fe6ed223b">fichier_</a>-&gt;<a class="code" href="classSortie__Fichier__base.html#a7e75e18ed580cd4d45912ec202caa2b2">ouvrir</a>(<a class="code" href="classFichier__Lata.html#a37bcfe5d3baae24dc288388268a9c7df">filename_</a>, mode);
<a name="l00136"></a>00136     <span class="keywordflow">if</span> (!ok)
<a name="l00137"></a>00137       {
<a name="l00138"></a>00138         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Fichier_Lata::Fichier_Lata\n&quot;</span>
<a name="l00139"></a>00139              &lt;&lt; <span class="stringliteral">&quot; Error while opening file : &quot;</span> &lt;&lt; <a class="code" href="classFichier__Lata.html#a37bcfe5d3baae24dc288388268a9c7df">filename_</a>
<a name="l00140"></a>00140              &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00141"></a>00141         <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00142"></a>00142       }
<a name="l00143"></a>00143     <a class="code" href="classFichier__Lata.html#a21152a1ead7a67d50b7f198fe6ed223b">fichier_</a>-&gt;<a class="code" href="classSortie__Fichier__base.html#a5ddd834ca9c766c24cc608cd03ef0e96">setf</a>(ios::scientific);
<a name="l00144"></a>00144     <a class="code" href="classFichier__Lata.html#a21152a1ead7a67d50b7f198fe6ed223b">fichier_</a>-&gt;<a class="code" href="classSortie__Fichier__base.html#a489ca01946f4e2a7a9aa8f3a3d949b08">precision</a>(8);
<a name="l00145"></a>00145   }
<a name="l00146"></a>00146 }
<a name="l00147"></a>00147 
<a name="l00148"></a><a class="code" href="classFichier__Lata.html#a50ff28fb3abad505c0cca8fbf1836294">00148</a> <a class="code" href="classFichier__Lata.html#a50ff28fb3abad505c0cca8fbf1836294">Fichier_Lata::~Fichier_Lata</a>()
<a name="l00149"></a>00149 {
<a name="l00150"></a>00150   <span class="keywordflow">if</span> (<a class="code" href="classFichier__Lata.html#a21152a1ead7a67d50b7f198fe6ed223b">fichier_</a>)
<a name="l00151"></a>00151     {
<a name="l00152"></a>00152       <span class="keyword">delete</span> <a class="code" href="classFichier__Lata.html#a21152a1ead7a67d50b7f198fe6ed223b">fichier_</a>;
<a name="l00153"></a>00153       <a class="code" href="classFichier__Lata.html#a21152a1ead7a67d50b7f198fe6ed223b">fichier_</a> = 0;
<a name="l00154"></a>00154     }
<a name="l00155"></a>00155 }
<a name="l00156"></a>00156 
<a name="l00157"></a><a class="code" href="classFichier__Lata.html#a18a15a1d2d7f0edccbb258f9da1526b3">00157</a> <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a>&amp; <a class="code" href="classFichier__Lata.html#a18a15a1d2d7f0edccbb258f9da1526b3">Fichier_Lata::get_SFichier</a>()
<a name="l00158"></a>00158 {
<a name="l00159"></a>00159   assert(<a class="code" href="classFichier__Lata.html#a21152a1ead7a67d50b7f198fe6ed223b">fichier_</a>);
<a name="l00160"></a>00160   <span class="keywordflow">return</span> *<a class="code" href="classFichier__Lata.html#a21152a1ead7a67d50b7f198fe6ed223b">fichier_</a>;
<a name="l00161"></a>00161 }
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 <span class="comment">//</span><span class="comment"></span>
<a name="l00164"></a>00164 <span class="comment">//! Renvoie le nom du fichier avec le path</span>
<a name="l00165"></a><a class="code" href="classFichier__Lata.html#a8bcf7ecaa7806a6ae44979ff921370ca">00165</a> <span class="comment"></span><span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; <a class="code" href="classFichier__Lata.html#a8bcf7ecaa7806a6ae44979ff921370ca" title="Renvoie le nom du fichier avec le path.">Fichier_Lata::get_filename</a>()<span class="keyword"> const</span>
<a name="l00166"></a>00166 <span class="keyword"></span>{
<a name="l00167"></a>00167   <span class="keywordflow">return</span> <a class="code" href="classFichier__Lata.html#a37bcfe5d3baae24dc288388268a9c7df">filename_</a>;
<a name="l00168"></a>00168 }
<a name="l00169"></a>00169 
<a name="l00170"></a>00170 <span class="comment">//</span>
<a name="l00171"></a>00171 <span class="comment">//</span>
<a name="l00172"></a>00172 <span class="comment">//</span><span class="comment"></span>
<a name="l00173"></a>00173 <span class="comment">//! Si le fichier est de type partage, renvoie 1 si me() est egal au master&lt;br&gt;du groupe et 0 sinon,&lt;br&gt;Si le fichier est prive, renvoie 1 sur tous les processeurs.</span>
<a name="l00174"></a><a class="code" href="classFichier__Lata.html#a1a0c3473194894e5f5f79530abc45564">00174</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="classFichier__Lata.html#a1a0c3473194894e5f5f79530abc45564" title="Si le fichier est de type partage, renvoie 1 si me() est egal au master du groupe et 0 sinon...">Fichier_Lata::is_master</a>()<span class="keyword"> const</span>
<a name="l00175"></a>00175 <span class="keyword"></span>{
<a name="l00176"></a>00176   <span class="keywordtype">int</span> resu = 0;
<a name="l00177"></a>00177   <span class="keywordflow">if</span> (<a class="code" href="classFichier__Lata.html#af56e687eb76326f30b3a31eae524ceb3">is_parallel_</a> == 0)
<a name="l00178"></a>00178     {
<a name="l00179"></a>00179 <span class="comment">// Execution sequentielle, fichiers prives chaque processeur est maitre</span>
<a name="l00180"></a>00180       resu = 1;
<a name="l00181"></a>00181     }
<a name="l00182"></a>00182   <span class="keywordflow">else</span>
<a name="l00183"></a>00183     {
<a name="l00184"></a>00184 <span class="comment">// Execution parallele : un seul maitre</span>
<a name="l00185"></a>00185       <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l00186"></a>00186         resu = 1;
<a name="l00187"></a>00187     }
<a name="l00188"></a>00188   <span class="keywordflow">return</span> resu;
<a name="l00189"></a>00189 }
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 <span class="comment">//</span>
<a name="l00192"></a>00192 <span class="comment">//</span><span class="comment"></span>
<a name="l00193"></a>00193 <span class="comment">//! Si le fichier est de type partage, appelle la methode syncfile(),&lt;br&gt;sinon ne fait rien.</span>
<a name="l00194"></a><a class="code" href="classFichier__Lata.html#af042e59f9c02f4d9c4087e126d711426">00194</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classFichier__Lata.html#af042e59f9c02f4d9c4087e126d711426" title="Si le fichier est de type partage, appelle la methode syncfile(), sinon ne fait rien.">Fichier_Lata::syncfile</a>()
<a name="l00195"></a>00195 {
<a name="l00196"></a>00196   <span class="keywordflow">if</span> (<a class="code" href="classFichier__Lata.html#af56e687eb76326f30b3a31eae524ceb3">is_parallel_</a> &amp;&amp; <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>() &gt; 1)
<a name="l00197"></a>00197     <a class="code" href="classFichier__Lata.html#a21152a1ead7a67d50b7f198fe6ed223b">fichier_</a>-&gt;<a class="code" href="classSortie.html#ae98acb70e7f3886cab47a51f2de6a976">syncfile</a>();
<a name="l00198"></a>00198 }
<a name="l00199"></a>00199 
<a name="l00200"></a><a class="code" href="classFichier__Lata__maitre.html#ad21ee814c656a3aed1304c3450cf323d">00200</a> <a class="code" href="classFichier__Lata__maitre.html#ad21ee814c656a3aed1304c3450cf323d">Fichier_Lata_maitre::Fichier_Lata_maitre</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * basename,
<a name="l00201"></a>00201                                          <span class="keyword">const</span> <span class="keywordtype">char</span> * extension,
<a name="l00202"></a>00202                                          <a class="code" href="classFichier__Lata.html#afadf4963467b3123d9e9ec312644cb48">Mode</a> mode_append,
<a name="l00203"></a>00203                                          <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94">Format_Post_Lata::Options_Para</a> parallel) :
<a name="l00204"></a>00204   <a class="code" href="classFichier__Lata.html">Fichier_Lata</a>(basename, extension,
<a name="l00205"></a>00205                mode_append, <a class="code" href="classFormat__Post__Lata.html" title=": Classe de postraitement des champs euleriens au format lata.">Format_Post_Lata</a>::ASCII, parallel)
<a name="l00206"></a>00206 {
<a name="l00207"></a>00207   <a class="code" href="classFichier__Lata.html#a21152a1ead7a67d50b7f198fe6ed223b">fichier_</a>-&gt;<a class="code" href="classSortie__Fichier__base.html#a5ddd834ca9c766c24cc608cd03ef0e96">setf</a>(ios::scientific);
<a name="l00208"></a>00208 <span class="comment">// On peut changer la precision du fichier maitre a cet endroit:</span>
<a name="l00209"></a>00209   <a class="code" href="classFichier__Lata.html#a21152a1ead7a67d50b7f198fe6ed223b">fichier_</a>-&gt;<a class="code" href="classSortie__Fichier__base.html#a489ca01946f4e2a7a9aa8f3a3d949b08">precision</a>(8);
<a name="l00210"></a>00210 }
<a name="l00211"></a>00211 
<a name="l00212"></a>00212 <span class="comment">// ****************************************************************************</span>
<a name="l00213"></a>00213 
<a name="l00214"></a>00214 <span class="comment">//</span><span class="comment"></span>
<a name="l00215"></a>00215 <span class="comment">//! Renvoie l&#39;extension conventionnelle des fichiers lata : &quot;.lata&quot;</span>
<a name="l00216"></a><a class="code" href="classFormat__Post__Lata.html#aee3312d2f199be29261229ab7f874a40">00216</a> <span class="comment"></span><span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="classFormat__Post__Lata.html#aee3312d2f199be29261229ab7f874a40" title="Renvoie l&#39;extension conventionnelle des fichiers lata : &quot;.lata&quot;.">Format_Post_Lata::extension_lata</a>()
<a name="l00217"></a>00217 {
<a name="l00218"></a>00218   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * ext = <span class="stringliteral">&quot;.lata&quot;</span>;
<a name="l00219"></a>00219   <span class="keywordflow">return</span> ext;
<a name="l00220"></a>00220 }
<a name="l00221"></a>00221 
<a name="l00222"></a>00222 <span class="comment">//</span>
<a name="l00223"></a>00223 <span class="comment">//</span><span class="comment"></span>
<a name="l00224"></a>00224 <span class="comment">//! Renvoie le nom d&#39;un fichier sans le path :&lt;br&gt;on enleve les caracteres avant le dernier /</span>
<a name="l00225"></a><a class="code" href="classFormat__Post__Lata.html#a033716caeef1f9b96458757fa911e2d8">00225</a> <span class="comment"></span><span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="classFormat__Post__Lata.html#a033716caeef1f9b96458757fa911e2d8" title="Renvoie le nom d&#39;un fichier sans le path : on enleve les caracteres avant le dernier /...">Format_Post_Lata::remove_path</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * filename)
<a name="l00226"></a>00226 {
<a name="l00227"></a>00227   <span class="keywordtype">int</span> i = strlen(filename);
<a name="l00228"></a>00228   <span class="keywordflow">while</span> (i &gt; 0 &amp;&amp; filename[i-1] != <span class="charliteral">&#39;/&#39;</span>)
<a name="l00229"></a>00229     i--;
<a name="l00230"></a>00230   <span class="keywordflow">return</span> filename + i;
<a name="l00231"></a>00231 }
<a name="l00232"></a>00232 
<a name="l00233"></a>00233 <span class="comment">//</span>
<a name="l00234"></a>00234 <span class="comment">//</span><span class="comment"></span>
<a name="l00235"></a>00235 <span class="comment">//! Ouvre le fichier maitre en mode ERASE et ecrit l&#39;entete du fichier lata&lt;br&gt;(sur le processeur maitre seulement).</span>
<a name="l00236"></a>00236 <span class="comment"></span><span class="comment">//</span>
<a name="l00237"></a><a class="code" href="classFormat__Post__Lata.html#a1329c803df8614aab43f689e053ef9b3">00237</a> <span class="keywordtype">int</span> <a class="code" href="classFormat__Post__Lata.html#a1329c803df8614aab43f689e053ef9b3" title="Ouvre le fichier maitre en mode ERASE et ecrit l&#39;entete du fichier lata&lt;br&gt;(sur le processeur maitre ...">Format_Post_Lata::ecrire_entete</a>(<span class="keywordtype">double</span> temps_courant,<span class="keywordtype">int</span> reprise,<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; est_le_premier_post)
<a name="l00238"></a>00238 {
<a name="l00239"></a>00239 
<a name="l00240"></a>00240   <a class="code" href="classFormat__Post__Lata.html#af61b5c69867bb3330f2652fc8698fff3">ecrire_entete_lata</a>(<a class="code" href="classFormat__Post__Lata.html#a8d55373127916e23ee800ef312f78cdd">lata_basename_</a>,<a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a>,<a class="code" href="classFormat__Post__Lata.html#a6f47f1f2016cce3ab8bb1b976ed0d921">format_</a>,est_le_premier_post);
<a name="l00241"></a>00241   <span class="comment">/*</span>
<a name="l00242"></a>00242 <span class="comment">  // Determination du format binaire:</span>
<a name="l00243"></a>00243 <span class="comment">  //  big endian =&gt; l&#39;entier 32 bits &quot;1&quot; s&#39;ecrit 0x00 0x00 0x00 0x01</span>
<a name="l00244"></a>00244 <span class="comment">  //  little endian =&gt;                           0x01 0x00 0x00 0x00</span>
<a name="l00245"></a>00245 <span class="comment">  const unsigned int one = 1;</span>
<a name="l00246"></a>00246 <span class="comment">  const int big_endian = (* ((unsigned char *)&amp;one) == 0) ? 1 : 0;</span>
<a name="l00247"></a>00247 <span class="comment"></span>
<a name="l00248"></a>00248 <span class="comment">  // Effacement du fichier .lata et ecriture de l&#39;entete</span>
<a name="l00249"></a>00249 <span class="comment">  Fichier_Lata_maitre fichier(lata_basename_, extension_lata(),</span>
<a name="l00250"></a>00250 <span class="comment">  Fichier_Lata::ERASE,</span>
<a name="l00251"></a>00251 <span class="comment">  options_para_);</span>
<a name="l00252"></a>00252 <span class="comment">  SFichier &amp; sfichier = fichier.get_SFichier();</span>
<a name="l00253"></a>00253 <span class="comment">  if (fichier.is_master()) {</span>
<a name="l00254"></a>00254 <span class="comment">  sfichier &lt;&lt; &quot;LataV2.0 Trio_U Version1.4.9 06/2005&quot; &lt;&lt; finl;</span>
<a name="l00255"></a>00255 <span class="comment">  sfichier &lt;&lt; Objet_U::nom_du_cas() &lt;&lt; finl;</span>
<a name="l00256"></a>00256 <span class="comment">  sfichier &lt;&lt; &quot;Trio_U&quot; &lt;&lt; finl;</span>
<a name="l00257"></a>00257 <span class="comment"></span>
<a name="l00258"></a>00258 <span class="comment">  sfichier &lt;&lt; &quot;Format &quot;;</span>
<a name="l00259"></a>00259 <span class="comment">  switch(format_) {</span>
<a name="l00260"></a>00260 <span class="comment">  case ASCII:</span>
<a name="l00261"></a>00261 <span class="comment">  sfichier &lt;&lt; &quot;ASCII &quot;;</span>
<a name="l00262"></a>00262 <span class="comment">  break;</span>
<a name="l00263"></a>00263 <span class="comment">  case BINAIRE:</span>
<a name="l00264"></a>00264 <span class="comment">  sfichier &lt;&lt; &quot;BINAIRE &quot;;</span>
<a name="l00265"></a>00265 <span class="comment">  if (big_endian)</span>
<a name="l00266"></a>00266 <span class="comment">  sfichier &lt;&lt; &quot;big_endian &quot;;</span>
<a name="l00267"></a>00267 <span class="comment">  else</span>
<a name="l00268"></a>00268 <span class="comment">  sfichier &lt;&lt; &quot;little_endian &quot;;</span>
<a name="l00269"></a>00269 <span class="comment">  break;</span>
<a name="l00270"></a>00270 <span class="comment">  default:</span>
<a name="l00271"></a>00271 <span class="comment">  Cerr &lt;&lt; &quot;Error in Format_Post_Lata::ecrire_entete\n&quot;</span>
<a name="l00272"></a>00272 <span class="comment">  &lt;&lt; &quot; format not supported&quot; &lt;&lt; finl;</span>
<a name="l00273"></a>00273 <span class="comment">  exit();</span>
<a name="l00274"></a>00274 <span class="comment">  }</span>
<a name="l00275"></a>00275 <span class="comment">  switch(sizeof(_LATA_INT_TYPE_)) {</span>
<a name="l00276"></a>00276 <span class="comment">  case 4:</span>
<a name="l00277"></a>00277 <span class="comment">  sfichier &lt;&lt; &quot;int32 &quot;;</span>
<a name="l00278"></a>00278 <span class="comment">  break;</span>
<a name="l00279"></a>00279 <span class="comment">  case 8:</span>
<a name="l00280"></a>00280 <span class="comment">  sfichier &lt;&lt; &quot;int64 &quot;;</span>
<a name="l00281"></a>00281 <span class="comment">  break;</span>
<a name="l00282"></a>00282 <span class="comment">  default:</span>
<a name="l00283"></a>00283 <span class="comment">  Cerr &lt;&lt; &quot;Error in Format_Post_Lata::ecrire_entete\n&quot;</span>
<a name="l00284"></a>00284 <span class="comment">  &lt;&lt; &quot; sizeof(int) not supported&quot; &lt;&lt; finl;</span>
<a name="l00285"></a>00285 <span class="comment">  exit();</span>
<a name="l00286"></a>00286 <span class="comment">  }</span>
<a name="l00287"></a>00287 <span class="comment">  sfichier &lt;&lt; &quot;real32&quot; &lt;&lt; finl;</span>
<a name="l00288"></a>00288 <span class="comment">  }</span>
<a name="l00289"></a>00289 <span class="comment">  fichier.syncfile();</span>
<a name="l00290"></a>00290 <span class="comment">  */</span>
<a name="l00291"></a>00291 
<a name="l00292"></a>00292   <span class="keywordflow">return</span> 1;
<a name="l00293"></a>00293 }
<a name="l00294"></a>00294 
<a name="l00295"></a><a class="code" href="classFormat__Post__Lata.html#a4a7432294d2ebb1ee8de7794e3e257be">00295</a> <span class="keywordtype">int</span> <a class="code" href="classFormat__Post__Lata.html#a4a7432294d2ebb1ee8de7794e3e257be">Format_Post_Lata::completer_post</a>(<span class="keyword">const</span> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom,<span class="keyword">const</span> <span class="keywordtype">int</span> is_axi,
<a name="l00296"></a>00296                                      <span class="keyword">const</span> <a class="code" href="Field__base_8h.html#a1b86c8f670a9b34da7f628a821fb646b" title="This is a base class from which inherit Champ_base and Champ_front_base. It handles all the generic a...">Nature_du_champ</a>&amp; nature,<span class="keyword">const</span> <span class="keywordtype">int</span> nb_compo,<span class="keyword">const</span> <a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a>&amp; noms_compo,
<a name="l00297"></a>00297                                      <span class="keyword">const</span> <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>&amp; loc_post,<span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; le_nom_champ_post)
<a name="l00298"></a>00298 {
<a name="l00299"></a>00299   <span class="keywordflow">return</span> 1;
<a name="l00300"></a>00300 }
<a name="l00301"></a>00301 
<a name="l00302"></a><a class="code" href="classFormat__Post__Lata.html#a98dead29473a3ae1876d9baf02e44d44">00302</a> <span class="keywordtype">int</span> <a class="code" href="classFormat__Post__Lata.html#a98dead29473a3ae1876d9baf02e44d44">Format_Post_Lata::preparer_post</a>(<span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; id_du_domaine,<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; est_le_premier_post,
<a name="l00303"></a>00303                                     <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; reprise,
<a name="l00304"></a>00304                                     <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; t_init)
<a name="l00305"></a>00305 {
<a name="l00306"></a>00306   <span class="keywordflow">return</span> 1;
<a name="l00307"></a>00307 }
<a name="l00308"></a>00308 
<a name="l00309"></a>00309 <span class="comment">//</span>
<a name="l00310"></a>00310 <span class="comment">//</span>
<a name="l00311"></a>00311 <span class="comment">//</span>
<a name="l00312"></a>00312 <span class="comment">//</span>
<a name="l00313"></a>00313 <span class="comment">//</span>
<a name="l00314"></a>00314 <span class="comment">//</span>
<a name="l00315"></a>00315 <span class="comment">//</span>
<a name="l00316"></a>00316 <span class="comment">//</span>
<a name="l00317"></a>00317 <span class="comment">//</span>
<a name="l00318"></a>00318 <span class="comment">//</span>
<a name="l00319"></a>00319 <span class="comment">//</span>
<a name="l00320"></a>00320 <span class="comment">//</span><span class="comment"></span>
<a name="l00321"></a>00321 <span class="comment">//! fichier est un fichier lata de donnees (pas le fichier maitre)&lt;br&gt;on y ecrit le tableau tab tel quel (en binaire ou ascii et sur un ou&lt;br&gt;plusieurs fichiers en parallel).&lt;br&gt;nb_colonnes est rempli avec le produit des tab.dimension(i) pour i&gt;0&lt;br&gt;bloc_number et nb_blocs sont utilises pour les valeurs aux sommets en 2D&lt;br&gt;pour le format lataV1 : on ecrit deux fois le nombre de sommets dans le meme bloc&lt;br&gt;(bloc_number = le numero du bloc courant en cours d&#39;ecriture,&lt;br&gt;nb_blocs = le nombre total de blocs ecrits. Le tag de debut et de fin&lt;br&gt;est ecrit au debut du premier bloc et a la fin du dernier et le nombre est&lt;br&gt;la taille du tableau multiplie par le nombre de blocs (on suppose que tous&lt;br&gt;les blocs sont identiques)).</span>
<a name="l00322"></a><a class="code" href="classFormat__Post__Lata.html#a943396fe8d7fbcf408da73a1f59cdebe">00322</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="classFormat__Post__Lata.html#a943396fe8d7fbcf408da73a1f59cdebe" title="fichier est un fichier lata de donnees (pas le fichier maitre) on y ecrit le tableau tab tel quel (en...">Format_Post_Lata::write_doubletab</a>(<a class="code" href="classFichier__Lata.html">Fichier_Lata</a>&amp; fichier,
<a name="l00323"></a>00323                                       <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; tab,
<a name="l00324"></a>00324                                       <span class="keywordtype">int</span>&amp; nb_colonnes,
<a name="l00325"></a>00325                                       <span class="keyword">const</span> <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94">Options_Para</a>&amp; <a class="code" href="classoption.html">option</a>,
<a name="l00326"></a>00326                                       <span class="keyword">const</span> <span class="keywordtype">int</span> bloc_number,
<a name="l00327"></a>00327                                       <span class="keyword">const</span> <span class="keywordtype">int</span> nb_blocs)
<a name="l00328"></a>00328 {
<a name="l00329"></a>00329   <span class="keywordtype">int</span> line_size = 1;
<a name="l00330"></a>00330   <span class="keywordtype">int</span> nb_lignes = tab.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00331"></a>00331   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_dim = tab.<a class="code" href="classDoubleTab.html#ae6dda48778e7107e1beb723beef1f75b" title="Returns the number of dimensions of the array (&gt;= 1)">nb_dim</a>();
<a name="l00332"></a>00332   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; nb_dim; i++)
<a name="l00333"></a>00333     line_size *= tab.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(i);
<a name="l00334"></a>00334 
<a name="l00335"></a>00335   <span class="keywordtype">int</span> nb_lignes_tot = 0;
<a name="l00336"></a>00336   <span class="keyword">const</span> <span class="keywordtype">int</span> tab_size = line_size * nb_lignes;
<a name="l00337"></a>00337   <span class="keywordtype">int</span> nb_octets = tab_size * <span class="keyword">sizeof</span>(float);
<a name="l00338"></a>00338   <span class="keywordflow">switch</span>(option)
<a name="l00339"></a>00339     {
<a name="l00340"></a>00340     <span class="keywordflow">case</span> <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94a23ea36f7593e2b91825cd82fa150b5e4">Format_Post_Lata::SINGLE_FILE_MPIIO</a>:
<a name="l00341"></a>00341     <span class="keywordflow">case</span> <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94a448f17201fc397a7da69a62ae0637043">Format_Post_Lata::SINGLE_FILE</a>:
<a name="l00342"></a>00342       nb_lignes_tot = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(nb_lignes);
<a name="l00343"></a>00343 <span class="comment">// En parallele, tous les tableaux doivent avoir le meme nombre</span>
<a name="l00344"></a>00344 <span class="comment">// de colonnes (ou etre vides).</span>
<a name="l00345"></a>00345       nb_colonnes = (int) <a class="code" href="classProcess.html#a1e9d9f9899b71927cfafae14c7bd048d" title="Calcule le max de x sur tous les processeurs du groupe courant. Remarques : Cette methode doit etre a...">Process::mp_max</a>(line_size); <span class="comment">//!&lt; Zut. Pas de mp_max(int) !!!</span>
<a name="l00346"></a>00346 <span class="comment"></span>      nb_octets = nb_colonnes*nb_lignes_tot * <span class="keyword">sizeof</span>(float);
<a name="l00347"></a>00347       assert(nb_lignes == 0 || line_size == nb_colonnes);
<a name="l00348"></a>00348       <span class="keywordflow">break</span>;
<a name="l00349"></a>00349     <span class="keywordflow">case</span> <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94aef0c737cbac106d4baaade24e94e5028">Format_Post_Lata::MULTIPLE_FILES</a>:
<a name="l00350"></a>00350       nb_lignes_tot = nb_lignes;
<a name="l00351"></a>00351       nb_colonnes = line_size;
<a name="l00352"></a>00352       <span class="keywordflow">break</span>;
<a name="l00353"></a>00353     <span class="keywordflow">default</span>:
<a name="l00354"></a>00354       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Format_Post_Lata_write_tab: error nb_lignes_tot&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00355"></a>00355       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00356"></a>00356     }
<a name="l00357"></a>00357 
<a name="l00358"></a>00358   <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a>&amp; sfichier = fichier.<a class="code" href="classFichier__Lata.html#a18a15a1d2d7f0edccbb258f9da1526b3">get_SFichier</a>();
<a name="l00359"></a>00359 
<a name="l00360"></a>00360 <span class="comment">// Debut de bloc fortran</span>
<a name="l00361"></a>00361   <span class="keywordflow">if</span> (fichier.<a class="code" href="classFichier__Lata.html#a1a0c3473194894e5f5f79530abc45564" title="Si le fichier est de type partage, renvoie 1 si me() est egal au master du groupe et 0 sinon...">is_master</a>() &amp;&amp; bloc_number == 0)
<a name="l00362"></a>00362     sfichier &lt;&lt; nb_octets * nb_blocs &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00363"></a>00363 
<a name="l00364"></a>00364 <span class="comment">// Ecriture des donnees.</span>
<a name="l00365"></a>00365   <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classEcrFicPartageMPIIO.html" title="Class to use MPI-IO to write in a single file.">EcrFicPartageMPIIO</a>, sfichier))
<a name="l00366"></a>00366     {
<a name="l00367"></a>00367       <span class="keyword">auto</span> *tmp = <span class="keyword">new</span> <span class="keywordtype">float</span>[tab_size]; <span class="comment">//!&lt; No ArrOfFloat in TRUST</span>
<a name="l00368"></a>00368 <span class="comment"></span>      <span class="keyword">const</span> <span class="keywordtype">double</span> *data = tab.<a class="code" href="classArrOfDouble.html#a95357a1390c11dbd481d385257f2e983" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>();
<a name="l00369"></a>00369       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; tab_size; i++)
<a name="l00370"></a>00370         tmp[i] = data[i];
<a name="l00371"></a>00371       sfichier.<a class="code" href="classSortie.html#aa3f46aaccaff0f83c018784b50d8ea24" title="Methode de bas niveau pour ecrire un tableau d&#39;ints ou reels dans le stream. Dans l&#39;implementation de...">put</a>(tmp, tab_size, line_size);
<a name="l00372"></a>00372       <span class="keyword">delete</span>[] tmp;
<a name="l00373"></a>00373 <span class="comment">// Fin de bloc fortran</span>
<a name="l00374"></a>00374       <span class="keywordflow">if</span> (fichier.<a class="code" href="classFichier__Lata.html#a1a0c3473194894e5f5f79530abc45564" title="Si le fichier est de type partage, renvoie 1 si me() est egal au master du groupe et 0 sinon...">is_master</a>() &amp;&amp; bloc_number == nb_blocs - 1)
<a name="l00375"></a>00375         sfichier &lt;&lt; nb_octets * nb_blocs &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00376"></a>00376     }
<a name="l00377"></a>00377   <span class="keywordflow">else</span>
<a name="l00378"></a>00378     {
<a name="l00379"></a>00379 <span class="comment">// On convertit le tout en float par paquet de N valeurs</span>
<a name="l00380"></a>00380 <span class="comment">// Buffer dont la taille est un multiple de line_size:</span>
<a name="l00381"></a>00381       <span class="keyword">const</span> <span class="keywordtype">int</span> N = 16384;
<a name="l00382"></a>00382       <span class="keywordtype">int</span> bufsize = (N / line_size + 1) * line_size;
<a name="l00383"></a>00383       <span class="keywordtype">float</span> *tmp = <span class="keyword">new</span> <span class="keywordtype">float</span>[bufsize];
<a name="l00384"></a>00384       <span class="keyword">const</span> <span class="keywordtype">double</span> *data = tab.<a class="code" href="classArrOfDouble.html#a95357a1390c11dbd481d385257f2e983" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>();
<a name="l00385"></a>00385       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; tab_size; i += bufsize)
<a name="l00386"></a>00386         {
<a name="l00387"></a>00387           <span class="keywordtype">int</span> j_max = bufsize;
<a name="l00388"></a>00388           <span class="keywordflow">if</span> (j_max &gt; tab_size - i)
<a name="l00389"></a>00389             j_max = tab_size - i;
<a name="l00390"></a>00390 
<a name="l00391"></a>00391 <span class="comment">// Conversion du bloc en float:</span>
<a name="l00392"></a>00392           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; j_max; j++)
<a name="l00393"></a>00393             tmp[j] = data[i + j];
<a name="l00394"></a>00394 
<a name="l00395"></a>00395 <span class="comment">// Ecriture avec retour a la ligne a chaque ligne du tableau</span>
<a name="l00396"></a>00396           sfichier.<a class="code" href="classSortie.html#aa3f46aaccaff0f83c018784b50d8ea24" title="Methode de bas niveau pour ecrire un tableau d&#39;ints ou reels dans le stream. Dans l&#39;implementation de...">put</a>(tmp, j_max, line_size);
<a name="l00397"></a>00397         }
<a name="l00398"></a>00398       <span class="keyword">delete</span>[] tmp;
<a name="l00399"></a>00399       fichier.<a class="code" href="classFichier__Lata.html#af042e59f9c02f4d9c4087e126d711426" title="Si le fichier est de type partage, appelle la methode syncfile(), sinon ne fait rien.">syncfile</a>();
<a name="l00400"></a>00400 <span class="comment">// Fin de bloc fortran</span>
<a name="l00401"></a>00401       <span class="keywordflow">if</span> (fichier.<a class="code" href="classFichier__Lata.html#a1a0c3473194894e5f5f79530abc45564" title="Si le fichier est de type partage, renvoie 1 si me() est egal au master du groupe et 0 sinon...">is_master</a>() &amp;&amp; bloc_number == nb_blocs - 1)
<a name="l00402"></a>00402         sfichier &lt;&lt; nb_octets * nb_blocs &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00403"></a>00403       fichier.<a class="code" href="classFichier__Lata.html#af042e59f9c02f4d9c4087e126d711426" title="Si le fichier est de type partage, appelle la methode syncfile(), sinon ne fait rien.">syncfile</a>();
<a name="l00404"></a>00404     }
<a name="l00405"></a>00405 
<a name="l00406"></a>00406   <span class="keywordflow">return</span> nb_lignes_tot;
<a name="l00407"></a>00407 }
<a name="l00408"></a>00408 
<a name="l00409"></a>00409 <span class="comment">//</span>
<a name="l00410"></a>00410 <span class="comment">//</span>
<a name="l00411"></a>00411 <span class="comment">//</span>
<a name="l00412"></a>00412 <span class="comment">//</span>
<a name="l00413"></a>00413 <span class="comment">//</span>
<a name="l00414"></a>00414 <span class="comment">//</span>
<a name="l00415"></a>00415 <span class="comment">//</span><span class="comment"></span>
<a name="l00416"></a>00416 <span class="comment">//! Ecriture d&#39;un tableau d&#39;entiers dans le fichier fourni.&lt;br&gt;Les valeurs ecrites sont les valeurs du tableau auquelles ont ajoute&lt;br&gt;&quot;decalage&quot;. Cette valeur est utilisee pour passer en numerotation&lt;br&gt;fortran (ajouter 1), ou pour passer en numerotation globale (ajouter&lt;br&gt;le nombre d&#39;elements sur les processeurs precedents).&lt;br&gt;On renvoie dans nb_colonnes la somme des dimension(i) pour i&gt;0.&lt;br&gt;Valeur de retour: somme des dimension(0) ecrits (selon que tous les&lt;br&gt;processeurs ecrivent sur le meme fichier ou pas).</span>
<a name="l00417"></a><a class="code" href="classFormat__Post__Lata.html#ab01cd71e3e0e1220bbeb8e144b3f9731">00417</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="classFormat__Post__Lata.html#ab01cd71e3e0e1220bbeb8e144b3f9731" title="Ecriture d&#39;un tableau d&#39;entiers dans le fichier fourni. Les valeurs ecrites sont les valeurs du table...">Format_Post_Lata::write_inttab</a>(<a class="code" href="classFichier__Lata.html">Fichier_Lata</a>&amp; fichier,
<a name="l00418"></a>00418                                    <span class="keywordtype">int</span> decalage,
<a name="l00419"></a>00419                                    <span class="keywordtype">int</span> decalage_partiel,
<a name="l00420"></a>00420                                    <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; tab,
<a name="l00421"></a>00421                                    <span class="keywordtype">int</span>&amp; nb_colonnes,
<a name="l00422"></a>00422                                    <span class="keyword">const</span> <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94">Options_Para</a>&amp; <a class="code" href="classoption.html">option</a>)
<a name="l00423"></a>00423 {
<a name="l00424"></a>00424   assert(decalage_partiel&gt;=decalage);
<a name="l00425"></a>00425   assert((decalage==0)||(decalage==1));
<a name="l00426"></a>00426   <span class="keywordtype">int</span> nb_lignes = 0;
<a name="l00427"></a>00427   <span class="keywordtype">int</span> line_size = 1;
<a name="l00428"></a>00428   <span class="keywordtype">int</span> i;
<a name="l00429"></a>00429   nb_lignes = tab.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00430"></a>00430   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_dim = tab.<a class="code" href="classIntTab.html#ae307ece7edbe1d5facfbb81953b3e2b1" title="Returns the number of dimensions of the array (&gt;= 1)">nb_dim</a>();
<a name="l00431"></a>00431   <span class="keywordflow">for</span> (i = 1; i &lt; nb_dim; i++)
<a name="l00432"></a>00432     line_size *= tab.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(i);
<a name="l00433"></a>00433 
<a name="l00434"></a>00434   <span class="keywordtype">int</span> nb_lignes_tot = 0;
<a name="l00435"></a>00435 
<a name="l00436"></a>00436   <span class="keyword">const</span> <span class="keywordtype">int</span> tab_size = line_size * nb_lignes;
<a name="l00437"></a>00437   <span class="keywordtype">int</span> nb_octets = tab_size * <span class="keyword">sizeof</span>(<a class="code" href="Format__Post__Lata_8cpp.html#ab18839c853328b785784a699263ad3ee">_LATA_INT_TYPE_</a>);
<a name="l00438"></a>00438   <span class="keywordflow">switch</span>(option)
<a name="l00439"></a>00439     {
<a name="l00440"></a>00440     <span class="keywordflow">case</span> <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94a23ea36f7593e2b91825cd82fa150b5e4">Format_Post_Lata::SINGLE_FILE_MPIIO</a>:
<a name="l00441"></a>00441     <span class="keywordflow">case</span> <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94a448f17201fc397a7da69a62ae0637043">Format_Post_Lata::SINGLE_FILE</a>:
<a name="l00442"></a>00442       nb_lignes_tot = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(nb_lignes);
<a name="l00443"></a>00443 <span class="comment">// En parallele, tous les tableaux doivent avoir le meme nombre</span>
<a name="l00444"></a>00444 <span class="comment">// de colonnes (ou etre vides).</span>
<a name="l00445"></a>00445       nb_colonnes = (int) <a class="code" href="classProcess.html#a1e9d9f9899b71927cfafae14c7bd048d" title="Calcule le max de x sur tous les processeurs du groupe courant. Remarques : Cette methode doit etre a...">Process::mp_max</a>(line_size); <span class="comment">//!&lt; Zut. Pas de mp_max(int) !!!</span>
<a name="l00446"></a>00446 <span class="comment"></span>      nb_octets = nb_colonnes*nb_lignes_tot * <span class="keyword">sizeof</span>(<a class="code" href="Format__Post__Lata_8cpp.html#ab18839c853328b785784a699263ad3ee">_LATA_INT_TYPE_</a>);
<a name="l00447"></a>00447       assert(nb_lignes == 0 || line_size == nb_colonnes);
<a name="l00448"></a>00448       <span class="keywordflow">break</span>;
<a name="l00449"></a>00449     <span class="keywordflow">case</span> <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94aef0c737cbac106d4baaade24e94e5028">Format_Post_Lata::MULTIPLE_FILES</a>:
<a name="l00450"></a>00450       nb_lignes_tot = nb_lignes;
<a name="l00451"></a>00451       nb_colonnes = line_size;
<a name="l00452"></a>00452       <span class="keywordflow">break</span>;
<a name="l00453"></a>00453     <span class="keywordflow">default</span>:
<a name="l00454"></a>00454       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Format_Post_Lata_write_tab: error nb_lignes_tot&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00455"></a>00455       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00456"></a>00456     }
<a name="l00457"></a>00457 
<a name="l00458"></a>00458   <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a>&amp; sfichier = fichier.<a class="code" href="classFichier__Lata.html#a18a15a1d2d7f0edccbb258f9da1526b3">get_SFichier</a>();
<a name="l00459"></a>00459 
<a name="l00460"></a>00460 <span class="comment">// Debut de bloc fortran</span>
<a name="l00461"></a>00461   <span class="keywordflow">if</span> (fichier.<a class="code" href="classFichier__Lata.html#a1a0c3473194894e5f5f79530abc45564" title="Si le fichier est de type partage, renvoie 1 si me() est egal au master du groupe et 0 sinon...">is_master</a>())
<a name="l00462"></a>00462     sfichier &lt;&lt; nb_octets &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00463"></a>00463   <span class="keywordtype">int</span> erreurs = 0;
<a name="l00464"></a>00464 
<a name="l00465"></a>00465 <span class="comment">// Ecriture des donnees.</span>
<a name="l00466"></a>00466   <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classEcrFicPartageMPIIO.html" title="Class to use MPI-IO to write in a single file.">EcrFicPartageMPIIO</a>, sfichier))
<a name="l00467"></a>00467     {
<a name="l00468"></a>00468 <span class="comment">// On convertit le tout en _INT_TYPE_</span>
<a name="l00469"></a>00469       <a class="code" href="Format__Post__Lata_8cpp.html#ab18839c853328b785784a699263ad3ee">_LATA_INT_TYPE_</a> *tmp = <span class="keyword">new</span> <a class="code" href="Format__Post__Lata_8cpp.html#ab18839c853328b785784a699263ad3ee">_LATA_INT_TYPE_</a>[tab_size];
<a name="l00470"></a>00470       <span class="keyword">const</span> <span class="keywordtype">int</span> *data = tab.<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>();
<a name="l00471"></a>00471       <span class="keywordflow">for</span> (i = 0; i &lt; tab_size; i++)
<a name="l00472"></a>00472         {
<a name="l00473"></a>00473 <span class="comment">// valeur a ecrire (conversion en numerotation fortran si besoin)</span>
<a name="l00474"></a>00474           <span class="keywordtype">int</span> x = data[i];
<a name="l00475"></a>00475           <span class="keywordflow">if</span> (x &gt; -1)
<a name="l00476"></a>00476             x += decalage_partiel;
<a name="l00477"></a>00477           <span class="keywordflow">else</span>
<a name="l00478"></a>00478             x += decalage;
<a name="l00479"></a>00479 
<a name="l00480"></a>00480 <span class="comment">// conversion en type int pour ecriture</span>
<a name="l00481"></a>00481           <a class="code" href="Format__Post__Lata_8cpp.html#ab18839c853328b785784a699263ad3ee">_LATA_INT_TYPE_</a> y = (<a class="code" href="Format__Post__Lata_8cpp.html#ab18839c853328b785784a699263ad3ee">_LATA_INT_TYPE_</a>) x;
<a name="l00482"></a>00482 <span class="comment">// reconversion en int pour comparaison</span>
<a name="l00483"></a>00483           <span class="keywordtype">int</span> z = (int) y;
<a name="l00484"></a>00484           <span class="keywordflow">if</span> (x != z)
<a name="l00485"></a>00485             erreurs++;
<a name="l00486"></a>00486           tmp[i] = y;
<a name="l00487"></a>00487         }
<a name="l00488"></a>00488       sfichier.<a class="code" href="classSortie.html#aa3f46aaccaff0f83c018784b50d8ea24" title="Methode de bas niveau pour ecrire un tableau d&#39;ints ou reels dans le stream. Dans l&#39;implementation de...">put</a>(tmp, tab_size, line_size);
<a name="l00489"></a>00489       <span class="keyword">delete</span>[] tmp;
<a name="l00490"></a>00490 <span class="comment">// Fin de bloc fortran</span>
<a name="l00491"></a>00491       <span class="keywordflow">if</span> (fichier.<a class="code" href="classFichier__Lata.html#a1a0c3473194894e5f5f79530abc45564" title="Si le fichier est de type partage, renvoie 1 si me() est egal au master du groupe et 0 sinon...">is_master</a>())
<a name="l00492"></a>00492         sfichier &lt;&lt; nb_octets &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00493"></a>00493     }
<a name="l00494"></a>00494   <span class="keywordflow">else</span>
<a name="l00495"></a>00495     {
<a name="l00496"></a>00496 <span class="comment">// On convertit le tout en _INT_TYPE_ par paquet de N valeurs</span>
<a name="l00497"></a>00497 <span class="comment">// Buffer dont la taille est un multiple de line_size:</span>
<a name="l00498"></a>00498       <span class="keyword">const</span> <span class="keywordtype">int</span> N = 16384;
<a name="l00499"></a>00499       <span class="keywordtype">int</span> bufsize = (N / line_size + 1) * line_size;
<a name="l00500"></a>00500       <a class="code" href="Format__Post__Lata_8cpp.html#ab18839c853328b785784a699263ad3ee">_LATA_INT_TYPE_</a> *tmp = <span class="keyword">new</span> <a class="code" href="Format__Post__Lata_8cpp.html#ab18839c853328b785784a699263ad3ee">_LATA_INT_TYPE_</a>[bufsize];
<a name="l00501"></a>00501       <span class="keyword">const</span> <span class="keywordtype">int</span> *data = tab.<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>();
<a name="l00502"></a>00502       <span class="keywordflow">for</span> (i = 0; i &lt; tab_size; i += bufsize)
<a name="l00503"></a>00503         {
<a name="l00504"></a>00504           <span class="keywordtype">int</span> j;
<a name="l00505"></a>00505           <span class="keywordtype">int</span> j_max = bufsize;
<a name="l00506"></a>00506           <span class="keywordflow">if</span> (j_max &gt; tab_size - i)
<a name="l00507"></a>00507             j_max = tab_size - i;
<a name="l00508"></a>00508 
<a name="l00509"></a>00509 <span class="comment">// Conversion du bloc en int_type:</span>
<a name="l00510"></a>00510           <span class="keywordflow">for</span> (j = 0; j &lt; j_max; j++)
<a name="l00511"></a>00511             {
<a name="l00512"></a>00512 <span class="comment">// valeur a ecrire (conversion en numerotation fortran si besoin)</span>
<a name="l00513"></a>00513               <span class="keywordtype">int</span> x = data[i + j];
<a name="l00514"></a>00514               <span class="keywordflow">if</span> (x &gt; -1)
<a name="l00515"></a>00515                 x += decalage_partiel;
<a name="l00516"></a>00516               <span class="keywordflow">else</span>
<a name="l00517"></a>00517                 x += decalage;
<a name="l00518"></a>00518 
<a name="l00519"></a>00519 <span class="comment">// conversion en type int pour ecriture</span>
<a name="l00520"></a>00520               <a class="code" href="Format__Post__Lata_8cpp.html#ab18839c853328b785784a699263ad3ee">_LATA_INT_TYPE_</a> y = (<a class="code" href="Format__Post__Lata_8cpp.html#ab18839c853328b785784a699263ad3ee">_LATA_INT_TYPE_</a>) x;
<a name="l00521"></a>00521 <span class="comment">// reconversion en int pour comparaison</span>
<a name="l00522"></a>00522               <span class="keywordtype">int</span> z = (int) y;
<a name="l00523"></a>00523               <span class="keywordflow">if</span> (x != z)
<a name="l00524"></a>00524                 erreurs++;
<a name="l00525"></a>00525               tmp[j] = y;
<a name="l00526"></a>00526             }
<a name="l00527"></a>00527 <span class="comment">// Ecriture avec retour a la ligne a chaque ligne du tableau</span>
<a name="l00528"></a>00528           sfichier.<a class="code" href="classSortie.html#aa3f46aaccaff0f83c018784b50d8ea24" title="Methode de bas niveau pour ecrire un tableau d&#39;ints ou reels dans le stream. Dans l&#39;implementation de...">put</a>(tmp, j_max, line_size);
<a name="l00529"></a>00529         }
<a name="l00530"></a>00530       <span class="keyword">delete</span>[] tmp;
<a name="l00531"></a>00531       fichier.<a class="code" href="classFichier__Lata.html#af042e59f9c02f4d9c4087e126d711426" title="Si le fichier est de type partage, appelle la methode syncfile(), sinon ne fait rien.">syncfile</a>();
<a name="l00532"></a>00532 <span class="comment">// Fin de bloc fortran</span>
<a name="l00533"></a>00533       <span class="keywordflow">if</span> (fichier.<a class="code" href="classFichier__Lata.html#a1a0c3473194894e5f5f79530abc45564" title="Si le fichier est de type partage, renvoie 1 si me() est egal au master du groupe et 0 sinon...">is_master</a>())
<a name="l00534"></a>00534         sfichier &lt;&lt; nb_octets &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00535"></a>00535       fichier.<a class="code" href="classFichier__Lata.html#af042e59f9c02f4d9c4087e126d711426" title="Si le fichier est de type partage, appelle la methode syncfile(), sinon ne fait rien.">syncfile</a>();
<a name="l00536"></a>00536     }
<a name="l00537"></a>00537   <span class="keywordflow">if</span> (erreurs &gt; 0)
<a name="l00538"></a>00538     {
<a name="l00539"></a>00539       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Format_Post_Lata::write_inttab\n&quot;</span>
<a name="l00540"></a>00540            &lt;&lt; <span class="stringliteral">&quot; Some integers were truncated\n&quot;</span>
<a name="l00541"></a>00541            &lt;&lt; <span class="stringliteral">&quot; Recompile the code with #define _LATA_INT_TYPE_ entier&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00542"></a>00542       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00543"></a>00543     }
<a name="l00544"></a>00544   <span class="keywordflow">return</span> nb_lignes_tot;
<a name="l00545"></a>00545 }
<a name="l00546"></a>00546 
<a name="l00547"></a>00547 <span class="comment">//</span><span class="comment"></span>
<a name="l00548"></a>00548 <span class="comment">//! Constructeur par defaut: format_ ASCII et options_para_ = SINGLE_FILE</span>
<a name="l00549"></a><a class="code" href="classFormat__Post__Lata.html#a92fc4ff60b572d66a7d91ad3eb324cae">00549</a> <span class="comment"></span><a class="code" href="classFormat__Post__Lata.html#a92fc4ff60b572d66a7d91ad3eb324cae" title="Constructeur par defaut: format_ ASCII et options_para_ = SINGLE_FILE.">Format_Post_Lata::Format_Post_Lata</a>()
<a name="l00550"></a>00550 {
<a name="l00551"></a>00551   <a class="code" href="classFormat__Post__Lata.html#afbf8e205061cabb68f53f44fe507cbe7" title="Remet l&#39;objet dans l&#39;etat obtenu par le constructeur par defaut.">reset</a>();
<a name="l00552"></a>00552 }
<a name="l00553"></a>00553 
<a name="l00554"></a>00554 <span class="comment">//</span><span class="comment"></span>
<a name="l00555"></a>00555 <span class="comment">//! Remet l&#39;objet dans l&#39;etat obtenu par le constructeur par defaut.</span>
<a name="l00556"></a><a class="code" href="classFormat__Post__Lata.html#afbf8e205061cabb68f53f44fe507cbe7">00556</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classFormat__Post__Lata.html#afbf8e205061cabb68f53f44fe507cbe7" title="Remet l&#39;objet dans l&#39;etat obtenu par le constructeur par defaut.">Format_Post_Lata::reset</a>()
<a name="l00557"></a>00557 {
<a name="l00558"></a>00558   <a class="code" href="classFormat__Post__Lata.html#a8d55373127916e23ee800ef312f78cdd">lata_basename_</a> = <span class="stringliteral">&quot;??&quot;</span>;
<a name="l00559"></a>00559   <a class="code" href="classFormat__Post__Lata.html#a6f47f1f2016cce3ab8bb1b976ed0d921">format_</a> = <a class="code" href="classFormat__Post__Lata.html#a8698c5e7e825c54749a7365f7ffff53ca64e753afccaf02de631ef2ad18733aab">ASCII</a>;
<a name="l00560"></a>00560   <a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a> = <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94a448f17201fc397a7da69a62ae0637043">SINGLE_FILE</a>;
<a name="l00561"></a>00561   <a class="code" href="classFormat__Post__Lata.html#ab0b792d3f25872b859dc9c2170a9ac2d">status</a> = <a class="code" href="classFormat__Post__Lata.html#a94fde71d0a9cc3249bff7f66cc4aeacca77c87ecaad62a824d2cd3bdfe4b60317">RESET</a>;
<a name="l00562"></a>00562   <a class="code" href="classFormat__Post__Lata.html#a377324ba785a6d3bf7c120c078146dd2">temps_courant_</a> = -1.;
<a name="l00563"></a>00563   <a class="code" href="classFormat__Post__Lata.html#af570869762b22c2b2d6af6cbb915d557">deja_fait_</a>=0;
<a name="l00564"></a>00564   <a class="code" href="classFormat__Post__Lata.html#a7ead5ea7b75f70ae7d897f491af27633">tinit_</a>=-1.;
<a name="l00565"></a>00565   <a class="code" href="classFormat__Post__Lata.html#a064f70a875931f52b98386f3bd3fe215">file_existe_</a>=0;
<a name="l00566"></a>00566 }
<a name="l00567"></a>00567 <span class="comment"></span>
<a name="l00568"></a>00568 <span class="comment">//! erreur =&gt; exit</span>
<a name="l00569"></a><a class="code" href="classFormat__Post__Lata.html#a0e0d8e523e786928cdb82b732a7d3526">00569</a> <span class="comment"></span><a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classFormat__Post__Lata.html#a0e0d8e523e786928cdb82b732a7d3526" title="erreur =&gt; exit">Format_Post_Lata::printOn</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os)<span class="keyword"> const</span>
<a name="l00570"></a>00570 <span class="keyword"></span>{
<a name="l00571"></a>00571   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Format_Post_Lata::printOn : error&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00572"></a>00572   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00573"></a>00573   <span class="keywordflow">return</span> os;
<a name="l00574"></a>00574 }
<a name="l00575"></a>00575 
<a name="l00576"></a>00576 <span class="comment">//</span>
<a name="l00577"></a>00577 <span class="comment">//</span>
<a name="l00578"></a>00578 <span class="comment">//</span>
<a name="l00579"></a>00579 <span class="comment">//</span>
<a name="l00580"></a>00580 <span class="comment">//</span>
<a name="l00581"></a>00581 <span class="comment">//</span><span class="comment"></span>
<a name="l00582"></a>00582 <span class="comment">//! Lecture des parametres du postraitement au format &quot;jeu de donnees&quot;&lt;br&gt;Le format attendu est le suivant:&lt;br&gt;{&lt;br&gt;nom_fichier nom                       champ obligatoire&lt;br&gt;[ format   ascii|binaire ]              valeur par defaut : ascii&lt;br&gt;[ parallel single_file|multiple_files ] valeur par defaut : single_file&lt;br&gt;}</span>
<a name="l00583"></a><a class="code" href="classFormat__Post__Lata.html#adcf8f70273a0f89e83aace2258fe9372">00583</a> <span class="comment"></span><a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classFormat__Post__Lata.html#adcf8f70273a0f89e83aace2258fe9372" title="Lecture des parametres du postraitement au format &quot;jeu de donnees&quot; Le format attendu est le suivant: ...">Format_Post_Lata::readOn</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00584"></a>00584 {
<a name="l00585"></a>00585   assert(<a class="code" href="classFormat__Post__Lata.html#ab0b792d3f25872b859dc9c2170a9ac2d">status</a> == <a class="code" href="classFormat__Post__Lata.html#a94fde71d0a9cc3249bff7f66cc4aeacca77c87ecaad62a824d2cd3bdfe4b60317">RESET</a>);
<a name="l00586"></a>00586   <a class="code" href="classFormat__Post__Lata.html#adcf8f70273a0f89e83aace2258fe9372" title="Lecture des parametres du postraitement au format &quot;jeu de donnees&quot; Le format attendu est le suivant: ...">Format_Post_base::readOn</a>(is);
<a name="l00587"></a>00587   <a class="code" href="classFormat__Post__Lata.html#ab0b792d3f25872b859dc9c2170a9ac2d">status</a> = <a class="code" href="classFormat__Post__Lata.html#a94fde71d0a9cc3249bff7f66cc4aeaccae95363a94fad9ca940d985500b7f561f">INITIALIZED</a>;
<a name="l00588"></a>00588   <span class="keywordflow">return</span> is;
<a name="l00589"></a>00589 }
<a name="l00590"></a>00590 
<a name="l00591"></a><a class="code" href="classFormat__Post__Lata.html#a11f002f45f53fe63139b0b4a27f0fa11">00591</a> <span class="keywordtype">void</span> <a class="code" href="classFormat__Post__Lata.html#a11f002f45f53fe63139b0b4a27f0fa11">Format_Post_Lata::set_param</a>(<a class="code" href="classParam.html" title="Defined below in this file.">Param</a>&amp; param)
<a name="l00592"></a>00592 {
<a name="l00593"></a>00593   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Format_Post_Lata::set_param: Not implemented.&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00594"></a>00594   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00595"></a>00595 }
<a name="l00596"></a>00596 
<a name="l00597"></a><a class="code" href="classFormat__Post__Lata.html#ab064c967a39227c6c98119dac2e5d703">00597</a> <span class="keywordtype">int</span> <a class="code" href="classFormat__Post__Lata.html#ab064c967a39227c6c98119dac2e5d703" title="Lecture des parametres de type non simple d&#39;un objet_U a partir d&#39;un flot d&#39;entree.">Format_Post_Lata::lire_motcle_non_standard</a>(<span class="keyword">const</span> <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>&amp; mot, <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00598"></a>00598 {
<a name="l00599"></a>00599   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Format_Post_Lata::lire_motcle_non_standard: Not implemented.&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00600"></a>00600   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00601"></a>00601   <span class="keywordflow">return</span> 0;
<a name="l00602"></a>00602 }
<a name="l00603"></a>00603 
<a name="l00604"></a>00604 <span class="comment">//</span><span class="comment"></span>
<a name="l00605"></a>00605 <span class="comment">//! Initialisation de la classe avec des parametres par&lt;br&gt;defaut (format ASCII, SINGLE_FILE)</span>
<a name="l00606"></a><a class="code" href="classFormat__Post__Lata.html#a6460dd2a3010681aba2f63cd480f722a">00606</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="classFormat__Post__Lata.html#a6460dd2a3010681aba2f63cd480f722a" title="Initialisation de la classe avec des parametres par defaut (format ASCII, SINGLE_FILE)">Format_Post_Lata::initialize_by_default</a>(<span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; file_basename)
<a name="l00607"></a>00607 {
<a name="l00608"></a>00608   assert(<a class="code" href="classFormat__Post__Lata.html#ab0b792d3f25872b859dc9c2170a9ac2d">status</a> == <a class="code" href="classFormat__Post__Lata.html#a94fde71d0a9cc3249bff7f66cc4aeacca77c87ecaad62a824d2cd3bdfe4b60317">RESET</a>);
<a name="l00609"></a>00609   <a class="code" href="classFormat__Post__Lata.html#a0e6fbe4681402f309b5744e1c0823077" title="Initialisation de la classe, ouverture du fichier et ecriture de l&#39;entete.">initialize_lata</a>(file_basename, <a class="code" href="classFormat__Post__Lata.html#a8698c5e7e825c54749a7365f7ffff53ca64e753afccaf02de631ef2ad18733aab">ASCII</a>, <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94a448f17201fc397a7da69a62ae0637043">SINGLE_FILE</a>);
<a name="l00610"></a>00610   <span class="keywordflow">return</span> 1;
<a name="l00611"></a>00611 }
<a name="l00612"></a>00612 
<a name="l00613"></a><a class="code" href="classFormat__Post__Lata.html#a0008b976e96b7490f4427307ba3bd8e1">00613</a> <span class="keywordtype">int</span> <a class="code" href="classFormat__Post__Lata.html#a0008b976e96b7490f4427307ba3bd8e1">Format_Post_Lata::initialize</a>(<span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; file_basename, <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; format, <span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; option_para)
<a name="l00614"></a>00614 {
<a name="l00615"></a>00615   assert(<a class="code" href="classFormat__Post__Lata.html#ab0b792d3f25872b859dc9c2170a9ac2d">status</a> == <a class="code" href="classFormat__Post__Lata.html#a94fde71d0a9cc3249bff7f66cc4aeacca77c87ecaad62a824d2cd3bdfe4b60317">RESET</a>);
<a name="l00616"></a>00616 <span class="comment">// Changement du format LATA (par defaut binaire)</span>
<a name="l00617"></a>00617   <a class="code" href="classFormat__Post__Lata.html#a6f47f1f2016cce3ab8bb1b976ed0d921">format_</a>=<a class="code" href="classFormat__Post__Lata.html#a8698c5e7e825c54749a7365f7ffff53ca2d3fa963128b6785fca8a03841962e16">BINAIRE</a>;
<a name="l00618"></a>00618   <span class="keywordflow">if</span> (format==0)
<a name="l00619"></a>00619     <a class="code" href="classFormat__Post__Lata.html#a6f47f1f2016cce3ab8bb1b976ed0d921">format_</a>=<a class="code" href="classFormat__Post__Lata.html#a8698c5e7e825c54749a7365f7ffff53ca64e753afccaf02de631ef2ad18733aab">ASCII</a>;
<a name="l00620"></a>00620 
<a name="l00621"></a>00621   <span class="keywordflow">if</span> (<a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>(option_para)==<span class="stringliteral">&quot;MPI-IO&quot;</span>)
<a name="l00622"></a>00622     <a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a> = <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94a23ea36f7593e2b91825cd82fa150b5e4">SINGLE_FILE_MPIIO</a>;
<a name="l00623"></a>00623   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>(option_para)==<span class="stringliteral">&quot;SIMPLE&quot;</span>)
<a name="l00624"></a>00624     <a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a> = <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94a448f17201fc397a7da69a62ae0637043">SINGLE_FILE</a>;
<a name="l00625"></a>00625   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>(option_para)==<span class="stringliteral">&quot;MULTIPLE&quot;</span>)
<a name="l00626"></a>00626     <a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a> = <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94aef0c737cbac106d4baaade24e94e5028">MULTIPLE_FILES</a>;
<a name="l00627"></a>00627   <span class="keywordflow">else</span>
<a name="l00628"></a>00628     {
<a name="l00629"></a>00629       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;The option &quot;</span> &lt;&lt; option_para &lt;&lt; <span class="stringliteral">&quot; for lata format for the parallel is not correct.&quot;</span>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00630"></a>00630       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00631"></a>00631     }
<a name="l00632"></a>00632 
<a name="l00633"></a>00633   <a class="code" href="classFormat__Post__Lata.html#a0e6fbe4681402f309b5744e1c0823077" title="Initialisation de la classe, ouverture du fichier et ecriture de l&#39;entete.">initialize_lata</a>(file_basename,<a class="code" href="classFormat__Post__Lata.html#a6f47f1f2016cce3ab8bb1b976ed0d921">format_</a>,<a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a>);
<a name="l00634"></a>00634 
<a name="l00635"></a>00635   <span class="keywordflow">return</span> 1;
<a name="l00636"></a>00636 }
<a name="l00637"></a>00637 
<a name="l00638"></a>00638 <span class="comment">//</span><span class="comment"></span>
<a name="l00639"></a>00639 <span class="comment">//! Initialisation de la classe, ouverture du fichier et ecriture&lt;br&gt;de l&#39;entete.</span>
<a name="l00640"></a><a class="code" href="classFormat__Post__Lata.html#a0e6fbe4681402f309b5744e1c0823077">00640</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="classFormat__Post__Lata.html#a0e6fbe4681402f309b5744e1c0823077" title="Initialisation de la classe, ouverture du fichier et ecriture de l&#39;entete.">Format_Post_Lata::initialize_lata</a>(<span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; file_basename,
<a name="l00641"></a>00641                                       <span class="keyword">const</span> <a class="code" href="classFormat__Post__Lata.html#a8698c5e7e825c54749a7365f7ffff53c">Format</a> format,
<a name="l00642"></a>00642                                       <span class="keyword">const</span> <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94">Options_Para</a> options_para)
<a name="l00643"></a>00643 {
<a name="l00644"></a>00644   assert(<a class="code" href="classFormat__Post__Lata.html#ab0b792d3f25872b859dc9c2170a9ac2d">status</a> == <a class="code" href="classFormat__Post__Lata.html#a94fde71d0a9cc3249bff7f66cc4aeacca77c87ecaad62a824d2cd3bdfe4b60317">RESET</a>);
<a name="l00645"></a>00645   <a class="code" href="classFormat__Post__Lata.html#a8d55373127916e23ee800ef312f78cdd">lata_basename_</a> = file_basename;
<a name="l00646"></a>00646   <a class="code" href="classFormat__Post__Lata.html#a6f47f1f2016cce3ab8bb1b976ed0d921">format_</a> = format;
<a name="l00647"></a>00647   <a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a> = options_para;
<a name="l00648"></a>00648 
<a name="l00649"></a>00649   <a class="code" href="classFormat__Post__Lata.html#ab0b792d3f25872b859dc9c2170a9ac2d">status</a> = <a class="code" href="classFormat__Post__Lata.html#a94fde71d0a9cc3249bff7f66cc4aeaccae95363a94fad9ca940d985500b7f561f">INITIALIZED</a>;
<a name="l00650"></a>00650   <span class="keywordflow">return</span> 1;
<a name="l00651"></a>00651 }
<a name="l00652"></a>00652 <span class="comment"></span>
<a name="l00653"></a>00653 <span class="comment">//! Modification du nom du fichier de postraitement.</span>
<a name="l00654"></a><a class="code" href="classFormat__Post__Lata.html#a78f673525e8530fd7429ea4cd3b1b31a">00654</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="classFormat__Post__Lata.html#a78f673525e8530fd7429ea4cd3b1b31a" title="Modification du nom du fichier de postraitement.">Format_Post_Lata::modify_file_basename</a>(<span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> file_basename, <span class="keyword">const</span> <span class="keywordtype">int</span> a_faire, <span class="keyword">const</span> <span class="keywordtype">double</span> tinit)
<a name="l00655"></a>00655 {
<a name="l00656"></a>00656   assert(a_faire==0||a_faire==1||a_faire==2);
<a name="l00657"></a>00657 
<a name="l00658"></a>00658   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> post_file;
<a name="l00659"></a>00659   post_file=file_basename+<a class="code" href="classFormat__Post__Lata.html#aee3312d2f199be29261229ab7f874a40" title="Renvoie l&#39;extension conventionnelle des fichiers lata : &quot;.lata&quot;.">extension_lata</a>();
<a name="l00660"></a>00660 <span class="comment">// On verifie que le fichier maitre existe et a une entete correcte</span>
<a name="l00661"></a>00661   <a class="code" href="classFormat__Post__Lata.html#a064f70a875931f52b98386f3bd3fe215">file_existe_</a>=0;
<a name="l00662"></a>00662   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l00663"></a>00663     {
<a name="l00664"></a>00664       <span class="keyword">struct </span>stat f;
<a name="l00665"></a>00665       <span class="keywordflow">if</span> (stat(post_file,&amp;f)==0)
<a name="l00666"></a>00666         {
<a name="l00667"></a>00667           <a class="code" href="classEFichier.html" title="Fichier en lecture Cette classe est a la classe C++ ifstream ce que la classe Entree est a la classe ...">EFichier</a> tmp(post_file);
<a name="l00668"></a>00668           <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> cle;
<a name="l00669"></a>00669           tmp &gt;&gt; cle;
<a name="l00670"></a>00670           <span class="keywordflow">if</span> (cle.debute_par(<span class="stringliteral">&quot;LATA&quot;</span>))
<a name="l00671"></a>00671             {
<a name="l00672"></a>00672               <span class="keywordflow">if</span> (tinit==-1)
<a name="l00673"></a>00673                 {
<a name="l00674"></a>00674                   <a class="code" href="classFormat__Post__Lata.html#a064f70a875931f52b98386f3bd3fe215">file_existe_</a>=1;
<a name="l00675"></a>00675                 }
<a name="l00676"></a>00676               <span class="keywordflow">else</span>
<a name="l00677"></a>00677                 {
<a name="l00678"></a>00678                   tmp &gt;&gt; cle;
<a name="l00679"></a>00679                   <span class="keywordflow">while</span> (!tmp.<a class="code" href="classEntree__Fichier__base.html#a5e6b0d743eb5c7986090c615bd7ad584">eof</a>() &amp;&amp; cle!=<span class="stringliteral">&quot;TEMPS&quot;</span>) tmp &gt;&gt; cle;
<a name="l00680"></a>00680                   <span class="keywordflow">if</span> (cle==<span class="stringliteral">&quot;TEMPS&quot;</span>)
<a name="l00681"></a>00681                     {
<a name="l00682"></a>00682                       <span class="keywordtype">double</span> temps;
<a name="l00683"></a>00683                       tmp &gt;&gt; temps;
<a name="l00684"></a>00684 <span class="comment">// On verifie le temps du fichier de reprise</span>
<a name="l00685"></a>00685                       <span class="keywordflow">if</span> (temps&lt;tinit)
<a name="l00686"></a>00686                         <a class="code" href="classFormat__Post__Lata.html#a064f70a875931f52b98386f3bd3fe215">file_existe_</a>=1;
<a name="l00687"></a>00687                     }
<a name="l00688"></a>00688                 }
<a name="l00689"></a>00689             }
<a name="l00690"></a>00690           tmp.<a class="code" href="classEntree__Fichier__base.html#aca9165bc1712c1057b4d4b91a7ea4fb4">close</a>();
<a name="l00691"></a>00691         }
<a name="l00692"></a>00692     }
<a name="l00693"></a>00693 <span class="comment">// Point de synchronisation necessaire:</span>
<a name="l00694"></a>00694   <a class="code" href="classFormat__Post__Lata.html#a064f70a875931f52b98386f3bd3fe215">file_existe_</a> = (int)<a class="code" href="classProcess.html#a1e9d9f9899b71927cfafae14c7bd048d" title="Calcule le max de x sur tous les processeurs du groupe courant. Remarques : Cette methode doit etre a...">Process::mp_max</a>(<a class="code" href="classFormat__Post__Lata.html#a064f70a875931f52b98386f3bd3fe215">file_existe_</a>);
<a name="l00695"></a>00695   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>() &amp;&amp; <a class="code" href="classFormat__Post__Lata.html#a064f70a875931f52b98386f3bd3fe215">file_existe_</a> &amp;&amp; <a class="code" href="classFormat__Post__Lata.html#af570869762b22c2b2d6af6cbb915d557">deja_fait_</a>==0 &amp;&amp; a_faire)
<a name="l00696"></a>00696     {
<a name="l00697"></a>00697       <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> before_restart;
<a name="l00698"></a>00698       before_restart=file_basename+<span class="stringliteral">&quot;.before_restart&quot;</span>+<a class="code" href="classFormat__Post__Lata.html#aee3312d2f199be29261229ab7f874a40" title="Renvoie l&#39;extension conventionnelle des fichiers lata : &quot;.lata&quot;.">extension_lata</a>();
<a name="l00699"></a>00699       rename(post_file,before_restart);
<a name="l00700"></a>00700       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;File &quot;</span> &lt;&lt; post_file &lt;&lt; <span class="stringliteral">&quot; is moved to &quot;</span> &lt;&lt; before_restart &lt;&lt; <span class="stringliteral">&quot; with times&lt;=tinit=&quot;</span> &lt;&lt; tinit &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00701"></a>00701       <a class="code" href="classFormat__Post__Lata.html#a8b67db1cb7b1c0f093633e48ca039851">reconstruct</a>(post_file,before_restart,tinit);
<a name="l00702"></a>00702     }
<a name="l00703"></a>00703   deja_fait_=1;
<a name="l00704"></a>00704 <span class="comment">// On attend tous les processeurs (prudence excessive?)</span>
<a name="l00705"></a>00705   <a class="code" href="classProcess.html#aa9e74a5c06a68ea38298a08ea401e7b1" title="Synchronise tous les processeurs du groupe courant&lt;br&gt;(attend que tous les processeurs soient arrives...">Process::barrier</a>();
<a name="l00706"></a>00706   <span class="keywordflow">if</span> (<a class="code" href="classFormat__Post__Lata.html#a064f70a875931f52b98386f3bd3fe215">file_existe_</a>)
<a name="l00707"></a>00707     {
<a name="l00708"></a>00708       <span class="keywordflow">if</span> (a_faire==0)
<a name="l00709"></a>00709         <a class="code" href="classFormat__Post__Lata.html#a8d55373127916e23ee800ef312f78cdd">lata_basename_</a> = file_basename;
<a name="l00710"></a>00710       <span class="keywordflow">else</span>
<a name="l00711"></a>00711         {
<a name="l00712"></a>00712           <a class="code" href="classFormat__Post__Lata.html#a8d55373127916e23ee800ef312f78cdd">lata_basename_</a> = file_basename+<span class="stringliteral">&quot;.after_restart&quot;</span>;
<a name="l00713"></a>00713           <span class="keywordflow">if</span> (tinit==-1) <a class="code" href="classFormat__Post__Lata.html#a7c2db13393d70a91930da6edcea52435">finir_sans_reprise</a>(post_file);
<a name="l00714"></a>00714         }
<a name="l00715"></a>00715     }
<a name="l00716"></a>00716   <span class="keywordflow">return</span> 1;
<a name="l00717"></a>00717 }
<a name="l00718"></a>00718 
<a name="l00719"></a>00719 <span class="comment">// Copie du debut du fichier before_restart dans post_file (jusqu&#39;au TEMPS=tinit)</span>
<a name="l00720"></a><a class="code" href="classFormat__Post__Lata.html#a8b67db1cb7b1c0f093633e48ca039851">00720</a> <span class="keywordtype">int</span> <a class="code" href="classFormat__Post__Lata.html#a8b67db1cb7b1c0f093633e48ca039851">Format_Post_Lata::reconstruct</a>(<span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> post_file, <span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> before_restart, <span class="keyword">const</span> <span class="keywordtype">double</span> tinit)
<a name="l00721"></a>00721 {
<a name="l00722"></a>00722   <a class="code" href="classEFichier.html" title="Fichier en lecture Cette classe est a la classe C++ ifstream ce que la classe Entree est a la classe ...">EFichier</a> LataOld(before_restart);
<a name="l00723"></a>00723   <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a> LataNew(post_file);
<a name="l00724"></a>00724   LataNew.<a class="code" href="classSortie__Fichier__base.html#a5ddd834ca9c766c24cc608cd03ef0e96">setf</a>(ios::scientific);
<a name="l00725"></a>00725   LataNew.<a class="code" href="classSortie__Fichier__base.html#a489ca01946f4e2a7a9aa8f3a3d949b08">precision</a>(8);
<a name="l00726"></a>00726   std::string line;
<a name="l00727"></a>00727   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> mot;
<a name="l00728"></a>00728   <span class="keywordtype">double</span> temps;
<a name="l00729"></a>00729   <a class="code" href="classFormat__Post__Lata.html#a7ead5ea7b75f70ae7d897f491af27633">tinit_</a>=tinit;
<a name="l00730"></a>00730   <span class="keywordflow">while</span> (!LataOld.<a class="code" href="classEntree__Fichier__base.html#a5e6b0d743eb5c7986090c615bd7ad584">eof</a>())
<a name="l00731"></a>00731     {
<a name="l00732"></a>00732       LataOld &gt;&gt; mot;                                                        <span class="comment">//!&lt; je lis le premier mot de la ligne dans .before_restart.lata</span>
<a name="l00733"></a>00733 <span class="comment"></span>      <span class="keywordflow">if</span> (mot!=<span class="stringliteral">&quot;FIN&quot;</span>)                                                        <span class="comment">//!&lt; Si le mot n&#39;est pas FIN</span>
<a name="l00734"></a>00734 <span class="comment"></span>        {
<a name="l00735"></a>00735           <span class="keywordflow">if</span> (mot==<span class="stringliteral">&quot;TEMPS&quot;</span>)                                                        <span class="comment">//!&lt; Si le mot suivant est TEMPS</span>
<a name="l00736"></a>00736 <span class="comment"></span>            {
<a name="l00737"></a>00737               LataOld &gt;&gt; temps;
<a name="l00738"></a>00738               <span class="keywordflow">if</span> (temps==tinit)                                                <span class="comment">//!&lt; Si le temps trouvee = tinit alors j&#39;arrete</span>
<a name="l00739"></a>00739 <span class="comment"></span>                <span class="keywordflow">break</span>;
<a name="l00740"></a>00740               std::getline(LataOld.<a class="code" href="classEntree__Fichier__base.html#a9e5abc201d0864efb7e22b593556f432">get_ifstream</a>(), line) ;                        <span class="comment">//!&lt; je lis le reste de la ligne</span>
<a name="l00741"></a>00741 <span class="comment"></span>              LataNew.<a class="code" href="classSortie__Fichier__base.html#ad69731ab342e17049de30c55b80b6941">get_ofstream</a>() &lt;&lt; mot &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; temps &lt;&lt; line &lt;&lt; std::endl;        <span class="comment">//!&lt; et j&#39;ecris le tout dans le lata</span>
<a name="l00742"></a>00742 <span class="comment"></span>            }
<a name="l00743"></a>00743           <span class="keywordflow">else</span>
<a name="l00744"></a>00744             {
<a name="l00745"></a>00745               std::getline(LataOld.<a class="code" href="classEntree__Fichier__base.html#a9e5abc201d0864efb7e22b593556f432">get_ifstream</a>(), line) ;                        <span class="comment">//!&lt; je lis le reste de la ligne</span>
<a name="l00746"></a>00746 <span class="comment"></span>              LataNew.<a class="code" href="classSortie__Fichier__base.html#ad69731ab342e17049de30c55b80b6941">get_ofstream</a>() &lt;&lt; mot &lt;&lt; line &lt;&lt; std::endl;                        <span class="comment">//!&lt; et j&#39;ecris le tout dans le lata</span>
<a name="l00747"></a>00747 <span class="comment"></span>            }
<a name="l00748"></a>00748         }
<a name="l00749"></a>00749       <span class="keywordflow">else</span>
<a name="l00750"></a>00750         {
<a name="l00751"></a>00751           <span class="keywordflow">break</span>;                                                                <span class="comment">//!&lt; Sinon j&#39;arrete</span>
<a name="l00752"></a>00752 <span class="comment"></span>        }
<a name="l00753"></a>00753     }
<a name="l00754"></a>00754   LataNew.<a class="code" href="classSortie__Fichier__base.html#ac246a47c4438e3183322c20db2a3323c">close</a>();
<a name="l00755"></a>00755   LataOld.<a class="code" href="classEntree__Fichier__base.html#aca9165bc1712c1057b4d4b91a7ea4fb4">close</a>();
<a name="l00756"></a>00756   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;File &quot;</span> &lt;&lt; post_file &lt;&lt; <span class="stringliteral">&quot; is rebuilt but truncated to times&lt;tinit=&quot;</span> &lt;&lt; tinit &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00757"></a>00757   <span class="keywordflow">return</span> 1;
<a name="l00758"></a>00758 }
<a name="l00759"></a>00759 
<a name="l00760"></a><a class="code" href="classFormat__Post__Lata.html#a7c2db13393d70a91930da6edcea52435">00760</a> <span class="keywordtype">int</span> <a class="code" href="classFormat__Post__Lata.html#a7c2db13393d70a91930da6edcea52435">Format_Post_Lata::finir_sans_reprise</a>(<span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> file_basename)
<a name="l00761"></a>00761 {
<a name="l00762"></a>00762   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> post_file;
<a name="l00763"></a>00763   post_file=<a class="code" href="classFormat__Post__Lata.html#a8d55373127916e23ee800ef312f78cdd">lata_basename_</a>+<a class="code" href="classFormat__Post__Lata.html#aee3312d2f199be29261229ab7f874a40" title="Renvoie l&#39;extension conventionnelle des fichiers lata : &quot;.lata&quot;.">extension_lata</a>();
<a name="l00764"></a>00764   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l00765"></a>00765     {
<a name="l00766"></a>00766       <span class="keyword">struct </span>stat f;
<a name="l00767"></a>00767       <span class="keywordflow">if</span> (stat(post_file,&amp;f)==0)
<a name="l00768"></a>00768         {
<a name="l00769"></a>00769           <a class="code" href="classEFichier.html" title="Fichier en lecture Cette classe est a la classe C++ ifstream ce que la classe Entree est a la classe ...">EFichier</a> Lata(file_basename);
<a name="l00770"></a>00770           <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a> LataRep(post_file, ios::app);
<a name="l00771"></a>00771           LataRep.<a class="code" href="classSortie__Fichier__base.html#a5ddd834ca9c766c24cc608cd03ef0e96">setf</a>(ios::scientific);
<a name="l00772"></a>00772           LataRep.<a class="code" href="classSortie__Fichier__base.html#a489ca01946f4e2a7a9aa8f3a3d949b08">precision</a>(8);
<a name="l00773"></a>00773           std::string line;
<a name="l00774"></a>00774           <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> mot;
<a name="l00775"></a>00775           <span class="keywordtype">double</span> temps;
<a name="l00776"></a>00776           <span class="keywordflow">while</span> (!Lata.<a class="code" href="classEntree__Fichier__base.html#a5e6b0d743eb5c7986090c615bd7ad584">eof</a>())
<a name="l00777"></a>00777             {
<a name="l00778"></a>00778               Lata &gt;&gt; mot;                                                                <span class="comment">//!&lt; je lis le premier mot de la ligne dans .lata</span>
<a name="l00779"></a>00779 <span class="comment"></span>              <span class="keywordflow">if</span> (mot==<span class="stringliteral">&quot;TEMPS&quot;</span>)                                                        <span class="comment">//!&lt; Si le mot suivant n&#39;est pas TEMPS</span>
<a name="l00780"></a>00780 <span class="comment"></span>                {
<a name="l00781"></a>00781                   Lata &gt;&gt; temps;
<a name="l00782"></a>00782                   <span class="keywordflow">if</span> (temps==<a class="code" href="classFormat__Post__Lata.html#a7ead5ea7b75f70ae7d897f491af27633">tinit_</a>)                                                        <span class="comment">//!&lt; Si le temps trouvee = tinit alors</span>
<a name="l00783"></a>00783 <span class="comment"></span>                    {
<a name="l00784"></a>00784                       std::getline(Lata.<a class="code" href="classEntree__Fichier__base.html#a9e5abc201d0864efb7e22b593556f432">get_ifstream</a>(), line) ;
<a name="l00785"></a>00785                       LataRep.<a class="code" href="classSortie__Fichier__base.html#ad69731ab342e17049de30c55b80b6941">get_ofstream</a>() &lt;&lt; mot &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; temps &lt;&lt; line &lt;&lt; std::endl;        <span class="comment">//!&lt; je peux commencer a ecrire</span>
<a name="l00786"></a>00786 <span class="comment"></span>                      <span class="keywordflow">break</span>;
<a name="l00787"></a>00787                     }
<a name="l00788"></a>00788                 }
<a name="l00789"></a>00789             }
<a name="l00790"></a>00790           <span class="keywordflow">while</span> (!Lata.<a class="code" href="classEntree__Fichier__base.html#a5e6b0d743eb5c7986090c615bd7ad584">eof</a>())
<a name="l00791"></a>00791             {
<a name="l00792"></a>00792               std::getline(Lata.<a class="code" href="classEntree__Fichier__base.html#a9e5abc201d0864efb7e22b593556f432">get_ifstream</a>(), line);                                <span class="comment">//!&lt; je lis le reste du .lata</span>
<a name="l00793"></a>00793 <span class="comment"></span>              LataRep.<a class="code" href="classSortie__Fichier__base.html#ad69731ab342e17049de30c55b80b6941">get_ofstream</a>() &lt;&lt; line &lt;&lt; std::endl;                                        <span class="comment">//!&lt; et j&#39;ecris le tout dans le after_restart.lata</span>
<a name="l00794"></a>00794 <span class="comment"></span>            }
<a name="l00795"></a>00795           Lata.<a class="code" href="classEntree__Fichier__base.html#aca9165bc1712c1057b4d4b91a7ea4fb4">close</a>();
<a name="l00796"></a>00796           LataRep.<a class="code" href="classSortie__Fichier__base.html#ac246a47c4438e3183322c20db2a3323c">close</a>();
<a name="l00797"></a>00797           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;File &quot;</span> &lt;&lt; post_file &lt;&lt; <span class="stringliteral">&quot; is built with times from tinit=&quot;</span> &lt;&lt; <a class="code" href="classFormat__Post__Lata.html#a7ead5ea7b75f70ae7d897f491af27633">tinit_</a> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00798"></a>00798         }
<a name="l00799"></a>00799     }
<a name="l00800"></a>00800   <span class="keywordflow">return</span> 1;
<a name="l00801"></a>00801 }
<a name="l00802"></a>00802 
<a name="l00803"></a>00803 <span class="comment">//</span>
<a name="l00804"></a>00804 <span class="comment">//</span>
<a name="l00805"></a>00805 <span class="comment">//</span>
<a name="l00806"></a>00806 <span class="comment">//</span>
<a name="l00807"></a>00807 <span class="comment">//</span>
<a name="l00808"></a>00808 <span class="comment">//</span>
<a name="l00809"></a>00809 <span class="comment">//</span><span class="comment"></span>
<a name="l00810"></a>00810 <span class="comment">//! voir Format_Post_base::ecrire_domaine&lt;br&gt;On accepte l&#39;ecriture d&#39;un domaine dans un pas de temps, mais&lt;br&gt;les id_domaines doivent etre tous distincts.&lt;br&gt;Ecrit le fichier &quot;basename(_XXXXX).lata.nom_domaine&quot;, qui contient&lt;br&gt;la liste des sommets et la liste des elements.&lt;br&gt;Si le PE est maitre, ouvre le fichier maitre en mode APPEND et&lt;br&gt;ajoute une reference a ce fichier.</span>
<a name="l00811"></a><a class="code" href="classFormat__Post__Lata.html#ae822ba146767cfcc9c1ccfa368873f9d">00811</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="classFormat__Post__Lata.html#ae822ba146767cfcc9c1ccfa368873f9d" title="voir Format_Post_base::ecrire_domaine On accepte l&#39;ecriture d&#39;un domaine dans un pas de temps...">Format_Post_Lata::ecrire_domaine</a>(<span class="keyword">const</span> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; domaine,<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; est_le_premier_post)
<a name="l00812"></a>00812 {
<a name="l00813"></a>00813   <span class="keywordflow">if</span> (<a class="code" href="classFormat__Post__Lata.html#ab0b792d3f25872b859dc9c2170a9ac2d">status</a> == <a class="code" href="classFormat__Post__Lata.html#a94fde71d0a9cc3249bff7f66cc4aeacca77c87ecaad62a824d2cd3bdfe4b60317">RESET</a>)
<a name="l00814"></a>00814     {
<a name="l00815"></a>00815       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Format_Post_Lata::ecrire_domaine\n&quot;</span>
<a name="l00816"></a>00816            &lt;&lt; <span class="stringliteral">&quot; status = RESET. Uninitialized object&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00817"></a>00817       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00818"></a>00818     }
<a name="l00819"></a>00819   <span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; id_domaine = domaine.<a class="code" href="classDomaine.html#a87e2cdc035a26565e6fe481446aa4cd3" title="Renvoie le nom du domaine.">le_nom</a>();
<a name="l00820"></a>00820   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; sommets = domaine.<a class="code" href="classDomaine.html#a0846ac03a10b65c4df911fe35a19c02f" title="Renvoie le nombre total de sommets.">les_sommets</a>();
<a name="l00821"></a>00821   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; elements = domaine.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#ac115e8342be89afb882b7b61cc343267" title="Renvoie le tableau des sommets des elements.">les_elems</a>();
<a name="l00822"></a>00822   <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> <a class="code" href="Raffiner__Simplexes_8cpp.html#a358dc168d8905bbafc12587204bc9fb8">type_elem</a> = domaine.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a18cf83cd0f9c368dcfa32fb802a0ac94" title="Renvoie un element geometrique du type de ceux qui constituent la zone. (version const)">type_elem</a>().<a class="code" href="classDeriv__Elem__geom__base.html#a384b487459a33f9f521fb16539ec81de">valeur</a>().<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>();
<a name="l00823"></a>00823 <span class="comment">// GF Pour assuerer la lecture avec le plugin lata</span>
<a name="l00824"></a>00824   <span class="keywordflow">if</span> (type_elem==<span class="stringliteral">&quot;PRISME&quot;</span>) type_elem=<span class="stringliteral">&quot;PRISM6&quot;</span> ;
<a name="l00825"></a>00825   <span class="keywordtype">int</span> dim = domaine.<a class="code" href="classDomaine.html#a0846ac03a10b65c4df911fe35a19c02f" title="Renvoie le nombre total de sommets.">les_sommets</a>().<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1);
<a name="l00826"></a>00826 
<a name="l00827"></a>00827   <span class="keywordtype">int</span> nb_som_tot;  <span class="comment">//!&lt; Nombre de sommets dans le fichier</span>
<a name="l00828"></a>00828 <span class="comment"></span>  <span class="keywordtype">int</span> nb_elem_tot; <span class="comment">//!&lt; Nombre d&#39;elements dans le fichier</span>
<a name="l00829"></a>00829 <span class="comment"></span>
<a name="l00830"></a>00830 <span class="comment">// Construction du nom du fichier de geometrie</span>
<a name="l00831"></a>00831   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> basename_geom(<a class="code" href="classFormat__Post__Lata.html#a8d55373127916e23ee800ef312f78cdd">lata_basename_</a>);
<a name="l00832"></a>00832   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> extension_geom(<a class="code" href="classFormat__Post__Lata.html#aee3312d2f199be29261229ab7f874a40" title="Renvoie l&#39;extension conventionnelle des fichiers lata : &quot;.lata&quot;.">extension_lata</a>());
<a name="l00833"></a>00833   extension_geom += <span class="stringliteral">&quot;.&quot;</span>;
<a name="l00834"></a>00834   extension_geom += id_domaine;
<a name="l00835"></a>00835   extension_geom += <span class="stringliteral">&quot;.&quot;</span>;
<a name="l00836"></a>00836   <span class="keywordtype">char</span> str_temps[100] = <span class="stringliteral">&quot;0.0&quot;</span>;
<a name="l00837"></a>00837   <span class="keywordflow">if</span> (<a class="code" href="classFormat__Post__Lata.html#a377324ba785a6d3bf7c120c078146dd2">temps_courant_</a> &gt;= 0.)
<a name="l00838"></a>00838     sprintf(str_temps, <span class="stringliteral">&quot;%.10f&quot;</span>, <a class="code" href="classFormat__Post__Lata.html#a377324ba785a6d3bf7c120c078146dd2">temps_courant_</a>);
<a name="l00839"></a>00839   extension_geom += <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(str_temps);
<a name="l00840"></a>00840   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> nom_fichier_geom;
<a name="l00841"></a>00841   <span class="keywordtype">int</span> decalage_sommets = 1;
<a name="l00842"></a>00842   <span class="keywordtype">int</span> decalage_elements = 1;
<a name="l00843"></a>00843 
<a name="l00844"></a>00844 <span class="preprocessor">#undef un_seul_fichier_data</span>
<a name="l00845"></a>00845 <span class="preprocessor"></span>
<a name="l00846"></a>00846 <span class="preprocessor">#ifdef un_seul_fichier_data</span>
<a name="l00847"></a>00847 <span class="preprocessor"></span>  <span class="keywordtype">long</span> <span class="keywordtype">int</span> offset_elem = -1;
<a name="l00848"></a>00848 <span class="preprocessor">#endif</span>
<a name="l00849"></a>00849 <span class="preprocessor"></span>  {
<a name="l00850"></a>00850     <a class="code" href="classFichier__Lata.html">Fichier_Lata</a> fichier_geom(basename_geom, extension_geom,
<a name="l00851"></a>00851                               <a class="code" href="classFichier__Lata.html#afadf4963467b3123d9e9ec312644cb48aafea5adb55ed5ecc0b957884c5e754c1">Fichier_Lata::ERASE</a>, <a class="code" href="classFormat__Post__Lata.html#a6f47f1f2016cce3ab8bb1b976ed0d921">format_</a>, <a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a>);
<a name="l00852"></a>00852 
<a name="l00853"></a>00853     nom_fichier_geom = fichier_geom.<a class="code" href="classFichier__Lata.html#a8bcf7ecaa7806a6ae44979ff921370ca" title="Renvoie le nom du fichier avec le path.">get_filename</a>();
<a name="l00854"></a>00854     <span class="keywordtype">int</span> nb_col;
<a name="l00855"></a>00855 <span class="comment">// Coordonnees des sommets</span>
<a name="l00856"></a>00856 <span class="comment">//</span>
<a name="l00857"></a>00857     <span class="keywordflow">if</span> (<a class="code" href="classObjet__U.html#ad9b82ace9d4c7902ec704b6a78f76991">axi</a>)
<a name="l00858"></a>00858       {
<a name="l00859"></a>00859         <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> sommets2(sommets);
<a name="l00860"></a>00860         <span class="keywordtype">int</span> ns=sommets2.<a class="code" href="classDoubleTab.html#a3eadd63f3ba20c1b454d760b430acbf7" title="Returns the total dimensions of the multi-dimensionnal array, including virtual items (used in parall...">dimension_tot</a>(0);
<a name="l00861"></a>00861         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> s=0; s&lt;ns; s++)
<a name="l00862"></a>00862           {
<a name="l00863"></a>00863             <span class="keywordtype">double</span> r = sommets(s,0);
<a name="l00864"></a>00864             <span class="keywordtype">double</span> theta = sommets(s,1);
<a name="l00865"></a>00865             sommets2(s,0) = r*cos(theta);
<a name="l00866"></a>00866             sommets2(s,1) = r*sin(theta);
<a name="l00867"></a>00867           }
<a name="l00868"></a>00868         nb_som_tot = <a class="code" href="classFormat__Post__Lata.html#a943396fe8d7fbcf408da73a1f59cdebe" title="fichier est un fichier lata de donnees (pas le fichier maitre) on y ecrit le tableau tab tel quel (en...">write_doubletab</a>(fichier_geom, sommets2, nb_col,<a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a>);
<a name="l00869"></a>00869       }
<a name="l00870"></a>00870     <span class="keywordflow">else</span>
<a name="l00871"></a>00871       nb_som_tot = <a class="code" href="classFormat__Post__Lata.html#a943396fe8d7fbcf408da73a1f59cdebe" title="fichier est un fichier lata de donnees (pas le fichier maitre) on y ecrit le tableau tab tel quel (en...">write_doubletab</a>(fichier_geom, sommets, nb_col,<a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a>);
<a name="l00872"></a>00872 <span class="preprocessor">#ifdef un_seul_fichier_data</span>
<a name="l00873"></a>00873 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (fichier_geom.<a class="code" href="classFichier__Lata.html#a1a0c3473194894e5f5f79530abc45564" title="Si le fichier est de type partage, renvoie 1 si me() est egal au master du groupe et 0 sinon...">is_master</a>())
<a name="l00874"></a>00874       {
<a name="l00875"></a>00875         offset_elem = fichier_geom.<a class="code" href="classFichier__Lata.html#a18a15a1d2d7f0edccbb258f9da1526b3">get_SFichier</a>(). get_ofstream().tellp();
<a name="l00876"></a>00876 <span class="comment">// if (fichier_geom.get_SFichier().is_bin()==0) offset_elem-=1;</span>
<a name="l00877"></a>00877       }
<a name="l00878"></a>00878 <span class="preprocessor">#else</span>
<a name="l00879"></a>00879 <span class="preprocessor"></span>    <a class="code" href="classFichier__Lata.html">Fichier_Lata</a> fichier_geom_elem(basename_geom, extension_geom+<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(<span class="stringliteral">&quot;.elem&quot;</span>),
<a name="l00880"></a>00880                                    <a class="code" href="classFichier__Lata.html#afadf4963467b3123d9e9ec312644cb48aafea5adb55ed5ecc0b957884c5e754c1">Fichier_Lata::ERASE</a>, <a class="code" href="classFormat__Post__Lata.html#a6f47f1f2016cce3ab8bb1b976ed0d921">format_</a>, <a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a>);
<a name="l00881"></a>00881 <span class="preprocessor">#endif</span>
<a name="l00882"></a>00882 <span class="preprocessor"></span>    assert(nb_som_tot == 0 || nb_col == dim);
<a name="l00883"></a>00883 
<a name="l00884"></a>00884 <span class="comment">// Elements</span>
<a name="l00885"></a>00885 <span class="comment">// Les indices de sommets, elements et autres dans le fichier lata commencent a 1 :</span>
<a name="l00886"></a>00886     <span class="keywordflow">if</span> (<a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a> == <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94a448f17201fc397a7da69a62ae0637043">SINGLE_FILE</a> || <a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a> == <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94a23ea36f7593e2b91825cd82fa150b5e4">SINGLE_FILE_MPIIO</a>)
<a name="l00887"></a>00887       {
<a name="l00888"></a>00888 <span class="comment">// Tous les processeurs ecrivent dans un fichier unique, il faut</span>
<a name="l00889"></a>00889 <span class="comment">// renumeroter les indices pour passer en numerotation globale.</span>
<a name="l00890"></a>00890 <span class="comment">// Le processeur 0 numerote ses sommets de 1 a n0</span>
<a name="l00891"></a>00891 <span class="comment">// Le processeur 1 numerote ses sommets de n0+1 a n0+n1</span>
<a name="l00892"></a>00892 <span class="comment">// etc...</span>
<a name="l00893"></a>00893 <span class="comment">// Decalage a ajouter aux indices pour avoir une numerotation globale.</span>
<a name="l00894"></a>00894         <span class="keyword">const</span> <span class="keywordtype">int</span> nbsom = sommets.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00895"></a>00895         decalage_sommets += <a class="code" href="communications_8cpp.html#a13b5bdc7cfe14771b52a033b1ecbc071" title="Calul de la somme partielle de i sur les processeurs 0 a me()-1 (renvoie 0 sur le processeur 0)...">mppartial_sum</a>(nbsom);
<a name="l00896"></a>00896         <span class="keyword">const</span> <span class="keywordtype">int</span> nbelem = elements.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00897"></a>00897         decalage_elements += <a class="code" href="communications_8cpp.html#a13b5bdc7cfe14771b52a033b1ecbc071" title="Calul de la somme partielle de i sur les processeurs 0 a me()-1 (renvoie 0 sur le processeur 0)...">mppartial_sum</a>(nbelem);
<a name="l00898"></a>00898       }
<a name="l00899"></a>00899 <span class="preprocessor">#ifdef un_seul_fichier_data</span>
<a name="l00900"></a>00900 <span class="preprocessor"></span>    nb_elem_tot = <a class="code" href="classFormat__Post__Lata.html#ab01cd71e3e0e1220bbeb8e144b3f9731" title="Ecriture d&#39;un tableau d&#39;entiers dans le fichier fourni. Les valeurs ecrites sont les valeurs du table...">write_inttab</a>(fichier_geom, 1 , decalage_sommets, elements, nb_col,<a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a>);
<a name="l00901"></a>00901 <span class="preprocessor">#else</span>
<a name="l00902"></a>00902 <span class="preprocessor"></span>    nb_elem_tot = <a class="code" href="classFormat__Post__Lata.html#ab01cd71e3e0e1220bbeb8e144b3f9731" title="Ecriture d&#39;un tableau d&#39;entiers dans le fichier fourni. Les valeurs ecrites sont les valeurs du table...">write_inttab</a>(fichier_geom_elem, 1, decalage_sommets,elements, nb_col,<a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a>);
<a name="l00903"></a>00903 <span class="preprocessor">#endif</span>
<a name="l00904"></a>00904 <span class="preprocessor"></span>  }
<a name="l00905"></a>00905   {
<a name="l00906"></a>00906 <span class="comment">// Attention, il faut refermer le fichier avant d&#39;appeler ecrire_item_int</span>
<a name="l00907"></a>00907 <span class="comment">// qui va ouvrir a nouveau le fichier.</span>
<a name="l00908"></a>00908     <a class="code" href="classFichier__Lata__maitre.html" title=": Specialisation du Fichier_Lata pour le fichier maitre: toujours en ASCII. On peut utiliser une prec...">Fichier_Lata_maitre</a> fichier_lata(<a class="code" href="classFormat__Post__Lata.html#a8d55373127916e23ee800ef312f78cdd">lata_basename_</a>, <a class="code" href="classFormat__Post__Lata.html#aee3312d2f199be29261229ab7f874a40" title="Renvoie l&#39;extension conventionnelle des fichiers lata : &quot;.lata&quot;.">extension_lata</a>(),
<a name="l00909"></a>00909                                      <a class="code" href="classFichier__Lata.html#afadf4963467b3123d9e9ec312644cb48ad9db95f97d41cea9e4338af8876bd408">Fichier_Lata::APPEND</a>, <a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a>);
<a name="l00910"></a>00910     <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a>&amp; sfichier = fichier_lata.<a class="code" href="classFichier__Lata.html#a18a15a1d2d7f0edccbb258f9da1526b3">get_SFichier</a>();
<a name="l00911"></a>00911 
<a name="l00912"></a>00912     <span class="keywordflow">if</span> (fichier_lata.<a class="code" href="classFichier__Lata.html#a1a0c3473194894e5f5f79530abc45564" title="Si le fichier est de type partage, renvoie 1 si me() est egal au master du groupe et 0 sinon...">is_master</a>())
<a name="l00913"></a>00913       {
<a name="l00914"></a>00914         sfichier &lt;&lt; <span class="stringliteral">&quot;GEOM &quot;</span> &lt;&lt; id_domaine;
<a name="l00915"></a>00915 
<a name="l00916"></a>00916         sfichier &lt;&lt; <span class="stringliteral">&quot; type_elem=&quot;</span> &lt;&lt; type_elem&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00917"></a>00917         sfichier &lt;&lt; <span class="stringliteral">&quot;CHAMP SOMMETS &quot;</span>&lt;&lt; <a class="code" href="classFormat__Post__Lata.html#a033716caeef1f9b96458757fa911e2d8" title="Renvoie le nom d&#39;un fichier sans le path : on enleve les caracteres avant le dernier /...">remove_path</a>(nom_fichier_geom);
<a name="l00918"></a>00918         sfichier &lt;&lt; <span class="stringliteral">&quot; geometrie=&quot;</span>&lt;&lt;id_domaine;
<a name="l00919"></a>00919 <span class="preprocessor">#ifdef INT_is_64_</span>
<a name="l00920"></a>00920 <span class="preprocessor"></span>        sfichier &lt;&lt; <span class="stringliteral">&quot; file_offset=6&quot;</span>;
<a name="l00921"></a>00921 <span class="preprocessor">#endif</span>
<a name="l00922"></a>00922 <span class="preprocessor"></span>        sfichier &lt;&lt; <span class="stringliteral">&quot; size=&quot;</span> &lt;&lt; nb_som_tot;
<a name="l00923"></a>00923         sfichier &lt;&lt; <span class="stringliteral">&quot; composantes=&quot;</span> &lt;&lt; dim &lt;&lt; finl;
<a name="l00924"></a>00924         sfichier &lt;&lt; <span class="stringliteral">&quot;CHAMP ELEMENTS &quot;</span>&lt;&lt; <a class="code" href="classFormat__Post__Lata.html#a033716caeef1f9b96458757fa911e2d8" title="Renvoie le nom d&#39;un fichier sans le path : on enleve les caracteres avant le dernier /...">remove_path</a>(nom_fichier_geom);
<a name="l00925"></a>00925 <span class="preprocessor">#ifndef un_seul_fichier_data</span>
<a name="l00926"></a>00926 <span class="preprocessor"></span>        sfichier&lt;&lt;<span class="stringliteral">&quot;.elem&quot;</span>;
<a name="l00927"></a>00927 <span class="preprocessor">#endif</span>
<a name="l00928"></a>00928 <span class="preprocessor"></span>        sfichier &lt;&lt; <span class="stringliteral">&quot; geometrie=&quot;</span>&lt;&lt;id_domaine;
<a name="l00929"></a>00929 <span class="preprocessor">#ifdef INT_is_64_</span>
<a name="l00930"></a>00930 <span class="preprocessor"></span>        sfichier &lt;&lt; <span class="stringliteral">&quot; file_offset=6&quot;</span>;
<a name="l00931"></a>00931 <span class="preprocessor">#endif</span>
<a name="l00932"></a>00932 <span class="preprocessor"></span>        sfichier &lt;&lt; <span class="stringliteral">&quot; size=&quot;</span> &lt;&lt; nb_elem_tot&lt;&lt;<span class="stringliteral">&quot; composantes=&quot;</span>&lt;&lt;elements.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1);
<a name="l00933"></a>00933 
<a name="l00934"></a>00934 <span class="preprocessor">#ifdef un_seul_fichier_data</span>
<a name="l00935"></a>00935 <span class="preprocessor"></span>        sfichier&lt;&lt;<span class="stringliteral">&quot; file_offset=&quot;</span>&lt;&lt;offset_elem;
<a name="l00936"></a>00936 <span class="preprocessor">#endif</span>
<a name="l00937"></a>00937 <span class="preprocessor"></span>        <span class="keywordflow">switch</span>(<span class="keyword">sizeof</span>(<a class="code" href="Format__Post__Lata_8cpp.html#ab18839c853328b785784a699263ad3ee">_LATA_INT_TYPE_</a>))
<a name="l00938"></a>00938           {
<a name="l00939"></a>00939           <span class="keywordflow">case</span> 4:
<a name="l00940"></a>00940             sfichier &lt;&lt; <span class="stringliteral">&quot; format=INT32&quot;</span>&lt;&lt;finl;;
<a name="l00941"></a>00941             <span class="keywordflow">break</span>;
<a name="l00942"></a>00942           <span class="keywordflow">case</span> 8:
<a name="l00943"></a>00943             sfichier &lt;&lt; <span class="stringliteral">&quot; format=INT64&quot;</span>&lt;&lt;finl;
<a name="l00944"></a>00944             <span class="keywordflow">break</span>;
<a name="l00945"></a>00945           <span class="keywordflow">default</span>:
<a name="l00946"></a>00946             <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Format_Post_Lata::ecrire_entete\n&quot;</span>
<a name="l00947"></a>00947                  &lt;&lt; <span class="stringliteral">&quot; sizeof(int) not supported&quot;</span> &lt;&lt; finl;
<a name="l00948"></a>00948             <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00949"></a>00949           }
<a name="l00950"></a>00950 
<a name="l00951"></a>00951       }
<a name="l00952"></a>00952     fichier_lata.<a class="code" href="classFichier__Lata.html#af042e59f9c02f4d9c4087e126d711426" title="Si le fichier est de type partage, appelle la methode syncfile(), sinon ne fait rien.">syncfile</a>();
<a name="l00953"></a>00953   }
<a name="l00954"></a>00954 <span class="comment">// En mode parallele, on ecrit en plus des fichiers contenant les donnees paralleles</span>
<a name="l00955"></a>00955 <span class="comment">// sur les sommets, les elements et les faces...</span>
<a name="l00956"></a>00956   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>() &gt; 1)
<a name="l00957"></a>00957     <span class="keywordflow">if</span> (<a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a> == <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94a448f17201fc397a7da69a62ae0637043">SINGLE_FILE</a> || <a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a> == <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94a23ea36f7593e2b91825cd82fa150b5e4">SINGLE_FILE_MPIIO</a>)
<a name="l00958"></a>00958       {
<a name="l00959"></a>00959         <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a> data(1,2);
<a name="l00960"></a>00960         data(0, 0) = decalage_sommets;
<a name="l00961"></a>00961         data(0, 1) = sommets.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00962"></a>00962         <a class="code" href="classFormat__Post__Lata.html#a2f5fcc661484bae76cc90d1305d9adcb" title="voir Format_Post_base::ecrire_champ ATTENTION: si &quot;reference&quot; est non vide on ajoute 1 a toutes les v...">ecrire_item_int</a>(<span class="stringliteral">&quot;JOINTS_SOMMETS&quot;</span>,
<a name="l00963"></a>00963                         id_domaine,
<a name="l00964"></a>00964                         <span class="stringliteral">&quot;&quot;</span>, <span class="comment">/* id_zone */</span>
<a name="l00965"></a>00965                         <span class="stringliteral">&quot;&quot;</span>, <span class="comment">/* localisation */</span>
<a name="l00966"></a>00966                         <span class="stringliteral">&quot;&quot;</span>, <span class="comment">/* reference */</span>
<a name="l00967"></a>00967                         data,
<a name="l00968"></a>00968                         0); <span class="comment">/* reference_size */</span>
<a name="l00969"></a>00969         data(0, 0) = decalage_elements;
<a name="l00970"></a>00970         data(0, 1) = elements.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00971"></a>00971         <a class="code" href="classFormat__Post__Lata.html#a2f5fcc661484bae76cc90d1305d9adcb" title="voir Format_Post_base::ecrire_champ ATTENTION: si &quot;reference&quot; est non vide on ajoute 1 a toutes les v...">ecrire_item_int</a>(<span class="stringliteral">&quot;JOINTS_ELEMENTS&quot;</span>,
<a name="l00972"></a>00972                         id_domaine,
<a name="l00973"></a>00973                         <span class="stringliteral">&quot;&quot;</span>, <span class="comment">/* id_zone */</span>
<a name="l00974"></a>00974                         <span class="stringliteral">&quot;&quot;</span>, <span class="comment">/* localisation */</span>
<a name="l00975"></a>00975                         <span class="stringliteral">&quot;&quot;</span>, <span class="comment">/* reference */</span>
<a name="l00976"></a>00976                         data,
<a name="l00977"></a>00977                         0); <span class="comment">/* reference_size */</span>
<a name="l00978"></a>00978       }
<a name="l00979"></a>00979 
<a name="l00980"></a>00980 <span class="comment">// Si on a des frontieres domaine, on les ecrit egalement</span>
<a name="l00981"></a>00981   <span class="keyword">const</span> <a class="code" href="List_8h.html#a3149526fb499ddb08728c87daa32c5ad">LIST</a>(<a class="code" href="Ref_8h.html#aab5720a5c34da14028d0745e386aaa01">REF</a>(<a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>)) bords= domaine.<a class="code" href="classDomaine.html#a22db0ffbfd9e5283705db098fa2dff5b">domaines_frontieres</a>();
<a name="l00982"></a>00982   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;bords.size(); i++)
<a name="l00983"></a>00983     <a class="code" href="classFormat__Post__Lata.html#ae822ba146767cfcc9c1ccfa368873f9d" title="voir Format_Post_base::ecrire_domaine On accepte l&#39;ecriture d&#39;un domaine dans un pas de temps...">ecrire_domaine</a>(bords[i].<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>(),est_le_premier_post);
<a name="l00984"></a>00984   <span class="keywordflow">return</span> 1; <span class="comment">//!&lt; ok tout va bien</span>
<a name="l00985"></a>00985 <span class="comment"></span>}
<a name="l00986"></a>00986 
<a name="l00987"></a>00987 <span class="comment">//</span>
<a name="l00988"></a>00988 <span class="comment">//</span>
<a name="l00989"></a>00989 <span class="comment">//</span><span class="comment"></span>
<a name="l00990"></a>00990 <span class="comment">//! commence l&#39;ecriture d&#39;un nouveau pas de temps&lt;br&gt;En l&#39;occurence pour le format LATA:&lt;br&gt;Ouvre le fichier maitre en mode APPEND et ajoute une ligne&lt;br&gt;&quot;TEMPS xxxxx&quot; si ce temps n&#39;a pas encore ete ecrit</span>
<a name="l00991"></a><a class="code" href="classFormat__Post__Lata.html#aee03413de78c2e13d4559b453efe64e0">00991</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="classFormat__Post__Lata.html#aee03413de78c2e13d4559b453efe64e0" title="commence l&#39;ecriture d&#39;un nouveau pas de temps En l&#39;occurence pour le format LATA: Ouvre le fichier ma...">Format_Post_Lata::ecrire_temps</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> temps)
<a name="l00992"></a>00992 {
<a name="l00993"></a>00993   <a class="code" href="classFormat__Post__Lata.html#a024555d2d2772d53eabdb71aa4749bb4">ecrire_temps_lata</a>(temps,<a class="code" href="classFormat__Post__Lata.html#a377324ba785a6d3bf7c120c078146dd2">temps_courant_</a>,<a class="code" href="classFormat__Post__Lata.html#a8d55373127916e23ee800ef312f78cdd">lata_basename_</a>,<a class="code" href="classFormat__Post__Lata.html#ab0b792d3f25872b859dc9c2170a9ac2d">status</a>,<a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a>);
<a name="l00994"></a>00994   <span class="keywordflow">return</span> 1;
<a name="l00995"></a>00995 }
<a name="l00996"></a>00996 
<a name="l00997"></a>00997 <span class="comment">//</span><span class="comment"></span>
<a name="l00998"></a>00998 <span class="comment">//! voir Format_Post_base::ecrire_champ</span>
<a name="l00999"></a><a class="code" href="classFormat__Post__Lata.html#aa84d13955f4580904073da6c2c116e4b">00999</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="classFormat__Post__Lata.html#aa84d13955f4580904073da6c2c116e4b" title="voir Format_Post_base::ecrire_champ">Format_Post_Lata::ecrire_champ</a>(<span class="keyword">const</span> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; domaine,<span class="keyword">const</span> <a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a>&amp; unite_,<span class="keyword">const</span> <a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a>&amp; noms_compo,
<a name="l01000"></a>01000                                    <span class="keywordtype">int</span> ncomp,<span class="keywordtype">double</span> temps,<span class="keywordtype">double</span> temps_courant,
<a name="l01001"></a>01001                                    <span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; id_du_champ,
<a name="l01002"></a>01002                                    <span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; id_du_domaine,
<a name="l01003"></a>01003                                    <span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; localisation,
<a name="l01004"></a>01004                                    <span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp;   nature,
<a name="l01005"></a>01005                                    <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; valeurs)
<a name="l01006"></a>01006 {
<a name="l01007"></a>01007 
<a name="l01008"></a>01008 <span class="comment">// recup de lata_v1</span>
<a name="l01009"></a>01009   <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> id_du_champ_modifie(id_du_champ);
<a name="l01010"></a>01010   <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> iddomaine(id_du_domaine);
<a name="l01011"></a>01011 <span class="comment">// On utilise prefix avec un argument en majuscule</span>
<a name="l01012"></a>01012   <span class="keywordflow">if</span> ((<a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>)localisation==<span class="stringliteral">&quot;SOM&quot;</span>)
<a name="l01013"></a>01013     {
<a name="l01014"></a>01014       id_du_champ_modifie.<a class="code" href="classNom.html#aa296fc70f7abcf978968e09582d8fb06">prefix</a>(id_du_domaine);
<a name="l01015"></a>01015       id_du_champ_modifie.<a class="code" href="classNom.html#aa296fc70f7abcf978968e09582d8fb06">prefix</a>(iddomaine);
<a name="l01016"></a>01016 <span class="comment">//</span>
<a name="l01017"></a>01017       id_du_champ_modifie.<a class="code" href="classNom.html#aa296fc70f7abcf978968e09582d8fb06">prefix</a>(<span class="stringliteral">&quot;_SOM_&quot;</span>);
<a name="l01018"></a>01018     }
<a name="l01019"></a>01019   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>)localisation==<span class="stringliteral">&quot;ELEM&quot;</span>)
<a name="l01020"></a>01020     {
<a name="l01021"></a>01021       id_du_champ_modifie.<a class="code" href="classNom.html#aa296fc70f7abcf978968e09582d8fb06">prefix</a>(id_du_domaine);
<a name="l01022"></a>01022       id_du_champ_modifie.<a class="code" href="classNom.html#aa296fc70f7abcf978968e09582d8fb06">prefix</a>(iddomaine);
<a name="l01023"></a>01023 <span class="comment">//</span>
<a name="l01024"></a>01024       id_du_champ_modifie.<a class="code" href="classNom.html#aa296fc70f7abcf978968e09582d8fb06">prefix</a>(<span class="stringliteral">&quot;_ELEM_&quot;</span>);
<a name="l01025"></a>01025     }
<a name="l01026"></a>01026   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>)localisation==<span class="stringliteral">&quot;FACES&quot;</span>)
<a name="l01027"></a>01027     {
<a name="l01028"></a>01028       id_du_champ_modifie.<a class="code" href="classNom.html#aa296fc70f7abcf978968e09582d8fb06">prefix</a>(id_du_domaine);
<a name="l01029"></a>01029       id_du_champ_modifie.<a class="code" href="classNom.html#aa296fc70f7abcf978968e09582d8fb06">prefix</a>(iddomaine);
<a name="l01030"></a>01030       id_du_champ_modifie.<a class="code" href="classNom.html#aa296fc70f7abcf978968e09582d8fb06">prefix</a>(<span class="stringliteral">&quot;_FACES_&quot;</span>);
<a name="l01031"></a>01031     }
<a name="l01032"></a>01032   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; id_champ=id_du_champ_modifie;
<a name="l01033"></a>01033 <span class="comment">// Construction du nom du fichier</span>
<a name="l01034"></a>01034   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> basename_champ(<a class="code" href="classFormat__Post__Lata.html#a8d55373127916e23ee800ef312f78cdd">lata_basename_</a>);
<a name="l01035"></a>01035   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> extension_champ(<a class="code" href="classFormat__Post__Lata.html#aee3312d2f199be29261229ab7f874a40" title="Renvoie l&#39;extension conventionnelle des fichiers lata : &quot;.lata&quot;.">extension_lata</a>());
<a name="l01036"></a>01036   extension_champ += <span class="stringliteral">&quot;.&quot;</span>;
<a name="l01037"></a>01037   extension_champ += id_champ;
<a name="l01038"></a>01038   extension_champ += <span class="stringliteral">&quot;.&quot;</span>;
<a name="l01039"></a>01039   extension_champ += localisation;
<a name="l01040"></a>01040   extension_champ += <span class="stringliteral">&quot;.&quot;</span>;
<a name="l01041"></a>01041   extension_champ += id_du_domaine;
<a name="l01042"></a>01042   extension_champ += <span class="stringliteral">&quot;.&quot;</span>;
<a name="l01043"></a>01043   <span class="keywordtype">char</span> str_temps[100] = <span class="stringliteral">&quot;0.0&quot;</span>;
<a name="l01044"></a>01044   <span class="keywordflow">if</span> (temps &gt;= 0.)
<a name="l01045"></a>01045     sprintf(str_temps, <span class="stringliteral">&quot;%.10f&quot;</span>, temps);
<a name="l01046"></a>01046   extension_champ += str_temps;
<a name="l01047"></a>01047 
<a name="l01048"></a>01048   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> filename_champ;
<a name="l01049"></a>01049   <span class="keywordtype">int</span> size_tot, nb_compo;
<a name="l01050"></a>01050   {
<a name="l01051"></a>01051     <a class="code" href="classFichier__Lata.html">Fichier_Lata</a> fichier_champ(basename_champ, extension_champ,
<a name="l01052"></a>01052                                <a class="code" href="classFichier__Lata.html#afadf4963467b3123d9e9ec312644cb48aafea5adb55ed5ecc0b957884c5e754c1">Fichier_Lata::ERASE</a>, <a class="code" href="classFormat__Post__Lata.html#a6f47f1f2016cce3ab8bb1b976ed0d921">format_</a>, <a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a>);
<a name="l01053"></a>01053 
<a name="l01054"></a>01054     filename_champ = fichier_champ.<a class="code" href="classFichier__Lata.html#a8bcf7ecaa7806a6ae44979ff921370ca" title="Renvoie le nom du fichier avec le path.">get_filename</a>();
<a name="l01055"></a>01055     size_tot = <a class="code" href="classFormat__Post__Lata.html#a943396fe8d7fbcf408da73a1f59cdebe" title="fichier est un fichier lata de donnees (pas le fichier maitre) on y ecrit le tableau tab tel quel (en...">write_doubletab</a>(fichier_champ, valeurs, nb_compo, <a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a>);
<a name="l01056"></a>01056   }
<a name="l01057"></a>01057 
<a name="l01058"></a>01058 <span class="comment">// Ouverture du fichier .lata en mode append.</span>
<a name="l01059"></a>01059 <span class="comment">// Ajout de la reference au champ</span>
<a name="l01060"></a>01060   <a class="code" href="classFichier__Lata__maitre.html" title=": Specialisation du Fichier_Lata pour le fichier maitre: toujours en ASCII. On peut utiliser une prec...">Fichier_Lata_maitre</a> fichier(<a class="code" href="classFormat__Post__Lata.html#a8d55373127916e23ee800ef312f78cdd">lata_basename_</a>, <a class="code" href="classFormat__Post__Lata.html#aee3312d2f199be29261229ab7f874a40" title="Renvoie l&#39;extension conventionnelle des fichiers lata : &quot;.lata&quot;.">extension_lata</a>(),
<a name="l01061"></a>01061                               <a class="code" href="classFichier__Lata.html#afadf4963467b3123d9e9ec312644cb48ad9db95f97d41cea9e4338af8876bd408">Fichier_Lata::APPEND</a>, <a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a>);
<a name="l01062"></a>01062   <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a>&amp; sfichier = fichier.<a class="code" href="classFichier__Lata.html#a18a15a1d2d7f0edccbb258f9da1526b3">get_SFichier</a>();
<a name="l01063"></a>01063   <span class="keywordflow">if</span> (fichier.<a class="code" href="classFichier__Lata.html#a1a0c3473194894e5f5f79530abc45564" title="Si le fichier est de type partage, renvoie 1 si me() est egal au master du groupe et 0 sinon...">is_master</a>())
<a name="l01064"></a>01064     {
<a name="l01065"></a>01065       sfichier &lt;&lt; <span class="stringliteral">&quot;Champ &quot;</span> &lt;&lt; id_champ &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l01066"></a>01066       sfichier &lt;&lt; <a class="code" href="classFormat__Post__Lata.html#a033716caeef1f9b96458757fa911e2d8" title="Renvoie le nom d&#39;un fichier sans le path : on enleve les caracteres avant le dernier /...">remove_path</a>(filename_champ);
<a name="l01067"></a>01067       sfichier &lt;&lt; <span class="stringliteral">&quot; geometrie=&quot;</span> &lt;&lt; id_du_domaine;
<a name="l01068"></a>01068 <span class="preprocessor">#ifdef INT_is_64_</span>
<a name="l01069"></a>01069 <span class="preprocessor"></span>      sfichier &lt;&lt; <span class="stringliteral">&quot; file_offset=6&quot;</span>;
<a name="l01070"></a>01070 <span class="preprocessor">#endif</span>
<a name="l01071"></a>01071 <span class="preprocessor"></span>      sfichier &lt;&lt; <span class="stringliteral">&quot; localisation=&quot;</span> &lt;&lt; localisation;
<a name="l01072"></a>01072       sfichier &lt;&lt; <span class="stringliteral">&quot; size=&quot;</span> &lt;&lt; size_tot;
<a name="l01073"></a>01073       sfichier &lt;&lt; <span class="stringliteral">&quot; nature=&quot;</span> &lt;&lt; nature;
<a name="l01074"></a>01074 
<a name="l01075"></a>01075       sfichier &lt;&lt; <span class="stringliteral">&quot; noms_compo=&quot;</span>&lt;&lt;noms_compo[0];
<a name="l01076"></a>01076       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=1; k&lt;noms_compo.size(); k++)
<a name="l01077"></a>01077         sfichier &lt;&lt; <span class="stringliteral">&quot;,&quot;</span>&lt;&lt;noms_compo[k];
<a name="l01078"></a>01078 
<a name="l01079"></a>01079       sfichier &lt;&lt; <span class="stringliteral">&quot; composantes=&quot;</span> &lt;&lt; nb_compo&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01080"></a>01080 
<a name="l01081"></a>01081 <span class="comment">// sfichier &lt;&lt; &quot; type=REAL32&quot; &lt;&lt; finl;</span>
<a name="l01082"></a>01082     }
<a name="l01083"></a>01083   fichier.<a class="code" href="classFichier__Lata.html#af042e59f9c02f4d9c4087e126d711426" title="Si le fichier est de type partage, appelle la methode syncfile(), sinon ne fait rien.">syncfile</a>();
<a name="l01084"></a>01084 
<a name="l01085"></a>01085   <span class="keywordflow">return</span> 1;
<a name="l01086"></a>01086 }
<a name="l01087"></a>01087 
<a name="l01088"></a>01088 
<a name="l01089"></a>01089 <span class="comment">//</span>
<a name="l01090"></a>01090 <span class="comment">//</span>
<a name="l01091"></a>01091 <span class="comment">//</span>
<a name="l01092"></a>01092 <span class="comment">//</span>
<a name="l01093"></a>01093 <span class="comment">//</span>
<a name="l01094"></a>01094 <span class="comment">//</span>
<a name="l01095"></a>01095 <span class="comment">//</span><span class="comment"></span>
<a name="l01096"></a>01096 <span class="comment">//! voir Format_Post_base::ecrire_champ&lt;br&gt;ATTENTION: si &quot;reference&quot; est non vide on ajoute 1 a toutes les&lt;br&gt;valeurs pour passer en numerotation fortran, et si de plus on&lt;br&gt;ecrit un fichier lata unique pour tous les processeurs, on ajoute un&lt;br&gt;decalage a toutes les valeurs (renumerotation des indices pour&lt;br&gt;passer en numerotation globale, voir le codage de ecrire_domaine&lt;br&gt;par exemple)</span>
<a name="l01097"></a><a class="code" href="classFormat__Post__Lata.html#a2f5fcc661484bae76cc90d1305d9adcb">01097</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="classFormat__Post__Lata.html#a2f5fcc661484bae76cc90d1305d9adcb" title="voir Format_Post_base::ecrire_champ ATTENTION: si &quot;reference&quot; est non vide on ajoute 1 a toutes les v...">Format_Post_Lata::ecrire_item_int</a>(<span class="comment">//const Nom    &amp; id_champ,</span>
<a name="l01098"></a>01098   <span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp;     id_item,
<a name="l01099"></a>01099   <span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp;     id_du_domaine,
<a name="l01100"></a>01100   <span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp;     id_zone,
<a name="l01101"></a>01101   <span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp;     localisation,
<a name="l01102"></a>01102   <span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp;     reference,
<a name="l01103"></a>01103 <span class="comment">// const IntTab &amp; valeurs,</span>
<a name="l01104"></a>01104   <span class="keyword">const</span> <a class="code" href="classIntVect.html">IntVect</a>&amp; val,
<a name="l01105"></a>01105   <span class="keyword">const</span> <span class="keywordtype">int</span>   reference_size)
<a name="l01106"></a>01106 {
<a name="l01107"></a>01107 <span class="comment">// Construction du nom du fichier</span>
<a name="l01108"></a>01108   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> basename_champ(<a class="code" href="classFormat__Post__Lata.html#a8d55373127916e23ee800ef312f78cdd">lata_basename_</a>);
<a name="l01109"></a>01109   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> extension_champ(<a class="code" href="classFormat__Post__Lata.html#aee3312d2f199be29261229ab7f874a40" title="Renvoie l&#39;extension conventionnelle des fichiers lata : &quot;.lata&quot;.">extension_lata</a>());
<a name="l01110"></a>01110   extension_champ += <span class="stringliteral">&quot;.&quot;</span>;
<a name="l01111"></a>01111 <span class="comment">// extension_champ += id_champ;</span>
<a name="l01112"></a>01112   extension_champ += id_item;
<a name="l01113"></a>01113   extension_champ += <span class="stringliteral">&quot;.&quot;</span>;
<a name="l01114"></a>01114   extension_champ += localisation;
<a name="l01115"></a>01115   extension_champ += <span class="stringliteral">&quot;.&quot;</span>;
<a name="l01116"></a>01116   extension_champ += id_du_domaine;
<a name="l01117"></a>01117   extension_champ += <span class="stringliteral">&quot;.&quot;</span>;
<a name="l01118"></a>01118   extension_champ += <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(<a class="code" href="classFormat__Post__Lata.html#a377324ba785a6d3bf7c120c078146dd2">temps_courant_</a>);
<a name="l01119"></a>01119 
<a name="l01120"></a>01120   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> filename_champ;
<a name="l01121"></a>01121   <span class="keywordtype">int</span> size_tot, nb_compo;
<a name="l01122"></a>01122   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; valeurs = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>,val);
<a name="l01123"></a>01123   {
<a name="l01124"></a>01124     <a class="code" href="classFichier__Lata.html">Fichier_Lata</a> fichier_champ(basename_champ, extension_champ,
<a name="l01125"></a>01125                                <a class="code" href="classFichier__Lata.html#afadf4963467b3123d9e9ec312644cb48aafea5adb55ed5ecc0b957884c5e754c1">Fichier_Lata::ERASE</a>, <a class="code" href="classFormat__Post__Lata.html#a6f47f1f2016cce3ab8bb1b976ed0d921">format_</a>, <a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a>);
<a name="l01126"></a>01126 
<a name="l01127"></a>01127     filename_champ = fichier_champ.<a class="code" href="classFichier__Lata.html#a8bcf7ecaa7806a6ae44979ff921370ca" title="Renvoie le nom du fichier avec le path.">get_filename</a>();
<a name="l01128"></a>01128 <span class="comment">// On suppose que si reference est non vide, c&#39;est un indice</span>
<a name="l01129"></a>01129 <span class="comment">// dans un autre tableau, donc numerotation fortran :</span>
<a name="l01130"></a>01130     <span class="keywordtype">int</span> decal = 0;
<a name="l01131"></a>01131     <span class="keywordtype">int</span> decal_partiel=0;
<a name="l01132"></a>01132     <span class="keywordflow">if</span> (reference != <span class="stringliteral">&quot;&quot;</span>)
<a name="l01133"></a>01133       {
<a name="l01134"></a>01134         decal = 1;
<a name="l01135"></a>01135         decal_partiel=1;
<a name="l01136"></a>01136         <span class="keywordflow">if</span> (<a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a> == <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94a448f17201fc397a7da69a62ae0637043">SINGLE_FILE</a> || <a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a> == <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94a23ea36f7593e2b91825cd82fa150b5e4">SINGLE_FILE_MPIIO</a>)
<a name="l01137"></a>01137           {
<a name="l01138"></a>01138 <span class="comment">// Tous les processeurs ecrivent dans un fichier unique, il faut</span>
<a name="l01139"></a>01139 <span class="comment">// renumeroter les indices pour passer en numerotation globale.</span>
<a name="l01140"></a>01140 <span class="comment">// Decalage a ajouter aux indices pour avoir une numerotation globale.</span>
<a name="l01141"></a>01141             decal_partiel += <a class="code" href="communications_8cpp.html#a13b5bdc7cfe14771b52a033b1ecbc071" title="Calul de la somme partielle de i sur les processeurs 0 a me()-1 (renvoie 0 sur le processeur 0)...">mppartial_sum</a>(reference_size);
<a name="l01142"></a>01142           }
<a name="l01143"></a>01143       }
<a name="l01144"></a>01144 <span class="comment">//</span>
<a name="l01145"></a>01145     size_tot = <a class="code" href="classFormat__Post__Lata.html#ab01cd71e3e0e1220bbeb8e144b3f9731" title="Ecriture d&#39;un tableau d&#39;entiers dans le fichier fourni. Les valeurs ecrites sont les valeurs du table...">write_inttab</a>(fichier_champ, decal,decal_partiel, valeurs, nb_compo,<a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a>);
<a name="l01146"></a>01146   }
<a name="l01147"></a>01147   {
<a name="l01148"></a>01148 <span class="comment">// Ouverture du fichier .lata en mode append.</span>
<a name="l01149"></a>01149 <span class="comment">// Ajout de la reference au champ</span>
<a name="l01150"></a>01150     <a class="code" href="classFichier__Lata__maitre.html" title=": Specialisation du Fichier_Lata pour le fichier maitre: toujours en ASCII. On peut utiliser une prec...">Fichier_Lata_maitre</a> fichier(<a class="code" href="classFormat__Post__Lata.html#a8d55373127916e23ee800ef312f78cdd">lata_basename_</a>, <a class="code" href="classFormat__Post__Lata.html#aee3312d2f199be29261229ab7f874a40" title="Renvoie l&#39;extension conventionnelle des fichiers lata : &quot;.lata&quot;.">extension_lata</a>(),
<a name="l01151"></a>01151                                 <a class="code" href="classFichier__Lata.html#afadf4963467b3123d9e9ec312644cb48ad9db95f97d41cea9e4338af8876bd408">Fichier_Lata::APPEND</a>, <a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a>);
<a name="l01152"></a>01152     <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a>&amp; sfichier = fichier.<a class="code" href="classFichier__Lata.html#a18a15a1d2d7f0edccbb258f9da1526b3">get_SFichier</a>();
<a name="l01153"></a>01153     <span class="keywordflow">if</span> (fichier.<a class="code" href="classFichier__Lata.html#a1a0c3473194894e5f5f79530abc45564" title="Si le fichier est de type partage, renvoie 1 si me() est egal au master du groupe et 0 sinon...">is_master</a>())
<a name="l01154"></a>01154       {
<a name="l01155"></a>01155 <span class="comment">// sfichier &lt;&lt; &quot;Champ &quot; &lt;&lt; id_champ &lt;&lt; &quot; &quot;;</span>
<a name="l01156"></a>01156         sfichier &lt;&lt; <span class="stringliteral">&quot;Champ &quot;</span> &lt;&lt; id_item &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l01157"></a>01157         sfichier &lt;&lt; <a class="code" href="classFormat__Post__Lata.html#a033716caeef1f9b96458757fa911e2d8" title="Renvoie le nom d&#39;un fichier sans le path : on enleve les caracteres avant le dernier /...">remove_path</a>(filename_champ);
<a name="l01158"></a>01158         sfichier &lt;&lt; <span class="stringliteral">&quot; geometrie=&quot;</span> &lt;&lt; id_du_domaine;
<a name="l01159"></a>01159 <span class="preprocessor">#ifdef INT_is_64_</span>
<a name="l01160"></a>01160 <span class="preprocessor"></span>        sfichier &lt;&lt; <span class="stringliteral">&quot; file_offset=6&quot;</span>;
<a name="l01161"></a>01161 <span class="preprocessor">#endif</span>
<a name="l01162"></a>01162 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (localisation!=<span class="stringliteral">&quot;&quot;</span>)
<a name="l01163"></a>01163           sfichier &lt;&lt; <span class="stringliteral">&quot; localisation=&quot;</span> &lt;&lt; localisation;
<a name="l01164"></a>01164         sfichier &lt;&lt; <span class="stringliteral">&quot; size=&quot;</span> &lt;&lt; size_tot;
<a name="l01165"></a>01165         sfichier &lt;&lt; <span class="stringliteral">&quot; composantes=&quot;</span> &lt;&lt; nb_compo;
<a name="l01166"></a>01166         <span class="keywordflow">if</span> (reference != <span class="stringliteral">&quot;&quot;</span>)
<a name="l01167"></a>01167           sfichier &lt;&lt; <span class="stringliteral">&quot; reference=&quot;</span> &lt;&lt; reference;
<a name="l01168"></a>01168         <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="Nom_8cpp.html#a0e1ea19fb9fa7881d15d84eff4c090e1">sz</a> = <span class="keyword">sizeof</span>(<a class="code" href="Format__Post__Lata_8cpp.html#ab18839c853328b785784a699263ad3ee">_LATA_INT_TYPE_</a>);
<a name="l01169"></a>01169         <span class="keywordflow">switch</span>(sz)
<a name="l01170"></a>01170           {
<a name="l01171"></a>01171           <span class="keywordflow">case</span> 4:
<a name="l01172"></a>01172             sfichier &lt;&lt; <span class="stringliteral">&quot; format=int32&quot;</span>;
<a name="l01173"></a>01173             <span class="keywordflow">break</span>;
<a name="l01174"></a>01174           <span class="keywordflow">case</span> 8:
<a name="l01175"></a>01175             sfichier &lt;&lt; <span class="stringliteral">&quot; format=int64&quot;</span>;
<a name="l01176"></a>01176             <span class="keywordflow">break</span>;
<a name="l01177"></a>01177           <span class="keywordflow">default</span>:
<a name="l01178"></a>01178             <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Format_Post_Lata::ecrire_champ_lata\n&quot;</span>
<a name="l01179"></a>01179                  &lt;&lt; <span class="stringliteral">&quot; Integer type not supported: size=&quot;</span> &lt;&lt; sz &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01180"></a>01180             <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l01181"></a>01181           }
<a name="l01182"></a>01182         sfichier &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01183"></a>01183       }
<a name="l01184"></a>01184     fichier.<a class="code" href="classFichier__Lata.html#af042e59f9c02f4d9c4087e126d711426" title="Si le fichier est de type partage, appelle la methode syncfile(), sinon ne fait rien.">syncfile</a>();
<a name="l01185"></a>01185   }
<a name="l01186"></a>01186 
<a name="l01187"></a>01187 <span class="comment">// Astuce pour les donnees paralleles des faces:</span>
<a name="l01188"></a>01188   <span class="keywordflow">if</span> ((id_item == <span class="stringliteral">&quot;FACES&quot;</span> &amp;&amp; <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>() &gt; 1) &amp;&amp; (<a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a> == <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94a448f17201fc397a7da69a62ae0637043">SINGLE_FILE</a> || <a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a> == <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94a23ea36f7593e2b91825cd82fa150b5e4">SINGLE_FILE_MPIIO</a>))
<a name="l01189"></a>01189     {
<a name="l01190"></a>01190       <span class="keyword">const</span> <span class="keywordtype">int</span> n = valeurs.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l01191"></a>01191       <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a> data(1,2);
<a name="l01192"></a>01192       data(0, 0) = 1 + <a class="code" href="communications_8cpp.html#a13b5bdc7cfe14771b52a033b1ecbc071" title="Calul de la somme partielle de i sur les processeurs 0 a me()-1 (renvoie 0 sur le processeur 0)...">mppartial_sum</a>(n);
<a name="l01193"></a>01193       data(0, 1) = n;
<a name="l01194"></a>01194       <a class="code" href="classFormat__Post__Lata.html#a2f5fcc661484bae76cc90d1305d9adcb" title="voir Format_Post_base::ecrire_champ ATTENTION: si &quot;reference&quot; est non vide on ajoute 1 a toutes les v...">ecrire_item_int</a>(<span class="stringliteral">&quot;JOINTS_FACES&quot;</span>,
<a name="l01195"></a>01195                       id_du_domaine,
<a name="l01196"></a>01196                       <span class="stringliteral">&quot;&quot;</span>, <span class="comment">/* id_zone */</span>
<a name="l01197"></a>01197                       <span class="stringliteral">&quot;&quot;</span>, <span class="comment">/* localisation */</span>
<a name="l01198"></a>01198                       <span class="stringliteral">&quot;&quot;</span>, <span class="comment">/* reference */</span>
<a name="l01199"></a>01199                       data,
<a name="l01200"></a>01200                       0); <span class="comment">/* reference_size */</span>
<a name="l01201"></a>01201     }
<a name="l01202"></a>01202   <span class="keywordflow">return</span> 1;
<a name="l01203"></a>01203 }
<a name="l01204"></a>01204 
<a name="l01205"></a><a class="code" href="classFormat__Post__Lata.html#af61b5c69867bb3330f2652fc8698fff3">01205</a> <span class="keywordtype">int</span> <a class="code" href="classFormat__Post__Lata.html#af61b5c69867bb3330f2652fc8698fff3">Format_Post_Lata::ecrire_entete_lata</a>(<span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; base_name,<span class="keyword">const</span> <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94">Options_Para</a>&amp; <a class="code" href="classoption.html">option</a>,<span class="keyword">const</span> <a class="code" href="classFormat__Post__Lata.html#a8698c5e7e825c54749a7365f7ffff53c">Format</a>&amp; format,
<a name="l01206"></a>01206                                          <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; est_le_premier_post)
<a name="l01207"></a>01207 {
<a name="l01208"></a>01208 
<a name="l01209"></a>01209   <span class="keywordflow">if</span> (est_le_premier_post)
<a name="l01210"></a>01210     {
<a name="l01211"></a>01211 
<a name="l01212"></a>01212 <span class="comment">// Determination du format binaire:</span>
<a name="l01213"></a>01213 <span class="comment">// big endian =&gt; l&#39;entier 32 bits &quot;1&quot; s&#39;ecrit 0x00 0x00 0x00 0x01</span>
<a name="l01214"></a>01214 <span class="comment">// little endian =&gt;                           0x01 0x00 0x00 0x00</span>
<a name="l01215"></a>01215       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> one = 1;
<a name="l01216"></a>01216       <span class="keyword">const</span> <span class="keywordtype">int</span> big_endian = (* ((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)&amp;one) == 0) ? 1 : 0;
<a name="l01217"></a>01217 
<a name="l01218"></a>01218 <span class="comment">// Effacement du fichier .lata et ecriture de l&#39;entete</span>
<a name="l01219"></a>01219 <span class="comment">//</span><span class="comment"></span>
<a name="l01220"></a>01220 <span class="comment">      ////!&lt;                              Fichier_Lata::ERASE,</span>
<a name="l01221"></a>01221 <span class="comment">      ////!&lt;                              options_para_);</span>
<a name="l01222"></a>01222 <span class="comment"></span>      <a class="code" href="classFichier__Lata__maitre.html" title=": Specialisation du Fichier_Lata pour le fichier maitre: toujours en ASCII. On peut utiliser une prec...">Fichier_Lata_maitre</a> fichier(base_name, <a class="code" href="classFormat__Post__Lata.html#aee3312d2f199be29261229ab7f874a40" title="Renvoie l&#39;extension conventionnelle des fichiers lata : &quot;.lata&quot;.">extension_lata</a>(),
<a name="l01223"></a>01223                                   <a class="code" href="classFichier__Lata.html#afadf4963467b3123d9e9ec312644cb48aafea5adb55ed5ecc0b957884c5e754c1">Fichier_Lata::ERASE</a>,
<a name="l01224"></a>01224                                   option);
<a name="l01225"></a>01225 
<a name="l01226"></a>01226       <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a>&amp; sfichier = fichier.<a class="code" href="classFichier__Lata.html#a18a15a1d2d7f0edccbb258f9da1526b3">get_SFichier</a>();
<a name="l01227"></a>01227       <span class="keywordflow">if</span> (fichier.<a class="code" href="classFichier__Lata.html#a1a0c3473194894e5f5f79530abc45564" title="Si le fichier est de type partage, renvoie 1 si me() est egal au master du groupe et 0 sinon...">is_master</a>())
<a name="l01228"></a>01228         {
<a name="l01229"></a>01229           sfichier &lt;&lt; <span class="stringliteral">&quot;LATA_V2.1 Trio_U Version1.6 or later&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01230"></a>01230           sfichier &lt;&lt; <a class="code" href="classObjet__U.html#a7c27c4f80259eeef76ff8fe2d3bc61f7" title="Renvoie une reference constante vers le nom du cas. Cette methode est statique.">Objet_U::nom_du_cas</a>() &lt;&lt; finl;
<a name="l01231"></a>01231           sfichier &lt;&lt; <span class="stringliteral">&quot;Trio_U verbosity=0&quot;</span> &lt;&lt; finl;
<a name="l01232"></a>01232 
<a name="l01233"></a>01233           sfichier &lt;&lt; <span class="stringliteral">&quot;Format &quot;</span>;
<a name="l01234"></a>01234 <span class="comment">//</span>
<a name="l01235"></a>01235           <span class="keywordflow">switch</span>(format)
<a name="l01236"></a>01236             {
<a name="l01237"></a>01237             <span class="keywordflow">case</span> <a class="code" href="classFormat__Post__Lata.html#a8698c5e7e825c54749a7365f7ffff53ca64e753afccaf02de631ef2ad18733aab">ASCII</a>:
<a name="l01238"></a>01238               sfichier &lt;&lt; <span class="stringliteral">&quot;ASCII,&quot;</span>;
<a name="l01239"></a>01239               <span class="keywordflow">break</span>;
<a name="l01240"></a>01240             <span class="keywordflow">case</span> <a class="code" href="classFormat__Post__Lata.html#a8698c5e7e825c54749a7365f7ffff53ca2d3fa963128b6785fca8a03841962e16">BINAIRE</a>:
<a name="l01241"></a>01241               sfichier &lt;&lt; <span class="stringliteral">&quot;BINAIRE,&quot;</span>;
<a name="l01242"></a>01242               <span class="keywordflow">if</span> (big_endian)
<a name="l01243"></a>01243                 sfichier &lt;&lt; <span class="stringliteral">&quot;BIG_ENDIAN,&quot;</span>;
<a name="l01244"></a>01244               <span class="keywordflow">else</span>
<a name="l01245"></a>01245                 sfichier &lt;&lt; <span class="stringliteral">&quot;LITTLE_ENDIAN,&quot;</span>;
<a name="l01246"></a>01246               <span class="keywordflow">break</span>;
<a name="l01247"></a>01247             <span class="keywordflow">default</span>:
<a name="l01248"></a>01248               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Format_Post_Lata::ecrire_entete\n&quot;</span>
<a name="l01249"></a>01249                    &lt;&lt; <span class="stringliteral">&quot; format not supported&quot;</span> &lt;&lt; finl;
<a name="l01250"></a>01250               <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l01251"></a>01251             }
<a name="l01252"></a>01252           <span class="keywordflow">switch</span>(<span class="keyword">sizeof</span>(<a class="code" href="Format__Post__Lata_8cpp.html#ab18839c853328b785784a699263ad3ee">_LATA_INT_TYPE_</a>))
<a name="l01253"></a>01253             {
<a name="l01254"></a>01254             <span class="keywordflow">case</span> 4:
<a name="l01255"></a>01255               sfichier &lt;&lt; <span class="stringliteral">&quot;INT32,&quot;</span>;
<a name="l01256"></a>01256               <span class="keywordflow">break</span>;
<a name="l01257"></a>01257             <span class="keywordflow">case</span> 8:
<a name="l01258"></a>01258               sfichier &lt;&lt; <span class="stringliteral">&quot;INT64,&quot;</span>;
<a name="l01259"></a>01259               <span class="keywordflow">break</span>;
<a name="l01260"></a>01260             <span class="keywordflow">default</span>:
<a name="l01261"></a>01261               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Format_Post_Lata::ecrire_entete\n&quot;</span>
<a name="l01262"></a>01262                    &lt;&lt; <span class="stringliteral">&quot; sizeof(int) not supported&quot;</span> &lt;&lt; finl;
<a name="l01263"></a>01263               <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l01264"></a>01264             }
<a name="l01265"></a>01265           sfichier &lt;&lt; <span class="stringliteral">&quot;F_INDEXING,C_ORDERING,F_MARKERS_SINGLE,REAL32&quot;</span> &lt;&lt; finl;
<a name="l01266"></a>01266         }
<a name="l01267"></a>01267       fichier.<a class="code" href="classFichier__Lata.html#af042e59f9c02f4d9c4087e126d711426" title="Si le fichier est de type partage, appelle la methode syncfile(), sinon ne fait rien.">syncfile</a>();
<a name="l01268"></a>01268 
<a name="l01269"></a>01269     }
<a name="l01270"></a>01270 
<a name="l01271"></a>01271   <span class="keywordflow">return</span> 1;
<a name="l01272"></a>01272 }
<a name="l01273"></a><a class="code" href="classFormat__Post__Lata.html#a024555d2d2772d53eabdb71aa4749bb4">01273</a> <span class="keywordtype">int</span> <a class="code" href="classFormat__Post__Lata.html#a024555d2d2772d53eabdb71aa4749bb4">Format_Post_Lata::ecrire_temps_lata</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; temps,<span class="keywordtype">double</span>&amp; temps_format,<span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; base_name,<a class="code" href="classFormat__Post__Lata.html#a94fde71d0a9cc3249bff7f66cc4aeacc">Status</a>&amp; stat,<span class="keyword">const</span> <a class="code" href="classFormat__Post__Lata.html#a8de32871f6c5c4602655246c85410a94">Options_Para</a>&amp; <a class="code" href="classoption.html">option</a>)
<a name="l01274"></a>01274 {
<a name="l01275"></a>01275   assert(stat != <a class="code" href="classFormat__Post__Lata.html#a94fde71d0a9cc3249bff7f66cc4aeacca77c87ecaad62a824d2cd3bdfe4b60317">RESET</a>);
<a name="l01276"></a>01276 <span class="comment">// On ecrit le temps que si ce n&#39;est pas le meme...</span>
<a name="l01277"></a>01277   <span class="keywordflow">if</span> (stat != <a class="code" href="classFormat__Post__Lata.html#a94fde71d0a9cc3249bff7f66cc4aeacca38c935f66ff882dfd8690ef36146b9c9">WRITING_TIME</a> || temps_format != temps)
<a name="l01278"></a>01278     {
<a name="l01279"></a>01279       temps_format = temps;
<a name="l01280"></a>01280 <span class="comment">// Ouverture du fichier .lata en mode append</span>
<a name="l01281"></a>01281       <a class="code" href="classFichier__Lata__maitre.html" title=": Specialisation du Fichier_Lata pour le fichier maitre: toujours en ASCII. On peut utiliser une prec...">Fichier_Lata_maitre</a> fichier(base_name,<a class="code" href="classFormat__Post__Lata.html#aee3312d2f199be29261229ab7f874a40" title="Renvoie l&#39;extension conventionnelle des fichiers lata : &quot;.lata&quot;.">extension_lata</a>(), <a class="code" href="classFichier__Lata.html#afadf4963467b3123d9e9ec312644cb48ad9db95f97d41cea9e4338af8876bd408">Fichier_Lata::APPEND</a>,option);
<a name="l01282"></a>01282       <span class="keywordflow">if</span> (fichier.<a class="code" href="classFichier__Lata.html#a1a0c3473194894e5f5f79530abc45564" title="Si le fichier est de type partage, renvoie 1 si me() est egal au master du groupe et 0 sinon...">is_master</a>())
<a name="l01283"></a>01283         {
<a name="l01284"></a>01284           fichier.<a class="code" href="classFichier__Lata.html#a18a15a1d2d7f0edccbb258f9da1526b3">get_SFichier</a>() &lt;&lt; <span class="stringliteral">&quot;TEMPS &quot;</span> &lt;&lt; temps &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01285"></a>01285         }
<a name="l01286"></a>01286       fichier.<a class="code" href="classFichier__Lata.html#af042e59f9c02f4d9c4087e126d711426" title="Si le fichier est de type partage, appelle la methode syncfile(), sinon ne fait rien.">syncfile</a>();
<a name="l01287"></a>01287       stat = <a class="code" href="classFormat__Post__Lata.html#a94fde71d0a9cc3249bff7f66cc4aeacca38c935f66ff882dfd8690ef36146b9c9">WRITING_TIME</a>;
<a name="l01288"></a>01288     }
<a name="l01289"></a>01289   <span class="keywordflow">return</span> 1;
<a name="l01290"></a>01290 }
<a name="l01291"></a><a class="code" href="classFormat__Post__Lata.html#a7f98fe889849e45ba95a2d5d5a127068">01291</a> <span class="keywordtype">int</span> <a class="code" href="classFormat__Post__Lata.html#a7f98fe889849e45ba95a2d5d5a127068">Format_Post_Lata::finir</a>(<span class="keywordtype">int</span>&amp; est_le_dernier_post)
<a name="l01292"></a>01292 {
<a name="l01293"></a>01293   <span class="keywordflow">if</span> (est_le_dernier_post)
<a name="l01294"></a>01294     {
<a name="l01295"></a>01295       <a class="code" href="classFichier__Lata__maitre.html" title=": Specialisation du Fichier_Lata pour le fichier maitre: toujours en ASCII. On peut utiliser une prec...">Fichier_Lata_maitre</a> fichier(<a class="code" href="classFormat__Post__Lata.html#a8d55373127916e23ee800ef312f78cdd">lata_basename_</a>, <a class="code" href="classFormat__Post__Lata.html#aee3312d2f199be29261229ab7f874a40" title="Renvoie l&#39;extension conventionnelle des fichiers lata : &quot;.lata&quot;.">extension_lata</a>(),
<a name="l01296"></a>01296                                   <a class="code" href="classFichier__Lata.html#afadf4963467b3123d9e9ec312644cb48ad9db95f97d41cea9e4338af8876bd408">Fichier_Lata::APPEND</a>,
<a name="l01297"></a>01297                                   <a class="code" href="classFormat__Post__Lata.html#a37cf02c0fe82cc9f1ee5acf01bca9c34">options_para_</a>);
<a name="l01298"></a>01298       <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a>&amp; sfichier = fichier.<a class="code" href="classFichier__Lata.html#a18a15a1d2d7f0edccbb258f9da1526b3">get_SFichier</a>();
<a name="l01299"></a>01299       <span class="keywordflow">if</span> (fichier.<a class="code" href="classFichier__Lata.html#a1a0c3473194894e5f5f79530abc45564" title="Si le fichier est de type partage, renvoie 1 si me() est egal au master du groupe et 0 sinon...">is_master</a>())
<a name="l01300"></a>01300         {
<a name="l01301"></a>01301           sfichier &lt;&lt; <span class="stringliteral">&quot;FIN&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01302"></a>01302 
<a name="l01303"></a>01303         }
<a name="l01304"></a>01304       fichier.<a class="code" href="classFichier__Lata.html#af042e59f9c02f4d9c4087e126d711426" title="Si le fichier est de type partage, appelle la methode syncfile(), sinon ne fait rien.">syncfile</a>();
<a name="l01305"></a>01305     }
<a name="l01306"></a>01306   <span class="keywordflow">return</span> 1;
<a name="l01307"></a>01307 }
<a name="l01308"></a>01308 
<a name="l01309"></a>01309 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:15 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
