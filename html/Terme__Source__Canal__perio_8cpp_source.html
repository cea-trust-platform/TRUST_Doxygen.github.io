<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/ThHyd/Incompressible/Sources/Terme_Source_Canal_perio.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/ThHyd/Incompressible/Sources/Terme_Source_Canal_perio.cpp</div>  </div>
</div>
<div class="contents">
<a href="Terme__Source__Canal__perio_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (c) 2021, CEA</span>
<a name="l00003"></a>00003 <span class="comment">* All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment">* 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00007"></a>00007 <span class="comment">* 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00008"></a>00008 <span class="comment">* 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<a name="l00011"></a>00011 <span class="comment">* IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;</span>
<a name="l00012"></a>00012 <span class="comment">* OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// File:        Terme_Source_Canal_perio.cpp</span>
<a name="l00018"></a>00018 <span class="comment">// Directory:   $TRUST_ROOT/src/ThHyd/Incompressible/Sources</span>
<a name="l00019"></a>00019 <span class="comment">// Version:     1</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;<a class="code" href="Terme__Source__Canal__perio_8h.html">Terme_Source_Canal_perio.h</a>&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="Motcle_8h.html">Motcle.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="Double_8h.html">Double.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="Probleme__base_8h.html">Probleme_base.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="communications_8h.html">communications.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="Zone__VF_8h.html">Zone_VF.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="Zone__Cl__dis__base_8h.html">Zone_Cl_dis_base.h</a>&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;<a class="code" href="Periodique_8h.html">Periodique.h</a>&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;<a class="code" href="Neumann__paroi_8h.html">Neumann_paroi.h</a>&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;<a class="code" href="Convection__Diffusion__std_8h.html">Convection_Diffusion_std.h</a>&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;<a class="code" href="Fluide__Incompressible_8h.html">Fluide_Incompressible.h</a>&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;<a class="code" href="Operateur__Diff__base_8h.html">Operateur_Diff_base.h</a>&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;<a class="code" href="Navier__Stokes__std_8h.html">Navier_Stokes_std.h</a>&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;<a class="code" href="EFichier_8h.html">EFichier.h</a>&gt;</span>
<a name="l00037"></a>00037 
<a name="l00038"></a><a class="code" href="Terme__Source__Canal__perio_8cpp.html#a0ede11c69335e3067ac73416b3408adc">00038</a> <a class="code" href="Declare__Base_8h.html#a4860a967d304a80bd1e155f90e2362b7">Implemente_base_sans_constructeur_ni_destructeur</a>(<a class="code" href="classTerme__Source__Canal__perio.html" title="Source term to keep a constant flow rate in a channel with periodic boundary conditions.">Terme_Source_Canal_perio</a>,<span class="stringliteral">&quot;Terme_Source_Canal_perio&quot;</span>,<a class="code" href="classSource__base.html" title="classe Source_base Un objet Source_base est un terme apparaissant au second membre d&#39;une equation...">Source_base</a>);
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 
<a name="l00041"></a><a class="code" href="classTerme__Source__Canal__perio.html#a9258bf6b537daf096feaac83aff2e661">00041</a> <a class="code" href="classTerme__Source__Canal__perio.html#a9258bf6b537daf096feaac83aff2e661">Terme_Source_Canal_perio::Terme_Source_Canal_perio</a>():
<a name="l00042"></a>00042   direction_ecoulement_(-1),
<a name="l00043"></a>00043   velocity_weighting_(0),
<a name="l00044"></a>00044   bord_periodique_(<span class="stringliteral">&quot;&quot;</span>),
<a name="l00045"></a>00045   surface_bord_(0.0),
<a name="l00046"></a>00046   h(0.0), <a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a>(0.0), u_etoile(0.0),
<a name="l00047"></a>00047   deb_(0.0),
<a name="l00048"></a>00048   source_(0.0),
<a name="l00049"></a>00049   debnm1_(0.0),
<a name="l00050"></a>00050   debit_ref_(0.0),
<a name="l00051"></a>00051   dernier_temps_calc_(-1.0),  <span class="comment">//!&lt; why??</span>
<a name="l00052"></a>00052 <span class="comment"></span>  is_debit_impose_(0),
<a name="l00053"></a>00053   debit_impose_(0.0)
<a name="l00054"></a>00054 {
<a name="l00055"></a>00055 }
<a name="l00056"></a>00056 
<a name="l00057"></a><a class="code" href="classTerme__Source__Canal__perio.html#a2d2e2c4fb0b23783f6a0d52f2733aea8">00057</a> <a class="code" href="classTerme__Source__Canal__perio.html#a2d2e2c4fb0b23783f6a0d52f2733aea8">Terme_Source_Canal_perio::~Terme_Source_Canal_perio</a>()
<a name="l00058"></a>00058 {}
<a name="l00059"></a>00059 
<a name="l00060"></a><a class="code" href="classTerme__Source__Canal__perio.html#adc50c1d825a5c4b79690196ef9d5cf74">00060</a> <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classTerme__Source__Canal__perio.html#adc50c1d825a5c4b79690196ef9d5cf74" title="NE FAIT RIEN A surcharger dans les classes derivees. Imprime la source sur un flot de sortie...">Terme_Source_Canal_perio::printOn</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; s )<span class="keyword"> const</span>
<a name="l00061"></a>00061 <span class="keyword"></span>{
<a name="l00062"></a>00062   <span class="keywordflow">return</span> s &lt;&lt; <a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() ;
<a name="l00063"></a>00063 }
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 <span class="comment">// </span>
<a name="l00066"></a>00066 <span class="comment">// //// readOn</span>
<a name="l00067"></a>00067 <span class="comment">// //</span>
<a name="l00068"></a>00068 
<a name="l00069"></a><a class="code" href="classTerme__Source__Canal__perio.html#aaa292f0b1c7eb6121c25a8dd1f0e286b">00069</a> <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classTerme__Source__Canal__perio.html#aaa292f0b1c7eb6121c25a8dd1f0e286b" title="NE FAIT RIEN A surcharger dans les classes derivees. Lecture d&#39;un terme source sur un flot d&#39;entree...">Terme_Source_Canal_perio::readOn</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; s )
<a name="l00070"></a>00070 {
<a name="l00071"></a>00071   <span class="keywordflow">return</span> <a class="code" href="classTerme__Source__Canal__perio.html#a36b05a0cd64804d8b5ca4f72d4bdb233">lire_donnees</a>(s);
<a name="l00072"></a>00072 }
<a name="l00073"></a>00073 
<a name="l00074"></a><a class="code" href="classTerme__Source__Canal__perio.html#a1626e11bf22eba942dc218df377ca6c1">00074</a> <span class="keywordtype">void</span> <a class="code" href="classTerme__Source__Canal__perio.html#a1626e11bf22eba942dc218df377ca6c1">Terme_Source_Canal_perio::associer_pb</a>(<span class="keyword">const</span> <a class="code" href="classProbleme__base.html" title="classe Probleme_base C&#39;est un Probleme_U qui n&#39;est pas un couplage. Le role d&#39;un Probleme_base est la...">Probleme_base</a>&amp; pb)
<a name="l00075"></a>00075 {}
<a name="l00076"></a>00076 
<a name="l00077"></a><a class="code" href="classTerme__Source__Canal__perio.html#a36b05a0cd64804d8b5ca4f72d4bdb233">00077</a> <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classTerme__Source__Canal__perio.html#a36b05a0cd64804d8b5ca4f72d4bdb233">Terme_Source_Canal_perio::lire_donnees</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00078"></a>00078 {
<a name="l00079"></a>00079   <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> accolade_ouverte(<span class="stringliteral">&quot;{&quot;</span>);
<a name="l00080"></a>00080   <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> accolade_fermee(<span class="stringliteral">&quot;}&quot;</span>);
<a name="l00081"></a>00081   <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> motlu;
<a name="l00082"></a>00082 <span class="comment">// Valeurs par defaut</span>
<a name="l00083"></a>00083   <a class="code" href="classTerme__Source__Canal__perio.html#ac3a1492adb1231197cd279df993dc342">u_etoile</a> = 0.;
<a name="l00084"></a>00084   <a class="code" href="classTerme__Source__Canal__perio.html#a9ac4ab69c63403fafd396c23d238366f">h</a> = 1.;
<a name="l00085"></a>00085   <a class="code" href="classTerme__Source__Canal__perio.html#abaf6516c14242e27e7766becd9c7acdf">coeff</a> = 10.;
<a name="l00086"></a>00086   <a class="code" href="classTerme__Source__Canal__perio.html#abd9a4e32c74f22698393b51bd9ec2092">velocity_weighting_</a> = 0;
<a name="l00087"></a>00087 <span class="comment">// FIN valeurs par defaut</span>
<a name="l00088"></a>00088 
<a name="l00089"></a>00089   <span class="keywordtype">int</span> verif = 0;
<a name="l00090"></a>00090   <a class="code" href="classMotcles.html" title="Un tableau d&#39;objets de la classe Motcle.">Motcles</a> les_mots(7);
<a name="l00091"></a>00091 
<a name="l00092"></a>00092   <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> mot_lu;
<a name="l00093"></a>00093   {
<a name="l00094"></a>00094     les_mots[0]=<span class="stringliteral">&quot;direction_ecoulement&quot;</span>; <span class="comment">//!&lt; Obsolete</span>
<a name="l00095"></a>00095 <span class="comment"></span>    les_mots[1]=<span class="stringliteral">&quot;u_etoile&quot;</span>;
<a name="l00096"></a>00096     les_mots[2]=<span class="stringliteral">&quot;coeff&quot;</span>;
<a name="l00097"></a>00097     les_mots[3]=<span class="stringliteral">&quot;h&quot;</span>;
<a name="l00098"></a>00098     les_mots[4]=<span class="stringliteral">&quot;bord&quot;</span>;
<a name="l00099"></a>00099     les_mots[5]=<span class="stringliteral">&quot;velocity_weighting&quot;</span>; <span class="comment">//!&lt; Energy source term algorithm 0 | 1</span>
<a name="l00100"></a>00100 <span class="comment"></span>    les_mots[6]=<span class="stringliteral">&quot;debit_impose&quot;</span>;
<a name="l00101"></a>00101   }
<a name="l00102"></a>00102   <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> acc_ouverte(<span class="stringliteral">&quot;{&quot;</span>);
<a name="l00103"></a>00103   <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> acc_fermee(<span class="stringliteral">&quot;}&quot;</span>);
<a name="l00104"></a>00104   is &gt;&gt; mot_lu;
<a name="l00105"></a>00105   <span class="keywordflow">if</span>(mot_lu != acc_ouverte)
<a name="l00106"></a>00106     {
<a name="l00107"></a>00107       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;We were expecting a { instead of &quot;</span> &lt;&lt; mot_lu &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00108"></a>00108     }
<a name="l00109"></a>00109   is &gt;&gt; mot_lu;
<a name="l00110"></a>00110   <a class="code" href="classTerme__Source__Canal__perio.html#af253a8469b355b58214fc2bd66e44184">dir_source_</a>.<a class="code" href="classArrOfDouble.html#aa5d7035f2e4f451c484aabd5dffb873b" title="appel a ArrOfDouble::resize_array()">resize</a>(<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>);
<a name="l00111"></a>00111   <a class="code" href="classTerme__Source__Canal__perio.html#af253a8469b355b58214fc2bd66e44184">dir_source_</a>=0;
<a name="l00112"></a>00112   <span class="keywordflow">while</span>(mot_lu != acc_fermee)
<a name="l00113"></a>00113     {
<a name="l00114"></a>00114       <span class="keywordtype">int</span> rang=les_mots.<a class="code" href="classMotcles.html#afecd68f73e904bc129022a236ff6ab15">search</a>(mot_lu);
<a name="l00115"></a>00115       <span class="keywordflow">switch</span>(rang)
<a name="l00116"></a>00116         {
<a name="l00117"></a>00117         <span class="keywordflow">case</span> 0 :
<a name="l00118"></a>00118           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt;<span class="stringliteral">&quot;The direction_ecoulement option is obsolete, you must now use the bord option to specify the boundary where periodicity is applied.&quot;</span>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00119"></a>00119           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00120"></a>00120           <span class="keywordflow">break</span>;
<a name="l00121"></a>00121         <span class="keywordflow">case</span> 1  :
<a name="l00122"></a>00122           is &gt;&gt; <a class="code" href="classTerme__Source__Canal__perio.html#ac3a1492adb1231197cd279df993dc342">u_etoile</a>;
<a name="l00123"></a>00123           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Friction Velocity : &quot;</span> &lt;&lt; u_etoile  &lt;&lt; finl;
<a name="l00124"></a>00124           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;L&#39;option u_etoile est obsolete, supprimer la du jeu de donnees&quot;</span>&lt;&lt;finl;
<a name="l00125"></a>00125           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00126"></a>00126           <span class="keywordflow">break</span>;
<a name="l00127"></a>00127         <span class="keywordflow">case</span> 2  :
<a name="l00128"></a>00128           is &gt;&gt; <a class="code" href="classTerme__Source__Canal__perio.html#abaf6516c14242e27e7766becd9c7acdf">coeff</a>;
<a name="l00129"></a>00129           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Damping Coefficient is now set : &quot;</span> &lt;&lt; coeff &lt;&lt; finl;
<a name="l00130"></a>00130           <span class="keywordflow">break</span>;
<a name="l00131"></a>00131         <span class="keywordflow">case</span> 3  :
<a name="l00132"></a>00132           is &gt;&gt; <a class="code" href="classTerme__Source__Canal__perio.html#a9ac4ab69c63403fafd396c23d238366f">h</a>;
<a name="l00133"></a>00133           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Channel Half-height : &quot;</span> &lt;&lt; h &lt;&lt; finl;
<a name="l00134"></a>00134           <span class="keywordflow">break</span>;
<a name="l00135"></a>00135         <span class="keywordflow">case</span> 4  :
<a name="l00136"></a>00136           is &gt;&gt; <a class="code" href="classTerme__Source__Canal__perio.html#acf1d044692e7f1f680cb81f670058e75">bord_periodique_</a>;
<a name="l00137"></a>00137           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Periodic flow according the &quot;</span> &lt;&lt; bord_periodique_ &lt;&lt; <span class="stringliteral">&quot; boundary.&quot;</span> &lt;&lt; finl;
<a name="l00138"></a>00138           verif = 1;
<a name="l00139"></a>00139           <span class="keywordflow">break</span>;
<a name="l00140"></a>00140         <span class="keywordflow">case</span> 6  :
<a name="l00141"></a>00141           is &gt;&gt; <a class="code" href="classTerme__Source__Canal__perio.html#a98a75a5f8f28eb714e1391c94faa7627">debit_impose_</a>;
<a name="l00142"></a>00142           <a class="code" href="classTerme__Source__Canal__perio.html#a4f686c39a46e903d0bdbc2849cd937df">is_debit_impose_</a>=1;
<a name="l00143"></a>00143           <span class="keywordflow">break</span>;
<a name="l00144"></a>00144         <span class="keywordflow">case</span> 5  :
<a name="l00145"></a>00145           is &gt;&gt; <a class="code" href="classTerme__Source__Canal__perio.html#abd9a4e32c74f22698393b51bd9ec2092">velocity_weighting_</a>;
<a name="l00146"></a>00146           <span class="keywordflow">if</span> (velocity_weighting_!=0 &amp;&amp; velocity_weighting_!=1)
<a name="l00147"></a>00147             {
<a name="l00148"></a>00148               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;velocity_weighting value should be 0 or 1.&quot;</span> &lt;&lt; finl;
<a name="l00149"></a>00149               <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00150"></a>00150             }
<a name="l00151"></a>00151           <span class="keywordflow">if</span> (!<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classConvection__Diffusion__std.html" title="classe Convection_Diffusion_std Cette classe est la base des equations modelisant le transport d&#39;un s...">Convection_Diffusion_std</a>,<a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>()))
<a name="l00152"></a>00152             {
<a name="l00153"></a>00153               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;velocity_weighting option is available only for a Canal_perio source term in the energy equation.&quot;</span> &lt;&lt; finl;
<a name="l00154"></a>00154               <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00155"></a>00155             }
<a name="l00156"></a>00156           <span class="keywordflow">break</span>;
<a name="l00157"></a>00157         <span class="keywordflow">default</span> :
<a name="l00158"></a>00158           {
<a name="l00159"></a>00159             <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; mot_lu &lt;&lt; <span class="stringliteral">&quot; is not expected by Terme_Source_Canal_perio&quot;</span> &lt;&lt; finl;
<a name="l00160"></a>00160             <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;The possible keywords are : &quot;</span> &lt;&lt; les_mots &lt;&lt; finl;
<a name="l00161"></a>00161             <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00162"></a>00162           }
<a name="l00163"></a>00163         }
<a name="l00164"></a>00164       is &gt;&gt; mot_lu;
<a name="l00165"></a>00165     }
<a name="l00166"></a>00166 
<a name="l00167"></a>00167   <span class="keywordflow">if</span> (verif != 1)
<a name="l00168"></a>00168     {
<a name="l00169"></a>00169       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;User did not specify flow direction.&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00170"></a>00170       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;trust will now stop !&quot;</span> &lt;&lt; finl;
<a name="l00171"></a>00171       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00172"></a>00172     }
<a name="l00173"></a>00173   <span class="keywordflow">return</span> is;
<a name="l00174"></a>00174 }
<a name="l00175"></a>00175 
<a name="l00176"></a><a class="code" href="classTerme__Source__Canal__perio.html#a2f7007333154f96b511a41e7f8d48ae6">00176</a> <span class="keywordtype">void</span> <a class="code" href="classTerme__Source__Canal__perio.html#a2f7007333154f96b511a41e7f8d48ae6" title="Met a jour les references internes a l&#39;objet Source_base. Appelle 2 methodes virtuelles pures protege...">Terme_Source_Canal_perio::completer</a>()
<a name="l00177"></a>00177 {
<a name="l00178"></a>00178   <a class="code" href="classTerme__Source__Canal__perio.html#a2f7007333154f96b511a41e7f8d48ae6" title="Met a jour les references internes a l&#39;objet Source_base. Appelle 2 methodes virtuelles pures protege...">Source_base::completer</a>();
<a name="l00179"></a>00179   <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classConvection__Diffusion__std.html" title="classe Convection_Diffusion_std Cette classe est la base des equations modelisant le transport d&#39;un s...">Convection_Diffusion_std</a>,<a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>()))
<a name="l00180"></a>00180     {
<a name="l00181"></a>00181       <a class="code" href="classSource__base.html#a0c7ba45384fd8a09c418d72496990a02">set_fichier</a>(<span class="stringliteral">&quot;Canal_perio&quot;</span>);
<a name="l00182"></a>00182       <a class="code" href="classSource__base.html#ab4a0cbb15d306caab569fa619e0068a8">set_description</a>(<span class="stringliteral">&quot;Energy source term = Integral(P*dv) [W]&quot;</span>);
<a name="l00183"></a>00183     }
<a name="l00184"></a>00184   <span class="keywordtype">int</span> nb_bords = <a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().<a class="code" href="classEquation__base.html#a12d97ae801edc18f614523677921346e" title="Renvoie la zone discretisee associee a l&#39;equation.">zone_dis</a>().<a class="code" href="classDeriv__Zone__dis__base.html#a30ff47fc0684fe134e8c74c35b268941">valeur</a>().<a class="code" href="classZone__dis__base.html#af22167d614644f55591a29c77eb1c009">nb_front_Cl</a>();
<a name="l00185"></a>00185   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n_bord=0; n_bord&lt;nb_bords; n_bord++)
<a name="l00186"></a>00186     {
<a name="l00187"></a>00187       <span class="keyword">const</span> <a class="code" href="classCond__lim.html" title="classe Cond_lim Classe generique servant a representer n&#39;importe quelle classe derivee de la classe C...">Cond_lim</a>&amp; la_cl = <a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().<a class="code" href="classEquation__base.html#af265fe0ea30868eb2176a0c887e4efab" title="Renvoie la zone des conditions aux limite discretisee associee a l&#39;equation.">zone_Cl_dis</a>().<a class="code" href="classDeriv__Zone__Cl__dis__base.html#a6b56880f00b604e1f13970ec6d5bc077">valeur</a>().<a class="code" href="classZone__Cl__dis__base.html#af75e0ed7786863e4d333bfb29d67c323" title="Renvoie la i-ieme condition aux limites. (version const)">les_conditions_limites</a>(n_bord);
<a name="l00188"></a>00188       <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classPeriodique.html" title="classe Periodique Cette classe represente une condition aux limites periodique. On peut specifier une...">Periodique</a>,la_cl.<a class="code" href="classDeriv__Cond__lim__base.html#a482c910c704f6f51065a8b7d25acf48a">valeur</a>()))
<a name="l00189"></a>00189         {
<a name="l00190"></a>00190           <span class="keyword">const</span> <a class="code" href="classPeriodique.html" title="classe Periodique Cette classe represente une condition aux limites periodique. On peut specifier une...">Periodique</a>&amp; perio = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classPeriodique.html" title="classe Periodique Cette classe represente une condition aux limites periodique. On peut specifier une...">Periodique</a>,la_cl.<a class="code" href="classDeriv__Cond__lim__base.html#a482c910c704f6f51065a8b7d25acf48a">valeur</a>());
<a name="l00191"></a>00191           <span class="keyword">const</span> <a class="code" href="classFront__VF.html" title="class Front_VF">Front_VF</a>&amp; le_bord = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classFront__VF.html" title="class Front_VF">Front_VF</a>,la_cl.<a class="code" href="classCond__lim.html#a5b2d24809cee07727006a891d4ce8d22" title="Appel a l&#39;objet sous-jacent Renvoie la frontiere discretisee associee a la condition aux limites...">frontiere_dis</a>());
<a name="l00192"></a>00192           <span class="keywordflow">if</span> ( <a class="code" href="classTerme__Source__Canal__perio.html#acf1d044692e7f1f680cb81f670058e75">bord_periodique_</a> == le_bord.<a class="code" href="classNom.html#a4fcffbaa80271df0d9674f2a2751efb9" title="Renvoie *this;.">le_nom</a>() ) <span class="comment">//!&lt; Le bord periodique est specifie</span>
<a name="l00193"></a>00193 <span class="comment"></span>            {
<a name="l00194"></a>00194               <span class="keywordflow">if</span> (perio.<a class="code" href="classPeriodique.html#af1aef7cae57f1776b50360234e3fa1bb">est_periodique_selon_un_axe</a>())
<a name="l00195"></a>00195                 {
<a name="l00196"></a>00196 <span class="comment">// Cas ou le bord est periodique selon un axe, alors on fixe la direction de l&#39;ecoulement (VDF)</span>
<a name="l00197"></a>00197                   <a class="code" href="classTerme__Source__Canal__perio.html#a48eeb00d34b0d2c5116c490eecc175f0">direction_ecoulement_</a> = perio.<a class="code" href="classPeriodique.html#a449939e79c6fb0466c200cb121fa4c90">direction_periodicite</a>();
<a name="l00198"></a>00198                 }
<a name="l00199"></a>00199               <span class="keywordflow">else</span>
<a name="l00200"></a>00200                 {
<a name="l00201"></a>00201 <span class="comment">// Cas general ou le bord periodique n&#39;est pas oriente selon un axe:</span>
<a name="l00202"></a>00202                   <a class="code" href="classTerme__Source__Canal__perio.html#af253a8469b355b58214fc2bd66e44184">dir_source_</a> = perio.<a class="code" href="classPeriodique.html#a6a2f5c67fde918ab6b9f3d3d01eabd19">direction_perio</a>();
<a name="l00203"></a>00203                   <a class="code" href="classTerme__Source__Canal__perio.html#af253a8469b355b58214fc2bd66e44184">dir_source_</a> *= -1;
<a name="l00204"></a>00204 <span class="comment">// On adimensionnalise:</span>
<a name="l00205"></a>00205                   <span class="keywordtype">double</span> <a class="code" href="Double_8h.html#ac842198e9490fae75825cab2a03eed2d">norme</a> = <a class="code" href="ArrOfDouble_8cpp.html#af3b2ac08cde80e3eadd7a83f5fd06ab7" title="Calcul de la norme du vecteur dx (fonction blas DNRM2, soit racine carree(somme des dx[i]*dx[i])...">norme_array</a>(<a class="code" href="classTerme__Source__Canal__perio.html#af253a8469b355b58214fc2bd66e44184">dir_source_</a>);
<a name="l00206"></a>00206                   <a class="code" href="classTerme__Source__Canal__perio.html#af253a8469b355b58214fc2bd66e44184">dir_source_</a> /= <a class="code" href="Double_8h.html#ac842198e9490fae75825cab2a03eed2d">norme</a>;
<a name="l00207"></a>00207                 }
<a name="l00208"></a>00208 <span class="comment">// On recupere la surface</span>
<a name="l00209"></a>00209               <a class="code" href="classTerme__Source__Canal__perio.html#a789d76f549531aaa07675a8560ed9c5d">surface_bord_</a> = 0.5 * le_bord.frontiere().get_aire();
<a name="l00210"></a>00210               <span class="keywordflow">return</span>;
<a name="l00211"></a>00211             }
<a name="l00212"></a>00212         }
<a name="l00213"></a>00213     }
<a name="l00214"></a>00214   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;********************************************************&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00215"></a>00215   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error for the definition of the Canal_perio source term.&quot;</span> &lt;&lt; finl;
<a name="l00216"></a>00216   <span class="keywordflow">if</span> (<a class="code" href="classTerme__Source__Canal__perio.html#acf1d044692e7f1f680cb81f670058e75">bord_periodique_</a>==<span class="stringliteral">&quot;&quot;</span>)
<a name="l00217"></a>00217     {
<a name="l00218"></a>00218       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;It seems the channel is not parallel to an axis. Direction_ecoulement keyword is useless in this case.&quot;</span> &lt;&lt; finl;
<a name="l00219"></a>00219       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;So try to use the following syntax to specify the name of the periodic boundary:&quot;</span> &lt;&lt; finl;
<a name="l00220"></a>00220       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Canal_perio { bord name }&quot;</span> &lt;&lt; finl;
<a name="l00221"></a>00221     }
<a name="l00222"></a>00222   <span class="keywordflow">else</span>
<a name="l00223"></a>00223     {
<a name="l00224"></a>00224       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <a class="code" href="classTerme__Source__Canal__perio.html#acf1d044692e7f1f680cb81f670058e75">bord_periodique_</a> &lt;&lt; <span class="stringliteral">&quot; is not a boundary with a periodic boundary condition.&quot;</span> &lt;&lt; finl;
<a name="l00225"></a>00225     }
<a name="l00226"></a>00226   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00227"></a>00227 }
<a name="l00228"></a>00228 
<a name="l00229"></a><a class="code" href="classTerme__Source__Canal__perio.html#ad43a03ff6f494802d799403f183c013b">00229</a> <span class="keywordtype">void</span> <a class="code" href="classTerme__Source__Canal__perio.html#ad43a03ff6f494802d799403f183c013b">Terme_Source_Canal_perio::write_flow_rate</a>(<span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; ext_nom_source_, <span class="keywordtype">double</span> debit_e)<span class="keyword"> const</span>
<a name="l00230"></a>00230 <span class="keyword"></span>{
<a name="l00231"></a>00231   <span class="keywordtype">double</span> tps = <a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a5054df01edb6d4f7baec7e612d423834" title="Renvoie le temps courant.">temps_courant</a>();
<a name="l00232"></a>00232   <span class="keywordtype">double</span> tps_init = <a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a2389e67de1603768ab6b1bd396e0adba" title="Renvoie le temps initial.">temps_init</a>();
<a name="l00233"></a>00233   <span class="keywordtype">double</span> dt = <a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a0e4f67ef6086c09434ddc161668077b2" title="Renvoie le pas de temps (delta_t) courant.">pas_de_temps</a>();
<a name="l00234"></a>00234   <span class="keywordtype">int</span> premiere_ecriture = (!<a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().<a class="code" href="classEquation__base.html#aa8151a96f63719523bf50ddd832e0f8f" title="Renvoie le probleme associe a l&#39;equation.">probleme</a>().<a class="code" href="classProbleme__base.html#acafc48b3c050d6c292bb8395a7904a33">reprise_effectuee</a>() &amp;&amp; <a class="code" href="classTerme__Source__Canal__perio.html#a139d7f05cc38ac30fd7e16f2ac5b854f">deb_</a>==0 ? 1 : 0);
<a name="l00235"></a>00235 
<a name="l00236"></a>00236 <span class="comment">// Write the flow rate file if equation is Navier Stokes:</span>
<a name="l00237"></a>00237   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> filename(<a class="code" href="classObjet__U.html#a7c27c4f80259eeef76ff8fe2d3bc61f7" title="Renvoie une reference constante vers le nom du cas. Cette methode est statique.">nom_du_cas</a>());
<a name="l00238"></a>00238   filename+=<span class="stringliteral">&quot;_Channel_Flow_Rate_&quot;</span>;
<a name="l00239"></a>00239   filename+=ext_nom_source_ ;
<a name="l00240"></a>00240   <span class="keywordflow">if</span> (!<a class="code" href="classTerme__Source__Canal__perio.html#a4d858affc3edb4a3d7f46a6a0f6db59c">flow_rate_file_</a>.<a class="code" href="classSortie__Fichier__base.html#acc0244cc2feedba886b643e9b3c295db">is_open</a>())
<a name="l00241"></a>00241     {
<a name="l00242"></a>00242       <a class="code" href="classTerme__Source__Canal__perio.html#a4d858affc3edb4a3d7f46a6a0f6db59c">flow_rate_file_</a>.<a class="code" href="classSortie__Fichier__base.html#a7e75e18ed580cd4d45912ec202caa2b2">ouvrir</a>(filename, (premiere_ecriture?ios::out:ios::app));
<a name="l00243"></a>00243       <a class="code" href="classTerme__Source__Canal__perio.html#a4d858affc3edb4a3d7f46a6a0f6db59c">flow_rate_file_</a>.<a class="code" href="classSortie__Fichier__base.html#a5ddd834ca9c766c24cc608cd03ef0e96">setf</a>(ios::scientific);
<a name="l00244"></a>00244     }
<a name="l00245"></a>00245 <span class="comment">// on met des commentaires dans l&#39;entete du fichier</span>
<a name="l00246"></a>00246   <span class="keywordflow">if</span> ((tps &lt;= (tps_init+dt)) &amp;&amp; premiere_ecriture)
<a name="l00247"></a>00247     {
<a name="l00248"></a>00248       <span class="keywordflow">if</span> (<a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().probleme().is_dilatable()==1)
<a name="l00249"></a>00249         <a class="code" href="classTerme__Source__Canal__perio.html#a4d858affc3edb4a3d7f46a6a0f6db59c">flow_rate_file_</a> &lt;&lt; <span class="stringliteral">&quot;# Time t     Flow rate Q(t) in [kg.s-1] if SI units used&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00250"></a>00250       <span class="keywordflow">else</span>
<a name="l00251"></a>00251         <a class="code" href="classTerme__Source__Canal__perio.html#a4d858affc3edb4a3d7f46a6a0f6db59c">flow_rate_file_</a> &lt;&lt; <span class="stringliteral">&quot;# Time t     Flow rate Q(t) in [m3.s-1] if SI units used&quot;</span> &lt;&lt; finl;
<a name="l00252"></a>00252     }
<a name="l00253"></a>00253   <a class="code" href="classTerme__Source__Canal__perio.html#a4d858affc3edb4a3d7f46a6a0f6db59c">flow_rate_file_</a> &lt;&lt; tps+dt &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; debit_e &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00254"></a>00254 
<a name="l00255"></a>00255   <span class="keywordflow">if</span> (<a class="code" href="classTerme__Source__Canal__perio.html#a139d7f05cc38ac30fd7e16f2ac5b854f">deb_</a>==0)
<a name="l00256"></a>00256     {
<a name="l00257"></a>00257       <a class="code" href="classTerme__Source__Canal__perio.html#a139d7f05cc38ac30fd7e16f2ac5b854f">deb_</a> = 1;
<a name="l00258"></a>00258       <a class="code" href="classTerme__Source__Canal__perio.html#aeccf53a0c9a1811c9b50a0da72f9f960">debit_ref_</a> = debit_e;
<a name="l00259"></a>00259       <span class="keywordflow">if</span> (<a class="code" href="classTerme__Source__Canal__perio.html#a4f686c39a46e903d0bdbc2849cd937df">is_debit_impose_</a>)
<a name="l00260"></a>00260         <a class="code" href="classTerme__Source__Canal__perio.html#aeccf53a0c9a1811c9b50a0da72f9f960">debit_ref_</a>=<a class="code" href="classTerme__Source__Canal__perio.html#a98a75a5f8f28eb714e1391c94faa7627">debit_impose_</a>;
<a name="l00261"></a>00261       <a class="code" href="classTerme__Source__Canal__perio.html#a1fec005e754130660b6f6f3698f61b4a">debnm1_</a> = <a class="code" href="classTerme__Source__Canal__perio.html#aeccf53a0c9a1811c9b50a0da72f9f960">debit_ref_</a>;
<a name="l00262"></a>00262       <a class="code" href="classTerme__Source__Canal__perio.html#a19a5efbc817635566e247a28f029d829">source_</a> = 0.;
<a name="l00263"></a>00263 
<a name="l00264"></a>00264 <span class="comment">// Deplacer dans completer ?</span>
<a name="l00265"></a>00265 <span class="comment">// Read the restart file:</span>
<a name="l00266"></a>00266       <span class="keywordflow">if</span> (<a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().probleme().reprise_effectuee())
<a name="l00267"></a>00267         {
<a name="l00268"></a>00268           <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> filename2(<a class="code" href="classObjet__U.html#a7c27c4f80259eeef76ff8fe2d3bc61f7" title="Renvoie une reference constante vers le nom du cas. Cette methode est statique.">nom_du_cas</a>());
<a name="l00269"></a>00269           filename2+=<span class="stringliteral">&quot;_Channel_Flow_Rate_repr_&quot;</span>;
<a name="l00270"></a>00270           filename2+=ext_nom_source_ ;
<a name="l00271"></a>00271           <a class="code" href="classEFichier.html" title="Fichier en lecture Cette classe est a la classe C++ ifstream ce que la classe Entree est a la classe ...">EFichier</a> fichier_reprise;
<a name="l00272"></a>00272           <span class="keywordflow">if</span> (!fichier_reprise.<a class="code" href="classEntree__Fichier__base.html#a8e34b235668e94f335cc9ab18dd4e427">ouvrir</a>(filename2))
<a name="l00273"></a>00273             {
<a name="l00274"></a>00274               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;File &quot;</span> &lt;&lt; filename2 &lt;&lt; <span class="stringliteral">&quot; not found !&quot;</span> &lt;&lt; finl;
<a name="l00275"></a>00275               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Since the 1.6.8 version, you absolutly need this file to restart the calculation.&quot;</span> &lt;&lt; finl;
<a name="l00276"></a>00276               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Look for a file named *Channel_Flow_Rate_repr* and renamed it for example.&quot;</span> &lt;&lt; finl;
<a name="l00277"></a>00277               <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00278"></a>00278             }
<a name="l00279"></a>00279           <span class="keywordflow">else</span>
<a name="l00280"></a>00280             {
<a name="l00281"></a>00281 <span class="comment">// Check header</span>
<a name="l00282"></a>00282               <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> str;
<a name="l00283"></a>00283               fichier_reprise &gt;&gt; str;
<a name="l00284"></a>00284               <span class="keywordflow">if</span> (str==<span class="stringliteral">&quot;#&quot;</span>)
<a name="l00285"></a>00285                 {
<a name="l00286"></a>00286 <span class="comment">// Read the whole line:</span>
<a name="l00287"></a>00287                   std::string line;
<a name="l00288"></a>00288                   std::getline(fichier_reprise.<a class="code" href="classEntree__Fichier__base.html#a9e5abc201d0864efb7e22b593556f432">get_ifstream</a>(), line);
<a name="l00289"></a>00289                 }
<a name="l00290"></a>00290               <span class="keywordflow">else</span>
<a name="l00291"></a>00291                 {
<a name="l00292"></a>00292 <span class="comment">// Reopen:</span>
<a name="l00293"></a>00293                   fichier_reprise.<a class="code" href="classEntree__Fichier__base.html#a8e34b235668e94f335cc9ab18dd4e427">ouvrir</a>(filename);
<a name="l00294"></a>00294                 }
<a name="l00295"></a>00295 <span class="comment">// Read up to the time:</span>
<a name="l00296"></a>00296               <span class="keywordtype">int</span> time_found = 0;
<a name="l00297"></a>00297               <span class="keywordflow">while</span> (!fichier_reprise.<a class="code" href="classEntree__Fichier__base.html#a5e6b0d743eb5c7986090c615bd7ad584">eof</a>() &amp;&amp; !time_found)
<a name="l00298"></a>00298                 {
<a name="l00299"></a>00299                   <span class="keywordtype">double</span> temps_ecrit;
<a name="l00300"></a>00300                   fichier_reprise &gt;&gt; temps_ecrit;
<a name="l00301"></a>00301                   fichier_reprise &gt;&gt; <a class="code" href="classTerme__Source__Canal__perio.html#a1fec005e754130660b6f6f3698f61b4a">debnm1_</a>;
<a name="l00302"></a>00302                   fichier_reprise &gt;&gt; <a class="code" href="classTerme__Source__Canal__perio.html#aeccf53a0c9a1811c9b50a0da72f9f960">debit_ref_</a>;
<a name="l00303"></a>00303                   fichier_reprise &gt;&gt; <a class="code" href="classTerme__Source__Canal__perio.html#a19a5efbc817635566e247a28f029d829">source_</a>;
<a name="l00304"></a>00304 <span class="comment">// std::getline(fichier_reprise.get_ifstream(), line);</span>
<a name="l00305"></a>00305                   <span class="keywordflow">if</span> (<a class="code" href="Double_8h.html#ac86f5f350b0f95fd8c34b0ac8d720f6f">est_egal</a>(temps_ecrit,tps_init,1e-5))
<a name="l00306"></a>00306                     {
<a name="l00307"></a>00307                       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Source canal_perio read values in the file &quot;</span> &lt;&lt; filename &lt;&lt; <span class="stringliteral">&quot; for the time t= &quot;</span> &lt;&lt; temps_ecrit &lt;&lt; finl;
<a name="l00308"></a>00308                       time_found = 1;
<a name="l00309"></a>00309                     }
<a name="l00310"></a>00310                 }
<a name="l00311"></a>00311               <span class="keywordflow">if</span> (time_found==0)
<a name="l00312"></a>00312                 {
<a name="l00313"></a>00313                   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Sorry, we didn&#39;t find the time &quot;</span> &lt;&lt; tps_init &lt;&lt; <span class="stringliteral">&quot; in the file &quot;</span> &lt;&lt; filename &lt;&lt; finl;
<a name="l00314"></a>00314                   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;We can&#39;t restart the calculation.&quot;</span> &lt;&lt; finl;
<a name="l00315"></a>00315                   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00316"></a>00316                 }
<a name="l00317"></a>00317             }
<a name="l00318"></a>00318         }
<a name="l00319"></a>00319     }
<a name="l00320"></a>00320 }
<a name="l00321"></a>00321 
<a name="l00322"></a><a class="code" href="classTerme__Source__Canal__perio.html#abad19f18b073f1205edfa830910f1923">00322</a> <span class="keywordtype">double</span> <a class="code" href="classTerme__Source__Canal__perio.html#abad19f18b073f1205edfa830910f1923">Terme_Source_Canal_perio::compute_heat_flux</a>()<span class="keyword"> const</span>
<a name="l00323"></a>00323 <span class="keyword"></span>{
<a name="l00324"></a>00324 <span class="comment">// On recupere flux_bords operateur de diffusion</span>
<a name="l00325"></a>00325   <span class="keyword">const</span> <a class="code" href="classOperateur__base.html" title="classe Operateur_base Classe est la base de la hierarchie des objets representant un operateur utilis...">Operateur_base</a>&amp; op_base = <a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().<a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(0).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>(); <span class="comment">//!&lt; Diffusion operator</span>
<a name="l00326"></a>00326 <span class="comment"></span>  assert(<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classOperateur__Diff__base.html" title="classe Operateur_Diff_base Cette classe est la base de la hierarchie des operateurs representant un t...">Operateur_Diff_base</a>,op_base)); <span class="comment">//!&lt; Check</span>
<a name="l00327"></a>00327 <span class="comment"></span>  <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; flux_bords = op_base.<a class="code" href="classOperateur__base.html#ab547b37ace0f04931f6f09fcfa8fae0c">flux_bords</a>();
<a name="l00328"></a>00328 <span class="comment">// If flux_bords is not build (diffusion_implicit algorithm for example, we calculate it):</span>
<a name="l00329"></a>00329   <span class="keywordflow">if</span> (flux_bords.<a class="code" href="classDoubleVect.html#a392c1f20b462563365389d28e0853867" title="Identique a size_reelle()">size</a>()==0)
<a name="l00330"></a>00330     {
<a name="l00331"></a>00331       <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> dummy(<a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().inconnue().valeurs());
<a name="l00332"></a>00332       <a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().<a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(0).<a class="code" href="classOperateur.html#accdf61cf1e33fb42e9eb06f1c501422b">ajouter</a>(<a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().inconnue(), dummy);
<a name="l00333"></a>00333     }
<a name="l00334"></a>00334 <span class="comment">// Loop on boundaries to evaluate total heat flux:</span>
<a name="l00335"></a>00335   <span class="keywordtype">double</span> heat_flux=0;
<a name="l00336"></a>00336   <span class="keywordtype">int</span> nb_bords = <a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().<a class="code" href="classEquation__base.html#a12d97ae801edc18f614523677921346e" title="Renvoie la zone discretisee associee a l&#39;equation.">zone_dis</a>().<a class="code" href="classDeriv__Zone__dis__base.html#a30ff47fc0684fe134e8c74c35b268941">valeur</a>().<a class="code" href="classZone__dis__base.html#af22167d614644f55591a29c77eb1c009">nb_front_Cl</a>();
<a name="l00337"></a>00337   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n_bord=0; n_bord&lt;nb_bords; n_bord++)
<a name="l00338"></a>00338     {
<a name="l00339"></a>00339       <span class="keyword">const</span> <a class="code" href="classCond__lim.html" title="classe Cond_lim Classe generique servant a representer n&#39;importe quelle classe derivee de la classe C...">Cond_lim</a>&amp; la_cl = <a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().<a class="code" href="classEquation__base.html#af265fe0ea30868eb2176a0c887e4efab" title="Renvoie la zone des conditions aux limite discretisee associee a l&#39;equation.">zone_Cl_dis</a>().<a class="code" href="classDeriv__Zone__Cl__dis__base.html#a6b56880f00b604e1f13970ec6d5bc077">valeur</a>().<a class="code" href="classZone__Cl__dis__base.html#af75e0ed7786863e4d333bfb29d67c323" title="Renvoie la i-ieme condition aux limites. (version const)">les_conditions_limites</a>(n_bord);
<a name="l00340"></a>00340       <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classNeumann__paroi.html" title="Classe Neumann_paroi Cette condition limite correspond a un flux impose pour l&#39;equation de transport ...">Neumann_paroi</a>,la_cl.<a class="code" href="classDeriv__Cond__lim__base.html#a482c910c704f6f51065a8b7d25acf48a">valeur</a>()))
<a name="l00341"></a>00341         {
<a name="l00342"></a>00342 <span class="comment">// Loop on boundary faces with imposed flux condition (Neumann)</span>
<a name="l00343"></a>00343           <span class="keyword">const</span> <a class="code" href="classFront__VF.html" title="class Front_VF">Front_VF</a>&amp; frontiere_dis = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classFront__VF.html" title="class Front_VF">Front_VF</a>,la_cl.<a class="code" href="classCond__lim.html#a5b2d24809cee07727006a891d4ce8d22" title="Appel a l&#39;objet sous-jacent Renvoie la frontiere discretisee associee a la condition aux limites...">frontiere_dis</a>());
<a name="l00344"></a>00344           <span class="keywordtype">int</span> ndeb = frontiere_dis.<a class="code" href="classFront__VF.html#a4986f0c65653fe9eb40bbbff5a97bf16" title="Numero de la premiere face du bord dans la liste des faces.">num_premiere_face</a>();
<a name="l00345"></a>00345           <span class="keywordtype">int</span> nfin = ndeb + frontiere_dis.<a class="code" href="classFront__VF.html#a341e2fcb5117b96e745fd7078ba86bab" title="Nombre de faces reelles du bord.">nb_faces</a>();
<a name="l00346"></a>00346           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> num_face=ndeb; num_face&lt;nfin; num_face++)
<a name="l00347"></a>00347             heat_flux += flux_bords(num_face,0);
<a name="l00348"></a>00348         }
<a name="l00349"></a>00349     }
<a name="l00350"></a>00350   heat_flux=<a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">mp_sum</a>(heat_flux);
<a name="l00351"></a>00351   <span class="keywordflow">return</span> heat_flux;
<a name="l00352"></a>00352 }
<a name="l00353"></a>00353 
<a name="l00354"></a><a class="code" href="classTerme__Source__Canal__perio.html#a03fed41972b95bf16589365f892ef1ea">00354</a> <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> <a class="code" href="classTerme__Source__Canal__perio.html#a03fed41972b95bf16589365f892ef1ea">Terme_Source_Canal_perio::source_convection_diffusion</a>(<span class="keywordtype">double</span> debit_e)<span class="keyword"> const</span>
<a name="l00355"></a>00355 <span class="keyword"></span>{
<a name="l00356"></a>00356 <span class="comment">// Compute heat_flux:</span>
<a name="l00357"></a>00357   <span class="keywordtype">double</span> heat_flux = <a class="code" href="classTerme__Source__Canal__perio.html#abad19f18b073f1205edfa830910f1923">compute_heat_flux</a>();
<a name="l00358"></a>00358 
<a name="l00359"></a>00359   <span class="keyword">const</span> <a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>&amp; zone_vf = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>,<a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().zone_dis().<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>());
<a name="l00360"></a>00360   <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; volume = zone_vf.<a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>().<a class="code" href="classZone.html#ab642027f7a7c19e98f906f0ae007c2b7">volume_total</a>();
<a name="l00361"></a>00361   <span class="keywordtype">int</span> size = zone_vf.<a class="code" href="classZone__VF.html#aede27992d9f2eedd52c24d4a80ff7ffb" title="renvoie le nombre global de faces.">nb_faces</a>();
<a name="l00362"></a>00362   <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> s(size);
<a name="l00363"></a>00363   <span class="keywordflow">if</span> (<a class="code" href="classTerme__Source__Canal__perio.html#abd9a4e32c74f22698393b51bd9ec2092">velocity_weighting_</a>) <span class="comment">//!&lt; It seems this algorithm do not imply dT/dt -&gt; 0</span>
<a name="l00364"></a>00364 <span class="comment"></span>    {
<a name="l00365"></a>00365 <span class="comment">// Compute source term for Energy</span>
<a name="l00366"></a>00366 <span class="comment">// Expression from TU Delft Master Thesis</span>
<a name="l00367"></a>00367 <span class="comment">// Source = -u*Sum(imposed_heat_flux)/(Volume*Ubulk)</span>
<a name="l00368"></a>00368 <span class="comment">// Ubulk=FlowRate/Area(PeriodicBoundary)</span>
<a name="l00369"></a>00369 <span class="comment">// Loop on the faces</span>
<a name="l00370"></a>00370       <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; vitesse = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classConvection__Diffusion__std.html" title="classe Convection_Diffusion_std Cette classe est la base des equations modelisant le transport d&#39;un s...">Convection_Diffusion_std</a>,<a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>()).vitesse_transportante().valeurs();
<a name="l00371"></a>00371       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> num_face=0; num_face&lt;size; num_face++)
<a name="l00372"></a>00372         {
<a name="l00373"></a>00373           <span class="keywordtype">double</span> velocity = 0;
<a name="l00374"></a>00374           <span class="keywordflow">if</span> (<a class="code" href="classTerme__Source__Canal__perio.html#a48eeb00d34b0d2c5116c490eecc175f0">direction_ecoulement_</a>&gt;=0) <span class="comment">//!&lt; Ecoulement selon un axe</span>
<a name="l00375"></a>00375 <span class="comment"></span>            velocity = vitesse(num_face,<a class="code" href="classTerme__Source__Canal__perio.html#a48eeb00d34b0d2c5116c490eecc175f0">direction_ecoulement_</a>);
<a name="l00376"></a>00376           <span class="keywordflow">else</span> <span class="comment">//!&lt; Cas general</span>
<a name="l00377"></a>00377 <span class="comment"></span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; i++)
<a name="l00378"></a>00378               velocity += vitesse(num_face,i) * <a class="code" href="classTerme__Source__Canal__perio.html#af253a8469b355b58214fc2bd66e44184">dir_source_</a>(i);
<a name="l00379"></a>00379           s(num_face)=-velocity*heat_flux/(volume*debit_e/<a class="code" href="classTerme__Source__Canal__perio.html#a789d76f549531aaa07675a8560ed9c5d">surface_bord_</a>);
<a name="l00380"></a>00380         }
<a name="l00381"></a>00381     }
<a name="l00382"></a>00382   <span class="keywordflow">else</span>
<a name="l00383"></a>00383     {
<a name="l00384"></a>00384 <span class="comment">// Compute source term with</span>
<a name="l00385"></a>00385 <span class="comment">// Source = -Sum(imposed_heat_flux)/Volume</span>
<a name="l00386"></a>00386 <span class="comment">// Loop on the faces</span>
<a name="l00387"></a>00387       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> num_face=0; num_face&lt;size; num_face++)
<a name="l00388"></a>00388         s(num_face)=-heat_flux/volume;
<a name="l00389"></a>00389     }
<a name="l00390"></a>00390   <span class="keywordflow">return</span> s;
<a name="l00391"></a>00391 }
<a name="l00392"></a>00392 
<a name="l00393"></a>00393 <span class="comment">//</span>
<a name="l00394"></a>00394 <span class="comment">//</span><span class="comment"></span>
<a name="l00395"></a>00395 <span class="comment">//! Term source calculation (called by VDF and VEF implementations)&lt;br&gt;TODO: returning an ArrOfDouble is baaad.</span>
<a name="l00396"></a><a class="code" href="classTerme__Source__Canal__perio.html#a99a4734085bf7d7ac217963811a97b80">00396</a> <span class="comment"></span><a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> <a class="code" href="classTerme__Source__Canal__perio.html#a99a4734085bf7d7ac217963811a97b80" title="Term source calculation (called by VDF and VEF implementations) TODO: returning an ArrOfDouble is baa...">Terme_Source_Canal_perio::source</a>()<span class="keyword"> const</span>
<a name="l00397"></a>00397 <span class="keyword"></span>{
<a name="l00398"></a>00398   <span class="keywordtype">double</span> tps = <a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a5054df01edb6d4f7baec7e612d423834" title="Renvoie le temps courant.">temps_courant</a>();
<a name="l00399"></a>00399   <span class="keywordtype">double</span> tps_init = <a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a2389e67de1603768ab6b1bd396e0adba" title="Renvoie le temps initial.">temps_init</a>();
<a name="l00400"></a>00400   <span class="keywordtype">double</span> dt = <a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a0e4f67ef6086c09434ddc161668077b2" title="Renvoie le pas de temps (delta_t) courant.">pas_de_temps</a>();
<a name="l00401"></a>00401   <span class="keywordtype">int</span> premiere_ecriture = (!<a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().<a class="code" href="classEquation__base.html#aa8151a96f63719523bf50ddd832e0f8f" title="Renvoie le probleme associe a l&#39;equation.">probleme</a>().<a class="code" href="classProbleme__base.html#acafc48b3c050d6c292bb8395a7904a33">reprise_effectuee</a>() &amp;&amp; <a class="code" href="classTerme__Source__Canal__perio.html#a139d7f05cc38ac30fd7e16f2ac5b854f">deb_</a>==0 ? 1 : 0);
<a name="l00402"></a>00402   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> ext_nom_source_  = <a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().<a class="code" href="classEquation__base.html#aa8151a96f63719523bf50ddd832e0f8f" title="Renvoie le probleme associe a l&#39;equation.">probleme</a>().<a class="code" href="classProbleme__base.html#a58bc0b101f3f3f1d8522a9f41f1fad7b" title="surcharge Objet_U::le_nom() Renvoie le nom du probleme">le_nom</a>();
<a name="l00403"></a>00403   ext_nom_source_ +=  <span class="stringliteral">&quot;_&quot;</span> ;
<a name="l00404"></a>00404   ext_nom_source_ +=  <a class="code" href="classTerme__Source__Canal__perio.html#acf1d044692e7f1f680cb81f670058e75">bord_periodique_</a> ;
<a name="l00405"></a>00405 
<a name="l00406"></a>00406 <span class="comment">// Pourquoi ?</span>
<a name="l00407"></a>00407   <span class="keywordflow">if</span> (<a class="code" href="Double_8h.html#a07be18d5898a837a4a609ddb08e37d50">est_different</a>(<a class="code" href="classTerme__Source__Canal__perio.html#afb8a2ba8c530e8b586bf9dcc004b8ea6">dernier_temps_calc_</a>,tps))
<a name="l00408"></a>00408     {
<a name="l00409"></a>00409 <span class="comment">// Compte flow rate:</span>
<a name="l00410"></a>00410       <span class="keywordtype">double</span> debit_e= 0.;
<a name="l00411"></a>00411       <a class="code" href="classTerme__Source__Canal__perio.html#a03d9606798a9a888482eb79c5f319bce">calculer_debit</a>(debit_e);
<a name="l00412"></a>00412 
<a name="l00413"></a>00413       <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">je_suis_maitre</a>())
<a name="l00414"></a>00414         {
<a name="l00415"></a>00415           <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classConvection__Diffusion__std.html" title="classe Convection_Diffusion_std Cette classe est la base des equations modelisant le transport d&#39;un s...">Convection_Diffusion_std</a>,<a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>()))
<a name="l00416"></a>00416             {
<a name="l00417"></a>00417 <span class="comment">// Write nothing if equation is Energy</span>
<a name="l00418"></a>00418             }
<a name="l00419"></a>00419           <span class="keywordflow">else</span>
<a name="l00420"></a>00420             <a class="code" href="classTerme__Source__Canal__perio.html#ad43a03ff6f494802d799403f183c013b">write_flow_rate</a>(ext_nom_source_, debit_e);
<a name="l00421"></a>00421         }
<a name="l00422"></a>00422       <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classConvection__Diffusion__std.html" title="classe Convection_Diffusion_std Cette classe est la base des equations modelisant le transport d&#39;un s...">Convection_Diffusion_std</a>,<a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>()))
<a name="l00423"></a>00423         {
<a name="l00424"></a>00424           <span class="keywordflow">if</span> (<a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().probleme().is_dilatable())
<a name="l00425"></a>00425             {
<a name="l00426"></a>00426               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Source term not validated yet for Quasi Compressible formulation.&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00427"></a>00427               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Contact TRUST support.&quot;</span> &lt;&lt; finl;
<a name="l00428"></a>00428               <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00429"></a>00429             }
<a name="l00430"></a>00430           <span class="keywordflow">if</span>(<a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().schema_temps().pas_de_temps_locaux().size()&gt;0)
<a name="l00431"></a>00431             {
<a name="l00432"></a>00432               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Source term not validated yet for steady option for the Convection_Diffusion_std equation.&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00433"></a>00433               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Contact TRUST support.&quot;</span> &lt;&lt; finl;
<a name="l00434"></a>00434               <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00435"></a>00435             }
<a name="l00436"></a>00436           <span class="keywordflow">return</span> <a class="code" href="classTerme__Source__Canal__perio.html#a03fed41972b95bf16589365f892ef1ea">source_convection_diffusion</a>(debit_e);
<a name="l00437"></a>00437         }
<a name="l00438"></a>00438       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classNavier__Stokes__std.html" title="classe Navier_Stokes_std Cette classe porte les termes de l&#39;equation de la dynamique pour un fluide s...">Navier_Stokes_std</a>,<a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>()))
<a name="l00439"></a>00439         {
<a name="l00440"></a>00440 <span class="comment">// Compute source term for Navier Stokes</span>
<a name="l00441"></a>00441 
<a name="l00442"></a>00442 <span class="comment">// Master process sends values to all processes:</span>
<a name="l00443"></a>00443           <a class="code" href="communications_8cpp.html#a2335b36078ae87e23dab400a6e129a3c">envoyer_broadcast</a>(<a class="code" href="classTerme__Source__Canal__perio.html#aeccf53a0c9a1811c9b50a0da72f9f960">debit_ref_</a>, 0);
<a name="l00444"></a>00444           <a class="code" href="communications_8cpp.html#a2335b36078ae87e23dab400a6e129a3c">envoyer_broadcast</a>(<a class="code" href="classTerme__Source__Canal__perio.html#a1fec005e754130660b6f6f3698f61b4a">debnm1_</a>, 0);
<a name="l00445"></a>00445           <a class="code" href="communications_8cpp.html#a2335b36078ae87e23dab400a6e129a3c">envoyer_broadcast</a>(<a class="code" href="classTerme__Source__Canal__perio.html#a19a5efbc817635566e247a28f029d829">source_</a>, 0);
<a name="l00446"></a>00446 
<a name="l00447"></a>00447 <span class="comment">// On conserve le test (avec dt_min) car appel a t=0 (dt=0) au cours de preparer calculer pour loi de paroi TBLE</span>
<a name="l00448"></a>00448           <span class="keywordtype">double</span> dt_min = <a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a38ad73d948a5c4e103e4e0b486356ab8" title="Renvoie le pas de temps minimum. (version const)">pas_temps_min</a>();
<a name="l00449"></a>00449           <span class="keyword">const</span> <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; dt_locaux = <a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a6cbfb97317e3d5fc32d132e69c842ada">pas_de_temps_locaux</a>();
<a name="l00450"></a>00450           <span class="keywordtype">double</span> si = 0;
<a name="l00451"></a>00451           <span class="keywordflow">if</span> (<a class="code" href="Double_8h.html#aa94d2a4492697180a3d60541af045e12">sup_ou_egal</a>(dt,dt_min))
<a name="l00452"></a>00452             {
<a name="l00453"></a>00453 <span class="comment">// si = [ 2*(Q(0)-Q(t(n))) - (Q(0)-Q(t(n-1))) ] / [ coeff * dt * aire(bord) ]</span>
<a name="l00454"></a>00454               <span class="keywordflow">if</span>( dt_locaux.<a class="code" href="classDoubleVect.html#a392c1f20b462563365389d28e0853867" title="Identique a size_reelle()">size</a>()&gt;0)
<a name="l00455"></a>00455                 {
<a name="l00456"></a>00456                   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Periodic BC plus source term not validated yet for steady option.&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00457"></a>00457                   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Contact TRUST support.&quot;</span> &lt;&lt; finl;
<a name="l00458"></a>00458                   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00459"></a>00459 
<a name="l00460"></a>00460 <span class="comment">// du au fait que ce calcul implique une division par dt, dans le cas ou le dt est variable par face,</span>
<a name="l00461"></a>00461 <span class="comment">// calculer_debit(debit_e) renvoye [ 2*(Q(0)-Q(t(n))) - (Q(0)-Q(t(n-1))) ]/dt_locaux</span>
<a name="l00462"></a>00462                   si = debit_e/(<a class="code" href="classTerme__Source__Canal__perio.html#abaf6516c14242e27e7766becd9c7acdf">coeff</a>*<a class="code" href="classTerme__Source__Canal__perio.html#a789d76f549531aaa07675a8560ed9c5d">surface_bord_</a>);
<a name="l00463"></a>00463                 }
<a name="l00464"></a>00464               <span class="keywordflow">else</span>
<a name="l00465"></a>00465                 {
<a name="l00466"></a>00466                   si = (2.*(<a class="code" href="classTerme__Source__Canal__perio.html#aeccf53a0c9a1811c9b50a0da72f9f960">debit_ref_</a>-debit_e)-(<a class="code" href="classTerme__Source__Canal__perio.html#aeccf53a0c9a1811c9b50a0da72f9f960">debit_ref_</a>-<a class="code" href="classTerme__Source__Canal__perio.html#a1fec005e754130660b6f6f3698f61b4a">debnm1_</a>))/(<a class="code" href="classTerme__Source__Canal__perio.html#abaf6516c14242e27e7766becd9c7acdf">coeff</a>*dt*<a class="code" href="classTerme__Source__Canal__perio.html#a789d76f549531aaa07675a8560ed9c5d">surface_bord_</a>);
<a name="l00467"></a>00467                   <a class="code" href="classTerme__Source__Canal__perio.html#a1fec005e754130660b6f6f3698f61b4a">debnm1_</a> = debit_e;
<a name="l00468"></a>00468                 }
<a name="l00469"></a>00469             }
<a name="l00470"></a>00470 
<a name="l00471"></a>00471           <a class="code" href="classTerme__Source__Canal__perio.html#a19a5efbc817635566e247a28f029d829">source_</a> += si;
<a name="l00472"></a>00472           <a class="code" href="classTerme__Source__Canal__perio.html#afb8a2ba8c530e8b586bf9dcc004b8ea6">dernier_temps_calc_</a> = tps;
<a name="l00473"></a>00473 
<a name="l00474"></a>00474           <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">je_suis_maitre</a>())
<a name="l00475"></a>00475             {
<a name="l00476"></a>00476 <span class="comment">// Write the pressure gradient file if equation is Navier Stokes</span>
<a name="l00477"></a>00477               <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> filename(<a class="code" href="classObjet__U.html#a7c27c4f80259eeef76ff8fe2d3bc61f7" title="Renvoie une reference constante vers le nom du cas. Cette methode est statique.">nom_du_cas</a>());
<a name="l00478"></a>00478               filename+=<span class="stringliteral">&quot;_Pressure_Gradient_&quot;</span>;
<a name="l00479"></a>00479               filename+= ext_nom_source_ ;
<a name="l00480"></a>00480               <span class="keywordflow">if</span> (!<a class="code" href="classTerme__Source__Canal__perio.html#abcf057b20bd97c455140c746695b6fe2">pressure_gradient_file_</a>.<a class="code" href="classSortie__Fichier__base.html#acc0244cc2feedba886b643e9b3c295db">is_open</a>())
<a name="l00481"></a>00481                 {
<a name="l00482"></a>00482                   <a class="code" href="classTerme__Source__Canal__perio.html#abcf057b20bd97c455140c746695b6fe2">pressure_gradient_file_</a>.<a class="code" href="classSortie__Fichier__base.html#a7e75e18ed580cd4d45912ec202caa2b2">ouvrir</a>(filename, (premiere_ecriture?ios::out:ios::app));
<a name="l00483"></a>00483                   <a class="code" href="classTerme__Source__Canal__perio.html#abcf057b20bd97c455140c746695b6fe2">pressure_gradient_file_</a>.<a class="code" href="classSortie__Fichier__base.html#a5ddd834ca9c766c24cc608cd03ef0e96">setf</a>(ios::scientific);
<a name="l00484"></a>00484                 }
<a name="l00485"></a>00485               <span class="keywordflow">if</span> ((tps &lt;= (tps_init+dt)) &amp;&amp; premiere_ecriture)
<a name="l00486"></a>00486                 {
<a name="l00487"></a>00487                   <span class="keywordflow">if</span> (<a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().probleme().is_dilatable()==1)
<a name="l00488"></a>00488                     <a class="code" href="classTerme__Source__Canal__perio.html#abcf057b20bd97c455140c746695b6fe2">pressure_gradient_file_</a> &lt;&lt; <span class="stringliteral">&quot;# Time t     gradP(t)      gradP(t)-gradP(t-dt) in [kg.s-2.m-2] if SI units used&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00489"></a>00489                   <span class="keywordflow">else</span>
<a name="l00490"></a>00490                     <a class="code" href="classTerme__Source__Canal__perio.html#abcf057b20bd97c455140c746695b6fe2">pressure_gradient_file_</a> &lt;&lt; <span class="stringliteral">&quot;# Time t     gradP(t)      gradP(t)-gradP(t-dt) in [m.s-2] if SI units used&quot;</span> &lt;&lt; finl;
<a name="l00491"></a>00491                 }
<a name="l00492"></a>00492               <a class="code" href="classTerme__Source__Canal__perio.html#abcf057b20bd97c455140c746695b6fe2">pressure_gradient_file_</a> &lt;&lt; tps+dt &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="classTerme__Source__Canal__perio.html#a19a5efbc817635566e247a28f029d829">source_</a> &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; si &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00493"></a>00493 
<a name="l00494"></a>00494 <span class="comment">// Write the restart file:</span>
<a name="l00495"></a>00495               filename=<a class="code" href="classObjet__U.html#a7c27c4f80259eeef76ff8fe2d3bc61f7" title="Renvoie une reference constante vers le nom du cas. Cette methode est statique.">nom_du_cas</a>();
<a name="l00496"></a>00496               filename+=<span class="stringliteral">&quot;_Channel_Flow_Rate_repr_&quot;</span>;
<a name="l00497"></a>00497               filename+=ext_nom_source_;
<a name="l00498"></a>00498               <span class="keywordflow">if</span> (!<a class="code" href="classTerme__Source__Canal__perio.html#a264e789ae89731e3ffba889ac396920e">restart_file_</a>.<a class="code" href="classSortie__Fichier__base.html#acc0244cc2feedba886b643e9b3c295db">is_open</a>())
<a name="l00499"></a>00499                 {
<a name="l00500"></a>00500                   <a class="code" href="classTerme__Source__Canal__perio.html#a264e789ae89731e3ffba889ac396920e">restart_file_</a>.<a class="code" href="classSortie__Fichier__base.html#a7e75e18ed580cd4d45912ec202caa2b2">ouvrir</a>(filename, (premiere_ecriture?ios::out:ios::app));
<a name="l00501"></a>00501                   <a class="code" href="classTerme__Source__Canal__perio.html#a264e789ae89731e3ffba889ac396920e">restart_file_</a>.<a class="code" href="classSortie__Fichier__base.html#a5ddd834ca9c766c24cc608cd03ef0e96">setf</a>(ios::scientific);
<a name="l00502"></a>00502                 }
<a name="l00503"></a>00503               <span class="keywordflow">if</span> ((tps &lt;= (tps_init+dt)) &amp;&amp; premiere_ecriture)
<a name="l00504"></a>00504                 {
<a name="l00505"></a>00505                   <span class="keywordflow">if</span> (<a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().probleme().is_dilatable()==1)
<a name="l00506"></a>00506                     <a class="code" href="classTerme__Source__Canal__perio.html#a264e789ae89731e3ffba889ac396920e">restart_file_</a> &lt;&lt; <span class="stringliteral">&quot;# Time t       Flow rate Q(t)    Flow rate Q(0) in [kg.s-1]   gradP(t) in [kg.s-2.m-2] if SI units used&quot;</span> &lt;&lt; finl;
<a name="l00507"></a>00507                   <span class="keywordflow">else</span>
<a name="l00508"></a>00508                     <a class="code" href="classTerme__Source__Canal__perio.html#a264e789ae89731e3ffba889ac396920e">restart_file_</a> &lt;&lt; <span class="stringliteral">&quot;# Time t       Flow rate Q(t)    Flow rate Q(0) in [m3.s-1]   gradP(t) in [m.s-2] if SI units used&quot;</span> &lt;&lt; finl;
<a name="l00509"></a>00509                 }
<a name="l00510"></a>00510               <a class="code" href="classTerme__Source__Canal__perio.html#a264e789ae89731e3ffba889ac396920e">restart_file_</a> &lt;&lt; tps+dt &lt;&lt; <span class="stringliteral">&quot;   &quot;</span> &lt;&lt;  debit_e &lt;&lt; <span class="stringliteral">&quot;      &quot;</span> &lt;&lt; <a class="code" href="classTerme__Source__Canal__perio.html#aeccf53a0c9a1811c9b50a0da72f9f960">debit_ref_</a> &lt;&lt; <span class="stringliteral">&quot;                 &quot;</span> &lt;&lt; <a class="code" href="classTerme__Source__Canal__perio.html#a19a5efbc817635566e247a28f029d829">source_</a> &lt;&lt; finl;
<a name="l00511"></a>00511             }
<a name="l00512"></a>00512         }
<a name="l00513"></a>00513       <span class="keywordflow">else</span>
<a name="l00514"></a>00514         {
<a name="l00515"></a>00515           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;You can&#39;t use canal_perio on the equation &quot;</span> &lt;&lt; <a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00516"></a>00516           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00517"></a>00517         }
<a name="l00518"></a>00518     }
<a name="l00519"></a>00519   <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classConvection__Diffusion__std.html" title="classe Convection_Diffusion_std Cette classe est la base des equations modelisant le transport d&#39;un s...">Convection_Diffusion_std</a>,<a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>()))
<a name="l00520"></a>00520     {
<a name="l00521"></a>00521       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error! Contact TRUST support.&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00522"></a>00522       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00523"></a>00523     }
<a name="l00524"></a>00524 
<a name="l00525"></a>00525 <span class="comment">// Essayer de virer direction_ecoulement_ (attention assert en VDF et ecarts possibles)</span>
<a name="l00526"></a>00526   <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> s;
<a name="l00527"></a>00527   s.<a class="code" href="classArrOfDouble.html#aa5d7035f2e4f451c484aabd5dffb873b" title="appel a ArrOfDouble::resize_array()">resize</a>(<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>);
<a name="l00528"></a>00528   s = 0.;
<a name="l00529"></a>00529   <span class="keywordflow">if</span> (<a class="code" href="classTerme__Source__Canal__perio.html#a48eeb00d34b0d2c5116c490eecc175f0">direction_ecoulement_</a>&gt;=0) <span class="comment">//!&lt; Ecoulement selon un axe</span>
<a name="l00530"></a>00530 <span class="comment"></span>    s(<a class="code" href="classTerme__Source__Canal__perio.html#a48eeb00d34b0d2c5116c490eecc175f0">direction_ecoulement_</a>) = <a class="code" href="classTerme__Source__Canal__perio.html#a19a5efbc817635566e247a28f029d829">source_</a>;
<a name="l00531"></a>00531   <span class="keywordflow">else</span> <span class="comment">//!&lt; Cas general</span>
<a name="l00532"></a>00532 <span class="comment"></span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; i++)
<a name="l00533"></a>00533       s(i) = <a class="code" href="classTerme__Source__Canal__perio.html#a19a5efbc817635566e247a28f029d829">source_</a> * <a class="code" href="classTerme__Source__Canal__perio.html#af253a8469b355b58214fc2bd66e44184">dir_source_</a>(i);
<a name="l00534"></a>00534   <span class="keywordflow">return</span> s;
<a name="l00535"></a>00535 }
<a name="l00536"></a>00536 
<a name="l00537"></a>00537 
<a name="l00538"></a><a class="code" href="classTerme__Source__Canal__perio.html#a8048d704a33ff2fd82a5b116e3ac7a34">00538</a> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; <a class="code" href="classTerme__Source__Canal__perio.html#a8048d704a33ff2fd82a5b116e3ac7a34">Terme_Source_Canal_perio::calculer</a>(<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; resu)<span class="keyword"> const</span>
<a name="l00539"></a>00539 <span class="keyword"></span>{
<a name="l00540"></a>00540   resu = 0;
<a name="l00541"></a>00541   <span class="keywordflow">return</span> <a class="code" href="classSource__base.html#a0cb255c8873be7d138a8589a08931e05">ajouter</a>(resu);
<a name="l00542"></a>00542 }
<a name="l00543"></a>00543 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:35 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
