<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/Kernel/Geometrie/Raffiner_isotrope_parallele.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/Kernel/Geometrie/Raffiner_isotrope_parallele.cpp</div>  </div>
</div>
<div class="contents">
<a href="Raffiner__isotrope__parallele_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (c) 2021, CEA</span>
<a name="l00003"></a>00003 <span class="comment">* All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment">* 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00007"></a>00007 <span class="comment">* 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00008"></a>00008 <span class="comment">* 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<a name="l00011"></a>00011 <span class="comment">* IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;</span>
<a name="l00012"></a>00012 <span class="comment">* OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// File:        Raffiner_isotrope_parallele.cpp</span>
<a name="l00018"></a>00018 <span class="comment">// Directory:   $TRUST_ROOT/src/Kernel/Geometrie</span>
<a name="l00019"></a>00019 <span class="comment">// Version:     1</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;<a class="code" href="Raffiner__isotrope__parallele_8h.html">Raffiner_isotrope_parallele.h</a>&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="Param_8h.html">Param.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="LecFicDistribue_8h.html">LecFicDistribue.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="Nom_8h.html">Nom.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="Domaine_8h.html">Domaine.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="Scatter_8h.html">Scatter.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="Statistiques_8h.html">Statistiques.h</a>&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;<a class="code" href="SFichier_8h.html">SFichier.h</a>&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;<a class="code" href="EcrFicCollecte_8h.html">EcrFicCollecte.h</a>&gt;</span>
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;<a class="code" href="DoubleTabs_8h.html">DoubleTabs.h</a>&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;<a class="code" href="Schema__Comm_8h.html">Schema_Comm.h</a>&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;<a class="code" href="Vect__ArrOfInt_8h.html">Vect_ArrOfInt.h</a>&gt;</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;<a class="code" href="FichierHDFPar_8h.html">FichierHDFPar.h</a>&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;<a class="code" href="LecFicDiffuse_8h.html">LecFicDiffuse.h</a>&gt;</span>
<a name="l00039"></a>00039 
<a name="l00040"></a><a class="code" href="Raffiner__isotrope__parallele_8cpp.html#aec4f6c9598b1bca6b3778c8c92239405">00040</a> <a class="code" href="Op__Diff__CoviMAC__Face_8cpp.html#aa86ec8ba612a969d9b4370b775037144">Implemente_instanciable</a>( <a class="code" href="classRaffiner__isotrope__parallele.html" title=": class Raffiner_isotrope_parallele &lt;Description of class Raffiner_isotrope_parallele&gt;">Raffiner_isotrope_parallele</a>, <span class="stringliteral">&quot;Raffiner_isotrope_parallele&quot;</span>, <a class="code" href="classRaffiner__Simplexes.html" title=": class Raffiner_Simplexes &lt;Description of class Raffiner_Simplexes&gt;">Raffiner_Simplexes</a> ) ;
<a name="l00041"></a>00041 
<a name="l00042"></a><a class="code" href="classRaffiner__isotrope__parallele.html#ae472488a39dcb92fee29646568031002">00042</a> <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classRaffiner__isotrope__parallele.html#ae472488a39dcb92fee29646568031002" title="Ecriture de l&#39;objet sur un flot de sortie Methode a surcharger.">Raffiner_isotrope_parallele::printOn</a>( <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os )<span class="keyword"> const</span>
<a name="l00043"></a>00043 <span class="keyword"></span>{
<a name="l00044"></a>00044   <a class="code" href="classRaffiner__isotrope__parallele.html#ae472488a39dcb92fee29646568031002" title="Ecriture de l&#39;objet sur un flot de sortie Methode a surcharger.">Raffiner_Simplexes::printOn</a>( os );
<a name="l00045"></a>00045   <span class="keywordflow">return</span> os;
<a name="l00046"></a>00046 }
<a name="l00047"></a>00047 
<a name="l00048"></a><a class="code" href="classRaffiner__isotrope__parallele.html#a6712d95a22619f287dbafbbb53782597">00048</a> <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classRaffiner__isotrope__parallele.html#a6712d95a22619f287dbafbbb53782597" title="Lecture d&#39;un Objet_U sur un flot d&#39;entree Methode a surcharger.">Raffiner_isotrope_parallele::readOn</a>( <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is )
<a name="l00049"></a>00049 {
<a name="l00050"></a>00050   <a class="code" href="classRaffiner__isotrope__parallele.html#a6712d95a22619f287dbafbbb53782597" title="Lecture d&#39;un Objet_U sur un flot d&#39;entree Methode a surcharger.">Raffiner_Simplexes::readOn</a>( is );
<a name="l00051"></a>00051   <span class="keywordflow">return</span> is;
<a name="l00052"></a>00052 }
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 
<a name="l00055"></a><a class="code" href="Raffiner__isotrope__parallele_8cpp.html#a63b101870cca816d98451d43b3f69810">00055</a> <span class="keywordtype">void</span> <a class="code" href="Raffiner__isotrope__parallele_8cpp.html#a63b101870cca816d98451d43b3f69810">mon_construire_correspondance_items_par_coordonnees</a>(<a class="code" href="classJoints.html" title="Classe Joints Cette classe represente une liste d&#39;objet de type Joint.">Joints</a>&amp; joints, <span class="keyword">const</span> <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926">Joint::Type_Item</a> type_item, <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; coord_items)
<a name="l00056"></a>00056 {
<a name="l00057"></a>00057   <span class="keywordflow">switch</span>(type_item)
<a name="l00058"></a>00058     {
<a name="l00059"></a>00059     <span class="keywordflow">case</span> <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>:
<a name="l00060"></a>00060       ;
<a name="l00061"></a>00061       <span class="keywordflow">break</span>;
<a name="l00062"></a>00062     <span class="keywordflow">case</span> <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a7816c69408b98e1161f1f54e7b6b1cb4">Joint::ARETE</a>:
<a name="l00063"></a>00063       ;
<a name="l00064"></a>00064       <span class="keywordflow">break</span>;
<a name="l00065"></a>00065     <span class="keywordflow">default</span>:
<a name="l00066"></a>00066       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Scatter::construire_correspondance_items_par_coordonnees unusable for item &quot;</span>
<a name="l00067"></a>00067            &lt;&lt; (int)type_item
<a name="l00068"></a>00068            &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00069"></a>00069       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00070"></a>00070     }
<a name="l00071"></a>00071   <span class="keyword">const</span> <span class="keywordtype">int</span> dim = <a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">Objet_U::dimension</a>;
<a name="l00072"></a>00072   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_joints = joints.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>();
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 <span class="comment">// Indices des items de joints dans le domaine sur mon processeur</span>
<a name="l00075"></a>00075   <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>)  indices_items_locaux(nb_joints);
<a name="l00076"></a>00076 <span class="comment">// Indices des items de joints dans le domaine sur le processeur voisin</span>
<a name="l00077"></a>00077   <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>)  indices_items_distants(nb_joints);
<a name="l00078"></a>00078 <span class="comment">// Coordonnees des items correspondants (dans le meme ordre que indices_items_xxx)</span>
<a name="l00079"></a>00079   <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>) coord_items_locaux(nb_joints);
<a name="l00080"></a>00080   <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>) coord_items_distants(nb_joints);
<a name="l00081"></a>00081 
<a name="l00082"></a>00082 <span class="comment">// Remplissage des tableaux indices_items_locaux</span>
<a name="l00083"></a>00083 <span class="comment">// et coord_items_locaux</span>
<a name="l00084"></a>00084   {
<a name="l00085"></a>00085     <span class="keywordtype">int</span> i_joint;
<a name="l00086"></a>00086     <span class="keywordflow">for</span> (i_joint = 0; i_joint &lt; nb_joints; i_joint++)
<a name="l00087"></a>00087       {
<a name="l00088"></a>00088         <span class="keyword">const</span> <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp; joint = joints[i_joint];
<a name="l00089"></a>00089         <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; items = indices_items_locaux[i_joint];
<a name="l00090"></a>00090 <span class="comment">// Remarque: **LISTE_TRI** les indices_items_locaux sont</span>
<a name="l00091"></a>00091 <span class="comment">// tries dans l&#39;ordre croissant:</span>
<a name="l00092"></a>00092 <span class="comment">// Scatter::calculer_liste_complete_items_joint(joint, type_item, items);</span>
<a name="l00093"></a>00093         items = joint.<a class="code" href="classJoint.html#a3f49fb1150967b436a115a7373ab27a0" title="Renvoie les informations de joint pour le type demande.">joint_item</a>(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>).<a class="code" href="classJoint__Items.html#a435fb1629f6dafb089605913517e73c4" title="Voir items_communs_.">items_communs</a>();
<a name="l00094"></a>00094         <span class="keyword">const</span> <span class="keywordtype">int</span> n       = items.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00095"></a>00095         <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp;   coord   = coord_items_locaux[i_joint];
<a name="l00096"></a>00096         <span class="keywordtype">int</span> i, j;
<a name="l00097"></a>00097         coord.<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(n, dim);
<a name="l00098"></a>00098         <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)
<a name="l00099"></a>00099           <span class="keywordflow">for</span> (j = 0; j &lt; dim; j++)
<a name="l00100"></a>00100             coord(i,j) = coord_items(items[i], j);
<a name="l00101"></a>00101       }
<a name="l00102"></a>00102   }
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 <span class="comment">// Envoi des indices et coordonnees locaux au processeur voisin</span>
<a name="l00105"></a>00105   {
<a name="l00106"></a>00106     <a class="code" href="classSchema__Comm.html">Schema_Comm</a> schema_comm;
<a name="l00107"></a>00107     <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> liste_pe_voisins(nb_joints);
<a name="l00108"></a>00108     <span class="keywordtype">int</span> i;
<a name="l00109"></a>00109     <span class="keywordflow">for</span> (i = 0; i &lt; nb_joints; i++)
<a name="l00110"></a>00110       liste_pe_voisins[i] = joints[i].PEvoisin();
<a name="l00111"></a>00111     schema_comm.<a class="code" href="classSchema__Comm.html#ad11c9b47999c294c26ae4df8d2bbd57b" title="Definit la liste des processeurs a qui on va envoyer et de qui on va recevoir des donnees...">set_send_recv_pe_list</a>(liste_pe_voisins, liste_pe_voisins);
<a name="l00112"></a>00112     schema_comm.<a class="code" href="classSchema__Comm.html#ac617b53de22748cdd9fa30a0cfd0f4a8" title="Statut passe a WRITING Autorise si status_ == WRITING:">begin_comm</a>();
<a name="l00113"></a>00113     <span class="keywordflow">for</span> (i = 0; i &lt; nb_joints; i++)
<a name="l00114"></a>00114       {
<a name="l00115"></a>00115         <span class="keyword">const</span> <span class="keywordtype">int</span> pe = liste_pe_voisins[i];
<a name="l00116"></a>00116         <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; buffer = schema_comm.<a class="code" href="classSchema__Comm.html#a6c771eae3b46250ae0d2f0126a7d8065" title="renvoie le buffer correspondant au processeur num_PE pour y entasser des donnees a envoyer...">send_buffer</a>(pe);
<a name="l00117"></a>00117         buffer &lt;&lt; indices_items_locaux[i];
<a name="l00118"></a>00118         buffer &lt;&lt; coord_items_locaux[i];
<a name="l00119"></a>00119       }
<a name="l00120"></a>00120     schema_comm.<a class="code" href="classSchema__Comm.html#abca0e8ac6c2b742d26f3cfaee0690c72" title="Statut passe a EXCHANGED.">echange_taille_et_messages</a>();
<a name="l00121"></a>00121     <span class="keywordflow">for</span> (i = 0; i &lt; nb_joints; i++)
<a name="l00122"></a>00122       {
<a name="l00123"></a>00123         <span class="keyword">const</span> <span class="keywordtype">int</span> pe = liste_pe_voisins[i];
<a name="l00124"></a>00124         <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; buffer = schema_comm.<a class="code" href="classSchema__Comm.html#a0c056eb81ab8fd513912b336b4d13a1a" title="renvoie le buffer correspondant au processeur num_PE pour y lire les donnees recues. Le schema doit etre dans l&#39;etat EXCHANGED.">recv_buffer</a>(pe);
<a name="l00125"></a>00125         buffer &gt;&gt; indices_items_distants[i];
<a name="l00126"></a>00126         buffer &gt;&gt; coord_items_distants[i];
<a name="l00127"></a>00127       }
<a name="l00128"></a>00128     schema_comm.<a class="code" href="classSchema__Comm.html#a73a981f88b6ffebc150fb46c5cce75d9" title="Statut passe a RESET Accesseurs:">end_comm</a>();
<a name="l00129"></a>00129   }
<a name="l00130"></a>00130 
<a name="l00131"></a>00131 <span class="comment">// Boucle sur les joints</span>
<a name="l00132"></a>00132   {
<a name="l00133"></a>00133 <span class="comment">// Cette fois, on modifie les joints (remplissage de renum_virt_loc)</span>
<a name="l00134"></a>00134 <span class="comment">// const int moi = Process::me();</span>
<a name="l00135"></a>00135     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_joint = 0; i_joint &lt; nb_joints; i_joint++)
<a name="l00136"></a>00136       {
<a name="l00137"></a>00137         <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp;           joint           = joints[i_joint];
<a name="l00138"></a>00138         <span class="keyword">const</span> <span class="keywordtype">int</span>     PEvoisin        = joint.<a class="code" href="classJoint.html#a0952bc5c7805434ccd8cd5c9b01e3747" title="Renvoie PEvoisin (numero de la zone voisine)">PEvoisin</a>();
<a name="l00139"></a>00139         <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; indices_locaux  = indices_items_locaux[i_joint];
<a name="l00140"></a>00140 <span class="comment">// ArrOfInt &amp;       indices_distants= indices_items_distants[i_joint];</span>
<a name="l00141"></a>00141         <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; coord_locaux    = coord_items_locaux[i_joint];
<a name="l00142"></a>00142         <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; coord_distants  = coord_items_distants[i_joint];
<a name="l00143"></a>00143         <span class="keyword">const</span> <span class="keywordtype">int</span> n = indices_locaux.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00144"></a>00144         <span class="comment">/*</span>
<a name="l00145"></a>00145 <span class="comment">          if (n != indices_distants.size_array()) {</span>
<a name="l00146"></a>00146 <span class="comment">          Cerr &lt;&lt; &quot;Error in Scatter::remplir_renum_virt_loc on PE &quot;</span>
<a name="l00147"></a>00147 <span class="comment">          &lt;&lt; Process::me();</span>
<a name="l00148"></a>00148 <span class="comment">          Cerr &lt;&lt; &quot;\n Joint with PE &quot; &lt;&lt; joint.PEvoisin()</span>
<a name="l00149"></a>00149 <span class="comment">          &lt;&lt; &quot;\n Number of items &quot; &lt;&lt; type_item &lt;&lt; &quot; on my joint : &quot; &lt;&lt; n;</span>
<a name="l00150"></a>00150 <span class="comment">          Cerr &lt;&lt; &quot;\n Number of items &quot; &lt;&lt; type_item &lt;&lt; &quot; on the remote joint : &quot;</span>
<a name="l00151"></a>00151 <span class="comment">          &lt;&lt; indices_distants.size_array()</span>
<a name="l00152"></a>00152 <span class="comment">          &lt;&lt; finl;</span>
<a name="l00153"></a>00153 <span class="comment">          exit();</span>
<a name="l00154"></a>00154 <span class="comment">          } */</span>
<a name="l00155"></a>00155 <span class="comment">// Recherche des correspondances entre items</span>
<a name="l00156"></a>00156         <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> corresp(n);
<a name="l00157"></a>00157         <span class="keyword">const</span> <span class="keywordtype">double</span> epsilon = <a class="code" href="classObjet__U.html#a7447e25c68cc8d3a1c06cf99f0565cff">Objet_U::precision_geom</a>;
<a name="l00158"></a>00158         <span class="keywordtype">int</span> nbsomr=<a class="code" href="classScatter.html#a16a9000e31ccecd2438c8f05e41cc302" title="Construit le tableau &quot;correspondance&quot; tel que Pour 0 &lt;= i &lt; sommets2.size_array(), Si sommet2(i) existe dans le tableau sommet1, alors sommets2(i, ...) == sommets1(correspondance[i], ...) Sinon correspondance[i] = -1 L&#39;egalite est verifiee a epsilon pres en absolu (soit abs(x1-x2)&lt;epsilon) L&#39;algorithme est generalement en n1*log(n1) + n2*log(n1) (recherche basee sur un quicksort). En cas d&#39;echec du tri, on utilise un algorithme en n1*n2. Les tableaux sommets1 et sommets2 doivent etre de dimension 2 Le tableau correspondance doit etre de taille sommets2.size_array(). Valeur de retour: nombre de sommets de sommets2 non trouves dans le tableau sommets1.">Scatter::Chercher_Correspondance</a>(coord_distants, coord_locaux, corresp, epsilon);
<a name="l00159"></a>00159         <span class="keywordflow">if</span> (nbsomr)
<a name="l00160"></a>00160           {
<a name="l00161"></a>00161             <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;iiiiiiiiiiii&quot;</span>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00162"></a>00162 <span class="comment">// abort();</span>
<a name="l00163"></a>00163           }
<a name="l00164"></a>00164         <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; items_communs = joint.<a class="code" href="classJoint.html#aa1c4d729a3017082d26907d82ad1d7de" title="Renvoie les informations de joint pour un type d&#39;item geometrique donne, pour remplissage des structu...">set_joint_item</a>(type_item).<a class="code" href="classJoint__Items.html#aa01c4601d506c658f4f1d45e66951ce0" title="Renvoie le tableau items_communs_ pour le remplir. (BM: ce tableau n&#39;est pas encore rempli)...">set_items_communs</a>();
<a name="l00165"></a>00165         <span class="keywordtype">int</span> nb_items_communs_trouves=0;
<a name="l00166"></a>00166         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; n; k++)
<a name="l00167"></a>00167           <span class="keywordflow">if</span> (corresp[k]&gt;=0)
<a name="l00168"></a>00168             nb_items_communs_trouves++;
<a name="l00169"></a>00169           <span class="keywordflow">else</span>
<a name="l00170"></a>00170             <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;items_communs[k] &lt;&lt; <span class="stringliteral">&quot; not found in joint voisin &quot;</span>&lt;&lt;PEvoisin&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00171"></a>00171 
<a name="l00172"></a>00172 
<a name="l00173"></a>00173         <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> items_communs_sa(items_communs);
<a name="l00174"></a>00174         items_communs.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(nb_items_communs_trouves);
<a name="l00175"></a>00175 
<a name="l00176"></a>00176         <span class="keywordtype">int</span> l=0;
<a name="l00177"></a>00177 
<a name="l00178"></a>00178         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; n; k++ )
<a name="l00179"></a>00179           {
<a name="l00180"></a>00180             <span class="keywordflow">if</span>  (corresp[k]&gt;=0)
<a name="l00181"></a>00181               items_communs[l++]=items_communs_sa[k];
<a name="l00182"></a>00182           }
<a name="l00183"></a>00183       }
<a name="l00184"></a>00184   }
<a name="l00185"></a>00185 }
<a name="l00186"></a>00186 
<a name="l00187"></a>00187 
<a name="l00188"></a>00188 <span class="comment">//</span><span class="comment"></span>
<a name="l00189"></a>00189 <span class="comment">//! Construction des tableaux joint_item(Joint::SOMMET).items_communs de tous les joints de la zone(0) du domaine dom</span>
<a name="l00190"></a>00190 <span class="comment"></span>
<a name="l00191"></a><a class="code" href="Raffiner__isotrope__parallele_8cpp.html#ac478a57ab126fe5700c7d0de0037b7b7">00191</a> <span class="keywordtype">void</span> <a class="code" href="Raffiner__isotrope__parallele_8cpp.html#ac478a57ab126fe5700c7d0de0037b7b7" title="Construction des tableaux joint_item(Joint::SOMMET).items_communs de tous les joints de la zone(0) du...">mon_construire_correspondance_sommets_par_coordonnees</a>(<a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom)
<a name="l00192"></a>00192 {
<a name="l00193"></a>00193   <a class="code" href="Raffiner__isotrope__parallele_8cpp.html#a63b101870cca816d98451d43b3f69810">mon_construire_correspondance_items_par_coordonnees</a>(dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>(), <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>, dom.<a class="code" href="classDomaine.html#aecd32c3eecc15cce7d1a0e468dadbf96" title="Renvoie le tableau des coordonnees des noeuds (sommets). (acces en lecture)">coord_sommets</a>());
<a name="l00194"></a>00194 }
<a name="l00195"></a>00195 
<a name="l00196"></a>00196 
<a name="l00197"></a>00197 
<a name="l00198"></a><a class="code" href="classRaffiner__isotrope__parallele.html#a5f56c1c29376a52b9b382a7dab8fb9fd">00198</a> <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp;  <a class="code" href="classRaffiner__isotrope__parallele.html#a5f56c1c29376a52b9b382a7dab8fb9fd">Raffiner_isotrope_parallele::interpreter</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00199"></a>00199 {
<a name="l00200"></a>00200   <span class="keywordtype">int</span> form=0, format_hdf = 0;
<a name="l00201"></a>00201   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> org,newd;
<a name="l00202"></a>00202   <a class="code" href="classParam.html" title="Defined below in this file.">Param</a> param(<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>());
<a name="l00203"></a>00203 <span class="comment">// XD Raffiner_isotrope_parallele interprete Raffiner_isotrope_parallele 1 Refine parallel mesh in parallel</span>
<a name="l00204"></a>00204   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;name_of_initial_zones&quot;</span>,&amp;org,<a class="code" href="classParam.html#aa4ad0ca1d49bc5f2ebc5fc83ee9df384aaf5b6dfac1c5970478525407cc6ac572">Param::REQUIRED</a>); <span class="comment">//!&lt; XD_ADD_P chaine name of initial Zones</span>
<a name="l00205"></a>00205 <span class="comment"></span>  param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;name_of_new_zones&quot;</span>,&amp;newd,<a class="code" href="classParam.html#aa4ad0ca1d49bc5f2ebc5fc83ee9df384aaf5b6dfac1c5970478525407cc6ac572">Param::REQUIRED</a>); <span class="comment">//!&lt; XD_ADD_P chaine name of new Zones</span>
<a name="l00206"></a>00206 <span class="comment"></span>  param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;ascii&quot;</span>,&amp;form);  <span class="comment">//!&lt; XD_ADD_P flag writing Zones in ascii format</span>
<a name="l00207"></a>00207 <span class="comment"></span>  param.<a class="code" href="classParam.html#ae3d50612a0014a9d58e6e035a65f20e5">ajouter_flag</a>(<span class="stringliteral">&quot;single_hdf&quot;</span>,&amp;format_hdf); <span class="comment">//!&lt; XD_ADD_P flag writing Zones in hdf format</span>
<a name="l00208"></a>00208 <span class="comment"></span>  param.<a class="code" href="classParam.html#aea52f16d3b74c59c48cb5708ff48f14a">lire_avec_accolades</a>(is);
<a name="l00209"></a>00209 <span class="comment">// Force un fichier unique au dela d&#39;un certain nombre de rangs MPI:</span>
<a name="l00210"></a>00210   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#a0028ba29b8998170a85d2e0c00293b78">Process::force_single_file</a>(<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>(), org+<span class="stringliteral">&quot;.Zones&quot;</span>))
<a name="l00211"></a>00211     format_hdf = 1;
<a name="l00212"></a>00212   <span class="keywordtype">int</span> binaire=!form;
<a name="l00213"></a>00213   <span class="keywordflow">if</span> (form &amp;&amp; format_hdf)
<a name="l00214"></a>00214     {
<a name="l00215"></a>00215       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Raffiner_isotrope_parallele::interpreter(): options &#39;ascii&#39; and &#39;single_hdf&#39; are mutually exclusive!&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00216"></a>00216       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>(1);
<a name="l00217"></a>00217     }
<a name="l00218"></a>00218   <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a> dom_org;
<a name="l00219"></a>00219   <a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a> liste_bords_periodiques;
<a name="l00220"></a>00220   org+=<span class="stringliteral">&quot;.Zones&quot;</span>;
<a name="l00221"></a>00221 
<a name="l00222"></a>00222   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> copy(org);
<a name="l00223"></a>00223   copy = copy.<a class="code" href="classNom.html#a49a5c6438b6efe73ab314900c60a329c" title="Insere _prefix000n (n=me() ou nproc()) dans un nom de fichier (par ex:toto.titi) pour donner toto_pre...">nom_me</a>(<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>(), <span class="stringliteral">&quot;p&quot;</span>, 1);
<a name="l00224"></a>00224 <span class="comment">// bool is_hdf = FichierHDF::is_hdf5(copy);</span>
<a name="l00225"></a>00225   <a class="code" href="classLecFicDiffuse.html" title="Cette classe implemente les operateurs et les methodes virtuelles de la classe EFichier de la facon s...">LecFicDiffuse</a> <a class="code" href="Op__Grad__EF_8cpp.html#abc0897c211f7aa4541da5833388f868b">test</a>;
<a name="l00226"></a>00226   <span class="keywordtype">bool</span> is_hdf = test.<a class="code" href="classLecFicDiffuse.html#a2e4f3199de5e1b47edcffc68952c7be8" title="Ouverture du fichier. Cette methode doit etre appelee par tous les processeurs du groupe...">ouvrir</a>(copy) &amp;&amp; <a class="code" href="classFichierHDF.html#a0ad22bc624e64d0fecd33abb64b4881a">FichierHDF::is_hdf5</a>(copy);
<a name="l00227"></a>00227 
<a name="l00228"></a>00228   <span class="keywordflow">if</span> (!is_hdf)
<a name="l00229"></a>00229     {
<a name="l00230"></a>00230       <a class="code" href="classLecFicDistribue.html" title="Cette classe implemente les operateurs et les methodes virtuelles de la classe EFichier de la facon s...">LecFicDistribue</a>    fichier;
<a name="l00231"></a>00231       fichier.<a class="code" href="classEntree.html#a423a8b547335af7d31a2516eb452d936" title="Change le mode d&#39;ecriture du fichier. Cette methode peut etre appelee n&#39;importe quand.">set_bin</a>(binaire);
<a name="l00232"></a>00232       fichier.<a class="code" href="classLecFicDistribue.html#a2186b78886c1a8630c7f69af03141087" title="Ouvre le fichier avec les parametres mode et prot donnes Ces parametres sont les parametres de la met...">ouvrir</a>(org);
<a name="l00233"></a>00233       fichier &gt;&gt; dom_org;
<a name="l00234"></a>00234       dom_org.<a class="code" href="classDomaine.html#a092a7a09cc39770fb7549ff29fcd8c8e">set_fichier_lu</a>(org);
<a name="l00235"></a>00235       fichier &gt;&gt; liste_bords_periodiques;
<a name="l00236"></a>00236     }
<a name="l00237"></a>00237   <span class="keywordflow">else</span>
<a name="l00238"></a>00238     {
<a name="l00239"></a>00239       <a class="code" href="classFichierHDFPar.html" title="Parallel collective version of FichierHDF, to be used for all concurrent reading/writing on HDF files...">FichierHDFPar</a> fic_hdf;
<a name="l00240"></a>00240 <span class="comment">// FichierHDF fic_hdf;</span>
<a name="l00241"></a>00241       org = copy;
<a name="l00242"></a>00242       fic_hdf.<a class="code" href="classFichierHDF.html#a55803f961da3af25680be6cec26e85ec">open</a>(org, <span class="keyword">true</span>);
<a name="l00243"></a>00243       <a class="code" href="classEntree__Brute.html" title="An Entree whose main source of data is an arbitrary binary buffer set using the set_data() method...">Entree_Brute</a> data;
<a name="l00244"></a>00244 
<a name="l00245"></a>00245       fic_hdf.<a class="code" href="classFichierHDF.html#a4b1e63bb02aebe3cd085af22cdd870af">read_dataset</a>(<span class="stringliteral">&quot;/zone&quot;</span>, <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>(), data);
<a name="l00246"></a>00246 
<a name="l00247"></a>00247 <span class="comment">// Feed TRUST objects:</span>
<a name="l00248"></a>00248       data &gt;&gt; dom_org;
<a name="l00249"></a>00249       dom_org.<a class="code" href="classDomaine.html#a092a7a09cc39770fb7549ff29fcd8c8e">set_fichier_lu</a>(org);
<a name="l00250"></a>00250       data &gt;&gt; liste_bords_periodiques;
<a name="l00251"></a>00251 
<a name="l00252"></a>00252       fic_hdf.<a class="code" href="classFichierHDF.html#ac5d8eb389ee60109c2d60029f442487f">close</a>();
<a name="l00253"></a>00253     }
<a name="l00254"></a>00254 
<a name="l00255"></a>00255   <a class="code" href="classScatter.html#a8cf934a9b5f7ecb7ef89f61c09804f45" title="methode utilisee par les interpretes qui modifient le domaine&lt;br&gt;(sequentiel), detruit les descripteu...">Scatter::uninit_sequential_domain</a>(dom_org);
<a name="l00256"></a>00256   <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a> dom_new(dom_org);
<a name="l00257"></a>00257 
<a name="l00258"></a>00258   <a class="code" href="classRaffiner__Simplexes.html#a7053183270d4876053f76685b391d087">refine_domain</a>(dom_org,dom_new);
<a name="l00259"></a>00259 
<a name="l00260"></a>00260 
<a name="l00261"></a>00261   <span class="keyword">static</span> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> stats = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(0 <span class="comment">/* Level */</span>, <span class="stringliteral">&quot;Mailler_Parallel&quot;</span>, 0 <span class="comment">/* Group */</span>);
<a name="l00262"></a>00262 
<a name="l00263"></a>00263   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">nproc</a>() &gt; 1)
<a name="l00264"></a>00264     {
<a name="l00265"></a>00265       <a class="code" href="classScatter.html#a8cf934a9b5f7ecb7ef89f61c09804f45" title="methode utilisee par les interpretes qui modifient le domaine&lt;br&gt;(sequentiel), detruit les descripteu...">Scatter::uninit_sequential_domain</a>(dom_new);
<a name="l00266"></a>00266       <span class="keywordtype">int</span> nb_sommet_avant_completion=dom_new.<a class="code" href="classDomaine.html#abc4abc8b8db5bebeb161fae4162a89ce" title="Renvoie le nombre de sommets.">nb_som</a>();
<a name="l00267"></a>00267       <a class="code" href="classScatter.html#ac5dd6d7661490708649976cde509f480" title="Tri des joints dans l&#39;ordre croissant des processeurs.">Scatter::trier_les_joints</a>(dom_new.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>());
<a name="l00268"></a>00268       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#affcd058809786918ed173aaf681d0843">begin_count</a>(stats);
<a name="l00269"></a>00269 
<a name="l00270"></a>00270 
<a name="l00271"></a>00271       <a class="code" href="Raffiner__isotrope__parallele_8cpp.html#ac478a57ab126fe5700c7d0de0037b7b7" title="Construction des tableaux joint_item(Joint::SOMMET).items_communs de tous les joints de la zone(0) du...">mon_construire_correspondance_sommets_par_coordonnees</a>(dom_new);
<a name="l00272"></a>00272 
<a name="l00273"></a>00273       <span class="keywordflow">if</span> (0)
<a name="l00274"></a>00274         {
<a name="l00275"></a>00275           <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> <a class="code" href="Parser_8cpp.html#aa7f696ea7248915c3f9093a8cf534f3d">debug</a>(newd);
<a name="l00276"></a>00276           debug+=<span class="stringliteral">&quot;_debug.Zones&quot;</span>;
<a name="l00277"></a>00277           <a class="code" href="classEcrFicCollecte.html" title="Ecriture dans un fichier Cette classe implemente les operateurs et les methodes virtuelles de la clas...">EcrFicCollecte</a> os;
<a name="l00278"></a>00278           os.<a class="code" href="classSortie.html#a1b830c79a55971e0ae7281d13e06cb44" title="Change le mode d&#39;ecriture du fichier. Cette methode peut etre appelee n&#39;importe quand. Attention cependant pour les fichiers Ecrire_Fichier_Partage : il faut faire le changement uniquement au debut de l&#39;ecriture d&#39;un bloc, juste apres syncfile() (sinon, mauvaise traduction des retours a la ligne lors du syncfile suivant).">set_bin</a>(binaire);
<a name="l00279"></a>00279 
<a name="l00280"></a>00280           os.<a class="code" href="classEcrFicCollecte.html#aa5cf109ccd38b11522fe516567b088cd" title="Ouvre le fichier avec les parametres mode et prot donnes Ces parametres sont les parametres de la met...">ouvrir</a>(debug);
<a name="l00281"></a>00281           <span class="keywordflow">if</span> (!binaire)
<a name="l00282"></a>00282             {
<a name="l00283"></a>00283               os.<a class="code" href="classSortie__Fichier__base.html#a5ddd834ca9c766c24cc608cd03ef0e96">setf</a>(ios::scientific);
<a name="l00284"></a>00284               os.<a class="code" href="classSortie__Fichier__base.html#a489ca01946f4e2a7a9aa8f3a3d949b08">precision</a>(<a class="code" href="classObjet__U.html#a9b145f6e0684a53f431e675423037ada">Objet_U::format_precision_geom</a>);
<a name="l00285"></a>00285             }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287           os &lt;&lt; dom_new;
<a name="l00288"></a>00288 
<a name="l00289"></a>00289           os &lt;&lt; liste_bords_periodiques;
<a name="l00290"></a>00290 
<a name="l00291"></a>00291         }
<a name="l00292"></a>00292 <span class="comment">// else</span>
<a name="l00293"></a>00293       {
<a name="l00294"></a>00294 
<a name="l00295"></a>00295         <a class="code" href="classScatter.html#acafac38fc2983e19398c403a9235bb4c" title="Construction des tableaux joint_item(Joint::SOMMET).items_communs de tous les joints de la zone(0) du...">Scatter::construire_correspondance_sommets_par_coordonnees</a>(dom_new);
<a name="l00296"></a>00296         <a class="code" href="classScatter.html#a21f166c05df9be1fc1f02b0604624fe5" title="On suppose que chaque joint[i].joint_item(type_item).items_communs() contient les indices locaux des ...">Scatter::calculer_renum_items_communs</a>(dom_new.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>(), <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>);
<a name="l00297"></a>00297 
<a name="l00298"></a>00298         <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a0faf52d1b518f5b0b2177f22efcc222d" title="Arret du compteur counter_id. On ajoute quantity a la somme des &#39;quantity&#39; (par defaut 0) stockees po...">end_count</a>(stats);
<a name="l00299"></a>00299         <span class="keywordtype">double</span> maxtime = <a class="code" href="classProcess.html#a1e9d9f9899b71927cfafae14c7bd048d" title="Calcule le max de x sur tous les processeurs du groupe courant. Remarques : Cette methode doit etre a...">mp_max</a>(<a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().last_time(stats));
<a name="l00300"></a>00300         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Scatter::construire_correspondance_sommets_par_coordonnees fin, time:&quot;</span>
<a name="l00301"></a>00301              &lt;&lt; maxtime
<a name="l00302"></a>00302              &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00303"></a>00303 
<a name="l00304"></a>00304         <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#affcd058809786918ed173aaf681d0843">begin_count</a>(stats);
<a name="l00305"></a>00305 
<a name="l00306"></a>00306         <a class="code" href="classScatter.html#af6b88297583bd92c6ca3814bc532b8be" title="Construction des structures paralleles du domaine et de la zone (determination des elements distants ...">Scatter::construire_structures_paralleles</a>(dom_new, liste_bords_periodiques);
<a name="l00307"></a>00307 
<a name="l00308"></a>00308         <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a0faf52d1b518f5b0b2177f22efcc222d" title="Arret du compteur counter_id. On ajoute quantity a la somme des &#39;quantity&#39; (par defaut 0) stockees po...">end_count</a>(stats);
<a name="l00309"></a>00309         maxtime = <a class="code" href="classProcess.html#a1e9d9f9899b71927cfafae14c7bd048d" title="Calcule le max de x sur tous les processeurs du groupe courant. Remarques : Cette methode doit etre a...">mp_max</a>(<a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().last_time(stats));
<a name="l00310"></a>00310         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Scatter::construire_structures_paralleles, time:&quot;</span> &lt;&lt; maxtime &lt;&lt; finl;
<a name="l00311"></a>00311 
<a name="l00312"></a>00312 
<a name="l00313"></a>00313         <span class="keywordtype">int</span> <a class="code" href="EcritureLectureSpecial_8cpp.html#aaa8066c85a2a9a8afd0ab6fadc02ca72">ecrit</a>=1;
<a name="l00314"></a>00314         <span class="keywordflow">if</span> (ecrit)
<a name="l00315"></a>00315           {
<a name="l00316"></a>00316             <span class="keywordtype">int</span> nb_elem_reel=dom_new.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a7f249429803b27139a1c54436f6164a5" title="Renvoie le nombre d&#39;elements de la zone.">nb_elem</a>();
<a name="l00317"></a>00317             <a class="code" href="classScatter.html#a8cf934a9b5f7ecb7ef89f61c09804f45" title="methode utilisee par les interpretes qui modifient le domaine&lt;br&gt;(sequentiel), detruit les descripteu...">Scatter::uninit_sequential_domain</a>(dom_new);
<a name="l00318"></a>00318             dom_new.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#ac115e8342be89afb882b7b61cc343267" title="Renvoie le tableau des sommets des elements.">les_elems</a>().<a class="code" href="classIntTab.html#a22e6bed6826b3688d4d0181cbf3b7a38" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>( nb_elem_reel,dom_new.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#ac115e8342be89afb882b7b61cc343267" title="Renvoie le tableau des sommets des elements.">les_elems</a>().<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1));
<a name="l00319"></a>00319             dom_new.<a class="code" href="classDomaine.html#a0846ac03a10b65c4df911fe35a19c02f" title="Renvoie le nombre total de sommets.">les_sommets</a>().<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(nb_sommet_avant_completion,<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>);
<a name="l00320"></a>00320 
<a name="l00321"></a>00321             <a class="code" href="classScatter.html#a8cf934a9b5f7ecb7ef89f61c09804f45" title="methode utilisee par les interpretes qui modifient le domaine&lt;br&gt;(sequentiel), detruit les descripteu...">Scatter::uninit_sequential_domain</a>(dom_new);
<a name="l00322"></a>00322             newd+=<span class="stringliteral">&quot;.Zones&quot;</span>;
<a name="l00323"></a>00323 
<a name="l00324"></a>00324             <span class="keywordflow">if</span>( !format_hdf )
<a name="l00325"></a>00325               {
<a name="l00326"></a>00326                 <a class="code" href="classEcrFicCollecte.html" title="Ecriture dans un fichier Cette classe implemente les operateurs et les methodes virtuelles de la clas...">EcrFicCollecte</a> os;
<a name="l00327"></a>00327                 os.<a class="code" href="classSortie.html#a1b830c79a55971e0ae7281d13e06cb44" title="Change le mode d&#39;ecriture du fichier. Cette methode peut etre appelee n&#39;importe quand. Attention cependant pour les fichiers Ecrire_Fichier_Partage : il faut faire le changement uniquement au debut de l&#39;ecriture d&#39;un bloc, juste apres syncfile() (sinon, mauvaise traduction des retours a la ligne lors du syncfile suivant).">set_bin</a>(binaire);
<a name="l00328"></a>00328                 os.<a class="code" href="classEcrFicCollecte.html#aa5cf109ccd38b11522fe516567b088cd" title="Ouvre le fichier avec les parametres mode et prot donnes Ces parametres sont les parametres de la met...">ouvrir</a>(newd);
<a name="l00329"></a>00329                 <span class="keywordflow">if</span> (!binaire)
<a name="l00330"></a>00330                   {
<a name="l00331"></a>00331                     os.<a class="code" href="classSortie__Fichier__base.html#a5ddd834ca9c766c24cc608cd03ef0e96">setf</a>(ios::scientific);
<a name="l00332"></a>00332                     os.<a class="code" href="classSortie__Fichier__base.html#a489ca01946f4e2a7a9aa8f3a3d949b08">precision</a>(<a class="code" href="classObjet__U.html#a9b145f6e0684a53f431e675423037ada">Objet_U::format_precision_geom</a>);
<a name="l00333"></a>00333                   }
<a name="l00334"></a>00334                 os &lt;&lt; dom_new;
<a name="l00335"></a>00335                 os &lt;&lt; liste_bords_periodiques;
<a name="l00336"></a>00336               }
<a name="l00337"></a>00337             <span class="keywordflow">else</span>
<a name="l00338"></a>00338               {
<a name="l00339"></a>00339                 <a class="code" href="classSortie__Brute.html" title="This derived class of Sortie stacks whatever it receives in an internal binary buffer. Data can be accessed through get_data().">Sortie_Brute</a> os_hdf;
<a name="l00340"></a>00340                 os_hdf &lt;&lt; dom_new;
<a name="l00341"></a>00341                 os_hdf &lt;&lt; liste_bords_periodiques;
<a name="l00342"></a>00342                 <a class="code" href="classFichierHDFPar.html" title="Parallel collective version of FichierHDF, to be used for all concurrent reading/writing on HDF files...">FichierHDFPar</a> fic_hdf;
<a name="l00343"></a>00343                 newd = newd.<a class="code" href="classNom.html#a49a5c6438b6efe73ab314900c60a329c" title="Insere _prefix000n (n=me() ou nproc()) dans un nom de fichier (par ex:toto.titi) pour donner toto_pre...">nom_me</a>(<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>(), <span class="stringliteral">&quot;p&quot;</span>, 1);
<a name="l00344"></a>00344                 fic_hdf.<a class="code" href="classFichierHDF.html#ae8d1c1444d9d7ac5d0bef32feaa050df">create</a>(newd);
<a name="l00345"></a>00345                 fic_hdf.<a class="code" href="classFichierHDF.html#a25d4709e6498f901d7624c01306f3def">create_and_fill_dataset_MW</a>(<span class="stringliteral">&quot;/zone&quot;</span>, os_hdf);
<a name="l00346"></a>00346                 fic_hdf.<a class="code" href="classFichierHDF.html#ac5d8eb389ee60109c2d60029f442487f">close</a>();
<a name="l00347"></a>00347               }
<a name="l00348"></a>00348           }
<a name="l00349"></a>00349       }
<a name="l00350"></a>00350     }
<a name="l00351"></a>00351   <span class="keywordflow">else</span>
<a name="l00352"></a>00352     {
<a name="l00353"></a>00353       <a class="code" href="classScatter.html#a1874139ffd29d5a68191bc7828d3a5bd" title="cree des descripteurs sequentiels pour les tableaux sommets et elements du domaine (necessaire car Sc...">Scatter::init_sequential_domain</a>(dom_new);
<a name="l00354"></a>00354     }
<a name="l00355"></a>00355 
<a name="l00356"></a>00356   <span class="keywordflow">return</span> is;
<a name="l00357"></a>00357 }
<a name="l00358"></a>00358 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:20 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
