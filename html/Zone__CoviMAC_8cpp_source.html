<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/CoviMAC/Zones/Zone_CoviMAC.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/CoviMAC/Zones/Zone_CoviMAC.cpp</div>  </div>
</div>
<div class="contents">
<a href="Zone__CoviMAC_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (c) 2021, CEA</span>
<a name="l00003"></a>00003 <span class="comment">* All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment">* 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00007"></a>00007 <span class="comment">* 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00008"></a>00008 <span class="comment">* 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<a name="l00011"></a>00011 <span class="comment">* IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;</span>
<a name="l00012"></a>00012 <span class="comment">* OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// File:        Zone_CoviMAC.cpp</span>
<a name="l00018"></a>00018 <span class="comment">// Directory:   $TRUST_ROOT/src/CoviMAC/Zones</span>
<a name="l00019"></a>00019 <span class="comment">// Version:     1</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;<a class="code" href="Zone__CoviMAC_8h.html">Zone_CoviMAC.h</a>&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;tuple&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;unordered_map&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="Rectangle_8h.html">Rectangle.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="Hexaedre_8h.html">Hexaedre.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="Triangle_8h.html">Triangle.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="Segment_8h.html">Segment.h</a>&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;<a class="code" href="Tetraedre_8h.html">Tetraedre.h</a>&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;<a class="code" href="Quadrangle__VEF_8h.html">Quadrangle_VEF.h</a>&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;<a class="code" href="Hexaedre__VEF_8h.html">Hexaedre_VEF.h</a>&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;<a class="code" href="Zone__Cl__CoviMAC_8h.html">Zone_Cl_CoviMAC.h</a>&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;<a class="code" href="Tri__CoviMAC_8h.html">Tri_CoviMAC.h</a>&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;<a class="code" href="Segment__CoviMAC_8h.html">Segment_CoviMAC.h</a>&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;<a class="code" href="Tetra__CoviMAC_8h.html">Tetra_CoviMAC.h</a>&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;<a class="code" href="Quadri__CoviMAC_8h.html">Quadri_CoviMAC.h</a>&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;<a class="code" href="Hexa__CoviMAC_8h.html">Hexa_CoviMAC.h</a>&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;<a class="code" href="Domaine_8h.html">Domaine.h</a>&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;<a class="code" href="Scatter_8h.html">Scatter.h</a>&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;<a class="code" href="EFichier_8h.html">EFichier.h</a>&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;<a class="code" href="SFichier_8h.html">SFichier.h</a>&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;<a class="code" href="IntList_8h.html">IntList.h</a>&gt;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;<a class="code" href="DoubleList_8h.html">DoubleList.h</a>&gt;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &lt;<a class="code" href="Connectivite__som__elem_8h.html">Connectivite_som_elem.h</a>&gt;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &lt;<a class="code" href="Array__tools_8h.html">Array_tools.h</a>&gt;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;<a class="code" href="Matrix__tools_8h.html">Matrix_tools.h</a>&gt;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;<a class="code" href="EChaine_8h.html">EChaine.h</a>&gt;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &lt;<a class="code" href="Comm__Group__MPI_8h.html">Comm_Group_MPI.h</a>&gt;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &lt;<a class="code" href="PE__Groups_8h.html">PE_Groups.h</a>&gt;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &lt;<a class="code" href="communications_8h.html">communications.h</a>&gt;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &lt;<a class="code" href="Statistiques_8h.html">Statistiques.h</a>&gt;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &lt;<a class="code" href="MD__Vector__composite_8h.html">MD_Vector_composite.h</a>&gt;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &lt;<a class="code" href="MD__Vector__tools_8h.html">MD_Vector_tools.h</a>&gt;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &lt;<a class="code" href="ConstDoubleTab__parts_8h.html">ConstDoubleTab_parts.h</a>&gt;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &lt;<a class="code" href="Lapack_8h.html">Lapack.h</a>&gt;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &lt;<a class="code" href="Option__CoviMAC_8h.html">Option_CoviMAC.h</a>&gt;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &lt;<a class="code" href="Echange__contact__CoviMAC_8h.html">Echange_contact_CoviMAC.h</a>&gt;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &lt;<a class="code" href="Dirichlet__homogene_8h.html">Dirichlet_homogene.h</a>&gt;</span>
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="preprocessor">#include &lt;<a class="code" href="LireMED_8h.html">LireMED.h</a>&gt;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &lt;<a class="code" href="EcrMED_8h.html">EcrMED.h</a>&gt;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &lt;<a class="code" href="Champ__implementation__P1_8h.html">Champ_implementation_P1.h</a>&gt;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &lt;<a class="code" href="Linear__algebra__tools__impl_8h.html">Linear_algebra_tools_impl.h</a>&gt;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &lt;<a class="code" href="IntLists_8h.html">IntLists.h</a>&gt;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &lt;<a class="code" href="DoubleLists_8h.html">DoubleLists.h</a>&gt;</span>
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00071"></a>00071 <span class="preprocessor">#include &lt;set&gt;</span>
<a name="l00072"></a>00072 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00073"></a>00073 <span class="preprocessor">#include &lt;cmath&gt;</span>
<a name="l00074"></a>00074 <span class="preprocessor">#include &lt;cfloat&gt;</span>
<a name="l00075"></a>00075 <span class="preprocessor">#include &lt;numeric&gt;</span>
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 <span class="preprocessor">#include &lt;cfenv&gt;</span>
<a name="l00078"></a>00078 <span class="preprocessor">#pragma GCC diagnostic push</span>
<a name="l00079"></a>00079 <span class="preprocessor"></span><span class="preprocessor">#pragma GCC diagnostic ignored &quot;-Wunused-variable&quot;</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span><span class="preprocessor">#include &lt;osqp/osqp.h&gt;</span>
<a name="l00081"></a>00081 <span class="preprocessor">#pragma GCC diagnostic pop</span>
<a name="l00082"></a>00082 <span class="preprocessor"></span>
<a name="l00083"></a><a class="code" href="Zone__CoviMAC_8cpp.html#a49eab17cc61cdc1e69fe28f6db79ee16">00083</a> <a class="code" href="Op__Diff__CoviMAC__Face_8cpp.html#aa86ec8ba612a969d9b4370b775037144">Implemente_instanciable</a>(<a class="code" href="classZone__CoviMAC.html" title="class Zone_CoviMAC Classe instanciable qui derive de Zone_VF. Cette classe contient les informations ...">Zone_CoviMAC</a>,<span class="stringliteral">&quot;Zone_CoviMAC&quot;</span>,<a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>);
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 <span class="comment"></span>
<a name="l00086"></a>00086 <span class="comment">////!&lt; printOn </span>
<a name="l00087"></a>00087 <span class="comment"></span><span class="comment">//</span>
<a name="l00088"></a>00088 
<a name="l00089"></a><a class="code" href="classZone__CoviMAC.html#a7a1a7f80a65ab5931a69f602bfa64f5f">00089</a> <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classZone__CoviMAC.html#a7a1a7f80a65ab5931a69f602bfa64f5f">Zone_CoviMAC::ecrit</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os)<span class="keyword"> const</span>
<a name="l00090"></a>00090 <span class="keyword"></span>{
<a name="l00091"></a>00091   <a class="code" href="classZone__CoviMAC.html#ae3142589042dada25fbf00eaf0221ab1" title="Surcharge Objet_U::printOn(Sortie&amp;) NE FAIT RIEN A surcharger dans les classes derivees. Imprime la zone discretisee sur un flot de sortie.">Zone_VF::printOn</a>(os);
<a name="l00092"></a>00092   os &lt;&lt; <span class="stringliteral">&quot;____ h_carre &quot;</span>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00093"></a>00093   os &lt;&lt; <a class="code" href="classZone__CoviMAC.html#a9bc5ec96b975406081a7a413434b7b50" title="carre du pas du maillage">h_carre</a> &lt;&lt; finl;
<a name="l00094"></a>00094   os &lt;&lt; <span class="stringliteral">&quot;____ type_elem_ &quot;</span>&lt;&lt;finl;
<a name="l00095"></a>00095   os &lt;&lt; <a class="code" href="classZone__CoviMAC.html#ade3043ff73b93b8b29fa74746784d92b" title="type de l&#39;element de discretisation">type_elem_</a> &lt;&lt; finl;
<a name="l00096"></a>00096   os &lt;&lt; <span class="stringliteral">&quot;____ nb_elem_std_ &quot;</span>&lt;&lt;finl;
<a name="l00097"></a>00097   os &lt;&lt; <a class="code" href="classZone__CoviMAC.html#a38bc6b41c9a1f65b9056c247310a7df2" title="nombre d&#39;elements standard">nb_elem_std_</a> &lt;&lt; finl;
<a name="l00098"></a>00098   os &lt;&lt; <span class="stringliteral">&quot;____ volumes_entrelaces_ &quot;</span>&lt;&lt;finl;
<a name="l00099"></a>00099   <a class="code" href="classZone__VF.html#a4d84eafd75968d81d72275f240390ee8" title="volumes entrelaces pour l&#39;integration des Qdm">volumes_entrelaces_</a>.<a class="code" href="classDoubleVect.html#ad55e6b8d8409ed1382d7cb83e0d311a8" title="ecriture des valeurs du tableau &quot;raw&quot; sans structure parallele">ecrit</a>(os);
<a name="l00100"></a>00100   os &lt;&lt; <span class="stringliteral">&quot;____ face_normales_ &quot;</span>&lt;&lt;finl;
<a name="l00101"></a>00101   <a class="code" href="classZone__CoviMAC.html#a158fd977594473b89e67bdc19c8514fc" title="normales aux faces">face_normales_</a>.<a class="code" href="classDoubleTab.html#ab7588e94792cc0be3a3288573c44ca18" title="ecriture des valeurs du tableau &quot;raw&quot; sans structure parallele">ecrit</a>(os);
<a name="l00102"></a>00102   os &lt;&lt; <span class="stringliteral">&quot;____ nb_faces_std_ &quot;</span>&lt;&lt;finl;
<a name="l00103"></a>00103   os &lt;&lt; <a class="code" href="classZone__CoviMAC.html#a5b7693686eb859754457f0498ffebf2e" title="nombre de faces standard">nb_faces_std_</a> &lt;&lt; finl;
<a name="l00104"></a>00104   os &lt;&lt; <span class="stringliteral">&quot;____ rang_elem_non_std_ &quot;</span>&lt;&lt;finl;
<a name="l00105"></a>00105   <a class="code" href="classZone__CoviMAC.html#a487cca180430a8435033730d04781d2a" title="rang_elem_non_std_= -1 si l&#39;element est standard rang_elem_non_std_= rang de l&#39;element dans les table...">rang_elem_non_std_</a>.<a class="code" href="classIntVect.html#ae08d96549fed9a6fbac1bb89ab355301" title="ecriture des valeurs du tableau &quot;raw&quot; sans structure parallele">ecrit</a>(os);
<a name="l00106"></a>00106   <span class="keywordflow">return</span> os;
<a name="l00107"></a>00107 }
<a name="l00108"></a>00108 <span class="comment"></span>
<a name="l00109"></a>00109 <span class="comment">////!&lt; printOn </span>
<a name="l00110"></a>00110 <span class="comment"></span><span class="comment">//</span>
<a name="l00111"></a>00111 
<a name="l00112"></a><a class="code" href="classZone__CoviMAC.html#ae3142589042dada25fbf00eaf0221ab1">00112</a> <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classZone__CoviMAC.html#ae3142589042dada25fbf00eaf0221ab1" title="Surcharge Objet_U::printOn(Sortie&amp;) NE FAIT RIEN A surcharger dans les classes derivees. Imprime la zone discretisee sur un flot de sortie.">Zone_CoviMAC::printOn</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os)<span class="keyword"> const</span>
<a name="l00113"></a>00113 <span class="keyword"></span>{
<a name="l00114"></a>00114   <a class="code" href="classZone__CoviMAC.html#ae3142589042dada25fbf00eaf0221ab1" title="Surcharge Objet_U::printOn(Sortie&amp;) NE FAIT RIEN A surcharger dans les classes derivees. Imprime la zone discretisee sur un flot de sortie.">Zone_VF::printOn</a>(os);
<a name="l00115"></a>00115 
<a name="l00116"></a>00116   os &lt;&lt; <a class="code" href="classZone__CoviMAC.html#a9bc5ec96b975406081a7a413434b7b50" title="carre du pas du maillage">h_carre</a> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00117"></a>00117   os &lt;&lt; <a class="code" href="classZone__CoviMAC.html#ade3043ff73b93b8b29fa74746784d92b" title="type de l&#39;element de discretisation">type_elem_</a> &lt;&lt; finl;
<a name="l00118"></a>00118   os &lt;&lt; <a class="code" href="classZone__CoviMAC.html#a38bc6b41c9a1f65b9056c247310a7df2" title="nombre d&#39;elements standard">nb_elem_std_</a> &lt;&lt; finl;
<a name="l00119"></a>00119   os &lt;&lt; <a class="code" href="classZone__VF.html#a4d84eafd75968d81d72275f240390ee8" title="volumes entrelaces pour l&#39;integration des Qdm">volumes_entrelaces_</a> &lt;&lt; finl;
<a name="l00120"></a>00120   os &lt;&lt; <a class="code" href="classZone__CoviMAC.html#a158fd977594473b89e67bdc19c8514fc" title="normales aux faces">face_normales_</a> &lt;&lt; finl;
<a name="l00121"></a>00121   os &lt;&lt; <a class="code" href="classZone__VF.html#ae0dc3dc379de71f9d99115ab6973f0f6" title="centres de gravite des elements">xp_</a> &lt;&lt; finl;
<a name="l00122"></a>00122   os &lt;&lt; <a class="code" href="classZone__VF.html#a30d5c38f1825d8d35ce9c83aa37e5aa6" title="centres de gravite des faces">xv_</a> &lt;&lt; finl;
<a name="l00123"></a>00123   os &lt;&lt; <a class="code" href="classZone__CoviMAC.html#a5b7693686eb859754457f0498ffebf2e" title="nombre de faces standard">nb_faces_std_</a> &lt;&lt; finl;
<a name="l00124"></a>00124   os &lt;&lt; <a class="code" href="classZone__CoviMAC.html#a487cca180430a8435033730d04781d2a" title="rang_elem_non_std_= -1 si l&#39;element est standard rang_elem_non_std_= rang de l&#39;element dans les table...">rang_elem_non_std_</a> &lt;&lt; finl;
<a name="l00125"></a>00125   <span class="keywordflow">return</span> os;
<a name="l00126"></a>00126 }
<a name="l00127"></a>00127 <span class="comment"></span>
<a name="l00128"></a>00128 <span class="comment">////!&lt; readOn </span>
<a name="l00129"></a>00129 <span class="comment"></span><span class="comment">//</span>
<a name="l00130"></a>00130 
<a name="l00131"></a><a class="code" href="classZone__CoviMAC.html#a657ba51b01a6b9ea605e7c1f63708634">00131</a> <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classZone__CoviMAC.html#a657ba51b01a6b9ea605e7c1f63708634" title="Surcharge Objet_U::readOn(Sortie&amp;) NE FAIT RIEN A surcharger dans les classes derivees. Lit une zone discretisee a partir d&#39;un flot d&#39;entree.">Zone_CoviMAC::readOn</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00132"></a>00132 {
<a name="l00133"></a>00133   <a class="code" href="classZone__CoviMAC.html#a657ba51b01a6b9ea605e7c1f63708634" title="Surcharge Objet_U::readOn(Sortie&amp;) NE FAIT RIEN A surcharger dans les classes derivees. Lit une zone discretisee a partir d&#39;un flot d&#39;entree.">Zone_VF::readOn</a>(is);
<a name="l00134"></a>00134   is &gt;&gt; <a class="code" href="classZone__CoviMAC.html#a9bc5ec96b975406081a7a413434b7b50" title="carre du pas du maillage">h_carre</a>;
<a name="l00135"></a>00135   is &gt;&gt; <a class="code" href="classZone__CoviMAC.html#ade3043ff73b93b8b29fa74746784d92b" title="type de l&#39;element de discretisation">type_elem_</a>;
<a name="l00136"></a>00136   is &gt;&gt; <a class="code" href="classZone__CoviMAC.html#a38bc6b41c9a1f65b9056c247310a7df2" title="nombre d&#39;elements standard">nb_elem_std_</a> ;
<a name="l00137"></a>00137   is &gt;&gt; <a class="code" href="classZone__VF.html#a4d84eafd75968d81d72275f240390ee8" title="volumes entrelaces pour l&#39;integration des Qdm">volumes_entrelaces_</a> ;
<a name="l00138"></a>00138   is &gt;&gt; <a class="code" href="classZone__CoviMAC.html#a158fd977594473b89e67bdc19c8514fc" title="normales aux faces">face_normales_</a> ;
<a name="l00139"></a>00139   is &gt;&gt; <a class="code" href="classZone__VF.html#ae0dc3dc379de71f9d99115ab6973f0f6" title="centres de gravite des elements">xp_</a>;
<a name="l00140"></a>00140   is &gt;&gt; <a class="code" href="classZone__VF.html#a30d5c38f1825d8d35ce9c83aa37e5aa6" title="centres de gravite des faces">xv_</a>;
<a name="l00141"></a>00141   is &gt;&gt; <a class="code" href="classZone__CoviMAC.html#a5b7693686eb859754457f0498ffebf2e" title="nombre de faces standard">nb_faces_std_</a> ;
<a name="l00142"></a>00142   is &gt;&gt; <a class="code" href="classZone__CoviMAC.html#a487cca180430a8435033730d04781d2a" title="rang_elem_non_std_= -1 si l&#39;element est standard rang_elem_non_std_= rang de l&#39;element dans les table...">rang_elem_non_std_</a> ;
<a name="l00143"></a>00143   <span class="keywordflow">return</span> is;
<a name="l00144"></a>00144 }
<a name="l00145"></a>00145 
<a name="l00146"></a>00146 <span class="comment">//</span>
<a name="l00147"></a>00147 <span class="comment">//</span>
<a name="l00148"></a>00148 <span class="comment">//</span>
<a name="l00149"></a>00149 <span class="comment">//</span>
<a name="l00150"></a>00150 <span class="comment">//</span>
<a name="l00151"></a>00151 <span class="comment">//</span><span class="comment"></span>
<a name="l00152"></a>00152 <span class="comment">//! Methode appelee par Zone_VF::discretiser apres la creation&lt;br&gt;des faces reelles.&lt;br&gt;On reordonne les faces de sorte a placer les faces &quot;non standard&quot;&lt;br&gt;au debut de la liste des faces. Les faces non standard sont celles&lt;br&gt;dont les volumes de controles sont modifies par les conditions aux&lt;br&gt;limites.</span>
<a name="l00153"></a><a class="code" href="classZone__CoviMAC.html#ac95e1f2f469bc6b018755d375ddc5997">00153</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classZone__CoviMAC.html#ac95e1f2f469bc6b018755d375ddc5997" title="Methode appelee par Zone_VF::discretiser apres la creation des faces reelles. On reordonne les faces ...">Zone_CoviMAC::reordonner</a>(<a class="code" href="classFaces.html" title="enum Type_Face Les differents types geometriques de faces.">Faces</a>&amp; les_faces)
<a name="l00154"></a>00154 {
<a name="l00155"></a>00155   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l00156"></a>00156     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Zone_CoviMAC::reordonner les_faces &quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00157"></a>00157 
<a name="l00158"></a>00158 <span class="comment">// Construction de rang_elem_non_std_ :</span>
<a name="l00159"></a>00159 <span class="comment">// C&#39;est un vecteur indexe par les elements du domaine.</span>
<a name="l00160"></a>00160 <span class="comment">// size() = nb_elem()</span>
<a name="l00161"></a>00161 <span class="comment">// size_tot() = nb_elem_tot()</span>
<a name="l00162"></a>00162 <span class="comment">// Valeurs dans le tableau :</span>
<a name="l00163"></a>00163 <span class="comment">// rang_elem_non_std_[i] = -1 si l&#39;element i est standard,</span>
<a name="l00164"></a>00164 <span class="comment">// sinon</span>
<a name="l00165"></a>00165 <span class="comment">// rang_elem_non_std_[i] = j, ou j est l&#39;indice de l&#39;element dans</span>
<a name="l00166"></a>00166 <span class="comment">// les tableaux indexes par les elements non standards (par exemple</span>
<a name="l00167"></a>00167 <span class="comment">// le tableau Zone_Cl_CoviMAC::type_elem_Cl_).</span>
<a name="l00168"></a>00168 <span class="comment">// Un element est non standard s&#39;il est voisin d&#39;une face frontiere.</span>
<a name="l00169"></a>00169   {
<a name="l00170"></a>00170     <span class="keyword">const</span> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom = <a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>().<a class="code" href="classZone.html#a379ad2206b5a13a4f4f3df6d44c7546a" title="Renvoie le domaine dont la zone fait partie. (version const)">domaine</a>();
<a name="l00171"></a>00171     <span class="keyword">const</span> <span class="keywordtype">int</span> nb_elements = <a class="code" href="classZone__dis__base.html#a790cb2f6bc2928518799e748313d0eb3">nb_elem</a>();
<a name="l00172"></a>00172     <span class="keyword">const</span> <span class="keywordtype">int</span> nb_faces_front = <a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>().<a class="code" href="classZone.html#adb3970b0289aa1b0a38772011fd5d915" title="Renvoie le nombre de faces frontiere de la zone du type specifie. C&#39;est la somme des nombres de bords...">nb_faces_frontiere</a>();
<a name="l00173"></a>00173     dom.<a class="code" href="classDomaine.html#a5d820427207d7534f4993971b98630f0" title="Cree un tableau ayant une &quot;ligne&quot; par element du maillage. Pour l&#39;instant, erreur s&#39;il y a plus d&#39;u...">creer_tableau_elements</a>(<a class="code" href="classZone__CoviMAC.html#a487cca180430a8435033730d04781d2a" title="rang_elem_non_std_= -1 si l&#39;element est standard rang_elem_non_std_= rang de l&#39;element dans les table...">rang_elem_non_std_</a>);
<a name="l00174"></a>00174 <span class="comment">// rang_elem_non_std_.resize(nb_elements);</span>
<a name="l00175"></a>00175 <span class="comment">// Scatter::creer_tableau_distribue(dom, Joint::ELEMENT, rang_elem_non_std_);</span>
<a name="l00176"></a>00176     <a class="code" href="classZone__CoviMAC.html#a487cca180430a8435033730d04781d2a" title="rang_elem_non_std_= -1 si l&#39;element est standard rang_elem_non_std_= rang de l&#39;element dans les table...">rang_elem_non_std_</a> = -1;
<a name="l00177"></a>00177     <span class="keywordtype">int</span> nb_elems_non_std = 0;
<a name="l00178"></a>00178 <span class="comment">// D&#39;abord on marque les elements non standards avec rang_elem_non_std_[i] = 0</span>
<a name="l00179"></a>00179     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_face = 0; i_face &lt; nb_faces_front; i_face++)
<a name="l00180"></a>00180       {
<a name="l00181"></a>00181         <span class="keyword">const</span> <span class="keywordtype">int</span> elem = les_faces.<a class="code" href="classFaces.html#aa4c932a03838b3ee81d00e3359379933" title="Renvoie le numero du i-ieme voisin de face.">voisin</a>(i_face, 0);
<a name="l00182"></a>00182         <span class="keywordflow">if</span> (<a class="code" href="classZone__CoviMAC.html#a487cca180430a8435033730d04781d2a" title="rang_elem_non_std_= -1 si l&#39;element est standard rang_elem_non_std_= rang de l&#39;element dans les table...">rang_elem_non_std_</a>[elem] &lt; 0)
<a name="l00183"></a>00183           {
<a name="l00184"></a>00184             <a class="code" href="classZone__CoviMAC.html#a487cca180430a8435033730d04781d2a" title="rang_elem_non_std_= -1 si l&#39;element est standard rang_elem_non_std_= rang de l&#39;element dans les table...">rang_elem_non_std_</a>[elem] = 0;
<a name="l00185"></a>00185             nb_elems_non_std++;
<a name="l00186"></a>00186           }
<a name="l00187"></a>00187       }
<a name="l00188"></a>00188     <a class="code" href="classZone__CoviMAC.html#a38bc6b41c9a1f65b9056c247310a7df2" title="nombre d&#39;elements standard">nb_elem_std_</a> = nb_elements - nb_elems_non_std;
<a name="l00189"></a>00189     <a class="code" href="classZone__CoviMAC.html#a487cca180430a8435033730d04781d2a" title="rang_elem_non_std_= -1 si l&#39;element est standard rang_elem_non_std_= rang de l&#39;element dans les table...">rang_elem_non_std_</a>.<a class="code" href="classIntVect.html#ad12bea67621d1a0ee82b27c9a37ca4ef">echange_espace_virtuel</a>();
<a name="l00190"></a>00190     <span class="keywordtype">int</span> count = 0;
<a name="l00191"></a>00191     <span class="keyword">const</span> <span class="keywordtype">int</span> size_tot = <a class="code" href="classZone__CoviMAC.html#a487cca180430a8435033730d04781d2a" title="rang_elem_non_std_= -1 si l&#39;element est standard rang_elem_non_std_= rang de l&#39;element dans les table...">rang_elem_non_std_</a>.<a class="code" href="classIntVect.html#afa716e1f0a1f0f74f4f73e95b5651412" title="Identique a size_array()">size_totale</a>();
<a name="l00192"></a>00192 <span class="comment">// On remplace le marqueur &quot;0&quot; par l&#39;indice j.</span>
<a name="l00193"></a>00193     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> elem = 0; elem &lt; size_tot; elem++)
<a name="l00194"></a>00194       {
<a name="l00195"></a>00195         <span class="keywordflow">if</span> (<a class="code" href="classZone__CoviMAC.html#a487cca180430a8435033730d04781d2a" title="rang_elem_non_std_= -1 si l&#39;element est standard rang_elem_non_std_= rang de l&#39;element dans les table...">rang_elem_non_std_</a>[elem] == 0)
<a name="l00196"></a>00196           {
<a name="l00197"></a>00197             <a class="code" href="classZone__CoviMAC.html#a487cca180430a8435033730d04781d2a" title="rang_elem_non_std_= -1 si l&#39;element est standard rang_elem_non_std_= rang de l&#39;element dans les table...">rang_elem_non_std_</a>[elem] = count;
<a name="l00198"></a>00198             count++;
<a name="l00199"></a>00199           }
<a name="l00200"></a>00200       }
<a name="l00201"></a>00201   }
<a name="l00202"></a>00202 
<a name="l00203"></a>00203 <span class="comment">// Construction du tableau de renumerotation des faces. Ce tableau,</span>
<a name="l00204"></a>00204 <span class="comment">// une fois trie dans l&#39;ordre croissant donne l&#39;ordre des faces dans</span>
<a name="l00205"></a>00205 <span class="comment">// la zone_VF. La cle de tri est construite de sorte a pouvoir retrouver</span>
<a name="l00206"></a>00206 <span class="comment">// l&#39;indice de la face a partir de la cle par la formule :</span>
<a name="l00207"></a>00207 <span class="comment">// indice_face = cle % nb_faces</span>
<a name="l00208"></a>00208   <span class="keyword">const</span> <span class="keywordtype">int</span> nbfaces = les_faces.<a class="code" href="classFaces.html#a64d898edb20c3687d357018f1821c50a" title="Renvoie le nombre de Faces.">nb_faces</a>();
<a name="l00209"></a>00209   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> sort_key(nbfaces);
<a name="l00210"></a>00210   {
<a name="l00211"></a>00211     <a class="code" href="classZone__CoviMAC.html#a5b7693686eb859754457f0498ffebf2e" title="nombre de faces standard">nb_faces_std_</a> =0;
<a name="l00212"></a>00212     <span class="keyword">const</span> <span class="keywordtype">int</span> nb_faces_front = <a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>().<a class="code" href="classZone.html#adb3970b0289aa1b0a38772011fd5d915" title="Renvoie le nombre de faces frontiere de la zone du type specifie. C&#39;est la somme des nombres de bords...">nb_faces_frontiere</a>();
<a name="l00213"></a>00213 <span class="comment">// Attention : face_voisins_ n&#39;est pas encore initialise, il</span>
<a name="l00214"></a>00214 <span class="comment">// faut passer par les_faces.voisins() :</span>
<a name="l00215"></a>00215     <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; facevoisins = les_faces.<a class="code" href="classFaces.html#af49c4448e67aa7c732c2cc1dc237b442" title="Renvoie le tableau des voisins (des faces).">voisins</a>();
<a name="l00216"></a>00216 <span class="comment">// On place en premier les faces de bord:</span>
<a name="l00217"></a>00217     <span class="keywordtype">int</span> i_face;
<a name="l00218"></a>00218     <span class="keywordflow">for</span> (i_face = 0; i_face &lt; nbfaces; i_face++)
<a name="l00219"></a>00219       {
<a name="l00220"></a>00220         <span class="keywordtype">int</span> key = -1;
<a name="l00221"></a>00221         <span class="keywordflow">if</span> (i_face &lt; nb_faces_front)
<a name="l00222"></a>00222           {
<a name="l00223"></a>00223 <span class="comment">// Si la face est au bord, elle doit etre placee au debut</span>
<a name="l00224"></a>00224 <span class="comment">// (en fait elle ne doit pas etre renumerotee)</span>
<a name="l00225"></a>00225             key = i_face;
<a name="l00226"></a>00226           }
<a name="l00227"></a>00227         <span class="keywordflow">else</span>
<a name="l00228"></a>00228           {
<a name="l00229"></a>00229             <span class="keyword">const</span> <span class="keywordtype">int</span> elem0 = facevoisins(i_face, 0);
<a name="l00230"></a>00230             <span class="keyword">const</span> <span class="keywordtype">int</span> elem1 = facevoisins(i_face, 1);
<a name="l00231"></a>00231 <span class="comment">// Ces faces ont toujours deux voisins.</span>
<a name="l00232"></a>00232             assert(elem0 &gt;= 0 &amp;&amp; elem1 &gt;= 0);
<a name="l00233"></a>00233             <span class="keywordflow">if</span> (<a class="code" href="classZone__CoviMAC.html#a487cca180430a8435033730d04781d2a" title="rang_elem_non_std_= -1 si l&#39;element est standard rang_elem_non_std_= rang de l&#39;element dans les table...">rang_elem_non_std_</a>[elem0] &gt;= 0 || <a class="code" href="classZone__CoviMAC.html#a487cca180430a8435033730d04781d2a" title="rang_elem_non_std_= -1 si l&#39;element est standard rang_elem_non_std_= rang de l&#39;element dans les table...">rang_elem_non_std_</a>[elem1] &gt;= 0)
<a name="l00234"></a>00234               {
<a name="l00235"></a>00235 <span class="comment">// Si la face est voisine d&#39;un element non standard, elle</span>
<a name="l00236"></a>00236 <span class="comment">// doit etre classee juste apres les faces de bord:</span>
<a name="l00237"></a>00237                 key = i_face;
<a name="l00238"></a>00238               }
<a name="l00239"></a>00239             <span class="keywordflow">else</span>
<a name="l00240"></a>00240               {
<a name="l00241"></a>00241 <span class="comment">// Face standard : a la fin du tableau</span>
<a name="l00242"></a>00242                 key = i_face + nbfaces;
<a name="l00243"></a>00243                 <a class="code" href="classZone__CoviMAC.html#a5b7693686eb859754457f0498ffebf2e" title="nombre de faces standard">nb_faces_std_</a>++;
<a name="l00244"></a>00244               }
<a name="l00245"></a>00245           }
<a name="l00246"></a>00246         sort_key[i_face] = key;
<a name="l00247"></a>00247       }
<a name="l00248"></a>00248     sort_key.<a class="code" href="classArrOfInt.html#abb0f48cf5a4be4b70edcc90baaebd521" title="Tri des valeurs du tableau dans l&#39;ordre croissant. La fonction utilisee est qsort de stdlib (elle est...">ordonne_array</a>();
<a name="l00249"></a>00249 
<a name="l00250"></a>00250 <span class="comment">// On transforme a nouveau la cle en numero de face:</span>
<a name="l00251"></a>00251     <span class="keywordflow">for</span> (i_face = 0; i_face &lt; nbfaces; i_face++)
<a name="l00252"></a>00252       {
<a name="l00253"></a>00253         <span class="keyword">const</span> <span class="keywordtype">int</span> key = sort_key[i_face] % nbfaces;
<a name="l00254"></a>00254         sort_key[i_face] = key;
<a name="l00255"></a>00255       }
<a name="l00256"></a>00256   }
<a name="l00257"></a>00257 <span class="comment">// On reordonne les faces:</span>
<a name="l00258"></a>00258   {
<a name="l00259"></a>00259     <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; faces_sommets = les_faces.<a class="code" href="classFaces.html#a07b8d8db9e3d656b93a21a49c063430c">les_sommets</a>();
<a name="l00260"></a>00260     <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a> old_tab(faces_sommets);
<a name="l00261"></a>00261     <span class="keyword">const</span> <span class="keywordtype">int</span> nb_som_faces = faces_sommets.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1);
<a name="l00262"></a>00262     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nbfaces; i++)
<a name="l00263"></a>00263       {
<a name="l00264"></a>00264         <span class="keyword">const</span> <span class="keywordtype">int</span> old_i = sort_key[i];
<a name="l00265"></a>00265         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; nb_som_faces; j++)
<a name="l00266"></a>00266           faces_sommets(i, j) = old_tab(old_i, j);
<a name="l00267"></a>00267       }
<a name="l00268"></a>00268   }
<a name="l00269"></a>00269 
<a name="l00270"></a>00270   {
<a name="l00271"></a>00271     <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; faces_voisins = les_faces.<a class="code" href="classFaces.html#af49c4448e67aa7c732c2cc1dc237b442" title="Renvoie le tableau des voisins (des faces).">voisins</a>();
<a name="l00272"></a>00272     <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a> old_tab(faces_voisins);
<a name="l00273"></a>00273     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nbfaces; i++)
<a name="l00274"></a>00274       {
<a name="l00275"></a>00275         <span class="keyword">const</span> <span class="keywordtype">int</span> old_i = sort_key[i];
<a name="l00276"></a>00276         faces_voisins(i, 0) = old_tab(old_i, 0);
<a name="l00277"></a>00277         faces_voisins(i, 1) = old_tab(old_i, 1);
<a name="l00278"></a>00278       }
<a name="l00279"></a>00279   }
<a name="l00280"></a>00280 
<a name="l00281"></a>00281 <span class="comment">// Calcul de la table inversee: reverse_index[ancien_numero] = nouveau numero</span>
<a name="l00282"></a>00282   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> reverse_index(nbfaces);
<a name="l00283"></a>00283   {
<a name="l00284"></a>00284     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nbfaces; i++)
<a name="l00285"></a>00285       {
<a name="l00286"></a>00286         <span class="keyword">const</span> <span class="keywordtype">int</span> j = sort_key[i];
<a name="l00287"></a>00287         reverse_index[j] = i;
<a name="l00288"></a>00288       }
<a name="l00289"></a>00289   }
<a name="l00290"></a>00290 <span class="comment">// Renumerotation de elem_faces:</span>
<a name="l00291"></a>00291   {
<a name="l00292"></a>00292 <span class="comment">// Nombre d&#39;indices de faces dans le tableau</span>
<a name="l00293"></a>00293     <span class="keyword">const</span> <span class="keywordtype">int</span> nb_items = <a class="code" href="classZone__VF.html#acd9376481d4268df6a0c394c5a1a0e61" title="connectivite element/faces">elem_faces_</a>.<a class="code" href="classIntVect.html#ad90cfd411cbbd631ccf1935bb36f7c40" title="Identique a size_reelle()">size</a>();
<a name="l00294"></a>00294     <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; array = <a class="code" href="classZone__VF.html#acd9376481d4268df6a0c394c5a1a0e61" title="connectivite element/faces">elem_faces_</a>;
<a name="l00295"></a>00295     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_items; i++)
<a name="l00296"></a>00296       {
<a name="l00297"></a>00297         <span class="keyword">const</span> <span class="keywordtype">int</span> old = array[i];
<a name="l00298"></a>00298         <span class="keywordflow">if</span> (old&lt;0)
<a name="l00299"></a>00299           array[i] = -1;
<a name="l00300"></a>00300         <span class="keywordflow">else</span>
<a name="l00301"></a>00301           array[i] = reverse_index[old];
<a name="l00302"></a>00302       }
<a name="l00303"></a>00303   }
<a name="l00304"></a>00304 <span class="comment">// Mise a jour des indices des faces de joint:</span>
<a name="l00305"></a>00305   {
<a name="l00306"></a>00306     <a class="code" href="classJoints.html" title="Classe Joints Cette classe represente une liste d&#39;objet de type Joint.">Joints</a>&amp;      joints    = <a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>().<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>();
<a name="l00307"></a>00307     <span class="keyword">const</span> <span class="keywordtype">int</span> nbjoints = joints.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>();
<a name="l00308"></a>00308     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_joint = 0; i_joint &lt; nbjoints; i_joint++)
<a name="l00309"></a>00309       {
<a name="l00310"></a>00310         <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp;     un_joint         = joints[i_joint];
<a name="l00311"></a>00311         <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; indices_faces = un_joint.<a class="code" href="classJoint.html#aa1c4d729a3017082d26907d82ad1d7de" title="Renvoie les informations de joint pour un type d&#39;item geometrique donne, pour remplissage des structu...">set_joint_item</a>(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926ab255b88987fc7f64c215c958cbe2af6b">Joint::FACE</a>).<a class="code" href="classJoint__Items.html#aa01c4601d506c658f4f1d45e66951ce0" title="Renvoie le tableau items_communs_ pour le remplir. (BM: ce tableau n&#39;est pas encore rempli)...">set_items_communs</a>();
<a name="l00312"></a>00312         <span class="keyword">const</span> <span class="keywordtype">int</span> nbfaces2    = indices_faces.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00313"></a>00313         assert(nbfaces2 == un_joint.<a class="code" href="classFrontiere.html#aa073fe9dbdddde59471ee7032b256aa2" title="Renvoie le nombre de faces de la frontiere.">nb_faces</a>()); <span class="comment">//!&lt; renum_items_communs rempli ?</span>
<a name="l00314"></a>00314 <span class="comment"></span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nbfaces2; i++)
<a name="l00315"></a>00315           {
<a name="l00316"></a>00316             <span class="keyword">const</span> <span class="keywordtype">int</span> old = indices_faces[i]; <span class="comment">//!&lt; ancien indice local</span>
<a name="l00317"></a>00317 <span class="comment"></span>            indices_faces[i] = reverse_index[old];
<a name="l00318"></a>00318           }
<a name="l00319"></a>00319 <span class="comment">// Les faces de joint ne sont plus consecutives dans le</span>
<a name="l00320"></a>00320 <span class="comment">// tableau: num_premiere_face n&#39;a plus ne sens</span>
<a name="l00321"></a>00321         un_joint.<a class="code" href="classFrontiere.html#a66cbd407fb5a1611b9aca04bddd0f6e0">fixer_num_premiere_face</a>(-1);
<a name="l00322"></a>00322       }
<a name="l00323"></a>00323   }
<a name="l00324"></a>00324 }
<a name="l00325"></a>00325 
<a name="l00326"></a><a class="code" href="classZone__CoviMAC.html#acb36849f94ef507261c1f135f530f129">00326</a> <span class="keywordtype">void</span> <a class="code" href="classZone__CoviMAC.html#acb36849f94ef507261c1f135f530f129">Zone_CoviMAC::typer_elem</a>(<a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone_geom)
<a name="l00327"></a>00327 {
<a name="l00328"></a>00328   <span class="keyword">const</span> <a class="code" href="classElem__geom__base.html" title="Classe Elem_geom_base Cette classe est la classe de base pour la definition d&#39;elements geometriques c...">Elem_geom_base</a>&amp; type_elem_geom = zone_geom.<a class="code" href="classZone.html#a18cf83cd0f9c368dcfa32fb802a0ac94" title="Renvoie un element geometrique du type de ceux qui constituent la zone. (version const)">type_elem</a>().<a class="code" href="classDeriv__Elem__geom__base.html#a384b487459a33f9f521fb16539ec81de">valeur</a>();
<a name="l00329"></a>00329 
<a name="l00330"></a>00330   <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classRectangle.html" title="Classe Rectangle Cette classe represente l&#39;element geometrique Rectangle. Un rectangle a 4 faces...">Rectangle</a>,type_elem_geom))
<a name="l00331"></a>00331     {
<a name="l00332"></a>00332       zone_geom.<a class="code" href="classZone.html#ac1ff391994a372815b7f88c3fdc39f55" title="Type les elements de la zone avec le nom passe en parametre. Et associe le type d&#39;element a la zone...">typer</a>(<span class="stringliteral">&quot;Quadrangle&quot;</span>);
<a name="l00333"></a>00333     }
<a name="l00334"></a>00334   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classHexaedre.html" title="Classe Hexaedre Cette represente un element geometrique a 6 faces, 8 sommets et un seul type de face ...">Hexaedre</a>,type_elem_geom))
<a name="l00335"></a>00335     zone_geom.<a class="code" href="classZone.html#ac1ff391994a372815b7f88c3fdc39f55" title="Type les elements de la zone avec le nom passe en parametre. Et associe le type d&#39;element a la zone...">typer</a>(<span class="stringliteral">&quot;Hexaedre_VEF&quot;</span>);
<a name="l00336"></a>00336 
<a name="l00337"></a>00337   <span class="keyword">const</span> <a class="code" href="classElem__geom__base.html" title="Classe Elem_geom_base Cette classe est la classe de base pour la definition d&#39;elements geometriques c...">Elem_geom_base</a>&amp; elem_geom = zone_geom.<a class="code" href="classZone.html#a18cf83cd0f9c368dcfa32fb802a0ac94" title="Renvoie un element geometrique du type de ceux qui constituent la zone. (version const)">type_elem</a>().<a class="code" href="classDeriv__Elem__geom__base.html#a384b487459a33f9f521fb16539ec81de">valeur</a>();
<a name="l00338"></a>00338   <a class="code" href="classZone__CoviMAC.html#ade3043ff73b93b8b29fa74746784d92b" title="type de l&#39;element de discretisation">type_elem_</a>.<a class="code" href="classElem__CoviMAC.html#ac478fe5111a4b2cbb0f2e755ad4bc83b" title="determination du type">typer</a>(elem_geom.<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>());
<a name="l00339"></a>00339 }
<a name="l00340"></a>00340 
<a name="l00341"></a><a class="code" href="classZone__CoviMAC.html#a4ca0ba4761b0b724df06116e3ba8816a">00341</a> <span class="keywordtype">void</span> <a class="code" href="classZone__CoviMAC.html#a4ca0ba4761b0b724df06116e3ba8816a" title="Genere les faces construits les frontieres.">Zone_CoviMAC::discretiser</a>()
<a name="l00342"></a>00342 {
<a name="l00343"></a>00343 
<a name="l00344"></a>00344   <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone_geom=<a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>();
<a name="l00345"></a>00345   <a class="code" href="classZone__CoviMAC.html#acb36849f94ef507261c1f135f530f129">typer_elem</a>(zone_geom);
<a name="l00346"></a>00346   <a class="code" href="classElem__geom__base.html" title="Classe Elem_geom_base Cette classe est la classe de base pour la definition d&#39;elements geometriques c...">Elem_geom_base</a>&amp; elem_geom = zone_geom.<a class="code" href="classZone.html#a18cf83cd0f9c368dcfa32fb802a0ac94" title="Renvoie un element geometrique du type de ceux qui constituent la zone. (version const)">type_elem</a>().<a class="code" href="classDeriv__Elem__geom__base.html#a384b487459a33f9f521fb16539ec81de">valeur</a>();
<a name="l00347"></a>00347   <a class="code" href="classZone__CoviMAC.html#a4ca0ba4761b0b724df06116e3ba8816a" title="Genere les faces construits les frontieres.">Zone_VF::discretiser</a>();
<a name="l00348"></a>00348 
<a name="l00349"></a>00349 <span class="comment">// Correction du tableau facevoisins:</span>
<a name="l00350"></a>00350 <span class="comment">// A l&#39;issue de Zone_VF::discretiser(), les elements voisins 0 et 1 d&#39;une</span>
<a name="l00351"></a>00351 <span class="comment">// face sont les memes sur tous les processeurs qui possedent la face.</span>
<a name="l00352"></a>00352 <span class="comment">// Si la face est virtuelle et qu&#39;un des deux elements voisins n&#39;est</span>
<a name="l00353"></a>00353 <span class="comment">// pas connu (il n&#39;est pas dans l&#39;epaisseur du joint), l&#39;element voisin</span>
<a name="l00354"></a>00354 <span class="comment">// vaut -1. Cela peut etre un voisin 0 ou un voisin 1.</span>
<a name="l00355"></a>00355 <span class="comment">// On corrige les faces virtuelles pour que, si un element voisin n&#39;est</span>
<a name="l00356"></a>00356 <span class="comment">// pas connu, alors il est voisin1. Le voisin0 est donc toujours valide.</span>
<a name="l00357"></a>00357   {
<a name="l00358"></a>00358     <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; <a class="code" href="Zone__VDF_8cpp.html#a6edff0459a52988927869a8a2eb5573c">face_vois</a> = <a class="code" href="classZone__VF.html#a816ac37fd526f962468cae6fbd8061f8" title="renvoie le tableaux des volumes des connectivites face elements cf au dessus.">face_voisins</a>();
<a name="l00359"></a>00359     <span class="keyword">const</span> <span class="keywordtype">int</span> debut = <a class="code" href="classZone__VF.html#aede27992d9f2eedd52c24d4a80ff7ffb" title="renvoie le nombre global de faces.">nb_faces</a>();
<a name="l00360"></a>00360     <span class="keyword">const</span> <span class="keywordtype">int</span> fin   = <a class="code" href="classZone__VF.html#a50fd21c9535680489015a3c8b88c685a" title="renvoie le nombre total de faces. C&#39;est-a-dire faces reelles + faces virtuelles">nb_faces_tot</a>();
<a name="l00361"></a>00361     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = debut; i &lt; fin; i++)
<a name="l00362"></a>00362       {
<a name="l00363"></a>00363         <span class="keywordflow">if</span> (<a class="code" href="classZone__VF.html#a816ac37fd526f962468cae6fbd8061f8" title="renvoie le tableaux des volumes des connectivites face elements cf au dessus.">face_voisins</a>(i, 0) == -1)
<a name="l00364"></a>00364           {
<a name="l00365"></a>00365             <a class="code" href="Zone__VDF_8cpp.html#a6edff0459a52988927869a8a2eb5573c">face_vois</a>(i, 0) = <a class="code" href="Zone__VDF_8cpp.html#a6edff0459a52988927869a8a2eb5573c">face_vois</a>(i, 1);
<a name="l00366"></a>00366             <a class="code" href="Zone__VDF_8cpp.html#a6edff0459a52988927869a8a2eb5573c">face_vois</a>(i, 1) = -1;
<a name="l00367"></a>00367           }
<a name="l00368"></a>00368       }
<a name="l00369"></a>00369   }
<a name="l00370"></a>00370 
<a name="l00371"></a>00371 <span class="comment">// Verification de la coherence entre l&#39;element geometrique et</span>
<a name="l00372"></a>00372 <span class="comment">// l&#39;elemnt de discretisation</span>
<a name="l00373"></a>00373 
<a name="l00374"></a>00374 
<a name="l00375"></a>00375   <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classSegment__CoviMAC.html">Segment_CoviMAC</a>,<a class="code" href="classZone__CoviMAC.html#ade3043ff73b93b8b29fa74746784d92b" title="type de l&#39;element de discretisation">type_elem_</a>.<a class="code" href="classDeriv__Elem__CoviMAC__base.html#a92e9fb4957278b62d345f9b3361b2a67">valeur</a>()))
<a name="l00376"></a>00376     {
<a name="l00377"></a>00377       <span class="keywordflow">if</span> (!<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classSegment.html" title="Classe Segment Cette classe represente l&#39;element geometrique segment. Un segment a 1 face et 2 sommet...">Segment</a>,elem_geom))
<a name="l00378"></a>00378         {
<a name="l00379"></a>00379           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Le type de l&#39;element geometrique &quot;</span> &lt;&lt; elem_geom.<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; <span class="stringliteral">&quot; est incorrect&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00380"></a>00380           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00381"></a>00381         }
<a name="l00382"></a>00382     }
<a name="l00383"></a>00383   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classTri__CoviMAC.html">Tri_CoviMAC</a>,<a class="code" href="classZone__CoviMAC.html#ade3043ff73b93b8b29fa74746784d92b" title="type de l&#39;element de discretisation">type_elem_</a>.<a class="code" href="classDeriv__Elem__CoviMAC__base.html#a92e9fb4957278b62d345f9b3361b2a67">valeur</a>()))
<a name="l00384"></a>00384     {
<a name="l00385"></a>00385       <span class="keywordflow">if</span> (!<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classTriangle.html" title="Classe Triangle Cette classe represente l&#39;element geometrique Triangle. Un triangle a 3 faces...">Triangle</a>,elem_geom))
<a name="l00386"></a>00386         {
<a name="l00387"></a>00387           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Le type de l&#39;element geometrique &quot;</span> &lt;&lt;
<a name="l00388"></a>00388                elem_geom.<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; <span class="stringliteral">&quot; est incorrect&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00389"></a>00389           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Seul le type Triangle est compatible avec la discretisation CoviMAC en dimension 2&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00390"></a>00390           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Il faut trianguler le domaine lorsqu&#39;on utilise le mailleur interne&quot;</span> ;
<a name="l00391"></a>00391           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; en utilisant l&#39;instruction: Trianguler nom_dom&quot;</span> &lt;&lt; finl;
<a name="l00392"></a>00392           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00393"></a>00393         }
<a name="l00394"></a>00394     }
<a name="l00395"></a>00395   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classTetra__CoviMAC.html">Tetra_CoviMAC</a>,<a class="code" href="classZone__CoviMAC.html#ade3043ff73b93b8b29fa74746784d92b" title="type de l&#39;element de discretisation">type_elem_</a>.<a class="code" href="classDeriv__Elem__CoviMAC__base.html#a92e9fb4957278b62d345f9b3361b2a67">valeur</a>()))
<a name="l00396"></a>00396     {
<a name="l00397"></a>00397       <span class="keywordflow">if</span> (!<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classTetraedre.html" title="Classe Tetraedre Cette classe represente l&#39;element geometrique Tetraedre. Un tetraedre est un polyedr...">Tetraedre</a>,elem_geom))
<a name="l00398"></a>00398         {
<a name="l00399"></a>00399           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Le type de l&#39;element geometrique &quot;</span> &lt;&lt;
<a name="l00400"></a>00400                elem_geom.<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; <span class="stringliteral">&quot; est incorrect&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00401"></a>00401           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Seul le type Tetraedre est compatible avec la discretisation CoviMAC en dimension 3&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00402"></a>00402           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Il faut tetraedriser le domaine lorsqu&#39;on utilise le mailleur interne&quot;</span>;
<a name="l00403"></a>00403           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; en utilisant l&#39;instruction: Tetraedriser nom_dom&quot;</span> &lt;&lt; finl;
<a name="l00404"></a>00404           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00405"></a>00405         }
<a name="l00406"></a>00406     }
<a name="l00407"></a>00407 
<a name="l00408"></a>00408   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classQuadri__CoviMAC.html">Quadri_CoviMAC</a>,<a class="code" href="classZone__CoviMAC.html#ade3043ff73b93b8b29fa74746784d92b" title="type de l&#39;element de discretisation">type_elem_</a>.<a class="code" href="classDeriv__Elem__CoviMAC__base.html#a92e9fb4957278b62d345f9b3361b2a67">valeur</a>()))
<a name="l00409"></a>00409     {
<a name="l00410"></a>00410 
<a name="l00411"></a>00411       <span class="keywordflow">if</span> (!<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classQuadrangle__VEF.html" title="Classe Quadrangle_VEF Cette classe represente l&#39;element geometrique Quadrangle_VEF. Un Quadrangle_VEF a 4 faces, 4 sommets et un seul type de face ayant 2 sommets par face.">Quadrangle_VEF</a>,elem_geom))
<a name="l00412"></a>00412         {
<a name="l00413"></a>00413           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Le type de l&#39;element geometrique &quot;</span> &lt;&lt; elem_geom.<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; <span class="stringliteral">&quot; est incorrect&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00414"></a>00414           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00415"></a>00415         }
<a name="l00416"></a>00416     }
<a name="l00417"></a>00417   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classHexa__CoviMAC.html">Hexa_CoviMAC</a>,<a class="code" href="classZone__CoviMAC.html#ade3043ff73b93b8b29fa74746784d92b" title="type de l&#39;element de discretisation">type_elem_</a>.<a class="code" href="classDeriv__Elem__CoviMAC__base.html#a92e9fb4957278b62d345f9b3361b2a67">valeur</a>()))
<a name="l00418"></a>00418     {
<a name="l00419"></a>00419 
<a name="l00420"></a>00420       <span class="keywordflow">if</span> (!<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classHexaedre__VEF.html" title="Classe Hexaedre_VEF Cette classe represente l&#39;element geometrique Hexaedre_VEF. Un Hexaedre_VEF est u...">Hexaedre_VEF</a>,elem_geom))
<a name="l00421"></a>00421         {
<a name="l00422"></a>00422           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Le type de l&#39;element geometrique &quot;</span> &lt;&lt; elem_geom.<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; <span class="stringliteral">&quot; est incorrect&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00423"></a>00423           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00424"></a>00424         }
<a name="l00425"></a>00425     }
<a name="l00426"></a>00426 
<a name="l00427"></a>00427   <span class="keywordtype">int</span> num_face;
<a name="l00428"></a>00428 
<a name="l00429"></a>00429 
<a name="l00430"></a>00430 <span class="comment">// On remplit le tableau face_normales_;</span>
<a name="l00431"></a>00431 <span class="comment">// Attention : le tableau face_voisins n&#39;est pas exactement un</span>
<a name="l00432"></a>00432 <span class="comment">// tableau distribue. Une face n&#39;a pas ses deux voisins dans le</span>
<a name="l00433"></a>00433 <span class="comment">// meme ordre sur tous les processeurs qui possedent la face.</span>
<a name="l00434"></a>00434 <span class="comment">// Donc la normale a la face peut changer de direction d&#39;un</span>
<a name="l00435"></a>00435 <span class="comment">// processeur a l&#39;autre, y compris pour les faces de joint.</span>
<a name="l00436"></a>00436   {
<a name="l00437"></a>00437     <span class="keyword">const</span> <span class="keywordtype">int</span> n = <a class="code" href="classZone__VF.html#aede27992d9f2eedd52c24d4a80ff7ffb" title="renvoie le nombre global de faces.">nb_faces</a>();
<a name="l00438"></a>00438     <a class="code" href="classZone__CoviMAC.html#a158fd977594473b89e67bdc19c8514fc" title="normales aux faces">face_normales_</a>.<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(n, <a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>);
<a name="l00439"></a>00439 <span class="comment">// const Domaine &amp; dom = zone().domaine();</span>
<a name="l00440"></a>00440 <span class="comment">// Scatter::creer_tableau_distribue(dom, Joint::FACE, face_normales_);</span>
<a name="l00441"></a>00441     <a class="code" href="classZone__VF.html#a8e02e68f236356f72728b82536538ac5">creer_tableau_faces</a>(<a class="code" href="classZone__CoviMAC.html#a158fd977594473b89e67bdc19c8514fc" title="normales aux faces">face_normales_</a>);
<a name="l00442"></a>00442     <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; face_som = <a class="code" href="classZone__VF.html#a6cac6a6e8fc1e7b0381b7b15eb451257" title="renvoie le tableau de connectivite faces/sommets.">face_sommets</a>();
<a name="l00443"></a>00443     <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; <a class="code" href="Zone__VDF_8cpp.html#a6edff0459a52988927869a8a2eb5573c">face_vois</a> = <a class="code" href="classZone__VF.html#a816ac37fd526f962468cae6fbd8061f8" title="renvoie le tableaux des volumes des connectivites face elements cf au dessus.">face_voisins</a>();
<a name="l00444"></a>00444     <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; elem_face = <a class="code" href="classZone__VF.html#a8e09b61902b9f1d2c4c7bedc3b8f39d3" title="renvoie le tableau de connectivite element/faces">elem_faces</a>();
<a name="l00445"></a>00445     <span class="keyword">const</span> <span class="keywordtype">int</span> n_tot = <a class="code" href="classZone__VF.html#a50fd21c9535680489015a3c8b88c685a" title="renvoie le nombre total de faces. C&#39;est-a-dire faces reelles + faces virtuelles">nb_faces_tot</a>();
<a name="l00446"></a>00446     <span class="keywordflow">for</span> (num_face = 0; num_face &lt; n_tot; num_face++)
<a name="l00447"></a>00447       {
<a name="l00448"></a>00448         <a class="code" href="classZone__CoviMAC.html#ade3043ff73b93b8b29fa74746784d92b" title="type de l&#39;element de discretisation">type_elem_</a>.<a class="code" href="classElem__CoviMAC.html#a151d5e71d3e028733ff2e0a16194a37a">normale</a>(num_face,
<a name="l00449"></a>00449                            <a class="code" href="classZone__CoviMAC.html#a158fd977594473b89e67bdc19c8514fc" title="normales aux faces">face_normales_</a>,
<a name="l00450"></a>00450                            face_som, face_vois, elem_face, zone_geom);
<a name="l00451"></a>00451       }
<a name="l00452"></a>00452 
<a name="l00453"></a>00453     <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> old(<a class="code" href="classZone__CoviMAC.html#a158fd977594473b89e67bdc19c8514fc" title="normales aux faces">face_normales_</a>);
<a name="l00454"></a>00454     <a class="code" href="classZone__CoviMAC.html#a158fd977594473b89e67bdc19c8514fc" title="normales aux faces">face_normales_</a>.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l00455"></a>00455     <span class="keywordflow">for</span> (num_face = 0; num_face &lt; n_tot; num_face++)
<a name="l00456"></a>00456       {
<a name="l00457"></a>00457         <span class="keywordtype">int</span> <span class="keywordtype">id</span>=1;
<a name="l00458"></a>00458         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> d=0; d&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; d++)
<a name="l00459"></a>00459           <span class="keywordflow">if</span> (!<a class="code" href="Double_8h.html#ac86f5f350b0f95fd8c34b0ac8d720f6f">est_egal</a>(old(num_face,d),<a class="code" href="classZone__CoviMAC.html#a158fd977594473b89e67bdc19c8514fc" title="normales aux faces">face_normales_</a>(num_face,d)))
<a name="l00460"></a>00460             {
<a name="l00461"></a>00461               <span class="keywordtype">id</span>=0;
<a name="l00462"></a>00462               <span class="keywordflow">if</span> (!<a class="code" href="Double_8h.html#ac86f5f350b0f95fd8c34b0ac8d720f6f">est_egal</a>(old(num_face,d),-<a class="code" href="classZone__CoviMAC.html#a158fd977594473b89e67bdc19c8514fc" title="normales aux faces">face_normales_</a>(num_face,d)))
<a name="l00463"></a>00463                 {
<a name="l00464"></a>00464                   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;pb in faces_normales&quot;</span> &lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00465"></a>00465                   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00466"></a>00466                 }
<a name="l00467"></a>00467             }
<a name="l00468"></a>00468         <span class="keywordflow">if</span> (<span class="keywordtype">id</span>==0)
<a name="l00469"></a>00469           {
<a name="l00470"></a>00470 <span class="comment">// on a change le sens de la normale, on inverse elem1 elem2</span>
<a name="l00471"></a>00471             <a class="code" href="AssembleurPP1BUtil_8cpp.html#a3117b050530c46b4a15b6ab9ce6d0b41">std::swap</a>(<a class="code" href="Zone__VDF_8cpp.html#a6edff0459a52988927869a8a2eb5573c">face_vois</a>(num_face,0),<a class="code" href="Zone__VDF_8cpp.html#a6edff0459a52988927869a8a2eb5573c">face_vois</a>(num_face,1));
<a name="l00472"></a>00472           }
<a name="l00473"></a>00473       }
<a name="l00474"></a>00474   }
<a name="l00475"></a>00475 
<a name="l00476"></a>00476   <span class="comment">/* recalcul de xv pour avoir les vrais CG des faces */</span>
<a name="l00477"></a>00477   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; coords = <a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>().<a class="code" href="classZone.html#a379ad2206b5a13a4f4f3df6d44c7546a" title="Renvoie le domaine dont la zone fait partie. (version const)">domaine</a>().<a class="code" href="classDomaine.html#aecd32c3eecc15cce7d1a0e468dadbf96" title="Renvoie le tableau des coordonnees des noeuds (sommets). (acces en lecture)">coord_sommets</a>();
<a name="l00478"></a>00478   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> face = 0; <a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a> == 3 &amp;&amp; face &lt; <a class="code" href="classZone__VF.html#aede27992d9f2eedd52c24d4a80ff7ffb" title="renvoie le nombre global de faces.">nb_faces</a>(); face++)
<a name="l00479"></a>00479     {
<a name="l00480"></a>00480       <span class="keywordtype">double</span> xs[3] = { 0, }, S = 0;
<a name="l00481"></a>00481       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; <a class="code" href="classZone__VF.html#aed9555a55cac4a6ce8af5662cea174a1" title="sommets des faces">face_sommets_</a>.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1); k++) <span class="keywordflow">if</span> (<a class="code" href="classZone__VF.html#aed9555a55cac4a6ce8af5662cea174a1" title="sommets des faces">face_sommets_</a>(face, k) &gt;= 0)
<a name="l00482"></a>00482           {
<a name="l00483"></a>00483             <span class="keywordtype">int</span> s0 = <a class="code" href="classZone__VF.html#aed9555a55cac4a6ce8af5662cea174a1" title="sommets des faces">face_sommets_</a>(face, 0), s1 = <a class="code" href="classZone__VF.html#aed9555a55cac4a6ce8af5662cea174a1" title="sommets des faces">face_sommets_</a>(face, k),
<a name="l00484"></a>00484                 s2 = k + 1 &lt; <a class="code" href="classZone__VF.html#aed9555a55cac4a6ce8af5662cea174a1" title="sommets des faces">face_sommets_</a>.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1) &amp;&amp; <a class="code" href="classZone__VF.html#aed9555a55cac4a6ce8af5662cea174a1" title="sommets des faces">face_sommets_</a>(face, k + 1) &gt;= 0 ? <a class="code" href="classZone__VF.html#aed9555a55cac4a6ce8af5662cea174a1" title="sommets des faces">face_sommets_</a>(face, k +1) : s0;
<a name="l00485"></a>00485             <span class="keywordtype">double</span> s = 0;
<a name="l00486"></a>00486             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> r = 0; r &lt; 3; r++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 2; i++)
<a name="l00487"></a>00487                 s += (i ? -1 : 1) * <a class="code" href="classZone__CoviMAC.html#a158fd977594473b89e67bdc19c8514fc" title="normales aux faces">face_normales_</a>(face, r) * (coords(s2, (r + 1 +  i) % 3) - coords(s0, (r + 1 +  i) % 3))
<a name="l00488"></a>00488                      * (coords(s1, (r + 1 + !i) % 3) - coords(s0, (r + 1 + !i) % 3));
<a name="l00489"></a>00489             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> r = 0; r &lt; 3; r++) xs[r] += s * (coords(s0, r) + coords(s1, r) + coords(s2, r)) / 3;
<a name="l00490"></a>00490             S += s;
<a name="l00491"></a>00491           }
<a name="l00492"></a>00492       <span class="keywordflow">if</span> (S == 0 &amp;&amp; <a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classHexa__CoviMAC.html">Hexa_CoviMAC</a>,<a class="code" href="classZone__CoviMAC.html#ade3043ff73b93b8b29fa74746784d92b" title="type de l&#39;element de discretisation">type_elem_</a>.<a class="code" href="classDeriv__Elem__CoviMAC__base.html#a92e9fb4957278b62d345f9b3361b2a67">valeur</a>()))
<a name="l00493"></a>00493         {
<a name="l00494"></a>00494           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;===============================&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00495"></a>00495           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in your mesh for PolyMAC!&quot;</span> &lt;&lt; finl;
<a name="l00496"></a>00496           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Add this keyword before discretization in your data file to create polyedras:&quot;</span> &lt;&lt; finl;
<a name="l00497"></a>00497           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Polyedriser &quot;</span> &lt;&lt; <a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>().<a class="code" href="classZone.html#a379ad2206b5a13a4f4f3df6d44c7546a" title="Renvoie le domaine dont la zone fait partie. (version const)">domaine</a>().<a class="code" href="classDomaine.html#a87e2cdc035a26565e6fe481446aa4cd3" title="Renvoie le nom du domaine.">le_nom</a>() &lt;&lt; finl;
<a name="l00498"></a>00498           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00499"></a>00499         }
<a name="l00500"></a>00500       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> r = 0; r &lt; 3; r++) <a class="code" href="classZone__VF.html#a30d5c38f1825d8d35ce9c83aa37e5aa6" title="centres de gravite des faces">xv_</a>(face, r) = xs[r] / S;
<a name="l00501"></a>00501     }
<a name="l00502"></a>00502   <a class="code" href="classZone__VF.html#a30d5c38f1825d8d35ce9c83aa37e5aa6" title="centres de gravite des faces">xv_</a>.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l00503"></a>00503 
<a name="l00504"></a>00504   <a class="code" href="classZone__CoviMAC.html#a9f723b28d3650a26988603996ee1c852">detecter_faces_non_planes</a>();
<a name="l00505"></a>00505 
<a name="l00506"></a>00506 <span class="comment">// MD_vector pour Champ_Face_CoviMAC (faces + dimension * champ_p0)</span>
<a name="l00507"></a>00507   <a class="code" href="classMD__Vector__composite.html" title="Metadata for a distributed composite vector. This class describes a vector that contains one or more ...">MD_Vector_composite</a> mdc_ch_face;
<a name="l00508"></a>00508   mdc_ch_face.<a class="code" href="classMD__Vector__composite.html#aef7b99d29af74b1eea8b7b414614e63f" title="Append the &quot;part&quot; descriptor to the composite vector. By default, shape=0 says that for each item in ...">add_part</a>(<a class="code" href="classZone__VF.html#abe1f45dce7441b402b8c54b5a407367b">md_vector_faces</a>());
<a name="l00509"></a>00509   mdc_ch_face.<a class="code" href="classMD__Vector__composite.html#aef7b99d29af74b1eea8b7b414614e63f" title="Append the &quot;part&quot; descriptor to the composite vector. By default, shape=0 says that for each item in ...">add_part</a>(<a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>().md_vector_elements(), <a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>);
<a name="l00510"></a>00510   <a class="code" href="classZone__CoviMAC.html#ab64ac1998323b60e376cd5e16f271dbd">mdv_ch_face</a>.<a class="code" href="classMD__Vector.html#a063644dd8ca62e707a2d059eedeb58a7" title="construction d&#39;un objet MD_Vector par copie d&#39;un objet existant. C&#39;est la methode recommandee pour cr...">copy</a>(mdc_ch_face);
<a name="l00511"></a>00511 
<a name="l00512"></a>00512 <span class="comment">// volumes_entrelaces_ et volumes_entrelaces_dir : par projection de l&#39;amont/aval sur la normale a la face</span>
<a name="l00513"></a>00513   <a class="code" href="classZone__VF.html#a8e02e68f236356f72728b82536538ac5">creer_tableau_faces</a>(<a class="code" href="classZone__VF.html#a4d84eafd75968d81d72275f240390ee8" title="volumes entrelaces pour l&#39;integration des Qdm">volumes_entrelaces_</a>);
<a name="l00514"></a>00514   <a class="code" href="classZone__VF.html#a40e71e7c7acb45cd7b7987d814e3701e" title="volumes entrelaces par cote">volumes_entrelaces_dir_</a>.<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(0, 2), <a class="code" href="classZone__VF.html#a8e02e68f236356f72728b82536538ac5">creer_tableau_faces</a>(<a class="code" href="classZone__VF.html#a40e71e7c7acb45cd7b7987d814e3701e" title="volumes entrelaces par cote">volumes_entrelaces_dir_</a>);
<a name="l00515"></a>00515   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> f = 0, i, e; f &lt; <a class="code" href="classZone__VF.html#aede27992d9f2eedd52c24d4a80ff7ffb" title="renvoie le nombre global de faces.">nb_faces</a>(); f++)
<a name="l00516"></a>00516     <span class="keywordflow">for</span> (i = 0; i &lt; 2 &amp;&amp; (e = face_voisins_(f, i)) &gt;= 0; <a class="code" href="classZone__VF.html#a4d84eafd75968d81d72275f240390ee8" title="volumes entrelaces pour l&#39;integration des Qdm">volumes_entrelaces_</a>(f) += <a class="code" href="classZone__VF.html#a40e71e7c7acb45cd7b7987d814e3701e" title="volumes entrelaces par cote">volumes_entrelaces_dir_</a>(f, i), i++)
<a name="l00517"></a>00517       <a class="code" href="classZone__VF.html#a40e71e7c7acb45cd7b7987d814e3701e" title="volumes entrelaces par cote">volumes_entrelaces_dir_</a>(f, i) = <a class="code" href="Double_8h.html#aaecd4ca8a2fe69cc6568af2938b94d2e">dabs</a>(<a class="code" href="classZone__CoviMAC.html#a7a5ffb545c8b97f0ed2cd0026707350f">dot</a>(&amp;<a class="code" href="classZone__VF.html#ae0dc3dc379de71f9d99115ab6973f0f6" title="centres de gravite des elements">xp_</a>(e, 0), &amp;<a class="code" href="classZone__CoviMAC.html#a158fd977594473b89e67bdc19c8514fc" title="normales aux faces">face_normales_</a>(f, 0), &amp;<a class="code" href="classZone__VF.html#a30d5c38f1825d8d35ce9c83aa37e5aa6" title="centres de gravite des faces">xv_</a>(f, 0)));
<a name="l00518"></a>00518   <a class="code" href="classZone__VF.html#a4d84eafd75968d81d72275f240390ee8" title="volumes entrelaces pour l&#39;integration des Qdm">volumes_entrelaces_</a>.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>(), <a class="code" href="classZone__VF.html#a40e71e7c7acb45cd7b7987d814e3701e" title="volumes entrelaces par cote">volumes_entrelaces_dir_</a>.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l00519"></a>00519 
<a name="l00520"></a>00520   <a class="code" href="classZone__VF.html#aff50cd7737b84daca35f56ebf78aee47">Zone_VF::calculer_porosites</a>();
<a name="l00521"></a>00521   <a class="code" href="classZone__VF.html#a96ffa418fd3594b770d03c22c2ef47b6">Zone_VF::calculer_diametres_hydrauliques</a>();
<a name="l00522"></a>00522 }
<a name="l00523"></a>00523 
<a name="l00524"></a><a class="code" href="classZone__CoviMAC.html#a9f723b28d3650a26988603996ee1c852">00524</a> <span class="keywordtype">void</span> <a class="code" href="classZone__CoviMAC.html#a9f723b28d3650a26988603996ee1c852">Zone_CoviMAC::detecter_faces_non_planes</a>()<span class="keyword"> const</span>
<a name="l00525"></a>00525 <span class="keyword"></span>{
<a name="l00526"></a>00526   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; f_e = <a class="code" href="classZone__VF.html#a816ac37fd526f962468cae6fbd8061f8" title="renvoie le tableaux des volumes des connectivites face elements cf au dessus.">face_voisins</a>(), &amp;f_s = <a class="code" href="classZone__VF.html#aed9555a55cac4a6ce8af5662cea174a1" title="sommets des faces">face_sommets_</a>;
<a name="l00527"></a>00527   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; xs = <a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>().<a class="code" href="classZone.html#a379ad2206b5a13a4f4f3df6d44c7546a" title="Renvoie le domaine dont la zone fait partie. (version const)">domaine</a>().<a class="code" href="classDomaine.html#aecd32c3eecc15cce7d1a0e468dadbf96" title="Renvoie le tableau des coordonnees des noeuds (sommets). (acces en lecture)">coord_sommets</a>(), &amp;nf = <a class="code" href="classZone__CoviMAC.html#a158fd977594473b89e67bdc19c8514fc" title="normales aux faces">face_normales_</a>;
<a name="l00528"></a>00528   <span class="keyword">const</span> <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; fs = <a class="code" href="classZone__VF.html#a40c3382b189a4fc508cf1c3e37b04b21">face_surfaces</a>();
<a name="l00529"></a>00529   <span class="keywordtype">int</span> i, j, f, s, rk = <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>(), np = <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l00530"></a>00530   <span class="keywordtype">double</span> sin2;
<a name="l00531"></a>00531   <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> val(np); <span class="comment">//sur chaque proc : { cos^2 max, indice de face, indices d&#39;elements }</span>
<a name="l00532"></a>00532   <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a> face(np), elem1(np), elem2(np);
<a name="l00533"></a>00533 
<a name="l00534"></a>00534 <span class="comment">// sur chaque proc : on cherche l&#39;angle le plus grand entre un sommet et le plan de sa face</span>
<a name="l00535"></a>00535   <span class="keywordflow">for</span> (f = 0; f &lt; <a class="code" href="classZone__VF.html#aede27992d9f2eedd52c24d4a80ff7ffb" title="renvoie le nombre global de faces.">nb_faces</a>(); f++) <span class="keywordflow">for</span> (i = 0; i &lt; f_s.dimension(1) &amp;&amp; (s = f_s(f, i)) &gt;= 0; i++)
<a name="l00536"></a>00536       <span class="keywordflow">if</span> ((sin2 = std::pow(<a class="code" href="classZone__CoviMAC.html#a7a5ffb545c8b97f0ed2cd0026707350f">dot</a>(&amp;xs(s, 0), &amp;nf(f, 0), &amp;<a class="code" href="classZone__VF.html#a30d5c38f1825d8d35ce9c83aa37e5aa6" title="centres de gravite des faces">xv_</a>(f, 0)) / fs(f), 2) / <a class="code" href="classZone__CoviMAC.html#a7a5ffb545c8b97f0ed2cd0026707350f">dot</a>(&amp;xs(s, 0), &amp;xs(s, 0), &amp;<a class="code" href="classZone__VF.html#a30d5c38f1825d8d35ce9c83aa37e5aa6" title="centres de gravite des faces">xv_</a>(f, 0), &amp;<a class="code" href="classZone__VF.html#a30d5c38f1825d8d35ce9c83aa37e5aa6" title="centres de gravite des faces">xv_</a>(f, 0))) &gt; val(rk))
<a name="l00537"></a>00537         val(rk) = sin2, face(rk) = f, elem1(rk) = f_e(f, 0), elem2(rk) = f_e(f, 1);
<a name="l00538"></a>00538   <a class="code" href="communications_8cpp.html#a5ceda011ec527d63b691f62cd2fb61c8">envoyer_all_to_all</a>(val, val), <a class="code" href="communications_8cpp.html#a5ceda011ec527d63b691f62cd2fb61c8">envoyer_all_to_all</a>(face, face), <a class="code" href="communications_8cpp.html#a5ceda011ec527d63b691f62cd2fb61c8">envoyer_all_to_all</a>(elem1, elem1), <a class="code" href="communications_8cpp.html#a5ceda011ec527d63b691f62cd2fb61c8">envoyer_all_to_all</a>(elem2, elem2);
<a name="l00539"></a>00539 
<a name="l00540"></a>00540   <span class="keywordflow">for</span> (i = j = sin2 = 0; i &lt; Process::nproc(); i++) if (val(i) &gt; sin2) sin2 = val(i), j = i;
<a name="l00541"></a>00541   <span class="keywordtype">double</span> theta = asin(sqrt(sin2)) * 180 / <a class="code" href="Double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>;
<a name="l00542"></a>00542   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Zone_CoviMAC : angle sommet/face max &quot;</span> &lt;&lt; theta &lt;&lt; <span class="stringliteral">&quot; deg (proc &quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot; , face &quot;</span>;
<a name="l00543"></a>00543   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; face(j) &lt;&lt; <span class="stringliteral">&quot; , elems &quot;</span> &lt;&lt; elem1(j) &lt;&lt; <span class="stringliteral">&quot; / &quot;</span> &lt;&lt; elem2(j) &lt;&lt; <span class="stringliteral">&quot; )&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00544"></a>00544   <span class="keywordflow">if</span> (theta &gt; 1) <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Zone_CoviMAC : face non plane detectee! Veuillez reparer votre maillage...&quot;</span> &lt;&lt; finl, <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00545"></a>00545 }
<a name="l00546"></a>00546 
<a name="l00547"></a><a class="code" href="classZone__CoviMAC.html#a56606aa3ae4da75f8335dc01136fc582">00547</a> <span class="keywordtype">void</span> <a class="code" href="classZone__CoviMAC.html#a56606aa3ae4da75f8335dc01136fc582">Zone_CoviMAC::calculer_h_carre</a>()
<a name="l00548"></a>00548 {
<a name="l00549"></a>00549 <span class="comment">// Calcul de h_carre</span>
<a name="l00550"></a>00550   <a class="code" href="classZone__CoviMAC.html#a9bc5ec96b975406081a7a413434b7b50" title="carre du pas du maillage">h_carre</a> = 1.e30;
<a name="l00551"></a>00551   <a class="code" href="classZone__CoviMAC.html#a9cdd2300465fc8e41e1ffa58ea3cb10d" title="carre du pas d&#39;une maille">h_carre_</a>.<a class="code" href="classDoubleVect.html#ac55a86eea7b2f06b084b88b16042b67b" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(<a class="code" href="classZone__VF.html#aede27992d9f2eedd52c24d4a80ff7ffb" title="renvoie le nombre global de faces.">nb_faces</a>());
<a name="l00552"></a>00552 <span class="comment">// Calcul des surfaces</span>
<a name="l00553"></a>00553   <span class="keyword">const</span> <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; surfaces=<a class="code" href="classZone__VF.html#a40c3382b189a4fc508cf1c3e37b04b21">face_surfaces</a>();
<a name="l00554"></a>00554   <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; nb_faces_elem=<a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>().<a class="code" href="classZone.html#a548fbc7518be2f122b1a5c9589a443c2" title="Renvoie le nombre de face de type i des elements geometriques constituants la zone. Ex: les objets de la classe Prisme ont 2 types de faces: triangle ou quadrangle.">nb_faces_elem</a>();
<a name="l00555"></a>00555   <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; nbe=<a class="code" href="classZone__dis__base.html#a790cb2f6bc2928518799e748313d0eb3">nb_elem</a>();
<a name="l00556"></a>00556   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> num_elem=0; num_elem&lt;nbe; num_elem++)
<a name="l00557"></a>00557     {
<a name="l00558"></a>00558       <span class="keywordtype">double</span> surf_max = 0;
<a name="l00559"></a>00559       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nb_faces_elem; i++)
<a name="l00560"></a>00560         {
<a name="l00561"></a>00561           <span class="keywordtype">double</span> surf = surfaces(<a class="code" href="classZone__VF.html#a8e09b61902b9f1d2c4c7bedc3b8f39d3" title="renvoie le tableau de connectivite element/faces">elem_faces</a>(num_elem,i));
<a name="l00562"></a>00562           surf_max = (surf &gt; surf_max)? surf : surf_max;
<a name="l00563"></a>00563         }
<a name="l00564"></a>00564       <span class="keywordtype">double</span> vol = <a class="code" href="classZone__VF.html#a9598b08cb9126f88cfafe72fc0eeca70" title="renvoie le tableaux des volumes des mailles.">volumes</a>(num_elem)/surf_max;
<a name="l00565"></a>00565       vol *= vol;
<a name="l00566"></a>00566       <a class="code" href="classZone__CoviMAC.html#a9cdd2300465fc8e41e1ffa58ea3cb10d" title="carre du pas d&#39;une maille">h_carre_</a>(num_elem) = vol;
<a name="l00567"></a>00567       <a class="code" href="classZone__CoviMAC.html#a9bc5ec96b975406081a7a413434b7b50" title="carre du pas du maillage">h_carre</a> = ( vol &lt; <a class="code" href="classZone__CoviMAC.html#a9bc5ec96b975406081a7a413434b7b50" title="carre du pas du maillage">h_carre</a> )? vol : <a class="code" href="classZone__CoviMAC.html#a9bc5ec96b975406081a7a413434b7b50" title="carre du pas du maillage">h_carre</a>;
<a name="l00568"></a>00568     }
<a name="l00569"></a>00569 }
<a name="l00570"></a>00570 
<a name="l00571"></a><a class="code" href="Zone__CoviMAC_8cpp.html#a6a3b8179dd463ce077db2ed0f88ad860">00571</a> <span class="keywordtype">void</span> <a class="code" href="Zone__CoviMAC_8cpp.html#a6a3b8179dd463ce077db2ed0f88ad860">disp_dt</a>(<span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; A)
<a name="l00572"></a>00572 {
<a name="l00573"></a>00573   <span class="keywordtype">int</span> i, j, k, l;
<a name="l00574"></a>00574   <span class="keywordflow">if</span> (A.<a class="code" href="classDoubleTab.html#ae6dda48778e7107e1beb723beef1f75b" title="Returns the number of dimensions of the array (&gt;= 1)">nb_dim</a>() == 4) <span class="keywordflow">for</span> (i = 0; i &lt; A.<a class="code" href="classDoubleTab.html#a3eadd63f3ba20c1b454d760b430acbf7" title="Returns the total dimensions of the multi-dimensionnal array, including virtual items (used in parall...">dimension_tot</a>(0); i++)
<a name="l00575"></a>00575       <span class="keywordflow">for</span> (j = 0, fprintf(stderr, i ? <span class="stringliteral">&quot;}}},{&quot;</span> : <span class="stringliteral">&quot;{{&quot;</span>); j &lt; A.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1); j++)
<a name="l00576"></a>00576         <span class="keywordflow">for</span> (k = 0, fprintf(stderr, j ? <span class="stringliteral">&quot;}},{&quot;</span> : <span class="stringliteral">&quot;{&quot;</span>); k &lt; A.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(2); k++)
<a name="l00577"></a>00577           <span class="keywordflow">for</span> (l = 0, fprintf(stderr, k ? <span class="stringliteral">&quot;},{&quot;</span> : <span class="stringliteral">&quot;{&quot;</span>); l &lt; A.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(3); l++)
<a name="l00578"></a>00578             fprintf(stderr, <span class="stringliteral">&quot;%.10E%s &quot;</span>, A.<a class="code" href="classArrOfDouble.html#a95357a1390c11dbd481d385257f2e983" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>()[A.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(3) * (A.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(2) * (i * A.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1) + j) + k) + l], l + 1 &lt; A.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(3) ? <span class="stringliteral">&quot;,&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l00579"></a>00579   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (A.<a class="code" href="classDoubleTab.html#ae6dda48778e7107e1beb723beef1f75b" title="Returns the number of dimensions of the array (&gt;= 1)">nb_dim</a>() == 3) <span class="keywordflow">for</span> (i = 0; i &lt; A.<a class="code" href="classDoubleTab.html#a3eadd63f3ba20c1b454d760b430acbf7" title="Returns the total dimensions of the multi-dimensionnal array, including virtual items (used in parall...">dimension_tot</a>(0); i++)
<a name="l00580"></a>00580       <span class="keywordflow">for</span> (j = 0, fprintf(stderr, i ? <span class="stringliteral">&quot;}},{&quot;</span> : <span class="stringliteral">&quot;{{&quot;</span>); j &lt; A.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1); j++)
<a name="l00581"></a>00581         <span class="keywordflow">for</span> (k = 0, fprintf(stderr, j ? <span class="stringliteral">&quot;},{&quot;</span> : <span class="stringliteral">&quot;{&quot;</span>); k &lt; A.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(2); k++)
<a name="l00582"></a>00582           fprintf(stderr, <span class="stringliteral">&quot;%.10E%s &quot;</span>, A.<a class="code" href="classArrOfDouble.html#a95357a1390c11dbd481d385257f2e983" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>()[A.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(2) * (i * A.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1) + j) + k], k + 1 &lt; A.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(2) ? <span class="stringliteral">&quot;,&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l00583"></a>00583   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (A.<a class="code" href="classDoubleTab.html#ae6dda48778e7107e1beb723beef1f75b" title="Returns the number of dimensions of the array (&gt;= 1)">nb_dim</a>() == 2) <span class="keywordflow">for</span> (i = 0; i &lt; A.<a class="code" href="classDoubleTab.html#a3eadd63f3ba20c1b454d760b430acbf7" title="Returns the total dimensions of the multi-dimensionnal array, including virtual items (used in parall...">dimension_tot</a>(0); i++)
<a name="l00584"></a>00584       <span class="keywordflow">for</span> (j = 0, fprintf(stderr, i ? <span class="stringliteral">&quot;},{&quot;</span> : <span class="stringliteral">&quot;{{&quot;</span>); j &lt; A.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1); j++)
<a name="l00585"></a>00585         fprintf(stderr, <span class="stringliteral">&quot;%.10E%s &quot;</span>, A.<a class="code" href="classArrOfDouble.html#a95357a1390c11dbd481d385257f2e983" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>()[i * A.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1) + j], j + 1 &lt; A.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1) ? <span class="stringliteral">&quot;,&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l00586"></a>00586   <span class="keywordflow">else</span> <span class="keywordflow">for</span> (i = 0, fprintf(stderr, <span class="stringliteral">&quot;{&quot;</span>); i &lt; A.<a class="code" href="classDoubleTab.html#a3eadd63f3ba20c1b454d760b430acbf7" title="Returns the total dimensions of the multi-dimensionnal array, including virtual items (used in parall...">dimension_tot</a>(0); i++)
<a name="l00587"></a>00587       fprintf(stderr, <span class="stringliteral">&quot;%.10E%s &quot;</span>, A.<a class="code" href="classArrOfDouble.html#a95357a1390c11dbd481d385257f2e983" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>()[i], i + 1 &lt; A.<a class="code" href="classDoubleTab.html#a3eadd63f3ba20c1b454d760b430acbf7" title="Returns the total dimensions of the multi-dimensionnal array, including virtual items (used in parall...">dimension_tot</a>(0) ? <span class="stringliteral">&quot;,&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l00588"></a>00588   fprintf(stderr, A.<a class="code" href="classDoubleTab.html#ae6dda48778e7107e1beb723beef1f75b" title="Returns the number of dimensions of the array (&gt;= 1)">nb_dim</a>() == 4 ? <span class="stringliteral">&quot;}}}}\n&quot;</span> : A.<a class="code" href="classDoubleTab.html#ae6dda48778e7107e1beb723beef1f75b" title="Returns the number of dimensions of the array (&gt;= 1)">nb_dim</a>() == 3 ? <span class="stringliteral">&quot;}}}\n&quot;</span> : A.<a class="code" href="classDoubleTab.html#ae6dda48778e7107e1beb723beef1f75b" title="Returns the number of dimensions of the array (&gt;= 1)">nb_dim</a>() == 2 ? <span class="stringliteral">&quot;}}\n&quot;</span> : <span class="stringliteral">&quot;}\n&quot;</span>);
<a name="l00589"></a>00589 }
<a name="l00590"></a>00590 
<a name="l00591"></a><a class="code" href="Zone__CoviMAC_8cpp.html#a8c4483f493da19427e83cc1a622c7356">00591</a> <span class="keywordtype">void</span> <a class="code" href="Zone__CoviMAC_8cpp.html#a8c4483f493da19427e83cc1a622c7356">disp_da</a>(<span class="keyword">const</span> <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a>&amp; A)
<a name="l00592"></a>00592 {
<a name="l00593"></a>00593   <span class="keywordtype">int</span> i;
<a name="l00594"></a>00594   <span class="keywordflow">for</span> (i = 0, fprintf(stderr, <span class="stringliteral">&quot;{&quot;</span>); i &lt; A.<a class="code" href="classArrOfDouble.html#a3c3b33bea0e88b87315c21ee94bee05f" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>(); i++)
<a name="l00595"></a>00595     fprintf(stderr, <span class="stringliteral">&quot;%.10E%s &quot;</span>, A.<a class="code" href="classArrOfDouble.html#a95357a1390c11dbd481d385257f2e983" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>()[i], i + 1 &lt; A.<a class="code" href="classArrOfDouble.html#a3c3b33bea0e88b87315c21ee94bee05f" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>() ? <span class="stringliteral">&quot;,&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l00596"></a>00596   fprintf(stderr, <span class="stringliteral">&quot;}\n&quot;</span>);
<a name="l00597"></a>00597 }
<a name="l00598"></a>00598 
<a name="l00599"></a><a class="code" href="Zone__CoviMAC_8cpp.html#a74a8f593df1c2dd0ef0772f9b34c7e38">00599</a> <span class="keywordtype">void</span> <a class="code" href="Zone__CoviMAC_8cpp.html#a74a8f593df1c2dd0ef0772f9b34c7e38">disp_it</a>(<span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; A)
<a name="l00600"></a>00600 {
<a name="l00601"></a>00601   <span class="keywordtype">int</span> i, j;
<a name="l00602"></a>00602   <span class="keywordflow">if</span> (A.<a class="code" href="classIntTab.html#ae307ece7edbe1d5facfbb81953b3e2b1" title="Returns the number of dimensions of the array (&gt;= 1)">nb_dim</a>() == 2) <span class="keywordflow">for</span> (i = 0; i &lt; A.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0); i++)
<a name="l00603"></a>00603       <span class="keywordflow">for</span> (j = 0, fprintf(stderr, i ? <span class="stringliteral">&quot;},{&quot;</span> : <span class="stringliteral">&quot;{{&quot;</span>); j &lt; A.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1); j++)
<a name="l00604"></a>00604         fprintf(stderr, <span class="stringliteral">&quot;%d%s &quot;</span>, A.<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>()[i * A.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1) + j], j + 1 &lt; A.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1) ? <span class="stringliteral">&quot;,&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l00605"></a>00605   <span class="keywordflow">else</span> <span class="keywordflow">for</span> (i = 0, fprintf(stderr, <span class="stringliteral">&quot;{&quot;</span>); i &lt; A.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0); i++)
<a name="l00606"></a>00606       fprintf(stderr, <span class="stringliteral">&quot;%d%s &quot;</span>, A.<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>()[i], i + 1 &lt; A.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0) ? <span class="stringliteral">&quot;,&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l00607"></a>00607   fprintf(stderr, A.<a class="code" href="classIntTab.html#ae307ece7edbe1d5facfbb81953b3e2b1" title="Returns the number of dimensions of the array (&gt;= 1)">nb_dim</a>() == 2 ? <span class="stringliteral">&quot;}}\n&quot;</span> : <span class="stringliteral">&quot;}\n&quot;</span>);
<a name="l00608"></a>00608 }
<a name="l00609"></a>00609 
<a name="l00610"></a><a class="code" href="Zone__CoviMAC_8cpp.html#a67f18055a22ed4e8cf42f81b5854b57f">00610</a> <span class="keywordtype">void</span> <a class="code" href="Zone__CoviMAC_8cpp.html#a67f18055a22ed4e8cf42f81b5854b57f">disp_ia</a>(<span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; A)
<a name="l00611"></a>00611 {
<a name="l00612"></a>00612   <span class="keywordtype">int</span> i;
<a name="l00613"></a>00613   <span class="keywordflow">for</span> (i = 0, fprintf(stderr, <span class="stringliteral">&quot;{&quot;</span>); i &lt; A.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>(); i++)
<a name="l00614"></a>00614     fprintf(stderr, <span class="stringliteral">&quot;%d%s &quot;</span>, A.<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>()[i], i + 1 &lt; A.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>() ? <span class="stringliteral">&quot;,&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l00615"></a>00615   fprintf(stderr, <span class="stringliteral">&quot;}\n&quot;</span>);
<a name="l00616"></a>00616 }
<a name="l00617"></a>00617 
<a name="l00618"></a><a class="code" href="Zone__CoviMAC_8cpp.html#aba886bf7e5142fbfe9491e31c965033b">00618</a> <span class="keywordtype">void</span> <a class="code" href="Zone__CoviMAC_8cpp.html#aba886bf7e5142fbfe9491e31c965033b">disp_m</a>(<span class="keyword">const</span> <a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a>&amp; M)
<a name="l00619"></a>00619 {
<a name="l00620"></a>00620   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> A(M.<a class="code" href="classMatrice__Morse.html#a1f9bd6aedb226c86b7299689fa5b821a">nb_lignes</a>(), M.<a class="code" href="classMatrice__Morse.html#a94caf9937bc5a110a7179cb3e9eaa9d9">nb_colonnes</a>());
<a name="l00621"></a>00621   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; A.dimension(0); i++)
<a name="l00622"></a>00622     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = M.<a class="code" href="classMatrice__Morse.html#a79b4e334152850bd36e53478debf3061">get_tab1</a>().<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>()[i] - 1; k &lt; M.<a class="code" href="classMatrice__Morse.html#a79b4e334152850bd36e53478debf3061">get_tab1</a>().<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>()[i + 1] - 1; k++)
<a name="l00623"></a>00623       A(i, M.<a class="code" href="classMatrice__Morse.html#a787b5a63f27063f9c891243d8f188cda">get_tab2</a>().<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>()[k] - 1) = M.<a class="code" href="classMatrice__Morse.html#aacb80dd518dcc0812e3b34edac6ab67e">get_coeff</a>().<a class="code" href="classArrOfDouble.html#a95357a1390c11dbd481d385257f2e983" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>()[k];
<a name="l00624"></a>00624   <a class="code" href="Zone__CoviMAC_8cpp.html#a6a3b8179dd463ce077db2ed0f88ad860">disp_dt</a>(A);
<a name="l00625"></a>00625 }
<a name="l00626"></a>00626 
<a name="l00627"></a><a class="code" href="Zone__CoviMAC_8cpp.html#a376991d52cee770fda4eee18eb3bafa7">00627</a> <span class="keywordtype">void</span> <a class="code" href="Zone__CoviMAC_8cpp.html#a376991d52cee770fda4eee18eb3bafa7">disp_mt</a>(<span class="keyword">const</span> <a class="code" href="Interface__blocs_8h.html#a2d7480bf11fc9f791b1d2839fa30a5c3">tabs_t</a>&amp; mvect)
<a name="l00628"></a>00628 {
<a name="l00629"></a>00629   <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;&amp;n_v : mvect)
<a name="l00630"></a>00630     fprintf(stderr, <span class="stringliteral">&quot;%s:\n&quot;</span>, n_v.first.c_str()), <a class="code" href="Zone__CoviMAC_8cpp.html#a6a3b8179dd463ce077db2ed0f88ad860">disp_dt</a>(n_v.second), fprintf(stderr, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00631"></a>00631 }
<a name="l00632"></a>00632 
<a name="l00633"></a><a class="code" href="Zone__CoviMAC_8cpp.html#a78a6e166f17572e9efb646a57bb06392">00633</a> <span class="keywordtype">void</span> <a class="code" href="Zone__CoviMAC_8cpp.html#a78a6e166f17572e9efb646a57bb06392">disp_mm</a>(<span class="keyword">const</span> std::map&lt;std::string, Matrice_Morse&gt;&amp; mmat)
<a name="l00634"></a>00634 {
<a name="l00635"></a>00635   <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;&amp;n_v : mmat)
<a name="l00636"></a>00636     fprintf(stderr, <span class="stringliteral">&quot;%s:\n&quot;</span>, n_v.first.c_str()), <a class="code" href="Zone__CoviMAC_8cpp.html#aba886bf7e5142fbfe9491e31c965033b">disp_m</a>(n_v.second), fprintf(stderr, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00637"></a>00637 }
<a name="l00638"></a>00638 
<a name="l00639"></a><a class="code" href="Zone__CoviMAC_8cpp.html#a836a5ca069e7d0bfb60e56b1246acf50">00639</a> <span class="keywordtype">void</span> <a class="code" href="Zone__CoviMAC_8cpp.html#a836a5ca069e7d0bfb60e56b1246acf50">disp_mmp</a>(<span class="keyword">const</span> <a class="code" href="Interface__blocs_8h.html#a68e4f5c4505f6b31305de844302660bb">matrices_t</a>&amp; mmat)
<a name="l00640"></a>00640 {
<a name="l00641"></a>00641   <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;&amp;n_v : mmat)
<a name="l00642"></a>00642     fprintf(stderr, <span class="stringliteral">&quot;%s:\n&quot;</span>, n_v.first.c_str()), <a class="code" href="Zone__CoviMAC_8cpp.html#aba886bf7e5142fbfe9491e31c965033b">disp_m</a>(*n_v.second), fprintf(stderr, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00643"></a>00643 }
<a name="l00644"></a>00644 
<a name="l00645"></a><a class="code" href="classZone__CoviMAC.html#a05ae1a3b605db3388c69835f90f34d9e">00645</a> <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; <a class="code" href="classZone__CoviMAC.html#af95d2084d566bad62b845d8e0fe76eef">Zone_CoviMAC::dist_norm_bord</a>(<a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; dist, <span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; nom_bord)<span class="keyword"> const</span>
<a name="l00646"></a>00646 <span class="keyword"></span>{
<a name="l00647"></a>00647   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n_bord=0; n_bord&lt;<a class="code" href="classZone__VF.html#ab582b1b65b2a3740318b6725cddac726">les_bords_</a>.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>(); n_bord++)
<a name="l00648"></a>00648     {
<a name="l00649"></a>00649       <span class="keyword">const</span> <a class="code" href="classFront__VF.html" title="class Front_VF">Front_VF</a>&amp; fr_vf = <a class="code" href="classZone__VF.html#a45e54622328fcf035535edf96172c1e4" title="renvoie la ieme frontiere_discrete.">front_VF</a>(n_bord);
<a name="l00650"></a>00650       <span class="keywordflow">if</span> (fr_vf.<a class="code" href="classFrontiere__dis__base.html#a5a7eb46dc3af8a7d4225adc1814845d8" title="Renvoie le nom de la frontiere geometrique.">le_nom</a>() == nom_bord)
<a name="l00651"></a>00651         {
<a name="l00652"></a>00652           dist.<a class="code" href="classDoubleVect.html#ac55a86eea7b2f06b084b88b16042b67b" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(fr_vf.<a class="code" href="classFront__VF.html#a341e2fcb5117b96e745fd7078ba86bab" title="Nombre de faces reelles du bord.">nb_faces</a>());
<a name="l00653"></a>00653           <span class="keywordtype">int</span> ndeb = fr_vf.<a class="code" href="classFront__VF.html#a4986f0c65653fe9eb40bbbff5a97bf16" title="Numero de la premiere face du bord dans la liste des faces.">num_premiere_face</a>();
<a name="l00654"></a>00654           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> face=ndeb; face&lt;ndeb+fr_vf.<a class="code" href="classFront__VF.html#a341e2fcb5117b96e745fd7078ba86bab" title="Nombre de faces reelles du bord.">nb_faces</a>(); face++)
<a name="l00655"></a>00655             dist(face-ndeb) = <a class="code" href="classZone__CoviMAC.html#af95d2084d566bad62b845d8e0fe76eef">dist_norm_bord</a>(face);
<a name="l00656"></a>00656         }
<a name="l00657"></a>00657     }
<a name="l00658"></a>00658   <span class="keywordflow">return</span> dist;
<a name="l00659"></a>00659 }
<a name="l00660"></a>00660 
<a name="l00661"></a>00661 
<a name="l00662"></a><a class="code" href="classZone__CoviMAC.html#af7049ef91bbde686a8fe3fdffac2b60c">00662</a> <span class="keywordtype">void</span> <a class="code" href="classZone__CoviMAC.html#af7049ef91bbde686a8fe3fdffac2b60c">Zone_CoviMAC::init_equiv</a>()<span class="keyword"> const</span>
<a name="l00663"></a>00663 <span class="keyword"></span>{
<a name="l00664"></a>00664   <span class="keywordflow">if</span> (<a class="code" href="classZone__CoviMAC.html#a3dafd4d7bcba5c2b7a5065e806c684fb">is_init</a>[<span class="stringliteral">&quot;equiv&quot;</span>]) <span class="keywordflow">return</span>;
<a name="l00665"></a>00665   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; e_f = <a class="code" href="classZone__VF.html#a8e09b61902b9f1d2c4c7bedc3b8f39d3" title="renvoie le tableau de connectivite element/faces">elem_faces</a>(), &amp;f_e = <a class="code" href="classZone__VF.html#a816ac37fd526f962468cae6fbd8061f8" title="renvoie le tableaux des volumes des connectivites face elements cf au dessus.">face_voisins</a>();
<a name="l00666"></a>00666   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; nf = <a class="code" href="classZone__CoviMAC.html#a4eb800da2b81e79955cd640ea9a83306">face_normales</a>();
<a name="l00667"></a>00667   <span class="keyword">const</span> <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; fs = <a class="code" href="classZone__VF.html#a40c3382b189a4fc508cf1c3e37b04b21">face_surfaces</a>();<span class="comment">//, &amp;vf = volumes_entrelaces();</span>
<a name="l00668"></a>00668   <span class="keywordtype">int</span> i, j, e1, e2, f, <a class="code" href="Lois__sodium_8h.html#a3034a1fb8c782842a2b9473c0f02a448">f1</a>, <a class="code" href="Lois__sodium_8h.html#a23f45359b08cb1d0538697b4f2d3dbbe">f2</a>, d, D = <a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>, ok;
<a name="l00669"></a>00669 
<a name="l00670"></a>00670   <a class="code" href="classIntTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un IntTab avec allocation dans un pool de memoire gere...">IntTrav</a> ntot, nequiv;
<a name="l00671"></a>00671   <a class="code" href="classZone__VF.html#a8e02e68f236356f72728b82536538ac5">creer_tableau_faces</a>(ntot), <a class="code" href="classZone__VF.html#a8e02e68f236356f72728b82536538ac5">creer_tableau_faces</a>(nequiv);
<a name="l00672"></a>00672   <a class="code" href="classZone__CoviMAC.html#a09a5901464be84357ca893960ca3a8c2">equiv</a>.<a class="code" href="classIntTab.html#a22e6bed6826b3688d4d0181cbf3b7a38" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(<a class="code" href="classZone__VF.html#a50fd21c9535680489015a3c8b88c685a" title="renvoie le nombre total de faces. C&#39;est-a-dire faces reelles + faces virtuelles">nb_faces_tot</a>(), 2, e_f.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1));
<a name="l00673"></a>00673   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>().<a class="code" href="classZone.html#a379ad2206b5a13a4f4f3df6d44c7546a" title="Renvoie le domaine dont la zone fait partie. (version const)">domaine</a>().<a class="code" href="classDomaine.html#a87e2cdc035a26565e6fe481446aa4cd3" title="Renvoie le nom du domaine.">le_nom</a>() &lt;&lt; <span class="stringliteral">&quot; : initialisation de equiv... &quot;</span>;
<a name="l00674"></a>00674   <span class="keywordflow">for</span> (f = 0, <a class="code" href="classZone__CoviMAC.html#a09a5901464be84357ca893960ca3a8c2">equiv</a> = -1; f &lt; nb_faces_tot(); f++) if ((e1 = f_e(f, 0)) &gt;= 0 &amp;&amp; (e2 = f_e(f, 1)) &gt;= 0)
<a name="l00675"></a>00675       <span class="keywordflow">for</span> (i = 0; i &lt; e_f.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1) &amp;&amp; (f1 = e_f(e1, i)) &gt;= 0; i++)
<a name="l00676"></a>00676         <span class="keywordflow">for</span> (j = 0, ntot(f)++; j &lt; e_f.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1) &amp;&amp; (f2 = e_f(e2, j)) &gt;= 0; j++)
<a name="l00677"></a>00677           {
<a name="l00678"></a>00678             <span class="keywordflow">if</span> (<a class="code" href="Double_8h.html#aaecd4ca8a2fe69cc6568af2938b94d2e">dabs</a>(<a class="code" href="Double_8h.html#aaecd4ca8a2fe69cc6568af2938b94d2e">dabs</a>(<a class="code" href="classZone__CoviMAC.html#a7a5ffb545c8b97f0ed2cd0026707350f">dot</a>(&amp;nf(f1, 0), &amp;nf(f2, 0)) / (fs(f1) * fs(f2))) - 1) &gt; 1e-6) <span class="keywordflow">continue</span>; <span class="comment">//normales colineaires?</span>
<a name="l00679"></a>00679             <span class="keywordflow">for</span> (ok = 1, d = 0; d &lt; D; d++) ok &amp;= <a class="code" href="Double_8h.html#aaecd4ca8a2fe69cc6568af2938b94d2e">dabs</a>((<a class="code" href="classZone__VF.html#a30d5c38f1825d8d35ce9c83aa37e5aa6" title="centres de gravite des faces">xv_</a>(f1, d) - <a class="code" href="classZone__VF.html#ae0dc3dc379de71f9d99115ab6973f0f6" title="centres de gravite des elements">xp_</a>(e1, d)) - (<a class="code" href="classZone__VF.html#a30d5c38f1825d8d35ce9c83aa37e5aa6" title="centres de gravite des faces">xv_</a>(f2, d) - <a class="code" href="classZone__VF.html#ae0dc3dc379de71f9d99115ab6973f0f6" title="centres de gravite des elements">xp_</a>(e2, d))) &lt; 1e-12; <span class="comment">//xv - xp identiques?</span>
<a name="l00680"></a>00680             <span class="keywordflow">if</span> (!ok) <span class="keywordflow">continue</span>;
<a name="l00681"></a>00681             <a class="code" href="classZone__CoviMAC.html#a09a5901464be84357ca893960ca3a8c2">equiv</a>(f, 0, i) = <a class="code" href="Lois__sodium_8h.html#a23f45359b08cb1d0538697b4f2d3dbbe">f2</a>, <a class="code" href="classZone__CoviMAC.html#a09a5901464be84357ca893960ca3a8c2">equiv</a>(f, 1, j) = <a class="code" href="Lois__sodium_8h.html#a3034a1fb8c782842a2b9473c0f02a448">f1</a>, nequiv(f)++; <span class="comment">//si oui, on a equivalence</span>
<a name="l00682"></a>00682           }
<a name="l00683"></a>00683   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <a class="code" href="DoubleVect_8cpp.html#a07dd5e25d47ad3892ae0fa4e997ed011">mp_somme_vect</a>(nequiv) * 100. / <a class="code" href="DoubleVect_8cpp.html#a07dd5e25d47ad3892ae0fa4e997ed011">mp_somme_vect</a>(ntot) &lt;&lt; <span class="stringliteral">&quot;% de faces equivalentes!&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00684"></a>00684   <a class="code" href="classZone__CoviMAC.html#a3dafd4d7bcba5c2b7a5065e806c684fb">is_init</a>[<span class="stringliteral">&quot;equiv&quot;</span>] = 1;
<a name="l00685"></a>00685 }
<a name="l00686"></a>00686 
<a name="l00687"></a>00687 <span class="comment">// interpolation normales aux faces -&gt; elements d&#39;ordre 1</span>
<a name="l00688"></a><a class="code" href="classZone__CoviMAC.html#a2f8e5dfd0f359a548fc21fe6987ab440">00688</a> <span class="keywordtype">void</span> <a class="code" href="classZone__CoviMAC.html#a2f8e5dfd0f359a548fc21fe6987ab440">Zone_CoviMAC::init_ve</a>()<span class="keyword"> const</span>
<a name="l00689"></a>00689 <span class="keyword"></span>{
<a name="l00690"></a>00690   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; e_f = <a class="code" href="classZone__VF.html#a8e09b61902b9f1d2c4c7bedc3b8f39d3" title="renvoie le tableau de connectivite element/faces">elem_faces</a>(), &amp;f_e = <a class="code" href="classZone__VF.html#a816ac37fd526f962468cae6fbd8061f8" title="renvoie le tableaux des volumes des connectivites face elements cf au dessus.">face_voisins</a>();
<a name="l00691"></a>00691   <span class="keyword">const</span> <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; ve = <a class="code" href="classZone__VF.html#aa3dafba95eaf5c0026d73c9e15b937b0" title="volumes des elements">volumes_</a>, &amp;fs = <a class="code" href="classZone__VF.html#a40c3382b189a4fc508cf1c3e37b04b21">face_surfaces</a>();
<a name="l00692"></a>00692   <span class="keywordtype">int</span> i, k, e, f;
<a name="l00693"></a>00693 
<a name="l00694"></a>00694   <span class="keywordflow">if</span> (<a class="code" href="classZone__CoviMAC.html#a3dafd4d7bcba5c2b7a5065e806c684fb">is_init</a>[<span class="stringliteral">&quot;ve&quot;</span>]) <span class="keywordflow">return</span>;
<a name="l00695"></a>00695   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>().<a class="code" href="classZone.html#a379ad2206b5a13a4f4f3df6d44c7546a" title="Renvoie le domaine dont la zone fait partie. (version const)">domaine</a>().<a class="code" href="classDomaine.html#a87e2cdc035a26565e6fe481446aa4cd3" title="Renvoie le nom du domaine.">le_nom</a>() &lt;&lt; <span class="stringliteral">&quot; : initialisation de ve... &quot;</span>;
<a name="l00696"></a>00696   <a class="code" href="classZone__CoviMAC.html#a24fd81efcdca0709960c5ea9deccaa3c">ved</a>.<a class="code" href="classIntTab.html#a22e6bed6826b3688d4d0181cbf3b7a38" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(1), <a class="code" href="classZone__CoviMAC.html#a24fd81efcdca0709960c5ea9deccaa3c">ved</a>.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1), <a class="code" href="classZone__CoviMAC.html#ab6ecd3df239505325140ce435c492444">vej</a>.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1), <a class="code" href="classZone__CoviMAC.html#aaa49dcc9140290fc5cbd3c293941fe72">vec</a>.<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(0, <a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>), <a class="code" href="classZone__CoviMAC.html#aaa49dcc9140290fc5cbd3c293941fe72">vec</a>.<a class="code" href="classArrOfDouble.html#ab49f6cae96be9d3f597468d8a53b67b6" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00697"></a>00697 <span class="comment">// formule (1) de Basumatary et al. (2014) https://doi.org/10.1016/j.jcp.2014.04.033 d&#39;apres Perot</span>
<a name="l00698"></a>00698   <span class="keywordflow">for</span> (e = 0; e &lt; <a class="code" href="classZone__dis__base.html#a4d6aa445f152aa6dc54d66ea7a071147">nb_elem_tot</a>(); <a class="code" href="classZone__CoviMAC.html#a24fd81efcdca0709960c5ea9deccaa3c">ved</a>.<a class="code" href="classIntTab.html#ac0af4eac42ca46facc05f985c3ef05c6" title="Adds 1 to dimension_tot(0) and puts a in the added line.">append_line</a>(<a class="code" href="classZone__CoviMAC.html#ab6ecd3df239505325140ce435c492444">vej</a>.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0)), e++)
<a name="l00699"></a>00699     <span class="keywordflow">for</span> (i = 0; i &lt; e_f.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1) &amp;&amp; (f = e_f(e, i)) &gt;= 0; i++)
<a name="l00700"></a>00700       {
<a name="l00701"></a>00701         <span class="keywordtype">double</span> x[3] = { 0, };
<a name="l00702"></a>00702         <span class="keywordflow">for</span> (k = 0; k &lt; <a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; k++) x[k] = fs(f) * (<a class="code" href="classZone__VF.html#a6c108eadb292f20b662cff6e3ecf6115">xv</a>(f, k) - <a class="code" href="classZone__VF.html#ad9f40bf649129fcc43578cbf057954ef">xp</a>(e, k)) * (e == f_e(f, 0) ? 1 : -1) / ve(e);
<a name="l00703"></a>00703         <a class="code" href="classZone__CoviMAC.html#ab6ecd3df239505325140ce435c492444">vej</a>.<a class="code" href="classIntTab.html#ac0af4eac42ca46facc05f985c3ef05c6" title="Adds 1 to dimension_tot(0) and puts a in the added line.">append_line</a>(f), dimension &lt; 3 ? <a class="code" href="classZone__CoviMAC.html#aaa49dcc9140290fc5cbd3c293941fe72">vec</a>.<a class="code" href="classDoubleTab.html#a0bf29d92d15188db10e37a4f7d627784" title="Adds 1 to dimension_tot(0) and puts a in the added line.">append_line</a>(x[0], x[1]) : <a class="code" href="classZone__CoviMAC.html#aaa49dcc9140290fc5cbd3c293941fe72">vec</a>.<a class="code" href="classDoubleTab.html#a0bf29d92d15188db10e37a4f7d627784" title="Adds 1 to dimension_tot(0) and puts a in the added line.">append_line</a>(x[0], x[1], x[2]);
<a name="l00704"></a>00704       }
<a name="l00705"></a>00705   <a class="code" href="Zone__CoviMAC_8h.html#a30133bb5f8cebac5322355d13a055208">CRIMP</a>(<a class="code" href="classZone__CoviMAC.html#a24fd81efcdca0709960c5ea9deccaa3c">ved</a>), <a class="code" href="Zone__CoviMAC_8h.html#a30133bb5f8cebac5322355d13a055208">CRIMP</a>(<a class="code" href="classZone__CoviMAC.html#ab6ecd3df239505325140ce435c492444">vej</a>), <a class="code" href="Zone__CoviMAC_8h.html#a30133bb5f8cebac5322355d13a055208">CRIMP</a>(<a class="code" href="classZone__CoviMAC.html#aaa49dcc9140290fc5cbd3c293941fe72">vec</a>);
<a name="l00706"></a>00706   <a class="code" href="classZone__CoviMAC.html#a3dafd4d7bcba5c2b7a5065e806c684fb">is_init</a>[<span class="stringliteral">&quot;ve&quot;</span>] = 1, <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;OK&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00707"></a>00707 }
<a name="l00708"></a>00708 
<a name="l00709"></a>00709 
<a name="l00710"></a>00710 <span class="comment">// stencil face/face : fsten_f([fsten_d(f, 0), fsten_d(f + 1, 0)[)</span>
<a name="l00711"></a><a class="code" href="classZone__CoviMAC.html#a6f893d53a0d462eaf0406c41ae1ae078">00711</a> <span class="keywordtype">void</span> <a class="code" href="classZone__CoviMAC.html#a6f893d53a0d462eaf0406c41ae1ae078">Zone_CoviMAC::init_stencils</a>()<span class="keyword"> const</span>
<a name="l00712"></a>00712 <span class="keyword"></span>{
<a name="l00713"></a>00713   <span class="keywordflow">if</span> (<a class="code" href="classZone__CoviMAC.html#a3dafd4d7bcba5c2b7a5065e806c684fb">is_init</a>[<span class="stringliteral">&quot;stencils&quot;</span>]) <span class="keywordflow">return</span>;
<a name="l00714"></a>00714   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; f_s = <a class="code" href="classZone__VF.html#a6cac6a6e8fc1e7b0381b7b15eb451257" title="renvoie le tableau de connectivite faces/sommets.">face_sommets</a>(), &amp;f_e = <a class="code" href="classZone__VF.html#a816ac37fd526f962468cae6fbd8061f8" title="renvoie le tableaux des volumes des connectivites face elements cf au dessus.">face_voisins</a>(), &amp;e_f = <a class="code" href="classZone__VF.html#a8e09b61902b9f1d2c4c7bedc3b8f39d3" title="renvoie le tableau de connectivite element/faces">elem_faces</a>(), &amp;e_s = <a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>().<a class="code" href="classZone.html#ac115e8342be89afb882b7b61cc343267" title="Renvoie le tableau des sommets des elements.">les_elems</a>();
<a name="l00715"></a>00715   <span class="keywordtype">int</span> i, j, k, e, f, fb, s, ns_tot = <a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>().<a class="code" href="classZone.html#a379ad2206b5a13a4f4f3df6d44c7546a" title="Renvoie le domaine dont la zone fait partie. (version const)">domaine</a>().<a class="code" href="classDomaine.html#a394e61cf1993665886de0fbbd0c0178e" title="Renvoie le nombre total de sommets.">nb_som_tot</a>(), ok;
<a name="l00716"></a>00716   <a class="code" href="classZone__CoviMAC.html#af569b2bf358ef869bc39da3ef5772144">fsten_d</a>.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1), <a class="code" href="classZone__CoviMAC.html#af569b2bf358ef869bc39da3ef5772144">fsten_d</a>.<a class="code" href="classIntTab.html#a22e6bed6826b3688d4d0181cbf3b7a38" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(1), <a class="code" href="classZone__CoviMAC.html#ab2149ba390821ecd54c8730a4d98da6f">fsten_f</a>.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00717"></a>00717 
<a name="l00718"></a>00718 <span class="comment">// is_fb(f) = 1 pour les faces de bord</span>
<a name="l00719"></a>00719   <a class="code" href="classIntTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un IntTab avec allocation dans un pool de memoire gere...">IntTrav</a> is_fb(<a class="code" href="classZone__VF.html#a50fd21c9535680489015a3c8b88c685a" title="renvoie le nombre total de faces. C&#39;est-a-dire faces reelles + faces virtuelles">nb_faces_tot</a>());
<a name="l00720"></a>00720   <span class="keywordflow">for</span> (f = 0; f &lt; <a class="code" href="classZone__VF.html#a12869806fa4834aca8f2964e16509dfd" title="une face est interne ssi elle separe deux elements. renvoie le numero de la premiere face interne...">premiere_face_int</a>(); f++) is_fb(f) = 1;
<a name="l00721"></a>00721   <span class="keywordflow">for</span> (f = <a class="code" href="classZone__VF.html#aede27992d9f2eedd52c24d4a80ff7ffb" title="renvoie le nombre global de faces.">nb_faces</a>(); f &lt; <a class="code" href="classZone__VF.html#a50fd21c9535680489015a3c8b88c685a" title="renvoie le nombre total de faces. C&#39;est-a-dire faces reelles + faces virtuelles">nb_faces_tot</a>(); f++) is_fb(f) = (<a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>().<a class="code" href="classZone.html#a95faad2781efaed3b1129a2b4ec1644b">ind_faces_virt_bord</a>()(f - <a class="code" href="classZone__VF.html#aede27992d9f2eedd52c24d4a80ff7ffb" title="renvoie le nombre global de faces.">nb_faces</a>()) &gt;= 0);
<a name="l00722"></a>00722 
<a name="l00723"></a>00723   <span class="comment">/* connectivite sommets -&gt; elems / faces de bord */</span>
<a name="l00724"></a>00724   std::vector&lt;std::set&lt;int&gt;&gt; som_e(ns_tot), som_f(ns_tot);
<a name="l00725"></a>00725   <span class="keywordflow">for</span> (e = 0; e &lt; <a class="code" href="classZone__dis__base.html#a4d6aa445f152aa6dc54d66ea7a071147">nb_elem_tot</a>(); e++) <span class="keywordflow">for</span> (i = 0; i &lt; e_s.dimension(1) &amp;&amp; (s = e_s(e, i)) &gt;= 0; i++) som_e[s].insert(e);
<a name="l00726"></a>00726   <span class="keywordflow">for</span> (f = 0; f &lt; <a class="code" href="classZone__VF.html#a50fd21c9535680489015a3c8b88c685a" title="renvoie le nombre total de faces. C&#39;est-a-dire faces reelles + faces virtuelles">nb_faces_tot</a>(); f++) <span class="keywordflow">if</span> (is_fb(f)) <span class="keywordflow">for</span> (i = 0; i &lt; f_s.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1) &amp;&amp; (s = f_s(f, i)) &gt;= 0; i++) som_f[s].insert(f);
<a name="l00727"></a>00727 
<a name="l00728"></a>00728   std::set&lt;int&gt; soms, sf_f; <span class="comment">//sommets de la face f, elems connectes a e par soms, sommets / faces connectes par une face commune</span>
<a name="l00729"></a>00729   <span class="keywordflow">for</span> (f = 0; f &lt; <a class="code" href="classZone__VF.html#a50fd21c9535680489015a3c8b88c685a" title="renvoie le nombre total de faces. C&#39;est-a-dire faces reelles + faces virtuelles">nb_faces_tot</a>(); <a class="code" href="classZone__CoviMAC.html#af569b2bf358ef869bc39da3ef5772144">fsten_d</a>.<a class="code" href="classIntTab.html#ac0af4eac42ca46facc05f985c3ef05c6" title="Adds 1 to dimension_tot(0) and puts a in the added line.">append_line</a>(<a class="code" href="classZone__CoviMAC.html#ab2149ba390821ecd54c8730a4d98da6f">fsten_f</a>.<a class="code" href="classIntVect.html#ad90cfd411cbbd631ccf1935bb36f7c40" title="Identique a size_reelle()">size</a>()), f++) <span class="keywordflow">if</span> (f_e(f, 0) &gt;= 0 &amp;&amp; (is_fb(f) || f_e(f, 1) &gt;= 0))
<a name="l00730"></a>00730       {
<a name="l00731"></a>00731         soms.clear(), sf_f.clear();
<a name="l00732"></a>00732         <span class="keywordflow">for</span> (i = 0; i &lt; f_s.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1) &amp;&amp; (s = f_s(f, i)) &gt;= 0; i++) soms.insert(s);
<a name="l00733"></a>00733 
<a name="l00734"></a>00734         <span class="comment">/* connectivite par faces + sommets */</span>
<a name="l00735"></a>00735         <span class="keywordflow">for</span> (i = 0; i &lt; 2 &amp;&amp; (e = f_e(f, i)) &gt;= 0; i++) <span class="comment">//tout ce qui touche un sommet de f et est voisin de l&#39;amont/aval</span>
<a name="l00736"></a>00736           <span class="keywordflow">for</span> (j = 0; j &lt; e_f.dimension(1) &amp;&amp; (fb = e_f(e, j)) &gt;= 0; j++)
<a name="l00737"></a>00737             {
<a name="l00738"></a>00738               <span class="keywordflow">for</span> (k = 0, ok = 0; !ok &amp;&amp; k &lt; f_s.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1) &amp;&amp; (s = f_s(fb, k)) &gt;= 0; k++) ok |= soms.count(s);
<a name="l00739"></a>00739               <span class="keywordflow">if</span> (!ok) <span class="keywordflow">continue</span>; <span class="comment">//pas de sommet en commun avec f</span>
<a name="l00740"></a>00740               <span class="keywordflow">if</span> (fb != f) sf_f.insert(fb); <span class="comment">//face</span>
<a name="l00741"></a>00741             }
<a name="l00742"></a>00742         <span class="comment">/* remplissage */</span>
<a name="l00743"></a>00743         <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;&amp; fa : sf_f) <a class="code" href="classZone__CoviMAC.html#ab2149ba390821ecd54c8730a4d98da6f">fsten_f</a>.<a class="code" href="classIntTab.html#ac0af4eac42ca46facc05f985c3ef05c6" title="Adds 1 to dimension_tot(0) and puts a in the added line.">append_line</a>(fa);
<a name="l00744"></a>00744       }
<a name="l00745"></a>00745 
<a name="l00746"></a>00746   <a class="code" href="Zone__CoviMAC_8h.html#a30133bb5f8cebac5322355d13a055208">CRIMP</a>(<a class="code" href="classZone__CoviMAC.html#af569b2bf358ef869bc39da3ef5772144">fsten_d</a>), <a class="code" href="Zone__CoviMAC_8h.html#a30133bb5f8cebac5322355d13a055208">CRIMP</a>(<a class="code" href="classZone__CoviMAC.html#ab2149ba390821ecd54c8730a4d98da6f">fsten_f</a>);
<a name="l00747"></a>00747   <a class="code" href="classZone__CoviMAC.html#a3dafd4d7bcba5c2b7a5065e806c684fb">is_init</a>[<span class="stringliteral">&quot;stencils&quot;</span>] = 1;
<a name="l00748"></a>00748 }
<a name="l00749"></a>00749 
<a name="l00750"></a>00750 
<a name="l00751"></a>00751 <span class="comment">// construction des &quot;points harmoniques&quot; aux faces lies au gradient d&#39;un champ aux elements</span>
<a name="l00752"></a>00752 <span class="comment">// entrees : cls          : conditions aux limites</span>
<a name="l00753"></a>00753 <span class="comment">// is_p         : cas de la pression dans Navier-Stokes (CL de Neumann -&gt; Dirichlet, le reste -&gt; Neumann homogene)</span>
<a name="l00754"></a>00754 <span class="comment">// nu_grad      : 1 si on veut nf.(nu.grad T), 0 si on veut nf.grad T</span>
<a name="l00755"></a>00755 <span class="comment">// nu(e, n, ..) : diffusivite aux elements (optionnel)</span>
<a name="l00756"></a>00756 <span class="comment">// invh(f, n)   : resistivite (1 / h) aux faces de bord (optionnel)</span>
<a name="l00757"></a>00757 <span class="comment">// sorties : xh(f, n, d)           : point harmonique a la face f pour la composante n</span>
<a name="l00758"></a>00758 <span class="comment">// wh(f, n)              : pour les faces internes : Th(f, n) = wh(f, n) * Te(amont, n) + (1 - wh(f, n)) * Te(aval, n) si interne</span>
<a name="l00759"></a>00759 <span class="comment">// whm(f_ech, n, 0/1, m) : pour les faces Echange_contact : Th(f, n) = sum_m,i whm(f_ech, n, i, m) T(f_e(f, i), m)</span>
<a name="l00760"></a><a class="code" href="classZone__CoviMAC.html#a63b962eb09462d08a83365a03855dccb">00760</a> <span class="keywordtype">void</span> <a class="code" href="classZone__CoviMAC.html#a63b962eb09462d08a83365a03855dccb">Zone_CoviMAC::harmonic_points</a>(<span class="keyword">const</span> <a class="code" href="classConds__lim.html">Conds_lim</a>&amp; cls, <span class="keywordtype">int</span> is_p, <span class="keywordtype">int</span> nu_grad, <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> *nu, <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> *invh, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; xh, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; wh, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> *whm)<span class="keyword"> const</span>
<a name="l00761"></a>00761 <span class="keyword"></span>{
<a name="l00762"></a>00762   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; f_e = <a class="code" href="classZone__VF.html#a816ac37fd526f962468cae6fbd8061f8" title="renvoie le tableaux des volumes des connectivites face elements cf au dessus.">face_voisins</a>();
<a name="l00763"></a>00763   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; nf = <a class="code" href="classZone__CoviMAC.html#a4eb800da2b81e79955cd640ea9a83306">face_normales</a>();
<a name="l00764"></a>00764   <span class="keyword">const</span> <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; fs = <a class="code" href="classZone__VF.html#a40c3382b189a4fc508cf1c3e37b04b21">face_surfaces</a>();
<a name="l00765"></a>00765   <span class="keywordtype">int</span> i, j, e, f, fb, n, N = xh.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1), nf_tot = <a class="code" href="classZone__VF.html#a50fd21c9535680489015a3c8b88c685a" title="renvoie le nombre total de faces. C&#39;est-a-dire faces reelles + faces virtuelles">nb_faces_tot</a>(), d, D = <a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>;
<a name="l00766"></a>00766 
<a name="l00767"></a>00767   <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> lambda(2, N), xef(2, D), def(2), lambda_t(2, N, D);
<a name="l00768"></a>00768   <span class="keywordtype">double</span> i3[3][3] = { { 1, 0, 0 }, { 0, 1, 0}, { 0, 0, 1 }};
<a name="l00769"></a>00769 
<a name="l00770"></a>00770   <span class="comment">/* faces de bord : on delegue les CLs monolithique a Echange_contact_CoviMAC et on traite les autres */</span>
<a name="l00771"></a>00771   wh = -1; <span class="comment">//valeur par defaut : a la fin, wh = -1 que les faces au bord des joints</span>
<a name="l00772"></a>00772   <span class="keywordflow">for</span> (i = 0; i &lt; cls.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>(); i++)
<a name="l00773"></a>00773     <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classEchange__contact__CoviMAC.html">Echange_contact_CoviMAC</a>, cls[i].<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>())) <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classEchange__contact__CoviMAC.html">Echange_contact_CoviMAC</a>, cls[i].<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>()).<a class="code" href="classZone__CoviMAC.html#a63b962eb09462d08a83365a03855dccb">harmonic_points</a>(xh, wh, *whm);
<a name="l00774"></a>00774     <span class="keywordflow">else</span> <span class="comment">/* vraie face de bord */</span>
<a name="l00775"></a>00775       {
<a name="l00776"></a>00776         <span class="keyword">const</span> <a class="code" href="classCond__lim__base.html" title="classe Cond_lim_base Classe de base pour la hierarchie des classes qui representent les differentes c...">Cond_lim_base</a>&amp; cl = cls[i].valeur();
<a name="l00777"></a>00777         <span class="keyword">const</span> <a class="code" href="classFront__VF.html" title="class Front_VF">Front_VF</a>&amp; fvf = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classFront__VF.html" title="class Front_VF">Front_VF</a>, cl.<a class="code" href="classCond__lim__base.html#ad88b3b516351146c85e8fce1df0f691a" title="Renvoie la frontiere discretisee a laquelle les conditions aux limites s&#39;appliquent.">frontiere_dis</a>());
<a name="l00778"></a>00778         <span class="keywordtype">int</span> neu  = <a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classNeumann.html" title="Classe Neumann Cette classe est la classe de base de la hierarchie des conditions aux limites de type...">Neumann</a>, cl), neu_h = <a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classNeumann__homogene.html" title="Classe Neumann_homogene Cette classe est la classe de base de la hierarchie des conditions aux limite...">Neumann_homogene</a>, cl), sym = <a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classSymetrie.html" title="classe Symetrie Sur les faces de symetrie on a les proprietes suivantes: - composante normale de la v...">Symetrie</a>, cl),
<a name="l00779"></a>00779             dir  = <a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classDirichlet.html" title="classe Dirichlet Cette classe est la classe de base de la hierarchie des conditions aux limites de ty...">Dirichlet</a>, cl), dir_h = <a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classDirichlet__homogene.html" title="Classe Dirichlet_homogene Cette classe est la classe de base de la hierarchie des conditions aux limi...">Dirichlet_homogene</a>, cl),
<a name="l00780"></a>00780             echg = <a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classEchange__impose__base.html" title="classe Echange_impose_base: Cette condition limite sert uniquement pour l&#39;equation d&#39;energie...">Echange_impose_base</a>, cl);
<a name="l00781"></a>00781         <span class="keywordflow">for</span> (j = 0; j &lt; fvf.<a class="code" href="classFront__VF.html#aed4006d91bf2ef3af2b9f7933d863a09" title="Nombre de faces reelles et virtuelles du bord.">nb_faces_tot</a>(); j++)
<a name="l00782"></a>00782           {
<a name="l00783"></a>00783             f = fvf.<a class="code" href="classFront__VF.html#a3402a19d7e54ed797d2b18e9a47ead1e" title="Renvoie le numero de face de la ieme face du bord.">num_face</a>(j), e = f_e(f, 0), fb = <a class="code" href="classZone__VF.html#a9cfb439ce3b58852ba3beec40b2b8c4e">fbord</a>(f); <span class="comment">//numero de l&#39;elem en face, de face de bord</span>
<a name="l00784"></a>00784 <span class="comment">// diffusion : partie normale (nf.nu.nf), partie tangente (nu.nf - (nf.nu.nf)nf )</span>
<a name="l00785"></a>00785             <span class="keywordflow">for</span> (n = 0; n &lt; N; n++) <span class="keywordflow">for</span> (lambda(0, n) = <a class="code" href="classZone__CoviMAC.html#adb355629a4e62710130ee231b2e5866f">nu_dot</a>(nu, e, n, &amp;nf(f, 0), &amp;nf(f, 0)) / (fs(f) * fs(f)), d = 0; d &lt; D; d++)
<a name="l00786"></a>00786                 lambda_t(0, n, d) = (<a class="code" href="classZone__CoviMAC.html#adb355629a4e62710130ee231b2e5866f">nu_dot</a>(nu, e, n, i3[d], &amp;nf(f, 0)) - lambda(0, n) * nf(f, d)) / fs(f);
<a name="l00787"></a>00787             <span class="keywordflow">for</span> (def(0) = <a class="code" href="classZone__CoviMAC.html#a7a5ffb545c8b97f0ed2cd0026707350f">dot</a>(&amp;<a class="code" href="classZone__VF.html#a30d5c38f1825d8d35ce9c83aa37e5aa6" title="centres de gravite des faces">xv_</a>(f, 0), &amp;nf(f, 0), &amp;<a class="code" href="classZone__VF.html#ae0dc3dc379de71f9d99115ab6973f0f6" title="centres de gravite des elements">xp_</a>(e, 0)) / fs(f), d = 0; d &lt; D; d++) <span class="comment">//projection elem-&gt;face</span>
<a name="l00788"></a>00788               xef(0, d) = <a class="code" href="classZone__VF.html#ae0dc3dc379de71f9d99115ab6973f0f6" title="centres de gravite des elements">xp_</a>(e, d) + def(0) * nf(f, d) / fs(f), xef(1, d) = <a class="code" href="classZone__VF.html#a30d5c38f1825d8d35ce9c83aa37e5aa6" title="centres de gravite des faces">xv_</a>(f, d);
<a name="l00789"></a>00789 
<a name="l00790"></a>00790             <span class="keywordflow">if</span> (is_p ? (neu || neu_h) : (dir || dir_h || echg)) <span class="keywordflow">for</span> (n = 0; n &lt; N; n++) <span class="comment">//Dirichlet / Echange_impose_base : pt harmonique avec def(1) -&gt; 0</span>
<a name="l00791"></a>00791                 {
<a name="l00792"></a>00792                   <span class="keywordtype">double</span> r = (invh ? (*invh)(fb, n) : 0) + (echg ? 1. / <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classEchange__impose__base.html" title="classe Echange_impose_base: Cette condition limite sert uniquement pour l&#39;equation d&#39;energie...">Echange_impose_base</a>, cl).h_imp(j, n) : 0); <span class="comment">//resistance thermique totale</span>
<a name="l00793"></a>00793 <span class="comment">// double scal = dot(&amp;xv_(f, 0), &amp;nf(f, 0), &amp;xp_(e, 0)) / (fs(f) * (nu_grad ? lambda(0, n) : 1));</span>
<a name="l00794"></a>00794                   <span class="keywordflow">for</span> (wh(f, n) = 1 - 1. / (1 + r * lambda(0, n) / def(0)), d = 0; d &lt; D; d++) <span class="comment">//poids de l&#39;amont</span>
<a name="l00795"></a>00795                     xh(f, n, d) = (def(0) * xef(1, d) + r * (lambda(0, n) * xef(0, d) + def(0) * lambda_t(0, n, d))) / (def(0) + r * lambda(0, n)); <span class="comment">//position</span>
<a name="l00796"></a>00796 <span class="comment">// xh(f, n, d) = xp_(e, d) + scal * (nu_grad ? nu_dot(nu, e, n, &amp;nf(f, 0), i3[d]) : nf(f, d)) / fs(f);</span>
<a name="l00797"></a>00797                 }
<a name="l00798"></a>00798             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_p ? (dir || dir_h || sym) : (neu || neu_h || sym)) <span class="keywordflow">for</span> (n = 0; n &lt; N; n++) <span class="comment">//Neumann : projection sur la face selon nu.nf</span>
<a name="l00799"></a>00799                 {
<a name="l00800"></a>00800                   <span class="keywordtype">double</span> scal = <a class="code" href="classZone__CoviMAC.html#a7a5ffb545c8b97f0ed2cd0026707350f">dot</a>(&amp;<a class="code" href="classZone__VF.html#a30d5c38f1825d8d35ce9c83aa37e5aa6" title="centres de gravite des faces">xv_</a>(f, 0), &amp;nf(f, 0), &amp;<a class="code" href="classZone__VF.html#ae0dc3dc379de71f9d99115ab6973f0f6" title="centres de gravite des elements">xp_</a>(e, 0)) / (fs(f) * (nu_grad ? lambda(0, n) : 1));
<a name="l00801"></a>00801                   <span class="keywordflow">for</span> (wh(f, n) = 1, d = 0; d &lt; D; d++) xh(f, n, d) = <a class="code" href="classZone__VF.html#ae0dc3dc379de71f9d99115ab6973f0f6" title="centres de gravite des elements">xp_</a>(e, d) + scal * (nu_grad ? <a class="code" href="classZone__CoviMAC.html#adb355629a4e62710130ee231b2e5866f">nu_dot</a>(nu, e, n, &amp;nf(f, 0), i3[d]) : nf(f, d)) / fs(f);
<a name="l00802"></a>00802                 }
<a name="l00803"></a>00803             <span class="keywordflow">else</span> <a class="code" href="classProcess.html#a6a4b64571b10f150a70db229b839e881" title="Routine de sortie de Trio-U sur une erreur abort()">abort</a>();
<a name="l00804"></a>00804           }
<a name="l00805"></a>00805       }
<a name="l00806"></a>00806 
<a name="l00807"></a>00807   <span class="comment">/* faces internes */</span>
<a name="l00808"></a>00808   <span class="keywordflow">for</span> (f = <a class="code" href="classZone__VF.html#a12869806fa4834aca8f2964e16509dfd" title="une face est interne ssi elle separe deux elements. renvoie le numero de la premiere face interne...">premiere_face_int</a>(); f &lt; nf_tot; f++) if (f_e(f, 0) &gt;= 0 &amp;&amp; f_e(f, 1) &gt;= 0) <span class="comment">/* on doit avoir les deux voisins */</span>
<a name="l00809"></a>00809       {
<a name="l00810"></a>00810         <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) <span class="keywordflow">for</span> (e = f_e(f, i), n = 0; n &lt; N; n++) lambda(i, n) = <a class="code" href="classZone__CoviMAC.html#adb355629a4e62710130ee231b2e5866f">nu_dot</a>(nu, e, n, &amp;nf(f, 0), &amp;nf(f, 0)) / (fs(f) * fs(f));
<a name="l00811"></a>00811         <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) <span class="keywordflow">for</span> (e = f_e(f, i), def(i) = (i ? -1 : 1) * <a class="code" href="classZone__CoviMAC.html#a7a5ffb545c8b97f0ed2cd0026707350f">dot</a>(&amp;<a class="code" href="classZone__VF.html#a30d5c38f1825d8d35ce9c83aa37e5aa6" title="centres de gravite des faces">xv_</a>(f, 0), &amp;nf(f, 0), &amp;<a class="code" href="classZone__VF.html#ae0dc3dc379de71f9d99115ab6973f0f6" title="centres de gravite des elements">xp_</a>(e, 0)) / fs(f), d = 0; d &lt; D; d++)
<a name="l00812"></a>00812             xef(i, d) = <a class="code" href="classZone__VF.html#ae0dc3dc379de71f9d99115ab6973f0f6" title="centres de gravite des elements">xp_</a>(e, d) + (i ? -1 : 1) * def(i) * nf(f, d) / fs(f);
<a name="l00813"></a>00813         <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) <span class="keywordflow">for</span> (e = f_e(f, i), n = 0; n &lt; N; n++) <span class="keywordflow">for</span> (d = 0; d &lt; D; d++)
<a name="l00814"></a>00814               lambda_t(i, n, d) = (<a class="code" href="classZone__CoviMAC.html#adb355629a4e62710130ee231b2e5866f">nu_dot</a>(nu, e, n, i3[d], &amp;nf(f, 0)) - lambda(i, n) * nf(f, d)) / fs(f);
<a name="l00815"></a>00815         <span class="keywordflow">for</span> (n = 0; n &lt; N; n++) <span class="keywordflow">for</span> (d = 0; d &lt; D; d++) <span class="comment">/* position du &quot;harmonic average point &quot;*/</span>
<a name="l00816"></a>00816             xh(f, n, d) = (lambda(1, n) * def(0) * xef(1, d) + lambda(0, n) * def(1) * xef(0, d) + def(0) * def(1) * (lambda_t(1, n, d) - lambda_t(0, n, d)))
<a name="l00817"></a>00817                           / (lambda(1, n) * def(0) + lambda(0, n) * def(1));
<a name="l00818"></a>00818         <span class="keywordflow">for</span> (n = 0; n &lt; N; n++) <span class="comment">/* poids de l&#39;amont dans la valeur a ce point */</span>
<a name="l00819"></a>00819           wh(f, n) = lambda(0, n) * def(1) / (lambda(1, n) * def(0) + lambda(0, n) * def(1));
<a name="l00820"></a>00820       }
<a name="l00821"></a>00821 }
<a name="l00822"></a>00822 
<a name="l00823"></a>00823 <span class="comment">// pour u.n champ T aux elements, interpole [n_f.grad T]_f (si nu_grad = 0) ou [n_f.nu.grad T]_f</span>
<a name="l00824"></a>00824 <span class="comment">// en preservant exactement les champs verifiant [nu grad T]_e = cte.</span>
<a name="l00825"></a>00825 <span class="comment">// Entrees : cls           : conditions aux limites</span>
<a name="l00826"></a>00826 <span class="comment">// fcl(f, 0/1/2) : donnes sur les CLs (type de CL, indice de CL, indice dans la CL) (cf. Champ_{P0,Face}_CoviMAC)</span>
<a name="l00827"></a>00827 <span class="comment">// nu(e, n, ..)  : diffusivite aux elements (optionnel)</span>
<a name="l00828"></a>00828 <span class="comment">// invh(f, n)    : resistivite (1/h) aux bords (optionnel)</span>
<a name="l00829"></a>00829 <span class="comment">// xh, wh, whm   : donnees sur les points harmoniques retournees par harmonic_points()</span>
<a name="l00830"></a>00830 <span class="comment">// pe_ext        : donnees sur les CL Echange_contact retournees par Op_Diff_CoviMAC_base</span>
<a name="l00831"></a>00831 <span class="comment">// nu_grad       : 1 si on veut nf.(nu.grad T), 0 si on veut nf.grad T</span>
<a name="l00832"></a>00832 <span class="comment">// full_stencil  : 1 si on veut le stencil complet (pour dimensionner())</span>
<a name="l00833"></a>00833 <span class="comment">// Sorties : phif_w(f, n)                         : poids de l&#39;amont dans la compo n du flux</span>
<a name="l00834"></a>00834 <span class="comment">// phif_d(f, 0/1)                       : indices dans phif_{e,c} / phif_{pe,pc} du flux a f dans [phif_d(f, 0/1), phif_d(f + 1, 0/1)[</span>
<a name="l00835"></a>00835 <span class="comment">// phif_e(i), phif_c(i, n, c)           : indices/coefficients locaux (pas d&#39;Echange_contact) et diagonaux (composantes independantes)</span>
<a name="l00836"></a>00836 <span class="comment">// phif_pe(i, 0/1), phif_pc(i, n, m, c) : indices (pb, elem) /coefficients distants et/ou non diagonaux</span>
<a name="l00837"></a><a class="code" href="classZone__CoviMAC.html#ab90f3265359235297d3df79d3906318c">00837</a> <span class="keywordtype">void</span> <a class="code" href="classZone__CoviMAC.html#ab90f3265359235297d3df79d3906318c">Zone_CoviMAC::fgrad</a>(<span class="keyword">const</span> <a class="code" href="classConds__lim.html">Conds_lim</a>&amp; cls, <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; fcl, <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> *nu, <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> *invh,
<a name="l00838"></a>00838                          <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; xh, <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; wh, <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> *whm, <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a> *pe_ext, <span class="keywordtype">int</span> nu_grad, <span class="keywordtype">int</span> full_stencil,
<a name="l00839"></a>00839                          <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; phif_w, <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; phif_d, <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; phif_e, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; phif_c, <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a> *phif_pe, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> *phif_pc)<span class="keyword"> const</span>
<a name="l00840"></a>00840 <span class="keyword"></span>{
<a name="l00841"></a>00841   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; f_e = <a class="code" href="classZone__VF.html#a816ac37fd526f962468cae6fbd8061f8" title="renvoie le tableaux des volumes des connectivites face elements cf au dessus.">face_voisins</a>();
<a name="l00842"></a>00842   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; nf = <a class="code" href="classZone__CoviMAC.html#a4eb800da2b81e79955cd640ea9a83306">face_normales</a>();
<a name="l00843"></a>00843   <span class="keyword">const</span> <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; fs = <a class="code" href="classZone__VF.html#a40c3382b189a4fc508cf1c3e37b04b21">face_surfaces</a>();
<a name="l00844"></a>00844   <span class="keywordtype">int</span> i, j, k, l, e, f, e_s, f_s, f_sb, m, n, N = xh.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1), M = whm ? whm-&gt;<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(2) : N, ne_tot = <a class="code" href="classZone__dis__base.html#a4d6aa445f152aa6dc54d66ea7a071147">nb_elem_tot</a>(), nw, infoo, d, D = <a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>, f_max = phif_w.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0), nnz, hdiag;
<a name="l00845"></a>00845   <span class="keywordtype">char</span> trans = <span class="charliteral">&#39;N&#39;</span>;
<a name="l00846"></a>00846   <span class="keywordtype">double</span> i3[3][3] = { { 1, 0, 0 }, { 0, 1, 0}, { 0, 0, 1 }};
<a name="l00847"></a>00847   phif_d.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1), phif_e.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1), phif_e.<a class="code" href="classIntTab.html#a22e6bed6826b3688d4d0181cbf3b7a38" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(0), phif_c.<a class="code" href="classArrOfDouble.html#ab49f6cae96be9d3f597468d8a53b67b6" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1), phif_c.<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(0, N, 2);
<a name="l00848"></a>00848   <span class="keywordflow">if</span> (phif_pe) phif_d.<a class="code" href="classIntTab.html#a22e6bed6826b3688d4d0181cbf3b7a38" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(1, 2), phif_pe-&gt;<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1), phif_pe-&gt;<a class="code" href="classIntTab.html#a22e6bed6826b3688d4d0181cbf3b7a38" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(0, 2), phif_pc-&gt;<a class="code" href="classArrOfDouble.html#ab49f6cae96be9d3f597468d8a53b67b6" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1), phif_pc-&gt;<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(0, N, M, 2);
<a name="l00849"></a>00849   <span class="keywordflow">else</span> phif_d.<a class="code" href="classIntTab.html#a22e6bed6826b3688d4d0181cbf3b7a38" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(1);
<a name="l00850"></a>00850 
<a name="l00851"></a>00851   <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> base, A, B, interp, phi, W(1), r_int(N, 2), lambda(2);
<a name="l00852"></a>00852   base.<a class="code" href="classArrOfDouble.html#ab49f6cae96be9d3f597468d8a53b67b6" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1), A.<a class="code" href="classArrOfDouble.html#ab49f6cae96be9d3f597468d8a53b67b6" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1), B.<a class="code" href="classArrOfDouble.html#ab49f6cae96be9d3f597468d8a53b67b6" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1), interp.<a class="code" href="classArrOfDouble.html#ab49f6cae96be9d3f597468d8a53b67b6" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1), phi.<a class="code" href="classArrOfDouble.html#ab49f6cae96be9d3f597468d8a53b67b6" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1), W.set_smart_resize(1);
<a name="l00853"></a>00853   std::vector&lt;std::pair&lt;int, int&gt;&gt; p_e; <span class="comment">//stencil aux elements</span>
<a name="l00854"></a>00854   <a class="code" href="classZone__CoviMAC.html#a6f893d53a0d462eaf0406c41ae1ae078">init_stencils</a>();
<a name="l00855"></a>00855 
<a name="l00856"></a>00856   <span class="keywordflow">for</span> (f = 0; f &lt; f_max; (phif_pe ? phif_d.<a class="code" href="classIntTab.html#ac0af4eac42ca46facc05f985c3ef05c6" title="Adds 1 to dimension_tot(0) and puts a in the added line.">append_line</a>(phif_e.<a class="code" href="classIntVect.html#ad90cfd411cbbd631ccf1935bb36f7c40" title="Identique a size_reelle()">size</a>(), phif_pe-&gt;<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0)) : phif_d.<a class="code" href="classIntTab.html#ac0af4eac42ca46facc05f985c3ef05c6" title="Adds 1 to dimension_tot(0) and puts a in the added line.">append_line</a>(phif_e.<a class="code" href="classIntVect.html#ad90cfd411cbbd631ccf1935bb36f7c40" title="Identique a size_reelle()">size</a>())), f++)
<a name="l00857"></a>00857     <span class="keywordflow">if</span> (fcl(f, 0) &gt;= 0 &amp;&amp; <a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classEchange__contact__CoviMAC.html">Echange_contact_CoviMAC</a>, cls[fcl(f, 1)].<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>())) <span class="comment">//Echange_contact -&gt; delegation</span>
<a name="l00858"></a>00858       {
<a name="l00859"></a>00859         <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classEchange__contact__CoviMAC.html">Echange_contact_CoviMAC</a>, cls[fcl(f, 1)].<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>()).fgrad(full_stencil, phif_w, phif_d, phif_e, phif_c, *phif_pe, *phif_pc); <span class="comment">//remplit toutes les faces de la CL</span>
<a name="l00860"></a>00860         phif_d.<a class="code" href="classIntTab.html#a22e6bed6826b3688d4d0181cbf3b7a38" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(phif_d.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0) - 1, 2), f = phif_d.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0) - 1; <span class="comment">//pour que f et phif_d soient bons a la prochaine iteration de la boucle</span>
<a name="l00861"></a>00861       }
<a name="l00862"></a>00862     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wh(f, 0) &gt;= 0) <span class="comment">//faces internes ou de bord &quot;normales&quot; -&gt; il faut etre assez loin du joint pour que tous les ooints harmoniques soient definis</span>
<a name="l00863"></a>00863       {
<a name="l00864"></a>00864         <span class="keywordtype">int</span> ok = 1, n_f = <a class="code" href="classZone__CoviMAC.html#af569b2bf358ef869bc39da3ef5772144">fsten_d</a>(f + 1) - <a class="code" href="classZone__CoviMAC.html#af569b2bf358ef869bc39da3ef5772144">fsten_d</a>(f), nc = n_f + 1, nl = D + 1, nrhs = 1 + (f_e(f, 1) &gt;= 0); <span class="comment">//nombre de faces dans le stencil, indice de face de bord</span>
<a name="l00865"></a>00865         <span class="keyword">const</span> <span class="keywordtype">int</span> *fa = &amp;<a class="code" href="classZone__CoviMAC.html#ab2149ba390821ecd54c8730a4d98da6f">fsten_f</a>(<a class="code" href="classZone__CoviMAC.html#af569b2bf358ef869bc39da3ef5772144">fsten_d</a>(f)); <span class="comment">//pointeur vers la premiere face du stencil</span>
<a name="l00866"></a>00866         <span class="keywordflow">for</span> (i = 0; i &lt; n_f; i++) ok &amp;= (wh(fa[i], 0) &gt;= 0);
<a name="l00867"></a>00867         <span class="keywordflow">if</span> (!ok) <span class="keywordflow">continue</span>; <span class="comment">//il manque un point harmonique -&gt; on sort</span>
<a name="l00868"></a>00868 
<a name="l00869"></a>00869         base.<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(nrhs, D, D), A.<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(nc, nl), B.<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(nrhs, nc), interp.<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(nc, N, nrhs); <span class="comment">//systeme Ax = B -&gt; format LAPACK</span>
<a name="l00870"></a>00870         <span class="keywordflow">for</span> (interp = 0, n = 0; n &lt; N; n++) <span class="keywordflow">for</span> (i = 0; i &lt; nrhs; i++) interp(n_f, n, i) = 1; <span class="comment">//interpolation de depart : celle au point harmonique</span>
<a name="l00871"></a>00871         <span class="keywordflow">for</span> (n = 0; n &lt; N; n++)
<a name="l00872"></a>00872           {
<a name="l00873"></a>00873             <span class="comment">/* base : base de &quot;vecteurs tests&quot; amont/aval d&#39;un gradient verifiant nf.nu_am.vec_am = nf.nu_av.vec_av */</span>
<a name="l00874"></a>00874             <span class="keywordflow">for</span> (i = 0; i &lt; nrhs; i++) lambda(i) = <a class="code" href="classZone__CoviMAC.html#adb355629a4e62710130ee231b2e5866f">nu_dot</a>(nu, f_e(f, i), n, &amp;nf(f, 0), &amp;nf(f, 0)) / (fs(f) * fs(f));
<a name="l00875"></a>00875             <span class="keywordflow">for</span> (i = 0; i &lt; nrhs; i++) <span class="keywordflow">for</span> (j = 0; j &lt; D; j++) <span class="keywordflow">for</span> (d = 0; d &lt; D; d++)
<a name="l00876"></a>00876                   base(i, j, d) = i3[j][d] + (i ? -1 : 1) * (<a class="code" href="classZone__CoviMAC.html#adb355629a4e62710130ee231b2e5866f">nu_dot</a>(nu, f_e(f, f_e(f, 1) &gt;= 0), n, &amp;nf(f, 0), i3[j]) - <a class="code" href="classZone__CoviMAC.html#adb355629a4e62710130ee231b2e5866f">nu_dot</a>(nu, f_e(f, 0), n, &amp;nf(f, 0), i3[j])) * nf(f, d) / (2 * lambda(i) * fs(f) * fs(f));
<a name="l00877"></a>00877 
<a name="l00878"></a>00878             <span class="comment">/* seconds membres : au passage, on calcule la resistance interne r = d / lambda */</span>
<a name="l00879"></a>00879             <span class="keywordflow">for</span> (B = 0, i = 0; i &lt; nrhs; i++)
<a name="l00880"></a>00880               {
<a name="l00881"></a>00881                 e = f_e(f, i), r_int(n, i) = (i ? -1 : 1) * <a class="code" href="classZone__CoviMAC.html#a7a5ffb545c8b97f0ed2cd0026707350f">dot</a>(&amp;<a class="code" href="classZone__VF.html#a30d5c38f1825d8d35ce9c83aa37e5aa6" title="centres de gravite des faces">xv_</a>(f, 0), &amp;nf(f, 0), &amp;<a class="code" href="classZone__VF.html#ae0dc3dc379de71f9d99115ab6973f0f6" title="centres de gravite des elements">xp_</a>(e, 0)) / (fs(f) * (nu_grad ? lambda(i) : 1));
<a name="l00882"></a>00882                 <span class="keywordflow">for</span> (d = 0; d &lt; D; d++) B(i, d) = <a class="code" href="classZone__VF.html#ae0dc3dc379de71f9d99115ab6973f0f6" title="centres de gravite des elements">xp_</a>(e, d) + (i ? -1 : 1) * r_int(n, i) * (nu_grad ? <a class="code" href="classZone__CoviMAC.html#adb355629a4e62710130ee231b2e5866f">nu_dot</a>(nu, e, n, &amp;nf(f, 0), i3[d]) : nf(f, d)) / fs(f) - xh(f, n, d);
<a name="l00883"></a>00883               }
<a name="l00884"></a>00884 
<a name="l00885"></a>00885             <span class="comment">/* interpolation des points projetes amont / aval */</span>
<a name="l00886"></a>00886             <span class="keywordflow">if</span> (std::pow(1e6 * <a class="code" href="DoubleVect_8cpp.html#aad339141fa6027fa3b627825a2407c12">local_max_abs_vect</a>(B), D - 1) &gt; fs(f)) <span class="comment">//si les pts projetes ne sont pas dessus -&gt; corrections</span>
<a name="l00887"></a>00887               {
<a name="l00888"></a>00888                 <span class="comment">/* matrice A (format LAPACK) */</span>
<a name="l00889"></a>00889                 <span class="keywordflow">for</span> (i = 0; i &lt; n_f; i++) for (k = (dot(&amp;xh(fa[i], n, 0), &amp;nf(f, 0), &amp;xh(f, n, 0)) &gt; 0 &amp;&amp; nrhs &gt; 1), d = 0; d &lt; nl; d++) <span class="comment">//faces du stencil</span>
<a name="l00890"></a>00890                     A(i, d) = d &lt; D ? <a class="code" href="classZone__CoviMAC.html#a7a5ffb545c8b97f0ed2cd0026707350f">dot</a>(&amp;xh(fa[i], n, 0), &amp;base(k, d, 0), &amp;xh(f, n, 0)) : 1;
<a name="l00891"></a>00891                 <span class="keywordflow">for</span> (d = 0; d &lt; nl; d++) A(n_f, d) = d &lt; D ? 0 : 1; <span class="comment">//face elle-meme</span>
<a name="l00892"></a>00892 
<a name="l00893"></a>00893                 <span class="comment">/* resolution */</span>
<a name="l00894"></a>00894                 nw = -1, <a class="code" href="arch_8h.html#a9b91c72ded7de2f0b393ea75de53929b">F77NAME</a>(dgels)(&amp;trans, &amp;nl, &amp;nc, &amp;nrhs, &amp;A(0, 0), &amp;nl, &amp;B(0, 0), &amp;nc, &amp;W(0), &amp;nw, &amp;infoo);
<a name="l00895"></a>00895                 W.resize(nw = W(0)), <a class="code" href="arch_8h.html#a9b91c72ded7de2f0b393ea75de53929b">F77NAME</a>(dgels)(&amp;trans, &amp;nl, &amp;nc, &amp;nrhs, &amp;A(0, 0), &amp;nl, &amp;B(0, 0), &amp;nc, &amp;W(0), &amp;nw, &amp;infoo);
<a name="l00896"></a>00896                 <span class="comment">/* correction de interp (avec ecretage) */</span>
<a name="l00897"></a>00897                 <span class="keywordflow">for</span> (i = 0; i &lt; nrhs; i++) for (j = 0; j &lt; nc; j++) interp(j, n, i) += dabs(B(i, j)) &gt; 1e-8 ? B(i, j) : 0;
<a name="l00898"></a>00898               }
<a name="l00899"></a>00899           }
<a name="l00900"></a>00900 
<a name="l00901"></a>00901         <span class="comment">/* construction du stencil aux elements */</span>
<a name="l00902"></a>00902         <span class="keywordflow">for</span> (p_e.clear(), i = 0; i &lt;= n_f; i++) <span class="keywordflow">for</span> (f_s = i &lt; n_f ? fa[i] : f, f_sb = <a class="code" href="classZone__VF.html#a9cfb439ce3b58852ba3beec40b2b8c4e">fbord</a>(f_s), j = 0; j &lt; 2; j++)
<a name="l00903"></a>00903             <span class="keywordflow">if</span> ((e_s = f_e(f_s, j)) &gt;= 0) p_e.push_back(std::make_pair(0, e_s)); <span class="comment">//element normal</span>
<a name="l00904"></a>00904             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (f_sb &gt;= 0 &amp;&amp; pe_ext &amp;&amp; (e_s = (*pe_ext)(f_sb, 1)) &gt;= 0) p_e.push_back(std::make_pair((*pe_ext)(f_sb, 0), e_s)); <span class="comment">//de l&#39;autre cote d&#39;un Echange_contact</span>
<a name="l00905"></a>00905             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (f_sb &gt;= 0) p_e.push_back(std::make_pair(0, ne_tot + f_s)); <span class="comment">//CL non Echange_contact -&gt; dependance en les valeurs aux bords</span>
<a name="l00906"></a>00906         <a class="code" href="AssembleurPP1BUtil_8cpp.html#acff816d35f8d4ce978f860e0cd958b8a">std::sort</a>(p_e.begin(), p_e.end()), p_e.erase(std::unique(p_e.begin(), p_e.end()), p_e.end()); <span class="comment">//classement + deduplication</span>
<a name="l00907"></a>00907 
<a name="l00908"></a>00908         <span class="comment">/* passage au flux */</span>
<a name="l00909"></a>00909         phi.<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(p_e.size(), N, M, 2), phi = 0;
<a name="l00910"></a>00910         <span class="keywordflow">for</span> (n = 0; n &lt; N; n++) phif_w(f, n) = nrhs &lt; 2 ? 1 : r_int(n, 0) * wh(f, n) / (r_int(n, 0) * wh(f, n) + r_int(n, 1) * (1 - wh(f, n))); <span class="comment">//poids de l&#39;amont</span>
<a name="l00911"></a>00911 
<a name="l00912"></a>00912         <span class="keywordflow">for</span> (i = 0; i &lt;= n_f; i++) <span class="keywordflow">for</span> (f_s = i &lt; n_f ? fa[i] : f, f_sb = <a class="code" href="classZone__VF.html#a9cfb439ce3b58852ba3beec40b2b8c4e">fbord</a>(f_s), j = 0; j &lt; 2; j++)
<a name="l00913"></a>00913             <span class="keywordflow">if</span> ((e_s = f_e(f_s, j) &gt;= 0 ? f_e(f_s, j) : f_sb &gt;= 0 &amp;&amp; pe_ext &amp;&amp; (*pe_ext)(f_sb, 0) &gt;= 0 ? (*pe_ext)(f_sb, 1) : -1) &gt;= 0) <span class="comment">//il existe un element source (interne ou externe)</span>
<a name="l00914"></a>00914               {
<a name="l00915"></a>00915                 k = std::lower_bound(p_e.begin(), p_e.end(), std::make_pair(f_e(f_s, j) &gt;= 0 ? 0 : (*pe_ext)(f_sb, 0), e_s)) - p_e.begin();<span class="comment">//position dans le stencil</span>
<a name="l00916"></a>00916                 <span class="keywordflow">if</span> (f_sb &lt; 0 || !pe_ext || (*pe_ext)(f_sb, 0) &lt; 0) <span class="keywordflow">for</span> (n = 0; n &lt; N; n++) <span class="keywordflow">for</span> (l = 0; l &lt; nrhs; l++) <span class="comment">//point harmonique standard -&gt; composantes separees</span>
<a name="l00917"></a>00917                       phi(k, n, n, l) += (l ? -1 : 1) / r_int(n, l) * interp(i, n, l) * (j ? 1 - wh(f_s, n) : wh(f_s, n));
<a name="l00918"></a>00918                 <span class="keywordflow">else</span> <span class="keywordflow">for</span> (n = 0; n &lt; N; n++) <span class="keywordflow">for</span> (m = 0; m &lt; M; m++) <span class="keywordflow">for</span> (l = 0; l &lt; nrhs; l++) <span class="comment">//pt harmonique a une Echange_contact -&gt; melange des composantes</span>
<a name="l00919"></a>00919                         phi(k, n, m, l) += (l ? -1 : 1) / r_int(n, l) * interp(i, n, l) * (*whm)((*pe_ext)(f_sb, 2), n, m, j);
<a name="l00920"></a>00920               }
<a name="l00921"></a>00921             <span class="keywordflow">else</span> <span class="keywordflow">for</span> (k = std::lower_bound(p_e.begin(), p_e.end(), std::make_pair((<span class="keywordtype">int</span>)0, ne_tot + f_s)) - p_e.begin(), n = 0; n &lt; N; n++) <span class="comment">//face de bord -&gt; dependance en la CL</span>
<a name="l00922"></a>00922                 <span class="keywordflow">for</span> (l = 0; l &lt; nrhs; l++) phi(k, n, n, l) += (l ? -1 : 1) / r_int(n, l) * interp(i, n, l)
<a name="l00923"></a>00923                                                                 * (wh(f_s, n) &lt; 1 ? 1 - wh(f_s, n) : <a class="code" href="classZone__CoviMAC.html#af95d2084d566bad62b845d8e0fe76eef">dist_norm_bord</a>(f_s) / (nu_grad ? -<a class="code" href="classZone__CoviMAC.html#adb355629a4e62710130ee231b2e5866f">nu_dot</a>(nu, f_e(f_s, 0), n, &amp;nf(f_s, 0), &amp;nf(f_s, 0)) / (fs(f_s) * fs(f_s)) : 1));
<a name="l00924"></a>00924 <span class="comment">// amont/aval</span>
<a name="l00925"></a>00925         <span class="keywordflow">for</span> (i = 0; i &lt; nrhs; i++) <span class="keywordflow">for</span> (k = std::lower_bound(p_e.begin(), p_e.end(), std::make_pair((<span class="keywordtype">int</span>)0, f_e(f, i))) - p_e.begin(), n = 0; n &lt; N; n++)
<a name="l00926"></a>00926             phi(k, n, n, i) += (i ? 1 : -1) / r_int(n, i);
<a name="l00927"></a>00927 
<a name="l00928"></a>00928         <span class="comment">/* remplissage de phif_e/pe/c/pc */</span>
<a name="l00929"></a>00929         <span class="keywordflow">for</span> (i = 0; i &lt; (int) p_e.size(); i++)
<a name="l00930"></a>00930           {
<a name="l00931"></a>00931             <span class="keywordflow">for</span> (nnz = 0, hdiag = 0, n = 0; n &lt; N; n++) <span class="keywordflow">for</span> (m = 0; m &lt; M; m++) <span class="keywordflow">for</span> (l = 0; l &lt; nrhs; l++) <span class="keywordflow">if</span> (phi(i, n, m, l) != 0) nnz++, hdiag |= (m != n);
<a name="l00932"></a>00932             <span class="keywordflow">if</span> (!nnz &amp;&amp; !full_stencil) <span class="keywordflow">continue</span>; <span class="comment">//on peut sauter ce point</span>
<a name="l00933"></a>00933             <span class="keywordflow">if</span> (p_e[i].first == 0 &amp;&amp; !hdiag) <span class="comment">//contrib diagonale d&#39;un elem local -&gt; dans phif_e/c</span>
<a name="l00934"></a>00934               <span class="keywordflow">for</span> (phif_e.<a class="code" href="classIntTab.html#ac0af4eac42ca46facc05f985c3ef05c6" title="Adds 1 to dimension_tot(0) and puts a in the added line.">append_line</a>(p_e[i].second), k = phif_c.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0), phif_c.<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(k + 1, N, 2), n = 0; n &lt; N; n++)
<a name="l00935"></a>00935                 <span class="keywordflow">for</span> (l = 0; l &lt; 2; l++) phif_c(k, n, l) = phi(i, n, n, l);
<a name="l00936"></a>00936             <span class="keywordflow">else</span> <span class="keywordflow">for</span> (phif_pe-&gt;<a class="code" href="classIntTab.html#ac0af4eac42ca46facc05f985c3ef05c6" title="Adds 1 to dimension_tot(0) and puts a in the added line.">append_line</a>(p_e[i].first, p_e[i].second), k = phif_pc-&gt;<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0), phif_pc-&gt;<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(k + 1, N, M, 2), n = 0; n &lt; N; n++)
<a name="l00937"></a>00937                 <span class="keywordflow">for</span> (m = 0; m &lt; M; m++) <span class="keywordflow">for</span> (l = 0; l &lt; 2; l++) (*phif_pc)(k, n, m, l) = phi(i, n, m, l);
<a name="l00938"></a>00938           }
<a name="l00939"></a>00939       }
<a name="l00940"></a>00940 }
<a name="l00941"></a>00941 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:10 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
