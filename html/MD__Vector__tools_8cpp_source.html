<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/Kernel/Math/MD_Vector_tools.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/Kernel/Math/MD_Vector_tools.cpp</div>  </div>
</div>
<div class="contents">
<a href="MD__Vector__tools_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (c) 2019, CEA</span>
<a name="l00003"></a>00003 <span class="comment">* All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment">* 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00007"></a>00007 <span class="comment">* 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00008"></a>00008 <span class="comment">* 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<a name="l00011"></a>00011 <span class="comment">* IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;</span>
<a name="l00012"></a>00012 <span class="comment">* OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// File:        MD_Vector_tools.cpp</span>
<a name="l00018"></a>00018 <span class="comment">// Directory:   $TRUST_ROOT/src/Kernel/Math</span>
<a name="l00019"></a>00019 <span class="comment">// Version:     /main/9</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;<a class="code" href="MD__Vector__tools_8h.html">MD_Vector_tools.h</a>&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;<a class="code" href="Schema__Comm__Vecteurs_8h.html">Schema_Comm_Vecteurs.h</a>&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="MD__Vector__composite_8h.html">MD_Vector_composite.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="IntTab_8h.html">IntTab.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="Echange__EV__Options_8h.html">Echange_EV_Options.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="Schema__Comm_8h.html">Schema_Comm.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="stat__counters_8h.html">stat_counters.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="communications_8h.html">communications.h</a>&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00031"></a>00031 
<a name="l00032"></a><a class="code" href="MD__Vector__tools_8cpp.html#aff39c4429f5c1b24eb7ac0848f154ffc">00032</a> <span class="keyword">static</span> <a class="code" href="classSchema__Comm__Vecteurs.html" title="Classe outil utilisee notamment par les methodes MD_Vector::echange_espace_virtuel() Permet d&#39;echange...">Schema_Comm_Vecteurs</a> <a class="code" href="MD__Vector__tools_8cpp.html#aff39c4429f5c1b24eb7ac0848f154ffc">comm</a>;
<a name="l00033"></a><a class="code" href="MD__Vector__tools_8cpp.html#a8ac0fea8a5619f6d4348a59320f4d3d9">00033</a> <span class="keyword">static</span> <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a> <a class="code" href="MD__Vector__tools_8cpp.html#a8ac0fea8a5619f6d4348a59320f4d3d9">last_md</a>;
<a name="l00034"></a><a class="code" href="MD__Vector__tools_8cpp.html#aafeed4db785fd0a6a9643c755350b30d">00034</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="MD__Vector__tools_8cpp.html#aafeed4db785fd0a6a9643c755350b30d">last_isdouble</a> = -1;
<a name="l00035"></a><a class="code" href="MD__Vector__tools_8cpp.html#a6b1d6c4f7aeba0f4c44213267413dfd3">00035</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="MD__Vector__tools_8cpp.html#a6b1d6c4f7aeba0f4c44213267413dfd3">last_linesize</a> = 0;
<a name="l00036"></a><a class="code" href="MD__Vector__tools_8cpp.html#af0ca9c574506c1b2f13c0f44303c5423">00036</a> <span class="keyword">static</span> <a class="code" href="classEchange__EV__Options.html">Echange_EV_Options</a> <a class="code" href="MD__Vector__tools_8cpp.html#af0ca9c574506c1b2f13c0f44303c5423">last_opt</a>;
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="keyword">template</span> &lt;<span class="keyword">class</span> VECT, <span class="keyword">class</span> TAB&gt;
<a name="l00039"></a><a class="code" href="MD__Vector__tools_8cpp.html#aff1ed2791dba1a76fdb300920147cfdf">00039</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="MD__Vector__tools_8cpp.html#aff1ed2791dba1a76fdb300920147cfdf">creer_tableau_distribue</a>(<span class="keyword">const</span> <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a>&amp; md, <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>&amp; v, <a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ff">Array_base::Resize_Options</a> opt)
<a name="l00040"></a>00040 {
<a name="l00041"></a>00041   <span class="keywordflow">if</span> (v.get_md_vector().non_nul())
<a name="l00042"></a>00042     {
<a name="l00043"></a>00043 <span class="comment">// Si ce message apparait et qu&#39;on est sur de ce qu&#39;on fait,</span>
<a name="l00044"></a>00044 <span class="comment">// faire ceci avant d&#39;appeler creer_tableau_distribue:</span>
<a name="l00045"></a>00045 <span class="comment">// vect.set_md_vector(MD_Vector()); // Annule le descripteur et garde le vecteur.</span>
<a name="l00046"></a>00046 <span class="comment">// ou</span>
<a name="l00047"></a>00047 <span class="comment">// vect.reset(); // Detruit completement le contenu du vecteur</span>
<a name="l00048"></a>00048       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Internal error in MD_Vector_tools::creer_tableau_distribue:\n&quot;</span>
<a name="l00049"></a>00049            &lt;&lt; <span class="stringliteral">&quot; Vector already has a parallel vector structure&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00050"></a>00050       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00051"></a>00051     }
<a name="l00052"></a>00052   <span class="keywordtype">int</span> <a class="code" href="Nom_8cpp.html#a0e1ea19fb9fa7881d15d84eff4c090e1">sz</a> = md.<a class="code" href="classMD__Vector.html#a41324dfaa7a973091d0a8276908d10e2">valeur</a>().<a class="code" href="classMD__Vector__base.html#a27d5ace2aee5ecf1d78accb7b321108d">get_nb_items_tot</a>();
<a name="l00053"></a>00053 <span class="comment">// Attention, sz_r peut valoir -1 dans certains cas. Alors le test n==sz_r sera toujours faux,</span>
<a name="l00054"></a>00054 <span class="comment">// mais c&#39;est bien ce qu&#39;on veut...</span>
<a name="l00055"></a>00055   <span class="keywordtype">int</span> sz_r = md.<a class="code" href="classMD__Vector.html#a41324dfaa7a973091d0a8276908d10e2">valeur</a>().<a class="code" href="classMD__Vector__base.html#ade0ef13d456f8aa11d02f51fd7912145">get_nb_items_reels</a>();
<a name="l00056"></a>00056   <span class="keywordtype">int</span> err = 0;
<a name="l00057"></a>00057   <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(TAB, v))
<a name="l00058"></a>00058     {
<a name="l00059"></a>00059       TAB&amp; t = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(TAB, v);
<a name="l00060"></a>00060       <span class="keyword">const</span> <span class="keywordtype">int</span> n = t.dimension_tot(0);
<a name="l00061"></a>00061       <span class="keywordflow">if</span> (n == sz_r || n == 0)
<a name="l00062"></a>00062         {
<a name="l00063"></a>00063           t.resize_dim0(sz, opt);
<a name="l00064"></a>00064         }
<a name="l00065"></a>00065       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n == sz)
<a name="l00066"></a>00066         {
<a name="l00067"></a>00067 <span class="comment">// ok no resize</span>
<a name="l00068"></a>00068         }
<a name="l00069"></a>00069       <span class="keywordflow">else</span>
<a name="l00070"></a>00070         {
<a name="l00071"></a>00071           err = 1;
<a name="l00072"></a>00072         }
<a name="l00073"></a>00073     }
<a name="l00074"></a>00074   <span class="keywordflow">else</span>
<a name="l00075"></a>00075     {
<a name="l00076"></a>00076       <span class="keyword">const</span> <span class="keywordtype">int</span> n = v.size_totale();
<a name="l00077"></a>00077       <span class="keywordflow">if</span> (n == sz_r || n == 0)
<a name="l00078"></a>00078         {
<a name="l00079"></a>00079           v.resize(sz, opt);
<a name="l00080"></a>00080         }
<a name="l00081"></a>00081       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n == sz)
<a name="l00082"></a>00082         {
<a name="l00083"></a>00083 <span class="comment">// ok no resize</span>
<a name="l00084"></a>00084         }
<a name="l00085"></a>00085       <span class="keywordflow">else</span>
<a name="l00086"></a>00086         {
<a name="l00087"></a>00087           err = 1;
<a name="l00088"></a>00088         }
<a name="l00089"></a>00089     }
<a name="l00090"></a>00090   <span class="keywordflow">if</span> (err)
<a name="l00091"></a>00091     {
<a name="l00092"></a>00092       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Internal error in MD_Vector_tools::creer_tableau_distribue:\n&quot;</span>
<a name="l00093"></a>00093            &lt;&lt; <span class="stringliteral">&quot; Input vector has wrong size or dimension(0): expected 0 or size_reele=&quot;</span> &lt;&lt; sz_r &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00094"></a>00094       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00095"></a>00095     }
<a name="l00096"></a>00096   v.set_md_vector(md);
<a name="l00097"></a>00097 }
<a name="l00098"></a>00098 
<a name="l00099"></a>00099 <span class="comment">//</span>
<a name="l00100"></a>00100 <span class="comment">//</span>
<a name="l00101"></a>00101 <span class="comment">//</span>
<a name="l00102"></a>00102 <span class="comment">//</span>
<a name="l00103"></a>00103 <span class="comment">//</span>
<a name="l00104"></a>00104 <span class="comment">//</span>
<a name="l00105"></a>00105 <span class="comment">//</span>
<a name="l00106"></a>00106 <span class="comment">//</span>
<a name="l00107"></a>00107 <span class="comment">//</span><span class="comment"></span>
<a name="l00108"></a>00108 <span class="comment">//! transforme v en un tableau parallele ayant la structure md.&lt;br&gt;md doit est non nul !&lt;br&gt;Les dimension(i&gt;=1) du tableau v (si c&#39;est un IntTab ou DoubleTab) sont conservees,&lt;br&gt;les dimension(0) et dimension_tot(0) sont modifiees en fonction du nombre d&#39;items&lt;br&gt;specifies dans le MD_Vector.&lt;br&gt;La dimension initiale du vecteur doit etre soit 0, soit md.get_nb_items_reels(),&lt;br&gt;soit md.get_nb_items_tot(). Si besoin, la taille du tableau est modifiee et on&lt;br&gt;initialise le tableau selon opt.&lt;br&gt;ATTENTION, echange_espace_virtuel() n&#39;est PAS appele.&lt;br&gt;Les cases virtuelles ne sont pas initialisees...</span>
<a name="l00109"></a><a class="code" href="classMD__Vector__tools.html#aeac48ec589f525bafdfc83244a5d4dea">00109</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classMD__Vector__tools.html#aeac48ec589f525bafdfc83244a5d4dea" title="transforme v en un tableau parallele ayant la structure md. md doit est non nul ! Les dimension(i&gt;=1) ...">MD_Vector_tools::creer_tableau_distribue</a>(<span class="keyword">const</span> <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a>&amp; md, <a class="code" href="classArray__base.html" title=": classe vide servant de base a tous les tableaux. (permet de passer un type generique quel que soit ...">Array_base</a>&amp; v, <a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ff">Array_base::Resize_Options</a> opt)
<a name="l00110"></a>00110 {
<a name="l00111"></a>00111   <span class="keywordflow">if</span> (!md.<a class="code" href="classMD__Vector.html#a4165c00904b7096274e38fdc7ca340f4">non_nul</a>())
<a name="l00112"></a>00112     {
<a name="l00113"></a>00113       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in MD_Vector_tools::creer_tableau_distribue(): MD_Vector is null&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00114"></a>00114       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00115"></a>00115     }
<a name="l00116"></a>00116   <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classIntVect.html">IntVect</a>, v))
<a name="l00117"></a>00117     {
<a name="l00118"></a>00118       ::creer_tableau_distribue&lt;IntVect, IntTab&gt;(md, <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classIntVect.html">IntVect</a>, v), opt);
<a name="l00119"></a>00119     }
<a name="l00120"></a>00120   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classDoubleVect.html">DoubleVect</a>, v))
<a name="l00121"></a>00121     {
<a name="l00122"></a>00122       ::creer_tableau_distribue&lt;DoubleVect, DoubleTab&gt;(md, <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classDoubleVect.html">DoubleVect</a>, v), opt);
<a name="l00123"></a>00123     }
<a name="l00124"></a>00124   <span class="keywordflow">else</span>
<a name="l00125"></a>00125     {
<a name="l00126"></a>00126       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Internal error in MD_Vector_tools::creer_tableau_distribue(const MD_Vector &amp; md, Array_base &amp; v):\n&quot;</span>
<a name="l00127"></a>00127            &lt;&lt; <span class="stringliteral">&quot; Invalid array type &quot;</span> &lt;&lt; v.<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>()
<a name="l00128"></a>00128            &lt;&lt; <span class="stringliteral">&quot;\n Array must be a subtype of IntVect or DoubleVect&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00129"></a>00129       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00130"></a>00130     }
<a name="l00131"></a>00131 }
<a name="l00132"></a>00132 
<a name="l00133"></a>00133 
<a name="l00134"></a>00134 <span class="keyword">template</span> &lt;<span class="keyword">class</span> VType&gt;
<a name="l00135"></a><a class="code" href="MD__Vector__tools_8cpp.html#afa7ff8b936b77fd3d1fe83f671e52168">00135</a> <span class="keywordtype">void</span> <a class="code" href="MD__Vector__tools_8cpp.html#afa7ff8b936b77fd3d1fe83f671e52168">echange_espace_virtuel_</a>(<span class="keyword">const</span> <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a>&amp; md, VType&amp; v, <span class="keywordtype">int</span> is_double, <span class="keyword">const</span> <a class="code" href="classEchange__EV__Options.html">Echange_EV_Options</a>&amp; opt = <a class="code" href="Echange__EV__Options_8cpp.html#ac629fd27cea1cccccd62cda560c9a3bd">echange_ev_opt_default</a>)
<a name="l00136"></a>00136 {
<a name="l00137"></a>00137   <span class="keyword">const</span> <a class="code" href="classMD__Vector__base.html" title="Classe de base des descripteurs de vecteurs distribues. Voir la documentation des methodes dans MD_Ve...">MD_Vector_base</a>&amp; mdv = md.<a class="code" href="classMD__Vector.html#a41324dfaa7a973091d0a8276908d10e2">valeur</a>();
<a name="l00138"></a>00138 
<a name="l00139"></a>00139   <span class="keywordflow">if</span> (md == last_md &amp;&amp; v.line_size() == <a class="code" href="MD__Vector__tools_8cpp.html#a6b1d6c4f7aeba0f4c44213267413dfd3">last_linesize</a> &amp;&amp; <a class="code" href="MD__Vector__tools_8cpp.html#aafeed4db785fd0a6a9643c755350b30d">last_isdouble</a> == is_double &amp;&amp; last_opt == opt)
<a name="l00140"></a>00140     {
<a name="l00141"></a>00141     }
<a name="l00142"></a>00142   <span class="keywordflow">else</span>
<a name="l00143"></a>00143     {
<a name="l00144"></a>00144       last_md = md;
<a name="l00145"></a>00145       <a class="code" href="MD__Vector__tools_8cpp.html#a6b1d6c4f7aeba0f4c44213267413dfd3">last_linesize</a> = v.line_size();
<a name="l00146"></a>00146       last_isdouble = is_double;
<a name="l00147"></a>00147       last_opt = opt;
<a name="l00148"></a>00148       comm.<a class="code" href="classSchema__Comm__Vecteurs.html#a611c6c0d69aae3a85657a4811a745dd6" title="Reinitialise les tailles de buffers. Il faut ensuite definir les tailles de buffers avec add_send/rec...">begin_init</a>();
<a name="l00149"></a>00149       mdv.<a class="code" href="classMD__Vector__base.html#a8f80d6ad65b9b099d57c8decc3363451">initialize_comm</a>(opt, comm, v);
<a name="l00150"></a>00150       comm.<a class="code" href="classSchema__Comm__Vecteurs.html#a60c477436f012ff4caadc23b4f6626d9" title="Une fois les donnees a echanger declarees avec add_send/recv_area_...(), initialise les offset de buf...">end_init</a>();
<a name="l00151"></a>00151     }
<a name="l00152"></a>00152   comm.<a class="code" href="classSchema__Comm__Vecteurs.html#a5174c71752ad18a1ebad363832aa97fe" title="Commence un nouvel echange de donnees (les tailles de buffers doivent avoir ete initialisees avec beg...">begin_comm</a>();
<a name="l00153"></a>00153   mdv.<a class="code" href="classMD__Vector__base.html#a784f3119b51348a00be00cb98043fb04">prepare_send_data</a>(opt, comm, v);
<a name="l00154"></a>00154   comm.<a class="code" href="classSchema__Comm__Vecteurs.html#abf1ef0ef60e6756f9c4c8346262a35b1">exchange</a>();
<a name="l00155"></a>00155   mdv.<a class="code" href="classMD__Vector__base.html#a02e4610c984785b589409fb37d7e1abf">process_recv_data</a>(opt, comm, v);
<a name="l00156"></a>00156   comm.<a class="code" href="classSchema__Comm__Vecteurs.html#a09f608641aa8e3349ac966b1eb3b07e1">end_comm</a>();
<a name="l00157"></a>00157 }
<a name="l00158"></a>00158 
<a name="l00159"></a>00159 <span class="keyword">template</span> &lt;<span class="keyword">class</span> VType&gt;
<a name="l00160"></a><a class="code" href="MD__Vector__tools_8cpp.html#ae640b1087dd146877cc5fb22dd74829e">00160</a> <span class="keywordtype">void</span> <a class="code" href="MD__Vector__tools_8cpp.html#ae640b1087dd146877cc5fb22dd74829e">echange_espace_virtuel1_</a>(<span class="keyword">const</span> <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a>&amp; md, VType&amp; v, <span class="keywordtype">int</span> is_double, <a class="code" href="classMD__Vector__tools.html#ac0611ff35861322f7e1fe9b98a132b7c">MD_Vector_tools::Operations_echange</a> opt)
<a name="l00161"></a>00161 {
<a name="l00162"></a>00162   <span class="keywordflow">switch</span>(opt)
<a name="l00163"></a>00163     {
<a name="l00164"></a>00164     <span class="keywordflow">case</span> <a class="code" href="classMD__Vector__tools.html#ac0611ff35861322f7e1fe9b98a132b7ca8294c959011d5ec0b0f2dd21eec75e90">MD_Vector_tools::ECHANGE_EV</a>:
<a name="l00165"></a>00165       <a class="code" href="MD__Vector__tools_8cpp.html#afa7ff8b936b77fd3d1fe83f671e52168">echange_espace_virtuel_</a>(md, v, is_double, <a class="code" href="Echange__EV__Options_8cpp.html#ac629fd27cea1cccccd62cda560c9a3bd">echange_ev_opt_default</a>);
<a name="l00166"></a>00166       <span class="keywordflow">break</span>;
<a name="l00167"></a>00167     <span class="keywordflow">case</span> <a class="code" href="classMD__Vector__tools.html#ac0611ff35861322f7e1fe9b98a132b7ca088a6c7d322ea30cf55fd00932b633ad">MD_Vector_tools::EV_SOMME</a>:
<a name="l00168"></a>00168       <a class="code" href="MD__Vector__tools_8cpp.html#afa7ff8b936b77fd3d1fe83f671e52168">echange_espace_virtuel_</a>(md, v, is_double, <a class="code" href="classEchange__EV__Options.html">Echange_EV_Options</a>(<a class="code" href="classEchange__EV__Options.html#ab91405f7667327d1f277b627ca1adc09ac77c64f48af249bb37caf3ab34df6150">Echange_EV_Options::SUM</a>));
<a name="l00169"></a>00169       <span class="keywordflow">break</span>;
<a name="l00170"></a>00170     <span class="keywordflow">case</span> <a class="code" href="classMD__Vector__tools.html#ac0611ff35861322f7e1fe9b98a132b7ca5bd847265a61ded8631812d6e1f0a559">MD_Vector_tools::EV_SOMME_ECHANGE</a>:
<a name="l00171"></a>00171       <a class="code" href="MD__Vector__tools_8cpp.html#afa7ff8b936b77fd3d1fe83f671e52168">echange_espace_virtuel_</a>(md, v, is_double, <a class="code" href="classEchange__EV__Options.html">Echange_EV_Options</a>(<a class="code" href="classEchange__EV__Options.html#ab91405f7667327d1f277b627ca1adc09ac77c64f48af249bb37caf3ab34df6150">Echange_EV_Options::SUM</a>));
<a name="l00172"></a>00172       <a class="code" href="MD__Vector__tools_8cpp.html#afa7ff8b936b77fd3d1fe83f671e52168">echange_espace_virtuel_</a>(md, v, is_double, <a class="code" href="Echange__EV__Options_8cpp.html#ac629fd27cea1cccccd62cda560c9a3bd">echange_ev_opt_default</a>);
<a name="l00173"></a>00173       <span class="keywordflow">break</span>;
<a name="l00174"></a>00174     <span class="keywordflow">case</span> <a class="code" href="classMD__Vector__tools.html#ac0611ff35861322f7e1fe9b98a132b7ca112b830928dc0e01ea486a8d6d7fce02">MD_Vector_tools::EV_MAX</a>:
<a name="l00175"></a>00175       <a class="code" href="MD__Vector__tools_8cpp.html#afa7ff8b936b77fd3d1fe83f671e52168">echange_espace_virtuel_</a>(md, v, is_double, <a class="code" href="classEchange__EV__Options.html">Echange_EV_Options</a>(<a class="code" href="classEchange__EV__Options.html#ab91405f7667327d1f277b627ca1adc09a671e2b505a3a0afccaa8fa1d544d977e">Echange_EV_Options::MAX</a>));
<a name="l00176"></a>00176       <span class="keywordflow">break</span>;
<a name="l00177"></a>00177     <span class="keywordflow">case</span> <a class="code" href="classMD__Vector__tools.html#ac0611ff35861322f7e1fe9b98a132b7ca6321c56b72a41201a79013057dac90e8">MD_Vector_tools::EV_MINCOL1</a>:
<a name="l00178"></a>00178       <a class="code" href="MD__Vector__tools_8cpp.html#afa7ff8b936b77fd3d1fe83f671e52168">echange_espace_virtuel_</a>(md, v, is_double, <a class="code" href="classEchange__EV__Options.html">Echange_EV_Options</a>(<a class="code" href="classEchange__EV__Options.html#ab91405f7667327d1f277b627ca1adc09a2f06eeb16446aeefef2331a15aa91b67">Echange_EV_Options::MINCOL1</a>));
<a name="l00179"></a>00179       <span class="keywordflow">break</span>;
<a name="l00180"></a>00180     <span class="keywordflow">default</span>:
<a name="l00181"></a>00181       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;echange_espace_virtuel1_ operation not implemented&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00182"></a>00182       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00183"></a>00183     }
<a name="l00184"></a>00184 }
<a name="l00185"></a>00185 
<a name="l00186"></a><a class="code" href="classMD__Vector__tools.html#a529704705758b2c8c9a688a3090011f6">00186</a> <span class="keywordtype">void</span> <a class="code" href="classMD__Vector__tools.html#a529704705758b2c8c9a688a3090011f6">MD_Vector_tools::echange_espace_virtuel</a>(<a class="code" href="classIntVect.html">IntVect</a>&amp; v, <a class="code" href="classMD__Vector__tools.html#ac0611ff35861322f7e1fe9b98a132b7c">Operations_echange</a> opt)
<a name="l00187"></a>00187 {
<a name="l00188"></a>00188   <span class="keywordflow">if</span> (v.<a class="code" href="classIntVect.html#ae74e1fee6aca124d32718267e33a40c6">get_md_vector</a>().<a class="code" href="classMD__Vector.html#a4165c00904b7096274e38fdc7ca340f4">non_nul</a>())
<a name="l00189"></a>00189     {
<a name="l00190"></a>00190       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#affcd058809786918ed173aaf681d0843">begin_count</a>(<a class="code" href="stat__counters_8cpp.html#ad1adaf02fb22ea330f54d28bd7db19d7">echange_vect_counter_</a>);
<a name="l00191"></a>00191       <a class="code" href="MD__Vector__tools_8cpp.html#ae640b1087dd146877cc5fb22dd74829e">echange_espace_virtuel1_</a>(v.<a class="code" href="classIntVect.html#ae74e1fee6aca124d32718267e33a40c6">get_md_vector</a>(), v, 0, opt);
<a name="l00192"></a>00192       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a0faf52d1b518f5b0b2177f22efcc222d" title="Arret du compteur counter_id. On ajoute quantity a la somme des &#39;quantity&#39; (par defaut 0) stockees po...">end_count</a>(<a class="code" href="stat__counters_8cpp.html#ad1adaf02fb22ea330f54d28bd7db19d7">echange_vect_counter_</a>);
<a name="l00193"></a>00193     }
<a name="l00194"></a>00194 <span class="preprocessor">#ifndef NDEBUG</span>
<a name="l00195"></a>00195 <span class="preprocessor"></span>  <span class="keywordflow">else</span>
<a name="l00196"></a>00196     {
<a name="l00197"></a>00197 <span class="comment">// Cerr &lt;&lt; &quot;Warning: A call to ::echange_espace_virtuel() is done on a non-distributed vector.&quot; &lt;&lt; finl;</span>
<a name="l00198"></a>00198 <span class="comment">// Process::exit();</span>
<a name="l00199"></a>00199     }
<a name="l00200"></a>00200 <span class="preprocessor">#endif</span>
<a name="l00201"></a>00201 <span class="preprocessor"></span>}
<a name="l00202"></a>00202 
<a name="l00203"></a><a class="code" href="classMD__Vector__tools.html#a9331c1098c8f7285d9fa75a77f4c41ba">00203</a> <span class="keywordtype">void</span> <a class="code" href="classMD__Vector__tools.html#a529704705758b2c8c9a688a3090011f6">MD_Vector_tools::echange_espace_virtuel</a>(<a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; v, <a class="code" href="classMD__Vector__tools.html#ac0611ff35861322f7e1fe9b98a132b7c">Operations_echange</a> opt)
<a name="l00204"></a>00204 {
<a name="l00205"></a>00205   <span class="keywordflow">if</span> (v.<a class="code" href="classDoubleVect.html#a0d16d30580c90526e4895388fb44be5d">get_md_vector</a>().<a class="code" href="classMD__Vector.html#a4165c00904b7096274e38fdc7ca340f4">non_nul</a>())
<a name="l00206"></a>00206     {
<a name="l00207"></a>00207       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#affcd058809786918ed173aaf681d0843">begin_count</a>(<a class="code" href="stat__counters_8cpp.html#ad1adaf02fb22ea330f54d28bd7db19d7">echange_vect_counter_</a>);
<a name="l00208"></a>00208       <a class="code" href="MD__Vector__tools_8cpp.html#ae640b1087dd146877cc5fb22dd74829e">echange_espace_virtuel1_</a>(v.<a class="code" href="classDoubleVect.html#a0d16d30580c90526e4895388fb44be5d">get_md_vector</a>(), v, 1 <span class="comment">/* double */</span>, opt);
<a name="l00209"></a>00209       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a0faf52d1b518f5b0b2177f22efcc222d" title="Arret du compteur counter_id. On ajoute quantity a la somme des &#39;quantity&#39; (par defaut 0) stockees po...">end_count</a>(<a class="code" href="stat__counters_8cpp.html#ad1adaf02fb22ea330f54d28bd7db19d7">echange_vect_counter_</a>);
<a name="l00210"></a>00210     }
<a name="l00211"></a>00211 <span class="preprocessor">#ifndef NDEBUG</span>
<a name="l00212"></a>00212 <span class="preprocessor"></span>  <span class="keywordflow">else</span>
<a name="l00213"></a>00213     {
<a name="l00214"></a>00214 <span class="comment">// Cerr &lt;&lt; &quot;Warning: A call to ::echange_espace_virtuel() is done on a non-distributed vector.&quot; &lt;&lt; finl;</span>
<a name="l00215"></a>00215 <span class="comment">// Process::exit();</span>
<a name="l00216"></a>00216     }
<a name="l00217"></a>00217 <span class="preprocessor">#endif</span>
<a name="l00218"></a>00218 <span class="preprocessor"></span>}
<a name="l00219"></a>00219 <span class="comment">// static inline void -&gt; inline void car sinon erreur sur AIX:</span>
<a name="l00220"></a>00220 <span class="comment">// Static declarations are not considered for a function call if the function is not qualified</span>
<a name="l00221"></a><a class="code" href="MD__Vector__tools_8cpp.html#a1f8290a7b26f57a1e6ff3f46450e7e5c">00221</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="MD__Vector__tools_8cpp.html#a1f8290a7b26f57a1e6ff3f46450e7e5c">setflag</a>(<a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; flags, <span class="keywordtype">int</span> i)
<a name="l00222"></a>00222 {
<a name="l00223"></a>00223   flags[i] = 1;
<a name="l00224"></a>00224 }
<a name="l00225"></a><a class="code" href="MD__Vector__tools_8cpp.html#a836e6de47d16282299eda63716fa2fe1">00225</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="MD__Vector__tools_8cpp.html#a836e6de47d16282299eda63716fa2fe1">clearflag</a>(<a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; flags, <span class="keywordtype">int</span> i)
<a name="l00226"></a>00226 {
<a name="l00227"></a>00227   flags[i] = 0;
<a name="l00228"></a>00228 }
<a name="l00229"></a><a class="code" href="MD__Vector__tools_8cpp.html#a8014de75c2ed35ed697b71cfee94eef5">00229</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="MD__Vector__tools_8cpp.html#a1f8290a7b26f57a1e6ff3f46450e7e5c">setflag</a>(<a class="code" href="classArrOfBit.html">ArrOfBit</a>&amp; flags, <span class="keywordtype">int</span> i)
<a name="l00230"></a>00230 {
<a name="l00231"></a>00231 <span class="comment">// On a initialise le tableau a 1 par defaut dans get_sequential_items_flags()</span>
<a name="l00232"></a>00232   assert(flags[i] == 1);
<a name="l00233"></a>00233 }
<a name="l00234"></a><a class="code" href="MD__Vector__tools_8cpp.html#a2d9e44449101e5b6264a48ecbeea067e">00234</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="MD__Vector__tools_8cpp.html#a836e6de47d16282299eda63716fa2fe1">clearflag</a>(<a class="code" href="classArrOfBit.html">ArrOfBit</a>&amp; flags, <span class="keywordtype">int</span> i)
<a name="l00235"></a>00235 {
<a name="l00236"></a>00236   flags.<a class="code" href="classArrOfBit.html#ae92cc39c87cbf48111042b36e3641920" title="Met le bit e a 0.">clearbit</a>(i);
<a name="l00237"></a>00237 }
<a name="l00238"></a>00238 
<a name="l00239"></a>00239 <span class="keyword">template</span> &lt;<span class="keyword">class</span> FlagsType&gt;
<a name="l00240"></a><a class="code" href="MD__Vector__tools_8cpp.html#aadc5886b4f2566e79c152a56c85b8033">00240</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="MD__Vector__tools_8cpp.html#aadc5886b4f2566e79c152a56c85b8033">get_seq_flags</a>(<span class="keyword">const</span> <a class="code" href="classMD__Vector__base.html" title="Classe de base des descripteurs de vecteurs distribues. Voir la documentation des methodes dans MD_Ve...">MD_Vector_base</a>&amp; mdv, FlagsType&amp; flags, <span class="keywordtype">int</span> startidx, <span class="keywordtype">int</span> line_size)
<a name="l00241"></a>00241 {
<a name="l00242"></a>00242   <span class="keywordtype">int</span> count = 0;
<a name="l00243"></a>00243   <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classMD__Vector__base2.html">MD_Vector_base2</a>, mdv))
<a name="l00244"></a>00244     {
<a name="l00245"></a>00245       <span class="keyword">const</span> <a class="code" href="classMD__Vector__base2.html">MD_Vector_base2</a>&amp; ms = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classMD__Vector__base2.html">MD_Vector_base2</a>, mdv);
<a name="l00246"></a>00246       <span class="keyword">const</span> <span class="keywordtype">int</span> nblocs = ms.<a class="code" href="classMD__Vector__base2.html#afb3898aebe081ff8c87759822946ece7">blocs_items_to_sum_</a>.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>() &gt;&gt; 1;
<a name="l00247"></a>00247       <span class="keyword">const</span> <span class="keywordtype">int</span> *ptr = ms.<a class="code" href="classMD__Vector__base2.html#afb3898aebe081ff8c87759822946ece7">blocs_items_to_sum_</a>.<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>();
<a name="l00248"></a>00248       <span class="keywordtype">int</span> j = startidx;
<a name="l00249"></a>00249       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = nblocs; i; i--)
<a name="l00250"></a>00250         {
<a name="l00251"></a>00251 <span class="comment">// On pourrait optimiser pour les ArrOfBit en ajoutant a cette classe</span>
<a name="l00252"></a>00252 <span class="comment">// une methode setflag/clearflag(range_begin, range_end);</span>
<a name="l00253"></a>00253           <span class="keywordtype">int</span> jmax = startidx + (*(ptr++)) * line_size; <span class="comment">//!&lt; debut du prochain bloc d&#39;items sequentiels</span>
<a name="l00254"></a>00254 <span class="comment"></span>          <span class="keywordflow">for</span> (; j &lt; jmax; j++)
<a name="l00255"></a>00255             <a class="code" href="MD__Vector__tools_8cpp.html#a836e6de47d16282299eda63716fa2fe1">clearflag</a>(flags, j);
<a name="l00256"></a>00256           jmax = startidx + (*(ptr++)) * line_size; <span class="comment">//!&lt; fin du bloc d&#39;items sequentiels</span>
<a name="l00257"></a>00257 <span class="comment"></span>          assert(jmax &gt; j);
<a name="l00258"></a>00258           count += jmax - j;
<a name="l00259"></a>00259           <span class="keywordflow">for</span> (; j &lt; jmax; j++)
<a name="l00260"></a>00260             <a class="code" href="MD__Vector__tools_8cpp.html#a1f8290a7b26f57a1e6ff3f46450e7e5c">setflag</a>(flags, j);
<a name="l00261"></a>00261         }
<a name="l00262"></a>00262 <span class="comment">// Fin du remplissage</span>
<a name="l00263"></a>00263       <span class="keywordtype">int</span> <a class="code" href="Nom_8cpp.html#a0e1ea19fb9fa7881d15d84eff4c090e1">sz</a> = mdv.<a class="code" href="classMD__Vector__base.html#a27d5ace2aee5ecf1d78accb7b321108d">get_nb_items_tot</a>() * line_size;
<a name="l00264"></a>00264       <span class="keywordflow">for</span> (; j &lt; <a class="code" href="Nom_8cpp.html#a0e1ea19fb9fa7881d15d84eff4c090e1">sz</a>; j++)
<a name="l00265"></a>00265         <a class="code" href="MD__Vector__tools_8cpp.html#a836e6de47d16282299eda63716fa2fe1">clearflag</a>(flags, j);
<a name="l00266"></a>00266     }
<a name="l00267"></a>00267   <span class="keywordflow">else</span>
<a name="l00268"></a>00268     {
<a name="l00269"></a>00269       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in MD_Vector_tools::get_sequential_items_flags: unsupported MD_Vector type &quot;</span> &lt;&lt; mdv.<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00270"></a>00270       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00271"></a>00271     }
<a name="l00272"></a>00272   <span class="keywordflow">return</span> count;
<a name="l00273"></a>00273 }
<a name="l00274"></a>00274 
<a name="l00275"></a><a class="code" href="classMD__Vector__tools.html#ad099d2407b0016920bd8c667a56fddd8">00275</a> <span class="keywordtype">int</span> <a class="code" href="classMD__Vector__tools.html#ad099d2407b0016920bd8c667a56fddd8">MD_Vector_tools::get_sequential_items_flags</a>(<span class="keyword">const</span> <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a>&amp; md, <a class="code" href="classArrOfBit.html">ArrOfBit</a>&amp; flags, <span class="keywordtype">int</span> line_size)
<a name="l00276"></a>00276 {
<a name="l00277"></a>00277   <span class="keyword">const</span> <a class="code" href="classMD__Vector__base.html" title="Classe de base des descripteurs de vecteurs distribues. Voir la documentation des methodes dans MD_Ve...">MD_Vector_base</a>&amp; mdv = md.<a class="code" href="classMD__Vector.html#a41324dfaa7a973091d0a8276908d10e2">valeur</a>();
<a name="l00278"></a>00278   <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="Nom_8cpp.html#a0e1ea19fb9fa7881d15d84eff4c090e1">sz</a> = mdv.<a class="code" href="classMD__Vector__base.html#a27d5ace2aee5ecf1d78accb7b321108d">get_nb_items_tot</a>() * line_size;
<a name="l00279"></a>00279 <span class="comment">// setbit et clearbit font |= et &amp;=, donc valgrind ne voit pas qu&#39;on initialise tout</span>
<a name="l00280"></a>00280 <span class="comment">// le tableau. On initialise tout explicitement:</span>
<a name="l00281"></a>00281   flags.<a class="code" href="classArrOfBit.html#a8d749d7e96a06c121a8b19a334ae483b" title="Change la taille du tableau et copie les donnees existantes. Si la taille est plus petite...">resize_array</a>(sz);
<a name="l00282"></a>00282   flags = 1; <span class="comment">//!&lt; valeur par defaut la plus courante (0 est le cas particulier), voir setflag(ArrOfBit)</span>
<a name="l00283"></a>00283 <span class="comment"></span>  <span class="keywordflow">return</span> <a class="code" href="MD__Vector__tools_8cpp.html#aadc5886b4f2566e79c152a56c85b8033">get_seq_flags</a>(mdv, flags, 0, line_size);
<a name="l00284"></a>00284 }
<a name="l00285"></a>00285 
<a name="l00286"></a><a class="code" href="classMD__Vector__tools.html#a5e4b6886fe352b47ebc795146bc9e370">00286</a> <span class="keywordtype">int</span> <a class="code" href="classMD__Vector__tools.html#ad099d2407b0016920bd8c667a56fddd8">MD_Vector_tools::get_sequential_items_flags</a>(<span class="keyword">const</span> <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a>&amp; md, <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; flags, <span class="keywordtype">int</span> line_size)
<a name="l00287"></a>00287 {
<a name="l00288"></a>00288   <span class="keyword">const</span> <a class="code" href="classMD__Vector__base.html" title="Classe de base des descripteurs de vecteurs distribues. Voir la documentation des methodes dans MD_Ve...">MD_Vector_base</a>&amp; mdv = md.<a class="code" href="classMD__Vector.html#a41324dfaa7a973091d0a8276908d10e2">valeur</a>();
<a name="l00289"></a>00289   <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="Nom_8cpp.html#a0e1ea19fb9fa7881d15d84eff4c090e1">sz</a> = mdv.<a class="code" href="classMD__Vector__base.html#a27d5ace2aee5ecf1d78accb7b321108d">get_nb_items_tot</a>() * line_size;
<a name="l00290"></a>00290   flags.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(sz, <a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ffaf6ae9ba7eb51c5f298ce693345b3ec68">Array_base::NOCOPY_NOINIT</a>);
<a name="l00291"></a>00291   <span class="keywordflow">return</span> <a class="code" href="MD__Vector__tools_8cpp.html#aadc5886b4f2566e79c152a56c85b8033">get_seq_flags</a>(mdv, flags, 0, line_size);
<a name="l00292"></a>00292 }
<a name="l00293"></a>00293 
<a name="l00294"></a><a class="code" href="classMD__Vector__tools.html#ae8a15984c4fb4980a983f05ce91e7f05">00294</a> <span class="keywordtype">void</span> <a class="code" href="classMD__Vector__tools.html#ae8a15984c4fb4980a983f05ce91e7f05">MD_Vector_tools::compute_sequential_items_index</a>(<span class="keyword">const</span> <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a>&amp;, <a class="code" href="classMD__Vector__renumber.html">MD_Vector_renumber</a>&amp;, <span class="keywordtype">int</span> line_size)
<a name="l00295"></a>00295 {
<a name="l00296"></a>00296   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;MD_Vector_tools::compute_sequential_items_index&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00297"></a>00297   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00298"></a>00298 }
<a name="l00299"></a>00299 
<a name="l00300"></a>00300 <span class="comment">//</span><span class="comment"></span>
<a name="l00301"></a>00301 <span class="comment">//! Renvoie le nombre d&#39;items extraits (pas le nombre de blocs)</span>
<a name="l00302"></a><a class="code" href="MD__Vector__tools_8cpp.html#a2678e25f63eeb164bd03637d9e61b69f">00302</a> <span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="MD__Vector__tools_8cpp.html#a2678e25f63eeb164bd03637d9e61b69f" title="Renvoie le nombre d&#39;items extraits (pas le nombre de blocs)">extract_blocs</a>(<span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> src, <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; renum, <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; dest)
<a name="l00303"></a>00303 {
<a name="l00304"></a>00304   <span class="keyword">const</span> <span class="keywordtype">int</span> nblocs_src = src.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>() / 2;
<a name="l00305"></a>00305   dest.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00306"></a>00306   dest.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(0);
<a name="l00307"></a>00307   <span class="keywordtype">int</span> end_last_bloc = -1;
<a name="l00308"></a>00308   <span class="keywordtype">int</span> count = 0;
<a name="l00309"></a>00309   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nblocs_src; i++)
<a name="l00310"></a>00310     {
<a name="l00311"></a>00311       <span class="keyword">const</span> <span class="keywordtype">int</span> deb = src[i*2];
<a name="l00312"></a>00312       <span class="keyword">const</span> <span class="keywordtype">int</span> fin = src[i*2+1];
<a name="l00313"></a>00313       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = deb; j &lt; fin; j++)
<a name="l00314"></a>00314         {
<a name="l00315"></a>00315           <span class="keyword">const</span> <span class="keywordtype">int</span> rj = renum[j];
<a name="l00316"></a>00316           <span class="keywordflow">if</span> (rj &gt;= 0)
<a name="l00317"></a>00317             {
<a name="l00318"></a>00318               count++;
<a name="l00319"></a>00319 <span class="comment">// Blocs construction assumes that renum is ordered</span>
<a name="l00320"></a>00320               assert(rj &gt;= end_last_bloc);
<a name="l00321"></a>00321               <span class="keywordflow">if</span> (rj == end_last_bloc)
<a name="l00322"></a>00322                 {
<a name="l00323"></a>00323 <span class="comment">// item is contiguous to last bloc in destination array, increase bloc size:</span>
<a name="l00324"></a>00324                   end_last_bloc++;
<a name="l00325"></a>00325                   dest[dest.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>()-1] = end_last_bloc;
<a name="l00326"></a>00326                 }
<a name="l00327"></a>00327               <span class="keywordflow">else</span>
<a name="l00328"></a>00328                 {
<a name="l00329"></a>00329 <span class="comment">// non contiguous item, create new bloc</span>
<a name="l00330"></a>00330                   end_last_bloc = rj;
<a name="l00331"></a>00331                   dest.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(end_last_bloc);
<a name="l00332"></a>00332                   end_last_bloc++;
<a name="l00333"></a>00333                   dest.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(end_last_bloc);
<a name="l00334"></a>00334                 }
<a name="l00335"></a>00335             }
<a name="l00336"></a>00336         }
<a name="l00337"></a>00337     }
<a name="l00338"></a>00338   <span class="keywordflow">return</span> count;
<a name="l00339"></a>00339 }
<a name="l00340"></a>00340 
<a name="l00341"></a><a class="code" href="MD__Vector__tools_8cpp.html#af3f8a5e3b935d4060680f5a66791d0e2">00341</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="MD__Vector__tools_8cpp.html#af3f8a5e3b935d4060680f5a66791d0e2">creer_md_vect_renum</a>(<span class="keyword">const</span> <a class="code" href="classIntVect.html">IntVect</a>&amp; renum, <span class="keyword">const</span> <a class="code" href="classMD__Vector__std.html" title="C&#39;est le plus simple des descripteurs, utilise pour les tableaux de valeurs aux sommets, elements, faces, aretes, faces de bord, etc... Il supporte la notion d&#39;items &quot;communs&quot; (sommets du maillage partages entre plusieurs processeurs) et d&#39;items &quot;distants&quot; et &quot;virtuels&quot; (sommets, elements dans l&#39;epaisseur de joint). Voir aussi MD_Vector_composite (descripteur compose d&#39;une reunion de plusieurs descripteurs, pour le P1Bulle par exemple)">MD_Vector_std</a>&amp; src, <a class="code" href="classMD__Vector__std.html" title="C&#39;est le plus simple des descripteurs, utilise pour les tableaux de valeurs aux sommets, elements, faces, aretes, faces de bord, etc... Il supporte la notion d&#39;items &quot;communs&quot; (sommets du maillage partages entre plusieurs processeurs) et d&#39;items &quot;distants&quot; et &quot;virtuels&quot; (sommets, elements dans l&#39;epaisseur de joint). Voir aussi MD_Vector_composite (descripteur compose d&#39;une reunion de plusieurs descripteurs, pour le P1Bulle par exemple)">MD_Vector_std</a>&amp; dest)
<a name="l00342"></a>00342 {
<a name="l00343"></a>00343 <span class="comment">// Calcul de nb_items_tot_ et nb_items_reels_</span>
<a name="l00344"></a>00344 <span class="comment">// nb_items_tot_ est le nombre d&#39;items pour lesquels renum[i] &gt;= 0</span>
<a name="l00345"></a>00345 <span class="comment">// Les items reels sont ceux qui etaient reels dans le tableau d&#39;origine et qui sont a conserver</span>
<a name="l00346"></a>00346   {
<a name="l00347"></a>00347     <span class="keyword">const</span> <span class="keywordtype">int</span> src_size = src.<a class="code" href="classMD__Vector__base2.html#a3ecb02201c41fa4fd95be3fd65315cce">get_nb_items_tot</a>();
<a name="l00348"></a>00348     <span class="keyword">const</span> <span class="keywordtype">int</span> src_size_r = src.<a class="code" href="classMD__Vector__base2.html#a6735838767f62a3def156bf93d8a5224">get_nb_items_reels</a>();
<a name="l00349"></a>00349     dest.<a class="code" href="classMD__Vector__base2.html#ae222cd70f0be4da64d0aa7fcd89df0f4">nb_items_tot_</a> = 0;
<a name="l00350"></a>00350     dest.<a class="code" href="classMD__Vector__base2.html#a87c423fabd116249cb1dab31887193c9">nb_items_reels_</a> = 0;
<a name="l00351"></a>00351     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; src_size; i++)
<a name="l00352"></a>00352       {
<a name="l00353"></a>00353         <span class="keywordflow">if</span> (renum[i] &gt;= 0)
<a name="l00354"></a>00354           {
<a name="l00355"></a>00355             dest.<a class="code" href="classMD__Vector__base2.html#ae222cd70f0be4da64d0aa7fcd89df0f4">nb_items_tot_</a>++;
<a name="l00356"></a>00356             <span class="keywordflow">if</span> (i &lt; src_size_r)
<a name="l00357"></a>00357               dest.<a class="code" href="classMD__Vector__base2.html#a87c423fabd116249cb1dab31887193c9">nb_items_reels_</a>++;
<a name="l00358"></a>00358           }
<a name="l00359"></a>00359       }
<a name="l00360"></a>00360 <span class="comment">// Si l&#39;attribut nb_items_reels_ est invalide dans le vecteur source, il est invalide dans le</span>
<a name="l00361"></a>00361 <span class="comment">// vecteur resultat:</span>
<a name="l00362"></a>00362     <span class="keywordflow">if</span> (src_size_r &lt; 0)
<a name="l00363"></a>00363       dest.<a class="code" href="classMD__Vector__base2.html#a87c423fabd116249cb1dab31887193c9">nb_items_reels_</a> = -1;
<a name="l00364"></a>00364   }
<a name="l00365"></a>00365 <span class="comment">// Remplissage de blocs_items_to_sum_ et blocs_items_to_compute_</span>
<a name="l00366"></a>00366 <span class="comment">// Ce sont les items pour lesquels renum[i] &gt;= 0 et qui sont dans les blocs_items_to_sum_</span>
<a name="l00367"></a>00367 <span class="comment">// et blocs_items_to_compute_ du descripteur source.</span>
<a name="l00368"></a>00368   <a class="code" href="MD__Vector__tools_8cpp.html#a2678e25f63eeb164bd03637d9e61b69f" title="Renvoie le nombre d&#39;items extraits (pas le nombre de blocs)">extract_blocs</a>(src.<a class="code" href="classMD__Vector__base2.html#afb3898aebe081ff8c87759822946ece7">blocs_items_to_sum_</a>, renum, dest.<a class="code" href="classMD__Vector__base2.html#afb3898aebe081ff8c87759822946ece7">blocs_items_to_sum_</a>);
<a name="l00369"></a>00369   dest.<a class="code" href="classMD__Vector__base2.html#a2bb5e578b35a03544342e963d2adec35">nb_items_seq_local_</a> = <a class="code" href="MD__Vector__tools_8cpp.html#a2678e25f63eeb164bd03637d9e61b69f" title="Renvoie le nombre d&#39;items extraits (pas le nombre de blocs)">extract_blocs</a>(src.<a class="code" href="classMD__Vector__base2.html#ac19dad1f73b786033a9911cbfe3ae440">blocs_items_to_compute_</a>, renum, dest.<a class="code" href="classMD__Vector__base2.html#ac19dad1f73b786033a9911cbfe3ae440">blocs_items_to_compute_</a>);
<a name="l00370"></a>00370   dest.<a class="code" href="classMD__Vector__base2.html#a7cf9dbd94db6c0ba49e87681d207aef0">nb_items_seq_tot_</a> = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(dest.<a class="code" href="classMD__Vector__base2.html#a2bb5e578b35a03544342e963d2adec35">nb_items_seq_local_</a>);
<a name="l00371"></a>00371 
<a name="l00372"></a>00372 <span class="comment">// ********************************************************</span>
<a name="l00373"></a>00373 <span class="comment">// Calcul des items a recevoir: ce sont les items pour lesquels renum[i] &gt;= 0 et qui etaient a</span>
<a name="l00374"></a>00374 <span class="comment">// recevoir dans le descripteur source.</span>
<a name="l00375"></a>00375 <span class="comment">// Chaque fois qu&#39;on trouve un item a recevoir, il faut informer le processeur voisin qui possede l&#39;item</span>
<a name="l00376"></a>00376 <span class="comment">// que c&#39;est item doit etre envoye (utilisation du schema_comm). Pour identifier ces items, on utilise</span>
<a name="l00377"></a>00377 <span class="comment">// sont rang dans le tableau des items a envoyer dans le descripteur source (variable item_rank)</span>
<a name="l00378"></a>00378 <span class="comment">// </span>
<a name="l00379"></a>00379   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_pe_voisins = src.<a class="code" href="classMD__Vector__std.html#a68854e710075fdc8c2f2ce28fbbb9ecc">pe_voisins_</a>.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00380"></a>00380   <a class="code" href="classSchema__Comm.html">Schema_Comm</a> schema_comm;
<a name="l00381"></a>00381   schema_comm.<a class="code" href="classSchema__Comm.html#ad11c9b47999c294c26ae4df8d2bbd57b" title="Definit la liste des processeurs a qui on va envoyer et de qui on va recevoir des donnees...">set_send_recv_pe_list</a>(src.<a class="code" href="classMD__Vector__std.html#a68854e710075fdc8c2f2ce28fbbb9ecc">pe_voisins_</a>, src.<a class="code" href="classMD__Vector__std.html#a68854e710075fdc8c2f2ce28fbbb9ecc">pe_voisins_</a>);
<a name="l00382"></a>00382   schema_comm.<a class="code" href="classSchema__Comm.html#ac617b53de22748cdd9fa30a0cfd0f4a8" title="Statut passe a WRITING Autorise si status_ == WRITING:">begin_comm</a>();
<a name="l00383"></a>00383 <span class="comment">// Calcul des listes items_to_recv</span>
<a name="l00384"></a>00384 <span class="comment">// index+data forment les deux tableau d&#39;un StaticIntLists.</span>
<a name="l00385"></a>00385 <span class="comment">// On construit pour commencer autant de listes que de processeurs voisins dans le descripteur source.</span>
<a name="l00386"></a>00386 <span class="comment">// On retirera a la fin les processeurs qui n&#39;echangent pas de donnees</span>
<a name="l00387"></a>00387   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> dest_items_recv_index;
<a name="l00388"></a>00388   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> dest_items_recv_data;
<a name="l00389"></a>00389   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> dest_blocs_recv_index;
<a name="l00390"></a>00390   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> dest_blocs_recv_data;
<a name="l00391"></a>00391 
<a name="l00392"></a>00392   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> tmp;
<a name="l00393"></a>00393   tmp.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00394"></a>00394   {
<a name="l00395"></a>00395     dest_items_recv_index.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(nb_pe_voisins + 1, <a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ffaf6ae9ba7eb51c5f298ce693345b3ec68">Array_base::NOCOPY_NOINIT</a>);
<a name="l00396"></a>00396     dest_items_recv_index[0] = 0;
<a name="l00397"></a>00397     dest_blocs_recv_index.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(nb_pe_voisins + 1, <a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ffaf6ae9ba7eb51c5f298ce693345b3ec68">Array_base::NOCOPY_NOINIT</a>);
<a name="l00398"></a>00398     dest_blocs_recv_index[0] = 0;
<a name="l00399"></a>00399     dest.<a class="code" href="classMD__Vector__std.html#a4aa5e80e0b975026cc201fbdee72956c">blocs_items_count_</a>.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(nb_pe_voisins, <a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ffaf6ae9ba7eb51c5f298ce693345b3ec68">Array_base::NOCOPY_NOINIT</a>);
<a name="l00400"></a>00400     dest.<a class="code" href="classMD__Vector__std.html#afd0c291718e3bc9846c8a06420efeb69">nb_items_to_items_</a>.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(nb_pe_voisins, <a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ffaf6ae9ba7eb51c5f298ce693345b3ec68">Array_base::NOCOPY_NOINIT</a>);
<a name="l00401"></a>00401 <span class="comment">// Preallocation de la taille maxi</span>
<a name="l00402"></a>00402     dest_items_recv_data.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(src.<a class="code" href="classMD__Vector__std.html#a8d6c4c5d6da6fe56e8330253137d412f">items_to_recv_</a>.<a class="code" href="classStatic__Int__Lists.html#ac72c923acdf74ba0d8fed055c494fc5b">get_data</a>().<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>(), <a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ffaf6ae9ba7eb51c5f298ce693345b3ec68">Array_base::NOCOPY_NOINIT</a>);
<a name="l00403"></a>00403     dest_items_recv_data.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00404"></a>00404     dest_items_recv_data.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(0);
<a name="l00405"></a>00405 <span class="comment">// On ne peut pas prevoir le nombre de blocs, il peut y en avoir plus que dans la source</span>
<a name="l00406"></a>00406     dest_blocs_recv_data.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00407"></a>00407     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_pe = 0; i_pe &lt; nb_pe_voisins; i_pe++)
<a name="l00408"></a>00408       {
<a name="l00409"></a>00409         tmp.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(0);
<a name="l00410"></a>00410         <span class="keywordtype">int</span> item_rank = 0; <span class="comment">//!&lt; Compteur d&#39;items recus dans le descripteur source 1) Extraction des items individuels    (remplissage de dest_items_recv_index, dest_items_recv_data et tmp)</span>
<a name="l00411"></a>00411 <span class="comment"></span><span class="comment">//</span>
<a name="l00412"></a>00412 <span class="comment">//</span>
<a name="l00413"></a>00413         <span class="keyword">const</span> <span class="keywordtype">int</span> n = src.<a class="code" href="classMD__Vector__std.html#a8d6c4c5d6da6fe56e8330253137d412f">items_to_recv_</a>.<a class="code" href="classStatic__Int__Lists.html#adbf6903737c3c30bf87e05b29f5a5b56" title="renvoie le nombre d&#39;elements de la liste i">get_list_size</a>(i_pe);
<a name="l00414"></a>00414         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
<a name="l00415"></a>00415           {
<a name="l00416"></a>00416             <span class="keyword">const</span> <span class="keywordtype">int</span> j = src.<a class="code" href="classMD__Vector__std.html#a8d6c4c5d6da6fe56e8330253137d412f">items_to_recv_</a>(i_pe, i);
<a name="l00417"></a>00417             <span class="keyword">const</span> <span class="keywordtype">int</span> rj = renum[j];
<a name="l00418"></a>00418             <span class="keywordflow">if</span> (rj &gt;= 0)
<a name="l00419"></a>00419               {
<a name="l00420"></a>00420 <span class="comment">// Ajout de cet item</span>
<a name="l00421"></a>00421                 dest_items_recv_data.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(rj);
<a name="l00422"></a>00422 <span class="comment">// Demander au processeur voisin d&#39;envoyer cet item</span>
<a name="l00423"></a>00423                 tmp.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(item_rank);
<a name="l00424"></a>00424               }
<a name="l00425"></a>00425             item_rank++;
<a name="l00426"></a>00426           }
<a name="l00427"></a>00427 <span class="comment">// Initialisation de la taille de la liste d&#39;items pour ce processeur:</span>
<a name="l00428"></a>00428         dest_items_recv_index[i_pe+1] = dest_items_recv_data.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00429"></a>00429 
<a name="l00430"></a>00430 <span class="comment">// 2) Extraction des blocs d&#39;items recus de ce processeur</span>
<a name="l00431"></a>00431 <span class="comment">// (remplissage de dest_blocs_recv_index dest_blocs_recv_data dest.blocs_items_count_ et tmp)</span>
<a name="l00432"></a>00432         <span class="keyword">const</span> <span class="keywordtype">int</span> nblocs = src.<a class="code" href="classMD__Vector__std.html#ae266bd552dcb9f817c791a1c7342a6b0">blocs_to_recv_</a>.<a class="code" href="classStatic__Int__Lists.html#adbf6903737c3c30bf87e05b29f5a5b56" title="renvoie le nombre d&#39;elements de la liste i">get_list_size</a>(i_pe) / 2;
<a name="l00433"></a>00433         <span class="keywordtype">int</span> received_count = 0; <span class="comment">//!&lt; nombre d&#39;items recus de ce processeur</span>
<a name="l00434"></a>00434 <span class="comment"></span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ibloc = 0; ibloc &lt; nblocs; ibloc++)
<a name="l00435"></a>00435           {
<a name="l00436"></a>00436             <span class="keyword">const</span> <span class="keywordtype">int</span> jdeb = src.<a class="code" href="classMD__Vector__std.html#ae266bd552dcb9f817c791a1c7342a6b0">blocs_to_recv_</a>(i_pe, ibloc * 2);
<a name="l00437"></a>00437             <span class="keyword">const</span> <span class="keywordtype">int</span> jfin = src.<a class="code" href="classMD__Vector__std.html#ae266bd552dcb9f817c791a1c7342a6b0">blocs_to_recv_</a>(i_pe, ibloc * 2 + 1);
<a name="l00438"></a>00438             <span class="keywordtype">int</span> last_added = -2; <span class="comment">//!&lt; ne peut jamais etre egal a rj-1 Pour chaque item du bloc, s&#39;il doit etre conserve, le reporter dans les blocs a recevoir:</span>
<a name="l00439"></a>00439 <span class="comment"></span><span class="comment">//</span>
<a name="l00440"></a>00440             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = jdeb; j &lt; jfin; j++)
<a name="l00441"></a>00441               {
<a name="l00442"></a>00442                 <span class="keyword">const</span> <span class="keywordtype">int</span> rj = renum[j];
<a name="l00443"></a>00443                 <span class="keywordflow">if</span> (rj &gt;= 0)
<a name="l00444"></a>00444                   {
<a name="l00445"></a>00445                     <span class="keywordflow">if</span> (rj &lt;= last_added)
<a name="l00446"></a>00446                       {
<a name="l00447"></a>00447 <span class="comment">// Les items dans les blocs a recevoir doivent etre tries dans l&#39;ordre croissant</span>
<a name="l00448"></a>00448 <span class="comment">// (sinon cet algorithme ne marche pas, il faut en utiliser un autre pour</span>
<a name="l00449"></a>00449 <span class="comment">// construire les blocs, et en plus le comptage des items reels ne veut peut-etre plus rien dire)</span>
<a name="l00450"></a>00450                         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in creer_md_vect_renum: renum array is not sorted: cannot extract blocs to recv&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00451"></a>00451                         <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00452"></a>00452                       }
<a name="l00453"></a>00453 <span class="comment">// Cet item est-il contigu avec le precedent ?</span>
<a name="l00454"></a>00454                     <span class="keywordflow">if</span> (last_added == rj-1)
<a name="l00455"></a>00455                       {
<a name="l00456"></a>00456 <span class="comment">// Oui, augmenter la taille du dernier bloc</span>
<a name="l00457"></a>00457                         <span class="keyword">const</span> <span class="keywordtype">int</span> k = dest_blocs_recv_data.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00458"></a>00458 <span class="comment">// fin de bloc = indice du dernier plus 1</span>
<a name="l00459"></a>00459                         dest_blocs_recv_data[k-1] = rj+1;
<a name="l00460"></a>00460                       }
<a name="l00461"></a>00461                     <span class="keywordflow">else</span>
<a name="l00462"></a>00462                       {
<a name="l00463"></a>00463 <span class="comment">// Non, creer un nouveau bloc</span>
<a name="l00464"></a>00464                         dest_blocs_recv_data.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(rj);
<a name="l00465"></a>00465                         dest_blocs_recv_data.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(rj+1);
<a name="l00466"></a>00466                       }
<a name="l00467"></a>00467                     last_added = rj;
<a name="l00468"></a>00468 <span class="comment">// Demander au processeur voisin d&#39;envoyer cet item</span>
<a name="l00469"></a>00469                     tmp.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(item_rank);
<a name="l00470"></a>00470                     received_count++;
<a name="l00471"></a>00471                   }
<a name="l00472"></a>00472                 item_rank++;
<a name="l00473"></a>00473               }
<a name="l00474"></a>00474           }
<a name="l00475"></a>00475 <span class="comment">// Initialisation de la taille de la liste de blocs pour ce processeur:</span>
<a name="l00476"></a>00476         dest_blocs_recv_index[i_pe+1] = dest_blocs_recv_data.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00477"></a>00477 <span class="comment">// Nombre d&#39;items recus de ce processeur</span>
<a name="l00478"></a>00478         dest.<a class="code" href="classMD__Vector__std.html#a4aa5e80e0b975026cc201fbdee72956c">blocs_items_count_</a>[i_pe] = received_count;
<a name="l00479"></a>00479 <span class="comment">// Envoi du tableau tmp au processeur voisin:</span>
<a name="l00480"></a>00480         schema_comm.<a class="code" href="classSchema__Comm.html#a6c771eae3b46250ae0d2f0126a7d8065" title="renvoie le buffer correspondant au processeur num_PE pour y entasser des donnees a envoyer...">send_buffer</a>(src.<a class="code" href="classMD__Vector__std.html#a68854e710075fdc8c2f2ce28fbbb9ecc">pe_voisins_</a>[i_pe]) &lt;&lt; tmp;
<a name="l00481"></a>00481       }
<a name="l00482"></a>00482   }
<a name="l00483"></a>00483 
<a name="l00484"></a>00484   schema_comm.<a class="code" href="classSchema__Comm.html#abca0e8ac6c2b742d26f3cfaee0690c72" title="Statut passe a EXCHANGED.">echange_taille_et_messages</a>();
<a name="l00485"></a>00485 
<a name="l00486"></a>00486 <span class="comment">// ********************************************************</span>
<a name="l00487"></a>00487 <span class="comment">// Construction de dest.items_to_send avec les infos recues</span>
<a name="l00488"></a>00488 <span class="comment">// </span>
<a name="l00489"></a>00489   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> dest_items_send_index;
<a name="l00490"></a>00490   dest_items_send_index.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(nb_pe_voisins + 1, <a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ffaf6ae9ba7eb51c5f298ce693345b3ec68">Array_base::NOCOPY_NOINIT</a>);
<a name="l00491"></a>00491   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> dest_items_send_data;
<a name="l00492"></a>00492   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> nb_items_to_items(nb_pe_voisins); <span class="comment">//!&lt; Initialise a zero</span>
<a name="l00493"></a>00493 <span class="comment"></span>
<a name="l00494"></a>00494 <span class="comment">// Allocation d&#39;une taille par borne superieure:</span>
<a name="l00495"></a>00495   dest_items_send_data.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(src.<a class="code" href="classMD__Vector__std.html#a3ee9294b8d36492e8bdabbc9a97db451">items_to_send_</a>.<a class="code" href="classStatic__Int__Lists.html#ac72c923acdf74ba0d8fed055c494fc5b">get_data</a>().<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>(), <a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ffaf6ae9ba7eb51c5f298ce693345b3ec68">Array_base::NOCOPY_NOINIT</a>);
<a name="l00496"></a>00496   dest_items_send_index[0] = 0;
<a name="l00497"></a>00497   {
<a name="l00498"></a>00498     <span class="keywordtype">int</span> count = 0;
<a name="l00499"></a>00499     <span class="keywordtype">int</span> error = 0;
<a name="l00500"></a>00500     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_pe = 0; i_pe &lt; nb_pe_voisins; i_pe++)
<a name="l00501"></a>00501       {
<a name="l00502"></a>00502 <span class="comment">// nb_item_received_single est le nombre d&#39;items dans items_to_send_ qui seront receptionnes</span>
<a name="l00503"></a>00503 <span class="comment">// par items_to_recv_. Les suivants sont recus dans blocs_to_recv_.</span>
<a name="l00504"></a>00504         <span class="keyword">const</span> <span class="keywordtype">int</span> j_limite_bloc = src.<a class="code" href="classMD__Vector__std.html#afd0c291718e3bc9846c8a06420efeb69">nb_items_to_items_</a>[i_pe];
<a name="l00505"></a>00505         <span class="keywordtype">int</span> new_j_limite_bloc = 0;
<a name="l00506"></a>00506         schema_comm.<a class="code" href="classSchema__Comm.html#a0c056eb81ab8fd513912b336b4d13a1a" title="renvoie le buffer correspondant au processeur num_PE pour y lire les donnees recues. Le schema doit etre dans l&#39;etat EXCHANGED.">recv_buffer</a>(src.<a class="code" href="classMD__Vector__std.html#a68854e710075fdc8c2f2ce28fbbb9ecc">pe_voisins_</a>[i_pe]) &gt;&gt; tmp;
<a name="l00507"></a>00507         <span class="keyword">const</span> <span class="keywordtype">int</span> n = tmp.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00508"></a>00508         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
<a name="l00509"></a>00509           {
<a name="l00510"></a>00510 <span class="comment">// tmp contient des indices qui pointent dans src.items_to_send_</span>
<a name="l00511"></a>00511             <span class="keywordtype">int</span> j = tmp[i];
<a name="l00512"></a>00512             <span class="keywordflow">if</span> (j &gt;= j_limite_bloc)
<a name="l00513"></a>00513               new_j_limite_bloc++; <span class="comment">//!&lt; Cet item est dans les blocs_to_recv_ de l&#39;autre cote k est l&#39;indice dans l&#39;ancien tableau de l&#39;item a envoyer</span>
<a name="l00514"></a>00514 <span class="comment"></span><span class="comment">//</span>
<a name="l00515"></a>00515             <span class="keywordtype">int</span> k = src.<a class="code" href="classMD__Vector__std.html#a3ee9294b8d36492e8bdabbc9a97db451">items_to_send_</a>(i_pe, j);
<a name="l00516"></a>00516             <span class="keywordtype">int</span> renum_k = renum[k];
<a name="l00517"></a>00517 <span class="comment">// Une erreur possible ici: un processeur a besoin d&#39;un item virtuel et l&#39;item</span>
<a name="l00518"></a>00518 <span class="comment">// reel a ete supprime sur le processeur source. Il faut alors utiliser un</span>
<a name="l00519"></a>00519 <span class="comment">// autre algo pour changer le proprietaire de l&#39;item...</span>
<a name="l00520"></a>00520             <span class="keywordflow">if</span> (renum_k &lt; 0)
<a name="l00521"></a>00521               error = 1;
<a name="l00522"></a>00522             dest_items_send_data[count++] = renum_k;
<a name="l00523"></a>00523           }
<a name="l00524"></a>00524         dest_items_send_index[i_pe+1] = count;
<a name="l00525"></a>00525         nb_items_to_items[i_pe] = new_j_limite_bloc;
<a name="l00526"></a>00526       }
<a name="l00527"></a>00527     <span class="keywordflow">if</span> (error)
<a name="l00528"></a>00528       {
<a name="l00529"></a>00529         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Internal error in MD_Vector_tools::creer_md_vect_renum:\n&quot;</span>
<a name="l00530"></a>00530              &lt;&lt; <span class="stringliteral">&quot; processor &quot;</span> &lt;&lt; <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>()
<a name="l00531"></a>00531              &lt;&lt; <span class="stringliteral">&quot; received a request for distant items that are not in the new vector&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00532"></a>00532         <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00533"></a>00533       }
<a name="l00534"></a>00534 <span class="comment">// On ajuste a la taille definitive</span>
<a name="l00535"></a>00535     dest_items_send_data.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00536"></a>00536     dest_items_send_data.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(count);
<a name="l00537"></a>00537   }
<a name="l00538"></a>00538   schema_comm.<a class="code" href="classSchema__Comm.html#a73a981f88b6ffebc150fb46c5cce75d9" title="Statut passe a RESET Accesseurs:">end_comm</a>();
<a name="l00539"></a>00539 
<a name="l00540"></a>00540 <span class="comment">// Construction de la liste de processeurs voisins de dest</span>
<a name="l00541"></a>00541 <span class="comment">// (processeurs avec qui on echange des donnees)</span>
<a name="l00542"></a>00542 <span class="comment">// Et compression des indexes des StaticIntLists pour retirer les</span>
<a name="l00543"></a>00543 <span class="comment">// processeurs supprimes.</span>
<a name="l00544"></a>00544   {
<a name="l00545"></a>00545     <span class="keywordtype">int</span> pe_count = 0;
<a name="l00546"></a>00546     dest.<a class="code" href="classMD__Vector__std.html#a68854e710075fdc8c2f2ce28fbbb9ecc">pe_voisins_</a>.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(nb_pe_voisins, <a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ffaf6ae9ba7eb51c5f298ce693345b3ec68">Array_base::NOCOPY_NOINIT</a>);
<a name="l00547"></a>00547     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_pe = 0; i_pe &lt; nb_pe_voisins; i_pe++)
<a name="l00548"></a>00548       {
<a name="l00549"></a>00549         <span class="keywordtype">int</span> flag = 0;
<a name="l00550"></a>00550         <span class="keywordflow">if</span> (dest_items_recv_index[i_pe+1] - dest_items_recv_index[i_pe] &gt; 0)
<a name="l00551"></a>00551           flag = 1;
<a name="l00552"></a>00552         <span class="keywordflow">if</span> (dest_blocs_recv_index[i_pe+1] - dest_blocs_recv_index[i_pe] &gt; 0)
<a name="l00553"></a>00553           flag = 1;
<a name="l00554"></a>00554         <span class="keywordflow">if</span> (dest_items_send_index[i_pe+1] - dest_items_send_index[i_pe] &gt; 0)
<a name="l00555"></a>00555           flag = 1;
<a name="l00556"></a>00556 
<a name="l00557"></a>00557         <span class="keywordflow">if</span> (flag)
<a name="l00558"></a>00558           {
<a name="l00559"></a>00559             dest_items_recv_index[pe_count+1] = dest_items_recv_index[i_pe+1];
<a name="l00560"></a>00560             dest_blocs_recv_index[pe_count+1] = dest_blocs_recv_index[i_pe+1];
<a name="l00561"></a>00561             dest_items_send_index[pe_count+1] = dest_items_send_index[i_pe+1];
<a name="l00562"></a>00562             dest.<a class="code" href="classMD__Vector__std.html#a4aa5e80e0b975026cc201fbdee72956c">blocs_items_count_</a>[pe_count] = dest.<a class="code" href="classMD__Vector__std.html#a4aa5e80e0b975026cc201fbdee72956c">blocs_items_count_</a>[i_pe];
<a name="l00563"></a>00563             dest.<a class="code" href="classMD__Vector__std.html#a68854e710075fdc8c2f2ce28fbbb9ecc">pe_voisins_</a>[pe_count] = src.<a class="code" href="classMD__Vector__std.html#a68854e710075fdc8c2f2ce28fbbb9ecc">pe_voisins_</a>[i_pe];
<a name="l00564"></a>00564             dest.<a class="code" href="classMD__Vector__std.html#afd0c291718e3bc9846c8a06420efeb69">nb_items_to_items_</a>[pe_count] = nb_items_to_items[i_pe];
<a name="l00565"></a>00565             pe_count++;
<a name="l00566"></a>00566           }
<a name="l00567"></a>00567       }
<a name="l00568"></a>00568     dest_items_recv_index.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00569"></a>00569     dest_items_recv_index.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(pe_count+1);
<a name="l00570"></a>00570     dest_blocs_recv_index.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00571"></a>00571     dest_blocs_recv_index.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(pe_count+1);
<a name="l00572"></a>00572     dest_items_send_index.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00573"></a>00573     dest_items_send_index.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(pe_count+1);
<a name="l00574"></a>00574     dest.<a class="code" href="classMD__Vector__std.html#a68854e710075fdc8c2f2ce28fbbb9ecc">pe_voisins_</a>.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00575"></a>00575     dest.<a class="code" href="classMD__Vector__std.html#a68854e710075fdc8c2f2ce28fbbb9ecc">pe_voisins_</a>.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(pe_count);
<a name="l00576"></a>00576     dest.<a class="code" href="classMD__Vector__std.html#a4aa5e80e0b975026cc201fbdee72956c">blocs_items_count_</a>.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00577"></a>00577     dest.<a class="code" href="classMD__Vector__std.html#a4aa5e80e0b975026cc201fbdee72956c">blocs_items_count_</a>.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(pe_count);
<a name="l00578"></a>00578     dest.<a class="code" href="classMD__Vector__std.html#afd0c291718e3bc9846c8a06420efeb69">nb_items_to_items_</a>.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00579"></a>00579     dest.<a class="code" href="classMD__Vector__std.html#afd0c291718e3bc9846c8a06420efeb69">nb_items_to_items_</a>.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(pe_count);
<a name="l00580"></a>00580   }
<a name="l00581"></a>00581   dest.<a class="code" href="classMD__Vector__std.html#a3ee9294b8d36492e8bdabbc9a97db451">items_to_send_</a>.<a class="code" href="classStatic__Int__Lists.html#ac2bd1e46c2d090657b51aed314b4ab40" title="remplace index et data.">set_index_data</a>(dest_items_send_index, dest_items_send_data);
<a name="l00582"></a>00582   dest.<a class="code" href="classMD__Vector__std.html#a8d6c4c5d6da6fe56e8330253137d412f">items_to_recv_</a>.<a class="code" href="classStatic__Int__Lists.html#ac2bd1e46c2d090657b51aed314b4ab40" title="remplace index et data.">set_index_data</a>(dest_items_recv_index, dest_items_recv_data);
<a name="l00583"></a>00583   dest.<a class="code" href="classMD__Vector__std.html#ae266bd552dcb9f817c791a1c7342a6b0">blocs_to_recv_</a>.<a class="code" href="classStatic__Int__Lists.html#ac2bd1e46c2d090657b51aed314b4ab40" title="remplace index et data.">set_index_data</a>(dest_blocs_recv_index, dest_blocs_recv_data);
<a name="l00584"></a>00584 }
<a name="l00585"></a>00585 
<a name="l00586"></a>00586 <span class="comment">//</span>
<a name="l00587"></a>00587 <span class="comment">//</span>
<a name="l00588"></a>00588 <span class="comment">//</span>
<a name="l00589"></a>00589 <span class="comment">//</span>
<a name="l00590"></a>00590 <span class="comment">//</span>
<a name="l00591"></a>00591 <span class="comment">//</span><span class="comment"></span>
<a name="l00592"></a>00592 <span class="comment">//! cree un descripteur pour un sous-ensemble d&#39;un vecteur.&lt;br&gt;renum fournit la structure et le descripteur du vecteur source (doit avoir line_size==1)&lt;br&gt;renum doit contenir -1 pour les items du vecteur source a ne pas conserver et une&lt;br&gt;valeur positive ou nulle pour les items a conserver.&lt;br&gt;La valeur renum[i] donne l&#39;indice de cet item dans le nouveau tableau.&lt;br&gt;Attention, si un item du vecteur source est recu d&#39;un autre processeur et doit etre conserve,&lt;br&gt;ce meme item doit aussi etre conserve sur le processeur qui envoie cet item.</span>
<a name="l00593"></a><a class="code" href="classMD__Vector__tools.html#ae2cb70190653fe8f0263f5c05e74332b">00593</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classMD__Vector__tools.html#ae2cb70190653fe8f0263f5c05e74332b" title="cree un descripteur pour un sous-ensemble d&#39;un vecteur. renum fournit la structure et le descripteur ...">MD_Vector_tools::creer_md_vect_renum</a>(<span class="keyword">const</span> <a class="code" href="classIntVect.html">IntVect</a>&amp; renum, <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a>&amp; md_vect)
<a name="l00594"></a>00594 {
<a name="l00595"></a>00595   <span class="keyword">const</span> <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a>&amp; src_md = renum.<a class="code" href="classIntVect.html#ae74e1fee6aca124d32718267e33a40c6">get_md_vector</a>();
<a name="l00596"></a>00596   <span class="keywordflow">if</span> (!src_md.<a class="code" href="classMD__Vector.html#a4165c00904b7096274e38fdc7ca340f4">non_nul</a>())
<a name="l00597"></a>00597     {
<a name="l00598"></a>00598       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Internal error in MD_Vector_tools::creer_md_vect_renum: descripteur nul !&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00599"></a>00599       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00600"></a>00600     }
<a name="l00601"></a>00601   <span class="keywordflow">if</span> (renum.<a class="code" href="classIntVect.html#a5ba680066169c8e057bb3e3b876e4a8c">line_size</a>() != 1)
<a name="l00602"></a>00602     {
<a name="l00603"></a>00603       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Internal error in MD_Vector_tools::creer_md_vect_renum: line_size != 1&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00604"></a>00604       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00605"></a>00605     }
<a name="l00606"></a>00606   <span class="keyword">const</span> <a class="code" href="classMD__Vector__base.html" title="Classe de base des descripteurs de vecteurs distribues. Voir la documentation des methodes dans MD_Ve...">MD_Vector_base</a>&amp; src_md_val = src_md.<a class="code" href="classMD__Vector.html#a41324dfaa7a973091d0a8276908d10e2">valeur</a>();
<a name="l00607"></a>00607   <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classMD__Vector__std.html" title="C&#39;est le plus simple des descripteurs, utilise pour les tableaux de valeurs aux sommets, elements, faces, aretes, faces de bord, etc... Il supporte la notion d&#39;items &quot;communs&quot; (sommets du maillage partages entre plusieurs processeurs) et d&#39;items &quot;distants&quot; et &quot;virtuels&quot; (sommets, elements dans l&#39;epaisseur de joint). Voir aussi MD_Vector_composite (descripteur compose d&#39;une reunion de plusieurs descripteurs, pour le P1Bulle par exemple)">MD_Vector_std</a>, src_md_val))
<a name="l00608"></a>00608     {
<a name="l00609"></a>00609       <span class="keyword">const</span> <a class="code" href="classMD__Vector__std.html" title="C&#39;est le plus simple des descripteurs, utilise pour les tableaux de valeurs aux sommets, elements, faces, aretes, faces de bord, etc... Il supporte la notion d&#39;items &quot;communs&quot; (sommets du maillage partages entre plusieurs processeurs) et d&#39;items &quot;distants&quot; et &quot;virtuels&quot; (sommets, elements dans l&#39;epaisseur de joint). Voir aussi MD_Vector_composite (descripteur compose d&#39;une reunion de plusieurs descripteurs, pour le P1Bulle par exemple)">MD_Vector_std</a>&amp; src = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classMD__Vector__std.html" title="C&#39;est le plus simple des descripteurs, utilise pour les tableaux de valeurs aux sommets, elements, faces, aretes, faces de bord, etc... Il supporte la notion d&#39;items &quot;communs&quot; (sommets du maillage partages entre plusieurs processeurs) et d&#39;items &quot;distants&quot; et &quot;virtuels&quot; (sommets, elements dans l&#39;epaisseur de joint). Voir aussi MD_Vector_composite (descripteur compose d&#39;une reunion de plusieurs descripteurs, pour le P1Bulle par exemple)">MD_Vector_std</a>, src_md_val);
<a name="l00610"></a>00610       <a class="code" href="classMD__Vector__std.html" title="C&#39;est le plus simple des descripteurs, utilise pour les tableaux de valeurs aux sommets, elements, faces, aretes, faces de bord, etc... Il supporte la notion d&#39;items &quot;communs&quot; (sommets du maillage partages entre plusieurs processeurs) et d&#39;items &quot;distants&quot; et &quot;virtuels&quot; (sommets, elements dans l&#39;epaisseur de joint). Voir aussi MD_Vector_composite (descripteur compose d&#39;une reunion de plusieurs descripteurs, pour le P1Bulle par exemple)">MD_Vector_std</a> dest;<a class="code" href="classMD__Vector__tools.html#ae2cb70190653fe8f0263f5c05e74332b" title="cree un descripteur pour un sous-ensemble d&#39;un vecteur. renum fournit la structure et le descripteur ..."></a>
<a name="l00611"></a>00611 <a class="code" href="classMD__Vector__tools.html#ae2cb70190653fe8f0263f5c05e74332b" title="cree un descripteur pour un sous-ensemble d&#39;un vecteur. renum fournit la structure et le descripteur ...">      ::creer_md_vect_renum</a>(renum, src, dest);
<a name="l00612"></a>00612       md_vect.<a class="code" href="classMD__Vector.html#a063644dd8ca62e707a2d059eedeb58a7" title="construction d&#39;un objet MD_Vector par copie d&#39;un objet existant. C&#39;est la methode recommandee pour cr...">copy</a>(dest);
<a name="l00613"></a>00613     }
<a name="l00614"></a>00614   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classMD__Vector__composite.html" title="Metadata for a distributed composite vector. This class describes a vector that contains one or more ...">MD_Vector_composite</a>, src_md_val))
<a name="l00615"></a>00615     {
<a name="l00616"></a>00616       <span class="keyword">const</span> <a class="code" href="classMD__Vector__composite.html" title="Metadata for a distributed composite vector. This class describes a vector that contains one or more ...">MD_Vector_composite</a>&amp; src1 = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classMD__Vector__composite.html" title="Metadata for a distributed composite vector. This class describes a vector that contains one or more ...">MD_Vector_composite</a>, src_md_val);
<a name="l00617"></a>00617       <span class="keyword">const</span> <a class="code" href="classMD__Vector__std.html" title="C&#39;est le plus simple des descripteurs, utilise pour les tableaux de valeurs aux sommets, elements, faces, aretes, faces de bord, etc... Il supporte la notion d&#39;items &quot;communs&quot; (sommets du maillage partages entre plusieurs processeurs) et d&#39;items &quot;distants&quot; et &quot;virtuels&quot; (sommets, elements dans l&#39;epaisseur de joint). Voir aussi MD_Vector_composite (descripteur compose d&#39;une reunion de plusieurs descripteurs, pour le P1Bulle par exemple)">MD_Vector_std</a>&amp; src = src1.<a class="code" href="classMD__Vector__composite.html#ac4784365aff4de8ddcd4f1823ac892d3">global_md_</a>;
<a name="l00618"></a>00618       <a class="code" href="classMD__Vector__std.html" title="C&#39;est le plus simple des descripteurs, utilise pour les tableaux de valeurs aux sommets, elements, faces, aretes, faces de bord, etc... Il supporte la notion d&#39;items &quot;communs&quot; (sommets du maillage partages entre plusieurs processeurs) et d&#39;items &quot;distants&quot; et &quot;virtuels&quot; (sommets, elements dans l&#39;epaisseur de joint). Voir aussi MD_Vector_composite (descripteur compose d&#39;une reunion de plusieurs descripteurs, pour le P1Bulle par exemple)">MD_Vector_std</a> dest;<a class="code" href="classMD__Vector__tools.html#ae2cb70190653fe8f0263f5c05e74332b" title="cree un descripteur pour un sous-ensemble d&#39;un vecteur. renum fournit la structure et le descripteur ..."></a>
<a name="l00619"></a>00619 <a class="code" href="classMD__Vector__tools.html#ae2cb70190653fe8f0263f5c05e74332b" title="cree un descripteur pour un sous-ensemble d&#39;un vecteur. renum fournit la structure et le descripteur ...">      ::creer_md_vect_renum</a>(renum, src, dest);
<a name="l00620"></a>00620       md_vect.<a class="code" href="classMD__Vector.html#a063644dd8ca62e707a2d059eedeb58a7" title="construction d&#39;un objet MD_Vector par copie d&#39;un objet existant. C&#39;est la methode recommandee pour cr...">copy</a>(dest);
<a name="l00621"></a>00621     }
<a name="l00622"></a>00622   <span class="keywordflow">else</span>
<a name="l00623"></a>00623     {
<a name="l00624"></a>00624       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in MD_Vector_tools::creer_md_vect_renum: unknown MD_Vector type &quot;</span>
<a name="l00625"></a>00625            &lt;&lt; src_md_val.<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00626"></a>00626       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00627"></a>00627     }
<a name="l00628"></a>00628 }
<a name="l00629"></a>00629 
<a name="l00630"></a>00630 <span class="comment">//</span>
<a name="l00631"></a>00631 <span class="comment">//</span>
<a name="l00632"></a>00632 <span class="comment">//</span>
<a name="l00633"></a>00633 <span class="comment">//</span>
<a name="l00634"></a>00634 <span class="comment">//</span>
<a name="l00635"></a>00635 <span class="comment">//</span>
<a name="l00636"></a>00636 <span class="comment">//</span><span class="comment"></span>
<a name="l00637"></a>00637 <span class="comment">//! Idem que creer_md_vect_renum() mais cree une numerotation par defaut.&lt;br&gt;Le tableau flags_renum doit contenir en entree une valeur POSITIVE OU NULLE pour les&lt;br&gt;valeurs a conserver et une valeur negative pour les autres.&lt;br&gt;En sortie, flags_renum contient l&#39;indice de l&#39;item dans le tableau reduit s&#39;il est&lt;br&gt;conserve, sinon la valeur d&#39;origine non modifiee.&lt;br&gt;Les items sont places dans l&#39;ordre croissant de leur indice local sur dans le descripteur&lt;br&gt;d&#39;origine.</span>
<a name="l00638"></a><a class="code" href="classMD__Vector__tools.html#a773ef21e5af6331de459189d19cc340b">00638</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classMD__Vector__tools.html#a773ef21e5af6331de459189d19cc340b" title="Idem que creer_md_vect_renum() mais cree une numerotation par defaut. Le tableau flags_renum doit con...">MD_Vector_tools::creer_md_vect_renum_auto</a>(<a class="code" href="classIntVect.html">IntVect</a>&amp; flags_renum, <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a>&amp; md_vect)
<a name="l00639"></a>00639 {
<a name="l00640"></a>00640   <span class="keyword">const</span> <span class="keywordtype">int</span> n = flags_renum.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00641"></a>00641   <span class="keywordtype">int</span> count = 0;
<a name="l00642"></a>00642   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
<a name="l00643"></a>00643     {
<a name="l00644"></a>00644       <span class="keywordtype">int</span> x = flags_renum[i];
<a name="l00645"></a>00645       <span class="keywordflow">if</span> (x &gt;= 0)
<a name="l00646"></a>00646         flags_renum[i] = count++;
<a name="l00647"></a>00647     }
<a name="l00648"></a>00648   <a class="code" href="classMD__Vector__tools.html#ae2cb70190653fe8f0263f5c05e74332b" title="cree un descripteur pour un sous-ensemble d&#39;un vecteur. renum fournit la structure et le descripteur ...">creer_md_vect_renum</a>(flags_renum, md_vect);
<a name="l00649"></a>00649 }
<a name="l00650"></a>00650 
<a name="l00651"></a>00651 <span class="comment">//</span><span class="comment"></span>
<a name="l00652"></a>00652 <span class="comment">//! dumps vector v with its parallel descriptor to os.&lt;br&gt;os must be a file type with one file per process (no shared file).</span>
<a name="l00653"></a><a class="code" href="classMD__Vector__tools.html#a300c405bb5f57d2d7e4456ed317adb7c">00653</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classMD__Vector__tools.html#a300c405bb5f57d2d7e4456ed317adb7c" title="dumps vector v with its parallel descriptor to os. os must be a file type with one file per process (...">MD_Vector_tools::dump_vector_with_md</a>(<span class="keyword">const</span> <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; v, <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os)
<a name="l00654"></a>00654 {
<a name="l00655"></a>00655   <span class="keyword">const</span> <a class="code" href="classMD__Vector__base.html" title="Classe de base des descripteurs de vecteurs distribues. Voir la documentation des methodes dans MD_Ve...">MD_Vector_base</a>&amp; md = v.<a class="code" href="classDoubleVect.html#a0d16d30580c90526e4895388fb44be5d">get_md_vector</a>().<a class="code" href="classMD__Vector.html#a41324dfaa7a973091d0a8276908d10e2">valeur</a>();
<a name="l00656"></a>00656   os &lt;&lt; md.<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00657"></a>00657   os &lt;&lt; md &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00658"></a>00658   os &lt;&lt; <span class="stringliteral">&quot;line_size&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#ae67efc620265981e3385b5f75837d3ef">space</a> &lt;&lt; v.<a class="code" href="classDoubleVect.html#ab02d01cd1bdab66fbd66f9a47cc29e10">line_size</a>() &lt;&lt; finl;
<a name="l00659"></a>00659 
<a name="l00660"></a>00660   os &lt;&lt; v.<a class="code" href="classArrOfDouble.html#a3c3b33bea0e88b87315c21ee94bee05f" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>() &lt;&lt; finl;
<a name="l00661"></a>00661   os.<a class="code" href="classSortie.html#aa3f46aaccaff0f83c018784b50d8ea24" title="Methode de bas niveau pour ecrire un tableau d&#39;ints ou reels dans le stream. Dans l&#39;implementation de...">put</a>(v.<a class="code" href="classArrOfDouble.html#a95357a1390c11dbd481d385257f2e983" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>(), v.<a class="code" href="classArrOfDouble.html#a3c3b33bea0e88b87315c21ee94bee05f" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>(), v.<a class="code" href="classDoubleVect.html#ab02d01cd1bdab66fbd66f9a47cc29e10">line_size</a>());
<a name="l00662"></a>00662   os &lt;&lt; finl;
<a name="l00663"></a>00663 }
<a name="l00664"></a>00664 
<a name="l00665"></a>00665 <span class="comment">//</span>
<a name="l00666"></a>00666 <span class="comment">//</span>
<a name="l00667"></a>00667 <span class="comment">//</span>
<a name="l00668"></a>00668 <span class="comment">//</span>
<a name="l00669"></a>00669 <span class="comment">//</span><span class="comment"></span>
<a name="l00670"></a>00670 <span class="comment">//! restores a vector saved by dump_vector_with_md.&lt;br&gt;The code must run with the same number of processors.&lt;br&gt;&quot;v&quot; will have a newly created copy of the descriptor (not equal to any&lt;br&gt;other descriptor previously loaded). If &quot;identical&quot; descriptors are needed&lt;br&gt;for several vectors, you might want to call set_md_vector() afterwards to&lt;br&gt;attach another descriptor. See save_matrice_conditionnel()</span>
<a name="l00671"></a><a class="code" href="classMD__Vector__tools.html#ab7324a93364b401d8c542f399d24a7c5">00671</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classMD__Vector__tools.html#ab7324a93364b401d8c542f399d24a7c5" title="restores a vector saved by dump_vector_with_md. The code must run with the same number of processors...">MD_Vector_tools::restore_vector_with_md</a>(<a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; v, <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00672"></a>00672 {
<a name="l00673"></a>00673 
<a name="l00674"></a>00674   v.<a class="code" href="classDoubleVect.html#a990500e5bf63a8ca55fd833d111e135c" title="met l&#39;objet dans l&#39;etat obtenu par le constructeur par defaut. (voir ArrOfDouble::reset())">reset</a>();
<a name="l00675"></a>00675   <a class="code" href="Deriv_8h.html#a4b39337b42cbf2fddeba7868ced6f860" title="Soit une classe Type_base qui derive de Objet_U. DERIV(T) est une petite classe contenant un pointeur...">DERIV</a>(<a class="code" href="classMD__Vector__base.html" title="Classe de base des descripteurs de vecteurs distribues. Voir la documentation des methodes dans MD_Ve...">MD_Vector_base</a>) md_ptr;
<a name="l00676"></a>00676   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> md_type;
<a name="l00677"></a>00677   is &gt;&gt; md_type;
<a name="l00678"></a>00678   md_ptr.typer(md_type);
<a name="l00679"></a>00679   is &gt;&gt; md_ptr.valeur();
<a name="l00680"></a>00680 
<a name="l00681"></a>00681 <span class="comment">// Creation du MD_Vector attache au tableau</span>
<a name="l00682"></a>00682   <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a> md;
<a name="l00683"></a>00683   md.<a class="code" href="classMD__Vector.html#a063644dd8ca62e707a2d059eedeb58a7" title="construction d&#39;un objet MD_Vector par copie d&#39;un objet existant. C&#39;est la methode recommandee pour cr...">copy</a>(md_ptr.valeur());
<a name="l00684"></a>00684 
<a name="l00685"></a>00685   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> unused;
<a name="l00686"></a>00686   <span class="keywordtype">int</span> line_size;
<a name="l00687"></a>00687   is &gt;&gt; unused &gt;&gt; line_size;
<a name="l00688"></a>00688 
<a name="l00689"></a>00689 <span class="comment">// Astuce pour restaurer le line_size:</span>
<a name="l00690"></a>00690   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> toto;
<a name="l00691"></a>00691   toto.<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(md_ptr.valeur().get_nb_items_tot(), line_size, <a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ffaf6ae9ba7eb51c5f298ce693345b3ec68">Array_base::NOCOPY_NOINIT</a>);
<a name="l00692"></a>00692   <span class="keywordtype">int</span> size_tot;
<a name="l00693"></a>00693   is &gt;&gt; size_tot;
<a name="l00694"></a>00694   is.<a class="code" href="classEntree.html#aa434f5ceb8169e469613d1f6cd1fd99f" title="methode virtuelle pour lire un tableau d&#39;ints ou reels&lt;br&gt;(le tableau doit avoir la bonne dimension: ...">get</a>(toto.<a class="code" href="classArrOfDouble.html#a95357a1390c11dbd481d385257f2e983" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>(), size_tot);
<a name="l00695"></a>00695   toto.<a class="code" href="classDoubleTab.html#a2f40241acb678b0dd0dac7ee4f421b1d" title="associe le md_vector au vecteur (voir DoubleVect::set_md_vector()) dimension(0) sera initialise a md_...">set_md_vector</a>(md);
<a name="l00696"></a>00696 
<a name="l00697"></a>00697 <span class="comment">// Attache v a toto et oublie toto... line_size est transfere sur v</span>
<a name="l00698"></a>00698   v.<a class="code" href="classDoubleVect.html#a990500e5bf63a8ca55fd833d111e135c" title="met l&#39;objet dans l&#39;etat obtenu par le constructeur par defaut. (voir ArrOfDouble::reset())">reset</a>();
<a name="l00699"></a>00699   v.<a class="code" href="classDoubleVect.html#a2b45ece955d7d57746fa32b5a6a89cc2" title="detache le tableau et l&#39;attache a v (sauf si v==*this, ne fait rien) Fait pointer le tableau sur la m...">ref</a>(toto);
<a name="l00700"></a>00700 }
<a name="l00701"></a>00701 
<a name="l00702"></a><a class="code" href="classMD__Vector__tools.html#abbbf6fa01a47a78772f8a4458b7ef45d">00702</a> <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a> <a class="code" href="classMD__Vector__tools.html#abbbf6fa01a47a78772f8a4458b7ef45d">MD_Vector_tools::extend</a>(<span class="keyword">const</span> <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a>&amp; src, <a class="code" href="MD__Vector__tools_8h.html#a25b6cd4711cb79584b6c83b3de18f9e0">extra_item_t</a>&amp; items)
<a name="l00703"></a>00703 {
<a name="l00704"></a>00704   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#a1e9d9f9899b71927cfafae14c7bd048d" title="Calcule le max de x sur tous les processeurs du groupe courant. Remarques : Cette methode doit etre a...">Process::mp_max</a>(items.size()) == 0) <span class="keywordflow">return</span> src; <span class="comment">//rien a faire</span>
<a name="l00705"></a>00705   <span class="comment">/* remplissage de : recep[p] -&gt; liste des items qu&#39;on veut recevoir du processeur p</span>
<a name="l00706"></a>00706 <span class="comment">                      items[{p, i}] -&gt; ou on va placer chaque item dans le MD_Vector elargi */</span>
<a name="l00707"></a>00707   <span class="keywordtype">int</span> i, j, p, nb_items_tot = src.<a class="code" href="classMD__Vector.html#a41324dfaa7a973091d0a8276908d10e2">valeur</a>().<a class="code" href="classMD__Vector__base.html#a27d5ace2aee5ecf1d78accb7b321108d">get_nb_items_tot</a>(), idx = nb_items_tot;
<a name="l00708"></a>00708   <span class="keyword">const</span> <a class="code" href="classMD__Vector__std.html" title="C&#39;est le plus simple des descripteurs, utilise pour les tableaux de valeurs aux sommets, elements, faces, aretes, faces de bord, etc... Il supporte la notion d&#39;items &quot;communs&quot; (sommets du maillage partages entre plusieurs processeurs) et d&#39;items &quot;distants&quot; et &quot;virtuels&quot; (sommets, elements dans l&#39;epaisseur de joint). Voir aussi MD_Vector_composite (descripteur compose d&#39;une reunion de plusieurs descripteurs, pour le P1Bulle par exemple)">MD_Vector_std</a> *mds = NULL;
<a name="l00709"></a>00709   <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classMD__Vector__std.html" title="C&#39;est le plus simple des descripteurs, utilise pour les tableaux de valeurs aux sommets, elements, faces, aretes, faces de bord, etc... Il supporte la notion d&#39;items &quot;communs&quot; (sommets du maillage partages entre plusieurs processeurs) et d&#39;items &quot;distants&quot; et &quot;virtuels&quot; (sommets, elements dans l&#39;epaisseur de joint). Voir aussi MD_Vector_composite (descripteur compose d&#39;une reunion de plusieurs descripteurs, pour le P1Bulle par exemple)">MD_Vector_std</a>, src.<a class="code" href="classMD__Vector.html#a41324dfaa7a973091d0a8276908d10e2">valeur</a>())) mds = &amp;<a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classMD__Vector__std.html" title="C&#39;est le plus simple des descripteurs, utilise pour les tableaux de valeurs aux sommets, elements, faces, aretes, faces de bord, etc... Il supporte la notion d&#39;items &quot;communs&quot; (sommets du maillage partages entre plusieurs processeurs) et d&#39;items &quot;distants&quot; et &quot;virtuels&quot; (sommets, elements dans l&#39;epaisseur de joint). Voir aussi MD_Vector_composite (descripteur compose d&#39;une reunion de plusieurs descripteurs, pour le P1Bulle par exemple)">MD_Vector_std</a>, src.<a class="code" href="classMD__Vector.html#a41324dfaa7a973091d0a8276908d10e2">valeur</a>());
<a name="l00710"></a>00710   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classMD__Vector__composite.html" title="Metadata for a distributed composite vector. This class describes a vector that contains one or more ...">MD_Vector_composite</a>, src.<a class="code" href="classMD__Vector.html#a41324dfaa7a973091d0a8276908d10e2">valeur</a>())) mds = &amp;<a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classMD__Vector__composite.html" title="Metadata for a distributed composite vector. This class describes a vector that contains one or more ...">MD_Vector_composite</a>, src.<a class="code" href="classMD__Vector.html#a41324dfaa7a973091d0a8276908d10e2">valeur</a>()).global_md_;
<a name="l00711"></a>00711 
<a name="l00712"></a>00712   <span class="comment">/* recv[p] : items qu&#39;on veut recevoir du processeur p : taille nrecv[p]. On en profite pour les numeroter dans items */</span>
<a name="l00713"></a>00713   <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>) recv(<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>());
<a name="l00714"></a>00714   <span class="keywordflow">for</span> (p = 0; p &lt; <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>(); p++) recv[p].set_smart_resize(1);
<a name="l00715"></a>00715   std::vector&lt;int&gt; nrecv(Process::nproc());
<a name="l00716"></a>00716   <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;kv : items) recv[kv.first[0]].append_array(kv.first[1]), kv.second = idx, nrecv[kv.first[0]]++, idx++;
<a name="l00717"></a>00717 
<a name="l00718"></a>00718   <span class="comment">/* send[p] : items qu&#39;on doit envoyer au processeur p */</span>
<a name="l00719"></a>00719   <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>) send(Process::nproc());
<a name="l00720"></a>00720   <a class="code" href="communications_8cpp.html#a5ceda011ec527d63b691f62cd2fb61c8">envoyer_all_to_all</a>(recv, send);
<a name="l00721"></a>00721 
<a name="l00722"></a>00722   std::map&lt;int, std::array&lt;std::vector&lt;int&gt;, 3&gt;&gt; map; <span class="comment">//map[p] = { items a envoyer a p, items a recevoir de p, blocs a recevoir de p }</span>
<a name="l00723"></a>00723 
<a name="l00724"></a>00724   <span class="keywordflow">for</span> (i = 0; i &lt; mds-&gt;<a class="code" href="classMD__Vector__std.html#a68854e710075fdc8c2f2ce28fbbb9ecc">pe_voisins_</a>.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>(); i++)
<a name="l00725"></a>00725     {
<a name="l00726"></a>00726       p = mds-&gt;<a class="code" href="classMD__Vector__std.html#a68854e710075fdc8c2f2ce28fbbb9ecc">pe_voisins_</a>(i);
<a name="l00727"></a>00727       <span class="keywordflow">for</span> (j = 0; j &lt; mds-&gt;<a class="code" href="classMD__Vector__std.html#a3ee9294b8d36492e8bdabbc9a97db451">items_to_send_</a>.<a class="code" href="classStatic__Int__Lists.html#adbf6903737c3c30bf87e05b29f5a5b56" title="renvoie le nombre d&#39;elements de la liste i">get_list_size</a>(i); j++) map[p][0].push_back(mds-&gt;<a class="code" href="classMD__Vector__std.html#a3ee9294b8d36492e8bdabbc9a97db451">items_to_send_</a>(i, j));
<a name="l00728"></a>00728       <span class="keywordflow">for</span> (j = 0; j &lt; mds-&gt;<a class="code" href="classMD__Vector__std.html#a8d6c4c5d6da6fe56e8330253137d412f">items_to_recv_</a>.<a class="code" href="classStatic__Int__Lists.html#adbf6903737c3c30bf87e05b29f5a5b56" title="renvoie le nombre d&#39;elements de la liste i">get_list_size</a>(i); j++) map[p][1].push_back(mds-&gt;<a class="code" href="classMD__Vector__std.html#a8d6c4c5d6da6fe56e8330253137d412f">items_to_recv_</a>(i, j));
<a name="l00729"></a>00729       <span class="keywordflow">for</span> (j = 0; j &lt; mds-&gt;<a class="code" href="classMD__Vector__std.html#ae266bd552dcb9f817c791a1c7342a6b0">blocs_to_recv_</a>.<a class="code" href="classStatic__Int__Lists.html#adbf6903737c3c30bf87e05b29f5a5b56" title="renvoie le nombre d&#39;elements de la liste i">get_list_size</a>(i); j++) map[p][2].push_back(mds-&gt;<a class="code" href="classMD__Vector__std.html#ae266bd552dcb9f817c791a1c7342a6b0">blocs_to_recv_</a>(i, j));
<a name="l00730"></a>00730     }
<a name="l00731"></a>00731 
<a name="l00732"></a>00732   <span class="comment">/* ajout de ce qu&#39;on doit envoyer/recevoir en plus */</span>
<a name="l00733"></a>00733   <span class="keywordflow">for</span> (p = 0; p &lt; Process::nproc(); p++) <span class="keywordflow">for</span> (i = 0; i &lt; send[p].size_array(); i++) map[p][0].push_back(send[p][i]);
<a name="l00734"></a>00734   <span class="keywordflow">for</span> (p = 0, idx = nb_items_tot; p &lt; Process::nproc(); idx += nrecv[p], p++)
<a name="l00735"></a>00735     <span class="keywordflow">if</span> (nrecv[p]) map[p][2].insert(map[p][2].end(), { idx, idx + nrecv[p] });
<a name="l00736"></a>00736 
<a name="l00737"></a>00737   <span class="comment">/* reconstruction de tableaux pour MD_Vector_std */</span>
<a name="l00738"></a>00738   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> pe_voisins(map.size());
<a name="l00739"></a>00739   <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>) items_to_send(map.size()), items_to_recv(map.size()), blocs_to_recv(map.size());
<a name="l00740"></a>00740   <span class="keywordflow">for</span> (p = 0, i = 0; p &lt; Process::nproc(); nb_items_tot += nrecv[p],  p++) <span class="keywordflow">if</span> (map.count(p))
<a name="l00741"></a>00741       {
<a name="l00742"></a>00742         pe_voisins(i) = p;
<a name="l00743"></a>00743         items_to_send[i].resize(map[p][0].size()), std::copy(map[p][0].begin(), map[p][0].end(), items_to_send[i].addr());
<a name="l00744"></a>00744         items_to_recv[i].resize(map[p][1].size()), std::copy(map[p][1].begin(), map[p][1].end(), items_to_recv[i].addr());
<a name="l00745"></a>00745         blocs_to_recv[i].resize(map[p][2].size()), std::copy(map[p][2].begin(), map[p][2].end(), blocs_to_recv[i].addr());
<a name="l00746"></a>00746         i++;
<a name="l00747"></a>00747       }
<a name="l00748"></a>00748 
<a name="l00749"></a>00749   <span class="comment">/* c&#39;est parti */</span>
<a name="l00750"></a>00750   <a class="code" href="classMD__Vector__std.html" title="C&#39;est le plus simple des descripteurs, utilise pour les tableaux de valeurs aux sommets, elements, faces, aretes, faces de bord, etc... Il supporte la notion d&#39;items &quot;communs&quot; (sommets du maillage partages entre plusieurs processeurs) et d&#39;items &quot;distants&quot; et &quot;virtuels&quot; (sommets, elements dans l&#39;epaisseur de joint). Voir aussi MD_Vector_composite (descripteur compose d&#39;une reunion de plusieurs descripteurs, pour le P1Bulle par exemple)">MD_Vector_std</a> mdd(nb_items_tot, mds-&gt;<a class="code" href="classMD__Vector__base2.html#a6735838767f62a3def156bf93d8a5224">get_nb_items_reels</a>(), pe_voisins, items_to_send, items_to_recv, blocs_to_recv);
<a name="l00751"></a>00751   <a class="code" href="classMD__Vector.html" title=": Cette classe est un DERIV mais l&#39;objet pointe est partage entre plusieurs instances de cette classe...">MD_Vector</a> res;
<a name="l00752"></a>00752   res.<a class="code" href="classMD__Vector.html#a063644dd8ca62e707a2d059eedeb58a7" title="construction d&#39;un objet MD_Vector par copie d&#39;un objet existant. C&#39;est la methode recommandee pour cr...">copy</a>(mdd);
<a name="l00753"></a>00753   <span class="keywordflow">return</span> res;
<a name="l00754"></a>00754 }
<a name="l00755"></a>00755 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:23 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
