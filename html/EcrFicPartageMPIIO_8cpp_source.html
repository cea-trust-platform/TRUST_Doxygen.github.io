<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/Kernel/Utilitaires/EcrFicPartageMPIIO.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/Kernel/Utilitaires/EcrFicPartageMPIIO.cpp</div>  </div>
</div>
<div class="contents">
<a href="EcrFicPartageMPIIO_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (c) 2021, CEA</span>
<a name="l00003"></a>00003 <span class="comment">* All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment">* 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00007"></a>00007 <span class="comment">* 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00008"></a>00008 <span class="comment">* 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<a name="l00011"></a>00011 <span class="comment">* IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;</span>
<a name="l00012"></a>00012 <span class="comment">* OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// File:        EcrFicPartageMPIIO.cpp</span>
<a name="l00018"></a>00018 <span class="comment">// Directory:   $TRUST_ROOT/src/Kernel/Utilitaires</span>
<a name="l00019"></a>00019 <span class="comment">// Version:     /main/35</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;<a class="code" href="EcrFicPartageMPIIO_8h.html">EcrFicPartageMPIIO.h</a>&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="Statistiques_8h.html">Statistiques.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="OBuffer_8h.html">OBuffer.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="PE__Groups_8h.html">PE_Groups.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="Comm__Group_8h.html">Comm_Group.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="communications_8h.html">communications.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="Comm__Group__MPI_8h.html">Comm_Group_MPI.h</a>&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="keyword">extern</span> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="EcrFicPartageMPIIO_8cpp.html#ae53634a5d9963b9481961762d15d23b2">IO_EcrireFicPartageMPIIO_counter_</a>;
<a name="l00033"></a>00033 
<a name="l00034"></a><a class="code" href="EcrFicPartageMPIIO_8cpp.html#a0899a925bf2f591621446f12124d27fe">00034</a> <a class="code" href="Declare__Inst_8h.html#a1a414570e3c7a7f9787a0eba4e9366e8">Implemente_instanciable_sans_constructeur_ni_destructeur</a>(<a class="code" href="classEcrFicPartageMPIIO.html" title="Class to use MPI-IO to write in a single file.">EcrFicPartageMPIIO</a>,<span class="stringliteral">&quot;EcrFicPartageMPIIO&quot;</span>,<a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a>);
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="preprocessor">#ifdef MPI_</span>
<a name="l00037"></a><a class="code" href="EcrFicPartageMPIIO_8cpp.html#ad7e69a4bf0b8ebd93de088e375f13a53">00037</a> <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="EcrFicPartageMPIIO_8cpp.html#ad7e69a4bf0b8ebd93de088e375f13a53">handle_error</a>(<span class="keywordtype">int</span> errcode, <span class="keyword">const</span> <span class="keywordtype">char</span> *str)
<a name="l00038"></a>00038 {
<a name="l00039"></a>00039   <span class="keywordtype">char</span> msg[MPI_MAX_ERROR_STRING];
<a name="l00040"></a>00040   <a class="code" href="arch_8h.html#a1caaf369d9c5f0817dbaa76b43b8d87b">True_int</a> resultlen;
<a name="l00041"></a>00041   MPI_Error_string(errcode, msg, &amp;resultlen);
<a name="l00042"></a>00042   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;======================&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00043"></a>00043   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; str &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; msg &lt;&lt; finl;
<a name="l00044"></a>00044   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Contact TRUST support.&quot;</span> &lt;&lt; finl;
<a name="l00045"></a>00045   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00046"></a>00046 }
<a name="l00047"></a><a class="code" href="EcrFicPartageMPIIO_8cpp.html#ab536dc09d9106ab2e59d2ca631f247a4">00047</a> <span class="preprocessor">#define MPI_CHECK(fn) { int errcode; errcode = fn;\</span>
<a name="l00048"></a>00048 <span class="preprocessor">     if (errcode != MPI_SUCCESS) handle_error(errcode, #fn); }</span>
<a name="l00049"></a>00049 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00050"></a>00050 <span class="preprocessor"></span>
<a name="l00051"></a><a class="code" href="classEcrFicPartageMPIIO.html#a51fceb7192b5943cda3b71b85f54f111">00051</a> <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classEcrFicPartageMPIIO.html#a51fceb7192b5943cda3b71b85f54f111" title="Lecture d&#39;un Objet_U sur un flot d&#39;entree Methode a surcharger.">EcrFicPartageMPIIO::readOn</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; s)
<a name="l00052"></a>00052 {
<a name="l00053"></a>00053   <span class="keywordflow">throw</span>;
<a name="l00054"></a>00054   <span class="keywordflow">return</span> s;
<a name="l00055"></a>00055 }
<a name="l00056"></a>00056 
<a name="l00057"></a><a class="code" href="classEcrFicPartageMPIIO.html#ab97fbc70e2f122bd24e87a295131af73">00057</a> <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classEcrFicPartageMPIIO.html#ab97fbc70e2f122bd24e87a295131af73" title="Ecriture de l&#39;objet sur un flot de sortie Methode a surcharger.">EcrFicPartageMPIIO::printOn</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; s)<span class="keyword"> const</span>
<a name="l00058"></a>00058 <span class="keyword"></span>{
<a name="l00059"></a>00059   <span class="keywordflow">throw</span>;
<a name="l00060"></a>00060   <span class="keywordflow">return</span> s;
<a name="l00061"></a>00061 }
<a name="l00062"></a>00062 
<a name="l00063"></a><a class="code" href="classEcrFicPartageMPIIO.html#a2dd3d28f3da2179c68fcdc5a6f7f3a57">00063</a> <a class="code" href="classEcrFicPartageMPIIO.html#a2dd3d28f3da2179c68fcdc5a6f7f3a57">EcrFicPartageMPIIO::EcrFicPartageMPIIO</a>() : <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a>()
<a name="l00064"></a>00064 {
<a name="l00065"></a>00065   <a class="code" href="classSortie.html#a7291aca32660e875543da1f0260b3773">bin_</a> = 1; <span class="comment">//!&lt; Binaire par defaut</span>
<a name="l00066"></a>00066 <span class="comment"></span><span class="preprocessor">#ifdef MPI_</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span>  <a class="code" href="classEcrFicPartageMPIIO.html#a704e07b69e0ff707b8c9efbce1931da8">mpi_file_</a>=NULL;
<a name="l00068"></a>00068 <span class="preprocessor">#endif</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span>}
<a name="l00070"></a><a class="code" href="classEcrFicPartageMPIIO.html#a798d43202595cf9125ac25ba5ebb96c5">00070</a> <a class="code" href="classEcrFicPartageMPIIO.html#a798d43202595cf9125ac25ba5ebb96c5">EcrFicPartageMPIIO::~EcrFicPartageMPIIO</a>()
<a name="l00071"></a>00071 {
<a name="l00072"></a>00072   <a class="code" href="classEcrFicPartageMPIIO.html#ad7b2324d749a16d893c802297bcb8834">close</a>();
<a name="l00073"></a>00073 }
<a name="l00074"></a>00074 <span class="preprocessor">#ifdef MPI_</span>
<a name="l00075"></a><a class="code" href="classEcrFicPartageMPIIO.html#ae1b6b1a005ab4f4a5034919c94bdc085">00075</a> <span class="preprocessor"></span><a class="code" href="classEcrFicPartageMPIIO.html#a2dd3d28f3da2179c68fcdc5a6f7f3a57">EcrFicPartageMPIIO::EcrFicPartageMPIIO</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* name,<a class="code" href="arch_8h.html#a58aa6cef3a754a92479a2fb744a5f538" title="Gestion des dependances machines pour l&#39;appel a FORTRAN La macro F77DECLARE(TOTO) permet de declarer ...">IOS_OPEN_MODE</a> mode)
<a name="l00076"></a>00076 {
<a name="l00077"></a>00077   <a class="code" href="classEcrFicPartageMPIIO.html#a5a0698b030d1d0d1d57a2e5aac207409">ouvrir</a>(name, mode);
<a name="l00078"></a>00078 }
<a name="l00079"></a><a class="code" href="classEcrFicPartageMPIIO.html#a5a0698b030d1d0d1d57a2e5aac207409">00079</a> <span class="keywordtype">int</span> <a class="code" href="classEcrFicPartageMPIIO.html#a5a0698b030d1d0d1d57a2e5aac207409">EcrFicPartageMPIIO::ouvrir</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* name,<a class="code" href="arch_8h.html#a58aa6cef3a754a92479a2fb744a5f538" title="Gestion des dependances machines pour l&#39;appel a FORTRAN La macro F77DECLARE(TOTO) permet de declarer ...">IOS_OPEN_MODE</a> mode)
<a name="l00080"></a>00080 {
<a name="l00081"></a>00081   MPI_Comm mpi_comm;
<a name="l00082"></a>00082   <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classComm__Group__MPI.html" title=": Classe Comm_Group_MPI, derivee de la classe abstraite Comm_Group. Cette classe represente un groupe...">Comm_Group_MPI</a>,<a class="code" href="classPE__Groups.html#ae6ca0277a58f2ab34ebfb3216578fa75" title="renvoie une reference au groupe de processeurs actif courant">PE_Groups::current_group</a>()))
<a name="l00083"></a>00083     mpi_comm = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classComm__Group__MPI.html" title=": Classe Comm_Group_MPI, derivee de la classe abstraite Comm_Group. Cette classe represente un groupe...">Comm_Group_MPI</a>,<a class="code" href="classPE__Groups.html#ae6ca0277a58f2ab34ebfb3216578fa75" title="renvoie une reference au groupe de processeurs actif courant">PE_Groups::current_group</a>()).get_mpi_comm();
<a name="l00084"></a>00084   <span class="keywordflow">else</span>
<a name="l00085"></a>00085     mpi_comm = MPI_COMM_WORLD;
<a name="l00086"></a>00086   <span class="keywordtype">int</span> MPI_OPEN = mode == ios::app ? MPI_MODE_APPEND : MPI_MODE_CREATE;
<a name="l00087"></a>00087   <span class="keywordtype">int</span> MPI_MODE = (mode == ios::app || ios::out) ? MPI_MODE_WRONLY : MPI_MODE_RDONLY;
<a name="l00088"></a>00088   <a class="code" href="EcrFicPartageMPIIO_8cpp.html#ab536dc09d9106ab2e59d2ca631f247a4">MPI_CHECK</a>(MPI_File_open(mpi_comm, (<span class="keywordtype">char</span>*)name, MPI_OPEN|MPI_MODE, MPI_INFO_NULL, &amp;<a class="code" href="classEcrFicPartageMPIIO.html#a704e07b69e0ff707b8c9efbce1931da8">mpi_file_</a>));
<a name="l00089"></a>00089 <span class="comment">// Set MPI errors fatal:</span>
<a name="l00090"></a>00090   MPI_File_set_errhandler(<a class="code" href="classEcrFicPartageMPIIO.html#a704e07b69e0ff707b8c9efbce1931da8">mpi_file_</a>,MPI_ERRORS_ARE_FATAL);
<a name="l00091"></a>00091 <span class="comment">// Set initial displacement:</span>
<a name="l00092"></a>00092   <a class="code" href="classEcrFicPartageMPIIO.html#ac08650f91ffc4ce09b64413aa4a06f19" title="Displacement of the individual pointers (in bytes)">disp_</a>=0;
<a name="l00093"></a>00093 <span class="comment">// Ecriture d&#39;un entete specifique pour le build int64 ?</span>
<a name="l00094"></a>00094   <span class="keywordflow">if</span> (mode==ios::out)
<a name="l00095"></a>00095     {
<a name="l00096"></a>00096       <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">je_suis_maitre</a>())
<a name="l00097"></a>00097         {
<a name="l00098"></a>00098           <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> marq(<span class="stringliteral">&quot;INT64&quot;</span>);
<a name="l00099"></a>00099 <span class="preprocessor">#ifdef INT_is_64_</span>
<a name="l00100"></a>00100 <span class="preprocessor"></span>          (*this)&lt;&lt;marq.<a class="code" href="classNom.html#aa9f24bd3370b5f1c66666e65252eea05">getChar</a>();
<a name="l00101"></a>00101 <span class="preprocessor">#endif</span>
<a name="l00102"></a>00102 <span class="preprocessor"></span>        }
<a name="l00103"></a>00103     }
<a name="l00104"></a>00104   <span class="comment">/*</span>
<a name="l00105"></a>00105 <span class="comment">  else</span>
<a name="l00106"></a>00106 <span class="comment">    {</span>
<a name="l00107"></a>00107 <span class="comment">      Cerr&lt;&lt;&quot;not coded in EcrFicPartageMPIIO::ouvrir&quot;&lt;&lt;finl;</span>
<a name="l00108"></a>00108 <span class="comment">      exit();</span>
<a name="l00109"></a>00109 <span class="comment">    }*/</span>
<a name="l00110"></a>00110   <span class="keywordflow">return</span> 1;
<a name="l00111"></a>00111 }
<a name="l00112"></a><a class="code" href="classEcrFicPartageMPIIO.html#ad7b2324d749a16d893c802297bcb8834">00112</a> <span class="keywordtype">void</span> <a class="code" href="classEcrFicPartageMPIIO.html#ad7b2324d749a16d893c802297bcb8834">EcrFicPartageMPIIO::close</a>()
<a name="l00113"></a>00113 {
<a name="l00114"></a>00114   <span class="keywordflow">if</span> (<a class="code" href="classEcrFicPartageMPIIO.html#a704e07b69e0ff707b8c9efbce1931da8">mpi_file_</a>) MPI_File_close(&amp;<a class="code" href="classEcrFicPartageMPIIO.html#a704e07b69e0ff707b8c9efbce1931da8">mpi_file_</a>);
<a name="l00115"></a>00115   <a class="code" href="classEcrFicPartageMPIIO.html#ac08650f91ffc4ce09b64413aa4a06f19" title="Displacement of the individual pointers (in bytes)">disp_</a>=0;
<a name="l00116"></a>00116   <span class="keywordflow">return</span>;
<a name="l00117"></a>00117 }
<a name="l00118"></a>00118 
<a name="l00119"></a><a class="code" href="classEcrFicPartageMPIIO.html#aa5b14a5278a505867108051a2a584ff1">00119</a> <span class="keywordtype">void</span> <a class="code" href="classEcrFicPartageMPIIO.html#aa5b14a5278a505867108051a2a584ff1">EcrFicPartageMPIIO::check</a>()
<a name="l00120"></a>00120 {
<a name="l00121"></a>00121   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>()&gt;0)
<a name="l00122"></a>00122     {
<a name="l00123"></a>00123       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Only master process can call EcrFicPartageMPIIO::operator &lt;&lt;(...)&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00124"></a>00124       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00125"></a>00125     }
<a name="l00126"></a>00126   MPI_Offset offset; <span class="comment">//!&lt; Relative position</span>
<a name="l00127"></a>00127 <span class="comment"></span>  MPI_File_get_position(<a class="code" href="classEcrFicPartageMPIIO.html#a704e07b69e0ff707b8c9efbce1931da8">mpi_file_</a>, &amp;offset);
<a name="l00128"></a>00128   MPI_Offset disp;   <span class="comment">//!&lt; Absolute position</span>
<a name="l00129"></a>00129 <span class="comment"></span>  MPI_File_get_byte_offset(<a class="code" href="classEcrFicPartageMPIIO.html#a704e07b69e0ff707b8c9efbce1931da8">mpi_file_</a>, offset, &amp;disp);
<a name="l00130"></a>00130   <span class="keywordflow">if</span> (<a class="code" href="classEcrFicPartageMPIIO.html#ac08650f91ffc4ce09b64413aa4a06f19" title="Displacement of the individual pointers (in bytes)">disp_</a>!=disp)
<a name="l00131"></a>00131     {
<a name="l00132"></a>00132       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in EcrFicPartageMPIIO::check()&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00133"></a>00133       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Decalage : disp_= &quot;</span> &lt;&lt; (int)<a class="code" href="classEcrFicPartageMPIIO.html#ac08650f91ffc4ce09b64413aa4a06f19" title="Displacement of the individual pointers (in bytes)">disp_</a> &lt;&lt; <span class="stringliteral">&quot; disp=&quot;</span> &lt;&lt; (<span class="keywordtype">int</span>)disp &lt;&lt; finl;
<a name="l00134"></a>00134       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Contact TRUST support.&quot;</span> &lt;&lt; finl;
<a name="l00135"></a>00135     }
<a name="l00136"></a>00136 }
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 <span class="comment">// Function write used in all the operator&lt;&lt; to avoid to duplicate the code</span>
<a name="l00139"></a><a class="code" href="classEcrFicPartageMPIIO.html#aa85a469d4da763232ad61072bcefedf9">00139</a> <span class="keywordtype">void</span> <a class="code" href="classEcrFicPartageMPIIO.html#aa85a469d4da763232ad61072bcefedf9">EcrFicPartageMPIIO::write</a>(MPI_Datatype MPI_TYPE, <span class="keyword">const</span> <span class="keywordtype">void</span>* ob)
<a name="l00140"></a>00140 {
<a name="l00141"></a>00141   <a class="code" href="arch_8h.html#a1caaf369d9c5f0817dbaa76b43b8d87b">True_int</a> size;
<a name="l00142"></a>00142   MPI_Type_size(MPI_TYPE, &amp;size);
<a name="l00143"></a>00143   MPI_File_write(<a class="code" href="classEcrFicPartageMPIIO.html#a704e07b69e0ff707b8c9efbce1931da8">mpi_file_</a>, (<span class="keywordtype">void</span>*)ob, 1, MPI_TYPE, &amp;<a class="code" href="classEcrFicPartageMPIIO.html#a24bcbcc7a57e652f6773cbc1b681c63a">mpi_status_</a>);
<a name="l00144"></a>00144   <a class="code" href="classEcrFicPartageMPIIO.html#ac08650f91ffc4ce09b64413aa4a06f19" title="Displacement of the individual pointers (in bytes)">disp_</a>+=size;
<a name="l00145"></a>00145   <a class="code" href="classEcrFicPartageMPIIO.html#aa5b14a5278a505867108051a2a584ff1">check</a>();
<a name="l00146"></a>00146 }
<a name="l00147"></a>00147 
<a name="l00148"></a><a class="code" href="classEcrFicPartageMPIIO.html#a962855d98e2d632d2b3a024004a39551">00148</a> <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classEcrFicPartageMPIIO.html#a962855d98e2d632d2b3a024004a39551">EcrFicPartageMPIIO::operator &lt;&lt;</a>(<span class="keyword">const</span> <a class="code" href="classSeparateur.html" title="Separateur pour les fichiers. Ce sont des objets speciaux que l&#39;on peut inserer dans une sortie comme...">Separateur</a>&amp; ob)
<a name="l00149"></a>00149 {
<a name="l00150"></a>00150   <span class="keywordflow">if</span> (<a class="code" href="classSortie.html#a7291aca32660e875543da1f0260b3773">bin_</a>)
<a name="l00151"></a>00151     {
<a name="l00152"></a>00152 <span class="comment">// On n&#39;ecrit pas les separateurs. Voir Sortie::operator&lt;&lt;(const Separateur&amp; ob)</span>
<a name="l00153"></a>00153       <a class="code" href="classEcrFicPartageMPIIO.html#aa5b14a5278a505867108051a2a584ff1">check</a>();
<a name="l00154"></a>00154     }
<a name="l00155"></a>00155   <span class="keywordflow">else</span>
<a name="l00156"></a>00156     {
<a name="l00157"></a>00157       <span class="keywordflow">if</span> (ob.<a class="code" href="classSeparateur.html#a52a1527f2491e0e5b7a2ebbe87d7c903">get_type</a>() == ob.<a class="code" href="classSeparateur.html#a106ba609d6c2f8fe68b04e797d521137a6fe582122578def6fba11ae4fbdec38e">ENDL</a>)
<a name="l00158"></a>00158         (*<span class="keyword">this</span>)&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00159"></a>00159       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ob.<a class="code" href="classSeparateur.html#a52a1527f2491e0e5b7a2ebbe87d7c903">get_type</a>() == ob.<a class="code" href="classSeparateur.html#a106ba609d6c2f8fe68b04e797d521137aabe5fe56826fb90ca06a76dc3f74c7ca">SPACE</a>)
<a name="l00160"></a>00160         (*<span class="keyword">this</span>)&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00161"></a>00161       <span class="keywordflow">else</span>
<a name="l00162"></a>00162         {
<a name="l00163"></a>00163           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Unknown separator in EcrFicPartageMPIIO::operator &lt;&lt;&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00164"></a>00164           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00165"></a>00165         }
<a name="l00166"></a>00166     }
<a name="l00167"></a>00167   <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00168"></a>00168 }
<a name="l00169"></a>00169 
<a name="l00170"></a><a class="code" href="classEcrFicPartageMPIIO.html#aae7a98c4713a6e85a6d16f543310bdb6">00170</a> <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classEcrFicPartageMPIIO.html#a962855d98e2d632d2b3a024004a39551">EcrFicPartageMPIIO::operator &lt;&lt;</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* ob)
<a name="l00171"></a>00171 {
<a name="l00172"></a>00172   <span class="keywordtype">int</span> size=strlen(ob) + 1;
<a name="l00173"></a>00173 <span class="comment">// int size=strlen(ob);</span>
<a name="l00174"></a>00174   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;size; i++)
<a name="l00175"></a>00175     <a class="code" href="classEcrFicPartageMPIIO.html#aa85a469d4da763232ad61072bcefedf9">write</a>(MPI_CHAR, &amp;ob[i]);
<a name="l00176"></a>00176   <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00177"></a>00177 }
<a name="l00178"></a><a class="code" href="classEcrFicPartageMPIIO.html#a2f19242499c4449ad73bc3054d9ac045">00178</a> <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classEcrFicPartageMPIIO.html#a962855d98e2d632d2b3a024004a39551">EcrFicPartageMPIIO::operator &lt;&lt;</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; ob)
<a name="l00179"></a>00179 {
<a name="l00180"></a>00180   <span class="keywordflow">if</span> (<a class="code" href="classSortie.html#a7291aca32660e875543da1f0260b3773">bin_</a>)
<a name="l00181"></a>00181     {
<a name="l00182"></a>00182 <span class="preprocessor">#ifdef INT_is_64_</span>
<a name="l00183"></a>00183 <span class="preprocessor"></span>      <a class="code" href="classEcrFicPartageMPIIO.html#aa85a469d4da763232ad61072bcefedf9">write</a>(MPI_LONG, &amp;ob);
<a name="l00184"></a>00184 <span class="preprocessor">#else</span>
<a name="l00185"></a>00185 <span class="preprocessor"></span>      <a class="code" href="classEcrFicPartageMPIIO.html#aa85a469d4da763232ad61072bcefedf9">write</a>(MPI_INT, &amp;ob);
<a name="l00186"></a>00186 <span class="preprocessor">#endif</span>
<a name="l00187"></a>00187 <span class="preprocessor"></span>    }
<a name="l00188"></a>00188   <span class="keywordflow">else</span>
<a name="l00189"></a>00189     (*<span class="keyword">this</span>)&lt;&lt;std::to_string(ob).c_str();
<a name="l00190"></a>00190   <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00191"></a>00191 }
<a name="l00192"></a><a class="code" href="classEcrFicPartageMPIIO.html#a745b7af46d0c398bd15431a001bdc9ec">00192</a> <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classEcrFicPartageMPIIO.html#a962855d98e2d632d2b3a024004a39551">EcrFicPartageMPIIO::operator &lt;&lt;</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span>&amp; ob)
<a name="l00193"></a>00193 {
<a name="l00194"></a>00194   <span class="keywordflow">if</span> (<a class="code" href="classSortie.html#a7291aca32660e875543da1f0260b3773">bin_</a>)
<a name="l00195"></a>00195     <a class="code" href="classEcrFicPartageMPIIO.html#aa85a469d4da763232ad61072bcefedf9">write</a>(MPI_UNSIGNED, &amp;ob);
<a name="l00196"></a>00196   <span class="keywordflow">else</span>
<a name="l00197"></a>00197     (*<span class="keyword">this</span>)&lt;&lt;std::to_string(ob).c_str();
<a name="l00198"></a>00198   <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00199"></a>00199 }
<a name="l00200"></a>00200 
<a name="l00201"></a><a class="code" href="classEcrFicPartageMPIIO.html#a8d5967a3da546c7156df4bb118eb494f">00201</a> <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classEcrFicPartageMPIIO.html#a962855d98e2d632d2b3a024004a39551">EcrFicPartageMPIIO::operator &lt;&lt;</a>(<span class="keyword">const</span> <span class="keywordtype">float</span>&amp; ob)
<a name="l00202"></a>00202 {
<a name="l00203"></a>00203   <span class="keywordflow">if</span> (<a class="code" href="classSortie.html#a7291aca32660e875543da1f0260b3773">bin_</a>)
<a name="l00204"></a>00204     <a class="code" href="classEcrFicPartageMPIIO.html#aa85a469d4da763232ad61072bcefedf9">write</a>(MPI_FLOAT, &amp;ob);
<a name="l00205"></a>00205   <span class="keywordflow">else</span>
<a name="l00206"></a>00206     (*<span class="keyword">this</span>)&lt;&lt;std::to_string(ob).c_str();
<a name="l00207"></a>00207   <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00208"></a>00208 }
<a name="l00209"></a><a class="code" href="classEcrFicPartageMPIIO.html#a8049090ae1f78b6c1177e46efadfbc7e">00209</a> <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classEcrFicPartageMPIIO.html#a962855d98e2d632d2b3a024004a39551">EcrFicPartageMPIIO::operator &lt;&lt;</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; ob)
<a name="l00210"></a>00210 {
<a name="l00211"></a>00211   <span class="keywordflow">if</span> (<a class="code" href="classSortie.html#a7291aca32660e875543da1f0260b3773">bin_</a>)
<a name="l00212"></a>00212     <a class="code" href="classEcrFicPartageMPIIO.html#aa85a469d4da763232ad61072bcefedf9">write</a>(MPI_DOUBLE, &amp;ob);
<a name="l00213"></a>00213   <span class="keywordflow">else</span>
<a name="l00214"></a>00214     (*<span class="keyword">this</span>)&lt;&lt;std::to_string(ob).c_str(); <span class="comment">//!&lt; ToDo utiliser sprintf</span>
<a name="l00215"></a>00215 <span class="comment"></span>  <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00216"></a>00216 }
<a name="l00217"></a><a class="code" href="classEcrFicPartageMPIIO.html#af8e9ee9875848f25ccc5359ca6191d1b">00217</a> <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classEcrFicPartageMPIIO.html#a962855d98e2d632d2b3a024004a39551">EcrFicPartageMPIIO::operator &lt;&lt;</a>(<span class="keyword">const</span> <a class="code" href="classObjet__U.html" title="classe Objet_U Cette classe est la classe de base des Objets de TRUST Dans les classes derivees de Ob...">Objet_U</a>&amp; ob)
<a name="l00218"></a>00218 {
<a name="l00219"></a>00219   ob.<a class="code" href="classObjet__U.html#a68f520bd9ba3e848370861d6610720b5" title="Ecriture de l&#39;objet sur un flot de sortie Methode a surcharger.">printOn</a>(*<span class="keyword">this</span>);
<a name="l00220"></a>00220   <a class="code" href="classEcrFicPartageMPIIO.html#aa5b14a5278a505867108051a2a584ff1">check</a>();
<a name="l00221"></a>00221   <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00222"></a>00222 }
<a name="l00223"></a>00223 
<a name="l00224"></a>00224 <span class="comment">// Function used for different MPI_Type</span>
<a name="l00225"></a>00225 <span class="comment">// Good info/examples on MPI-IO:</span>
<a name="l00226"></a>00226 <span class="comment">// See page 213: http://www.idris.fr/data/cours/parallel/mpi/IDRIS_MPI_cours_couleurs.pdf</span>
<a name="l00227"></a>00227 <span class="comment">// See http://www.cac.cornell.edu/ranger/mpiadvtopics/fileptroffs.aspx</span>
<a name="l00228"></a>00228 <span class="comment">// Default file view has etype=filetype=MPI_Byte and disp=0</span>
<a name="l00229"></a>00229 <span class="comment">// MPI_File_get_position returns a relative offset in etype units of the current view</span>
<a name="l00230"></a>00230 <span class="comment">// MPI_File_get_byte_offset converts a view relative offset (etype units) into an absolute byte position</span>
<a name="l00231"></a>00231 <span class="comment">// MPI_File_set_view(file,disp,etype,...) disp should be specified in absolute bytes from the start of the file</span>
<a name="l00232"></a>00232 <span class="comment">// sizeof(MPI_DOUBLE)=4 !!! Should use:MPI_Type_size( MPI_DOUBLE, &amp;size ) to return 8 !!!</span>
<a name="l00233"></a>00233 <span class="comment">// Ecriture d&#39;une zone memoire pointee par ob contenant n MPI_TYPE :</span>
<a name="l00234"></a><a class="code" href="classEcrFicPartageMPIIO.html#a72215126371910eff01e576cd8c325eb">00234</a> <span class="keywordtype">int</span> <a class="code" href="classEcrFicPartageMPIIO.html#af0d67f769e2908335b4093b53ebb5c3b" title="Methode de bas niveau pour ecrire un tableau d&#39;ints ou reels dans le stream. Dans l&#39;implementation de...">EcrFicPartageMPIIO::put</a>(MPI_Datatype MPI_TYPE, <span class="keyword">const</span> <span class="keywordtype">void</span>* ob, <span class="keywordtype">int</span> n)
<a name="l00235"></a>00235 {
<a name="l00236"></a>00236   MPI_Datatype etype;
<a name="l00237"></a>00237   etype=MPI_TYPE;
<a name="l00238"></a>00238   <a class="code" href="arch_8h.html#a1caaf369d9c5f0817dbaa76b43b8d87b">True_int</a> sizeof_etype;
<a name="l00239"></a>00239   MPI_Type_size(etype,&amp;sizeof_etype);
<a name="l00240"></a>00240 
<a name="l00241"></a>00241 <span class="comment">// filetype is n etype contigous:</span>
<a name="l00242"></a>00242   MPI_Datatype filetype;
<a name="l00243"></a>00243   MPI_Type_contiguous(n, etype, &amp;filetype);
<a name="l00244"></a>00244   MPI_Type_commit(&amp;filetype);
<a name="l00245"></a>00245 
<a name="l00246"></a>00246 <span class="comment">// Before collecting operations, update disp_ on all processes:</span>
<a name="l00247"></a>00247   <a class="code" href="communications_8cpp.html#a2335b36078ae87e23dab400a6e129a3c">envoyer_broadcast</a>(<a class="code" href="classEcrFicPartageMPIIO.html#ac08650f91ffc4ce09b64413aa4a06f19" title="Displacement of the individual pointers (in bytes)">disp_</a>, 0);
<a name="l00248"></a>00248   MPI_Offset disp_me = <a class="code" href="classEcrFicPartageMPIIO.html#ac08650f91ffc4ce09b64413aa4a06f19" title="Displacement of the individual pointers (in bytes)">disp_</a> + <a class="code" href="communications_8cpp.html#a13b5bdc7cfe14771b52a033b1ecbc071" title="Calul de la somme partielle de i sur les processeurs 0 a me()-1 (renvoie 0 sur le processeur 0)...">mppartial_sum</a>(n) * sizeof_etype;
<a name="l00249"></a>00249 <span class="comment">// ROMIO hints:</span>
<a name="l00250"></a>00250   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>()&gt;1024)
<a name="l00251"></a>00251     {
<a name="l00252"></a>00252       <span class="keywordtype">char</span>* ROMIO_HINTS=getenv(<span class="stringliteral">&quot;ROMIO_HINTS&quot;</span>);
<a name="l00253"></a>00253       <span class="keywordflow">if</span> (ROMIO_HINTS==NULL)
<a name="l00254"></a>00254         {
<a name="l00255"></a>00255           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Warning, no ROMIO_HINTS detected on your massive parallel calculation.&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00256"></a>00256           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Performances of MPI I/O could be improved with ROMIO hints.&quot;</span> &lt;&lt; finl;
<a name="l00257"></a>00257           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Contact TRUST support.&quot;</span> &lt;&lt; finl;
<a name="l00258"></a>00258         }
<a name="l00259"></a>00259     }
<a name="l00260"></a>00260 
<a name="l00261"></a>00261 <span class="comment">// Create info for using hints:</span>
<a name="l00262"></a>00262   MPI_Info mpi_info;
<a name="l00263"></a>00263   MPI_Info_create(&amp;mpi_info);
<a name="l00264"></a>00264   <span class="comment">/*</span>
<a name="l00265"></a>00265 <span class="comment">  MPI_Info_set(mpi_info, &quot;romio_cb_read&quot;, &quot;enable&quot;);</span>
<a name="l00266"></a>00266 <span class="comment">  MPI_Info_set(mpi_info, &quot;romio_cb_write&quot;, &quot;enable&quot;);</span>
<a name="l00267"></a>00267 <span class="comment">  // Un processus par node s&#39;occupe du buffering:</span>
<a name="l00268"></a>00268 <span class="comment">  MPI_Info_set(mpi_info, &quot;cb_config_list&quot;, &quot;*:1&quot;);</span>
<a name="l00269"></a>00269 <span class="comment"></span>
<a name="l00270"></a>00270 <span class="comment">  // Striping count (max 160 sur LUSTRE):</span>
<a name="l00271"></a>00271 <span class="comment">  Nom striping_factor=(Nom)min(Process::nproc(),160);</span>
<a name="l00272"></a>00272 <span class="comment">  MPI_Info_set(mpi_info, &quot;striping_factor&quot;, (char*)striping_factor.getChar());</span>
<a name="l00273"></a>00273 <span class="comment"></span>
<a name="l00274"></a>00274 <span class="comment">  // Striping units in bytes (ideal is stripe size = I/O operations):</span>
<a name="l00275"></a>00275 <span class="comment">  Nom striping_unit=(Nom)(n * sizeof_etype);</span>
<a name="l00276"></a>00276 <span class="comment">  MPI_Info_set(mpi_info, &quot;striping_unit&quot;, (char*)striping_unit.getChar());</span>
<a name="l00277"></a>00277 <span class="comment">// Example (not used cause machine dependant):</span>
<a name="l00278"></a>00278 <span class="comment">  */</span>
<a name="l00279"></a>00279 
<a name="l00280"></a>00280 <span class="comment">// Set a new view:</span>
<a name="l00281"></a>00281   MPI_File_set_view(<a class="code" href="classEcrFicPartageMPIIO.html#a704e07b69e0ff707b8c9efbce1931da8">mpi_file_</a>, disp_me, etype, filetype, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;native&quot;</span>, mpi_info);
<a name="l00282"></a>00282 
<a name="l00283"></a>00283 <span class="comment">// Write all:</span>
<a name="l00284"></a>00284   <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#affcd058809786918ed173aaf681d0843">begin_count</a>(IO_EcrireFicPartageMPIIO_counter_);
<a name="l00285"></a>00285   MPI_File_write_all(<a class="code" href="classEcrFicPartageMPIIO.html#a704e07b69e0ff707b8c9efbce1931da8">mpi_file_</a>, (<span class="keywordtype">void</span>*)ob, n, etype, MPI_STATUS_IGNORE);
<a name="l00286"></a>00286   <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a0faf52d1b518f5b0b2177f22efcc222d" title="Arret du compteur counter_id. On ajoute quantity a la somme des &#39;quantity&#39; (par defaut 0) stockees po...">end_count</a>(IO_EcrireFicPartageMPIIO_counter_, n * sizeof_etype);
<a name="l00287"></a>00287 
<a name="l00288"></a>00288 <span class="comment">// Update the position of the pointer file:</span>
<a name="l00289"></a>00289   <a class="code" href="classEcrFicPartageMPIIO.html#ac08650f91ffc4ce09b64413aa4a06f19" title="Displacement of the individual pointers (in bytes)">disp_</a>+=<a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">mp_sum</a>(n) * sizeof_etype;
<a name="l00290"></a>00290 
<a name="l00291"></a>00291 <span class="comment">// Reset a simple view at this new position:</span>
<a name="l00292"></a>00292   MPI_File_set_view(<a class="code" href="classEcrFicPartageMPIIO.html#a704e07b69e0ff707b8c9efbce1931da8">mpi_file_</a>, <a class="code" href="classEcrFicPartageMPIIO.html#ac08650f91ffc4ce09b64413aa4a06f19" title="Displacement of the individual pointers (in bytes)">disp_</a>, MPI_BYTE, MPI_BYTE, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;native&quot;</span>, MPI_INFO_NULL);
<a name="l00293"></a>00293 
<a name="l00294"></a>00294 <span class="comment">// Free</span>
<a name="l00295"></a>00295   MPI_Info_free(&amp;mpi_info);
<a name="l00296"></a>00296   MPI_Type_free(&amp;filetype);
<a name="l00297"></a>00297   <span class="keywordflow">return</span> 1;
<a name="l00298"></a>00298 }
<a name="l00299"></a>00299 
<a name="l00300"></a>00300 <span class="preprocessor">#endif</span>
<a name="l00301"></a>00301 <span class="preprocessor"></span>
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:26 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
