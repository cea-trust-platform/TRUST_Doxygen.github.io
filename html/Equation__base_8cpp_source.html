<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/Kernel/Framework/Equation_base.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/Kernel/Framework/Equation_base.cpp</div>  </div>
</div>
<div class="contents">
<a href="Equation__base_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (c) 2021, CEA</span>
<a name="l00003"></a>00003 <span class="comment">* All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment">* 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00007"></a>00007 <span class="comment">* 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00008"></a>00008 <span class="comment">* 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<a name="l00011"></a>00011 <span class="comment">* IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;</span>
<a name="l00012"></a>00012 <span class="comment">* OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// File:        Equation_base.cpp</span>
<a name="l00018"></a>00018 <span class="comment">// Directory:   $TRUST_ROOT/src/Kernel/Framework</span>
<a name="l00019"></a>00019 <span class="comment">// Version:     /main/131</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;<a class="code" href="Equation__base_8h.html">Equation_base.h</a>&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="Milieu__base_8h.html">Milieu_base.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="Operateur__base_8h.html">Operateur_base.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="Operateur__Conv__base_8h.html">Operateur_Conv_base.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="Op__Conv__negligeable_8h.html">Op_Conv_negligeable.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="Operateur__Diff__base_8h.html">Operateur_Diff_base.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="Operateur_8h.html">Operateur.h</a>&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;<a class="code" href="Avanc_8h.html">Avanc.h</a>&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;<a class="code" href="Debog_8h.html">Debog.h</a>&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;<a class="code" href="Matrice__Morse__Sym_8h.html">Matrice_Morse_Sym.h</a>&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;<a class="code" href="Discretisation__base_8h.html">Discretisation_base.h</a>&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;<a class="code" href="Frontiere__dis__base_8h.html">Frontiere_dis_base.h</a>&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;<a class="code" href="DoubleTrav_8h.html">DoubleTrav.h</a>&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;<a class="code" href="Postraitement_8h.html">Postraitement.h</a>&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;<a class="code" href="EChaine_8h.html">EChaine.h</a>&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;<a class="code" href="Schema__Euler__explicite_8h.html">Schema_Euler_explicite.h</a>&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;<a class="code" href="Parametre__diffusion__implicite_8h.html">Parametre_diffusion_implicite.h</a>&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;<a class="code" href="Matrice__Morse__Diag_8h.html">Matrice_Morse_Diag.h</a>&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;<a class="code" href="Statistiques_8h.html">Statistiques.h</a>&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;<a class="code" href="Param_8h.html">Param.h</a>&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;<a class="code" href="Source__dep__inco__base_8h.html">Source_dep_inco_base.h</a>&gt;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;<a class="code" href="SolveurSys_8h.html">SolveurSys.h</a>&gt;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &lt;<a class="code" href="Zone__VF_8h.html">Zone_VF.h</a>&gt;</span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="keyword">extern</span> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="Equation__base_8cpp.html#a918aa9eada292ff09f7d2959342d3c2c">assemblage_sys_counter_</a>;
<a name="l00048"></a>00048 <span class="keyword">extern</span> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> <a class="code" href="Equation__base_8cpp.html#a2168c1792848c3548a21e9cd4aaf1747">diffusion_implicite_counter_</a>;
<a name="l00049"></a>00049 
<a name="l00050"></a><a class="code" href="Equation__base_8cpp.html#ac9fed871e4d296df4357fd32687f407f">00050</a> <a class="code" href="MacList_8h.html#a261e70524a054683e3b6c94c8ccbc396">Implemente_liste</a>(<a class="code" href="classRef__Objet__U.html">RefObjU</a>);
<a name="l00051"></a><a class="code" href="Equation__base_8cpp.html#a630b465230f0eb2912992b21105c0f3e">00051</a> <a class="code" href="Declare__Base_8h.html#a279604f97959498f17b67e986dfd4486">Implemente_base_sans_constructeur</a>(<a class="code" href="classEquation__base.html">Equation_base</a>,<span class="stringliteral">&quot;Equation_base&quot;</span>,<a class="code" href="classObjet__U.html" title="classe Objet_U Cette classe est la classe de base des Objets de TRUST Dans les classes derivees de Ob...">Objet_U</a>);
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="classEquation__base.html#ada73903389e9d43c52103e1b85645486">00053</a> <a class="code" href="classEquation__base.html#ada73903389e9d43c52103e1b85645486">Equation_base::Equation_base</a>()
<a name="l00054"></a>00054 {
<a name="l00055"></a>00055   <a class="code" href="classEquation__base.html#a606243b3895f9ef07dae37d964a8aaf6">nombre_champ_xyz</a>=0;
<a name="l00056"></a>00056   <a class="code" href="classEquation__base.html#a07f581d7c79a1e35f16f79bf07fdd1a8">ecrit_champ_xyz_bin</a>=0;
<a name="l00057"></a>00057   <a class="code" href="classEquation__base.html#afd09d18db565d1acb431885b9c6d4a55">sys_invariant_</a>=1;
<a name="l00058"></a>00058   <a class="code" href="classEquation__base.html#aef791a4afd5964d1b4dfd3d2ac3f5e5e">implicite_</a>=-1;
<a name="l00059"></a>00059   <a class="code" href="classEquation__base.html#ad687c312e72dcbc783cf597af5927b07">champs_compris_</a>.<a class="code" href="classChamps__compris.html#a6bf07487654d24d9683955140ea44054">ajoute_nom_compris</a>(<span class="stringliteral">&quot;volume_maille&quot;</span>);
<a name="l00060"></a>00060   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> expr_equation_non_resolue=<span class="stringliteral">&quot;0&quot;</span>;
<a name="l00061"></a>00061   <a class="code" href="classEquation__base.html#a703d3eb6a7f5ba12178528d16ca9a90c">equation_non_resolue_</a>.<a class="code" href="classParser__U.html#a3ff44eabf641cbcea9ca59f84167e2c1">setNbVar</a>(1);
<a name="l00062"></a>00062   <a class="code" href="classEquation__base.html#a703d3eb6a7f5ba12178528d16ca9a90c">equation_non_resolue_</a>.<a class="code" href="classParser__U.html#a25d581b85688da391aa64117abf0a073">setString</a>(expr_equation_non_resolue); <span class="comment">//!&lt; Valeur par defaut, equation resolue</span>
<a name="l00063"></a>00063 <span class="comment"></span>  <a class="code" href="classEquation__base.html#a703d3eb6a7f5ba12178528d16ca9a90c">equation_non_resolue_</a>.<a class="code" href="classParser__U.html#ae216b7daee6c4bb756423ffed5674293">addVar</a>(<span class="stringliteral">&quot;t&quot;</span>);
<a name="l00064"></a>00064   <a class="code" href="classEquation__base.html#a703d3eb6a7f5ba12178528d16ca9a90c">equation_non_resolue_</a>.<a class="code" href="classParser__U.html#a441c2fd29f5d4370c0c7b6a1cdfe56d5">parseString</a>();
<a name="l00065"></a>00065   <a class="code" href="classEquation__base.html#a41239f371a7cb76961220ffd3f5b8f34">set_calculate_time_derivative</a>(0);
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 }
<a name="l00068"></a>00068 
<a name="l00069"></a><a class="code" href="classEquation__base.html#a0a497f27296625af895ffe40e48d109e">00069</a> <span class="keywordtype">int</span> <a class="code" href="classEquation__base.html#a0a497f27296625af895ffe40e48d109e">Equation_base::equation_non_resolue</a>()<span class="keyword"> const</span>
<a name="l00070"></a>00070 <span class="keyword"></span>{
<a name="l00071"></a>00071   <span class="keywordtype">double</span> t = <a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>-&gt;temps_courant();
<a name="l00072"></a>00072   <a class="code" href="classEquation__base.html#a703d3eb6a7f5ba12178528d16ca9a90c">equation_non_resolue_</a>.<a class="code" href="classParser__U.html#a13c377b32b6c3ced39a14f83f94a8828">setVar</a>(<span class="stringliteral">&quot;t&quot;</span>,t);
<a name="l00073"></a>00073   <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)<a class="code" href="classEquation__base.html#a703d3eb6a7f5ba12178528d16ca9a90c">equation_non_resolue_</a>.<a class="code" href="classParser__U.html#a61605bc1b85e466f884f1739e811b6b4">eval</a>() ;
<a name="l00074"></a>00074 }
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 <span class="comment">// Precondition: une zone discretisee doit avoir ete associee a l&#39;equation.</span>
<a name="l00077"></a>00077 <span class="comment">// Parametre:</span>
<a name="l00078"></a>00078 <span class="comment">// Signification:</span>
<a name="l00079"></a>00079 <span class="comment">// Valeurs par defaut:</span>
<a name="l00080"></a>00080 <span class="comment">// Contraintes:</span>
<a name="l00081"></a>00081 <span class="comment">// Acces:</span>
<a name="l00082"></a>00082 <span class="comment">// Exception: l&#39;objet zone discretisee (Zone_dis) est invalide,</span>
<a name="l00083"></a>00083 <span class="comment">// probleme associe non discretise.</span>
<a name="l00084"></a>00084 <span class="comment">// Effets de bord:</span>
<a name="l00085"></a>00085 <span class="comment">// Postcondition:</span>
<a name="l00086"></a>00086 <span class="comment">//</span><span class="comment"></span>
<a name="l00087"></a>00087 <span class="comment">//! Renvoie la zone discretisee associee a l&#39;equation.</span>
<a name="l00088"></a>00088 <span class="comment"></span><span class="comment">/** \return Zone_dis\&amp;&lt;br&gt;</span>
<a name="l00089"></a>00089 <span class="comment">Signification: la zone discretisee asscoiee a l&#39;equation&lt;br&gt;</span>
<a name="l00090"></a>00090 <span class="comment">Contraintes: */</span>
<a name="l00091"></a><a class="code" href="classEquation__base.html#a12d97ae801edc18f614523677921346e">00091</a> <a class="code" href="classZone__dis.html" title="classe Zone_dis Classe generique de la hierarchie des zones discretisees. Un objet de type Zone_dis p...">Zone_dis</a>&amp; <a class="code" href="classEquation__base.html#a12d97ae801edc18f614523677921346e" title="Renvoie la zone discretisee associee a l&#39;equation.">Equation_base::zone_dis</a>()
<a name="l00092"></a>00092 {
<a name="l00093"></a>00093   <span class="keywordflow">if</span> (!<a class="code" href="classEquation__base.html#a645ff38d42bb7005e0950888099b6916">la_zone_dis</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>())
<a name="l00094"></a>00094     {
<a name="l00095"></a>00095       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;There is no object of type Zone_dis yet associated to the equation &quot;</span> &lt;&lt; <a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00096"></a>00096       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;This means that the problem has not been discretized or&quot;</span> &lt;&lt; finl;
<a name="l00097"></a>00097       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;that instruction Discretiser is misplaced&quot;</span> &lt;&lt; finl;
<a name="l00098"></a>00098       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00099"></a>00099     }
<a name="l00100"></a>00100   <span class="keywordflow">return</span> <a class="code" href="classEquation__base.html#a645ff38d42bb7005e0950888099b6916">la_zone_dis</a>.<a class="code" href="classRef__Zone__dis.html#abbf8a6b03587574fb62173564d98779e">valeur</a>();
<a name="l00101"></a>00101 }
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 <span class="comment">// Precondition: une zone discretisee doit avoir ete associee a l&#39;equation.</span>
<a name="l00104"></a>00104 <span class="comment">// Parametre:</span>
<a name="l00105"></a>00105 <span class="comment">// Signification:</span>
<a name="l00106"></a>00106 <span class="comment">// Valeurs par defaut:</span>
<a name="l00107"></a>00107 <span class="comment">// Contraintes:</span>
<a name="l00108"></a>00108 <span class="comment">// Acces:</span>
<a name="l00109"></a>00109 <span class="comment">// Exception: l&#39;objet zone discretisee (Zone_dis) est invalide,</span>
<a name="l00110"></a>00110 <span class="comment">// probleme associe non discretise.</span>
<a name="l00111"></a>00111 <span class="comment">// Effets de bord:</span>
<a name="l00112"></a>00112 <span class="comment">// Postcondition: la methode ne modifie pas l&#39;objet</span>
<a name="l00113"></a>00113 <span class="comment">//</span>
<a name="l00114"></a>00114 <span class="comment">//</span><span class="comment"></span>
<a name="l00115"></a>00115 <span class="comment">//! Renvoie la zone discretisee associee a l&#39;equation.&lt;br&gt;(version const)</span>
<a name="l00116"></a>00116 <span class="comment"></span><span class="comment">/** \return Zone_dis\&amp;&lt;br&gt;</span>
<a name="l00117"></a>00117 <span class="comment">Signification: la zone discretisee asssociee a l&#39;equation&lt;br&gt;</span>
<a name="l00118"></a>00118 <span class="comment">Contraintes: reference constante */</span>
<a name="l00119"></a><a class="code" href="classEquation__base.html#ae6aa094f1ffe92d6e09ecebc7eb91ca7">00119</a> <span class="keyword">const</span> <a class="code" href="classZone__dis.html" title="classe Zone_dis Classe generique de la hierarchie des zones discretisees. Un objet de type Zone_dis p...">Zone_dis</a>&amp; <a class="code" href="classEquation__base.html#a12d97ae801edc18f614523677921346e" title="Renvoie la zone discretisee associee a l&#39;equation.">Equation_base::zone_dis</a>()<span class="keyword"> const</span>
<a name="l00120"></a>00120 <span class="keyword"></span>{
<a name="l00121"></a>00121   <span class="keywordflow">if</span> (!<a class="code" href="classEquation__base.html#a645ff38d42bb7005e0950888099b6916">la_zone_dis</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>())
<a name="l00122"></a>00122     {
<a name="l00123"></a>00123       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;There is no object of type Zone_dis associated to the equation &quot;</span> &lt;&lt; <a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00124"></a>00124       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;This means that the problem has not been discretized&quot;</span> &lt;&lt; finl;
<a name="l00125"></a>00125       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00126"></a>00126     }
<a name="l00127"></a>00127   assert(<a class="code" href="classEquation__base.html#a645ff38d42bb7005e0950888099b6916">la_zone_dis</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>());
<a name="l00128"></a>00128   <span class="keywordflow">return</span> <a class="code" href="classEquation__base.html#a645ff38d42bb7005e0950888099b6916">la_zone_dis</a>.<a class="code" href="classRef__Zone__dis.html#abbf8a6b03587574fb62173564d98779e">valeur</a>();
<a name="l00129"></a>00129 }
<a name="l00130"></a>00130 
<a name="l00131"></a>00131 
<a name="l00132"></a>00132 <span class="comment">// Precondition:</span>
<a name="l00133"></a>00133 <span class="comment">// Parametre:</span>
<a name="l00134"></a>00134 <span class="comment">// Signification:</span>
<a name="l00135"></a>00135 <span class="comment">// Valeurs par defaut:</span>
<a name="l00136"></a>00136 <span class="comment">// Contraintes:</span>
<a name="l00137"></a>00137 <span class="comment">// Acces:</span>
<a name="l00138"></a>00138 <span class="comment">// </span>
<a name="l00139"></a>00139 <span class="comment">// Signification:</span>
<a name="l00140"></a>00140 <span class="comment">// Contraintes:</span>
<a name="l00141"></a>00141 <span class="comment">// Exception:</span>
<a name="l00142"></a>00142 <span class="comment">// Effets de bord:</span>
<a name="l00143"></a>00143 <span class="comment">// Postcondition: l&#39;equation est completee</span>
<a name="l00144"></a>00144 <span class="comment">//</span>
<a name="l00145"></a>00145 <span class="comment">//</span>
<a name="l00146"></a>00146 <span class="comment">//</span>
<a name="l00147"></a>00147 <span class="comment">//</span>
<a name="l00148"></a>00148 <span class="comment">//</span>
<a name="l00149"></a>00149 <span class="comment">//</span>
<a name="l00150"></a>00150 <span class="comment">//</span>
<a name="l00151"></a>00151 <span class="comment">//</span><span class="comment"></span>
<a name="l00152"></a>00152 <span class="comment">//! Complete la construction (initialisation) des objets associes a&lt;br&gt;l&#39;equation.&lt;br&gt;Complete les sources, associe l&#39;equation a l&#39;inconnue complete les&lt;br&gt;operateurs, complete les conditions aux limites discretisees.&lt;br&gt;Voir les methodes Source_base::completer(),&lt;br&gt;Operateur_base::completer()&lt;br&gt;Zone_Cl_dis_base::completer()&lt;br&gt;Zone_Cl_dis_base::completer(const Zone_dis\&amp; )</span>
<a name="l00153"></a><a class="code" href="classEquation__base.html#a68c77bfc9fb39474ddc481495710c40e">00153</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#a68c77bfc9fb39474ddc481495710c40e" title="Complete la construction (initialisation) des objets associes a l&#39;equation. Complete les sources...">Equation_base::completer</a>()
<a name="l00154"></a>00154 {
<a name="l00155"></a>00155   <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().<a class="code" href="classChamp__Inc.html#aa6febd6d77fcb0d182b368f6f2c26b2e" title="Appel a l&#39;objet sous-jacent Associe le champ a l&#39;equation dont il est une inconnue.">associer_eqn</a>(*<span class="keyword">this</span>);
<a name="l00156"></a>00156   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#aa097c6ddc00bdb913c39739689f6d5c4">la_zone_Cl_dis</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>())
<a name="l00157"></a>00157     <a class="code" href="classEquation__base.html#aa097c6ddc00bdb913c39739689f6d5c4">la_zone_Cl_dis</a>-&gt;completer();
<a name="l00158"></a>00158 
<a name="l00159"></a>00159   <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>()-&gt;associer_zone_cl_dis(<a class="code" href="classEquation__base.html#aa097c6ddc00bdb913c39739689f6d5c4">la_zone_Cl_dis</a>);
<a name="l00160"></a>00160 
<a name="l00161"></a>00161   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#ae2d5662d4d26ee7ebefa134239109275">mon_probleme</a>.<a class="code" href="classRef__Probleme__base.html#ae8c315c3e3321e765a5ca9c27e6322b5">valeur</a>().<a class="code" href="classProbleme__base.html#a339bf5b4250095c740c218e8a1c17b24">get_coupled</a>())
<a name="l00162"></a>00162     {
<a name="l00163"></a>00163       <span class="keywordtype">bool</span> err = <span class="keyword">false</span>;
<a name="l00164"></a>00164       <span class="keywordtype">int</span> nb_cl = <a class="code" href="classEquation__base.html#aa097c6ddc00bdb913c39739689f6d5c4">la_zone_Cl_dis</a>-&gt;<a class="code" href="classZone__Cl__dis.html#a7e0c9938057e7d427eea4954dd7bad58" title="Appel a l&#39;objet sous-jacent Renvoie le nombre de conditions aux limites.">nb_cond_lim</a>();
<a name="l00165"></a>00165       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nb_cl; i++)
<a name="l00166"></a>00166         {
<a name="l00167"></a>00167           <span class="keyword">const</span> <a class="code" href="classCond__lim__base.html" title="classe Cond_lim_base Classe de base pour la hierarchie des classes qui representent les differentes c...">Cond_lim_base</a>&amp; la_cl = <a class="code" href="classEquation__base.html#aa097c6ddc00bdb913c39739689f6d5c4">la_zone_Cl_dis</a>.<a class="code" href="classDeriv__Zone__Cl__dis__base.html#a6b56880f00b604e1f13970ec6d5bc077">valeur</a>().<a class="code" href="classZone__Cl__dis__base.html#af75e0ed7786863e4d333bfb29d67c323" title="Renvoie la i-ieme condition aux limites. (version const)">les_conditions_limites</a>(i);
<a name="l00168"></a>00168           <span class="keyword">const</span> <a class="code" href="classFrontiere.html" title="Classe Frontiere. Une Frontiere decrit une partie de la frontiere d&#39;une Zone, elle possede un Nom...">Frontiere</a>&amp; la_frontiere = la_cl.<a class="code" href="classCond__lim__base.html#ad88b3b516351146c85e8fce1df0f691a" title="Renvoie la frontiere discretisee a laquelle les conditions aux limites s&#39;appliquent.">frontiere_dis</a>().<a class="code" href="classFrontiere__dis__base.html#a95f81b046cd23c8c8083ae03eebe93cd" title="Renvoie la frontiere geometrique associee. (version const)">frontiere</a>();
<a name="l00169"></a>00169 
<a name="l00170"></a>00170           <span class="keywordtype">bool</span> raccord_found = <span class="keyword">false</span>;
<a name="l00171"></a>00171 
<a name="l00172"></a>00172 <span class="comment">// VDF and polymac</span>
<a name="l00173"></a>00173           <span class="keywordflow">if</span> (la_cl.<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>().<a class="code" href="classNom.html#a41b0ba18fb90d481c0828ed4372de8ee">debute_par</a>(<span class="stringliteral">&quot;Paroi_Echange_contact&quot;</span>) || la_cl.<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>().<a class="code" href="classNom.html#a41b0ba18fb90d481c0828ed4372de8ee">debute_par</a>(<span class="stringliteral">&quot;Echange_contact_Rayo&quot;</span>))
<a name="l00174"></a>00174             raccord_found = <span class="keyword">true</span>;
<a name="l00175"></a>00175 
<a name="l00176"></a>00176 <span class="comment">// VEF</span>
<a name="l00177"></a>00177           <span class="keywordflow">if</span> (la_cl.<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>().<a class="code" href="classNom.html#a41b0ba18fb90d481c0828ed4372de8ee">debute_par</a>(<span class="stringliteral">&quot;Scalaire_impose_paroi&quot;</span>) || la_cl.<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>().<a class="code" href="classNom.html#a41b0ba18fb90d481c0828ed4372de8ee">debute_par</a>(<span class="stringliteral">&quot;paroi_temperature_imposee_rayo&quot;</span>) || la_cl.<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>().<a class="code" href="classNom.html#a41b0ba18fb90d481c0828ed4372de8ee">debute_par</a>(<span class="stringliteral">&quot;temperature_imposee_paroi&quot;</span>))
<a name="l00178"></a>00178             raccord_found = <span class="keyword">true</span>;
<a name="l00179"></a>00179 
<a name="l00180"></a>00180           <span class="keywordflow">if</span> ( raccord_found &amp;&amp; !<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classRaccord__base.html" title="Classe Raccord_base Cette classe est simplement une frontiere, c&#39;est la classe de base de la hierarch...">Raccord_base</a>,la_frontiere))
<a name="l00181"></a>00181             {
<a name="l00182"></a>00182               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;====================================================================&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00183"></a>00183               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Boundary &quot;</span> &lt;&lt; la_frontiere.<a class="code" href="classFrontiere.html#a2868774681d6f050479a95cbc7cd6fc9" title="Renvoie le nom de la frontiere.">le_nom</a>() &lt;&lt; <span class="stringliteral">&quot; should be a raccord&quot;</span> &lt;&lt; finl;
<a name="l00184"></a>00184               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Add in your data file between the definition and the partition of the domain &quot;</span> &lt;&lt; <a class="code" href="classEquation__base.html#ae2d5662d4d26ee7ebefa134239109275">mon_probleme</a>.<a class="code" href="classRef__Probleme__base.html#ae8c315c3e3321e765a5ca9c27e6322b5">valeur</a>().<a class="code" href="classProbleme__base.html#afa73c54a5b6b111e0f08cd1ab3608178" title="Renvoie le domaine associe au probleme. (version const)">domaine</a>().<a class="code" href="classDomaine.html#a87e2cdc035a26565e6fe481446aa4cd3" title="Renvoie le nom du domaine.">le_nom</a>() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; finl;
<a name="l00185"></a>00185               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Modif_bord_to_raccord &quot;</span> &lt;&lt; <a class="code" href="classEquation__base.html#ae2d5662d4d26ee7ebefa134239109275">mon_probleme</a>.<a class="code" href="classRef__Probleme__base.html#ae8c315c3e3321e765a5ca9c27e6322b5">valeur</a>().<a class="code" href="classProbleme__base.html#afa73c54a5b6b111e0f08cd1ab3608178" title="Renvoie le domaine associe au probleme. (version const)">domaine</a>().<a class="code" href="classDomaine.html#a87e2cdc035a26565e6fe481446aa4cd3" title="Renvoie le nom du domaine.">le_nom</a>() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; la_frontiere.<a class="code" href="classFrontiere.html#a2868774681d6f050479a95cbc7cd6fc9" title="Renvoie le nom de la frontiere.">le_nom</a>() &lt;&lt; finl;
<a name="l00186"></a>00186               err = <span class="keyword">true</span>;
<a name="l00187"></a>00187             }
<a name="l00188"></a>00188         }
<a name="l00189"></a>00189       <span class="keywordflow">if</span>(err)
<a name="l00190"></a>00190         <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00191"></a>00191     }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193 <span class="comment">// Ajout d un element vide qui sera renvoye si pas de modele trouve</span>
<a name="l00194"></a>00194   <a class="code" href="classRef__Objet__U.html">RefObjU</a> mod;
<a name="l00195"></a>00195   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#abd4950a31ce927d094563bc6cd55cb0b">liste_modeles_</a>.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>()==0)
<a name="l00196"></a>00196     <a class="code" href="classEquation__base.html#abd4950a31ce927d094563bc6cd55cb0b">liste_modeles_</a>.<a class="code" href="classList__RefObjU.html#a81836e2ac89d324c53695f0930c2e8e6">add</a>(mod);
<a name="l00197"></a>00197 
<a name="l00198"></a>00198 <span class="comment">// pour les eqns n&#39;appelant pas preparer_calcul</span>
<a name="l00199"></a>00199   <a class="code" href="classEquation__base.html#a888dc3f8eb5fb54b05250b6b704a6997">initialise_residu</a>();
<a name="l00200"></a>00200   <span class="keywordtype">int</span> nb_op=<a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>();
<a name="l00201"></a>00201   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> msg=<span class="stringliteral">&quot;Equation_base::completer(), nb_op = &quot;</span> ;
<a name="l00202"></a>00202   <a class="code" href="Op__Div__VEFP1B__Elem_8cpp.html#a45261662b3b88d5db461b3fc99246e5a">Debog::verifier</a>(msg, nb_op);
<a name="l00203"></a>00203   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;nb_op; i++)
<a name="l00204"></a>00204     <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).<a class="code" href="classOperateur.html#ac40f77a68a1959a5d37b5b2e45b40571" title="Met a jour les references des objets associes a l&#39;operateur. Operateur::le_champ_inco, Operateur::champ_inco Appelle Operateur_base::completer()">completer</a>();
<a name="l00205"></a>00205 
<a name="l00206"></a>00206   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#adfedf474c07a92f6b2261ca2f1cee80e" title="Renvoie le solveur de masse associe a l&#39;equation.">solv_masse</a>().non_nul())  <span class="comment">//!&lt; [ABN]: In case of Front-Tracking, mass solver mass might be uninitialized ...</span>
<a name="l00207"></a>00207 <span class="comment"></span>    <a class="code" href="classEquation__base.html#adfedf474c07a92f6b2261ca2f1cee80e" title="Renvoie le solveur de masse associe a l&#39;equation.">solv_masse</a>().<a class="code" href="classDeriv__Solveur__Masse__base.html#ad9c6d7581b1979f3acb81c4d3da49edf">valeur</a>().<a class="code" href="classSolveur__Masse__base.html#af2606936ed80fd03e2d17a74276a64e9">completer</a>();
<a name="l00208"></a>00208 
<a name="l00209"></a>00209   <a class="code" href="classEquation__base.html#a6dae2cb8a228b0e3a6d90042fd75f360">les_sources</a>.<a class="code" href="classSources.html#ac938e21c6fe9f5bb9f0dc304eb2267dc" title="Appelle Source::completer() sur toutes les sources de la liste. voir Source_base::completer().">completer</a>();
<a name="l00210"></a>00210   <a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#af7184469580a32593530c8dff9d01af2">completer</a>();
<a name="l00211"></a>00211 
<a name="l00212"></a>00212 <span class="comment">// Determine implicite_ and sys_invariant_ variables:</span>
<a name="l00213"></a>00213   <a class="code" href="classEquation__base.html#aef791a4afd5964d1b4dfd3d2ac3f5e5e">implicite_</a>=0;
<a name="l00214"></a>00214   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>(); i++)
<a name="l00215"></a>00215     {
<a name="l00216"></a>00216       <span class="keywordflow">if</span>(<a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#ae7dae6829b1287b470717b08a8ae761e">get_decal_temps</a>()==1)
<a name="l00217"></a>00217         {
<a name="l00218"></a>00218           ++<a class="code" href="classEquation__base.html#aef791a4afd5964d1b4dfd3d2ac3f5e5e">implicite_</a>;
<a name="l00219"></a>00219           <a class="code" href="classEquation__base.html#afd09d18db565d1acb431885b9c6d4a55">sys_invariant_</a>*=<a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#a3af3295e8dd3b34cfc3640f45a47fe76">systeme_invariant</a>();
<a name="l00220"></a>00220         }
<a name="l00221"></a>00221     }
<a name="l00222"></a>00222 }
<a name="l00223"></a>00223 
<a name="l00224"></a>00224 
<a name="l00225"></a>00225 <span class="comment">// Precondition: le flot doit etre ouvert</span>
<a name="l00226"></a>00226 <span class="comment">// Parametre: Sortie&amp; os</span>
<a name="l00227"></a>00227 <span class="comment">// Signification: un flot de sortie</span>
<a name="l00228"></a>00228 <span class="comment">// Valeurs par defaut:</span>
<a name="l00229"></a>00229 <span class="comment">// Contraintes:</span>
<a name="l00230"></a>00230 <span class="comment">// Acces: entree/sortie</span>
<a name="l00231"></a>00231 <span class="comment">// Exception:</span>
<a name="l00232"></a>00232 <span class="comment">// Effets de bord: le flot de sortie est modifie</span>
<a name="l00233"></a>00233 <span class="comment">// Postcondition: la methode ne modifie pas l&#39;objet</span>
<a name="l00234"></a>00234 <span class="comment">//</span>
<a name="l00235"></a>00235 <span class="comment">//</span>
<a name="l00236"></a>00236 <span class="comment">//</span>
<a name="l00237"></a>00237 <span class="comment">//</span><span class="comment"></span>
<a name="l00238"></a>00238 <span class="comment">//! Surcharge Objet_U::printOn&lt;br&gt;Imprime l&#39;equation et ses composants sur un flot de sortie.&lt;br&gt;Imprime le nom de l&#39;equation, le solveur masse, les termes sources&lt;br&gt;les conditions aux limites discretisees, les inconnues et les operateurs.</span>
<a name="l00239"></a>00239 <span class="comment"></span><span class="comment">/** \return Sortie\&amp;&lt;br&gt;</span>
<a name="l00240"></a>00240 <span class="comment">Signification: le flot de sortie modifie&lt;br&gt;</span>
<a name="l00241"></a>00241 <span class="comment">Contraintes: */</span>
<a name="l00242"></a><a class="code" href="classEquation__base.html#ad9e2dc453fa65c053086a5805ab96dc7">00242</a> <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classEquation__base.html#ad9e2dc453fa65c053086a5805ab96dc7" title="Surcharge Objet_U::printOn Imprime l&#39;equation et ses composants sur un flot de sortie. Imprime le nom de l&#39;equation, le solveur masse, les termes sources les conditions aux limites discretisees, les inconnues et les operateurs.">Equation_base::printOn</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os)<span class="keyword"> const</span>
<a name="l00243"></a>00243 <span class="keyword"></span>{
<a name="l00244"></a>00244   os &lt;&lt; <a class="code" href="classEquation__base.html#a9e2143e3ca5f68c2c02220b7fec06248">nom_</a> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00245"></a>00245   os &lt;&lt; <a class="code" href="classEquation__base.html#aaaf61d60cca8205d2490a023633cc7d4">solveur_masse</a>;
<a name="l00246"></a>00246   os &lt;&lt; <a class="code" href="classEquation__base.html#a6dae2cb8a228b0e3a6d90042fd75f360">les_sources</a>;
<a name="l00247"></a>00247   os &lt;&lt; <a class="code" href="classEquation__base.html#aa097c6ddc00bdb913c39739689f6d5c4">la_zone_Cl_dis</a>;
<a name="l00248"></a>00248   os &lt;&lt; <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>() ;
<a name="l00249"></a>00249   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>(); i++)
<a name="l00250"></a>00250     {
<a name="l00251"></a>00251       os &lt;&lt; <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>();
<a name="l00252"></a>00252     }
<a name="l00253"></a>00253   <span class="keywordflow">return</span> os;
<a name="l00254"></a>00254 }
<a name="l00255"></a>00255 
<a name="l00256"></a>00256 <span class="comment">// Precondition:</span>
<a name="l00257"></a>00257 <span class="comment">// Parametre: Entree&amp; is</span>
<a name="l00258"></a>00258 <span class="comment">// Signification: un flot d&#39;entree pour lire l&#39;equation</span>
<a name="l00259"></a>00259 <span class="comment">// Valeurs par defaut:</span>
<a name="l00260"></a>00260 <span class="comment">// Contraintes: le flot d&#39;entree doit etre ouvert</span>
<a name="l00261"></a>00261 <span class="comment">// Acces:</span>
<a name="l00262"></a>00262 <span class="comment">// Exception: mauvais format de lecture, accolade ouvrante attendue</span>
<a name="l00263"></a>00263 <span class="comment">// Exception: pas de conditions initiales, il faut initialiser l&#39;inconnue</span>
<a name="l00264"></a>00264 <span class="comment">// Exception: pas de conditions aux limites, il faut donner des conditions aux limites</span>
<a name="l00265"></a>00265 <span class="comment">// Effets de bord: le flot d&#39;entree a ete modifie</span>
<a name="l00266"></a>00266 <span class="comment">// Postcondition: l&#39;equation est construite avec les elements lus.</span>
<a name="l00267"></a>00267 <span class="comment">//</span>
<a name="l00268"></a>00268 <span class="comment">//</span>
<a name="l00269"></a>00269 <span class="comment">//</span>
<a name="l00270"></a>00270 <span class="comment">//</span>
<a name="l00271"></a>00271 <span class="comment">//</span>
<a name="l00272"></a>00272 <span class="comment">//</span>
<a name="l00273"></a>00273 <span class="comment">//</span><span class="comment"></span>
<a name="l00274"></a>00274 <span class="comment">//! Lecture d&#39;une equation sur un flot d&#39;entree.&lt;br&gt;Le format est le suivant:&lt;br&gt;{&lt;br&gt;[Source { [sou_1], [sour_2], ...} ]&lt;br&gt;Conditions_limites { [cl_1] [cl_2] ... }&lt;br&gt;Conditions_initiales { [cl_init] }&lt;br&gt;}</span>
<a name="l00275"></a>00275 <span class="comment"></span><span class="comment">/** \return Entree\&amp;&lt;br&gt;</span>
<a name="l00276"></a>00276 <span class="comment">Signification: le flot d&#39;entree modifie&lt;br&gt;</span>
<a name="l00277"></a>00277 <span class="comment">Contraintes: */</span>
<a name="l00278"></a><a class="code" href="classEquation__base.html#adfe1d5df1a723b0bdf2805f3f5ffe8fa">00278</a> <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classEquation__base.html#adfe1d5df1a723b0bdf2805f3f5ffe8fa" title="Lecture d&#39;une equation sur un flot d&#39;entree. Le format est le suivant: { [Source { [sou_1]...">Equation_base::readOn</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00279"></a>00279 {
<a name="l00280"></a>00280   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;Reading of data for a &quot;</span>&lt;&lt;<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>()&lt;&lt;<span class="stringliteral">&quot; equation&quot;</span>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00281"></a>00281   <a class="code" href="classParam.html" title="Defined below in this file.">Param</a> param(<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>());
<a name="l00282"></a>00282   <a class="code" href="classEquation__base.html#a56e1c6f710cf92ffb54656bd4b5be32d">set_param</a>(param);
<a name="l00283"></a>00283   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> expr_equation_non_resolue=<span class="stringliteral">&quot;0&quot;</span>;
<a name="l00284"></a>00284   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;equation_non_resolue&quot;</span>,&amp;expr_equation_non_resolue);
<a name="l00285"></a>00285   param.<a class="code" href="classParam.html#aa9d44fc51b4a08b357733a97dc7acaad" title="Read the is input with the parameters (defined with the Param object) inside: { ... } Example, to read: { a 1 b 2 } Param param(que_suis_je()); int a,b; param.ajouter(&quot;a&quot;,&amp;a); param.ajouter(&quot;b&quot;,&amp;b); param.lire_avec_accolades_depuis(is);.">lire_avec_accolades_depuis</a>(is);
<a name="l00286"></a>00286 <span class="comment">// On complete:</span>
<a name="l00287"></a>00287   <a class="code" href="classEquation__base.html#a703d3eb6a7f5ba12178528d16ca9a90c">equation_non_resolue_</a>.<a class="code" href="classParser__U.html#a25d581b85688da391aa64117abf0a073">setString</a>(expr_equation_non_resolue);
<a name="l00288"></a>00288   <a class="code" href="classEquation__base.html#a703d3eb6a7f5ba12178528d16ca9a90c">equation_non_resolue_</a>.<a class="code" href="classParser__U.html#a441c2fd29f5d4370c0c7b6a1cdfe56d5">parseString</a>();
<a name="l00289"></a>00289   <a class="code" href="classEquation__base.html#a4988730ccb465999b227ecc567e156d9">matrice_init</a> = 0;
<a name="l00290"></a>00290   <span class="keywordflow">return</span> is;
<a name="l00291"></a>00291 }
<a name="l00292"></a>00292 
<a name="l00293"></a><a class="code" href="classEquation__base.html#a56e1c6f710cf92ffb54656bd4b5be32d">00293</a> <span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#a56e1c6f710cf92ffb54656bd4b5be32d">Equation_base::set_param</a>(<a class="code" href="classParam.html" title="Defined below in this file.">Param</a>&amp; param)
<a name="l00294"></a>00294 {
<a name="l00295"></a>00295   param.<a class="code" href="classParam.html#a8d8bcddfd8087e577ffbb170c68e4f88">ajouter_non_std</a>(<span class="stringliteral">&quot;conditions_limites|boundary_conditions&quot;</span>,(<span class="keyword">this</span>),<a class="code" href="classParam.html#aa4ad0ca1d49bc5f2ebc5fc83ee9df384aaf5b6dfac1c5970478525407cc6ac572">Param::REQUIRED</a>);
<a name="l00296"></a>00296   param.<a class="code" href="classParam.html#a8d8bcddfd8087e577ffbb170c68e4f88">ajouter_non_std</a>(<span class="stringliteral">&quot;conditions_initiales|initial_conditions&quot;</span>,(<span class="keyword">this</span>),<a class="code" href="classParam.html#aa4ad0ca1d49bc5f2ebc5fc83ee9df384aaf5b6dfac1c5970478525407cc6ac572">Param::REQUIRED</a>);
<a name="l00297"></a>00297   param.<a class="code" href="classParam.html#a8d8bcddfd8087e577ffbb170c68e4f88">ajouter_non_std</a>(<span class="stringliteral">&quot;sources&quot;</span>,(<span class="keyword">this</span>));
<a name="l00298"></a>00298   param.<a class="code" href="classParam.html#a8d8bcddfd8087e577ffbb170c68e4f88">ajouter_non_std</a>(<span class="stringliteral">&quot;ecrire_fichier_xyz_valeur_bin&quot;</span>,(<span class="keyword">this</span>));
<a name="l00299"></a>00299   param.<a class="code" href="classParam.html#a8d8bcddfd8087e577ffbb170c68e4f88">ajouter_non_std</a>(<span class="stringliteral">&quot;ecrire_fichier_xyz_valeur&quot;</span>,(<span class="keyword">this</span>));
<a name="l00300"></a>00300   param.<a class="code" href="classParam.html#a8d8bcddfd8087e577ffbb170c68e4f88">ajouter_non_std</a>(<span class="stringliteral">&quot;bords&quot;</span>,(<span class="keyword">this</span>));
<a name="l00301"></a>00301   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;parametre_equation&quot;</span>,&amp;<a class="code" href="classEquation__base.html#a289847dfa1aa743dfcad53f740e53ab7">parametre_equation_</a>);
<a name="l00302"></a>00302 }
<a name="l00303"></a>00303 
<a name="l00304"></a><a class="code" href="classEquation__base.html#a23c5e00620d68b046db096424c1a861f">00304</a> <span class="keywordtype">int</span> <a class="code" href="classEquation__base.html#a23c5e00620d68b046db096424c1a861f" title="Lecture des parametres de type non simple d&#39;un objet_U a partir d&#39;un flot d&#39;entree.">Equation_base::lire_motcle_non_standard</a>(<span class="keyword">const</span> <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>&amp; mot, <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00305"></a>00305 {
<a name="l00306"></a>00306   <span class="keywordflow">if</span> (mot==<span class="stringliteral">&quot;sources&quot;</span>)
<a name="l00307"></a>00307     {
<a name="l00308"></a>00308       <a class="code" href="classEquation__base.html#ad1006d00fdef338af22a7559d05566b1" title="Lecture des termes sources dans un flot d&#39;entree.">lire_sources</a>(is);
<a name="l00309"></a>00309       <span class="keywordflow">return</span> 1;
<a name="l00310"></a>00310     }
<a name="l00311"></a>00311   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mot==<span class="stringliteral">&quot;conditions_limites|boundary_conditions&quot;</span>)
<a name="l00312"></a>00312     {
<a name="l00313"></a>00313       <a class="code" href="classEquation__base.html#a5850585c3a61422d75c0849a6e8cf769" title="Lecture des conditions limites sur un flot d&#39;entree. voir Zone_Cl_dis_base::readOn.">lire_cl</a>(is);
<a name="l00314"></a>00314       <a class="code" href="classEquation__base.html#afd7b9a39511b8a74fa314cbfb33aa80f" title="Verifie la compatibilite des conditions limites avec l&#39;equation. voir Conds_lim::compatible_avec_eqn(...">verif_Cl</a>();
<a name="l00315"></a>00315       <span class="keywordflow">return</span> 1;
<a name="l00316"></a>00316     }
<a name="l00317"></a>00317   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mot==<span class="stringliteral">&quot;conditions_initiales|initial_conditions&quot;</span>)
<a name="l00318"></a>00318     {
<a name="l00319"></a>00319       <a class="code" href="classEquation__base.html#a1948b10edf8744391a782423c3f5f538" title="Lecture des conditions initiales dans un flot d&#39;entree. Le format de lecture est le suivant: { Nom [D...">lire_cond_init</a>(is);
<a name="l00320"></a>00320       <span class="keywordflow">return</span> 1;
<a name="l00321"></a>00321     }
<a name="l00322"></a>00322   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((mot==<span class="stringliteral">&quot;ecrire_fichier_xyz_valeur&quot;</span>) || (mot==<span class="stringliteral">&quot;ecrire_fichier_xyz_valeur_bin&quot;</span>))
<a name="l00323"></a>00323     {
<a name="l00324"></a>00324       <span class="keywordflow">if</span> (mot==<span class="stringliteral">&quot;ecrire_fichier_xyz_valeur_bin&quot;</span>)
<a name="l00325"></a>00325         <a class="code" href="classEquation__base.html#a07f581d7c79a1e35f16f79bf07fdd1a8">ecrit_champ_xyz_bin</a>=1;
<a name="l00326"></a>00326       <a class="code" href="classEquation__base.html#a372372ba5fe5933221371f03529a4951">dt_ecrire_fic_xyz</a>.<a class="code" href="classArrOfDouble.html#a610464f4b3dccac6f814915b526783ed">resize_array</a>(<a class="code" href="classEquation__base.html#a606243b3895f9ef07dae37d964a8aaf6">nombre_champ_xyz</a>+1);
<a name="l00327"></a>00327       <a class="code" href="classEquation__base.html#ac59f55a30524e277636d919308bf8227">nb_bords_post_xyz</a>.<a class="code" href="classIntVect.html#a5900779fd9a3f9a82c68007a42b87d98" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(<a class="code" href="classEquation__base.html#a606243b3895f9ef07dae37d964a8aaf6">nombre_champ_xyz</a>+1);
<a name="l00328"></a>00328       <a class="code" href="classEquation__base.html#ac59f55a30524e277636d919308bf8227">nb_bords_post_xyz</a>[<a class="code" href="classEquation__base.html#a606243b3895f9ef07dae37d964a8aaf6">nombre_champ_xyz</a>]=0;
<a name="l00329"></a>00329       <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> nom_champ;
<a name="l00330"></a>00330       is &gt;&gt; nom_champ;
<a name="l00331"></a>00331 <span class="comment">// il faut creer les champs associes au mot clef ecrire_fichier_xyz_valeur ICI</span>
<a name="l00332"></a>00332 <span class="comment">// car dans methode ecrire_fichier_xyz()</span>
<a name="l00333"></a>00333 <span class="comment">// seuls les champs definis via equation ou post-traiment sont creer</span>
<a name="l00334"></a>00334       <a class="code" href="classEquation__base.html#ae2d5662d4d26ee7ebefa134239109275">mon_probleme</a>.<a class="code" href="classRef__Probleme__base.html#ae8c315c3e3321e765a5ca9c27e6322b5">valeur</a>().<a class="code" href="classProbleme__base.html#a0d8d417e3c4e1cabfaea63ca4aeb59c0">creer_champ</a>(nom_champ);
<a name="l00335"></a>00335 
<a name="l00336"></a>00336       <a class="code" href="classEquation__base.html#aa4736739e9c7aa669f02446490e9c66c">nom_champ_xyz</a>.<a class="code" href="classVect__Motcle.html#a68a2feae15986909fa00c7ceb2c20a25">add</a>(nom_champ);
<a name="l00337"></a>00337       is &gt;&gt; <a class="code" href="classEquation__base.html#a372372ba5fe5933221371f03529a4951">dt_ecrire_fic_xyz</a>[<a class="code" href="classEquation__base.html#a606243b3895f9ef07dae37d964a8aaf6">nombre_champ_xyz</a>];
<a name="l00338"></a>00338       <a class="code" href="classEquation__base.html#a606243b3895f9ef07dae37d964a8aaf6">nombre_champ_xyz</a>++;
<a name="l00339"></a>00339       <span class="keywordflow">return</span> 1;
<a name="l00340"></a>00340     }
<a name="l00341"></a>00341   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mot==<span class="stringliteral">&quot;bords&quot;</span>)
<a name="l00342"></a>00342     {
<a name="l00343"></a>00343       <span class="keywordtype">int</span> nb_bords_post;
<a name="l00344"></a>00344       is &gt;&gt; nb_bords_post;
<a name="l00345"></a>00345       <a class="code" href="classEquation__base.html#ac59f55a30524e277636d919308bf8227">nb_bords_post_xyz</a>[<a class="code" href="classEquation__base.html#a606243b3895f9ef07dae37d964a8aaf6">nombre_champ_xyz</a>-1] = nb_bords_post;
<a name="l00346"></a>00346       <span class="keywordflow">if</span> (nb_bords_post&lt;=0)
<a name="l00347"></a>00347         {
<a name="l00348"></a>00348           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; ecrire_fichier_xyz_valeur - bords : the number of boundary on which you want to postprocess must be positive !! &quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00349"></a>00349           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00350"></a>00350         }
<a name="l00351"></a>00351       <a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a> noms_bord;
<a name="l00352"></a>00352       noms_bord.<a class="code" href="classvect__impl.html#ad841d6b676a796bae26ed2566b7b3b41">dimensionner</a>(nb_bords_post);
<a name="l00353"></a>00353       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nb_bords_post; i++)
<a name="l00354"></a>00354         {
<a name="l00355"></a>00355           is &gt;&gt; noms_bord[i];
<a name="l00356"></a>00356         }
<a name="l00357"></a>00357       <a class="code" href="classEquation__base.html#ad3985b3495afe9715d21c59b8fd7701d">noms_bord_xyz</a>.<a class="code" href="classList__Noms.html#ac8a77e6158386a0be402d9dd69552829">add</a>(noms_bord);
<a name="l00358"></a>00358       <span class="keywordflow">return</span> 1;
<a name="l00359"></a>00359     }
<a name="l00360"></a>00360   <span class="keywordflow">else</span>
<a name="l00361"></a>00361     {
<a name="l00362"></a>00362       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; mot &lt;&lt; <span class="stringliteral">&quot; is not a keyword understood by &quot;</span> &lt;&lt; <a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; <span class="stringliteral">&quot; in lire_motcle_non_standard&quot;</span>&lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00363"></a>00363       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00364"></a>00364     }
<a name="l00365"></a>00365   <span class="keywordflow">return</span> -1;
<a name="l00366"></a>00366 }
<a name="l00367"></a>00367 
<a name="l00368"></a>00368 <span class="comment">// Precondition:</span>
<a name="l00369"></a>00369 <span class="comment">// Parametre:</span>
<a name="l00370"></a>00370 <span class="comment">// Signification:</span>
<a name="l00371"></a>00371 <span class="comment">// Valeurs par defaut:</span>
<a name="l00372"></a>00372 <span class="comment">// Contraintes:</span>
<a name="l00373"></a>00373 <span class="comment">// Acces:</span>
<a name="l00374"></a>00374 <span class="comment">// Exception:</span>
<a name="l00375"></a>00375 <span class="comment">// Effets de bord: le flot d&#39;entree a ete modifie</span>
<a name="l00376"></a>00376 <span class="comment">// Postcondition:</span>
<a name="l00377"></a>00377 <span class="comment">//</span>
<a name="l00378"></a>00378 <span class="comment">//</span><span class="comment"></span>
<a name="l00379"></a>00379 <span class="comment">//! Ecrit dans un fichier les valeurs du champ specifie&lt;br&gt;par le mot cle &quot;ecrire_fichier_xyz_valeur&quot;</span>
<a name="l00380"></a>00380 <span class="comment"></span><span class="comment">/** \return Entree\&amp;&lt;br&gt;</span>
<a name="l00381"></a>00381 <span class="comment">Signification: le flot d&#39;entree modifie&lt;br&gt;</span>
<a name="l00382"></a>00382 <span class="comment">Contraintes: */</span>
<a name="l00383"></a><a class="code" href="classEquation__base.html#acab5bf5d880c64543cd5f8b7b19fa181">00383</a> <span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#acab5bf5d880c64543cd5f8b7b19fa181" title="Ecrit dans un fichier les valeurs du champ specifie par le mot cle &quot;ecrire_fichier_xyz_valeur&quot;.">Equation_base::ecrire_fichier_xyz</a>()<span class="keyword"> const</span>
<a name="l00384"></a>00384 <span class="keyword"></span>{
<a name="l00385"></a>00385   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> numero_champ_xyz=0; numero_champ_xyz&lt;<a class="code" href="classEquation__base.html#a606243b3895f9ef07dae37d964a8aaf6">nombre_champ_xyz</a>; numero_champ_xyz++)
<a name="l00386"></a>00386     {
<a name="l00387"></a>00387       <a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a> vide;
<a name="l00388"></a>00388       <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; dt_ecrire_fic = <a class="code" href="classEquation__base.html#a372372ba5fe5933221371f03529a4951">dt_ecrire_fic_xyz</a>[numero_champ_xyz];
<a name="l00389"></a>00389       <span class="keyword">const</span> <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>&amp; nom_champ = <a class="code" href="classEquation__base.html#aa4736739e9c7aa669f02446490e9c66c">nom_champ_xyz</a>[numero_champ_xyz];
<a name="l00390"></a>00390       <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; nb_bords_post = <a class="code" href="classEquation__base.html#ac59f55a30524e277636d919308bf8227">nb_bords_post_xyz</a>[numero_champ_xyz];
<a name="l00391"></a>00391       <span class="keyword">const</span> <a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a>&amp; noms_bord = (nb_bords_post?<a class="code" href="classEquation__base.html#ad3985b3495afe9715d21c59b8fd7701d">noms_bord_xyz</a>[numero_champ_xyz]:vide);
<a name="l00392"></a>00392 
<a name="l00393"></a>00393       <a class="code" href="Ref_8h.html#aab5720a5c34da14028d0745e386aaa01">REF</a>(<a class="code" href="classChamp__base.html" title="classe Champ_base Cette classe est la base de la hierarchie des champs. Ses membres sont les attribut...">Champ_base</a>) champ_a_ecrire;
<a name="l00394"></a>00394       <span class="keyword">const</span> <span class="keywordtype">double</span> temps_courant = <a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>-&gt;temps_courant();
<a name="l00395"></a>00395       <span class="keyword">const</span> <span class="keywordtype">double</span> dt = <a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>-&gt;pas_de_temps();
<a name="l00396"></a>00396       <span class="keyword">const</span> <span class="keywordtype">double</span> tmax = <a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>-&gt;temps_max();
<a name="l00397"></a>00397       <span class="keyword">const</span> <span class="keywordtype">int</span> nb_pas_dt_max = <a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>-&gt;nb_pas_dt_max();
<a name="l00398"></a>00398       <span class="keyword">const</span> <span class="keywordtype">int</span> nb_pas_dt = <a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>-&gt;nb_pas_dt();
<a name="l00399"></a>00399       <span class="keyword">const</span> <span class="keywordtype">int</span> stationnaire_atteint = <a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>-&gt;stationnaire_atteint();
<a name="l00400"></a>00400       <span class="keywordtype">int</span> ok;
<a name="l00401"></a>00401       <span class="keywordflow">if</span> (dt_ecrire_fic&lt;=dt || tmax&lt;=temps_courant || nb_pas_dt_max&lt;=nb_pas_dt || nb_pas_dt&lt;=1 || stationnaire_atteint || <a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>.<a class="code" href="classRef__Schema__Temps__base.html#a1cdfccd0f1ad187e0e83d762e69a7834">valeur</a>().<a class="code" href="classSchema__Temps__base.html#a753a697da5c097060eab9d3bff2d40d8" title="Renvoie 1 si le fichier (d&#39;extension) .stop contient un 1 Renvoie 0 sinon.">stop_lu</a>())
<a name="l00402"></a>00402         ok=1;
<a name="l00403"></a>00403       <span class="keywordflow">else</span>
<a name="l00404"></a>00404         {
<a name="l00405"></a>00405 <span class="comment">// Voir Schema_Temps_base::limpr pour information sur epsilon et modf</span>
<a name="l00406"></a>00406           <span class="keywordtype">double</span> i, j, epsilon = 1.e-8;
<a name="l00407"></a>00407           modf(temps_courant/dt_ecrire_fic + epsilon, &amp;i);
<a name="l00408"></a>00408           modf((temps_courant-dt)/dt_ecrire_fic + epsilon, &amp;j);
<a name="l00409"></a>00409           ok = (i&gt;j);
<a name="l00410"></a>00410         }
<a name="l00411"></a>00411       <span class="keywordtype">int</span> champ_ok = 0;
<a name="l00412"></a>00412       <span class="keywordtype">int</span> champ_stat = 0;
<a name="l00413"></a>00413       <a class="code" href="Ref_8h.html#aab5720a5c34da14028d0745e386aaa01">REF</a>(<a class="code" href="classOperateur__Statistique__tps__base.html" title="classe Operateur_Statistique_tps_base Represente des operations statistiques sur les champs...">Operateur_Statistique_tps_base</a>) op_stat;
<a name="l00414"></a>00414       <span class="keywordflow">if</span> (ok &amp;&amp; dt_ecrire_fic&gt;0)
<a name="l00415"></a>00415         {
<a name="l00416"></a>00416 <span class="comment">// On recherche le champ dans le probleme contenant l&#39;equation, et les postraitements</span>
<a name="l00417"></a>00417 <span class="comment">// dans les postraitements ?</span>
<a name="l00418"></a>00418           <a class="code" href="List_8h.html#add189d7375e577842ac891b09afc6d4b">CONST_LIST_CURSEUR</a>(<a class="code" href="Deriv_8h.html#a4b39337b42cbf2fddeba7868ced6f860" title="Soit une classe Type_base qui derive de Objet_U. DERIV(T) est une petite classe contenant un pointeur...">DERIV</a>(<a class="code" href="classPostraitement__base.html" title="Classe de base pour l&#39;ensemble des postraitements.">Postraitement_base</a>)) curseur = <a class="code" href="classEquation__base.html#ae2d5662d4d26ee7ebefa134239109275">mon_probleme</a>-&gt;postraitements();
<a name="l00419"></a>00419           <span class="keywordflow">while</span>(curseur &amp;&amp; !champ_ok)
<a name="l00420"></a>00420             {
<a name="l00421"></a>00421               <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classPostraitement.html" title="classe Postraitement La classe est dotee -d une liste de champs generiques champs_post_complet_ qui c...">Postraitement</a>,curseur.valeur().valeur()))
<a name="l00422"></a>00422                 {
<a name="l00423"></a>00423                   <span class="keyword">const</span> <a class="code" href="classPostraitement.html" title="classe Postraitement La classe est dotee -d une liste de champs generiques champs_post_complet_ qui c...">Postraitement</a>&amp; post = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classPostraitement.html" title="classe Postraitement La classe est dotee -d une liste de champs generiques champs_post_complet_ qui c...">Postraitement</a>,curseur.valeur().valeur());
<a name="l00424"></a>00424                   <span class="keywordflow">if</span> (champ_ok==0)
<a name="l00425"></a>00425                     {
<a name="l00426"></a>00426                       <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> nom_test = nom_champ;
<a name="l00427"></a>00427 <span class="comment">// La recherche est faite sur les champs statistiques a partir d un identifiant</span>
<a name="l00428"></a>00428 <span class="comment">// Si le nom indique dans le jeux de donnes est celui d un champ statistiques</span>
<a name="l00429"></a>00429 <span class="comment">// il doit correspondre au nom du champ de postraitement</span>
<a name="l00430"></a>00430 
<a name="l00431"></a>00431                       post.<a class="code" href="classPostraitement.html#a4edc6a76a170d9025f4bf9bf1aa188a9">champ_fonc</a>(nom_test,champ_a_ecrire,op_stat);
<a name="l00432"></a>00432                       <span class="keywordflow">if</span> (champ_a_ecrire.non_nul())
<a name="l00433"></a>00433                         {
<a name="l00434"></a>00434                           champ_stat = 1;
<a name="l00435"></a>00435                           champ_ok = 1;
<a name="l00436"></a>00436                         }
<a name="l00437"></a>00437                     }
<a name="l00438"></a>00438                 }
<a name="l00439"></a>00439               ++curseur;
<a name="l00440"></a>00440             }
<a name="l00441"></a>00441 
<a name="l00442"></a>00442           <span class="keywordflow">if</span> (champ_ok==0)
<a name="l00443"></a>00443 <span class="comment">// L identifiant correspond ici a un Champ_base</span>
<a name="l00444"></a>00444             champ_a_ecrire = <a class="code" href="classEquation__base.html#ae2d5662d4d26ee7ebefa134239109275">mon_probleme</a>.<a class="code" href="classRef__Probleme__base.html#ae8c315c3e3321e765a5ca9c27e6322b5">valeur</a>().<a class="code" href="classProbleme__base.html#acc8deeeb73b31eaa3d0ecd4f9644ba77">get_champ</a>(nom_champ);
<a name="l00445"></a>00445 
<a name="l00446"></a>00446           <span class="keywordtype">int</span> nb_compo = champ_a_ecrire-&gt;<a class="code" href="classField__base.html#a16e3abfebaaf9b7ef83acb936c872a91" title="Renvoie le nombre de composantes du champ.">nb_comp</a>();
<a name="l00447"></a>00447           <span class="keywordflow">if</span> (nb_bords_post&gt;0) <span class="comment">//!&lt; on ne souhaite postraiter que sur certains bords</span>
<a name="l00448"></a>00448 <span class="comment"></span>            {
<a name="l00449"></a>00449               <span class="keywordtype">int</span> nb_cl = <a class="code" href="classEquation__base.html#aa097c6ddc00bdb913c39739689f6d5c4">la_zone_Cl_dis</a>-&gt;<a class="code" href="classZone__Cl__dis.html#a7e0c9938057e7d427eea4954dd7bad58" title="Appel a l&#39;objet sous-jacent Renvoie le nombre de conditions aux limites.">nb_cond_lim</a>();
<a name="l00450"></a>00450               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;nb_bords_post; j++)
<a name="l00451"></a>00451                 {
<a name="l00452"></a>00452                   <span class="keywordtype">int</span> count = 0 ; <span class="comment">//!&lt; int servant a tester si le nom du bord correspond bien au nom d&#39;une frontiere</span>
<a name="l00453"></a>00453 <span class="comment"></span>                  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nb_cl; i++)
<a name="l00454"></a>00454                     {
<a name="l00455"></a>00455                       <span class="keyword">const</span> <a class="code" href="classCond__lim__base.html" title="classe Cond_lim_base Classe de base pour la hierarchie des classes qui representent les differentes c...">Cond_lim_base</a>&amp; la_cl = <a class="code" href="classEquation__base.html#aa097c6ddc00bdb913c39739689f6d5c4">la_zone_Cl_dis</a>.<a class="code" href="classDeriv__Zone__Cl__dis__base.html#a6b56880f00b604e1f13970ec6d5bc077">valeur</a>().<a class="code" href="classZone__Cl__dis__base.html#af75e0ed7786863e4d333bfb29d67c323" title="Renvoie la i-ieme condition aux limites. (version const)">les_conditions_limites</a>(i);
<a name="l00456"></a>00456                       <span class="keyword">const</span> <a class="code" href="classFrontiere.html" title="Classe Frontiere. Une Frontiere decrit une partie de la frontiere d&#39;une Zone, elle possede un Nom...">Frontiere</a>&amp; la_frontiere = la_cl.<a class="code" href="classCond__lim__base.html#ad88b3b516351146c85e8fce1df0f691a" title="Renvoie la frontiere discretisee a laquelle les conditions aux limites s&#39;appliquent.">frontiere_dis</a>().<a class="code" href="classFrontiere__dis__base.html#a95f81b046cd23c8c8083ae03eebe93cd" title="Renvoie la frontiere geometrique associee. (version const)">frontiere</a>();
<a name="l00457"></a>00457                       <span class="keywordflow">if</span> (la_frontiere.<a class="code" href="classFrontiere.html#a2868774681d6f050479a95cbc7cd6fc9" title="Renvoie le nom de la frontiere.">le_nom</a>() == noms_bord[j])
<a name="l00458"></a>00458                         {
<a name="l00459"></a>00459 <span class="comment">// Construction du nom du fichier</span>
<a name="l00460"></a>00460                           <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> nom_fic(<a class="code" href="classEquation__base.html#aa8151a96f63719523bf50ddd832e0f8f" title="Renvoie le probleme associe a l&#39;equation.">probleme</a>().<a class="code" href="classEquation__base.html#a65e9b2520ac7b42444e4d9aa4f18ccf7" title="Renvoie le nom de l&#39;equation.">le_nom</a>());
<a name="l00461"></a>00461                           nom_fic+=<span class="stringliteral">&quot;_&quot;</span>;
<a name="l00462"></a>00462                           nom_fic+=nom_champ;
<a name="l00463"></a>00463                           nom_fic+=<span class="stringliteral">&quot;_&quot;</span>;
<a name="l00464"></a>00464                           nom_fic+=noms_bord[j];
<a name="l00465"></a>00465                           nom_fic+=<span class="stringliteral">&quot;_&quot;</span>;
<a name="l00466"></a>00466                           nom_fic+=<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(temps_courant);
<a name="l00467"></a>00467                           nom_fic+=<span class="stringliteral">&quot;.dat&quot;</span>;
<a name="l00468"></a>00468                           <a class="code" href="classEcrFicPartage.html">EcrFicPartage</a> fic;
<a name="l00469"></a>00469                           fic.<a class="code" href="classEcrFicPartage.html#adb24de67c7f2227a9128cdd84a710616" title="Change le mode d&#39;ecriture du fichier. Cette methode peut etre appelee n&#39;importe quand. Attention cependant pour les fichiers Ecrire_Fichier_Partage : il faut faire le changement uniquement au debut de l&#39;ecriture d&#39;un bloc, juste apres syncfile() (sinon, mauvaise traduction des retours a la ligne lors du syncfile suivant).">set_bin</a>(<a class="code" href="classEquation__base.html#a07f581d7c79a1e35f16f79bf07fdd1a8">ecrit_champ_xyz_bin</a>);
<a name="l00470"></a>00470                           fic.<a class="code" href="classEcrFicPartage.html#aae9fd9a7163d0edcb12e0235a2eabdfa" title="Ouvre le fichier avec les parametres mode et prot donnes Ces parametres sont les parametres de la met...">ouvrir</a>(nom_fic);
<a name="l00471"></a>00471                           fic.<a class="code" href="classSortie__Fichier__base.html#a5ddd834ca9c766c24cc608cd03ef0e96">setf</a>(ios::scientific);
<a name="l00472"></a>00472                           fic.<a class="code" href="classEcrFicPartage.html#a8c1c382e3081ddf0ea26cf119d370e59">precision</a>(<a class="code" href="classObjet__U.html#a9b145f6e0684a53f431e675423037ada">format_precision_geom</a>);
<a name="l00473"></a>00473 
<a name="l00474"></a>00474 <span class="comment">// Construction du tableau pos contenant les centres des faces frontiere</span>
<a name="l00475"></a>00475                           <span class="keyword">const</span> <span class="keywordtype">int</span> nb_val = la_frontiere.<a class="code" href="classFrontiere.html#aa073fe9dbdddde59471ee7032b256aa2" title="Renvoie le nombre de faces de la frontiere.">nb_faces</a>();
<a name="l00476"></a>00476                           <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> pos;
<a name="l00477"></a>00477                           la_frontiere.<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#aff1f39c3e63c21260ab8c49497dd3a3f" title="Calcule les centres de gravite de chaque face.">calculer_centres_gravite</a>(pos);
<a name="l00478"></a>00478 
<a name="l00479"></a>00479 <span class="comment">// Construction du tableau val contenant les valeurs aux centres des faces</span>
<a name="l00480"></a>00480                           <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> val(nb_val,nb_compo);
<a name="l00481"></a>00481                           val = 0.;
<a name="l00482"></a>00482                           <span class="keywordflow">if</span> (champ_stat == 1)
<a name="l00483"></a>00483                             {
<a name="l00484"></a>00484                               <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> copie(champ_a_ecrire-&gt;valeurs());
<a name="l00485"></a>00485                               champ_a_ecrire-&gt;valeurs() = op_stat-&gt;calculer_valeurs();
<a name="l00486"></a>00486                               champ_a_ecrire-&gt;valeur_aux(pos, val);
<a name="l00487"></a>00487                               champ_a_ecrire-&gt;valeurs() = copie;
<a name="l00488"></a>00488                             }
<a name="l00489"></a>00489                           <span class="keywordflow">else</span>
<a name="l00490"></a>00490                             champ_a_ecrire-&gt;valeur_aux(pos, val);
<a name="l00491"></a>00491 
<a name="l00492"></a>00492 <span class="comment">// Ecriture du fichier</span>
<a name="l00493"></a>00493                           <span class="keywordtype">int</span> nb_val_tot = <a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(nb_val);
<a name="l00494"></a>00494                           <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l00495"></a>00495                             {
<a name="l00496"></a>00496                               <span class="keywordflow">if</span>(<a class="code" href="classEquation__base.html#a07f581d7c79a1e35f16f79bf07fdd1a8">ecrit_champ_xyz_bin</a>)
<a name="l00497"></a>00497                                 fic &lt;&lt; <span class="stringliteral">&quot;binary&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00498"></a>00498                               fic  &lt;&lt; nb_val_tot &lt;&lt; finl;
<a name="l00499"></a>00499                             }
<a name="l00500"></a>00500                           <a class="code" href="classProcess.html#aa9e74a5c06a68ea38298a08ea401e7b1" title="Synchronise tous les processeurs du groupe courant&lt;br&gt;(attend que tous les processeurs soient arrives...">barrier</a>();
<a name="l00501"></a>00501                           fic.<a class="code" href="classEcrFicPartage.html#a94805a085e3c4312dc43cb65217b8d1b" title="Permet au processus appelant de bloquer en attente de la ressource commune a tous les processus qui e...">lockfile</a>();
<a name="l00502"></a>00502                           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i2=0; i2&lt;nb_val; i2++)
<a name="l00503"></a>00503                             {
<a name="l00504"></a>00504 <span class="comment">// Ecriture des coordonees</span>
<a name="l00505"></a>00505                               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j2=0; j2&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; j2++)
<a name="l00506"></a>00506                                 fic &lt;&lt; pos(i2,j2) &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l00507"></a>00507 <span class="comment">// Ecriture des valeurs</span>
<a name="l00508"></a>00508                               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nb=0; nb&lt;nb_compo; nb++)
<a name="l00509"></a>00509                                 fic &lt;&lt; val(i2,nb) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> ;
<a name="l00510"></a>00510                               fic &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00511"></a>00511                             }
<a name="l00512"></a>00512                           fic.<a class="code" href="classEcrFicPartage.html#a9e949d929e1f36fad99b492c32caea50" title="Permet de debloquer la ressource critique pour leprocessus suivant. Le processus appelant, sauf si c&#39;est le premier processus du groupe, envoie sa position courante au precessus suivant dans le groupe. Cette methode est a appeler apres chaque ecriture dans le fichier.">unlockfile</a>();
<a name="l00513"></a>00513                           <a class="code" href="classProcess.html#aa9e74a5c06a68ea38298a08ea401e7b1" title="Synchronise tous les processeurs du groupe courant&lt;br&gt;(attend que tous les processeurs soient arrives...">barrier</a>();
<a name="l00514"></a>00514                           fic.<a class="code" href="classEcrFicPartage.html#a76131150f8293c86eb36f4b45125183d" title="Provoque l&#39;ecriture sur disque des donnees accumulees sur les differents processeurs depuis le dernie...">syncfile</a>();
<a name="l00515"></a>00515                           fic.<a class="code" href="classEcrFicPartage.html#aa1268f27f87790ead9fc158587252134">close</a>();
<a name="l00516"></a>00516                         }
<a name="l00517"></a>00517                       <span class="keywordflow">else</span>
<a name="l00518"></a>00518                         {
<a name="l00519"></a>00519                           count++;
<a name="l00520"></a>00520                         }
<a name="l00521"></a>00521                     }
<a name="l00522"></a>00522                   <span class="keywordflow">if</span> (count==nb_cl)
<a name="l00523"></a>00523                     {
<a name="l00524"></a>00524                       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;You try to use the method Ecrire_fichier_xyz_valeur with an unknow name boundary&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00525"></a>00525                       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;The boundary named &quot;</span> &lt;&lt; noms_bord[j] &lt;&lt; <span class="stringliteral">&quot; is not recognized&quot;</span>&lt;&lt; finl;
<a name="l00526"></a>00526                       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00527"></a>00527                     }
<a name="l00528"></a>00528 
<a name="l00529"></a>00529                 }
<a name="l00530"></a>00530             }
<a name="l00531"></a>00531           <span class="keywordflow">else</span> <span class="comment">//!&lt; on souhaite postraiter sur tout le domaine</span>
<a name="l00532"></a>00532 <span class="comment"></span>            {
<a name="l00533"></a>00533 
<a name="l00534"></a>00534               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;The option of post processing the entire domain with Ecrire_fichier_xyz_valeur is now obsolete.&quot;</span> &lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00535"></a>00535               <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00536"></a>00536             }
<a name="l00537"></a>00537         }
<a name="l00538"></a>00538     }
<a name="l00539"></a>00539 }
<a name="l00540"></a>00540 
<a name="l00541"></a>00541 
<a name="l00542"></a>00542 
<a name="l00543"></a>00543 <span class="comment">// Precondition:</span>
<a name="l00544"></a>00544 <span class="comment">// Parametre: Entree&amp; is</span>
<a name="l00545"></a>00545 <span class="comment">// Signification: flot d&#39;entree pour lire les termes sources</span>
<a name="l00546"></a>00546 <span class="comment">// Valeurs par defaut:</span>
<a name="l00547"></a>00547 <span class="comment">// Contraintes: le flot doit etre ouvert</span>
<a name="l00548"></a>00548 <span class="comment">// Acces:</span>
<a name="l00549"></a>00549 <span class="comment">// Exception:</span>
<a name="l00550"></a>00550 <span class="comment">// Effets de bord: le flot d&#39;entree a ete modifie</span>
<a name="l00551"></a>00551 <span class="comment">// Postcondition:</span>
<a name="l00552"></a>00552 <span class="comment">//</span><span class="comment"></span>
<a name="l00553"></a>00553 <span class="comment">//! Lecture des termes sources dans un flot d&#39;entree.</span>
<a name="l00554"></a>00554 <span class="comment"></span><span class="comment">/** \return Entree\&amp;&lt;br&gt;</span>
<a name="l00555"></a>00555 <span class="comment">Signification: le flot d&#39;entree modifie&lt;br&gt;</span>
<a name="l00556"></a>00556 <span class="comment">Contraintes: */</span>
<a name="l00557"></a><a class="code" href="classEquation__base.html#ad1006d00fdef338af22a7559d05566b1">00557</a> <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classEquation__base.html#ad1006d00fdef338af22a7559d05566b1" title="Lecture des termes sources dans un flot d&#39;entree.">Equation_base::lire_sources</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00558"></a>00558 {
<a name="l00559"></a>00559   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Reading of source terms&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a> ;
<a name="l00560"></a>00560   is &gt;&gt; <a class="code" href="classEquation__base.html#a6dae2cb8a228b0e3a6d90042fd75f360">les_sources</a>;
<a name="l00561"></a>00561   <span class="keywordflow">return</span> is;
<a name="l00562"></a>00562 }
<a name="l00563"></a>00563 
<a name="l00564"></a>00564 <span class="comment">// Precondition:</span>
<a name="l00565"></a>00565 <span class="comment">// Parametre:</span>
<a name="l00566"></a>00566 <span class="comment">// Signification:</span>
<a name="l00567"></a>00567 <span class="comment">// Valeurs par defaut:</span>
<a name="l00568"></a>00568 <span class="comment">// Contraintes:</span>
<a name="l00569"></a>00569 <span class="comment">// Acces:</span>
<a name="l00570"></a>00570 <span class="comment">// Exception:</span>
<a name="l00571"></a>00571 <span class="comment">// Effets de bord:</span>
<a name="l00572"></a>00572 <span class="comment">// Postcondition:</span>
<a name="l00573"></a>00573 <span class="comment">//</span><span class="comment"></span>
<a name="l00574"></a>00574 <span class="comment">//! Renvoie les termes sources asssocies a l&#39;equation</span>
<a name="l00575"></a>00575 <span class="comment"></span><span class="comment">/** \return Sources\&amp;&lt;br&gt;</span>
<a name="l00576"></a>00576 <span class="comment">Signification: la liste des termes sources associees a l&#39;equation&lt;br&gt;</span>
<a name="l00577"></a>00577 <span class="comment">Contraintes: */</span>
<a name="l00578"></a><a class="code" href="classEquation__base.html#a3c8ac50e3e7b6ed29024a43e828a5396">00578</a> <a class="code" href="classSources.html" title="class Sources Sources represente une liste de Source. Une equation contient un membres Equation_base:...">Sources</a>&amp; <a class="code" href="classEquation__base.html#a3c8ac50e3e7b6ed29024a43e828a5396" title="Renvoie les termes sources asssocies a l&#39;equation.">Equation_base::sources</a>()
<a name="l00579"></a>00579 {
<a name="l00580"></a>00580   <span class="keywordflow">return</span> <a class="code" href="classEquation__base.html#a6dae2cb8a228b0e3a6d90042fd75f360">les_sources</a>;
<a name="l00581"></a>00581 }
<a name="l00582"></a>00582 
<a name="l00583"></a>00583 <span class="comment">// Precondition:</span>
<a name="l00584"></a>00584 <span class="comment">// Parametre:</span>
<a name="l00585"></a>00585 <span class="comment">// Signification:</span>
<a name="l00586"></a>00586 <span class="comment">// Valeurs par defaut:</span>
<a name="l00587"></a>00587 <span class="comment">// Contraintes:</span>
<a name="l00588"></a>00588 <span class="comment">// Acces:</span>
<a name="l00589"></a>00589 <span class="comment">// Exception:</span>
<a name="l00590"></a>00590 <span class="comment">// Effets de bord:</span>
<a name="l00591"></a>00591 <span class="comment">// Postcondition:</span>
<a name="l00592"></a>00592 <span class="comment">//</span>
<a name="l00593"></a>00593 <span class="comment">//</span><span class="comment"></span>
<a name="l00594"></a>00594 <span class="comment">//! Renvoie les termes sources asssocies a l&#39;equation&lt;br&gt;(version const)</span>
<a name="l00595"></a>00595 <span class="comment"></span><span class="comment">/** \return Sources\&amp;&lt;br&gt;</span>
<a name="l00596"></a>00596 <span class="comment">Signification: la liste des termes sources associees a l&#39;equation&lt;br&gt;</span>
<a name="l00597"></a>00597 <span class="comment">Contraintes: reference constante */</span>
<a name="l00598"></a><a class="code" href="classEquation__base.html#abec46f7663c72c97bc032276a46b5762">00598</a> <span class="keyword">const</span> <a class="code" href="classSources.html" title="class Sources Sources represente une liste de Source. Une equation contient un membres Equation_base:...">Sources</a>&amp; <a class="code" href="classEquation__base.html#a3c8ac50e3e7b6ed29024a43e828a5396" title="Renvoie les termes sources asssocies a l&#39;equation.">Equation_base::sources</a>()<span class="keyword"> const</span>
<a name="l00599"></a>00599 <span class="keyword"></span>{
<a name="l00600"></a>00600   <span class="keywordflow">return</span> <a class="code" href="classEquation__base.html#a6dae2cb8a228b0e3a6d90042fd75f360">les_sources</a>;
<a name="l00601"></a>00601 }
<a name="l00602"></a>00602 
<a name="l00603"></a>00603 <span class="comment">// Precondition:</span>
<a name="l00604"></a>00604 <span class="comment">// Parametre: Entree&amp; is</span>
<a name="l00605"></a>00605 <span class="comment">// Signification: le flot d&#39;entree</span>
<a name="l00606"></a>00606 <span class="comment">// Valeurs par defaut:</span>
<a name="l00607"></a>00607 <span class="comment">// Contraintes:</span>
<a name="l00608"></a>00608 <span class="comment">// Acces: entree/sortie</span>
<a name="l00609"></a>00609 <span class="comment">// Exception: erreur de format, accolade ouvrante attendue</span>
<a name="l00610"></a>00610 <span class="comment">// Exception: mauvais nom pour l&#39;inconnue</span>
<a name="l00611"></a>00611 <span class="comment">// Exception: erreur de format, accolade fermante attendue</span>
<a name="l00612"></a>00612 <span class="comment">// Effets de bord: l&#39;inconnue associe au probleme est mise a jour avec</span>
<a name="l00613"></a>00613 <span class="comment">// les conditions initiales lues.</span>
<a name="l00614"></a>00614 <span class="comment">// Le flot d&#39;entree est modifie.</span>
<a name="l00615"></a>00615 <span class="comment">// Postcondition:</span>
<a name="l00616"></a>00616 <span class="comment">//</span>
<a name="l00617"></a>00617 <span class="comment">//</span>
<a name="l00618"></a>00618 <span class="comment">//</span>
<a name="l00619"></a>00619 <span class="comment">//</span>
<a name="l00620"></a>00620 <span class="comment">//</span>
<a name="l00621"></a>00621 <span class="comment">//</span><span class="comment"></span>
<a name="l00622"></a>00622 <span class="comment">//! Lecture des conditions initiales dans un flot d&#39;entree.&lt;br&gt;Le format de lecture est le suivant:&lt;br&gt;{&lt;br&gt;Nom [DOIT ETRE LE NOM DE L&#39;INCONNUE]&lt;br&gt;[LIRE UN CHAMP DONNE]&lt;br&gt;}</span>
<a name="l00623"></a>00623 <span class="comment"></span><span class="comment">/** \return Entree\&amp;&lt;br&gt;</span>
<a name="l00624"></a>00624 <span class="comment">Signification: le flot d&#39;entree modifie&lt;br&gt;</span>
<a name="l00625"></a>00625 <span class="comment">Contraintes: */</span>
<a name="l00626"></a><a class="code" href="classEquation__base.html#a1948b10edf8744391a782423c3f5f538">00626</a> <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classEquation__base.html#a1948b10edf8744391a782423c3f5f538" title="Lecture des conditions initiales dans un flot d&#39;entree. Le format de lecture est le suivant: { Nom [D...">Equation_base::lire_cond_init</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00627"></a>00627 {
<a name="l00628"></a>00628   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Reading of initial conditions\n&quot;</span>;
<a name="l00629"></a>00629   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> nom;
<a name="l00630"></a>00630   <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> motlu;
<a name="l00631"></a>00631   is &gt;&gt; nom;
<a name="l00632"></a>00632   motlu = nom;
<a name="l00633"></a>00633   <span class="keywordflow">if</span>(motlu!=<a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>(<span class="stringliteral">&quot;{&quot;</span>))
<a name="l00634"></a>00634     {
<a name="l00635"></a>00635       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;We expected a { while reading &quot;</span> &lt;&lt; <a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00636"></a>00636       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;and not : &quot;</span> &lt;&lt; nom &lt;&lt; finl;
<a name="l00637"></a>00637       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00638"></a>00638     }
<a name="l00639"></a>00639   is &gt;&gt; nom;
<a name="l00640"></a>00640   motlu = nom;
<a name="l00641"></a>00641   <span class="keywordflow">if</span> (motlu != <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>(<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>()-&gt;<a class="code" href="classEquation__base.html#a65e9b2520ac7b42444e4d9aa4f18ccf7" title="Renvoie le nom de l&#39;equation.">le_nom</a>()))
<a name="l00642"></a>00642     {
<a name="l00643"></a>00643       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; nom &lt;&lt; <span class="stringliteral">&quot; is not the name of the unknown &quot;</span>
<a name="l00644"></a>00644            &lt;&lt; <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>()-&gt;<a class="code" href="classO__U__Ptr.html#a5aae0c48048a40339f3847aa14109231" title="Renvoie ref_().le_nom() si le pointeur est non nul ou &quot;Pointeur Nul&quot;.">le_nom</a>() &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00645"></a>00645       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00646"></a>00646     }
<a name="l00647"></a>00647   <a class="code" href="classChamp__Don.html" title="classe Champ_Don Classe generique de la hierarchie des champs donnes, un objet Champ_Don peut referen...">Champ_Don</a> ch_init;
<a name="l00648"></a>00648   is &gt;&gt; ch_init;
<a name="l00649"></a>00649   <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; nb_comp = ch_init.<a class="code" href="classChamp__Don.html#aa0b82f09287c5934333d540ef77e0059" title="Appel a l&#39;objet sous-jacent Renvoie le nombre de composantes du champ.">nb_comp</a>();
<a name="l00650"></a>00650   <a class="code" href="classEquation__base.html#ad1f2ad11c460019344768e591ec41825" title="Verification du nombre de composantes lues pour la specification d un champ. Actuellement utilise pou...">verifie_ch_init_nb_comp</a>(<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>(),nb_comp);
<a name="l00651"></a>00651 
<a name="l00652"></a>00652 <span class="comment">// Cerr&lt;&lt;&quot;inconnue().valeur().que_suis_je() = &quot;&lt;&lt;inconnue().valeur().que_suis_je()&lt;&lt;finl;</span>
<a name="l00653"></a>00653 
<a name="l00654"></a>00654   <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>()-&gt;affecter(ch_init.valeur());
<a name="l00655"></a>00655   is &gt;&gt; nom;
<a name="l00656"></a>00656   motlu = nom;
<a name="l00657"></a>00657   <span class="keywordflow">if</span>(motlu!=<a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>(<span class="stringliteral">&quot;}&quot;</span>))
<a name="l00658"></a>00658     {
<a name="l00659"></a>00659       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;We expected a } while reading &quot;</span> &lt;&lt; <a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00660"></a>00660       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;and not : &quot;</span> &lt;&lt; nom &lt;&lt; finl;
<a name="l00661"></a>00661       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00662"></a>00662     }
<a name="l00663"></a>00663   <span class="keywordflow">return</span> is;
<a name="l00664"></a>00664 }
<a name="l00665"></a>00665 
<a name="l00666"></a>00666 <span class="comment">// Precondition:</span>
<a name="l00667"></a>00667 <span class="comment">// Parametre: Entree&amp; is</span>
<a name="l00668"></a>00668 <span class="comment">// Signification: le flot d&#39;entree</span>
<a name="l00669"></a>00669 <span class="comment">// Valeurs par defaut:</span>
<a name="l00670"></a>00670 <span class="comment">// Contraintes:</span>
<a name="l00671"></a>00671 <span class="comment">// Acces: entree/sortie</span>
<a name="l00672"></a>00672 <span class="comment">// Exception: la zone des conditions aux limites discretisee est vide</span>
<a name="l00673"></a>00673 <span class="comment">// Effets de bord: le flot d&#39;entree est modifie</span>
<a name="l00674"></a>00674 <span class="comment">// Postcondition:</span>
<a name="l00675"></a>00675 <span class="comment">//</span>
<a name="l00676"></a>00676 <span class="comment">//</span><span class="comment"></span>
<a name="l00677"></a>00677 <span class="comment">//! Lecture des conditions limites sur un flot d&#39;entree.&lt;br&gt;voir Zone_Cl_dis_base::readOn</span>
<a name="l00678"></a>00678 <span class="comment"></span><span class="comment">/** \return Entree\&amp;&lt;br&gt;</span>
<a name="l00679"></a>00679 <span class="comment">Signification: le flot d&#39;entree modifie&lt;br&gt;</span>
<a name="l00680"></a>00680 <span class="comment">Contraintes: */</span>
<a name="l00681"></a><a class="code" href="classEquation__base.html#a5850585c3a61422d75c0849a6e8cf769">00681</a> <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classEquation__base.html#a5850585c3a61422d75c0849a6e8cf769" title="Lecture des conditions limites sur un flot d&#39;entree. voir Zone_Cl_dis_base::readOn.">Equation_base::lire_cl</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00682"></a>00682 {
<a name="l00683"></a>00683   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Reading of boundaries conditions\n&quot;</span>;
<a name="l00684"></a>00684   <span class="keywordflow">if</span>(!<a class="code" href="classEquation__base.html#aa097c6ddc00bdb913c39739689f6d5c4">la_zone_Cl_dis</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>())
<a name="l00685"></a>00685     {
<a name="l00686"></a>00686       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error while reading boundaries conditions : &quot;</span> &lt;&lt;
<a name="l00687"></a>00687            <a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00688"></a>00688       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;The Zone_Cl_dis is empty ...&quot;</span> &lt;&lt; finl;
<a name="l00689"></a>00689       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00690"></a>00690     }
<a name="l00691"></a>00691   is &gt;&gt; <a class="code" href="classEquation__base.html#aa097c6ddc00bdb913c39739689f6d5c4">la_zone_Cl_dis</a>.<a class="code" href="classDeriv__Zone__Cl__dis__base.html#a6b56880f00b604e1f13970ec6d5bc077">valeur</a>();
<a name="l00692"></a>00692   <span class="keywordflow">return</span> is;
<a name="l00693"></a>00693 }
<a name="l00694"></a>00694 
<a name="l00695"></a>00695 <span class="comment">// Precondition:</span>
<a name="l00696"></a>00696 <span class="comment">// Parametre: Sortie&amp; os</span>
<a name="l00697"></a>00697 <span class="comment">// Signification:</span>
<a name="l00698"></a>00698 <span class="comment">// Valeurs par defaut:</span>
<a name="l00699"></a>00699 <span class="comment">// Contraintes:</span>
<a name="l00700"></a>00700 <span class="comment">// Acces: entree/sortie</span>
<a name="l00701"></a>00701 <span class="comment">// Exception:</span>
<a name="l00702"></a>00702 <span class="comment">// Effets de bord: le flot de sortie est modifie</span>
<a name="l00703"></a>00703 <span class="comment">// Postcondition: la methode ne modifie pas l&#39;objet</span>
<a name="l00704"></a>00704 <span class="comment">//</span><span class="comment"></span>
<a name="l00705"></a>00705 <span class="comment">//! On sauvegarde l&#39;inconnue de l&#39;equation sur un flot de sortie.</span>
<a name="l00706"></a>00706 <span class="comment"></span><span class="comment">/** \return int&lt;br&gt;</span>
<a name="l00707"></a>00707 <span class="comment">Signification: le code de retour de Champ_Inc::sauvegarder()&lt;br&gt;</span>
<a name="l00708"></a>00708 <span class="comment">Contraintes: */</span>
<a name="l00709"></a><a class="code" href="classEquation__base.html#af55e69d226254112762f1bfc68e63fc0">00709</a> <span class="keywordtype">int</span> <a class="code" href="classEquation__base.html#af55e69d226254112762f1bfc68e63fc0" title="On sauvegarde l&#39;inconnue de l&#39;equation sur un flot de sortie.">Equation_base::sauvegarder</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os)<span class="keyword"> const</span>
<a name="l00710"></a>00710 <span class="keyword"></span>{
<a name="l00711"></a>00711   <span class="keywordflow">return</span> <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().<a class="code" href="classChamp__Inc.html#a454ab8f891f10bfd54449b12f8d44f52" title="Appel a l&#39;objet sous-jacent Effectue une sauvegarde sur un flot de sortie.">sauvegarder</a>(os);
<a name="l00712"></a>00712 }
<a name="l00713"></a>00713 
<a name="l00714"></a>00714 <span class="comment">// Precondition:</span>
<a name="l00715"></a>00715 <span class="comment">// Parametre: Entree&amp; fich</span>
<a name="l00716"></a>00716 <span class="comment">// Signification: le flot d&#39;entree (fichier) a lire</span>
<a name="l00717"></a>00717 <span class="comment">// Valeurs par defaut:</span>
<a name="l00718"></a>00718 <span class="comment">// Contraintes:</span>
<a name="l00719"></a>00719 <span class="comment">// Acces: entree/sortie</span>
<a name="l00720"></a>00720 <span class="comment">// Exception: erreur de reprise, fin de fichier atteinte sans trouver l&#39;inconnue</span>
<a name="l00721"></a>00721 <span class="comment">// Effets de bord: l&#39;inconnue assciee au probleme est mise a jour</span>
<a name="l00722"></a>00722 <span class="comment">// le flot d&#39;entree est modifie</span>
<a name="l00723"></a>00723 <span class="comment">// Postcondition:</span>
<a name="l00724"></a>00724 <span class="comment">//</span>
<a name="l00725"></a>00725 <span class="comment">//</span>
<a name="l00726"></a>00726 <span class="comment">//</span>
<a name="l00727"></a>00727 <span class="comment">//</span><span class="comment"></span>
<a name="l00728"></a>00728 <span class="comment">//! On reprend l&#39;inconnue a partir d&#39;un flot d&#39;entree.&lt;br&gt;[ON CHERCHE L&#39;INCONNUE PAR SON NOM]&lt;br&gt;[ON LIT L&#39;INCONNUE]&lt;br&gt;Voir Champ_Inc::reprendre(Entree\&amp;)</span>
<a name="l00729"></a>00729 <span class="comment"></span><span class="comment">/** \return int&lt;br&gt;</span>
<a name="l00730"></a>00730 <span class="comment">Signification: renvoie toujours 1&lt;br&gt;</span>
<a name="l00731"></a>00731 <span class="comment">Contraintes: */</span>
<a name="l00732"></a><a class="code" href="classEquation__base.html#a0b31997a74fe7eeef7634fcff096b3f6">00732</a> <span class="keywordtype">int</span> <a class="code" href="classEquation__base.html#a0b31997a74fe7eeef7634fcff096b3f6" title="On reprend l&#39;inconnue a partir d&#39;un flot d&#39;entree. [ON CHERCHE L&#39;INCONNUE PAR SON NOM] [ON LIT L&#39;INCO...">Equation_base::reprendre</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; fich)
<a name="l00733"></a>00733 {
<a name="l00734"></a>00734   <span class="keywordtype">double</span> temps = <a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a5054df01edb6d4f7baec7e612d423834" title="Renvoie le temps courant.">temps_courant</a>();
<a name="l00735"></a>00735   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> field_tag(<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().<a class="code" href="classEquation__base.html#a65e9b2520ac7b42444e4d9aa4f18ccf7" title="Renvoie le nom de l&#39;equation.">le_nom</a>());
<a name="l00736"></a>00736   field_tag += <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().<a class="code" href="classDeriv__Champ__Inc__base.html#a9e0b743a3e124e7114fa977b36b68225">valeur</a>().<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>();
<a name="l00737"></a>00737   field_tag += <a class="code" href="classEquation__base.html#aa8151a96f63719523bf50ddd832e0f8f" title="Renvoie le probleme associe a l&#39;equation.">probleme</a>().<a class="code" href="classProbleme__base.html#afa73c54a5b6b111e0f08cd1ab3608178" title="Renvoie le domaine associe au probleme. (version const)">domaine</a>().<a class="code" href="classDomaine.html#a87e2cdc035a26565e6fe481446aa4cd3" title="Renvoie le nom du domaine.">le_nom</a>();
<a name="l00738"></a>00738   field_tag += <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(temps,<a class="code" href="classEquation__base.html#aa8151a96f63719523bf50ddd832e0f8f" title="Renvoie le probleme associe a l&#39;equation.">probleme</a>().reprise_format_temps());
<a name="l00739"></a>00739   <a class="code" href="Avanc_8cpp.html#ae61571402d637eb7962957b7714ffc33">avancer_fichier</a>(fich, field_tag);
<a name="l00740"></a>00740   <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().<a class="code" href="classChamp__Inc.html#a1a11a937f6d82d26f2d708e4a7b85d36" title="Appel a l&#39;objet sous-jacent Effectue une reprise sur un flot d&#39;entree.">reprendre</a>(fich);
<a name="l00741"></a>00741   <span class="keywordflow">return</span> 1;
<a name="l00742"></a>00742 }
<a name="l00743"></a>00743 
<a name="l00744"></a>00744 <span class="comment">// Precondition:</span>
<a name="l00745"></a>00745 <span class="comment">// Parametre:</span>
<a name="l00746"></a>00746 <span class="comment">// Signification:</span>
<a name="l00747"></a>00747 <span class="comment">// Valeurs par defaut:</span>
<a name="l00748"></a>00748 <span class="comment">// Contraintes:</span>
<a name="l00749"></a>00749 <span class="comment">// Acces:</span>
<a name="l00750"></a>00750 <span class="comment">// Exception:</span>
<a name="l00751"></a>00751 <span class="comment">// Effets de bord:</span>
<a name="l00752"></a>00752 <span class="comment">// Postcondition: la methode ne modifie pas l&#39;objet.</span>
<a name="l00753"></a>00753 <span class="comment">//</span>
<a name="l00754"></a>00754 <span class="comment">//</span>
<a name="l00755"></a>00755 <span class="comment">//</span><span class="comment"></span>
<a name="l00756"></a>00756 <span class="comment">//! Demande au schema en temps si il faut effectuer une impression.&lt;br&gt;Renvoie 1 si il faut effectuer une impression.&lt;br&gt;Appel simple a Schema_Temps_base::limpr()</span>
<a name="l00757"></a>00757 <span class="comment"></span><span class="comment">/** \return int&lt;br&gt;</span>
<a name="l00758"></a>00758 <span class="comment">Signification: 1 si il faut effectuer une impression, 0 sinon.&lt;br&gt;</span>
<a name="l00759"></a>00759 <span class="comment">Contraintes: */</span>
<a name="l00760"></a><a class="code" href="classEquation__base.html#a864f40c89a8f90da70f177f7304d0f19">00760</a> <span class="keywordtype">int</span> <a class="code" href="classEquation__base.html#a864f40c89a8f90da70f177f7304d0f19" title="Demande au schema en temps si il faut effectuer une impression. Renvoie 1 si il faut effectuer une im...">Equation_base::limpr</a>()<span class="keyword"> const</span>
<a name="l00761"></a>00761 <span class="keyword"></span>{
<a name="l00762"></a>00762   <span class="keywordflow">return</span> <a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>-&gt;limpr();
<a name="l00763"></a>00763 }
<a name="l00764"></a>00764 
<a name="l00765"></a>00765 <span class="comment">// Precondition:</span>
<a name="l00766"></a>00766 <span class="comment">// Parametre: Sortie&amp; os</span>
<a name="l00767"></a>00767 <span class="comment">// Signification: le flot de sortie</span>
<a name="l00768"></a>00768 <span class="comment">// Valeurs par defaut:</span>
<a name="l00769"></a>00769 <span class="comment">// Contraintes:</span>
<a name="l00770"></a>00770 <span class="comment">// Acces: entree/sortie</span>
<a name="l00771"></a>00771 <span class="comment">// Exception:</span>
<a name="l00772"></a>00772 <span class="comment">// Effets de bord: le flot de sortie est modifie</span>
<a name="l00773"></a>00773 <span class="comment">// Postcondition: la methode ne modifie pas l&#39;objet</span>
<a name="l00774"></a>00774 <span class="comment">//</span>
<a name="l00775"></a>00775 <span class="comment">//</span>
<a name="l00776"></a>00776 <span class="comment">//</span><span class="comment"></span>
<a name="l00777"></a>00777 <span class="comment">//! Imprime les operateurs de l&#39;equation sur un flot de sortie,&lt;br&gt;de facon inconditionnelle.&lt;br&gt;appelle Operateur_base::impr(os)</span>
<a name="l00778"></a>00778 <span class="comment"></span><span class="comment">/** \return int&lt;br&gt;</span>
<a name="l00779"></a>00779 <span class="comment">Signification: renvoie toujours 1&lt;br&gt;</span>
<a name="l00780"></a>00780 <span class="comment">Contraintes: */</span>
<a name="l00781"></a><a class="code" href="classEquation__base.html#afe3e1fe1bcc08f1e22d24d823a403fc7">00781</a> <span class="keywordtype">int</span> <a class="code" href="classEquation__base.html#afe3e1fe1bcc08f1e22d24d823a403fc7" title="Imprime les operateurs de l&#39;equation sur un flot de sortie, de facon inconditionnelle. appelle Operateur_base::impr(os)">Equation_base::impr</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os)<span class="keyword"> const</span>
<a name="l00782"></a>00782 <span class="keyword"></span>{
<a name="l00783"></a>00783   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>(); i++)
<a name="l00784"></a>00784     <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).<a class="code" href="classOperateur.html#aaedb62a510abf7d73256488f5d69ea29" title="Imprime l&#39;operateur sur un flot de sortie de facon inconditionnelle.">impr</a>(os);
<a name="l00785"></a>00785 <span class="comment">// if (je_suis_maitre() &amp;&amp; les_sources.size()&gt;0) os &lt;&lt; finl &lt;&lt; &quot;Impression des termes sources pour l&#39;equation &quot; &lt;&lt; que_suis_je() &lt;&lt; &quot; : &quot; &lt;&lt; finl;</span>
<a name="l00786"></a>00786   <a class="code" href="classEquation__base.html#a6dae2cb8a228b0e3a6d90042fd75f360">les_sources</a>.<a class="code" href="classSources.html#ab470b3804e6566049797123e6d1f65b7" title="Appelle Source::impr() sur toutes les sources de la liste. voir Source_base::impr().">impr</a>(os);
<a name="l00787"></a>00787   <span class="keywordflow">return</span> 1;
<a name="l00788"></a>00788 }
<a name="l00789"></a>00789 
<a name="l00790"></a>00790 <span class="comment">// Precondition:</span>
<a name="l00791"></a>00791 <span class="comment">// Parametre: Sortie&amp; os</span>
<a name="l00792"></a>00792 <span class="comment">// Signification: le flot de sortie</span>
<a name="l00793"></a>00793 <span class="comment">// Valeurs par defaut:</span>
<a name="l00794"></a>00794 <span class="comment">// Contraintes:</span>
<a name="l00795"></a>00795 <span class="comment">// Acces:</span>
<a name="l00796"></a>00796 <span class="comment">// </span>
<a name="l00797"></a>00797 <span class="comment">// Signification:</span>
<a name="l00798"></a>00798 <span class="comment">// Contraintes:</span>
<a name="l00799"></a>00799 <span class="comment">// Exception:</span>
<a name="l00800"></a>00800 <span class="comment">// Effets de bord: le flot de sortie peut etre modifie</span>
<a name="l00801"></a>00801 <span class="comment">// Postcondition: la methode ne modifie pas l&#39;objet</span>
<a name="l00802"></a>00802 <span class="comment">//</span>
<a name="l00803"></a>00803 <span class="comment">//</span>
<a name="l00804"></a>00804 <span class="comment">//</span><span class="comment"></span>
<a name="l00805"></a>00805 <span class="comment">//! Imprime les operateurs de l&#39;equation si le schema en temps&lt;br&gt;indique que c&#39;est necessaire.&lt;br&gt;[SI limpr() ALORS impr(os)]</span>
<a name="l00806"></a><a class="code" href="classEquation__base.html#acc8a782c7da089abfedf53b7d920d14e">00806</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#acc8a782c7da089abfedf53b7d920d14e" title="Imprime les operateurs de l&#39;equation si le schema en temps indique que c&#39;est necessaire. [SI limpr() ALORS impr(os)].">Equation_base::imprimer</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os)<span class="keyword"> const</span>
<a name="l00807"></a>00807 <span class="keyword"></span>{
<a name="l00808"></a>00808   <a class="code" href="classEquation__base.html#acab5bf5d880c64543cd5f8b7b19fa181" title="Ecrit dans un fichier les valeurs du champ specifie par le mot cle &quot;ecrire_fichier_xyz_valeur&quot;.">ecrire_fichier_xyz</a>();
<a name="l00809"></a>00809   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a864f40c89a8f90da70f177f7304d0f19" title="Demande au schema en temps si il faut effectuer une impression. Renvoie 1 si il faut effectuer une im...">limpr</a>() )
<a name="l00810"></a>00810     <a class="code" href="classEquation__base.html#afe3e1fe1bcc08f1e22d24d823a403fc7" title="Imprime les operateurs de l&#39;equation sur un flot de sortie, de facon inconditionnelle. appelle Operateur_base::impr(os)">impr</a>(os);
<a name="l00811"></a>00811 }
<a name="l00812"></a>00812 
<a name="l00813"></a>00813 <span class="comment">//</span>
<a name="l00814"></a>00814 <span class="comment">//</span>
<a name="l00815"></a>00815 <span class="comment">//</span>
<a name="l00816"></a>00816 <span class="comment">//</span><span class="comment"></span>
<a name="l00817"></a>00817 <span class="comment">//! Returns the time derivative of the unknown I of the equation:&lt;br&gt;dI/dt = M-1*(sum(operators(I) + sources))&lt;br&gt;In : derivee contains I (but immediatly set to 0)&lt;br&gt;Out: derivee contains dI/dt</span>
<a name="l00818"></a><a class="code" href="classEquation__base.html#a97aa87b0cf6205ef437a6774adf1bd47">00818</a> <span class="comment"></span><a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; <a class="code" href="classEquation__base.html#a97aa87b0cf6205ef437a6774adf1bd47" title="Returns the time derivative of the unknown I of the equation: dI/dt = M-1*(sum(operators(I) + sources...">Equation_base::derivee_en_temps_inco</a>(<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; derivee)
<a name="l00819"></a>00819 {
<a name="l00820"></a>00820   derivee=0;
<a name="l00821"></a>00821   <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> secmem(derivee);
<a name="l00822"></a>00822 <span class="comment">// secmem = sum(operators) + sources + equation specific terms</span>
<a name="l00823"></a>00823   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().diffusion_implicite())
<a name="l00824"></a>00824     {
<a name="l00825"></a>00825 <span class="comment">// Add convection operator only if equation has one</span>
<a name="l00826"></a>00826       derivee=<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>();
<a name="l00827"></a>00827       <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>()&gt;1)
<a name="l00828"></a>00828         <a class="code" href="classEquation__base.html#a20d04d53bd0c4b48aa923c2b328bb1e3" title="Add convection term In: solution is the unknown I Out: secmem is increased by convection(I)">derivee_en_temps_conv</a>(secmem, derivee);
<a name="l00829"></a>00829     }
<a name="l00830"></a>00830   <span class="keywordflow">else</span>
<a name="l00831"></a>00831     {
<a name="l00832"></a>00832 <span class="comment">// Add all explicit operators</span>
<a name="l00833"></a>00833       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>(); i++)
<a name="l00834"></a>00834         <span class="keywordflow">if</span>(<a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#ae7dae6829b1287b470717b08a8ae761e">get_decal_temps</a>()!=1)
<a name="l00835"></a>00835           <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).<a class="code" href="classOperateur.html#accdf61cf1e33fb42e9eb06f1c501422b">ajouter</a>(secmem);
<a name="l00836"></a>00836     }
<a name="l00837"></a>00837   <a class="code" href="classEquation__base.html#a6dae2cb8a228b0e3a6d90042fd75f360">les_sources</a>.<a class="code" href="classSources.html#a6fc277f1920a71841cb041dc1b6ed771" title="Ajoute la contribution de toutes les sources de la liste au tableau passe en parametre, et renvoie ce tableau.">ajouter</a>(secmem);
<a name="l00838"></a>00838 
<a name="l00839"></a>00839   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#ade5df25cd0183395ae30a9865e23611c">calculate_time_derivative</a>())
<a name="l00840"></a>00840     {
<a name="l00841"></a>00841 <span class="comment">// Store dI/dt(n) = M-1 secmem :</span>
<a name="l00842"></a>00842       <a class="code" href="classEquation__base.html#a10fb27f5c41123bf4ff96e616549f6d7">derivee_en_temps</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>()=secmem;
<a name="l00843"></a>00843       <a class="code" href="classEquation__base.html#aaaf61d60cca8205d2490a023633cc7d4">solveur_masse</a>.<a class="code" href="classSolveur__Masse.html#af7afe8c2d4d5764f7428f2cd4ef43ddb" title="Appel a l&#39;objet sous-jacent. Resoud le systeme lineaire, dont la matrice est la matrice de masse...">appliquer</a>(<a class="code" href="classEquation__base.html#a10fb27f5c41123bf4ff96e616549f6d7">derivee_en_temps</a>().valeurs());
<a name="l00844"></a>00844       <a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#aa363b76fa823b37bf9d1ae784f33bbfa">modifier_second_membre</a>((*<span class="keyword">this</span>),secmem); <span class="comment">//!&lt; Change secmem for some schemes (eg: Adams_Bashforth)</span>
<a name="l00845"></a>00845 <span class="comment"></span>    }
<a name="l00846"></a>00846 
<a name="l00847"></a>00847   <a class="code" href="classEquation__base.html#a5c06feed3927199a5ff70fb1c3a10f2a">corriger_derivee_expl</a>(secmem); <span class="comment">//!&lt; Add specific term for an equation (eg: -gradP for Navier Stokes)</span>
<a name="l00848"></a>00848 <span class="comment"></span>
<a name="l00849"></a>00849   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#aef791a4afd5964d1b4dfd3d2ac3f5e5e">implicite_</a>==0)
<a name="l00850"></a>00850     {
<a name="l00851"></a>00851       <a class="code" href="classEquation__base.html#aaaf61d60cca8205d2490a023633cc7d4">solveur_masse</a>.<a class="code" href="classSolveur__Masse.html#af7afe8c2d4d5764f7428f2cd4ef43ddb" title="Appel a l&#39;objet sous-jacent. Resoud le systeme lineaire, dont la matrice est la matrice de masse...">appliquer</a>(secmem); <span class="comment">//!&lt; M-1 * secmem</span>
<a name="l00852"></a>00852 <span class="comment"></span>      <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().diffusion_implicite())
<a name="l00853"></a>00853         {
<a name="l00854"></a>00854 <span class="comment">// Solve: (1/dt + M-1*A)*dI = M-1 * secmem</span>
<a name="l00855"></a>00855 <span class="comment">// where A is the diffusion</span>
<a name="l00856"></a>00856           <a class="code" href="classEquation__base.html#abd67532530f67b3305703a130a5d823a">Equation_base::Gradient_conjugue_diff_impl</a>(secmem, derivee);
<a name="l00857"></a>00857         }
<a name="l00858"></a>00858       <span class="keywordflow">else</span>
<a name="l00859"></a>00859         {
<a name="l00860"></a>00860           derivee = secmem;
<a name="l00861"></a>00861           derivee.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l00862"></a>00862         }
<a name="l00863"></a>00863       <a class="code" href="classEquation__base.html#ab1a4dff7878cb1c47efb1ecb7b5b31ae">corriger_derivee_impl</a>(derivee);  <span class="comment">//!&lt; Solve specific implicit term for an equation (eg: pressure for Navier Stokes)</span>
<a name="l00864"></a>00864 <span class="comment"></span>    }
<a name="l00865"></a>00865   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#aef791a4afd5964d1b4dfd3d2ac3f5e5e">implicite_</a>&gt;0)
<a name="l00866"></a>00866     {
<a name="l00867"></a>00867 <span class="comment">// TRUST support notices that this part has never been covered...</span>
<a name="l00868"></a>00868 <span class="comment">// implicite</span>
<a name="l00869"></a>00869 <span class="comment">// M dU/dt + AU* = f -BUn;</span>
<a name="l00870"></a>00870 <span class="comment">// U* = Un+dt dU/dt</span>
<a name="l00871"></a>00871 <span class="comment">// (M/dt + A) U* = f -BUn + M/dt Un</span>
<a name="l00872"></a>00872 <span class="comment">// </span>
<a name="l00873"></a>00873       <span class="keywordtype">double</span> dt=<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a0e4f67ef6086c09434ddc161668077b2" title="Renvoie le pas de temps (delta_t) courant.">pas_de_temps</a>();
<a name="l00874"></a>00874       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>(); i++)
<a name="l00875"></a>00875         {
<a name="l00876"></a>00876 <span class="comment">// boucle sur les operateurs</span>
<a name="l00877"></a>00877           <a class="code" href="classOperateur__base.html" title="classe Operateur_base Classe est la base de la hierarchie des objets representant un operateur utilis...">Operateur_base</a>&amp; op=<a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>();
<a name="l00878"></a>00878           <span class="keywordflow">if</span>(!op.<a class="code" href="classOperateur__base.html#a02e406fee1f2f32954a0fc6f1b86dca8">get_matrice</a>().<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>())
<a name="l00879"></a>00879             op.<a class="code" href="classOperateur__base.html#a58bbc3d85feaa143ec0d87e68d8fe137">set_matrice</a>().<a class="code" href="classDeriv__.html#ad1d33400ed15b6ff96579ed82d9e2719" title="Essaie de creer une instance du type &quot;type&quot;. si type n&#39;est pas un type ou type n&#39;est pas instanciab...">typer</a>(<span class="stringliteral">&quot;Matrice_Morse&quot;</span>);
<a name="l00880"></a>00880           <span class="keywordflow">if</span>(op.<a class="code" href="classOperateur__base.html#ae7dae6829b1287b470717b08a8ae761e">get_decal_temps</a>()==1)
<a name="l00881"></a>00881             {
<a name="l00882"></a>00882 <span class="comment">// if (op.set_matrice().valeur().nb_lignes()&lt;2)</span>
<a name="l00883"></a>00883               {
<a name="l00884"></a>00884                 <a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a>&amp; matrice=<a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a>,op.<a class="code" href="classOperateur__base.html#a58bbc3d85feaa143ec0d87e68d8fe137">set_matrice</a>().<a class="code" href="classDeriv__Matrice__Base.html#ae43f3a90ca16518c191f9e7d5ebef912">valeur</a>());
<a name="l00885"></a>00885                 op.<a class="code" href="classOperateur__base.html#a66ef3c42e72d13fce0852ba92e56be6a" title="NE FAIT RIEN A surcharger dans les classes derivees.">dimensionner</a>(matrice);
<a name="l00886"></a>00886                 <a class="code" href="classEquation__base.html#afd09d18db565d1acb431885b9c6d4a55">sys_invariant_</a>=0;
<a name="l00887"></a>00887               }
<a name="l00888"></a>00888               <span class="keywordflow">if</span>(!<a class="code" href="classEquation__base.html#afd09d18db565d1acb431885b9c6d4a55">sys_invariant_</a>)
<a name="l00889"></a>00889                 {
<a name="l00890"></a>00890                   <a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a>&amp; matrice=<a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a>, op.<a class="code" href="classOperateur__base.html#a58bbc3d85feaa143ec0d87e68d8fe137">set_matrice</a>().<a class="code" href="classDeriv__Matrice__Base.html#ae43f3a90ca16518c191f9e7d5ebef912">valeur</a>());
<a name="l00891"></a>00891                   op.<a class="code" href="classOperateur__base.html#a903e728aad8e2d490580bf264319d65f" title="NE FAIT RIEN A surcharger dans les classes derivees.">contribuer_a_avec</a>(<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().valeurs(), matrice);
<a name="l00892"></a>00892                   <a class="code" href="classEquation__base.html#adfedf474c07a92f6b2261ca2f1cee80e" title="Renvoie le solveur de masse associe a l&#39;equation.">solv_masse</a>().<a class="code" href="classSolveur__Masse.html#adc554d2f7efe81e71ff8995d4f2df8c7">ajouter_masse</a>(dt, op.<a class="code" href="classOperateur__base.html#a58bbc3d85feaa143ec0d87e68d8fe137">set_matrice</a>().<a class="code" href="classDeriv__Matrice__Base.html#ae43f3a90ca16518c191f9e7d5ebef912">valeur</a>());
<a name="l00893"></a>00893 
<a name="l00894"></a>00894                   <span class="keywordflow">if</span>(
<a name="l00895"></a>00895                     (op.<a class="code" href="classOperateur__base.html#a2861e28bd5b9d3484c73271209b2e0b6">get_solveur</a>()-&gt;<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>()==<span class="stringliteral">&quot;Solv_Cholesky&quot;</span>)
<a name="l00896"></a>00896                     ||
<a name="l00897"></a>00897                     (op.<a class="code" href="classOperateur__base.html#a2861e28bd5b9d3484c73271209b2e0b6">get_solveur</a>()-&gt;<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>()==<span class="stringliteral">&quot;Solv_GCP&quot;</span>)
<a name="l00898"></a>00898                   )
<a name="l00899"></a>00899                     {
<a name="l00900"></a>00900                       <a class="code" href="classMatrice__Morse__Sym.html" title="Classe Matrice_Morse_Sym Represente une matrice M (creuse) symetrique stockee au format Morse Symetri...">Matrice_Morse_Sym</a> new_mat(matrice);
<a name="l00901"></a>00901                       new_mat.<a class="code" href="classMatrice__Sym.html#a532cf830aed3865010c9977b545927c0">set_est_definie</a>(1);
<a name="l00902"></a>00902                       op.<a class="code" href="classOperateur__base.html#a58bbc3d85feaa143ec0d87e68d8fe137">set_matrice</a>()=new_mat;
<a name="l00903"></a>00903                       <a class="code" href="Cast_8h.html#ad3836a067c92103af8df5ad8f35959a6">ref_cast_non_const</a>(<a class="code" href="classSolveurSys.html">SolveurSys</a>,op.<a class="code" href="classOperateur__base.html#a2861e28bd5b9d3484c73271209b2e0b6">get_solveur</a>())-&gt;reinit();
<a name="l00904"></a>00904                     }
<a name="l00905"></a>00905                 }
<a name="l00906"></a>00906             }
<a name="l00907"></a>00907         }
<a name="l00908"></a>00908       <span class="keywordflow">if</span>(<a class="code" href="classEquation__base.html#aef791a4afd5964d1b4dfd3d2ac3f5e5e">implicite_</a>==1)
<a name="l00909"></a>00909         {
<a name="l00910"></a>00910 <span class="comment">// Un seul operateur implicite.</span>
<a name="l00911"></a>00911 <span class="comment">// On suppose que c&#39;est le premier (la diffusion !!)</span>
<a name="l00912"></a>00912           <a class="code" href="classOperateur__base.html" title="classe Operateur_base Classe est la base de la hierarchie des objets representant un operateur utilis...">Operateur_base</a>&amp; op=<a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(0).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>();
<a name="l00913"></a>00913           <a class="code" href="classMatrice__Base.html">Matrice_Base</a>&amp; matrice=op.<a class="code" href="classOperateur__base.html#a58bbc3d85feaa143ec0d87e68d8fe137">set_matrice</a>().<a class="code" href="classDeriv__Matrice__Base.html#ae43f3a90ca16518c191f9e7d5ebef912">valeur</a>();
<a name="l00914"></a>00914 <span class="comment">// DoubleTrav secmem(derivee);</span>
<a name="l00915"></a>00915           secmem=derivee;
<a name="l00916"></a>00916           <a class="code" href="classEquation__base.html#adfedf474c07a92f6b2261ca2f1cee80e" title="Renvoie le solveur de masse associe a l&#39;equation.">solv_masse</a>().<a class="code" href="classSolveur__Masse.html#adc554d2f7efe81e71ff8995d4f2df8c7">ajouter_masse</a>(dt, secmem, <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().valeurs());
<a name="l00917"></a>00917           op.<a class="code" href="classOperateur__base.html#a1b64f0211a360c124a218be15c80d9c7" title="NE FAIT RIEN A surcharger dans les classes derivees.">contribuer_au_second_membre</a>(secmem );
<a name="l00918"></a>00918           op.<a class="code" href="classOperateur__base.html#a2fe69e40852fa946df7685516d3e5c66">set_solveur</a>().<a class="code" href="classSolveurSys.html#a62ca198f0c5dc599e53b0535761e5138">resoudre_systeme</a>(matrice,
<a name="l00919"></a>00919                                             secmem,
<a name="l00920"></a>00920                                             derivee
<a name="l00921"></a>00921                                            );
<a name="l00922"></a>00922           <a class="code" href="classEquation__base.html#adfedf474c07a92f6b2261ca2f1cee80e" title="Renvoie le solveur de masse associe a l&#39;equation.">solv_masse</a>().<a class="code" href="classSolveur__Masse.html#a328dc53fbe227ba188eaf55cd98474b8">corriger_solution</a>(derivee,<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().valeurs());
<a name="l00923"></a>00923 
<a name="l00924"></a>00924           derivee-=<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>();
<a name="l00925"></a>00925           derivee/=dt;
<a name="l00926"></a>00926 
<a name="l00927"></a>00927 <span class="comment">// Sert uniquement a calculer les flux sur les bords quand la diffusion est implicitee !</span>
<a name="l00928"></a>00928           <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> resu;
<a name="l00929"></a>00929           resu=derivee;
<a name="l00930"></a>00930           <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(0).<a class="code" href="classOperateur.html#a203dd066e5203d6e9a02298b8ec12e09">calculer</a>(<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().valeurs(), resu);
<a name="l00931"></a>00931         }
<a name="l00932"></a>00932       <span class="keywordflow">else</span>
<a name="l00933"></a>00933         {
<a name="l00934"></a>00934 <span class="comment">// plusieurs operateurs implicites ...</span>
<a name="l00935"></a>00935           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Must be coded ... &quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00936"></a>00936           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00937"></a>00937         }
<a name="l00938"></a>00938     }
<a name="l00939"></a>00939   <span class="keywordflow">else</span>
<a name="l00940"></a>00940     {
<a name="l00941"></a>00941       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Equation_base::derivee_en_temps_inco&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00942"></a>00942       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;implicite_ = &quot;</span> &lt;&lt; <a class="code" href="classEquation__base.html#aef791a4afd5964d1b4dfd3d2ac3f5e5e">implicite_</a> &lt;&lt; <span class="stringliteral">&quot; has not been initialized!&quot;</span> &lt;&lt; finl;
<a name="l00943"></a>00943       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;May be &quot;</span> &lt;&lt; <a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; <span class="stringliteral">&quot;::completer() method doesn&#39;t call Equation_base::completer()&quot;</span> &lt;&lt; finl;
<a name="l00944"></a>00944       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Contact TRUST support.&quot;</span> &lt;&lt; finl;
<a name="l00945"></a>00945       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00946"></a>00946     }
<a name="l00947"></a>00947   <span class="keywordflow">return</span> derivee;
<a name="l00948"></a>00948 }
<a name="l00949"></a>00949 
<a name="l00950"></a>00950 <span class="comment">// Precondition:</span>
<a name="l00951"></a>00951 <span class="comment">// Parametre:</span>
<a name="l00952"></a>00952 <span class="comment">// Signification:</span>
<a name="l00953"></a>00953 <span class="comment">// Valeurs par defaut:</span>
<a name="l00954"></a>00954 <span class="comment">// Contraintes:</span>
<a name="l00955"></a>00955 <span class="comment">// Acces:</span>
<a name="l00956"></a>00956 <span class="comment">// Exception:</span>
<a name="l00957"></a>00957 <span class="comment">// Effets de bord:</span>
<a name="l00958"></a>00958 <span class="comment">// Postcondition:</span>
<a name="l00959"></a>00959 <span class="comment">//</span><span class="comment"></span>
<a name="l00960"></a>00960 <span class="comment">//! Renvoie le probleme associe a l&#39;equation.</span>
<a name="l00961"></a>00961 <span class="comment"></span><span class="comment">/** \return Probleme_base\&amp;&lt;br&gt;</span>
<a name="l00962"></a>00962 <span class="comment">Signification: le probleme associe a l&#39;equation&lt;br&gt;</span>
<a name="l00963"></a>00963 <span class="comment">Contraintes: */</span>
<a name="l00964"></a><a class="code" href="classEquation__base.html#aa8151a96f63719523bf50ddd832e0f8f">00964</a> <a class="code" href="classProbleme__base.html" title="classe Probleme_base C&#39;est un Probleme_U qui n&#39;est pas un couplage. Le role d&#39;un Probleme_base est la...">Probleme_base</a>&amp; <a class="code" href="classEquation__base.html#aa8151a96f63719523bf50ddd832e0f8f" title="Renvoie le probleme associe a l&#39;equation.">Equation_base::probleme</a>()
<a name="l00965"></a>00965 {
<a name="l00966"></a>00966   <span class="keywordflow">return</span> <a class="code" href="classEquation__base.html#ae2d5662d4d26ee7ebefa134239109275">mon_probleme</a>.<a class="code" href="classRef__Probleme__base.html#ae8c315c3e3321e765a5ca9c27e6322b5">valeur</a>();
<a name="l00967"></a>00967 }
<a name="l00968"></a>00968 
<a name="l00969"></a>00969 <span class="comment">// Precondition:</span>
<a name="l00970"></a>00970 <span class="comment">// Parametre:</span>
<a name="l00971"></a>00971 <span class="comment">// Signification:</span>
<a name="l00972"></a>00972 <span class="comment">// Valeurs par defaut:</span>
<a name="l00973"></a>00973 <span class="comment">// Contraintes:</span>
<a name="l00974"></a>00974 <span class="comment">// Acces:</span>
<a name="l00975"></a>00975 <span class="comment">// Exception:</span>
<a name="l00976"></a>00976 <span class="comment">// Effets de bord:</span>
<a name="l00977"></a>00977 <span class="comment">// Postcondition:</span>
<a name="l00978"></a>00978 <span class="comment">//</span>
<a name="l00979"></a>00979 <span class="comment">//</span><span class="comment"></span>
<a name="l00980"></a>00980 <span class="comment">//! Renvoie le probleme associe a l&#39;equation.&lt;br&gt;(version const)</span>
<a name="l00981"></a>00981 <span class="comment"></span><span class="comment">/** \return Probleme_base\&amp;&lt;br&gt;</span>
<a name="l00982"></a>00982 <span class="comment">Signification: le probleme associe a l&#39;equation&lt;br&gt;</span>
<a name="l00983"></a>00983 <span class="comment">Contraintes: reference constante */</span>
<a name="l00984"></a><a class="code" href="classEquation__base.html#a24e18ecdcf583db9f2ce06a4e54b104c">00984</a> <span class="keyword">const</span> <a class="code" href="classProbleme__base.html" title="classe Probleme_base C&#39;est un Probleme_U qui n&#39;est pas un couplage. Le role d&#39;un Probleme_base est la...">Probleme_base</a>&amp; <a class="code" href="classEquation__base.html#aa8151a96f63719523bf50ddd832e0f8f" title="Renvoie le probleme associe a l&#39;equation.">Equation_base::probleme</a>()<span class="keyword"> const</span>
<a name="l00985"></a>00985 <span class="keyword"></span>{
<a name="l00986"></a>00986   <span class="keywordflow">return</span> <a class="code" href="classEquation__base.html#ae2d5662d4d26ee7ebefa134239109275">mon_probleme</a>.<a class="code" href="classRef__Probleme__base.html#ae8c315c3e3321e765a5ca9c27e6322b5">valeur</a>();
<a name="l00987"></a>00987 }
<a name="l00988"></a>00988 
<a name="l00989"></a>00989 <span class="comment">//</span>
<a name="l00990"></a>00990 <span class="comment">//</span><span class="comment"></span>
<a name="l00991"></a>00991 <span class="comment">//! Methode appelee lorsqu&#39;on cree l&#39;instance de l&#39;objet dans&lt;br&gt;le jeu de donnees (Interprete::ajouter)</span>
<a name="l00992"></a><a class="code" href="classEquation__base.html#a23454aaa65e3900c8d8c2c02f994c2e4">00992</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#a23454aaa65e3900c8d8c2c02f994c2e4" title="Methode appelee lorsqu&#39;on cree l&#39;instance de l&#39;objet dans le jeu de donnees (Interprete::ajouter)">Equation_base::nommer</a>(<span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; un_nom)
<a name="l00993"></a>00993 {
<a name="l00994"></a>00994   <a class="code" href="classEquation__base.html#a9e2143e3ca5f68c2c02220b7fec06248">nom_</a> = un_nom;
<a name="l00995"></a>00995 }
<a name="l00996"></a>00996 
<a name="l00997"></a>00997 <span class="comment">// Precondition:</span>
<a name="l00998"></a>00998 <span class="comment">// Parametre: Probleme_base&amp; pb</span>
<a name="l00999"></a>00999 <span class="comment">// Signification: le probleme auquel l&#39;equation doit s&#39;associer</span>
<a name="l01000"></a>01000 <span class="comment">// Valeurs par defaut:</span>
<a name="l01001"></a>01001 <span class="comment">// Contraintes: reference constante</span>
<a name="l01002"></a>01002 <span class="comment">// Acces: entree</span>
<a name="l01003"></a>01003 <span class="comment">// </span>
<a name="l01004"></a>01004 <span class="comment">// Signification:</span>
<a name="l01005"></a>01005 <span class="comment">// Contraintes:</span>
<a name="l01006"></a>01006 <span class="comment">// Exception:</span>
<a name="l01007"></a>01007 <span class="comment">// Effets de bord: en sortie les operateurs sont associes a l&#39;equation,</span>
<a name="l01008"></a>01008 <span class="comment">// Postcondition: l&#39;equation a un probleme associe</span>
<a name="l01009"></a>01009 <span class="comment">//</span>
<a name="l01010"></a>01010 <span class="comment">//</span>
<a name="l01011"></a>01011 <span class="comment">//</span><span class="comment"></span>
<a name="l01012"></a>01012 <span class="comment">//! S&#39;associe au Probleme passe en parametre.&lt;br&gt;Associe egalement les sources, les operateurs et le solveur&lt;br&gt;de masse a l&#39;equation.</span>
<a name="l01013"></a><a class="code" href="classEquation__base.html#a3b6b408360358fb75bfe61e9c65f771c">01013</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#a3b6b408360358fb75bfe61e9c65f771c" title="S&#39;associe au Probleme passe en parametre. Associe egalement les sources, les operateurs et le solveur...">Equation_base::associer_pb_base</a>(<span class="keyword">const</span> <a class="code" href="classProbleme__base.html" title="classe Probleme_base C&#39;est un Probleme_U qui n&#39;est pas un couplage. Le role d&#39;un Probleme_base est la...">Probleme_base</a>&amp; pb)
<a name="l01014"></a>01014 {
<a name="l01015"></a>01015   <a class="code" href="classEquation__base.html#ae2d5662d4d26ee7ebefa134239109275">mon_probleme</a>=pb;
<a name="l01016"></a>01016 <span class="comment">// Modif B. Mathieu : pour le front_tracking, le nom de l&#39;equation</span>
<a name="l01017"></a>01017 <span class="comment">// est donne dans le jeu de donnees lors de l&#39;instanciation de l&#39;objet</span>
<a name="l01018"></a>01018 <span class="comment">// (la methode &quot;nommer&quot; est appelee a ce moment).</span>
<a name="l01019"></a>01019 <span class="comment">// Si l&#39;equation n&#39;est pas instanciee, le nom est vide, on donne</span>
<a name="l01020"></a>01020 <span class="comment">// le nom par defaut qui est defini ci-dessous :</span>
<a name="l01021"></a>01021   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> nom_vide;
<a name="l01022"></a>01022   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a9e2143e3ca5f68c2c02220b7fec06248">nom_</a> == nom_vide)
<a name="l01023"></a>01023     {
<a name="l01024"></a>01024       <a class="code" href="classEquation__base.html#a9e2143e3ca5f68c2c02220b7fec06248">nom_</a> = pb.<a class="code" href="classProbleme__base.html#a58bc0b101f3f3f1d8522a9f41f1fad7b" title="surcharge Objet_U::le_nom() Renvoie le nom du probleme">le_nom</a>();
<a name="l01025"></a>01025       <a class="code" href="classEquation__base.html#a9e2143e3ca5f68c2c02220b7fec06248">nom_</a> += <a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>();
<a name="l01026"></a>01026     }
<a name="l01027"></a>01027 <span class="comment">// fin modif B.M.</span>
<a name="l01028"></a>01028   <a class="code" href="classEquation__base.html#a6dae2cb8a228b0e3a6d90042fd75f360">les_sources</a>.<a class="code" href="classMorEqn.html#a1a6c57edd46cc696aa45c6b01a76e14c" title="Associe une equation a l&#39;objet. Affecte le membre MorEqn::mon_equation avec l&#39;objet passe en parametr...">associer_eqn</a>(*<span class="keyword">this</span>);
<a name="l01029"></a>01029   <span class="keywordtype">int</span> nb_op = <a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>();
<a name="l01030"></a>01030   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;nb_op; i++)
<a name="l01031"></a>01031     <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).<a class="code" href="classMorEqn.html#a1a6c57edd46cc696aa45c6b01a76e14c" title="Associe une equation a l&#39;objet. Affecte le membre MorEqn::mon_equation avec l&#39;objet passe en parametr...">associer_eqn</a>(*<span class="keyword">this</span>);
<a name="l01032"></a>01032   <a class="code" href="classEquation__base.html#aaaf61d60cca8205d2490a023633cc7d4">solveur_masse</a>.<a class="code" href="classMorEqn.html#a1a6c57edd46cc696aa45c6b01a76e14c" title="Associe une equation a l&#39;objet. Affecte le membre MorEqn::mon_equation avec l&#39;objet passe en parametr...">associer_eqn</a>(*<span class="keyword">this</span>);
<a name="l01033"></a>01033 }
<a name="l01034"></a>01034 
<a name="l01035"></a>01035 <span class="comment">// Precondition:</span>
<a name="l01036"></a>01036 <span class="comment">// Parametre:</span>
<a name="l01037"></a>01037 <span class="comment">// Signification:</span>
<a name="l01038"></a>01038 <span class="comment">// Valeurs par defaut:</span>
<a name="l01039"></a>01039 <span class="comment">// Contraintes:</span>
<a name="l01040"></a>01040 <span class="comment">// Acces:</span>
<a name="l01041"></a>01041 <span class="comment">// </span>
<a name="l01042"></a>01042 <span class="comment">// Signification:</span>
<a name="l01043"></a>01043 <span class="comment">// Contraintes:</span>
<a name="l01044"></a>01044 <span class="comment">// Exception:</span>
<a name="l01045"></a>01045 <span class="comment">// Effets de bord:</span>
<a name="l01046"></a>01046 <span class="comment">// Postcondition:</span>
<a name="l01047"></a>01047 <span class="comment">//</span>
<a name="l01048"></a>01048 <span class="comment">//</span>
<a name="l01049"></a>01049 <span class="comment">//</span>
<a name="l01050"></a>01050 <span class="comment">//</span><span class="comment"></span>
<a name="l01051"></a>01051 <span class="comment">//! Discretise l&#39;equation.&lt;br&gt;Type la zone_Cl_dis, la formatte, l&#39;associe a l&#39;equation.&lt;br&gt;Type le solveur masse, lui associe la zone discretisee et&lt;br&gt;la zone des conditions aux limites discretisees.</span>
<a name="l01052"></a><a class="code" href="classEquation__base.html#ac849b71b99dbe338b049a7728208c965">01052</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#ac849b71b99dbe338b049a7728208c965" title="Discretise l&#39;equation. Type la zone_Cl_dis, la formatte, l&#39;associe a l&#39;equation. Type le solveur mass...">Equation_base::discretiser</a>()
<a name="l01053"></a>01053 {
<a name="l01054"></a>01054   <a class="code" href="classEquation__base.html#a324a761eaad25eb00d18e14764a1362e" title="Renvoie la discretisation associee a l&#39;equation.">discretisation</a>().<a class="code" href="classDiscretisation__base.html#acceba0ad6864f50876e67998dbd9bb30">zone_Cl_dis</a>(<a class="code" href="classEquation__base.html#a12d97ae801edc18f614523677921346e" title="Renvoie la zone discretisee associee a l&#39;equation.">zone_dis</a>(), <a class="code" href="classEquation__base.html#aa097c6ddc00bdb913c39739689f6d5c4">la_zone_Cl_dis</a>);
<a name="l01055"></a>01055   <a class="code" href="classEquation__base.html#aa097c6ddc00bdb913c39739689f6d5c4">la_zone_Cl_dis</a>-&gt;<a class="code" href="classZone__Cl__dis.html#a2f596f95b7dc4f15ac3325320087f3fa" title="Appel a l&#39;objet sous-jacent. Associe l&#39;equation dont l&#39;objet represente les conditions aux limites...">associer_eqn</a>(*<span class="keyword">this</span>);
<a name="l01056"></a>01056   <a class="code" href="classEquation__base.html#aa097c6ddc00bdb913c39739689f6d5c4">la_zone_Cl_dis</a>-&gt;associer_inconnue(<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>());
<a name="l01057"></a>01057 
<a name="l01058"></a>01058   <a class="code" href="classEquation__base.html#aaaf61d60cca8205d2490a023633cc7d4">solveur_masse</a>.<a class="code" href="classSolveur__Masse.html#adbe7f2b2725661795719187cb94cd93a" title="Construit le bon type de Solveur de masse.">typer</a>();
<a name="l01059"></a>01059   <a class="code" href="classEquation__base.html#aaaf61d60cca8205d2490a023633cc7d4">solveur_masse</a>-&gt;associer_zone_dis_base(<a class="code" href="classEquation__base.html#a12d97ae801edc18f614523677921346e" title="Renvoie la zone discretisee associee a l&#39;equation.">zone_dis</a>().<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>());
<a name="l01060"></a>01060   <a class="code" href="classEquation__base.html#aaaf61d60cca8205d2490a023633cc7d4">solveur_masse</a>-&gt;associer_zone_cl_dis_base(<a class="code" href="classEquation__base.html#aa097c6ddc00bdb913c39739689f6d5c4">la_zone_Cl_dis</a>.<a class="code" href="classDeriv__Zone__Cl__dis__base.html#a6b56880f00b604e1f13970ec6d5bc077">valeur</a>());
<a name="l01061"></a>01061 
<a name="l01062"></a>01062   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#ade5df25cd0183395ae30a9865e23611c">calculate_time_derivative</a>())
<a name="l01063"></a>01063     {
<a name="l01064"></a>01064       <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> directive(<span class="stringliteral">&quot;temperature&quot;</span>);
<a name="l01065"></a>01065       <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>().nature_du_champ()==<a class="code" href="Field__base_8h.html#a1b86c8f670a9b34da7f628a821fb646ba66d795f4e2fbb5636a3966c73964c5e7">vectoriel</a>)
<a name="l01066"></a>01066         directive=<span class="stringliteral">&quot;vitesse&quot;</span>;
<a name="l01067"></a>01067 
<a name="l01068"></a>01068       <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> nom(<span class="stringliteral">&quot;derivee_en_temps_&quot;</span>);
<a name="l01069"></a>01069       nom += <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().<a class="code" href="classDeriv__Champ__Inc__base.html#a9e0b743a3e124e7114fa977b36b68225">valeur</a>().<a class="code" href="classField__base.html#ae1377124eabe8387aced762115b062bb" title="Renvoie le nom du champ.">le_nom</a>();
<a name="l01070"></a>01070 
<a name="l01071"></a>01071       <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> unite(<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>().unites()[0]);
<a name="l01072"></a>01072       unite += <span class="stringliteral">&quot;/s&quot;</span>;
<a name="l01073"></a>01073 
<a name="l01074"></a>01074       <a class="code" href="classEquation__base.html#a324a761eaad25eb00d18e14764a1362e" title="Renvoie la discretisation associee a l&#39;equation.">discretisation</a>().<a class="code" href="classDiscretisation__base.html#a03257807e08369739ccc39eba02f74b5">discretiser_champ</a>(directive,<a class="code" href="classEquation__base.html#a12d97ae801edc18f614523677921346e" title="Renvoie la zone discretisee associee a l&#39;equation.">zone_dis</a>().<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>(),nom,unite,
<a name="l01075"></a>01075                                          <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>().nb_comp(),
<a name="l01076"></a>01076                                          <a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().nb_valeurs_temporelles(),
<a name="l01077"></a>01077                                          <a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().temps_courant(),<a class="code" href="classEquation__base.html#a10fb27f5c41123bf4ff96e616549f6d7">derivee_en_temps</a>());
<a name="l01078"></a>01078 
<a name="l01079"></a>01079       <a class="code" href="classEquation__base.html#ad687c312e72dcbc783cf597af5927b07">champs_compris_</a>.<a class="code" href="classChamps__compris.html#aae00ca562b7d89ff638fae94d6973fcf">ajoute_champ</a>(<a class="code" href="classEquation__base.html#a10fb27f5c41123bf4ff96e616549f6d7">derivee_en_temps</a>());
<a name="l01080"></a>01080     }
<a name="l01081"></a>01081 }
<a name="l01082"></a><a class="code" href="classEquation__base.html#a16b5af9ce66738d4d05d2567e417ff3d">01082</a> <span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#a16b5af9ce66738d4d05d2567e417ff3d">Equation_base::associer_milieu_equation</a>()
<a name="l01083"></a>01083 {
<a name="l01084"></a>01084   <a class="code" href="classEquation__base.html#a181e9899e2d927eb14c835d9d9334f46">milieu</a>().<a class="code" href="classMilieu__base.html#a5af40487459413962ad501044db3d85c">associer_equation</a>(<span class="keyword">this</span>);
<a name="l01085"></a>01085 }
<a name="l01086"></a>01086 
<a name="l01087"></a>01087 <span class="comment">// Precondition:</span>
<a name="l01088"></a>01088 <span class="comment">// Parametre: Schema_Temps_base&amp; un_schema_en_temps</span>
<a name="l01089"></a>01089 <span class="comment">// Signification: le schema en temps a associer a l&#39;equation</span>
<a name="l01090"></a>01090 <span class="comment">// Valeurs par defaut:</span>
<a name="l01091"></a>01091 <span class="comment">// Contraintes: reference constante</span>
<a name="l01092"></a>01092 <span class="comment">// Acces:</span>
<a name="l01093"></a>01093 <span class="comment">// </span>
<a name="l01094"></a>01094 <span class="comment">// Signification:</span>
<a name="l01095"></a>01095 <span class="comment">// Contraintes:</span>
<a name="l01096"></a>01096 <span class="comment">// Exception:</span>
<a name="l01097"></a>01097 <span class="comment">// Effets de bord:</span>
<a name="l01098"></a>01098 <span class="comment">// Postcondition:</span>
<a name="l01099"></a>01099 <span class="comment">//</span><span class="comment"></span>
<a name="l01100"></a>01100 <span class="comment">//! S&#39;associe au schema_en_temps.</span>
<a name="l01101"></a><a class="code" href="classEquation__base.html#aabd38edf86fa21fec604553313862bff">01101</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#aabd38edf86fa21fec604553313862bff" title="S&#39;associe au schema_en_temps.">Equation_base::associer_sch_tps_base</a>(<span class="keyword">const</span> <a class="code" href="classSchema__Temps__base.html" title="classe Schema_Temps_base">Schema_Temps_base</a>&amp; un_schema_en_temps)
<a name="l01102"></a>01102 {
<a name="l01103"></a>01103   <a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>=un_schema_en_temps;
<a name="l01104"></a>01104 }
<a name="l01105"></a>01105 
<a name="l01106"></a>01106 <span class="comment">// Precondition:</span>
<a name="l01107"></a>01107 <span class="comment">// Parametre:</span>
<a name="l01108"></a>01108 <span class="comment">// Signification:</span>
<a name="l01109"></a>01109 <span class="comment">// Valeurs par defaut:</span>
<a name="l01110"></a>01110 <span class="comment">// Contraintes:</span>
<a name="l01111"></a>01111 <span class="comment">// Acces:</span>
<a name="l01112"></a>01112 <span class="comment">// Exception: pas de schema en temps associe a l&#39;equation</span>
<a name="l01113"></a>01113 <span class="comment">// Effets de bord:</span>
<a name="l01114"></a>01114 <span class="comment">// Postcondition:</span>
<a name="l01115"></a>01115 <span class="comment">//</span><span class="comment"></span>
<a name="l01116"></a>01116 <span class="comment">//! Renvoie le schema en temps associe a l&#39;equation.</span>
<a name="l01117"></a>01117 <span class="comment"></span><span class="comment">/** \return Schema_Temps_base\&amp;&lt;br&gt;</span>
<a name="l01118"></a>01118 <span class="comment">Signification: le schema en temps associe a l&#39;equation&lt;br&gt;</span>
<a name="l01119"></a>01119 <span class="comment">Contraintes: */</span>
<a name="l01120"></a><a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4">01120</a> <a class="code" href="classSchema__Temps__base.html" title="classe Schema_Temps_base">Schema_Temps_base</a>&amp; <a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">Equation_base::schema_temps</a>()
<a name="l01121"></a>01121 {
<a name="l01122"></a>01122   <span class="keywordflow">if</span>(!<a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>())
<a name="l01123"></a>01123     {
<a name="l01124"></a>01124       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error : &quot;</span> &lt;&lt; <a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>()
<a name="l01125"></a>01125            &lt;&lt; <span class="stringliteral">&quot;has not been associated to a time scheme &quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01126"></a>01126       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l01127"></a>01127     }
<a name="l01128"></a>01128   <span class="keywordflow">return</span> <a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>.<a class="code" href="classRef__Schema__Temps__base.html#a1cdfccd0f1ad187e0e83d762e69a7834">valeur</a>();
<a name="l01129"></a>01129 }
<a name="l01130"></a>01130 
<a name="l01131"></a>01131 <span class="comment">// Precondition:</span>
<a name="l01132"></a>01132 <span class="comment">// Parametre:</span>
<a name="l01133"></a>01133 <span class="comment">// Signification:</span>
<a name="l01134"></a>01134 <span class="comment">// Valeurs par defaut:</span>
<a name="l01135"></a>01135 <span class="comment">// Contraintes:</span>
<a name="l01136"></a>01136 <span class="comment">// Acces:</span>
<a name="l01137"></a>01137 <span class="comment">// Exception: pas de schema en temps associe a l&#39;equation</span>
<a name="l01138"></a>01138 <span class="comment">// Effets de bord:</span>
<a name="l01139"></a>01139 <span class="comment">// Postcondition: la methode ne modifie pas l&#39;objet</span>
<a name="l01140"></a>01140 <span class="comment">//</span><span class="comment"></span>
<a name="l01141"></a>01141 <span class="comment">//! Renvoie le schema en temps associe a l&#39;equation.</span>
<a name="l01142"></a>01142 <span class="comment"></span><span class="comment">/** \return Schema_Temps_base\&amp;&lt;br&gt;</span>
<a name="l01143"></a>01143 <span class="comment">Signification: le schema en temps associe a l&#39;equation&lt;br&gt;</span>
<a name="l01144"></a>01144 <span class="comment">Contraintes: reference constante */</span>
<a name="l01145"></a><a class="code" href="classEquation__base.html#a89ddf8ae8e33ab9e07d71513b53c809a">01145</a> <span class="keyword">const</span> <a class="code" href="classSchema__Temps__base.html" title="classe Schema_Temps_base">Schema_Temps_base</a>&amp; <a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">Equation_base::schema_temps</a>()<span class="keyword"> const</span>
<a name="l01146"></a>01146 <span class="keyword"></span>{
<a name="l01147"></a>01147   <span class="keywordflow">if</span>(!<a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>())
<a name="l01148"></a>01148     {
<a name="l01149"></a>01149       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error : &quot;</span> &lt;&lt; <a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>()
<a name="l01150"></a>01150            &lt;&lt; <span class="stringliteral">&quot;has not been associated to a time scheme &quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01151"></a>01151       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l01152"></a>01152     }
<a name="l01153"></a>01153   <span class="keywordflow">return</span> <a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>.<a class="code" href="classRef__Schema__Temps__base.html#a1cdfccd0f1ad187e0e83d762e69a7834">valeur</a>();
<a name="l01154"></a>01154 }
<a name="l01155"></a>01155 
<a name="l01156"></a>01156 <span class="comment">// Precondition:</span>
<a name="l01157"></a>01157 <span class="comment">// Parametre: Zone_dis&amp; z</span>
<a name="l01158"></a>01158 <span class="comment">// Signification: la zone discretisee a associee</span>
<a name="l01159"></a>01159 <span class="comment">// Valeurs par defaut:</span>
<a name="l01160"></a>01160 <span class="comment">// Contraintes: reference constante</span>
<a name="l01161"></a>01161 <span class="comment">// Acces: entree</span>
<a name="l01162"></a>01162 <span class="comment">// </span>
<a name="l01163"></a>01163 <span class="comment">// Signification:</span>
<a name="l01164"></a>01164 <span class="comment">// Contraintes:</span>
<a name="l01165"></a>01165 <span class="comment">// Exception:</span>
<a name="l01166"></a>01166 <span class="comment">// Effets de bord:</span>
<a name="l01167"></a>01167 <span class="comment">// Postcondition:</span>
<a name="l01168"></a>01168 <span class="comment">//</span><span class="comment"></span>
<a name="l01169"></a>01169 <span class="comment">//! Associe la zone discretisee a l&#39;equation.</span>
<a name="l01170"></a><a class="code" href="classEquation__base.html#a25318ab0a20cd120e4e4671ca156b8df">01170</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#a25318ab0a20cd120e4e4671ca156b8df" title="Associe la zone discretisee a l&#39;equation.">Equation_base::associer_zone_dis</a>(<span class="keyword">const</span> <a class="code" href="classZone__dis.html" title="classe Zone_dis Classe generique de la hierarchie des zones discretisees. Un objet de type Zone_dis p...">Zone_dis</a>&amp; z)
<a name="l01171"></a>01171 {
<a name="l01172"></a>01172   <a class="code" href="classEquation__base.html#a645ff38d42bb7005e0950888099b6916">la_zone_dis</a>=z;
<a name="l01173"></a>01173 }
<a name="l01174"></a>01174 
<a name="l01175"></a>01175 <span class="comment">// Precondition:</span>
<a name="l01176"></a>01176 <span class="comment">// Parametre: double temps</span>
<a name="l01177"></a>01177 <span class="comment">// Signification: le pas de temps de mise a jour</span>
<a name="l01178"></a>01178 <span class="comment">// Valeurs par defaut:</span>
<a name="l01179"></a>01179 <span class="comment">// Contraintes:</span>
<a name="l01180"></a>01180 <span class="comment">// Acces: entree</span>
<a name="l01181"></a>01181 <span class="comment">// </span>
<a name="l01182"></a>01182 <span class="comment">// Signification:</span>
<a name="l01183"></a>01183 <span class="comment">// Contraintes:</span>
<a name="l01184"></a>01184 <span class="comment">// Exception:</span>
<a name="l01185"></a>01185 <span class="comment">// Effets de bord: les objets associes a l&#39;equations sont modifies</span>
<a name="l01186"></a>01186 <span class="comment">// le milieu physique, l&#39;inconnue les operateurs.</span>
<a name="l01187"></a>01187 <span class="comment">// Postcondition:</span>
<a name="l01188"></a>01188 <span class="comment">//</span>
<a name="l01189"></a>01189 <span class="comment">//</span>
<a name="l01190"></a>01190 <span class="comment">//</span><span class="comment"></span>
<a name="l01191"></a>01191 <span class="comment">//! La valeur de l&#39;inconnue sur le pas de temps a ete calculee.&lt;br&gt;Cette methode avance le present jusqu&#39;au temps passe en parametre.&lt;br&gt;Elle met aussi a jour les proprietes du milieu.</span>
<a name="l01192"></a><a class="code" href="classEquation__base.html#a62757c897af44f346e3a9e65e38aa122">01192</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#a62757c897af44f346e3a9e65e38aa122" title="La valeur de l&#39;inconnue sur le pas de temps a ete calculee. Cette methode avance le present jusqu&#39;au ...">Equation_base::mettre_a_jour</a>(<span class="keywordtype">double</span> temps)
<a name="l01193"></a>01193 {
<a name="l01194"></a>01194 <span class="comment">// On tourne la roue de l&#39;inconnue</span>
<a name="l01195"></a>01195 <span class="comment">// Update the unknown:</span>
<a name="l01196"></a>01196   <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().<a class="code" href="classChamp__Inc.html#aa18fe93c1bb1b1131f31e7ab89da1d02">mettre_a_jour</a>(temps);
<a name="l01197"></a>01197   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#ade5df25cd0183395ae30a9865e23611c">calculate_time_derivative</a>()) <a class="code" href="classEquation__base.html#a10fb27f5c41123bf4ff96e616549f6d7">derivee_en_temps</a>().<a class="code" href="classChamp__Inc.html#aa18fe93c1bb1b1131f31e7ab89da1d02">mettre_a_jour</a>(temps);
<a name="l01198"></a>01198 
<a name="l01199"></a>01199   <a class="code" href="classEquation__base.html#a6dae2cb8a228b0e3a6d90042fd75f360">les_sources</a>.<a class="code" href="classSources.html#aa993ae270b7536a4d1a321899b905bf8" title="Mise a jour en temps, de toute les sources de la liste.">mettre_a_jour</a>(temps);
<a name="l01200"></a>01200 
<a name="l01201"></a>01201   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a70ce889f92239d642ddbd36686a75c18">champ_conserve_</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>()) <a class="code" href="classEquation__base.html#a70ce889f92239d642ddbd36686a75c18">champ_conserve_</a>-&gt;<a class="code" href="classChamp__Inc.html#aa18fe93c1bb1b1131f31e7ab89da1d02">mettre_a_jour</a>(temps);
<a name="l01202"></a>01202   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a207110280e36a5f102ebba60a1f1c955">champ_convecte_</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>()) <a class="code" href="classEquation__base.html#a207110280e36a5f102ebba60a1f1c955">champ_convecte_</a>-&gt;<a class="code" href="classChamp__Inc.html#aa18fe93c1bb1b1131f31e7ab89da1d02">mettre_a_jour</a>(temps);
<a name="l01203"></a>01203 
<a name="l01204"></a>01204 <span class="comment">// On tourne la roue des CLs</span>
<a name="l01205"></a>01205 <span class="comment">// Update the boundary condition:</span>
<a name="l01206"></a>01206   <span class="keywordflow">if</span> (temps &gt; <a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().temps_courant()) <a class="code" href="classEquation__base.html#af265fe0ea30868eb2176a0c887e4efab" title="Renvoie la zone des conditions aux limite discretisee associee a l&#39;equation.">zone_Cl_dis</a>()-&gt;avancer(temps);
<a name="l01207"></a>01207 }
<a name="l01208"></a>01208 
<a name="l01209"></a>01209 
<a name="l01210"></a>01210 <span class="comment">// Precondition:</span>
<a name="l01211"></a>01211 <span class="comment">// Parametre:</span>
<a name="l01212"></a>01212 <span class="comment">// Signification:</span>
<a name="l01213"></a>01213 <span class="comment">// Valeurs par defaut:</span>
<a name="l01214"></a>01214 <span class="comment">// Contraintes:</span>
<a name="l01215"></a>01215 <span class="comment">// Acces:</span>
<a name="l01216"></a>01216 <span class="comment">// </span>
<a name="l01217"></a>01217 <span class="comment">// Signification:</span>
<a name="l01218"></a>01218 <span class="comment">// Contraintes:</span>
<a name="l01219"></a>01219 <span class="comment">// Exception: WrongContext</span>
<a name="l01220"></a>01220 <span class="comment">// Effets de bord:</span>
<a name="l01221"></a>01221 <span class="comment">// Postcondition:</span>
<a name="l01222"></a>01222 <span class="comment">//</span>
<a name="l01223"></a>01223 <span class="comment">//</span>
<a name="l01224"></a>01224 <span class="comment">//</span>
<a name="l01225"></a>01225 <span class="comment">//</span><span class="comment"></span>
<a name="l01226"></a>01226 <span class="comment">//! Reinitialiser ce qui doit l&#39;etre.&lt;br&gt;Cette methode est appelee lorsqu&#39;un pas de temps est abandonne,&lt;br&gt;par exemple parce que le calcul a diverge.&lt;br&gt;Il faut donc nettoyer ce qui pourrait polluer la nouvelle resolution.</span>
<a name="l01227"></a><a class="code" href="classEquation__base.html#a643e4ffb873396a94d5f263fecccd9fc">01227</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#a643e4ffb873396a94d5f263fecccd9fc" title="Reinitialiser ce qui doit l&#39;etre. Cette methode est appelee lorsqu&#39;un pas de temps est abandonne...">Equation_base::abortTimeStep</a>()
<a name="l01228"></a>01228 {
<a name="l01229"></a>01229   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>(); i++)
<a name="l01230"></a>01230     <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#ad4c4e376365aa056c1a9bb9093ee7878">abortTimeStep</a>();
<a name="l01231"></a>01231   <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>()-&gt;abortTimeStep();
<a name="l01232"></a>01232   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a70ce889f92239d642ddbd36686a75c18">champ_conserve_</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>()) <a class="code" href="classEquation__base.html#a70ce889f92239d642ddbd36686a75c18">champ_conserve_</a>-&gt;abortTimeStep();
<a name="l01233"></a>01233   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a207110280e36a5f102ebba60a1f1c955">champ_convecte_</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>()) <a class="code" href="classEquation__base.html#a207110280e36a5f102ebba60a1f1c955">champ_convecte_</a>-&gt;abortTimeStep();
<a name="l01234"></a>01234 }
<a name="l01235"></a>01235 
<a name="l01236"></a>01236 <span class="comment">// Description :</span>
<a name="l01237"></a>01237 <span class="comment">// methode virtuelle permettant de corriger l&#39;onconnue lors d&#39;iterations implicites</span>
<a name="l01238"></a>01238 <span class="comment">// par exemple K-eps doivent rester positifs</span>
<a name="l01239"></a>01239 <span class="comment">// les fractions massqiues entre 0 et 1</span>
<a name="l01240"></a><a class="code" href="classEquation__base.html#a4b5f65f0f29ea9c4c90d7caea6f2e270">01240</a> <span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#a4b5f65f0f29ea9c4c90d7caea6f2e270">Equation_base::valider_iteration</a>()
<a name="l01241"></a>01241 {
<a name="l01242"></a>01242 }
<a name="l01243"></a>01243 
<a name="l01244"></a>01244 <span class="comment">// Precondition:</span>
<a name="l01245"></a>01245 <span class="comment">// Parametre:</span>
<a name="l01246"></a>01246 <span class="comment">// Signification:</span>
<a name="l01247"></a>01247 <span class="comment">// Valeurs par defaut:</span>
<a name="l01248"></a>01248 <span class="comment">// Contraintes:</span>
<a name="l01249"></a>01249 <span class="comment">// Acces:</span>
<a name="l01250"></a>01250 <span class="comment">// Exception:</span>
<a name="l01251"></a>01251 <span class="comment">// Effets de bord:</span>
<a name="l01252"></a>01252 <span class="comment">// Postcondition:</span>
<a name="l01253"></a>01253 <span class="comment">//</span><span class="comment"></span>
<a name="l01254"></a>01254 <span class="comment">//! Tout ce qui ne depend pas des autres problemes eventuels.</span>
<a name="l01255"></a>01255 <span class="comment"></span><span class="comment">/** \return int&lt;br&gt;</span>
<a name="l01256"></a>01256 <span class="comment">Signification: renvoie toujours 1&lt;br&gt;</span>
<a name="l01257"></a>01257 <span class="comment">Contraintes: */</span>
<a name="l01258"></a><a class="code" href="classEquation__base.html#a6ec47139247e984d286c2e13d0a92ff7">01258</a> <span class="keywordtype">int</span> <a class="code" href="classEquation__base.html#a6ec47139247e984d286c2e13d0a92ff7" title="Tout ce qui ne depend pas des autres problemes eventuels.">Equation_base::preparer_calcul</a>()
<a name="l01259"></a>01259 {
<a name="l01260"></a>01260   <a class="code" href="classEquation__base.html#aaaf61d60cca8205d2490a023633cc7d4">solveur_masse</a>.<a class="code" href="classDeriv__Solveur__Masse__base.html#ad9c6d7581b1979f3acb81c4d3da49edf">valeur</a>().<a class="code" href="classSolveur__Masse__base.html#adbd3edc50a3cbe018210bb8dd3ad42b2">preparer_calcul</a>();
<a name="l01261"></a>01261   <span class="keywordtype">int</span> nb_op=<a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>();
<a name="l01262"></a>01262   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;nb_op; i++)
<a name="l01263"></a>01263     {
<a name="l01264"></a>01264       <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#a60180a15772ff5df6fe5fba248186b30">preparer_calcul</a>();
<a name="l01265"></a>01265       <a class="code" href="classEquation__base.html#a83044a97de577592dea52668854266cd">dt_op_bak</a>.<a class="code" href="classDoubleList.html#ac5009562ee7ed83808aa48bb4cc363d9" title="insertion en queue">add</a>(0.);
<a name="l01266"></a>01266     }
<a name="l01267"></a>01267   <a class="code" href="classEquation__base.html#a888dc3f8eb5fb54b05250b6b704a6997">initialise_residu</a>();
<a name="l01268"></a>01268   <span class="keywordtype">double</span> temps=<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a5054df01edb6d4f7baec7e612d423834" title="Renvoie le temps courant.">temps_courant</a>();
<a name="l01269"></a>01269   <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>()-&gt;verifie_valeurs_cl();
<a name="l01270"></a>01270   <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().<a class="code" href="classChamp__Inc.html#a6494d54f7acebf6bd446c7e8ecaf8e21" title="Appel a l&#39;objet sous-jacent Fixe le temps courant.">changer_temps</a>(temps);
<a name="l01271"></a>01271   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#ade5df25cd0183395ae30a9865e23611c">calculate_time_derivative</a>()) <a class="code" href="classEquation__base.html#a10fb27f5c41123bf4ff96e616549f6d7">derivee_en_temps</a>().<a class="code" href="classChamp__Inc.html#a6494d54f7acebf6bd446c7e8ecaf8e21" title="Appel a l&#39;objet sous-jacent Fixe le temps courant.">changer_temps</a>(temps);
<a name="l01272"></a>01272   <a class="code" href="classEquation__base.html#aa097c6ddc00bdb913c39739689f6d5c4">la_zone_Cl_dis</a>-&gt;initialiser(temps);
<a name="l01273"></a>01273 
<a name="l01274"></a>01274   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> msg=<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>();
<a name="l01275"></a>01275   msg+=<span class="stringliteral">&quot; dans Equation_base::preparer_calcul 1&quot;</span>;
<a name="l01276"></a>01276   <a class="code" href="Op__Div__VEFP1B__Elem_8cpp.html#a45261662b3b88d5db461b3fc99246e5a">Debog::verifier</a>(msg ,<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>());
<a name="l01277"></a>01277 
<a name="l01278"></a>01278   <a class="code" href="classEquation__base.html#a6dae2cb8a228b0e3a6d90042fd75f360">les_sources</a>.<a class="code" href="classSources.html#a40cabc9fa7e745f325fad26aefec055a" title="Appelle Source::initialiser(temps) sur toutes les sources de la liste. voir Source_base::initialiser(...">initialiser</a>(temps);
<a name="l01279"></a>01279   <a class="code" href="classEquation__base.html#af265fe0ea30868eb2176a0c887e4efab" title="Renvoie la zone des conditions aux limite discretisee associee a l&#39;equation.">zone_Cl_dis</a>().<a class="code" href="classZone__Cl__dis.html#a9a1b2c60317659659ff316f39fd27ed8" title="Appel a l&#39;objet sous-jacent. Impose les conditions aux limites a un temps donne du Champ_Inc...">imposer_cond_lim</a>(<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>(),temps);
<a name="l01280"></a>01280   <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>().<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l01281"></a>01281 
<a name="l01282"></a>01282   msg=<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>();
<a name="l01283"></a>01283   msg+=<span class="stringliteral">&quot; dans Equation_base::preparer_calcul &quot;</span>;
<a name="l01284"></a>01284   <a class="code" href="Op__Div__VEFP1B__Elem_8cpp.html#a45261662b3b88d5db461b3fc99246e5a">Debog::verifier</a>(msg ,<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>());
<a name="l01285"></a>01285 
<a name="l01286"></a>01286   <span class="keywordflow">return</span> 1;
<a name="l01287"></a>01287 }
<a name="l01288"></a>01288 
<a name="l01289"></a>01289 
<a name="l01290"></a>01290 <span class="comment">// Precondition:</span>
<a name="l01291"></a>01291 <span class="comment">// Parametre:</span>
<a name="l01292"></a>01292 <span class="comment">// Signification:</span>
<a name="l01293"></a>01293 <span class="comment">// Valeurs par defaut:</span>
<a name="l01294"></a>01294 <span class="comment">// Contraintes:</span>
<a name="l01295"></a>01295 <span class="comment">// Acces:</span>
<a name="l01296"></a>01296 <span class="comment">// Exception:</span>
<a name="l01297"></a>01297 <span class="comment">// Effets de bord:</span>
<a name="l01298"></a>01298 <span class="comment">// Postcondition:</span>
<a name="l01299"></a>01299 <span class="comment">//</span>
<a name="l01300"></a>01300 <span class="comment">//</span>
<a name="l01301"></a>01301 <span class="comment">//</span>
<a name="l01302"></a>01302 <span class="comment">//</span><span class="comment"></span>
<a name="l01303"></a>01303 <span class="comment">//! Allocation et initialisation de l&#39;inconnue et des CLs&lt;br&gt;jusqu&#39;a present+dt.&lt;br&gt;+ autres initialisations pour les calculs sur le prochain&lt;br&gt;pas de temps : operateurs, solveur_masse.</span>
<a name="l01304"></a>01304 <span class="comment"></span><span class="comment">/** \return 0 en cas d&#39;erreur, 1 sinon&lt;br&gt;</span>
<a name="l01305"></a>01305 <span class="comment">Signification:&lt;br&gt;</span>
<a name="l01306"></a>01306 <span class="comment">Contraintes: */</span>
<a name="l01307"></a><a class="code" href="classEquation__base.html#abe73d22669a839178f90e5afa713e616">01307</a> <span class="keywordtype">bool</span> <a class="code" href="classEquation__base.html#abe73d22669a839178f90e5afa713e616" title="Allocation et initialisation de l&#39;inconnue et des CLs jusqu&#39;a present+dt. + autres initialisations po...">Equation_base::initTimeStep</a>(<span class="keywordtype">double</span> dt)
<a name="l01308"></a>01308 {
<a name="l01309"></a>01309   <a class="code" href="classSchema__Temps__base.html" title="classe Schema_Temps_base">Schema_Temps_base</a>&amp; sch=<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>();
<a name="l01310"></a>01310   <span class="keywordtype">double</span> temps_present=sch.<a class="code" href="classSchema__Temps__base.html#a5054df01edb6d4f7baec7e612d423834" title="Renvoie le temps courant.">temps_courant</a>();
<a name="l01311"></a>01311 
<a name="l01312"></a>01312 <span class="comment">// Le pas de temps doit etre celui du schema !!</span>
<a name="l01313"></a>01313   assert(sch.<a class="code" href="classSchema__Temps__base.html#a0e4f67ef6086c09434ddc161668077b2" title="Renvoie le pas de temps (delta_t) courant.">pas_de_temps</a>()==dt);
<a name="l01314"></a>01314 
<a name="l01315"></a>01315 <span class="comment">// Pour chaque temps futur</span>
<a name="l01316"></a>01316   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt;=sch.<a class="code" href="classSchema__Temps__base.html#a9d24dd8112258e09c09a9b58c4b7e335">nb_valeurs_futures</a>(); i++)
<a name="l01317"></a>01317     {
<a name="l01318"></a>01318       <span class="keywordtype">double</span> tps=sch.<a class="code" href="classSchema__Temps__base.html#a46d916b7db340c822e87edf21ab77c00">temps_futur</a>(i);
<a name="l01319"></a>01319 <span class="comment">// Mise a jour du temps dans l&#39;inconnue</span>
<a name="l01320"></a>01320       <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>()-&gt;changer_temps_futur(tps,i);
<a name="l01321"></a>01321       <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a70ce889f92239d642ddbd36686a75c18">champ_conserve_</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>()) <a class="code" href="classEquation__base.html#a70ce889f92239d642ddbd36686a75c18">champ_conserve_</a>-&gt;changer_temps_futur(tps,i);
<a name="l01322"></a>01322       <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a207110280e36a5f102ebba60a1f1c955">champ_convecte_</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>()) <a class="code" href="classEquation__base.html#a207110280e36a5f102ebba60a1f1c955">champ_convecte_</a>-&gt;changer_temps_futur(tps,i);
<a name="l01323"></a>01323       <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#ade5df25cd0183395ae30a9865e23611c">calculate_time_derivative</a>()) <a class="code" href="classEquation__base.html#a10fb27f5c41123bf4ff96e616549f6d7">derivee_en_temps</a>()-&gt;changer_temps_futur(tps,i);
<a name="l01324"></a>01324 
<a name="l01325"></a>01325       <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>()-&gt;<a class="code" href="classChamp__Inc.html#a518c3eb1e7a249ae0fc4d1a4e0d072d0" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps t+i.">futur</a>(i)=<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>()-&gt;<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>();
<a name="l01326"></a>01326       <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a70ce889f92239d642ddbd36686a75c18">champ_conserve_</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>()) <a class="code" href="classEquation__base.html#a70ce889f92239d642ddbd36686a75c18">champ_conserve_</a>-&gt;<a class="code" href="classChamp__Inc.html#a518c3eb1e7a249ae0fc4d1a4e0d072d0" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps t+i.">futur</a>(i) = <a class="code" href="classEquation__base.html#a91d75e1a4ce1f193a28317168f795e0d">champ_conserve</a>().<a class="code" href="classChamp__Inc__base.html#adb537f43f1649e103a8980314c7ed175" title="Renvoie le tableau des valeurs du champ au temps courant.">valeurs</a>();
<a name="l01327"></a>01327       <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a207110280e36a5f102ebba60a1f1c955">champ_convecte_</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>()) <a class="code" href="classEquation__base.html#a207110280e36a5f102ebba60a1f1c955">champ_convecte_</a>-&gt;<a class="code" href="classChamp__Inc.html#a518c3eb1e7a249ae0fc4d1a4e0d072d0" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps t+i.">futur</a>(i) = <a class="code" href="classEquation__base.html#a06f979f76f73c5faa2b3819254930cdb">champ_convecte</a>().<a class="code" href="classChamp__Inc__base.html#adb537f43f1649e103a8980314c7ed175" title="Renvoie le tableau des valeurs du champ au temps courant.">valeurs</a>();
<a name="l01328"></a>01328       <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#ade5df25cd0183395ae30a9865e23611c">calculate_time_derivative</a>()) <a class="code" href="classEquation__base.html#a10fb27f5c41123bf4ff96e616549f6d7">derivee_en_temps</a>()-&gt;<a class="code" href="classChamp__Inc.html#a518c3eb1e7a249ae0fc4d1a4e0d072d0" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps t+i.">futur</a>(i)=<a class="code" href="classEquation__base.html#a10fb27f5c41123bf4ff96e616549f6d7">derivee_en_temps</a>()-&gt;<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>();
<a name="l01329"></a>01329 
<a name="l01330"></a>01330 <span class="comment">// Mise a jour du temps dans les CL</span>
<a name="l01331"></a>01331       <a class="code" href="classEquation__base.html#af265fe0ea30868eb2176a0c887e4efab" title="Renvoie la zone des conditions aux limite discretisee associee a l&#39;equation.">zone_Cl_dis</a>()-&gt;changer_temps_futur(tps,i);
<a name="l01332"></a>01332     }
<a name="l01333"></a>01333 
<a name="l01334"></a>01334 <span class="comment">// Mise a jour du temps par defaut des CLs</span>
<a name="l01335"></a>01335   <a class="code" href="classEquation__base.html#af265fe0ea30868eb2176a0c887e4efab" title="Renvoie la zone des conditions aux limite discretisee associee a l&#39;equation.">zone_Cl_dis</a>()-&gt;set_temps_defaut(sch.<a class="code" href="classSchema__Temps__base.html#ade057f30f3f9cf15a3e1feb74dd36058">temps_defaut</a>());
<a name="l01336"></a>01336 
<a name="l01337"></a>01337 <span class="comment">// Mise a jour des operateurs</span>
<a name="l01338"></a>01338   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>(); i++)
<a name="l01339"></a>01339     <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).<a class="code" href="classOperateur.html#a8117cc7d41a3c3f165b65e24133c3e41" title="Effecttue une mise a jour en temps de l&#39;operateur. Appelle Operateur_base::mettre_a_jour(double)">mettre_a_jour</a>(temps_present);
<a name="l01340"></a>01340 
<a name="l01341"></a>01341 <span class="comment">// Mise a jour du solveur masse au temps present</span>
<a name="l01342"></a>01342   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#aaaf61d60cca8205d2490a023633cc7d4">solveur_masse</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>())
<a name="l01343"></a>01343     <a class="code" href="classEquation__base.html#aaaf61d60cca8205d2490a023633cc7d4">solveur_masse</a>.<a class="code" href="classSolveur__Masse.html#aecfdd279b0ea8792de85aa5dac6d86cd" title="Appel a l&#39;objet sous-jacent. Mise a jour en temps du solveur de masse.">mettre_a_jour</a>(temps_present);
<a name="l01344"></a>01344 
<a name="l01345"></a>01345   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01346"></a>01346 }
<a name="l01347"></a>01347 
<a name="l01348"></a><a class="code" href="classEquation__base.html#a769801bc7ebb7a6be88e34d02cabc26b">01348</a> <span class="keywordtype">bool</span> <a class="code" href="classEquation__base.html#a769801bc7ebb7a6be88e34d02cabc26b">Equation_base::updateGivenFields</a>()
<a name="l01349"></a>01349 {
<a name="l01350"></a>01350   <a class="code" href="classSchema__Temps__base.html" title="classe Schema_Temps_base">Schema_Temps_base</a>&amp; sch=<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>();
<a name="l01351"></a>01351   <span class="keywordtype">double</span> temps_present=sch.<a class="code" href="classSchema__Temps__base.html#a5054df01edb6d4f7baec7e612d423834" title="Renvoie le temps courant.">temps_courant</a>();
<a name="l01352"></a>01352   <span class="keywordtype">double</span> temps_futur=temps_present+sch.<a class="code" href="classSchema__Temps__base.html#a0e4f67ef6086c09434ddc161668077b2" title="Renvoie le pas de temps (delta_t) courant.">pas_de_temps</a>();
<a name="l01353"></a>01353 
<a name="l01354"></a>01354 <span class="comment">// Pour chaque temps futur</span>
<a name="l01355"></a>01355   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt;=sch.<a class="code" href="classSchema__Temps__base.html#a9d24dd8112258e09c09a9b58c4b7e335">nb_valeurs_futures</a>(); i++)
<a name="l01356"></a>01356     {
<a name="l01357"></a>01357       <span class="keywordtype">double</span> tps=sch.<a class="code" href="classSchema__Temps__base.html#a46d916b7db340c822e87edf21ab77c00">temps_futur</a>(i);
<a name="l01358"></a>01358 <span class="comment">// Calcul des CLs a ce temps.</span>
<a name="l01359"></a>01359       <a class="code" href="classEquation__base.html#af265fe0ea30868eb2176a0c887e4efab" title="Renvoie la zone des conditions aux limite discretisee associee a l&#39;equation.">zone_Cl_dis</a>().<a class="code" href="classZone__Cl__dis.html#a241a6b48ebc8b6767013dee04c429719" title="Appel a l&#39;objet sous-jacent Effectue une mise a jour en temps des conditions aux limites.">mettre_a_jour</a>(tps);
<a name="l01360"></a>01360     }
<a name="l01361"></a>01361 <span class="comment">// Calcul du taux d&#39;accroissement des CLs entre les temps present et futur.</span>
<a name="l01362"></a>01362   <a class="code" href="classEquation__base.html#af265fe0ea30868eb2176a0c887e4efab" title="Renvoie la zone des conditions aux limite discretisee associee a l&#39;equation.">zone_Cl_dis</a>()-&gt;Gpoint(temps_present,temps_futur);
<a name="l01363"></a>01363 
<a name="l01364"></a>01364 <span class="comment">// MaJ des operateurs</span>
<a name="l01365"></a>01365   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>(); i++) <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).<a class="code" href="classOperateur.html#a48dda3aaf316dc1ac2397a1147c06bb3">op_non_nul</a>())
<a name="l01366"></a>01366       <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#a55ee9300d78cf0d8bdf7f48c56feb7ce" title="NE FAIT RIEN A surcharger dans les classes derivees. Mise a jour de l&#39;operateur.">mettre_a_jour</a>(temps_present);
<a name="l01367"></a>01367 
<a name="l01368"></a>01368 <span class="comment">// Mise a jour des sources au temps present</span>
<a name="l01369"></a>01369   <a class="code" href="classEquation__base.html#a6dae2cb8a228b0e3a6d90042fd75f360">les_sources</a>.<a class="code" href="classSources.html#aa993ae270b7536a4d1a321899b905bf8" title="Mise a jour en temps, de toute les sources de la liste.">mettre_a_jour</a>(temps_present);
<a name="l01370"></a>01370 
<a name="l01371"></a>01371   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01372"></a>01372 }
<a name="l01373"></a>01373 
<a name="l01374"></a>01374 
<a name="l01375"></a>01375 <span class="comment">// Precondition:</span>
<a name="l01376"></a>01376 <span class="comment">// Parametre:</span>
<a name="l01377"></a>01377 <span class="comment">// Signification:</span>
<a name="l01378"></a>01378 <span class="comment">// Valeurs par defaut:</span>
<a name="l01379"></a>01379 <span class="comment">// Contraintes:</span>
<a name="l01380"></a>01380 <span class="comment">// Acces:</span>
<a name="l01381"></a>01381 <span class="comment">// Exception: pas de probleme associe</span>
<a name="l01382"></a>01382 <span class="comment">// Effets de bord:</span>
<a name="l01383"></a>01383 <span class="comment">// Postcondition: la methode ne modifie pas l&#39;objet</span>
<a name="l01384"></a>01384 <span class="comment">//</span><span class="comment"></span>
<a name="l01385"></a>01385 <span class="comment">//! Renvoie la discretisation associee a l&#39;equation.</span>
<a name="l01386"></a>01386 <span class="comment"></span><span class="comment">/** \return Discretisation_base\&amp;&lt;br&gt;</span>
<a name="l01387"></a>01387 <span class="comment">Signification: a discretisation associee a l&#39;equation&lt;br&gt;</span>
<a name="l01388"></a>01388 <span class="comment">Contraintes: reference constante */</span>
<a name="l01389"></a><a class="code" href="classEquation__base.html#a324a761eaad25eb00d18e14764a1362e">01389</a> <span class="keyword">const</span> <a class="code" href="classDiscretisation__base.html" title="classe Discretisation_base Cette classe represente un schema de discretisation en espace...">Discretisation_base</a>&amp; <a class="code" href="classEquation__base.html#a324a761eaad25eb00d18e14764a1362e" title="Renvoie la discretisation associee a l&#39;equation.">Equation_base::discretisation</a>()<span class="keyword"> const</span>
<a name="l01390"></a>01390 <span class="keyword"></span>{
<a name="l01391"></a>01391   <span class="keywordflow">if</span>(!<a class="code" href="classEquation__base.html#ae2d5662d4d26ee7ebefa134239109275">mon_probleme</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>())
<a name="l01392"></a>01392     {
<a name="l01393"></a>01393       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error : &quot;</span> &lt;&lt; <a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>()
<a name="l01394"></a>01394            &lt;&lt; <span class="stringliteral">&quot;has not been associated to a problem ! &quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01395"></a>01395       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l01396"></a>01396     }
<a name="l01397"></a>01397   <span class="keywordflow">return</span> <a class="code" href="classEquation__base.html#ae2d5662d4d26ee7ebefa134239109275">mon_probleme</a>-&gt;discretisation();
<a name="l01398"></a>01398 }
<a name="l01399"></a>01399 
<a name="l01400"></a><a class="code" href="classEquation__base.html#a1e62c4d38b25e577585c5e1d9a8942d9">01400</a> <span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#a1e62c4d38b25e577585c5e1d9a8942d9">Equation_base::creer_champ</a>(<span class="keyword">const</span> <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>&amp; motlu)
<a name="l01401"></a>01401 {
<a name="l01402"></a>01402   <span class="keywordflow">if</span> (motlu == <span class="stringliteral">&quot;volume_maille&quot;</span>)
<a name="l01403"></a>01403     {
<a name="l01404"></a>01404       <span class="keywordflow">if</span> (!<a class="code" href="classEquation__base.html#a9b54d9a7630b275ef0ab33260906ee88">volume_maille</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>())
<a name="l01405"></a>01405         {
<a name="l01406"></a>01406           <a class="code" href="classEquation__base.html#a324a761eaad25eb00d18e14764a1362e" title="Renvoie la discretisation associee a l&#39;equation.">discretisation</a>().<a class="code" href="classDiscretisation__base.html#a10370f8c7c68e836b3feab21d881276e">volume_maille</a>(<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>(),<a class="code" href="classEquation__base.html#a12d97ae801edc18f614523677921346e" title="Renvoie la zone discretisee associee a l&#39;equation.">zone_dis</a>(),<a class="code" href="classEquation__base.html#a9b54d9a7630b275ef0ab33260906ee88">volume_maille</a>);
<a name="l01407"></a>01407           <a class="code" href="classEquation__base.html#ad687c312e72dcbc783cf597af5927b07">champs_compris_</a>.<a class="code" href="classChamps__compris.html#aae00ca562b7d89ff638fae94d6973fcf">ajoute_champ</a>(<a class="code" href="classEquation__base.html#a9b54d9a7630b275ef0ab33260906ee88">volume_maille</a>);
<a name="l01408"></a>01408         }
<a name="l01409"></a>01409     }
<a name="l01410"></a>01410 <span class="comment">// pour recuperer une equation const !!!!!</span>
<a name="l01411"></a>01411   <span class="keyword">const</span> <a class="code" href="classEquation__base.html">Equation_base</a>&amp; me_const =(*this);
<a name="l01412"></a>01412   <span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; nom_inco=me_const.<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>()-&gt;<a class="code" href="classO__U__Ptr.html#a5aae0c48048a40339f3847aa14109231" title="Renvoie ref_().le_nom() si le pointeur est non nul ou &quot;Pointeur Nul&quot;.">le_nom</a>();
<a name="l01413"></a>01413   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> inco(nom_inco);
<a name="l01414"></a>01414   inco += <span class="stringliteral">&quot;_residu&quot;</span>;
<a name="l01415"></a>01415   <span class="keywordflow">if</span> (motlu == <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>(inco))
<a name="l01416"></a>01416     {
<a name="l01417"></a>01417       <span class="keywordflow">if</span> (!<a class="code" href="classEquation__base.html#a825047bced40808fed66dc595c3bfa21">field_residu_</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>())
<a name="l01418"></a>01418         {
<a name="l01419"></a>01419           <a class="code" href="classEquation__base.html#a324a761eaad25eb00d18e14764a1362e" title="Renvoie la discretisation associee a l&#39;equation.">discretisation</a>().<a class="code" href="classDiscretisation__base.html#aa3874015ac44f429a78211bdeb99b0dc">residu</a>(<a class="code" href="classEquation__base.html#a12d97ae801edc18f614523677921346e" title="Renvoie la zone discretisee associee a l&#39;equation.">zone_dis</a>(),<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>(),<a class="code" href="classEquation__base.html#a825047bced40808fed66dc595c3bfa21">field_residu_</a>);
<a name="l01420"></a>01420           <a class="code" href="classEquation__base.html#ad687c312e72dcbc783cf597af5927b07">champs_compris_</a>.<a class="code" href="classChamps__compris.html#aae00ca562b7d89ff638fae94d6973fcf">ajoute_champ</a>(<a class="code" href="classEquation__base.html#a825047bced40808fed66dc595c3bfa21">field_residu_</a>);
<a name="l01421"></a>01421         }
<a name="l01422"></a>01422     }
<a name="l01423"></a>01423 
<a name="l01424"></a>01424   <span class="keywordtype">int</span> nb_op = <a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>();
<a name="l01425"></a>01425   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nb_op; i++)
<a name="l01426"></a>01426     {
<a name="l01427"></a>01427       <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).op_non_nul())
<a name="l01428"></a>01428         <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#aadca812a67d59cc4fa48b20a19ae2c47">creer_champ</a>(motlu);
<a name="l01429"></a>01429     }
<a name="l01430"></a>01430 
<a name="l01431"></a>01431 
<a name="l01432"></a>01432   <a class="code" href="List_8h.html#a300f34d06c3e9d9918e439ede00ad7f4">LIST_CURSEUR</a>(<a class="code" href="classSource.html" title="classe Source Classe generique de la hierarchie des sources, un objet Source peut referencer n&#39;import...">Source</a>) curseur = <a class="code" href="classEquation__base.html#a6dae2cb8a228b0e3a6d90042fd75f360">les_sources</a>;
<a name="l01433"></a>01433   <span class="keywordflow">while</span>(curseur)
<a name="l01434"></a>01434     {
<a name="l01435"></a>01435       <span class="keywordflow">if</span> (curseur.valeur().non_nul())
<a name="l01436"></a>01436         curseur.<a class="code" href="classList__Source.html#a7e4137d89cdcf913702c88f720a7f316" title="Retourne l&#39;Objet_U associe a la cellule de la liste.">valeur</a>()-&gt;creer_champ(motlu);
<a name="l01437"></a>01437       ++curseur;
<a name="l01438"></a>01438     }
<a name="l01439"></a>01439 }
<a name="l01440"></a>01440 
<a name="l01441"></a><a class="code" href="classEquation__base.html#ad6bcab0bb6d83b1b563a7aa30f0df721">01441</a> <span class="keyword">const</span> <a class="code" href="classChamp__base.html" title="classe Champ_base Cette classe est la base de la hierarchie des champs. Ses membres sont les attribut...">Champ_base</a>&amp; <a class="code" href="classEquation__base.html#ad6bcab0bb6d83b1b563a7aa30f0df721">Equation_base::get_champ</a>(<span class="keyword">const</span> <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>&amp; nom)<span class="keyword"> const</span>
<a name="l01442"></a>01442 <span class="keyword"></span>{
<a name="l01443"></a>01443   <a class="code" href="Ref_8h.html#aab5720a5c34da14028d0745e386aaa01">REF</a>(<a class="code" href="classChamp__base.html" title="classe Champ_base Cette classe est la base de la hierarchie des champs. Ses membres sont les attribut...">Champ_base</a>) ref_champ;
<a name="l01444"></a>01444 
<a name="l01445"></a>01445   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> inco_residu (<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>()-&gt;<a class="code" href="classEquation__base.html#a65e9b2520ac7b42444e4d9aa4f18ccf7" title="Renvoie le nom de l&#39;equation.">le_nom</a>());
<a name="l01446"></a>01446   inco_residu += <span class="stringliteral">&quot;_residu&quot;</span>;
<a name="l01447"></a>01447   <span class="keywordflow">if</span> (nom==<span class="stringliteral">&quot;volume_maille&quot;</span>)
<a name="l01448"></a>01448     {
<a name="l01449"></a>01449       <a class="code" href="classChamp__Fonc__base.html" title="classe Champ_Fonc_base Classe de base des champs qui sont fonction d&#39;une grandeur calculee au cours d...">Champ_Fonc_base</a>&amp; ch_vol_maille=<a class="code" href="Cast_8h.html#ad3836a067c92103af8df5ad8f35959a6">ref_cast_non_const</a>(<a class="code" href="classChamp__Fonc__base.html" title="classe Champ_Fonc_base Classe de base des champs qui sont fonction d&#39;une grandeur calculee au cours d...">Champ_Fonc_base</a>,<a class="code" href="classEquation__base.html#a9b54d9a7630b275ef0ab33260906ee88">volume_maille</a>.<a class="code" href="classDeriv__Champ__Fonc__base.html#a6c7253d2225e858b40c9251d97d57f72">valeur</a>());
<a name="l01450"></a>01450       <span class="keywordflow">if</span> (<a class="code" href="Double_8h.html#a07be18d5898a837a4a609ddb08e37d50">est_different</a>(ch_vol_maille.<a class="code" href="classChamp__base.html#ada7350aecb7b6f20dcaee2d1106ab1a0" title="Renvoie le temps du champ.">temps</a>(),<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>()-&gt;<a class="code" href="classChamp__Inc.html#a38da91792d3b4d3ab725a6edf7f62b5a" title="Appel a l&#39;objet sous-jacent Renvoie le temps courant.">temps</a>()))
<a name="l01451"></a>01451         ch_vol_maille.<a class="code" href="classChamp__Fonc__base.html#ab7d6cd96245a8c9971313976c0f34ccc" title="Mise a jour en temps du champ.">mettre_a_jour</a>(<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>()-&gt;temps());
<a name="l01452"></a>01452     }
<a name="l01453"></a>01453   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(nom == <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>(inco_residu))
<a name="l01454"></a>01454     {
<a name="l01455"></a>01455       <a class="code" href="classChamp__Fonc__base.html" title="classe Champ_Fonc_base Classe de base des champs qui sont fonction d&#39;une grandeur calculee au cours d...">Champ_Fonc_base</a>&amp; ch=<a class="code" href="Cast_8h.html#ad3836a067c92103af8df5ad8f35959a6">ref_cast_non_const</a>(<a class="code" href="classChamp__Fonc__base.html" title="classe Champ_Fonc_base Classe de base des champs qui sont fonction d&#39;une grandeur calculee au cours d...">Champ_Fonc_base</a>,<a class="code" href="classEquation__base.html#a825047bced40808fed66dc595c3bfa21">field_residu_</a>.<a class="code" href="classDeriv__Champ__Fonc__base.html#a6c7253d2225e858b40c9251d97d57f72">valeur</a>());
<a name="l01456"></a>01456       <span class="keywordtype">double</span> temps_init = <a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a2389e67de1603768ab6b1bd396e0adba" title="Renvoie le temps initial.">temps_init</a>();
<a name="l01457"></a>01457       <span class="keywordflow">if</span> (((ch.<a class="code" href="classChamp__base.html#ada7350aecb7b6f20dcaee2d1106ab1a0" title="Renvoie le temps du champ.">temps</a>()!=<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>()-&gt;<a class="code" href="classChamp__Inc.html#a38da91792d3b4d3ab725a6edf7f62b5a" title="Appel a l&#39;objet sous-jacent Renvoie le temps courant.">temps</a>()) || (ch.<a class="code" href="classChamp__base.html#ada7350aecb7b6f20dcaee2d1106ab1a0" title="Renvoie le temps du champ.">temps</a>()==temps_init)) &amp;&amp; (<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>()-&gt;mon_equation_non_nul()))
<a name="l01458"></a>01458         {
<a name="l01459"></a>01459           ch.<a class="code" href="classChamp__Fonc__base.html#ab7d6cd96245a8c9971313976c0f34ccc" title="Mise a jour en temps du champ.">mettre_a_jour</a>(<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>()-&gt;temps());
<a name="l01460"></a>01460         }
<a name="l01461"></a>01461     }
<a name="l01462"></a>01462   <span class="keywordflow">else</span>
<a name="l01463"></a>01463     {
<a name="l01464"></a>01464       <a class="code" href="List_8h.html#add189d7375e577842ac891b09afc6d4b">CONST_LIST_CURSEUR</a>(<a class="code" href="classChamp__Fonc.html" title="classe Champ_Fonc Classe generique de la hierarchie des champs fontions du temps, un objet Champ_Fonc...">Champ_Fonc</a>) curseur = <a class="code" href="classEquation__base.html#a690c78ec3eec197aafb3eb5a8e3a8b16">list_champ_combi</a>;
<a name="l01465"></a>01465       <span class="keywordflow">while</span>(curseur)
<a name="l01466"></a>01466         {
<a name="l01467"></a>01467           <span class="keyword">const</span> <a class="code" href="classChamp__Fonc.html" title="classe Champ_Fonc Classe generique de la hierarchie des champs fontions du temps, un objet Champ_Fonc...">Champ_Fonc</a>&amp; ch = curseur.<a class="code" href="classDeriv__Champ__Fonc__base.html#a6c7253d2225e858b40c9251d97d57f72">valeur</a>();
<a name="l01468"></a>01468           <span class="keywordflow">if</span> (ch.<a class="code" href="classO__U__Ptr.html#a5aae0c48048a40339f3847aa14109231" title="Renvoie ref_().le_nom() si le pointeur est non nul ou &quot;Pointeur Nul&quot;.">le_nom</a>()==nom &amp;&amp; ch.<a class="code" href="classChamp__Fonc.html#a836322a95edc4f27a4e5e5e7667543f4" title="Appel a l&#39;objet sous-jacent Renvoie le temps courant du champ.">temps</a>()!=<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>()-&gt;<a class="code" href="classChamp__Inc.html#a38da91792d3b4d3ab725a6edf7f62b5a" title="Appel a l&#39;objet sous-jacent Renvoie le temps courant.">temps</a>())
<a name="l01469"></a>01469             <a class="code" href="Cast_8h.html#ad3836a067c92103af8df5ad8f35959a6">ref_cast_non_const</a>( <a class="code" href="classChamp__Fonc.html" title="classe Champ_Fonc Classe generique de la hierarchie des champs fontions du temps, un objet Champ_Fonc...">Champ_Fonc</a>,ch).mettre_a_jour(<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>()-&gt;temps());
<a name="l01470"></a>01470           ++curseur;
<a name="l01471"></a>01471         }
<a name="l01472"></a>01472     }
<a name="l01473"></a>01473   <span class="keywordflow">try</span>
<a name="l01474"></a>01474     {
<a name="l01475"></a>01475       <span class="keywordflow">return</span> <a class="code" href="classEquation__base.html#ad687c312e72dcbc783cf597af5927b07">champs_compris_</a>.<a class="code" href="classChamps__compris.html#af38aefe53d102cb5ea2d328df769f85f">get_champ</a>(nom);
<a name="l01476"></a>01476     }
<a name="l01477"></a>01477   <span class="keywordflow">catch</span> (<a class="code" href="classChamps__compris__erreur.html">Champs_compris_erreur</a>)
<a name="l01478"></a>01478     {
<a name="l01479"></a>01479 
<a name="l01480"></a>01480     }
<a name="l01481"></a>01481 
<a name="l01482"></a>01482   <span class="keywordflow">try</span>
<a name="l01483"></a>01483     {
<a name="l01484"></a>01484       <span class="keywordflow">return</span> <a class="code" href="classEquation__base.html#a181e9899e2d927eb14c835d9d9334f46">milieu</a>().<a class="code" href="classMilieu__base.html#aa60c5c79f63e87851dba756038d81e47">get_champ</a>(nom);
<a name="l01485"></a>01485     }
<a name="l01486"></a>01486   <span class="keywordflow">catch</span> (<a class="code" href="classChamps__compris__erreur.html">Champs_compris_erreur</a>)
<a name="l01487"></a>01487     {
<a name="l01488"></a>01488     }
<a name="l01489"></a>01489   <span class="keywordtype">int</span> nb_op = <a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>();
<a name="l01490"></a>01490   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nb_op; i++)
<a name="l01491"></a>01491     {
<a name="l01492"></a>01492       <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).op_non_nul())
<a name="l01493"></a>01493         <span class="keywordflow">try</span>
<a name="l01494"></a>01494           {
<a name="l01495"></a>01495             <span class="keywordflow">return</span> <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#a067527f1aa6a36bbbf7e0d821f9d7d79">get_champ</a>(nom);
<a name="l01496"></a>01496           }
<a name="l01497"></a>01497         <span class="keywordflow">catch</span> (<a class="code" href="classChamps__compris__erreur.html">Champs_compris_erreur</a>)
<a name="l01498"></a>01498           {
<a name="l01499"></a>01499 
<a name="l01500"></a>01500           }
<a name="l01501"></a>01501     }
<a name="l01502"></a>01502 
<a name="l01503"></a>01503 
<a name="l01504"></a>01504   <a class="code" href="List_8h.html#add189d7375e577842ac891b09afc6d4b">CONST_LIST_CURSEUR</a>(<a class="code" href="classSource.html" title="classe Source Classe generique de la hierarchie des sources, un objet Source peut referencer n&#39;import...">Source</a>) curseur = <a class="code" href="classEquation__base.html#a6dae2cb8a228b0e3a6d90042fd75f360">les_sources</a>;
<a name="l01505"></a>01505   <span class="keywordflow">while</span>(curseur)
<a name="l01506"></a>01506     {
<a name="l01507"></a>01507       <span class="keywordflow">if</span> (curseur.valeur().non_nul())
<a name="l01508"></a>01508         <span class="keywordflow">try</span>
<a name="l01509"></a>01509           {
<a name="l01510"></a>01510             <span class="keywordflow">return</span> curseur.<a class="code" href="classList__Source.html#a7e4137d89cdcf913702c88f720a7f316" title="Retourne l&#39;Objet_U associe a la cellule de la liste.">valeur</a>()-&gt;get_champ(nom);
<a name="l01511"></a>01511           }
<a name="l01512"></a>01512         <span class="keywordflow">catch</span> (<a class="code" href="classChamps__compris__erreur.html">Champs_compris_erreur</a>)
<a name="l01513"></a>01513           {
<a name="l01514"></a>01514 
<a name="l01515"></a>01515           }
<a name="l01516"></a>01516       ++curseur;
<a name="l01517"></a>01517     }
<a name="l01518"></a>01518   <span class="keywordflow">throw</span> <a class="code" href="classChamps__compris__erreur.html">Champs_compris_erreur</a>();
<a name="l01519"></a>01519 
<a name="l01520"></a>01520   <span class="keywordflow">return</span> ref_champ;
<a name="l01521"></a>01521 }
<a name="l01522"></a>01522 
<a name="l01523"></a><a class="code" href="classEquation__base.html#ab8e18c5cd6c6c9a6279e6397341b6726">01523</a> <span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#ab8e18c5cd6c6c9a6279e6397341b6726">Equation_base::get_noms_champs_postraitables</a>(<a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a>&amp; noms,<a class="code" href="Champs__compris__interface_8h.html#a0e65ad13124ea2cb5e255b640464e35f">Option</a> opt)<span class="keyword"> const</span>
<a name="l01524"></a>01524 <span class="keyword"></span>{
<a name="l01525"></a>01525   <span class="keywordflow">if</span> (opt==<a class="code" href="Champs__compris__interface_8h.html#a0e65ad13124ea2cb5e255b640464e35fab6018339139b51a498dc44bd760766fc">DESCRIPTION</a>)
<a name="l01526"></a>01526     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>()&lt;&lt;<span class="stringliteral">&quot; : &quot;</span>&lt;&lt;<a class="code" href="classEquation__base.html#ad687c312e72dcbc783cf597af5927b07">champs_compris_</a>.<a class="code" href="classChamps__compris.html#a6c706a60f39a30318d2a0dd2a582e50e">liste_noms_compris</a>()&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01527"></a>01527   <span class="keywordflow">else</span>
<a name="l01528"></a>01528     noms.<a class="code" href="classVect__Nom.html#ae20c0d0842c00756c1a2610fe0ca471f">add</a>(<a class="code" href="classEquation__base.html#ad687c312e72dcbc783cf597af5927b07">champs_compris_</a>.<a class="code" href="classChamps__compris.html#a6c706a60f39a30318d2a0dd2a582e50e">liste_noms_compris</a>());
<a name="l01529"></a>01529   <a class="code" href="classEquation__base.html#a181e9899e2d927eb14c835d9d9334f46">milieu</a>().<a class="code" href="classMilieu__base.html#a2b42ba072ef0223b206c68591ee07218">get_noms_champs_postraitables</a>(noms,opt);
<a name="l01530"></a>01530   <span class="keywordtype">int</span> nb_op = <a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>();
<a name="l01531"></a>01531   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nb_op; i++)
<a name="l01532"></a>01532     {
<a name="l01533"></a>01533       <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).op_non_nul())
<a name="l01534"></a>01534         <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#a94f7a98b46073fefd084fa15553d58b7">get_noms_champs_postraitables</a>(noms,opt);
<a name="l01535"></a>01535     }
<a name="l01536"></a>01536 
<a name="l01537"></a>01537 
<a name="l01538"></a>01538   <a class="code" href="List_8h.html#add189d7375e577842ac891b09afc6d4b">CONST_LIST_CURSEUR</a>(<a class="code" href="classSource.html" title="classe Source Classe generique de la hierarchie des sources, un objet Source peut referencer n&#39;import...">Source</a>) curseur = <a class="code" href="classEquation__base.html#a6dae2cb8a228b0e3a6d90042fd75f360">les_sources</a>;
<a name="l01539"></a>01539   <span class="keywordflow">while</span>(curseur)
<a name="l01540"></a>01540     {
<a name="l01541"></a>01541       <span class="keywordflow">if</span> (curseur.valeur().non_nul())
<a name="l01542"></a>01542         curseur.<a class="code" href="classList__Source.html#a7e4137d89cdcf913702c88f720a7f316" title="Retourne l&#39;Objet_U associe a la cellule de la liste.">valeur</a>()-&gt;get_noms_champs_postraitables(noms,opt);
<a name="l01543"></a>01543       ++curseur;
<a name="l01544"></a>01544     }
<a name="l01545"></a>01545 
<a name="l01546"></a>01546 }
<a name="l01547"></a>01547 
<a name="l01548"></a>01548 
<a name="l01549"></a>01549 <span class="comment">// Precondition: un schema en temps doit avoir ete associe</span>
<a name="l01550"></a>01550 <span class="comment">// Parametre:</span>
<a name="l01551"></a>01551 <span class="comment">// Signification:</span>
<a name="l01552"></a>01552 <span class="comment">// Valeurs par defaut:</span>
<a name="l01553"></a>01553 <span class="comment">// Contraintes:</span>
<a name="l01554"></a>01554 <span class="comment">// Acces:</span>
<a name="l01555"></a>01555 <span class="comment">// Exception:</span>
<a name="l01556"></a>01556 <span class="comment">// Effets de bord: impression eventuelle des pas de temps</span>
<a name="l01557"></a>01557 <span class="comment">// Postcondition:</span>
<a name="l01558"></a>01558 <span class="comment">//</span>
<a name="l01559"></a>01559 <span class="comment">//</span>
<a name="l01560"></a>01560 <span class="comment">//</span>
<a name="l01561"></a>01561 <span class="comment">//</span>
<a name="l01562"></a>01562 <span class="comment">//</span><span class="comment"></span>
<a name="l01563"></a>01563 <span class="comment">//! Calcul du prochain pas de temps.&lt;br&gt;Renvoie l&#39;inverse de la somme des inverses des&lt;br&gt;pas de temps calcules par les operateurs.&lt;br&gt;Ces pas de temps sont ceux pour le schema d&#39;Euler explicite.&lt;br&gt;Le pas de temps n&#39;est pas majore par dt_max, ceci est fait dans corriger_dt_calcule</span>
<a name="l01564"></a>01564 <span class="comment"></span><span class="comment">/** \return double&lt;br&gt;</span>
<a name="l01565"></a>01565 <span class="comment">Signification: inverse de la somme des inverses des pas de temps&lt;br&gt;</span>
<a name="l01566"></a>01566 <span class="comment">calcules par les operateurs&lt;br&gt;</span>
<a name="l01567"></a>01567 <span class="comment">Contraintes: */</span>
<a name="l01568"></a><a class="code" href="classEquation__base.html#a5b0b97f18ca64a6f26e984e25c944ee1">01568</a> <span class="keywordtype">double</span> <a class="code" href="classEquation__base.html#a5b0b97f18ca64a6f26e984e25c944ee1" title="Calcul du prochain pas de temps. Renvoie l&#39;inverse de la somme des inverses des pas de temps calcules...">Equation_base::calculer_pas_de_temps</a>()<span class="keyword"> const</span>
<a name="l01569"></a>01569 <span class="keyword"></span>{
<a name="l01570"></a>01570   <span class="keywordtype">bool</span> harmonic_calculation = <span class="keyword">true</span>;
<a name="l01571"></a>01571   <span class="keywordtype">double</span> dt_op;
<a name="l01572"></a>01572   <span class="keywordtype">double</span> dt;
<a name="l01573"></a>01573   <span class="keywordflow">if</span> (harmonic_calculation)
<a name="l01574"></a>01574     dt = 0;
<a name="l01575"></a>01575   <span class="keywordflow">else</span>
<a name="l01576"></a>01576     dt = <a class="code" href="Double_8h.html#ae0ee0cebfad5968da0ad6cc7a49e16b6">DMAXFLOAT</a>;
<a name="l01577"></a>01577 
<a name="l01578"></a>01578   <span class="keywordtype">int</span> nb_op = <a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>();
<a name="l01579"></a>01579   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;nb_op; i++)
<a name="l01580"></a>01580     {
<a name="l01581"></a>01581       <span class="keywordflow">if</span>(<a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).l_op_base().get_decal_temps()!=1)
<a name="l01582"></a>01582         dt_op = <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).<a class="code" href="classOperateur.html#a91e87aa1eb109081795c5af2569e5794" title="Calcule le prochain pas de temps.">calculer_pas_de_temps</a>();
<a name="l01583"></a>01583       <span class="keywordflow">else</span>
<a name="l01584"></a>01584         dt_op = <a class="code" href="Double_8h.html#ae0ee0cebfad5968da0ad6cc7a49e16b6">DMAXFLOAT</a>;
<a name="l01585"></a>01585 
<a name="l01586"></a>01586       <a class="code" href="Op__Div__VEFP1B__Elem_8cpp.html#a45261662b3b88d5db461b3fc99246e5a">Debog::verifier</a>(<span class="stringliteral">&quot;Equation_base::calculer_pas_de_temps dt_op 0 &quot;</span>,dt_op);
<a name="l01587"></a>01587 
<a name="l01588"></a>01588       <a class="code" href="Op__Div__VEFP1B__Elem_8cpp.html#a45261662b3b88d5db461b3fc99246e5a">Debog::verifier</a>(<span class="stringliteral">&quot;Equation_base::calculer_pas_de_temps dt &quot;</span>,dt);
<a name="l01589"></a>01589       <span class="keyword">const</span> <a class="code" href="classOperateur__base.html" title="classe Operateur_base Classe est la base de la hierarchie des objets representant un operateur utilis...">Operateur_base</a>&amp; op=<a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>();
<a name="l01590"></a>01590       <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classOperateur__Diff__base.html" title="classe Operateur_Diff_base Cette classe est la base de la hierarchie des operateurs representant un t...">Operateur_Diff_base</a>,op) &amp;&amp; <a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>-&gt;diffusion_implicite())
<a name="l01591"></a>01591         {
<a name="l01592"></a>01592 <span class="comment">// On ne compte pas le pas de temps de diffusion lorsque la diffusion est implicitee</span>
<a name="l01593"></a>01593         }
<a name="l01594"></a>01594       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dt_op&gt;0)
<a name="l01595"></a>01595         {
<a name="l01596"></a>01596 <span class="comment">// Une demie-moyenne harmonique est justifiee par le fait que diffusion et convection sont deux phenonomenes qui se cumulent</span>
<a name="l01597"></a>01597 <span class="comment">// L&#39;information a chaque pas de temps ne peut traverser plus d&#39;une maille de calcul donc dt*U + dt*vitesse_diffusion(~alpha/dx) &lt; dx</span>
<a name="l01598"></a>01598 <span class="comment">// donc dt &lt; dx/(U+alpha/dx) = 1/(1/(dx/U)+1/(dx^2/alpha)) : c&#39;est bien une demie moyenne harmonique...</span>
<a name="l01599"></a>01599           <span class="keywordflow">if</span> (harmonic_calculation)
<a name="l01600"></a>01600             dt = dt + 1./dt_op;
<a name="l01601"></a>01601           <span class="keywordflow">else</span>
<a name="l01602"></a>01602 <span class="comment">// https://en.wikipedia.org/wiki/Numerical_solution_of_the_convection%E2%80%93diffusion_equation</span>
<a name="l01603"></a>01603 <span class="comment">// On pourrait prendre le min de tous les operateurs. Mais attention parfois peut diverger:</span>
<a name="l01604"></a>01604 <span class="comment">// Un cas typique (rare?) Convection.data ecoulement en travers par rapport au maillage VDF et Re(maille)~1</span>
<a name="l01605"></a>01605             dt = (dt_op &lt; dt ? dt_op : dt);
<a name="l01606"></a>01606         }
<a name="l01607"></a>01607 
<a name="l01608"></a>01608       <a class="code" href="Op__Div__VEFP1B__Elem_8cpp.html#a45261662b3b88d5db461b3fc99246e5a">Debog::verifier</a>(<span class="stringliteral">&quot;Equation_base::calculer_pas_de_temps dt_op 1 &quot;</span>,dt_op);
<a name="l01609"></a>01609       <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>-&gt;limpr())
<a name="l01610"></a>01610         {
<a name="l01611"></a>01611           <span class="keywordflow">if</span> (i == 0)
<a name="l01612"></a>01612             {
<a name="l01613"></a>01613               <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01614"></a>01614               <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;Printing of the next provisional time steps for the equation: &quot;</span> &lt;&lt; <a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; finl;
<a name="l01615"></a>01615             }
<a name="l01616"></a>01616           <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classOperateur__Conv__base.html" title="classe Operateur_Conv_base Cette classe est la base de la hierarchie des operateurs representant un t...">Operateur_Conv_base</a>,op))
<a name="l01617"></a>01617             <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;   convective&quot;</span>;
<a name="l01618"></a>01618           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classOperateur__Diff__base.html" title="classe Operateur_Diff_base Cette classe est la base de la hierarchie des operateurs representant un t...">Operateur_Diff_base</a>,op))
<a name="l01619"></a>01619             <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;   diffusive&quot;</span>;
<a name="l01620"></a>01620           <span class="keywordflow">else</span>
<a name="l01621"></a>01621             <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;   operator &quot;</span>;
<a name="l01622"></a>01622           <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a>&lt;&lt;<span class="stringliteral">&quot; time step : &quot;</span>&lt;&lt; <a class="code" href="classEquation__base.html#a83044a97de577592dea52668854266cd">dt_op_bak</a>[i] &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01623"></a>01623         }
<a name="l01624"></a>01624       <a class="code" href="classEquation__base.html#a83044a97de577592dea52668854266cd">dt_op_bak</a>[i]=dt_op;
<a name="l01625"></a>01625     }
<a name="l01626"></a>01626   <span class="keywordflow">if</span> (harmonic_calculation)
<a name="l01627"></a>01627     {
<a name="l01628"></a>01628       <span class="keywordflow">if</span> (dt==0.)
<a name="l01629"></a>01629         dt = <a class="code" href="Double_8h.html#ae0ee0cebfad5968da0ad6cc7a49e16b6">DMAXFLOAT</a>;
<a name="l01630"></a>01630       <span class="keywordflow">else</span>
<a name="l01631"></a>01631         dt = 1./dt;
<a name="l01632"></a>01632     }
<a name="l01633"></a>01633 <span class="comment">// Warning sur les premiers pas de temps si l&#39;implicitation de la diffusion</span>
<a name="l01634"></a>01634 <span class="comment">// dans un schema explicite vaut le coup (dt_diff&lt;&lt;min(dt_max,dt_conv))</span>
<a name="l01635"></a>01635 <span class="comment">// On fait le test apres les 10 premiers pas de temps en cas de demarrage avec vitesse nulle</span>
<a name="l01636"></a>01636   <span class="keywordtype">int</span> nw=100;
<a name="l01637"></a>01637   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>-&gt;nb_pas_dt()&gt;10 &amp;&amp; <a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>-&gt;nb_pas_dt()&lt;nw &amp;&amp; <a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>-&gt;limpr())
<a name="l01638"></a>01638     <span class="keywordflow">if</span> (nb_op&gt;1 &amp;&amp; <a class="code" href="classEquation__base.html#a83044a97de577592dea52668854266cd">dt_op_bak</a>[0]&lt;0.01*<a class="code" href="Double_8h.html#a2f8edc4561e9744ed4233b205fa7ec32">min</a>(<a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>-&gt;pas_temps_max(),<a class="code" href="classEquation__base.html#a83044a97de577592dea52668854266cd">dt_op_bak</a>[1]) &amp;&amp; <a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classSchema__Euler__explicite.html" title="classe Schema_Euler_explicite Cette classe represente un schema en temps d&#39;Euler explicite: U(n+1) = ...">Schema_Euler_explicite</a>,<a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>.<a class="code" href="classRef__Schema__Temps__base.html#a1cdfccd0f1ad187e0e83d762e69a7834">valeur</a>()) &amp;&amp; !<a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>-&gt;diffusion_implicite())
<a name="l01639"></a>01639       {
<a name="l01640"></a>01640         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a> &lt;&lt; <span class="stringliteral">&quot;**** Advice (printed only on the first &quot;</span> &lt;&lt; nw &lt;&lt; <span class="stringliteral">&quot; time steps) ****&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01641"></a>01641         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;You could use diffusion_implicite option into the Euler scheme to increase the stability time step of the &quot;</span> &lt;&lt; this-&gt;<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; <span class="stringliteral">&quot; equation by impliciting the diffusive operator.&quot;</span> &lt;&lt; finl;
<a name="l01642"></a>01642       }
<a name="l01643"></a>01643   <a class="code" href="Op__Div__VEFP1B__Elem_8cpp.html#a45261662b3b88d5db461b3fc99246e5a">Debog::verifier</a>(<span class="stringliteral">&quot;Equation_base::calculer_pas_de_temps dt &quot;</span>,dt);
<a name="l01644"></a>01644   <span class="keywordflow">return</span> dt;
<a name="l01645"></a>01645 }
<a name="l01646"></a>01646 
<a name="l01647"></a>01647 <span class="comment">// Description</span>
<a name="l01648"></a>01648 <span class="comment">// Calculation of local time: Vect of size number of faces of the domain</span>
<a name="l01649"></a>01649 <span class="comment">// Calculate whether the &quot;steady&quot; option is used in the &quot;Euler implicit&quot;</span>
<a name="l01650"></a>01650 <span class="comment">// The local time step is a convection temp step</span>
<a name="l01651"></a><a class="code" href="classEquation__base.html#a01b56103494778deaeafccafeff6f82a">01651</a> <span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#a01b56103494778deaeafccafeff6f82a">Equation_base::calculer_pas_de_temps_locaux</a>(<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; dt_op)<span class="keyword"> const</span>
<a name="l01652"></a>01652 <span class="keyword"></span>{
<a name="l01653"></a>01653   <span class="keywordtype">int</span> nb_op=<a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>();
<a name="l01654"></a>01654   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;nb_op; i++)
<a name="l01655"></a>01655     {
<a name="l01656"></a>01656       <span class="keyword">const</span> <a class="code" href="classOperateur__base.html" title="classe Operateur_base Classe est la base de la hierarchie des objets representant un operateur utilis...">Operateur_base</a>&amp; op=<a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>();
<a name="l01657"></a>01657       <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classOperateur__Conv__base.html" title="classe Operateur_Conv_base Cette classe est la base de la hierarchie des operateurs representant un t...">Operateur_Conv_base</a>,op))
<a name="l01658"></a>01658         {
<a name="l01659"></a>01659           <span class="keywordflow">if</span>(<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classOp__Conv__negligeable.html" title="Classe Op_Conv_negligeable Cette classe represente un opperateur de convection negligeable. Lorsqu&#39;un operateur de ce type est utilise dans une equation cela revient a negliger le terme de convection. Les methodes de modification et de participation a un calcul de l&#39;operateur sont en fait des appels aux meme methodes de Operateur_negligeable qui ne font rien.">Op_Conv_negligeable</a>, op))
<a name="l01660"></a>01660             {
<a name="l01661"></a>01661               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!&quot;</span>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01662"></a>01662               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;STEADY option is not compatible with the &#39;CONVECTION { NEGLIGEABLE }&#39; model!&quot;</span>&lt;&lt;finl;
<a name="l01663"></a>01663               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Please, contact TRUST support.&quot;</span> &lt;&lt; finl;
<a name="l01664"></a>01664               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!&quot;</span>&lt;&lt;finl;
<a name="l01665"></a>01665               <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l01666"></a>01666             }
<a name="l01667"></a>01667           <span class="keywordflow">else</span>
<a name="l01668"></a>01668             <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).<a class="code" href="classOperateur.html#a6ccdd8866637d733826a229e2cb0c906" title="Calculate the next local time steps.">calculer_pas_de_temps_locaux</a>(dt_op);
<a name="l01669"></a>01669 
<a name="l01670"></a>01670         }
<a name="l01671"></a>01671     }
<a name="l01672"></a>01672 
<a name="l01673"></a>01673 }
<a name="l01674"></a>01674 
<a name="l01675"></a>01675 <span class="comment">// Precondition:</span>
<a name="l01676"></a>01676 <span class="comment">// Parametre:</span>
<a name="l01677"></a>01677 <span class="comment">// Signification:</span>
<a name="l01678"></a>01678 <span class="comment">// Valeurs par defaut:</span>
<a name="l01679"></a>01679 <span class="comment">// Contraintes:</span>
<a name="l01680"></a>01680 <span class="comment">// Acces:</span>
<a name="l01681"></a>01681 <span class="comment">// Exception:</span>
<a name="l01682"></a>01682 <span class="comment">// Effets de bord:</span>
<a name="l01683"></a>01683 <span class="comment">// Postcondition: la methode ne modifie pas l&#39;objet</span>
<a name="l01684"></a>01684 <span class="comment">//</span>
<a name="l01685"></a>01685 <span class="comment">//</span><span class="comment"></span>
<a name="l01686"></a>01686 <span class="comment">//! Verifie la compatibilite des conditions limites avec l&#39;equation.&lt;br&gt;voir Conds_lim::compatible_avec_eqn().</span>
<a name="l01687"></a>01687 <span class="comment"></span><span class="comment">/** \return int&lt;br&gt;</span>
<a name="l01688"></a>01688 <span class="comment">Signification:&lt;br&gt;</span>
<a name="l01689"></a>01689 <span class="comment">Contraintes: */</span>
<a name="l01690"></a><a class="code" href="classEquation__base.html#afd7b9a39511b8a74fa314cbfb33aa80f">01690</a> <span class="keywordtype">int</span> <a class="code" href="classEquation__base.html#afd7b9a39511b8a74fa314cbfb33aa80f" title="Verifie la compatibilite des conditions limites avec l&#39;equation. voir Conds_lim::compatible_avec_eqn(...">Equation_base::verif_Cl</a>()<span class="keyword"> const</span>
<a name="l01691"></a>01691 <span class="keyword"></span>{
<a name="l01692"></a>01692   <span class="keyword">const</span> <a class="code" href="classConds__lim.html">Conds_lim</a>&amp; les_cl=<a class="code" href="classEquation__base.html#aa097c6ddc00bdb913c39739689f6d5c4">la_zone_Cl_dis</a>-&gt;<a class="code" href="classZone__Cl__dis.html#aafbd0525703e23200e31796bcd4fcac6" title="Appel a l&#39;objet sous-jacent Renvoie la i-ieme condition aux limites. (version const)">les_conditions_limites</a>();
<a name="l01693"></a>01693   les_cl.<a class="code" href="classConds__lim.html#ac0f7732e5c9102d08787b330ba3bffa7" title="Renvoie si TOUTES les conditions aux limites du vecteurs sont compatibles avec l&#39;equation passee en p...">compatible_avec_eqn</a>(*<span class="keyword">this</span>);
<a name="l01694"></a>01694   <span class="keywordflow">return</span> les_cl.<a class="code" href="classConds__lim.html#a82363676bb1fb1320384945ed5f88d98" title="Renvoie si TOUTES les conditions aux limites du vecteurs sont compatibles avec la discretisation pass...">compatible_avec_discr</a>(<a class="code" href="classEquation__base.html#a324a761eaad25eb00d18e14764a1362e" title="Renvoie la discretisation associee a l&#39;equation.">discretisation</a>());
<a name="l01695"></a>01695 }
<a name="l01696"></a>01696 
<a name="l01697"></a>01697 <span class="comment">// Precondition:</span>
<a name="l01698"></a>01698 <span class="comment">// Parametre:</span>
<a name="l01699"></a>01699 <span class="comment">// Signification:</span>
<a name="l01700"></a>01700 <span class="comment">// Valeurs par defaut:</span>
<a name="l01701"></a>01701 <span class="comment">// Contraintes:</span>
<a name="l01702"></a>01702 <span class="comment">// Acces:</span>
<a name="l01703"></a>01703 <span class="comment">// Exception:</span>
<a name="l01704"></a>01704 <span class="comment">// Effets de bord:</span>
<a name="l01705"></a>01705 <span class="comment">// Postcondition: la methode ne modifie pas l&#39;objet</span>
<a name="l01706"></a>01706 <span class="comment">//</span>
<a name="l01707"></a>01707 <span class="comment">//</span>
<a name="l01708"></a>01708 <span class="comment">//</span><span class="comment"></span>
<a name="l01709"></a>01709 <span class="comment">//! Renvoie &quot;indetermine&quot;&lt;br&gt;Navier_Stokes_standard par exemple surcharge cette methode&lt;br&gt;pour renvoyer &quot;Hydraulique&quot;</span>
<a name="l01710"></a>01710 <span class="comment"></span><span class="comment">/** \return Motcle\&amp;&lt;br&gt;</span>
<a name="l01711"></a>01711 <span class="comment">Signification: le nom du domaine d&#39;aplication&lt;br&gt;</span>
<a name="l01712"></a>01712 <span class="comment">Contraintes: reference constante */</span>
<a name="l01713"></a><a class="code" href="classEquation__base.html#a3925cc36ecc3bb26f5016d225fd7b433">01713</a> <span class="keyword">const</span> <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>&amp; <a class="code" href="classEquation__base.html#a3925cc36ecc3bb26f5016d225fd7b433" title="Renvoie &quot;indetermine&quot; Navier_Stokes_standard par exemple surcharge cette methode pour renvoyer &quot;Hydra...">Equation_base::domaine_application</a>()<span class="keyword"> const</span>
<a name="l01714"></a>01714 <span class="keyword"></span>{
<a name="l01715"></a>01715   <span class="keyword">static</span> <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> defaut=<span class="stringliteral">&quot;indetermine&quot;</span>;
<a name="l01716"></a>01716   <span class="keywordflow">return</span> defaut;
<a name="l01717"></a>01717 }
<a name="l01718"></a>01718 
<a name="l01719"></a>01719 <span class="comment">// Precondition:</span>
<a name="l01720"></a>01720 <span class="comment">// Parametre:  ch_ref  : un champ inconnu de l equation consideree</span>
<a name="l01721"></a>01721 <span class="comment">// nb_comp : nombre de composantes du champ lu</span>
<a name="l01722"></a>01722 <span class="comment">// Exception:</span>
<a name="l01723"></a>01723 <span class="comment">// Effets de bord:</span>
<a name="l01724"></a>01724 <span class="comment">// Postcondition:</span>
<a name="l01725"></a>01725 <span class="comment">//</span>
<a name="l01726"></a>01726 <span class="comment">//</span><span class="comment"></span>
<a name="l01727"></a>01727 <span class="comment">//! Verification du nombre de composantes lues pour la specification d un champ.&lt;br&gt;Actuellement utilise pour la lecture d un condition initiale ou limite.</span>
<a name="l01728"></a><a class="code" href="classEquation__base.html#ad1f2ad11c460019344768e591ec41825">01728</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#ad1f2ad11c460019344768e591ec41825" title="Verification du nombre de composantes lues pour la specification d un champ. Actuellement utilise pou...">Equation_base::verifie_ch_init_nb_comp</a>(<span class="keyword">const</span> <a class="code" href="classChamp__Inc__base.html" title="Classe Champ_Inc_base Classe de base des champs inconnues qui sont les champs calcules par une equati...">Champ_Inc_base</a>&amp; ch_ref, <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; nb_comp)<span class="keyword"> const</span>
<a name="l01729"></a>01729 <span class="keyword"></span>{
<a name="l01730"></a>01730   <span class="keyword">const</span> <a class="code" href="Field__base_8h.html#a1b86c8f670a9b34da7f628a821fb646b" title="This is a base class from which inherit Champ_base and Champ_front_base. It handles all the generic a...">Nature_du_champ</a> nature = ch_ref.<a class="code" href="classField__base.html#a75bf4e0a6258589a83801c0383d049cc" title="Renvoie la nature d&#39;un champ (scalaire, multiscalaire, vectoriel).">nature_du_champ</a>();
<a name="l01731"></a>01731   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_composantes = ch_ref.<a class="code" href="classField__base.html#a16e3abfebaaf9b7ef83acb936c872a91" title="Renvoie le nombre de composantes du champ.">nb_comp</a>();
<a name="l01732"></a>01732   <span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; nom = ch_ref.<a class="code" href="classField__base.html#ae1377124eabe8387aced762115b062bb" title="Renvoie le nom du champ.">le_nom</a>();
<a name="l01733"></a>01733 
<a name="l01734"></a>01734   <span class="keywordflow">if</span> (nature==<a class="code" href="Field__base_8h.html#a1b86c8f670a9b34da7f628a821fb646ba38e43fd39568540207f625e91bfcb6a3">scalaire</a>)
<a name="l01735"></a>01735     {
<a name="l01736"></a>01736       <span class="keywordflow">if</span> (nb_comp!=1)
<a name="l01737"></a>01737         {
<a name="l01738"></a>01738           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;The nature of the field &quot;</span>&lt;&lt;nom&lt;&lt;<span class="stringliteral">&quot; unknown to the equation name &quot;</span>&lt;&lt;<a class="code" href="classEquation__base.html#a65e9b2520ac7b42444e4d9aa4f18ccf7" title="Renvoie le nom de l&#39;equation.">le_nom</a>()&lt;&lt;<span class="stringliteral">&quot; is scalar.&quot;</span>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01739"></a>01739           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;The number of components readed for this field &quot;</span>&lt;&lt;nb_comp&lt;&lt;<span class="stringliteral">&quot; is not compatible with its nature.&quot;</span>&lt;&lt;finl;
<a name="l01740"></a>01740           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;We must read only one component for this field.&quot;</span>&lt;&lt;finl;
<a name="l01741"></a>01741           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l01742"></a>01742         }
<a name="l01743"></a>01743     }
<a name="l01744"></a>01744   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nature==<a class="code" href="Field__base_8h.html#a1b86c8f670a9b34da7f628a821fb646ba66d795f4e2fbb5636a3966c73964c5e7">vectoriel</a>)
<a name="l01745"></a>01745     {
<a name="l01746"></a>01746       <span class="keywordflow">if</span> (nb_comp!=<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">Objet_U::dimension</a>)
<a name="l01747"></a>01747         {
<a name="l01748"></a>01748           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;The nature of the field &quot;</span>&lt;&lt;nom&lt;&lt;<span class="stringliteral">&quot; unknown to the equation name &quot;</span>&lt;&lt;<a class="code" href="classEquation__base.html#a65e9b2520ac7b42444e4d9aa4f18ccf7" title="Renvoie le nom de l&#39;equation.">le_nom</a>()&lt;&lt;<span class="stringliteral">&quot; is vector.&quot;</span>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01749"></a>01749           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;The number of components readed for this field &quot;</span>&lt;&lt;nb_comp&lt;&lt;<span class="stringliteral">&quot; is not compatible with its nature.&quot;</span>&lt;&lt;finl;
<a name="l01750"></a>01750           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;It should read &quot;</span>&lt;&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">Objet_U::dimension</a>&lt;&lt;<span class="stringliteral">&quot; components for this field.&quot;</span>&lt;&lt;finl;
<a name="l01751"></a>01751           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l01752"></a>01752         }
<a name="l01753"></a>01753     }
<a name="l01754"></a>01754   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nature==<a class="code" href="Field__base_8h.html#a1b86c8f670a9b34da7f628a821fb646ba5c7919c9af898542b94861e963ade862">multi_scalaire</a>)
<a name="l01755"></a>01755     {
<a name="l01756"></a>01756       <span class="keywordflow">if</span> (nb_comp!=nb_composantes)
<a name="l01757"></a>01757         {
<a name="l01758"></a>01758           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;The nature of the field &quot;</span>&lt;&lt;nom&lt;&lt;<span class="stringliteral">&quot; unknown to the equation name &quot;</span>&lt;&lt;<a class="code" href="classEquation__base.html#a65e9b2520ac7b42444e4d9aa4f18ccf7" title="Renvoie le nom de l&#39;equation.">le_nom</a>()&lt;&lt;<span class="stringliteral">&quot; is multiscalar.&quot;</span>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01759"></a>01759           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;The number of components readed for this field &quot;</span>&lt;&lt;nb_comp&lt;&lt;<span class="stringliteral">&quot; does not match the number expected.&quot;</span>&lt;&lt;finl;
<a name="l01760"></a>01760           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;It should read &quot;</span>&lt;&lt;nb_composantes&lt;&lt;<span class="stringliteral">&quot; components for this field.&quot;</span>&lt;&lt;finl;
<a name="l01761"></a>01761           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l01762"></a>01762         }
<a name="l01763"></a>01763     }
<a name="l01764"></a>01764   <span class="keywordflow">else</span>
<a name="l01765"></a>01765     {
<a name="l01766"></a>01766       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;The nature of the field is not recognized&quot;</span>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01767"></a>01767       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l01768"></a>01768     }
<a name="l01769"></a>01769 }
<a name="l01770"></a>01770 
<a name="l01771"></a>01771 <span class="comment">//</span>
<a name="l01772"></a>01772 <span class="comment">//</span>
<a name="l01773"></a>01773 <span class="comment">//</span><span class="comment"></span>
<a name="l01774"></a>01774 <span class="comment">//! Add convection term&lt;br&gt;In:  solution is the unknown I&lt;br&gt;Out: secmem is increased by convection(I)</span>
<a name="l01775"></a><a class="code" href="classEquation__base.html#a20d04d53bd0c4b48aa923c2b328bb1e3">01775</a> <span class="comment"></span><a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; <a class="code" href="classEquation__base.html#a20d04d53bd0c4b48aa923c2b328bb1e3" title="Add convection term In: solution is the unknown I Out: secmem is increased by convection(I)">Equation_base::derivee_en_temps_conv</a>(<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; secmem, <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; solution)
<a name="l01776"></a>01776 {
<a name="l01777"></a>01777   <span class="keywordtype">double</span> dt = <a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>-&gt;pas_de_temps();
<a name="l01778"></a>01778   <span class="keywordtype">double</span> dt_convection;
<a name="l01779"></a>01779   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>-&gt;no_conv_subiteration_diffusion_implicite())
<a name="l01780"></a>01780     {
<a name="l01781"></a>01781 <span class="comment">// faux mais permet de ne pas sous iterer sur la convection</span>
<a name="l01782"></a>01782       dt_convection=1e38;
<a name="l01783"></a>01783     }
<a name="l01784"></a>01784   <span class="keywordflow">else</span>
<a name="l01785"></a>01785     dt_convection= <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(1).<a class="code" href="classOperateur.html#a91e87aa1eb109081795c5af2569e5794" title="Calcule le prochain pas de temps.">calculer_pas_de_temps</a>();
<a name="l01786"></a>01786   <span class="keywordflow">if</span>(<a class="code" href="Double_8h.html#ad7e27600604265379936210d7f9dfdd5">inf_strict</a>(dt_convection,dt))
<a name="l01787"></a>01787     {
<a name="l01788"></a>01788 <span class="comment">// Several steps (nstep) are done if the convective time step</span>
<a name="l01789"></a>01789 <span class="comment">// is smaller than the time step (dt) :</span>
<a name="l01790"></a>01790       <span class="keywordtype">double</span> epsilon = 1.e-10;
<a name="l01791"></a>01791       <span class="keywordtype">int</span> nstep = (int)((dt / dt_convection)*(1+epsilon)) + 1 ;
<a name="l01792"></a>01792       <span class="keywordflow">if</span> (( nstep % 2 ) != 0 ) nstep += 1 ;
<a name="l01793"></a>01793       <span class="keywordtype">double</span> dt_loc = dt/double(nstep) ;
<a name="l01794"></a>01794       <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;Convection Semi Implicite: Number of Sub-Cycles : &quot;</span> &lt;&lt; nstep &lt;&lt; <span class="stringliteral">&quot; with dt_loc = &quot;</span> &lt;&lt; dt_loc &lt;&lt; <span class="stringliteral">&quot; dt =&quot;</span> &lt;&lt; dt &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a> ;
<a name="l01795"></a>01795 
<a name="l01796"></a>01796       secmem = 0;
<a name="l01797"></a>01797       <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> solution_loc(solution) ;
<a name="l01798"></a>01798       <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> derivee;
<a name="l01799"></a>01799       derivee.<a class="code" href="classDoubleTab.html#aa4dd124734ab5d6cb7aa93a104c0868e">copy</a>(secmem, <a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ffaf6ae9ba7eb51c5f298ce693345b3ec68">Array_base::NOCOPY_NOINIT</a>);
<a name="l01800"></a>01800       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nstep; i++)
<a name="l01801"></a>01801         {
<a name="l01802"></a>01802           derivee = 0. ;
<a name="l01803"></a>01803           <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(1).<a class="code" href="classOperateur.html#accdf61cf1e33fb42e9eb06f1c501422b">ajouter</a>(solution_loc, derivee); <span class="comment">//!&lt; derivee=conv(solution_loc)</span>
<a name="l01804"></a>01804 <span class="comment"></span>          derivee.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l01805"></a>01805           secmem += derivee ;
<a name="l01806"></a>01806 
<a name="l01807"></a>01807 <span class="comment">// Si ce n&#39;est pas la derniere iteration:</span>
<a name="l01808"></a>01808           <span class="keywordflow">if</span> (i+1 &lt; nstep)
<a name="l01809"></a>01809             {
<a name="l01810"></a>01810               <a class="code" href="classEquation__base.html#aaaf61d60cca8205d2490a023633cc7d4">solveur_masse</a>.<a class="code" href="classSolveur__Masse.html#af7afe8c2d4d5764f7428f2cd4ef43ddb" title="Appel a l&#39;objet sous-jacent. Resoud le systeme lineaire, dont la matrice est la matrice de masse...">appliquer</a>(derivee);
<a name="l01811"></a>01811               solution_loc.<a class="code" href="classDoubleVect.html#a4da8824015866b68783677b1e80f1f9a" title="x+=alpha*y">ajoute</a>(dt_loc, derivee, <a class="code" href="MD__Vector_8h.html#a3616a15fe105ad6150819554ee8b11caab47906d8d2e6c20f8ba32e4acb6edbe0">VECT_REAL_ITEMS</a>);
<a name="l01812"></a>01812               solution_loc.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l01813"></a>01813             }
<a name="l01814"></a>01814         }
<a name="l01815"></a>01815       secmem /= double(nstep) ;
<a name="l01816"></a>01816       <span class="keywordflow">return</span> secmem;
<a name="l01817"></a>01817     }
<a name="l01818"></a>01818   <span class="keywordflow">else</span>
<a name="l01819"></a>01819     {
<a name="l01820"></a>01820       <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(1).<a class="code" href="classOperateur.html#accdf61cf1e33fb42e9eb06f1c501422b">ajouter</a>(solution, secmem); <span class="comment">//!&lt; secmem+=conv(solution)</span>
<a name="l01821"></a>01821 <span class="comment"></span>      <span class="keywordflow">return</span> secmem;
<a name="l01822"></a>01822     }
<a name="l01823"></a>01823 }
<a name="l01824"></a>01824 
<a name="l01825"></a>01825 <span class="comment">//</span>
<a name="l01826"></a>01826 <span class="comment">//</span>
<a name="l01827"></a>01827 <span class="comment">//</span>
<a name="l01828"></a>01828 <span class="comment">//</span>
<a name="l01829"></a>01829 <span class="comment">//</span>
<a name="l01830"></a>01830 <span class="comment">//</span><span class="comment"></span>
<a name="l01831"></a>01831 <span class="comment">//! Solve: (1/dt + M-1*L)*dI = M-1 * secmem&lt;br&gt;with a Conjugate Gradient matrix-free algorithm by default&lt;br&gt;L is the diffusion&lt;br&gt;M is the mass&lt;br&gt;In : solution=I(n)&lt;br&gt;Out: solution=dI/dt</span>
<a name="l01832"></a><a class="code" href="classEquation__base.html#a759a2471f97d1795f58bc93c86ff3562">01832</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#abd67532530f67b3305703a130a5d823a">Equation_base::Gradient_conjugue_diff_impl</a>(<a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a>&amp; secmem, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; solution, <span class="keywordtype">int</span> size_terme_mul, <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; terme_mul)
<a name="l01833"></a>01833 {
<a name="l01834"></a>01834   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>-&gt;impr_diffusion_implicite())
<a name="l01835"></a>01835     <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;Implicited diffusion algorithm applied on &quot;</span> &lt;&lt; <a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; <span class="stringliteral">&quot; equation:&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01836"></a>01836   <span class="keywordtype">int</span> marq_tot = 0;
<a name="l01837"></a>01837   <span class="keywordtype">int</span> size_s = <a class="code" href="classEquation__base.html#a3c8ac50e3e7b6ed29024a43e828a5396" title="Renvoie les termes sources asssocies a l&#39;equation.">sources</a>().<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>();
<a name="l01838"></a>01838   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> marq(size_s);
<a name="l01839"></a>01839   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size_s; i++)
<a name="l01840"></a>01840     {
<a name="l01841"></a>01841       <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classSource__dep__inco__base.html">Source_dep_inco_base</a>, <a class="code" href="classEquation__base.html#a3c8ac50e3e7b6ed29024a43e828a5396" title="Renvoie les termes sources asssocies a l&#39;equation.">sources</a>()(i).<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>()))
<a name="l01842"></a>01842         {
<a name="l01843"></a>01843           marq(i) = 1;
<a name="l01844"></a>01844           marq_tot = 1;
<a name="l01845"></a>01845         }
<a name="l01846"></a>01846     }
<a name="l01847"></a>01847   <span class="keywordtype">bool</span> has_diffusion_implicit_solver = <a class="code" href="classEquation__base.html#ac0711ed998943f25c58ec44b901e17fe">parametre_equation</a>().<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>() &amp;&amp;
<a name="l01848"></a>01848                                        <a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classParametre__diffusion__implicite.html" title="classe Parametre_diffusion_implicite Un objet Parametre_diffusion_implicite est un objet regroupant l...">Parametre_diffusion_implicite</a>, <a class="code" href="classEquation__base.html#ac0711ed998943f25c58ec44b901e17fe">parametre_equation</a>().<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>()) &amp;&amp;
<a name="l01849"></a>01849                                        <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classParametre__diffusion__implicite.html" title="classe Parametre_diffusion_implicite Un objet Parametre_diffusion_implicite est un objet regroupant l...">Parametre_diffusion_implicite</a>, <a class="code" href="classEquation__base.html#ac0711ed998943f25c58ec44b901e17fe">parametre_equation</a>().<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>()).solveur().non_nul();
<a name="l01850"></a>01850   <span class="keywordflow">if</span> (has_diffusion_implicit_solver)
<a name="l01851"></a>01851     {
<a name="l01852"></a>01852 <span class="comment">// PL: Solve (M/dt + L)*dI = Secmem(sans diffusion) with a matrix build to use more solvers</span>
<a name="l01853"></a>01853       <span class="keywordflow">if</span> (marq_tot)
<a name="l01854"></a>01854         {
<a name="l01855"></a>01855           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;solveur_dffusion_implicite can&#39;t be used yet with source terms depending from the unknowns. &quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01856"></a>01856           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l01857"></a>01857         }
<a name="l01858"></a>01858       <span class="keywordflow">if</span> (size_terme_mul)
<a name="l01859"></a>01859         {
<a name="l01860"></a>01860           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;solveur_dffusion_implicite can&#39;t be used yet with penalization. &quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01861"></a>01861           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l01862"></a>01862         }
<a name="l01863"></a>01863       <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> present(solution); <span class="comment">//!&lt; I(n) On multiplie secmem par M (qui etait divise par M avant l&#39;appel...)</span>
<a name="l01864"></a>01864 <span class="comment"></span><span class="comment">//</span>
<a name="l01865"></a>01865       <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> copie(secmem);
<a name="l01866"></a>01866       secmem = 0;
<a name="l01867"></a>01867       <a class="code" href="classEquation__base.html#aaaf61d60cca8205d2490a023633cc7d4">solveur_masse</a>.<a class="code" href="classSolveur__Masse.html#adc554d2f7efe81e71ff8995d4f2df8c7">ajouter_masse</a>(1, secmem, copie);
<a name="l01868"></a>01868 <span class="comment">// Build matrix A:</span>
<a name="l01869"></a>01869       <a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a>&amp; matrice = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classParametre__diffusion__implicite.html" title="classe Parametre_diffusion_implicite Un objet Parametre_diffusion_implicite est un objet regroupant l...">Parametre_diffusion_implicite</a>, <a class="code" href="classEquation__base.html#ac0711ed998943f25c58ec44b901e17fe">parametre_equation</a>().<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>()).matrice();
<a name="l01870"></a>01870       <span class="keywordflow">if</span> (matrice.<a class="code" href="classMatrice__Morse.html#a24a51a119cc5068408773a983ce5f13a" title="Renvoie l&#39;ordre de la matrice: - le nombre de lignes si la matrice est carree - 0 sinon...">ordre</a>()==0) <a class="code" href="classEquation__base.html#abead2a90d8fb40f857e21a80a202b26b">dimensionner_matrice</a>(matrice);
<a name="l01871"></a>01871       matrice.<a class="code" href="classMatrice__Morse.html#a3fe9dc9cd6e414e6781b2dcba28acf1f" title="Remplit la matrice avec des zeros.">clean</a>(); <span class="comment">//!&lt; A=0 Add diffusion matrix L into matrix</span>
<a name="l01872"></a>01872 <span class="comment"></span><span class="comment">//</span>
<a name="l01873"></a>01873       <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(0).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#a903e728aad8e2d490580bf264319d65f" title="NE FAIT RIEN A surcharger dans les classes derivees.">contribuer_a_avec</a>(present, matrice); <span class="comment">//!&lt; A=L</span>
<a name="l01874"></a>01874 <span class="comment"></span>      <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(0).<a class="code" href="classOperateur.html#accdf61cf1e33fb42e9eb06f1c501422b">ajouter</a>(present, secmem);
<a name="l01875"></a>01875       matrice.<a class="code" href="classMatrice__Base.html#a6ccb4d20d3877cf09f5178ff72af5406" title="Operation de multiplication-accumulation (saxpy) matrice vecteur. Operation: r = r + A*x...">ajouter_multvect</a>(present, secmem);
<a name="l01876"></a>01876 <span class="comment">// Add M/dt into matrix</span>
<a name="l01877"></a>01877       <a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#ace73be0f7ccbd6ed6f7096ba277447fe">ajouter_inertie</a>(matrice,secmem,(*<span class="keyword">this</span>)); <span class="comment">//!&lt; A=M/dt+L</span>
<a name="l01878"></a>01878 <span class="comment"></span>      <a class="code" href="classEquation__base.html#ae124e27acae18dbff615e954ef5211d9">modifier_pour_Cl</a>(matrice,secmem);
<a name="l01879"></a>01879 <span class="comment">// Solve to get I(n+1):</span>
<a name="l01880"></a>01880       <a class="code" href="classSolveurSys.html">SolveurSys</a>&amp; solveur = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classParametre__diffusion__implicite.html" title="classe Parametre_diffusion_implicite Un objet Parametre_diffusion_implicite est un objet regroupant l...">Parametre_diffusion_implicite</a>, <a class="code" href="classEquation__base.html#ac0711ed998943f25c58ec44b901e17fe">parametre_equation</a>().<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>()).solveur();
<a name="l01881"></a>01881       solveur-&gt;reinit(); <span class="comment">//!&lt; New matrix but same sparsity</span>
<a name="l01882"></a>01882 <span class="comment"></span>      <span class="keywordtype">int</span> niter = solveur.<a class="code" href="classSolveurSys.html#a62ca198f0c5dc599e53b0535761e5138">resoudre_systeme</a>(matrice, secmem, solution);
<a name="l01883"></a>01883       <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;Diffusion operator implicited for the equation &quot;</span> &lt;&lt; <a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>()
<a name="l01884"></a>01884            &lt;&lt; <span class="stringliteral">&quot; : Conjugate gradient converged in &quot;</span> &lt;&lt; niter &lt;&lt; <span class="stringliteral">&quot; iterations.&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01885"></a>01885 <span class="comment">// CHD 230501 : Call to diffusive operator to update flux_bords (boundary fluxes):</span>
<a name="l01886"></a>01886       <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(0).<a class="code" href="classOperateur.html#accdf61cf1e33fb42e9eb06f1c501422b">ajouter</a>(<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>(), secmem);
<a name="l01887"></a>01887 
<a name="l01888"></a>01888       solution-=present; <span class="comment">//!&lt; dI=I(n+1)-I(n)</span>
<a name="l01889"></a>01889 <span class="comment"></span>      solution/=<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a0e4f67ef6086c09434ddc161668077b2" title="Renvoie le pas de temps (delta_t) courant.">pas_de_temps</a>(); <span class="comment">//!&lt; dI/dt</span>
<a name="l01890"></a>01890 <span class="comment"></span>    }
<a name="l01891"></a>01891   <span class="keywordflow">else</span>
<a name="l01892"></a>01892     {
<a name="l01893"></a>01893       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#affcd058809786918ed173aaf681d0843">begin_count</a>(diffusion_implicite_counter_);
<a name="l01894"></a>01894 <span class="comment">// on retire les sources dependantes de l inco ; on les rajoutera apres</span>
<a name="l01895"></a>01895       <span class="keywordflow">if</span> (marq_tot)
<a name="l01896"></a>01896         {
<a name="l01897"></a>01897           <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> toto(secmem);
<a name="l01898"></a>01898           <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a0faf52d1b518f5b0b2177f22efcc222d" title="Arret du compteur counter_id. On ajoute quantity a la somme des &#39;quantity&#39; (par defaut 0) stockees po...">end_count</a>(diffusion_implicite_counter_);
<a name="l01899"></a>01899           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size_s; i++)
<a name="l01900"></a>01900             <span class="keywordflow">if</span> (marq(i))
<a name="l01901"></a>01901               <a class="code" href="classEquation__base.html#a3c8ac50e3e7b6ed29024a43e828a5396" title="Renvoie les termes sources asssocies a l&#39;equation.">sources</a>()(i).<a class="code" href="Faces2_8cpp.html#a5763a31981073cc0c97bf903b1f120d9" title="Fonction hors classe.">ajouter</a>(toto);
<a name="l01902"></a>01902           <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#affcd058809786918ed173aaf681d0843">begin_count</a>(diffusion_implicite_counter_);
<a name="l01903"></a>01903           <a class="code" href="classEquation__base.html#adfedf474c07a92f6b2261ca2f1cee80e" title="Renvoie le solveur de masse associe a l&#39;equation.">solv_masse</a>().<a class="code" href="classSolveur__Masse.html#af7afe8c2d4d5764f7428f2cd4ef43ddb" title="Appel a l&#39;objet sous-jacent. Resoud le systeme lineaire, dont la matrice est la matrice de masse...">appliquer</a>(toto);
<a name="l01904"></a>01904           secmem.<a class="code" href="classDoubleVect.html#a4da8824015866b68783677b1e80f1f9a" title="x+=alpha*y">ajoute</a>(-1., toto); <span class="comment">//!&lt; ,VECT_REAL_ITEMS);</span>
<a name="l01905"></a>01905 <span class="comment"></span>        }
<a name="l01906"></a>01906       <span class="keywordtype">int</span> n = secmem.<a class="code" href="classDoubleVect.html#ad2d21b364e1c6559771970596a25c006" title="Identique a size_array()">size_totale</a>();
<a name="l01907"></a>01907       <span class="keywordflow">if</span> (solution.<a class="code" href="classDoubleVect.html#ad2d21b364e1c6559771970596a25c006" title="Identique a size_array()">size_totale</a>() != n)
<a name="l01908"></a>01908         {
<a name="l01909"></a>01909           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;the size of the solution and the second member does not match&quot;</span>;
<a name="l01910"></a>01910           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l01911"></a>01911         }
<a name="l01912"></a>01912 
<a name="l01913"></a>01913 <span class="comment">// Le nombre maximal d&#39;iteration peut etre desormais borne par niter_max_diff_impl</span>
<a name="l01914"></a>01914       <span class="keywordtype">int</span> nmax = <a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>-&gt;niter_max_diffusion_implicite();
<a name="l01915"></a>01915 
<a name="l01916"></a>01916       <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> p(solution);
<a name="l01917"></a>01917       p = 0;
<a name="l01918"></a>01918       <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> phiB(p); <span class="comment">//!&lt; la partie Bord de l&#39;operateur.</span>
<a name="l01919"></a>01919 <span class="comment"></span>      <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> resu(p);
<a name="l01920"></a>01920       <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> merk(solution);
<a name="l01921"></a>01921       <span class="keywordtype">double</span> aCKN = 1; <span class="comment">//!&lt; Crank - Nicholson -&gt; 0.5</span>
<a name="l01922"></a>01922 <span class="comment"></span>
<a name="l01923"></a>01923 <span class="comment">// Calcul de la matrice Diagonale</span>
<a name="l01924"></a>01924 
<a name="l01925"></a>01925       <span class="keywordtype">int</span> precond_diag = 0;
<a name="l01926"></a>01926 <span class="comment">// On preconditionne par la diagonale si on penalise</span>
<a name="l01927"></a>01927 <span class="comment">// car sinon residu initial trop grand</span>
<a name="l01928"></a>01928       <span class="keywordflow">if</span> (size_terme_mul) precond_diag = 1;
<a name="l01929"></a>01929 
<a name="l01930"></a>01930       <span class="keywordtype">double</span> seuil_diffusion_implicite = <a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>-&gt;seuil_diffusion_implicite();
<a name="l01931"></a>01931 <span class="comment">// Recuperation eventuelle d&#39;options de Parametre_diffusion_implicite</span>
<a name="l01932"></a>01932       <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#ac0711ed998943f25c58ec44b901e17fe">parametre_equation</a>().non_nul() &amp;&amp; (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classParametre__diffusion__implicite.html" title="classe Parametre_diffusion_implicite Un objet Parametre_diffusion_implicite est un objet regroupant l...">Parametre_diffusion_implicite</a>, <a class="code" href="classEquation__base.html#ac0711ed998943f25c58ec44b901e17fe">parametre_equation</a>().<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>())))
<a name="l01933"></a>01933         {
<a name="l01934"></a>01934           <span class="keyword">const</span> <a class="code" href="classParametre__diffusion__implicite.html" title="classe Parametre_diffusion_implicite Un objet Parametre_diffusion_implicite est un objet regroupant l...">Parametre_diffusion_implicite</a>&amp; param = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classParametre__diffusion__implicite.html" title="classe Parametre_diffusion_implicite Un objet Parametre_diffusion_implicite est un objet regroupant l...">Parametre_diffusion_implicite</a>,
<a name="l01935"></a>01935                                                                 <a class="code" href="classEquation__base.html#ac0711ed998943f25c58ec44b901e17fe">parametre_equation</a>().<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>());
<a name="l01936"></a>01936           <span class="keywordflow">if</span> (param.<a class="code" href="classParametre__diffusion__implicite.html#aee2783d5433e2cbc88d09d8503a802ac">crank</a>())
<a name="l01937"></a>01937             aCKN = 0.5;
<a name="l01938"></a>01938           precond_diag = param.<a class="code" href="classParametre__diffusion__implicite.html#a4bc56e4140618b5443c6df818ee2c04c">precoditionnement_diag</a>();
<a name="l01939"></a>01939 <span class="comment">// Bug fixed : Diagonal preconditionning is fixed with periodic BC (it is OK for a parallel calculation)</span>
<a name="l01940"></a>01940 <span class="comment">// if (precond_diag==1 &amp;&amp; Process::nproc()&gt;1)</span>
<a name="l01941"></a>01941 <span class="comment">// {</span>
<a name="l01942"></a>01942 <span class="comment">// Cerr &lt;&lt; &quot;Error with the value of preconditionnement_diag option which is set to &quot; &lt;&lt; precond_diag &lt;&lt; &quot;.&quot; &lt;&lt; finl;</span>
<a name="l01943"></a>01943 <span class="comment">// Cerr &lt;&lt; &quot;The diagonal preconditionning is unavailable for a parallel calculation.&quot; &lt;&lt; finl;</span>
<a name="l01944"></a>01944 <span class="comment">// Cerr &lt;&lt; &quot;The CG used to solve the implicitation of the equation diffusion operator can not preconditioned.&quot; &lt;&lt; finl;</span>
<a name="l01945"></a>01945 <span class="comment">// Cerr &lt;&lt; &quot;So edit your .data file with preconditionnement_diag = 0 and run your case.&quot; &lt;&lt; finl;</span>
<a name="l01946"></a>01946 <span class="comment">// exit();</span>
<a name="l01947"></a>01947 <span class="comment">// }</span>
<a name="l01948"></a>01948           <span class="keywordflow">if</span> (param.<a class="code" href="classParametre__diffusion__implicite.html#a5be34a5066261bd02d714ed5ddbd11f4">seuil_diffusion_implicite</a>() &gt; 0)
<a name="l01949"></a>01949             seuil_diffusion_implicite = param.<a class="code" href="classParametre__diffusion__implicite.html#a5be34a5066261bd02d714ed5ddbd11f4">seuil_diffusion_implicite</a>();
<a name="l01950"></a>01950           <span class="keywordflow">if</span> (param.<a class="code" href="classParametre__diffusion__implicite.html#a09775b7319894fa0993bfa1cb9eb2097">nb_it_max</a>() &gt; 0)
<a name="l01951"></a>01951             nmax = param.<a class="code" href="classParametre__diffusion__implicite.html#a09775b7319894fa0993bfa1cb9eb2097">nb_it_max</a>();
<a name="l01952"></a>01952         }
<a name="l01953"></a>01953 
<a name="l01954"></a>01954 <span class="comment">//</span>
<a name="l01955"></a>01955 <span class="comment">// Preconditionnement</span>
<a name="l01956"></a>01956 <span class="comment">//</span>
<a name="l01957"></a>01957       <span class="keywordtype">double</span> dt = <a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>-&gt;pas_de_temps();
<a name="l01958"></a>01958       <a class="code" href="classMatrice__Morse__Diag.html" title="Classe Matrice_Morse_Diag Represente une matrice M (creuse) symetrique stockee au format Morse Diaget...">Matrice_Morse_Diag</a> diag;
<a name="l01959"></a>01959       <span class="keywordflow">if</span> (precond_diag)
<a name="l01960"></a>01960         {
<a name="l01961"></a>01961           <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#affcd058809786918ed173aaf681d0843">begin_count</a>(assemblage_sys_counter_);
<a name="l01962"></a>01962           <span class="keyword">const</span> <span class="keywordtype">int</span> nb_case = <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>().<a class="code" href="classDoubleTab.html#a3eadd63f3ba20c1b454d760b430acbf7" title="Returns the total dimensions of the multi-dimensionnal array, including virtual items (used in parall...">dimension_tot</a>(0);
<a name="l01963"></a>01963           <span class="keyword">const</span> <span class="keywordtype">int</span> nb_comp = <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>().<a class="code" href="classDoubleVect.html#ab02d01cd1bdab66fbd66f9a47cc29e10">line_size</a>();
<a name="l01964"></a>01964           <span class="keywordflow">if</span> (nb_comp * nb_case != n)
<a name="l01965"></a>01965             {
<a name="l01966"></a>01966               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;the size of the unknown and the second member does not match&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l01967"></a>01967               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;dimension_tot nbdim1 nb_comp = &quot;</span> &lt;&lt; nb_case &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; nb_comp &lt;&lt; finl;
<a name="l01968"></a>01968               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;size_totale = &quot;</span> &lt;&lt; n &lt;&lt; finl;
<a name="l01969"></a>01969               <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l01970"></a>01970             }
<a name="l01971"></a>01971           diag.<a class="code" href="classMatrice__Morse__Diag.html#ad5d465657135d1aba5d2aea19f3f76a8">dimensionne_diag</a>(n);
<a name="l01972"></a>01972           <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(0).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#a903e728aad8e2d490580bf264319d65f" title="NE FAIT RIEN A surcharger dans les classes derivees.">contribuer_a_avec</a>(<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().valeurs(), diag);
<a name="l01973"></a>01973           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size_s; i++)
<a name="l01974"></a>01974             <span class="keywordflow">if</span> (marq(i))
<a name="l01975"></a>01975               <a class="code" href="classEquation__base.html#a3c8ac50e3e7b6ed29024a43e828a5396" title="Renvoie les termes sources asssocies a l&#39;equation.">sources</a>()(i).<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>().contribuer_a_avec(<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().valeurs(), diag);
<a name="l01976"></a>01976 <span class="comment">// La diagonale est proportionnelle au volume de controle....</span>
<a name="l01977"></a>01977 <span class="comment">// Il faut appliquer le solveur_masse</span>
<a name="l01978"></a>01978           <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> tempo(<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().valeurs());
<a name="l01979"></a>01979           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ca = 0; ca &lt; nb_case; ca++)
<a name="l01980"></a>01980             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ncp = 0; ncp &lt; nb_comp; ncp++)
<a name="l01981"></a>01981               tempo(ca, ncp) = diag(ca * nb_comp + ncp, ca * nb_comp + ncp);
<a name="l01982"></a>01982           <a class="code" href="classEquation__base.html#aaaf61d60cca8205d2490a023633cc7d4">solveur_masse</a>.<a class="code" href="classSolveur__Masse.html#af7afe8c2d4d5764f7428f2cd4ef43ddb" title="Appel a l&#39;objet sous-jacent. Resoud le systeme lineaire, dont la matrice est la matrice de masse...">appliquer</a>(tempo);
<a name="l01983"></a>01983           tempo.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l01984"></a>01984 <span class="comment">// On inverse... // Crank - Nicholson</span>
<a name="l01985"></a>01985 <span class="comment">// La matrice correspond a - la jacobienne (pour avoir un plus justement, GF)</span>
<a name="l01986"></a>01986           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ca = 0; ca &lt; nb_case; ca++)
<a name="l01987"></a>01987             {
<a name="l01988"></a>01988               <span class="keywordtype">double</span> tmp = (size_terme_mul ? terme_mul(ca) : 1) / dt;
<a name="l01989"></a>01989               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ncpa = 0; ncpa &lt; nb_comp; ncpa++)
<a name="l01990"></a>01990                 diag(ca * nb_comp + ncpa, ca * nb_comp + ncpa) = 1. / (tmp + tempo(ca, ncpa) * aCKN);
<a name="l01991"></a>01991             }
<a name="l01992"></a>01992           <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a0faf52d1b518f5b0b2177f22efcc222d" title="Arret du compteur counter_id. On ajoute quantity a la somme des &#39;quantity&#39; (par defaut 0) stockees po...">end_count</a>(assemblage_sys_counter_);
<a name="l01993"></a>01993         }
<a name="l01994"></a>01994 <span class="comment">// On utilise p pour calculer phiB :</span>
<a name="l01995"></a>01995       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a0faf52d1b518f5b0b2177f22efcc222d" title="Arret du compteur counter_id. On ajoute quantity a la somme des &#39;quantity&#39; (par defaut 0) stockees po...">end_count</a>(diffusion_implicite_counter_);
<a name="l01996"></a>01996       <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(0).<a class="code" href="classOperateur.html#accdf61cf1e33fb42e9eb06f1c501422b">ajouter</a>(p, phiB);
<a name="l01997"></a>01997       <span class="keywordflow">if</span> (marq_tot)
<a name="l01998"></a>01998         {
<a name="l01999"></a>01999           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size_s; i++)
<a name="l02000"></a>02000             <span class="keywordflow">if</span> (marq(i))
<a name="l02001"></a>02001               <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classSource__dep__inco__base.html">Source_dep_inco_base</a>, <a class="code" href="classEquation__base.html#a3c8ac50e3e7b6ed29024a43e828a5396" title="Renvoie les termes sources asssocies a l&#39;equation.">sources</a>()(i).<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>()).ajouter_(p, phiB);
<a name="l02002"></a>02002         }
<a name="l02003"></a>02003       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#affcd058809786918ed173aaf681d0843">begin_count</a>(diffusion_implicite_counter_);
<a name="l02004"></a>02004       <a class="code" href="classEquation__base.html#aaaf61d60cca8205d2490a023633cc7d4">solveur_masse</a>.<a class="code" href="classSolveur__Masse.html#af7afe8c2d4d5764f7428f2cd4ef43ddb" title="Appel a l&#39;objet sous-jacent. Resoud le systeme lineaire, dont la matrice est la matrice de masse...">appliquer</a>(phiB);
<a name="l02005"></a>02005 <span class="comment">// phiB *= aCKN;  // Crank - Nicholson</span>
<a name="l02006"></a>02006 <span class="comment">// fait maintenant avant l&#39;appel</span>
<a name="l02007"></a>02007 <span class="comment">// solveur_masse.appliquer(secmem);</span>
<a name="l02008"></a>02008 
<a name="l02009"></a>02009       <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> sol;
<a name="l02010"></a>02010       <span class="keywordflow">if</span> (size_terme_mul)
<a name="l02011"></a>02011         {
<a name="l02012"></a>02012           sol = solution;
<a name="l02013"></a>02013           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size_terme_mul; i++)
<a name="l02014"></a>02014             sol(i) *= terme_mul(i);
<a name="l02015"></a>02015         }
<a name="l02016"></a>02016       <span class="keywordflow">else</span>
<a name="l02017"></a>02017         sol.<a class="code" href="classDoubleTab.html#afc7cddeeec2c80636e54eaf330ac41ad" title="fait pointer le tableau sur le vecteur v et en associant la meme structure parallele. Attention, si line_size du vecteur v est different de 1, on cree un tableau bidimensionnel (on peut avoir un vecteur de ce type si on copie un Tab dans un Vect puis on prend une ref sur ce Vect).">ref</a>(solution);
<a name="l02018"></a>02018 
<a name="l02019"></a>02019       secmem.<a class="code" href="classDoubleVect.html#a4da8824015866b68783677b1e80f1f9a" title="x+=alpha*y">ajoute</a>(1. / dt, sol, <a class="code" href="MD__Vector_8h.html#a3616a15fe105ad6150819554ee8b11caab47906d8d2e6c20f8ba32e4acb6edbe0">VECT_REAL_ITEMS</a>);
<a name="l02020"></a>02020 
<a name="l02021"></a>02021 <span class="comment">// Stop the counter because operator diffusion is also counted</span>
<a name="l02022"></a>02022       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a0faf52d1b518f5b0b2177f22efcc222d" title="Arret du compteur counter_id. On ajoute quantity a la somme des &#39;quantity&#39; (par defaut 0) stockees po...">end_count</a>(diffusion_implicite_counter_, 0, 0);
<a name="l02023"></a>02023       <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(0).<a class="code" href="classOperateur.html#accdf61cf1e33fb42e9eb06f1c501422b">ajouter</a>(solution, resu);
<a name="l02024"></a>02024       <span class="keywordflow">if</span> (marq_tot)
<a name="l02025"></a>02025         {
<a name="l02026"></a>02026           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size_s; i++)
<a name="l02027"></a>02027             <span class="keywordflow">if</span> (marq(i))
<a name="l02028"></a>02028               <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classSource__dep__inco__base.html">Source_dep_inco_base</a>, <a class="code" href="classEquation__base.html#a3c8ac50e3e7b6ed29024a43e828a5396" title="Renvoie les termes sources asssocies a l&#39;equation.">sources</a>()(i).<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>()).ajouter_(solution, resu);
<a name="l02029"></a>02029         }
<a name="l02030"></a>02030       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#affcd058809786918ed173aaf681d0843">begin_count</a>(diffusion_implicite_counter_);
<a name="l02031"></a>02031       <a class="code" href="classEquation__base.html#aaaf61d60cca8205d2490a023633cc7d4">solveur_masse</a>.<a class="code" href="classSolveur__Masse.html#af7afe8c2d4d5764f7428f2cd4ef43ddb" title="Appel a l&#39;objet sous-jacent. Resoud le systeme lineaire, dont la matrice est la matrice de masse...">appliquer</a>(resu);
<a name="l02032"></a>02032       resu.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l02033"></a>02033       resu *= -1.;
<a name="l02034"></a>02034       resu.<a class="code" href="classDoubleVect.html#a4da8824015866b68783677b1e80f1f9a" title="x+=alpha*y">ajoute</a>(1. / dt, sol, <a class="code" href="MD__Vector_8h.html#a3616a15fe105ad6150819554ee8b11caab47906d8d2e6c20f8ba32e4acb6edbe0">VECT_REAL_ITEMS</a>);
<a name="l02035"></a>02035 
<a name="l02036"></a>02036       <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> residu(resu); <span class="comment">//!&lt; residu = Ax</span>
<a name="l02037"></a>02037 <span class="comment"></span>      residu -= secmem;      <span class="comment">//!&lt; residu = Ax-B</span>
<a name="l02038"></a>02038 <span class="comment"></span>      <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> z;
<a name="l02039"></a>02039       <span class="keywordflow">if</span> (precond_diag)
<a name="l02040"></a>02040         {
<a name="l02041"></a>02041           z = residu;
<a name="l02042"></a>02042           diag.<a class="code" href="classMatrice__Base.html#a05caa487a25a6d5e7fbd38d4b2f4ee1e" title="Multiplication d&#39;un vecteur par la matrice. Operation: r = A*x.">multvect</a>(residu, z); <span class="comment">//!&lt; z = D-1(Ax-B)</span>
<a name="l02043"></a>02043 <span class="comment"></span>        }
<a name="l02044"></a>02044       <span class="keywordflow">else</span>
<a name="l02045"></a>02045         z.<a class="code" href="classDoubleTab.html#afc7cddeeec2c80636e54eaf330ac41ad" title="fait pointer le tableau sur le vecteur v et en associant la meme structure parallele. Attention, si line_size du vecteur v est different de 1, on cree un tableau bidimensionnel (on peut avoir un vecteur de ce type si on copie un Tab dans un Vect puis on prend une ref sur ce Vect).">ref</a>(residu); <span class="comment">//!&lt; z = Ax-B</span>
<a name="l02046"></a>02046 <span class="comment"></span>      p -= z;
<a name="l02047"></a>02047 
<a name="l02048"></a>02048       <span class="comment">/* Calcul different de initial_residual:</span>
<a name="l02049"></a>02049 <span class="comment">         DoubleTab tmp(secmem);</span>
<a name="l02050"></a>02050 <span class="comment">         if (precond_diag)</span>
<a name="l02051"></a>02051 <span class="comment">         diag.multvect(secmem, tmp);</span>
<a name="l02052"></a>02052 <span class="comment">         else</span>
<a name="l02053"></a>02053 <span class="comment">         tmp.ref(secmem);</span>
<a name="l02054"></a>02054 <span class="comment">      double initial_residual = mp_carre_norme_vect(z); //!&lt; =||Ax(0)-B|| ou ||D-1.(Ax(0)-B)||</span>
<a name="l02055"></a>02055 <span class="comment">         double initial_residual = mp_carre_norme_vect(tmp) ; //!&lt; =||B|| ou ||D-1.B|| */</span>
<a name="l02056"></a>02056 
<a name="l02057"></a>02057       <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>-&gt;impr_diffusion_implicite()) <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;Residu(0)=&quot;</span> &lt;&lt; initial_residual &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l02058"></a>02058       <span class="keywordtype">double</span> seuil = seuil_diffusion_implicite * seuil_diffusion_implicite;
<a name="l02059"></a>02059 <span class="comment">// On calcule un seuil relatif (PL: 18/07/12, j&#39;ai l&#39;impression qu&#39;il y&#39;a une erreur, c&#39;est seuil*=initial_residual;</span>
<a name="l02060"></a>02060 <span class="comment">// En outre, il serait bon de faire residual = sqrt(mp_carre_norme_vect(tmp)) a plusieurs endroits...</span>
<a name="l02061"></a>02061       <span class="keywordflow">if</span> (initial_residual &gt; seuil)
<a name="l02062"></a>02062         seuil = seuil_diffusion_implicite * initial_residual;
<a name="l02063"></a>02063 
<a name="l02064"></a>02064       <span class="keywordtype">double</span> residual = seuil; <span class="comment">//!&lt; Il est mieux d&#39;utiliser cette valeur pour entrer dans la boucle car seuil peut etre tres grand si le calcul diverge avant</span>
<a name="l02065"></a>02065 <span class="comment"></span>      <span class="keywordtype">double</span> prodrz_old = <a class="code" href="DoubleVect_8cpp.html#a07d13cbdadca6b60d5e128653f52a4bb">mp_prodscal</a>(residu, z);
<a name="l02066"></a>02066       <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> pp(p);
<a name="l02067"></a>02067       <span class="keywordtype">int</span> niter = 0;
<a name="l02068"></a>02068       <span class="keywordflow">if</span> (initial_residual != 0)
<a name="l02069"></a>02069         <span class="keywordflow">while</span> ((residual &gt;= seuil) &amp;&amp; (niter++ &lt;= nmax))
<a name="l02070"></a>02070           {
<a name="l02071"></a>02071             resu = 0.;
<a name="l02072"></a>02072 
<a name="l02073"></a>02073             p.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l02074"></a>02074 
<a name="l02075"></a>02075 <span class="comment">// Stop the counter during diffusive operator:</span>
<a name="l02076"></a>02076             <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a0faf52d1b518f5b0b2177f22efcc222d" title="Arret du compteur counter_id. On ajoute quantity a la somme des &#39;quantity&#39; (par defaut 0) stockees po...">end_count</a>(diffusion_implicite_counter_, 0, 0);
<a name="l02077"></a>02077             <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(0).<a class="code" href="classOperateur.html#accdf61cf1e33fb42e9eb06f1c501422b">ajouter</a>(p, resu);
<a name="l02078"></a>02078 
<a name="l02079"></a>02079             <span class="keywordflow">if</span> (marq_tot)
<a name="l02080"></a>02080               {
<a name="l02081"></a>02081                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size_s; i++)
<a name="l02082"></a>02082                   <span class="keywordflow">if</span> (marq(i))
<a name="l02083"></a>02083                     <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classSource__dep__inco__base.html">Source_dep_inco_base</a>, <a class="code" href="classEquation__base.html#a3c8ac50e3e7b6ed29024a43e828a5396" title="Renvoie les termes sources asssocies a l&#39;equation.">sources</a>()(i).<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>()).ajouter_(p, resu);
<a name="l02084"></a>02084               }
<a name="l02085"></a>02085             <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#affcd058809786918ed173aaf681d0843">begin_count</a>(diffusion_implicite_counter_);
<a name="l02086"></a>02086             <a class="code" href="classEquation__base.html#aaaf61d60cca8205d2490a023633cc7d4">solveur_masse</a>.<a class="code" href="classSolveur__Masse.html#af7afe8c2d4d5764f7428f2cd4ef43ddb" title="Appel a l&#39;objet sous-jacent. Resoud le systeme lineaire, dont la matrice est la matrice de masse...">appliquer</a>(resu);
<a name="l02087"></a>02087 <span class="comment">// resu *= aCKN ;  // Crank - Nicholson</span>
<a name="l02088"></a>02088             resu.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l02089"></a>02089 
<a name="l02090"></a>02090             resu -= phiB;<span class="comment">//!&lt; On retire la contribution des bords.</span>
<a name="l02091"></a>02091 <span class="comment"></span>            resu *= -aCKN;
<a name="l02092"></a>02092             <span class="keywordflow">if</span> (size_terme_mul)
<a name="l02093"></a>02093               {
<a name="l02094"></a>02094                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size_terme_mul; i++)
<a name="l02095"></a>02095                   pp(i) = p(i) * terme_mul(i);
<a name="l02096"></a>02096                 resu.<a class="code" href="classDoubleVect.html#a4da8824015866b68783677b1e80f1f9a" title="x+=alpha*y">ajoute</a>(1. / dt, pp, <a class="code" href="MD__Vector_8h.html#a3616a15fe105ad6150819554ee8b11caab47906d8d2e6c20f8ba32e4acb6edbe0">VECT_REAL_ITEMS</a>);
<a name="l02097"></a>02097               }
<a name="l02098"></a>02098             <span class="keywordflow">else</span>
<a name="l02099"></a>02099               resu.<a class="code" href="classDoubleVect.html#a4da8824015866b68783677b1e80f1f9a" title="x+=alpha*y">ajoute</a>(1. / dt, p, <a class="code" href="MD__Vector_8h.html#a3616a15fe105ad6150819554ee8b11caab47906d8d2e6c20f8ba32e4acb6edbe0">VECT_REAL_ITEMS</a>);
<a name="l02100"></a>02100             <span class="keywordtype">double</span> alfa = prodrz_old / <a class="code" href="DoubleVect_8cpp.html#a07d13cbdadca6b60d5e128653f52a4bb">mp_prodscal</a>(resu, p);
<a name="l02101"></a>02101 <span class="comment">// Inutile de faire un echange espace virtuel:</span>
<a name="l02102"></a>02102             solution.<a class="code" href="classDoubleVect.html#a4da8824015866b68783677b1e80f1f9a" title="x+=alpha*y">ajoute</a>(alfa, p, <a class="code" href="MD__Vector_8h.html#a3616a15fe105ad6150819554ee8b11caab47906d8d2e6c20f8ba32e4acb6edbe0">VECT_REAL_ITEMS</a>);
<a name="l02103"></a>02103             residu.<a class="code" href="classDoubleVect.html#a4da8824015866b68783677b1e80f1f9a" title="x+=alpha*y">ajoute</a>(alfa, resu, <a class="code" href="MD__Vector_8h.html#a3616a15fe105ad6150819554ee8b11caab47906d8d2e6c20f8ba32e4acb6edbe0">VECT_REAL_ITEMS</a>);
<a name="l02104"></a>02104 
<a name="l02105"></a>02105             <span class="keywordflow">if</span> (precond_diag)
<a name="l02106"></a>02106               diag.<a class="code" href="classMatrice__Base.html#a05caa487a25a6d5e7fbd38d4b2f4ee1e" title="Multiplication d&#39;un vecteur par la matrice. Operation: r = A*x.">multvect</a>(residu, z); <span class="comment">//!&lt; preconditionnement par diag^(-1) sinon z=residu</span>
<a name="l02107"></a>02107 <span class="comment"></span><span class="comment">//</span>
<a name="l02108"></a>02108 
<a name="l02109"></a>02109             residual = <a class="code" href="DoubleVect_8cpp.html#aab5110c88e5f7519eb6b7e603130b702">mp_carre_norme_vect</a>(z);
<a name="l02110"></a>02110             <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>-&gt;impr_diffusion_implicite())
<a name="l02111"></a>02111               <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;Iteration n=&quot;</span> &lt;&lt; niter &lt;&lt; <span class="stringliteral">&quot; Residu(n)/Residu(0)=&quot;</span> &lt;&lt; residual / initial_residual &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l02112"></a>02112 
<a name="l02113"></a>02113             <span class="keywordtype">double</span> prodrz_new = <a class="code" href="DoubleVect_8cpp.html#a07d13cbdadca6b60d5e128653f52a4bb">mp_prodscal</a>(residu, z);
<a name="l02114"></a>02114             p *= (prodrz_new / prodrz_old);
<a name="l02115"></a>02115             p -= z;
<a name="l02116"></a>02116             prodrz_old = prodrz_new;
<a name="l02117"></a>02117 <span class="comment">// On previent si convergence anormalement longue sur de tres gros cas</span>
<a name="l02118"></a>02118             <span class="keywordflow">if</span> (niter == 100)
<a name="l02119"></a>02119               {
<a name="l02120"></a>02120                 <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a>
<a name="l02121"></a>02121                     &lt;&lt; <span class="stringliteral">&quot;Already 100 iterations of the conjugate gradient solver used for diffusion implicited algorithm.&quot;</span>
<a name="l02122"></a>02122                     &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l02123"></a>02123                 <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a>
<a name="l02124"></a>02124                     &lt;&lt; <span class="stringliteral">&quot;The calculation is diverging, may be because of incorrect initial and/or boundary conditions for the equation &quot;</span>
<a name="l02125"></a>02125                     &lt;&lt; <a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; finl;
<a name="l02126"></a>02126                 <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a>
<a name="l02127"></a>02127                     &lt;&lt; <span class="stringliteral">&quot;You may also try to stop the calculation and rerun it with a lower facsec, say 0.9 or may be less: 0.5.&quot;</span>
<a name="l02128"></a>02128                     &lt;&lt; finl;
<a name="l02129"></a>02129               }
<a name="l02130"></a>02130           }
<a name="l02131"></a>02131       <span class="keywordflow">if</span> ((<a class="code" href="classEquation__base.html#a7284f978da77834a1978eb89d2cb238c">le_schema_en_temps</a>-&gt;no_error_if_not_converged_diffusion_implicite() == 0) &amp;&amp; (niter &gt; nmax))
<a name="l02132"></a>02132         {
<a name="l02133"></a>02133           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;No convergence of the implicited diffusion algorithm for the equation &quot;</span> &lt;&lt; <a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; <span class="stringliteral">&quot; in &quot;</span>
<a name="l02134"></a>02134                &lt;&lt; nmax &lt;&lt; <span class="stringliteral">&quot; iterations.&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l02135"></a>02135           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Residue : &quot;</span> &lt;&lt; residual &lt;&lt; <span class="stringliteral">&quot; Threshold : &quot;</span> &lt;&lt; seuil &lt;&lt; finl;
<a name="l02136"></a>02136           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;The problem &quot;</span> &lt;&lt; <a class="code" href="classEquation__base.html#aa8151a96f63719523bf50ddd832e0f8f" title="Renvoie le probleme associe a l&#39;equation.">probleme</a>().<a class="code" href="classProbleme__base.html#a58bc0b101f3f3f1d8522a9f41f1fad7b" title="surcharge Objet_U::le_nom() Renvoie le nom du probleme">le_nom</a>() &lt;&lt; <span class="stringliteral">&quot; has been saved.&quot;</span> &lt;&lt; finl;
<a name="l02137"></a>02137           <a class="code" href="classEquation__base.html#aa8151a96f63719523bf50ddd832e0f8f" title="Renvoie le probleme associe a l&#39;equation.">probleme</a>().<a class="code" href="classProbleme__base.html#aaea4bf58bdcc7a5bdd931da739a090ea" title="Ecriture sur fichier en vue d&#39;une reprise (sauvegarde)">sauver</a>();
<a name="l02138"></a>02138           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;The problem is post processed to help you to see where the non convergence is located.&quot;</span> &lt;&lt; finl;
<a name="l02139"></a>02139           <a class="code" href="classEquation__base.html#aa8151a96f63719523bf50ddd832e0f8f" title="Renvoie le probleme associe a l&#39;equation.">probleme</a>().<a class="code" href="classProbleme__base.html#a92b16c8d3d7d0209476e77700afb0aad" title="Si force=1, effectue le postraitement sans tenir compte des frequences de postraitement. Le postraitement est mis a jour et les traitements eventuels sur les sondes, champs et statistiques sont effectues. Si force=0, tient compte des frequences d&#39;impression demandees.">postraiter</a>(1);
<a name="l02140"></a>02140           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l02141"></a>02141         }
<a name="l02142"></a>02142       <span class="keywordflow">else</span>
<a name="l02143"></a>02143         <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;Diffusion operator implicited for the equation &quot;</span> &lt;&lt; <a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>()
<a name="l02144"></a>02144              &lt;&lt; <span class="stringliteral">&quot; : Conjugate gradient converged in &quot;</span> &lt;&lt; niter &lt;&lt; <span class="stringliteral">&quot; iterations.&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l02145"></a>02145       solution -= merk;
<a name="l02146"></a>02146       solution.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l02147"></a>02147 
<a name="l02148"></a>02148 <span class="comment">// End the counter</span>
<a name="l02149"></a>02149       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a0faf52d1b518f5b0b2177f22efcc222d" title="Arret du compteur counter_id. On ajoute quantity a la somme des &#39;quantity&#39; (par defaut 0) stockees po...">end_count</a>(diffusion_implicite_counter_);
<a name="l02150"></a>02150 
<a name="l02151"></a>02151 <span class="comment">// CHD 230501 : Call to diffusive operator to update flux_bords (boundary fluxes):</span>
<a name="l02152"></a>02152       resu = 0.;
<a name="l02153"></a>02153       <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(0).<a class="code" href="classOperateur.html#accdf61cf1e33fb42e9eb06f1c501422b">ajouter</a>(<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>(), resu);
<a name="l02154"></a>02154       <span class="keywordflow">if</span> (marq_tot)
<a name="l02155"></a>02155         {
<a name="l02156"></a>02156           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size_s; i++)
<a name="l02157"></a>02157             <span class="keywordflow">if</span> (marq(i))
<a name="l02158"></a>02158               <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classSource__dep__inco__base.html">Source_dep_inco_base</a>, <a class="code" href="classEquation__base.html#a3c8ac50e3e7b6ed29024a43e828a5396" title="Renvoie les termes sources asssocies a l&#39;equation.">sources</a>()(i).<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>()).ajouter_(<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>(), resu);
<a name="l02159"></a>02159         }
<a name="l02160"></a>02160 <span class="comment">// Since 1.6.8 returns dI/dt:</span>
<a name="l02161"></a>02161       solution/=dt;
<a name="l02162"></a>02162     }
<a name="l02163"></a>02163 }
<a name="l02164"></a>02164 
<a name="l02165"></a><a class="code" href="classEquation__base.html#a5c06feed3927199a5ff70fb1c3a10f2a">02165</a> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; <a class="code" href="classEquation__base.html#a5c06feed3927199a5ff70fb1c3a10f2a">Equation_base::corriger_derivee_expl</a>(<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; d)
<a name="l02166"></a>02166 {
<a name="l02167"></a>02167   <span class="keywordflow">return</span> d;
<a name="l02168"></a>02168 }
<a name="l02169"></a><a class="code" href="classEquation__base.html#ab1a4dff7878cb1c47efb1ecb7b5b31ae">02169</a> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; <a class="code" href="classEquation__base.html#ab1a4dff7878cb1c47efb1ecb7b5b31ae">Equation_base::corriger_derivee_impl</a>(<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; d)
<a name="l02170"></a>02170 {
<a name="l02171"></a>02171   <span class="keywordflow">return</span> d;
<a name="l02172"></a>02172 }
<a name="l02173"></a>02173 
<a name="l02174"></a><a class="code" href="classEquation__base.html#ab0bb5d06bdc91e131dc9d5f9d7b57095">02174</a> <span class="keyword">const</span> <a class="code" href="classRef__Objet__U.html">RefObjU</a>&amp; <a class="code" href="classEquation__base.html#ab0bb5d06bdc91e131dc9d5f9d7b57095">Equation_base::get_modele</a>(<a class="code" href="Equation__base_8h.html#a2c9d34b2cc47e5b2b18347de20a77db5">Type_modele</a> type)<span class="keyword"> const</span>
<a name="l02175"></a>02175 <span class="keyword"></span>{
<a name="l02176"></a>02176   <span class="keywordflow">return</span> <a class="code" href="classEquation__base.html#abd4950a31ce927d094563bc6cd55cb0b">liste_modeles_</a>(0);
<a name="l02177"></a>02177 
<a name="l02178"></a>02178 }
<a name="l02179"></a>02179 <span class="comment">// MODIF ELI LAUCOIN (22/11/2007) : je rajoute un avancer et un reculer</span>
<a name="l02180"></a>02180 <span class="comment">// par defaut, cela ne fait qu&#39;avancer ou reculer l&#39;inconnue (et champ_conserve_ si initialise)</span>
<a name="l02181"></a><a class="code" href="classEquation__base.html#a276174d27befa3ca552c9b58836941a0">02181</a> <span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#a276174d27befa3ca552c9b58836941a0">Equation_base::avancer</a>(<span class="keywordtype">int</span> i)
<a name="l02182"></a>02182 {
<a name="l02183"></a>02183   <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().<a class="code" href="classChamp__Inc.html#a30e1d6e21e00fd942e85d0f6469d9722" title="Appel a l&#39;objet sous-jacent Avance le temps courant du champ de i pas de temps.">avancer</a>(i);
<a name="l02184"></a>02184   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a70ce889f92239d642ddbd36686a75c18">champ_conserve_</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>()) <a class="code" href="classEquation__base.html#a70ce889f92239d642ddbd36686a75c18">champ_conserve_</a>-&gt;<a class="code" href="classChamp__Inc.html#a30e1d6e21e00fd942e85d0f6469d9722" title="Appel a l&#39;objet sous-jacent Avance le temps courant du champ de i pas de temps.">avancer</a>(i);
<a name="l02185"></a>02185   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a207110280e36a5f102ebba60a1f1c955">champ_convecte_</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>()) <a class="code" href="classEquation__base.html#a207110280e36a5f102ebba60a1f1c955">champ_convecte_</a>-&gt;<a class="code" href="classChamp__Inc.html#a30e1d6e21e00fd942e85d0f6469d9722" title="Appel a l&#39;objet sous-jacent Avance le temps courant du champ de i pas de temps.">avancer</a>(i);
<a name="l02186"></a>02186 }
<a name="l02187"></a>02187 
<a name="l02188"></a><a class="code" href="classEquation__base.html#ab0ac04151f764d6d5e55aa6da34d68f3">02188</a> <span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#ab0ac04151f764d6d5e55aa6da34d68f3">Equation_base::reculer</a>(<span class="keywordtype">int</span> i)
<a name="l02189"></a>02189 {
<a name="l02190"></a>02190   <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().<a class="code" href="classChamp__Inc.html#a241a2a375658a606c3d659600a991bb5" title="Appel a l&#39;objet sous-jacent Recule le temps courant du champ de i pas de temps.">reculer</a>(i);
<a name="l02191"></a>02191   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a70ce889f92239d642ddbd36686a75c18">champ_conserve_</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>()) <a class="code" href="classEquation__base.html#a70ce889f92239d642ddbd36686a75c18">champ_conserve_</a>-&gt;<a class="code" href="classChamp__Inc.html#a241a2a375658a606c3d659600a991bb5" title="Appel a l&#39;objet sous-jacent Recule le temps courant du champ de i pas de temps.">reculer</a>(i);
<a name="l02192"></a>02192   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a207110280e36a5f102ebba60a1f1c955">champ_convecte_</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>()) <a class="code" href="classEquation__base.html#a207110280e36a5f102ebba60a1f1c955">champ_convecte_</a>-&gt;<a class="code" href="classChamp__Inc.html#a241a2a375658a606c3d659600a991bb5" title="Appel a l&#39;objet sous-jacent Recule le temps courant du champ de i pas de temps.">reculer</a>(i);
<a name="l02193"></a>02193 }
<a name="l02194"></a>02194 <span class="comment">// FIN MODIF ELI LAUCOIN (22/11/2007)</span>
<a name="l02195"></a>02195 
<a name="l02196"></a>02196 
<a name="l02197"></a><a class="code" href="Equation__base_8cpp.html#a7603f0308bf3641b5db73c0163d58473">02197</a> <span class="preprocessor">#define BLOQUE Cerr&lt;&lt;__PRETTY_FUNCTION__&lt;&lt; &quot; &quot;&lt;&lt;__FILE__&lt;&lt;&quot;:&quot;&lt;&lt;(int)__LINE__&lt;&lt;&quot; not coded, retrieves coding simpler&quot; &lt;&lt;finl;exit()</span>
<a name="l02198"></a>02198 <span class="preprocessor"></span>
<a name="l02199"></a>02199 <span class="comment">// methodes pour l&#39;implicite</span>
<a name="l02200"></a>02200 
<a name="l02201"></a>02201 <span class="comment">/* peut utiliser une memoization (discretisations PolyMAC)*/</span>
<a name="l02202"></a><a class="code" href="classEquation__base.html#abead2a90d8fb40f857e21a80a202b26b">02202</a> <span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#abead2a90d8fb40f857e21a80a202b26b">Equation_base::dimensionner_matrice</a>(<a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a>&amp; matrice)
<a name="l02203"></a>02203 {
<a name="l02204"></a>02204   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a4988730ccb465999b227ecc567e156d9">matrice_init</a>)
<a name="l02205"></a>02205     {
<a name="l02206"></a>02206       matrice.<a class="code" href="classMatrice__Morse.html#a7a49c763706dcfaed900f9d2cbb68716">get_set_tab1</a>().<a class="code" href="classIntVect.html#aeba00ad5c640b47a1bc4825a4d8f6e91" title="voir ArrOfInt::ref_array(). (cree un tableau sans structure parallele)">ref_array</a>(<a class="code" href="classEquation__base.html#a042bd4294c5adb3efaf6c95519a1cabd">matrice_stockee</a>.<a class="code" href="classMatrice__Morse.html#a7a49c763706dcfaed900f9d2cbb68716">get_set_tab1</a>());
<a name="l02207"></a>02207       matrice.<a class="code" href="classMatrice__Morse.html#af11c5853518e9e6db4c7e6e6acc8d7fd">get_set_tab2</a>().<a class="code" href="classIntVect.html#aeba00ad5c640b47a1bc4825a4d8f6e91" title="voir ArrOfInt::ref_array(). (cree un tableau sans structure parallele)">ref_array</a>(<a class="code" href="classEquation__base.html#a042bd4294c5adb3efaf6c95519a1cabd">matrice_stockee</a>.<a class="code" href="classMatrice__Morse.html#af11c5853518e9e6db4c7e6e6acc8d7fd">get_set_tab2</a>());
<a name="l02208"></a>02208       matrice.<a class="code" href="classMatrice__Morse.html#acd067e8514e5741f52b18a1d99746d11">get_set_coeff</a>().<a class="code" href="classDoubleVect.html#a88bf18f58757b68e59fbabbb781d217f" title="voir ArrOfDouble::ref_array(). (cree un tableau sans structure parallele)">ref_array</a>(<a class="code" href="classEquation__base.html#a042bd4294c5adb3efaf6c95519a1cabd">matrice_stockee</a>.<a class="code" href="classMatrice__Morse.html#acd067e8514e5741f52b18a1d99746d11">get_set_coeff</a>());
<a name="l02209"></a>02209       matrice.<a class="code" href="classMatrice__Morse.html#ab2fb02a8aba88f717c2285960f375fba">set_nb_columns</a>(<a class="code" href="classEquation__base.html#a042bd4294c5adb3efaf6c95519a1cabd">matrice_stockee</a>.<a class="code" href="classMatrice__Morse.html#a94caf9937bc5a110a7179cb3e9eaa9d9">nb_colonnes</a>());
<a name="l02210"></a>02210       <span class="keywordflow">return</span>;
<a name="l02211"></a>02211     }
<a name="l02212"></a>02212 
<a name="l02213"></a>02213   <a class="code" href="classEquation__base.html#a2f62dcd0761768631cbdc25279c9f48e">dimensionner_matrice_sans_mem</a>(matrice); <span class="comment">//le vrai appel</span>
<a name="l02214"></a>02214 
<a name="l02215"></a>02215   matrice.<a class="code" href="classMatrice__Morse.html#acd067e8514e5741f52b18a1d99746d11">get_set_coeff</a>() = 0.0;  <span class="comment">//!&lt; just to be sure ...</span>
<a name="l02216"></a>02216 <span class="comment"></span>
<a name="l02217"></a>02217   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#aa8151a96f63719523bf50ddd832e0f8f" title="Renvoie le probleme associe a l&#39;equation.">probleme</a>().<a class="code" href="classEquation__base.html#a324a761eaad25eb00d18e14764a1362e" title="Renvoie la discretisation associee a l&#39;equation.">discretisation</a>().<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>().finit_par(<span class="stringliteral">&quot;MAC&quot;</span>) || <a class="code" href="classEquation__base.html#aa8151a96f63719523bf50ddd832e0f8f" title="Renvoie le probleme associe a l&#39;equation.">probleme</a>().<a class="code" href="classEquation__base.html#a324a761eaad25eb00d18e14764a1362e" title="Renvoie la discretisation associee a l&#39;equation.">discretisation</a>().<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() == <span class="stringliteral">&quot;DDFV&quot;</span>)
<a name="l02218"></a>02218     {
<a name="l02219"></a>02219       <a class="code" href="classEquation__base.html#a042bd4294c5adb3efaf6c95519a1cabd">matrice_stockee</a>.<a class="code" href="classMatrice__Morse.html#a7a49c763706dcfaed900f9d2cbb68716">get_set_tab1</a>().<a class="code" href="classIntVect.html#aeba00ad5c640b47a1bc4825a4d8f6e91" title="voir ArrOfInt::ref_array(). (cree un tableau sans structure parallele)">ref_array</a>(matrice.<a class="code" href="classMatrice__Morse.html#a7a49c763706dcfaed900f9d2cbb68716">get_set_tab1</a>());
<a name="l02220"></a>02220       <a class="code" href="classEquation__base.html#a042bd4294c5adb3efaf6c95519a1cabd">matrice_stockee</a>.<a class="code" href="classMatrice__Morse.html#af11c5853518e9e6db4c7e6e6acc8d7fd">get_set_tab2</a>().<a class="code" href="classIntVect.html#aeba00ad5c640b47a1bc4825a4d8f6e91" title="voir ArrOfInt::ref_array(). (cree un tableau sans structure parallele)">ref_array</a>(matrice.<a class="code" href="classMatrice__Morse.html#af11c5853518e9e6db4c7e6e6acc8d7fd">get_set_tab2</a>());
<a name="l02221"></a>02221       <a class="code" href="classEquation__base.html#a042bd4294c5adb3efaf6c95519a1cabd">matrice_stockee</a>.<a class="code" href="classMatrice__Morse.html#acd067e8514e5741f52b18a1d99746d11">get_set_coeff</a>().<a class="code" href="classDoubleVect.html#a88bf18f58757b68e59fbabbb781d217f" title="voir ArrOfDouble::ref_array(). (cree un tableau sans structure parallele)">ref_array</a>(matrice.<a class="code" href="classMatrice__Morse.html#acd067e8514e5741f52b18a1d99746d11">get_set_coeff</a>());
<a name="l02222"></a>02222       <a class="code" href="classEquation__base.html#a042bd4294c5adb3efaf6c95519a1cabd">matrice_stockee</a>.<a class="code" href="classMatrice__Morse.html#ab2fb02a8aba88f717c2285960f375fba">set_nb_columns</a>(matrice.<a class="code" href="classMatrice__Morse.html#a94caf9937bc5a110a7179cb3e9eaa9d9">nb_colonnes</a>());
<a name="l02223"></a>02223       <a class="code" href="classEquation__base.html#a4988730ccb465999b227ecc567e156d9">matrice_init</a> = 1;
<a name="l02224"></a>02224     }
<a name="l02225"></a>02225 }
<a name="l02226"></a>02226 
<a name="l02227"></a><a class="code" href="classEquation__base.html#a2f62dcd0761768631cbdc25279c9f48e">02227</a> <span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#a2f62dcd0761768631cbdc25279c9f48e">Equation_base::dimensionner_matrice_sans_mem</a>(<a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a>&amp; matrice)
<a name="l02228"></a>02228 {
<a name="l02229"></a>02229 <span class="comment">// [ABN]: dimensioning of the implicit matrix: it can receive input from:</span>
<a name="l02230"></a>02230 <span class="comment">// - the operators</span>
<a name="l02231"></a>02231 <span class="comment">// - the mass solver</span>
<a name="l02232"></a>02232 <span class="comment">// - the sources</span>
<a name="l02233"></a>02233 <span class="comment">// We proceed in this order, with the idea that operators should take most of the slots in the Morse</span>
<a name="l02234"></a>02234 <span class="comment">// structure. Having the mass solver first would lead (in VDF, EF and VEF) to diagonal slots</span>
<a name="l02235"></a>02235 <span class="comment">// being reserved before sub-diagonal terms. In the Morse structure coefficients would then</span>
<a name="l02236"></a>02236 <span class="comment">// not be ordered by increasing columns number. This is not desirable, notably for EF which seem to</span>
<a name="l02237"></a>02237 <span class="comment">// be sensitive to this ordering (although they should not ....). Some Baltiks too (FLICA5 - thermic part)</span>
<a name="l02238"></a>02238 <span class="comment">// rely on this.</span>
<a name="l02239"></a>02239   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a4988730ccb465999b227ecc567e156d9">matrice_init</a>) <span class="comment">//!&lt; memoization</span>
<a name="l02240"></a>02240 <span class="comment"></span>    {
<a name="l02241"></a>02241       matrice.<a class="code" href="classMatrice__Morse.html#a7a49c763706dcfaed900f9d2cbb68716">get_set_tab1</a>().<a class="code" href="classIntVect.html#aeba00ad5c640b47a1bc4825a4d8f6e91" title="voir ArrOfInt::ref_array(). (cree un tableau sans structure parallele)">ref_array</a>(<a class="code" href="classEquation__base.html#a042bd4294c5adb3efaf6c95519a1cabd">matrice_stockee</a>.<a class="code" href="classMatrice__Morse.html#a7a49c763706dcfaed900f9d2cbb68716">get_set_tab1</a>());
<a name="l02242"></a>02242       matrice.<a class="code" href="classMatrice__Morse.html#af11c5853518e9e6db4c7e6e6acc8d7fd">get_set_tab2</a>().<a class="code" href="classIntVect.html#aeba00ad5c640b47a1bc4825a4d8f6e91" title="voir ArrOfInt::ref_array(). (cree un tableau sans structure parallele)">ref_array</a>(<a class="code" href="classEquation__base.html#a042bd4294c5adb3efaf6c95519a1cabd">matrice_stockee</a>.<a class="code" href="classMatrice__Morse.html#af11c5853518e9e6db4c7e6e6acc8d7fd">get_set_tab2</a>());
<a name="l02243"></a>02243       matrice.<a class="code" href="classMatrice__Morse.html#acd067e8514e5741f52b18a1d99746d11">get_set_coeff</a>().<a class="code" href="classDoubleVect.html#a88bf18f58757b68e59fbabbb781d217f" title="voir ArrOfDouble::ref_array(). (cree un tableau sans structure parallele)">ref_array</a>(<a class="code" href="classEquation__base.html#a042bd4294c5adb3efaf6c95519a1cabd">matrice_stockee</a>.<a class="code" href="classMatrice__Morse.html#acd067e8514e5741f52b18a1d99746d11">get_set_coeff</a>());
<a name="l02244"></a>02244       matrice.<a class="code" href="classMatrice__Morse.html#ab2fb02a8aba88f717c2285960f375fba">set_nb_columns</a>(<a class="code" href="classEquation__base.html#a042bd4294c5adb3efaf6c95519a1cabd">matrice_stockee</a>.<a class="code" href="classMatrice__Morse.html#a94caf9937bc5a110a7179cb3e9eaa9d9">nb_colonnes</a>());
<a name="l02245"></a>02245       <span class="keywordflow">return</span>;
<a name="l02246"></a>02246     }
<a name="l02247"></a>02247 
<a name="l02248"></a>02248   <span class="keywordtype">bool</span> isInit = <span class="keyword">false</span>;
<a name="l02249"></a>02249 <span class="comment">// Operators first (they&#39;re likely to take most of the slots in the Morse structure)</span>
<a name="l02250"></a>02250   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> opp=0; opp &lt; <a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>(); opp++)
<a name="l02251"></a>02251     {
<a name="l02252"></a>02252       <span class="keywordflow">if</span> (!isInit)
<a name="l02253"></a>02253         <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(opp).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#a66ef3c42e72d13fce0852ba92e56be6a" title="NE FAIT RIEN A surcharger dans les classes derivees.">dimensionner</a>(matrice);
<a name="l02254"></a>02254       <span class="keywordflow">else</span>
<a name="l02255"></a>02255         {
<a name="l02256"></a>02256           <a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a> mat2;
<a name="l02257"></a>02257           <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(opp).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#a66ef3c42e72d13fce0852ba92e56be6a" title="NE FAIT RIEN A surcharger dans les classes derivees.">dimensionner</a>(mat2);
<a name="l02258"></a>02258           <span class="keywordflow">if</span> (mat2.<a class="code" href="classMatrice__Morse.html#a94caf9937bc5a110a7179cb3e9eaa9d9">nb_colonnes</a>())
<a name="l02259"></a>02259             matrice += mat2;  <span class="comment">//!&lt; this only works if the matrix has been given its overall size first</span>
<a name="l02260"></a>02260 <span class="comment"></span>        }
<a name="l02261"></a>02261       isInit = isInit || (matrice.<a class="code" href="classMatrice__Morse.html#a94caf9937bc5a110a7179cb3e9eaa9d9">nb_colonnes</a>() != 0);
<a name="l02262"></a>02262     }
<a name="l02263"></a>02263 
<a name="l02264"></a>02264 <span class="comment">// ... then the mass solver ...</span>
<a name="l02265"></a>02265   <span class="keywordflow">if</span> (!isInit)
<a name="l02266"></a>02266     <a class="code" href="classEquation__base.html#adfedf474c07a92f6b2261ca2f1cee80e" title="Renvoie le solveur de masse associe a l&#39;equation.">solv_masse</a>().<a class="code" href="classDeriv__Solveur__Masse__base.html#ad9c6d7581b1979f3acb81c4d3da49edf">valeur</a>().<a class="code" href="classSolveur__Masse__base.html#a379cad7cc33a15fe0801ff3d12139cf4">dimensionner</a>(matrice);
<a name="l02267"></a>02267   <span class="keywordflow">else</span>
<a name="l02268"></a>02268     {
<a name="l02269"></a>02269       <a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a> mat2;
<a name="l02270"></a>02270       <a class="code" href="classEquation__base.html#adfedf474c07a92f6b2261ca2f1cee80e" title="Renvoie le solveur de masse associe a l&#39;equation.">solv_masse</a>().<a class="code" href="classDeriv__Solveur__Masse__base.html#ad9c6d7581b1979f3acb81c4d3da49edf">valeur</a>().<a class="code" href="classSolveur__Masse__base.html#a379cad7cc33a15fe0801ff3d12139cf4">dimensionner</a>(mat2);
<a name="l02271"></a>02271       matrice += mat2; <span class="comment">//!&lt; this only works if the matrix has been given its overall size first</span>
<a name="l02272"></a>02272 <span class="comment"></span>    }
<a name="l02273"></a>02273 
<a name="l02274"></a>02274 <span class="comment">// and finally sources (mass solver has surely done something already so no need for &quot;isInit&quot; test)</span>
<a name="l02275"></a>02275   <a class="code" href="classEquation__base.html#a6dae2cb8a228b0e3a6d90042fd75f360">les_sources</a>.<a class="code" href="classSources.html#a3b54745aa75661af01d03e93b6d467f5" title="Dimensionnement de la matrice implicite des termes sources. Parcours toutes les sources de la liste p...">dimensionner</a>(matrice);
<a name="l02276"></a>02276 }
<a name="l02277"></a>02277 
<a name="l02278"></a><a class="code" href="classEquation__base.html#a070306517a5f65eb11c64425986982fd">02278</a> <span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#a070306517a5f65eb11c64425986982fd">Equation_base::dimensionner_termes_croises</a>(<a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a>&amp; matrice, <span class="keyword">const</span> <a class="code" href="classProbleme__base.html" title="classe Probleme_base C&#39;est un Probleme_U qui n&#39;est pas un couplage. Le role d&#39;un Probleme_base est la...">Probleme_base</a>&amp; autre_pb, <span class="keywordtype">int</span> nl, <span class="keywordtype">int</span> nc)
<a name="l02279"></a>02279 {
<a name="l02280"></a>02280   matrice.<a class="code" href="classMatrice__Morse.html#ae95f9ed88a8a3fc637cd2a705cead9c8" title="Size the matrix with n lines and n columns and nnz zero-values coefficients.">dimensionner</a>(nl, nc, 0);
<a name="l02281"></a>02281   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>(); i++)
<a name="l02282"></a>02282     {
<a name="l02283"></a>02283       <a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a> mat2;
<a name="l02284"></a>02284       <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#a2affeabb573841181bdbe7bf0c37179e">dimensionner_termes_croises</a>(mat2, autre_pb, nl, nc);
<a name="l02285"></a>02285       <span class="keywordflow">if</span> (mat2.<a class="code" href="classMatrice__Morse.html#a94caf9937bc5a110a7179cb3e9eaa9d9">nb_colonnes</a>()) matrice += mat2;
<a name="l02286"></a>02286     }
<a name="l02287"></a>02287 }
<a name="l02288"></a>02288 
<a name="l02289"></a><a class="code" href="classEquation__base.html#a77496553b1a058f50e96c94f69577427">02289</a> <span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#a77496553b1a058f50e96c94f69577427">Equation_base::ajouter_termes_croises</a>(<span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; inco, <span class="keyword">const</span> <a class="code" href="classProbleme__base.html" title="classe Probleme_base C&#39;est un Probleme_U qui n&#39;est pas un couplage. Le role d&#39;un Probleme_base est la...">Probleme_base</a>&amp; autre_pb, <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; autre_inco, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; resu)<span class="keyword"> const</span>
<a name="l02290"></a>02290 <span class="keyword"></span>{
<a name="l02291"></a>02291   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>(); i++)
<a name="l02292"></a>02292     <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#a414a8b4811a7549fbfc403ae8b84947a">ajouter_termes_croises</a>(inco, autre_pb, autre_inco, resu);
<a name="l02293"></a>02293 }
<a name="l02294"></a>02294 
<a name="l02295"></a><a class="code" href="classEquation__base.html#af06819156c96d0b9bc1f82df44cee78a">02295</a> <span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#af06819156c96d0b9bc1f82df44cee78a">Equation_base::contribuer_termes_croises</a>(<span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; inco, <span class="keyword">const</span> <a class="code" href="classProbleme__base.html" title="classe Probleme_base C&#39;est un Probleme_U qui n&#39;est pas un couplage. Le role d&#39;un Probleme_base est la...">Probleme_base</a>&amp; autre_pb, <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; autre_inco, <a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a>&amp; matrice)<span class="keyword"> const</span>
<a name="l02296"></a>02296 <span class="keyword"></span>{
<a name="l02297"></a>02297   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>(); i++)
<a name="l02298"></a>02298     <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#aff19b9cf46e2778cab5d259886219d86">contribuer_termes_croises</a>(inco, autre_pb, autre_inco, matrice);
<a name="l02299"></a>02299 }
<a name="l02300"></a>02300 
<a name="l02301"></a>02301 <span class="comment">// ajoute les contributions des operateurs et des sources</span>
<a name="l02302"></a><a class="code" href="classEquation__base.html#a8dbd9212dcd3e8277d21a4b24b04bd65">02302</a> <span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#a8dbd9212dcd3e8277d21a4b24b04bd65">Equation_base::assembler</a>(<a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a>&amp; matrice, <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; inco, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; resu)
<a name="l02303"></a>02303 {
<a name="l02304"></a>02304 <span class="comment">// Test de verification de la methode contribuer_a_avec</span>
<a name="l02305"></a>02305   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> op=0; op&lt;<a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>(); op++)
<a name="l02306"></a>02306     <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(op).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#a3640f8feaeac1bf4d8ff3777c233753c">tester_contribuer_a_avec</a>(inco, matrice);
<a name="l02307"></a>02307 
<a name="l02308"></a>02308 <span class="comment">// Contribution des operateurs et des sources:</span>
<a name="l02309"></a>02309 <span class="comment">// [Vol/dt+A]Inco(n+1)=somme(residu)+Vol/dt*Inco(n)</span>
<a name="l02310"></a>02310 <span class="comment">// Typiquement: si Op=flux(Inco) alors la matrice implicite A contient une contribution -dflux/dInco</span>
<a name="l02311"></a>02311 <span class="comment">// Exemple: Op flux convectif en VDF:</span>
<a name="l02312"></a>02312 <span class="comment">// Op=T*u*S et A=-d(T*u*S)/dT=-u*S</span>
<a name="l02313"></a>02313   <span class="keyword">const</span> <a class="code" href="classDiscretisation__base.html#ad6b02af5532904375c2384825f2d4ea0">Discretisation_base::type_calcul_du_residu</a>&amp; type_codage=<a class="code" href="classEquation__base.html#aa8151a96f63719523bf50ddd832e0f8f" title="Renvoie le probleme associe a l&#39;equation.">probleme</a>().<a class="code" href="classProbleme__base.html#ac2bc635ab5b121c1cab78b6f98c0b203" title="Renvoie la discretisation associee au probleme.">discretisation</a>().<a class="code" href="classDiscretisation__base.html#a9d643031e55125e1b99dcafa32a4c54c">codage_du_calcul_du_residu</a>();
<a name="l02314"></a>02314   <span class="keywordflow">if</span> (type_codage==<a class="code" href="classDiscretisation__base.html#ad6b02af5532904375c2384825f2d4ea0a6da3daf19c0be297ebb5c28e3ad11b2d">Discretisation_base::VIA_CONTRIBUER_AU_SECOND_MEMBRE</a>)
<a name="l02315"></a>02315     {
<a name="l02316"></a>02316 <span class="comment">// On calcule somme(residu) par contribuer_au_second_membre (typiquement CL non implicitees)</span>
<a name="l02317"></a>02317 <span class="comment">// Cette approche necessite de coder 3 methodes (contribuer_a_avec, contribuer_au_second_membre et ajouter pour l&#39;explicite)</span>
<a name="l02318"></a>02318       <a class="code" href="classEquation__base.html#a3c8ac50e3e7b6ed29024a43e828a5396" title="Renvoie les termes sources asssocies a l&#39;equation.">sources</a>().<a class="code" href="classSources.html#aa91bceeb92650bc8b60a94f193a9d689" title="contribution a la matrice implicite des termes sources par defaut pas de contribution">contribuer_a_avec</a>(inco,matrice);
<a name="l02319"></a>02319       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a0faf52d1b518f5b0b2177f22efcc222d" title="Arret du compteur counter_id. On ajoute quantity a la somme des &#39;quantity&#39; (par defaut 0) stockees po...">end_count</a>(assemblage_sys_counter_,0,0);
<a name="l02320"></a>02320       <a class="code" href="classEquation__base.html#a3c8ac50e3e7b6ed29024a43e828a5396" title="Renvoie les termes sources asssocies a l&#39;equation.">sources</a>().<a class="code" href="classSources.html#a6fc277f1920a71841cb041dc1b6ed771" title="Ajoute la contribution de toutes les sources de la liste au tableau passe en parametre, et renvoie ce tableau.">ajouter</a>(resu);
<a name="l02321"></a>02321       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#affcd058809786918ed173aaf681d0843">begin_count</a>(assemblage_sys_counter_);
<a name="l02322"></a>02322       matrice.<a class="code" href="classMatrice__Base.html#a6ccb4d20d3877cf09f5178ff72af5406" title="Operation de multiplication-accumulation (saxpy) matrice vecteur. Operation: r = r + A*x...">ajouter_multvect</a>(inco, resu); <span class="comment">//!&lt; Add source residual first</span>
<a name="l02323"></a>02323 <span class="comment"></span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> op = 0; op &lt; <a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>(); op++)
<a name="l02324"></a>02324         {
<a name="l02325"></a>02325           <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(op).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#a903e728aad8e2d490580bf264319d65f" title="NE FAIT RIEN A surcharger dans les classes derivees.">contribuer_a_avec</a>(inco, matrice);
<a name="l02326"></a>02326           <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(op).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#a1b64f0211a360c124a218be15c80d9c7" title="NE FAIT RIEN A surcharger dans les classes derivees.">contribuer_au_second_membre</a>(resu);
<a name="l02327"></a>02327         }
<a name="l02328"></a>02328     }
<a name="l02329"></a>02329   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type_codage==<a class="code" href="classDiscretisation__base.html#ad6b02af5532904375c2384825f2d4ea0ab1b0885ce8af07e1563ae012e4822f6e">Discretisation_base::VIA_AJOUTER</a>)
<a name="l02330"></a>02330     {
<a name="l02331"></a>02331 <span class="comment">// On calcule somme(residu) par somme(operateur)+sources+A*Inco(n)</span>
<a name="l02332"></a>02332 <span class="comment">// Cette approche necessite de coder seulement deux methodes (contribuer_a_avec et ajouter)</span>
<a name="l02333"></a>02333 <span class="comment">// Donc un peu plus couteux en temps de calcul mais moins de code a ecrire/maintenir</span>
<a name="l02334"></a>02334       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> op=0; op&lt;<a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>(); op++)
<a name="l02335"></a>02335         {
<a name="l02336"></a>02336           <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(op).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#a903e728aad8e2d490580bf264319d65f" title="NE FAIT RIEN A surcharger dans les classes derivees.">contribuer_a_avec</a>(inco, matrice);
<a name="l02337"></a>02337           <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a0faf52d1b518f5b0b2177f22efcc222d" title="Arret du compteur counter_id. On ajoute quantity a la somme des &#39;quantity&#39; (par defaut 0) stockees po...">end_count</a>(assemblage_sys_counter_, 0, 0);
<a name="l02338"></a>02338           <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(op).<a class="code" href="classOperateur.html#accdf61cf1e33fb42e9eb06f1c501422b">ajouter</a>(resu);
<a name="l02339"></a>02339           <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#affcd058809786918ed173aaf681d0843">begin_count</a>(assemblage_sys_counter_);
<a name="l02340"></a>02340         }
<a name="l02341"></a>02341       <a class="code" href="classEquation__base.html#a3c8ac50e3e7b6ed29024a43e828a5396" title="Renvoie les termes sources asssocies a l&#39;equation.">sources</a>().<a class="code" href="classSources.html#aa91bceeb92650bc8b60a94f193a9d689" title="contribution a la matrice implicite des termes sources par defaut pas de contribution">contribuer_a_avec</a>(inco,matrice);
<a name="l02342"></a>02342       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a0faf52d1b518f5b0b2177f22efcc222d" title="Arret du compteur counter_id. On ajoute quantity a la somme des &#39;quantity&#39; (par defaut 0) stockees po...">end_count</a>(assemblage_sys_counter_,0,0);
<a name="l02343"></a>02343       <a class="code" href="classEquation__base.html#a3c8ac50e3e7b6ed29024a43e828a5396" title="Renvoie les termes sources asssocies a l&#39;equation.">sources</a>().<a class="code" href="classSources.html#a6fc277f1920a71841cb041dc1b6ed771" title="Ajoute la contribution de toutes les sources de la liste au tableau passe en parametre, et renvoie ce tableau.">ajouter</a>(resu);
<a name="l02344"></a>02344       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#affcd058809786918ed173aaf681d0843">begin_count</a>(assemblage_sys_counter_);
<a name="l02345"></a>02345       matrice.<a class="code" href="classMatrice__Base.html#a6ccb4d20d3877cf09f5178ff72af5406" title="Operation de multiplication-accumulation (saxpy) matrice vecteur. Operation: r = r + A*x...">ajouter_multvect</a>(inco, resu); <span class="comment">//!&lt; Ajout de A*Inco(n) PL (11/04/2018): On aimerait bien calculer la contribution des sources en premier comme dans le cas VIA_CONTRIBUER_AU_SECOND_MEMBRE mais le cas Canal_perio_3D (keps periodique plante: il y&#39;a une erreur de periodicite dans les termes sources du modele KEps...</span>
<a name="l02346"></a>02346 <span class="comment"></span><span class="comment">//</span>
<a name="l02347"></a>02347 <span class="comment">//</span>
<a name="l02348"></a>02348 <span class="comment">//</span>
<a name="l02349"></a>02349     }
<a name="l02350"></a>02350   <span class="keywordflow">else</span>
<a name="l02351"></a>02351     {
<a name="l02352"></a>02352       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Unknown value in Equation_base::assembler for &quot;</span> &lt;&lt; type_codage &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l02353"></a>02353       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l02354"></a>02354     }
<a name="l02355"></a>02355 }
<a name="l02356"></a>02356 
<a name="l02357"></a>02357 <span class="comment">// modifie la matrice et le second mmebre en fonction des CL</span>
<a name="l02358"></a><a class="code" href="classEquation__base.html#ae124e27acae18dbff615e954ef5211d9">02358</a> <span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#ae124e27acae18dbff615e954ef5211d9">Equation_base::modifier_pour_Cl</a>(<a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a>&amp; mat_morse, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; secmem)<span class="keyword"> const</span>
<a name="l02359"></a>02359 <span class="keyword"></span>{
<a name="l02360"></a>02360   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> op=0; op&lt;<a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>(); op++)
<a name="l02361"></a>02361     {
<a name="l02362"></a>02362       <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(op).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#a119798b1efa7c62fb28a53c20ccd105c" title="NE FAIT RIEN A surcharger dans les classes derivees.">modifier_pour_Cl</a>(mat_morse,secmem);
<a name="l02363"></a>02363     }
<a name="l02364"></a>02364 }
<a name="l02365"></a>02365 <span class="comment">// assemble, ajoute linertie,et modifie_pour_cl.</span>
<a name="l02366"></a><a class="code" href="classEquation__base.html#a6442c887ca10e6b6e59e0d36140f698c">02366</a> <span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#a6442c887ca10e6b6e59e0d36140f698c">Equation_base::assembler_avec_inertie</a>( <a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a>&amp; mat_morse,<span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; present, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; secmem)
<a name="l02367"></a>02367 {
<a name="l02368"></a>02368   <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#affcd058809786918ed173aaf681d0843">begin_count</a>(assemblage_sys_counter_);
<a name="l02369"></a>02369   <a class="code" href="classEquation__base.html#a8dbd9212dcd3e8277d21a4b24b04bd65">assembler</a>(mat_morse,present,secmem);
<a name="l02370"></a>02370   <a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#ace73be0f7ccbd6ed6f7096ba277447fe">ajouter_inertie</a>(mat_morse,secmem,(*<span class="keyword">this</span>));
<a name="l02371"></a>02371   <a class="code" href="classEquation__base.html#ae124e27acae18dbff615e954ef5211d9">modifier_pour_Cl</a>(mat_morse,secmem);
<a name="l02372"></a>02372   <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a0faf52d1b518f5b0b2177f22efcc222d" title="Arret du compteur counter_id. On ajoute quantity a la somme des &#39;quantity&#39; (par defaut 0) stockees po...">end_count</a>(assemblage_sys_counter_);
<a name="l02373"></a>02373 }
<a name="l02374"></a>02374 
<a name="l02375"></a>02375 <span class="comment">/* verifie que tous les termes sont compatibles */</span>
<a name="l02376"></a><a class="code" href="classEquation__base.html#a6779ab8b1f3d7a73e33034f9859ce5bd">02376</a> <span class="keywordtype">int</span> <a class="code" href="classEquation__base.html#a6779ab8b1f3d7a73e33034f9859ce5bd">Equation_base::has_interface_blocs</a>()<span class="keyword"> const</span>
<a name="l02377"></a>02377 <span class="keyword"></span>{
<a name="l02378"></a>02378   <span class="keywordtype">int</span> ok = 1;
<a name="l02379"></a>02379   <span class="comment">/* operateurs, masse, sources */</span>
<a name="l02380"></a>02380   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> op = 0; op &lt; <a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>(); op++) ok &amp;= <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(op).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#add0b573a00ff5807bca488783aeec334">has_interface_blocs</a>();
<a name="l02381"></a>02381   ok &amp;= <a class="code" href="classEquation__base.html#adfedf474c07a92f6b2261ca2f1cee80e" title="Renvoie le solveur de masse associe a l&#39;equation.">solv_masse</a>().<a class="code" href="classDeriv__Solveur__Masse__base.html#ad9c6d7581b1979f3acb81c4d3da49edf">valeur</a>().<a class="code" href="classSolveur__Masse__base.html#a82071c86d9e5d3f98df7eb9d839c7dc7">has_interface_blocs</a>();
<a name="l02382"></a>02382   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classEquation__base.html#a6dae2cb8a228b0e3a6d90042fd75f360">les_sources</a>.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>(); i++) ok &amp;= <a class="code" href="classEquation__base.html#a6dae2cb8a228b0e3a6d90042fd75f360">les_sources</a>(i).<a class="code" href="classList__Source.html#a7e4137d89cdcf913702c88f720a7f316" title="Retourne l&#39;Objet_U associe a la cellule de la liste.">valeur</a>().has_interface_blocs();
<a name="l02383"></a>02383   <span class="keywordflow">return</span> ok;
<a name="l02384"></a>02384 }
<a name="l02385"></a>02385 
<a name="l02386"></a>02386 <span class="comment">/* comme dimmensionner_matrice(), mais sans memoization */</span>
<a name="l02387"></a>02387 <span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#a5ba7300a466493c7b41b739688d23887">Equation_base::dimensionner_blocs</a>(<a class="code" href="Interface__blocs_8h.html#a68e4f5c4505f6b31305de844302660bb">matrices_t</a> matrices, <span class="keyword">const</span> <a class="code" href="Interface__blocs_8h.html#a2d7480bf11fc9f791b1d2839fa30a5c3">tabs_t</a>&amp; semi_impl)<span class="keyword"> const</span>
<a name="l02388"></a>02388 <span class="keyword"></span>{
<a name="l02389"></a>02389   <span class="comment">/* operateurs, masse, sources */</span>
<a name="l02390"></a>02390   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> op = 0; op &lt; <a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>(); op++) <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(op).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#a1beeeb32ed7ba7f084cf0ff81152d36a">dimensionner_blocs</a>(matrices, semi_impl);
<a name="l02391"></a>02391   <a class="code" href="classEquation__base.html#adfedf474c07a92f6b2261ca2f1cee80e" title="Renvoie le solveur de masse associe a l&#39;equation.">solv_masse</a>().<a class="code" href="classDeriv__Solveur__Masse__base.html#ad9c6d7581b1979f3acb81c4d3da49edf">valeur</a>().<a class="code" href="classSolveur__Masse__base.html#a62a3f9d597b25b2943e060bfcdf76ecd">dimensionner_blocs</a>(matrices);
<a name="l02392"></a>02392   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classEquation__base.html#a6dae2cb8a228b0e3a6d90042fd75f360">les_sources</a>.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>(); i++) <a class="code" href="classEquation__base.html#a6dae2cb8a228b0e3a6d90042fd75f360">les_sources</a>(i).<a class="code" href="classList__Source.html#a7e4137d89cdcf913702c88f720a7f316" title="Retourne l&#39;Objet_U associe a la cellule de la liste.">valeur</a>().dimensionner_blocs(matrices, semi_impl);
<a name="l02393"></a>02393 }
<a name="l02394"></a>02394 
<a name="l02395"></a><a class="code" href="classNavier__Stokes__std.html#a5d60f27928e31fcccf96aefaad401b1b">02395</a> <span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#a83fee5d3f9749fd138088e9a8309d504">Equation_base::assembler_blocs</a>(<a class="code" href="Interface__blocs_8h.html#a68e4f5c4505f6b31305de844302660bb">matrices_t</a> matrices, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; secmem, <span class="keyword">const</span> <a class="code" href="Interface__blocs_8h.html#a2d7480bf11fc9f791b1d2839fa30a5c3">tabs_t</a>&amp; semi_impl)<span class="keyword"> const</span>
<a name="l02396"></a>02396 <span class="keyword"></span>{
<a name="l02397"></a>02397   <span class="comment">/* mise a zero */</span>
<a name="l02398"></a>02398   secmem = 0;
<a name="l02399"></a>02399   <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;&amp; i_m : matrices) i_m.second-&gt;get_set_coeff() = 0;
<a name="l02400"></a>02400   <span class="comment">/* operateurs, sources, masse */</span>
<a name="l02401"></a>02401   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>(); i++)
<a name="l02402"></a>02402     <a class="code" href="classEquation__base.html#a8406eaa10e61a27e9a2e1cacea253c3e">operateur</a>(i).<a class="code" href="classOperateur.html#a1f3e24efd9b54d05821e731fe4bd6027">l_op_base</a>().<a class="code" href="classOperateur__base.html#a0044e3ee1822094970ba5a32997fbd2a">ajouter_blocs</a>(matrices, secmem, semi_impl);
<a name="l02403"></a>02403   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classEquation__base.html#a6dae2cb8a228b0e3a6d90042fd75f360">les_sources</a>.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>(); i++)
<a name="l02404"></a>02404     <a class="code" href="classEquation__base.html#a6dae2cb8a228b0e3a6d90042fd75f360">les_sources</a>(i).<a class="code" href="classList__Source.html#a7e4137d89cdcf913702c88f720a7f316" title="Retourne l&#39;Objet_U associe a la cellule de la liste.">valeur</a>().ajouter_blocs(matrices, secmem, semi_impl);
<a name="l02405"></a>02405 }
<a name="l02406"></a>02406 
<a name="l02407"></a><a class="code" href="classQDM__Multiphase.html#adb75954515312e1b1afb90b7e86e3696">02407</a> <span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#ac79cbb558992c5e74f38992b703ba727">Equation_base::assembler_blocs_avec_inertie</a>(<a class="code" href="Interface__blocs_8h.html#a68e4f5c4505f6b31305de844302660bb">matrices_t</a> matrices, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; secmem, <span class="keyword">const</span> <a class="code" href="Interface__blocs_8h.html#a2d7480bf11fc9f791b1d2839fa30a5c3">tabs_t</a>&amp; semi_impl)<span class="keyword"> const</span>
<a name="l02408"></a>02408 <span class="keyword"></span>{
<a name="l02409"></a>02409   <a class="code" href="classEquation__base.html#a83fee5d3f9749fd138088e9a8309d504">assembler_blocs</a>(matrices, secmem, semi_impl);
<a name="l02410"></a>02410   <a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a929c9db57c971bbba038466053d2f6f7">ajouter_blocs</a>(matrices, secmem, *<span class="keyword">this</span>);
<a name="l02411"></a>02411 }
<a name="l02412"></a>02412 
<a name="l02413"></a>02413 <span class="comment">/* creation de champ_conserve_, cl_champ_conserve_ */</span>
<a name="l02414"></a><a class="code" href="classEquation__base.html#a5ed3fca693e4b40c806792d498dbc31a">02414</a> <span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#a5ed3fca693e4b40c806792d498dbc31a">Equation_base::init_champ_conserve</a>()<span class="keyword"> const</span>
<a name="l02415"></a>02415 <span class="keyword"></span>{
<a name="l02416"></a>02416   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a70ce889f92239d642ddbd36686a75c18">champ_conserve_</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>()) <span class="keywordflow">return</span>; <span class="comment">//deja fait</span>
<a name="l02417"></a>02417   <span class="keywordtype">int</span> Nt = <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>()-&gt;<a class="code" href="classChamp__Inc.html#ab4847a769013ea94d3033240173f674b" title="Appel a l&#39;objet sous-jacent Renvoie le nombre de pas de temps conserve.">nb_valeurs_temporelles</a>(), Nl = <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>().<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0), Nc = <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>().<a class="code" href="classDoubleVect.html#ab02d01cd1bdab66fbd66f9a47cc29e10">line_size</a>();
<a name="l02418"></a>02418 <span class="comment">// champ_conserve_ : meme type / support que l&#39;inconnue</span>
<a name="l02419"></a>02419   <a class="code" href="classEquation__base.html#a324a761eaad25eb00d18e14764a1362e" title="Renvoie la discretisation associee a l&#39;equation.">discretisation</a>().<a class="code" href="classDiscretisation__base.html#a9352fde12ac9fe076a5afba1f06c8a28" title="Methode statique qui cree un Champ_Inc du type specifie. Les parametres &quot;directive&quot; et &quot;nom_discre...">creer_champ</a>(<a class="code" href="classEquation__base.html#a70ce889f92239d642ddbd36686a75c18">champ_conserve_</a>, <a class="code" href="classEquation__base.html#a12d97ae801edc18f614523677921346e" title="Renvoie la zone discretisee associee a l&#39;equation.">zone_dis</a>().<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>(), <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>().<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>(), <span class="stringliteral">&quot;N/A&quot;</span>, <span class="stringliteral">&quot;N/A&quot;</span>, Nc, Nl, Nt, <a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().temps_courant());
<a name="l02420"></a>02420   <a class="code" href="classEquation__base.html#a70ce889f92239d642ddbd36686a75c18">champ_conserve_</a>-&gt;<a class="code" href="classChamp__Inc.html#aa6febd6d77fcb0d182b368f6f2c26b2e" title="Appel a l&#39;objet sous-jacent Associe le champ a l&#39;equation dont il est une inconnue.">associer_eqn</a>(*<span class="keyword">this</span>);
<a name="l02421"></a>02421   <span class="keyword">auto</span> nom_fonc = <a class="code" href="classEquation__base.html#a8f0d6e830c90446ab7bad0098327df5b">get_fonc_champ_conserve</a>();
<a name="l02422"></a>02422   <a class="code" href="classEquation__base.html#a70ce889f92239d642ddbd36686a75c18">champ_conserve_</a>-&gt;<a class="code" href="classObjet__U.html#a469dbcad1d4a98a67e4246dce8e264ad" title="Donne un nom a l&#39;Objet_U Methode virtuelle a surcharger.">nommer</a>(nom_fonc.first.c_str()), <a class="code" href="classEquation__base.html#a70ce889f92239d642ddbd36686a75c18">champ_conserve_</a>-&gt;init_champ_calcule(*<span class="keyword">this</span>, nom_fonc.second);
<a name="l02423"></a>02423 }
<a name="l02424"></a>02424 
<a name="l02425"></a>02425 <span class="comment">/* methode de calcul par defaut de champ_conserve : produit coefficient_temporel * inconnue */</span>
<a name="l02426"></a><a class="code" href="classEquation__base.html#ae195e4c25e4128a50d75907939a2fe75">02426</a> <span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#ae195e4c25e4128a50d75907939a2fe75">Equation_base::calculer_champ_conserve</a>(<span class="keyword">const</span> <a class="code" href="classObjet__U.html" title="classe Objet_U Cette classe est la classe de base des Objets de TRUST Dans les classes derivees de Ob...">Objet_U</a>&amp; obj, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; val, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; bval, <a class="code" href="Interface__blocs_8h.html#a2d7480bf11fc9f791b1d2839fa30a5c3">tabs_t</a>&amp; deriv)
<a name="l02427"></a>02427 {
<a name="l02428"></a>02428   <span class="keyword">const</span> <a class="code" href="classEquation__base.html">Equation_base</a>&amp; eqn = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classEquation__base.html">Equation_base</a>, obj);
<a name="l02429"></a>02429   <span class="keyword">const</span> <a class="code" href="classChamp__base.html" title="classe Champ_base Cette classe est la base de la hierarchie des champs. Ses membres sont les attribut...">Champ_base</a> *<a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a> = eqn.<a class="code" href="classEquation__base.html#adfedf474c07a92f6b2261ca2f1cee80e" title="Renvoie le solveur de masse associe a l&#39;equation.">solv_masse</a>().<a class="code" href="classDeriv__Solveur__Masse__base.html#ad9c6d7581b1979f3acb81c4d3da49edf">valeur</a>().<a class="code" href="classSolveur__Masse__base.html#a36425617568c028cbe1872a45564e935">has_coefficient_temporel</a>() ? &amp;eqn.<a class="code" href="classEquation__base.html#ad6bcab0bb6d83b1b563a7aa30f0df721">get_champ</a>(eqn.<a class="code" href="classEquation__base.html#adfedf474c07a92f6b2261ca2f1cee80e" title="Renvoie le solveur de masse associe a l&#39;equation.">solv_masse</a>().<a class="code" href="classDeriv__Solveur__Masse__base.html#ad9c6d7581b1979f3acb81c4d3da49edf">valeur</a>().<a class="code" href="classSolveur__Masse__base.html#a2a08c9f23a2de790d8715a7f06cf8c06">get_name_of_coefficient_temporel</a>()) : NULL; <span class="comment">//coeff temporel</span>
<a name="l02430"></a>02430   <span class="keyword">const</span> <a class="code" href="classChamp__Inc__base.html" title="Classe Champ_Inc_base Classe de base des champs inconnues qui sont les champs calcules par une equati...">Champ_Inc_base</a>&amp; inco = eqn.<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>();
<a name="l02431"></a>02431 <span class="comment">// valeur du champ lui-meme</span>
<a name="l02432"></a>02432   val = inco.<a class="code" href="classChamp__Inc__base.html#adb537f43f1649e103a8980314c7ed175" title="Renvoie le tableau des valeurs du champ au temps courant.">valeurs</a>();
<a name="l02433"></a>02433   <span class="keywordflow">if</span> (coeff) <a class="code" href="DoubleVect_8cpp.html#ae2081ab8f1947e8400a928ca3b172e29">tab_multiply_any_shape</a>(val, coeff-&gt;<a class="code" href="classChamp__Proto.html#a9d8c69f11d1b0a8e378cc6ca41793614">valeurs</a>());
<a name="l02434"></a>02434 
<a name="l02435"></a>02435   bval = inco.<a class="code" href="classChamp__Inc__base.html#a2cd79416efbe173787964966da501ad0" title="renvoie la valeur du champ aux faces de bord">valeur_aux_bords</a>();
<a name="l02436"></a>02436   <span class="keywordflow">if</span> (coeff) <a class="code" href="DoubleVect_8cpp.html#ae2081ab8f1947e8400a928ca3b172e29">tab_multiply_any_shape</a>(bval, coeff-&gt;<a class="code" href="classChamp__base.html#a63e4137abc2801a8861b272bcdf961fe" title="renvoie la valeur du champ aux faces de bord">valeur_aux_bords</a>());
<a name="l02437"></a>02437 
<a name="l02438"></a>02438   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; der = deriv[inco.<a class="code" href="classField__base.html#ae1377124eabe8387aced762115b062bb" title="Renvoie le nom du champ.">le_nom</a>().<a class="code" href="classNom.html#a855d8cd96b5c73c2aa55cb7c0a870640">getString</a>()];
<a name="l02439"></a>02439   <span class="keywordflow">if</span> (coeff) der = coeff-&gt;<a class="code" href="classChamp__Proto.html#a9d8c69f11d1b0a8e378cc6ca41793614">valeurs</a>();
<a name="l02440"></a>02440   <span class="keywordflow">else</span> der.<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(val.<a class="code" href="classDoubleTab.html#a3eadd63f3ba20c1b454d760b430acbf7" title="Returns the total dimensions of the multi-dimensionnal array, including virtual items (used in parall...">dimension_tot</a>(0), val.<a class="code" href="classDoubleVect.html#ab02d01cd1bdab66fbd66f9a47cc29e10">line_size</a>()), der = 1;
<a name="l02441"></a>02441 }
<a name="l02442"></a>02442 
<a name="l02443"></a>02443 <span class="comment">// Impression du residu dans fic (generalement dt_ev)</span>
<a name="l02444"></a>02444 <span class="comment">// Cette methode peut etre surchargee par des equations</span>
<a name="l02445"></a>02445 <span class="comment">// imprimant des residus particuliers (K-Eps, Concentrations,...)</span>
<a name="l02446"></a><a class="code" href="classEquation__base.html#a700f2903c7c3f2f73fdde7a45bfb03be">02446</a> <span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#a700f2903c7c3f2f73fdde7a45bfb03be">Equation_base::imprime_residu</a>(<a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a>&amp; fic)
<a name="l02447"></a>02447 {
<a name="l02448"></a>02448   <span class="keywordtype">int</span> size = <a class="code" href="classEquation__base.html#a9f72f2df6a43a4046cd6e7e7d726ed6b">residu_</a>.<a class="code" href="classArrOfDouble.html#a3c3b33bea0e88b87315c21ee94bee05f" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l02449"></a>02449   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;size; i++)
<a name="l02450"></a>02450     {
<a name="l02451"></a>02451       fic &lt;&lt; <a class="code" href="classEquation__base.html#a9f72f2df6a43a4046cd6e7e7d726ed6b">residu_</a>(i) &lt;&lt; <span class="stringliteral">&quot;\t &quot;</span>;
<a name="l02452"></a>02452       <span class="keywordtype">int</span> nb_unknowns = <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>().<a class="code" href="classDoubleTab.html#a3eadd63f3ba20c1b454d760b430acbf7" title="Returns the total dimensions of the multi-dimensionnal array, including virtual items (used in parall...">dimension_tot</a>(0);
<a name="l02453"></a>02453       <span class="keywordtype">double</span> residual_limit = ( nb_unknowns == 0 ? <a class="code" href="Double_8h.html#ae0ee0cebfad5968da0ad6cc7a49e16b6">DMAXFLOAT</a> : <a class="code" href="Double_8h.html#ae0ee0cebfad5968da0ad6cc7a49e16b6">DMAXFLOAT</a>/nb_unknowns);
<a name="l02454"></a>02454       <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a9f72f2df6a43a4046cd6e7e7d726ed6b">residu_</a>(i)&gt;residual_limit)
<a name="l02455"></a>02455         {
<a name="l02456"></a>02456           fic &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l02457"></a>02457           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Equation &quot;</span> &lt;&lt; <a class="code" href="classEquation__base.html#a65e9b2520ac7b42444e4d9aa4f18ccf7" title="Renvoie le nom de l&#39;equation.">le_nom</a>() &lt;&lt; <span class="stringliteral">&quot; is diverging:&quot;</span> &lt;&lt; finl;
<a name="l02458"></a>02458           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;A residual ||dI/dt|| for this equation is bigger than &quot;</span> &lt;&lt; residual_limit &lt;&lt; <span class="stringliteral">&quot; !&quot;</span> &lt;&lt; finl;
<a name="l02459"></a>02459           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Have a look at the &quot;</span> &lt;&lt; <a class="code" href="classObjet__U.html#a7c27c4f80259eeef76ff8fe2d3bc61f7" title="Renvoie une reference constante vers le nom du cas. Cette methode est statique.">nom_du_cas</a>() &lt;&lt; <span class="stringliteral">&quot;.dt_ev file.&quot;</span> &lt;&lt; finl;
<a name="l02460"></a>02460           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l02461"></a>02461         }
<a name="l02462"></a>02462     }
<a name="l02463"></a>02463 }
<a name="l02464"></a>02464 
<a name="l02465"></a>02465 <span class="comment">// Retourne l&#39;expression du residu (de meme peut etre surcharge)</span>
<a name="l02466"></a><a class="code" href="classEquation__base.html#af86f7f88fba1214b9f1f185ce8eb4de2">02466</a> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> <a class="code" href="classEquation__base.html#af86f7f88fba1214b9f1f185ce8eb4de2">Equation_base::expression_residu</a>()
<a name="l02467"></a>02467 {
<a name="l02468"></a>02468   <span class="keywordtype">int</span> size = <a class="code" href="classEquation__base.html#a9f72f2df6a43a4046cd6e7e7d726ed6b">residu_</a>.<a class="code" href="classArrOfDouble.html#a3c3b33bea0e88b87315c21ee94bee05f" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l02469"></a>02469   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> tmp(<span class="stringliteral">&quot;&quot;</span>),ajout(<span class="stringliteral">&quot;&quot;</span>);
<a name="l02470"></a>02470   <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#aa8151a96f63719523bf50ddd832e0f8f" title="Renvoie le probleme associe a l&#39;equation.">probleme</a>().get_coupled())
<a name="l02471"></a>02471     {
<a name="l02472"></a>02472       ajout=<span class="stringliteral">&quot;_&quot;</span>;
<a name="l02473"></a>02473       ajout+=<a class="code" href="classEquation__base.html#aa8151a96f63719523bf50ddd832e0f8f" title="Renvoie le probleme associe a l&#39;equation.">probleme</a>().<a class="code" href="classProbleme__base.html#a58bc0b101f3f3f1d8522a9f41f1fad7b" title="surcharge Objet_U::le_nom() Renvoie le nom du probleme">le_nom</a>();
<a name="l02474"></a>02474     }
<a name="l02475"></a>02475   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;size; i++)
<a name="l02476"></a>02476     {
<a name="l02477"></a>02477       tmp+=<span class="stringliteral">&quot;Ri=max&quot;</span>;
<a name="l02478"></a>02478       tmp+=ajout;
<a name="l02479"></a>02479       tmp+=<span class="stringliteral">&quot;|d&quot;</span>;
<a name="l02480"></a>02480 <span class="comment">// Comment nommer de facon claire ET concise</span>
<a name="l02481"></a>02481 <span class="comment">// le champ de l&#39;expression:</span>
<a name="l02482"></a>02482       <span class="keywordflow">if</span> (size==1)
<a name="l02483"></a>02483         {
<a name="l02484"></a>02484 <span class="comment">// Champ scalaire</span>
<a name="l02485"></a>02485           tmp+=(<a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>)<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().<a class="code" href="classO__U__Ptr.html#a5aae0c48048a40339f3847aa14109231" title="Renvoie ref_().le_nom() si le pointeur est non nul ou &quot;Pointeur Nul&quot;.">le_nom</a>()[0];
<a name="l02486"></a>02486         }
<a name="l02487"></a>02487       <span class="keywordflow">else</span>
<a name="l02488"></a>02488         {
<a name="l02489"></a>02489 <span class="comment">// Champ multiscalaire</span>
<a name="l02490"></a>02490           <span class="keywordflow">if</span> (<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>()-&gt;nom_compo(0)[0]!=<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>()-&gt;nom_compo(size-1)[0])
<a name="l02491"></a>02491             {
<a name="l02492"></a>02492 <span class="comment">// Exemple, champ K_Eps</span>
<a name="l02493"></a>02493               tmp+=(<a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>)<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>()-&gt;nom_compo(i)[0];
<a name="l02494"></a>02494             }
<a name="l02495"></a>02495           <span class="keywordflow">else</span>
<a name="l02496"></a>02496             {
<a name="l02497"></a>02497 <span class="comment">// Exemple, champ concentration</span>
<a name="l02498"></a>02498               tmp+=(<a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>)<a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().<a class="code" href="classO__U__Ptr.html#a5aae0c48048a40339f3847aa14109231" title="Renvoie ref_().le_nom() si le pointeur est non nul ou &quot;Pointeur Nul&quot;.">le_nom</a>()[0];
<a name="l02499"></a>02499               tmp+=(<a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>)i;
<a name="l02500"></a>02500             }
<a name="l02501"></a>02501         }
<a name="l02502"></a>02502       tmp+=<span class="stringliteral">&quot;/dt|\t &quot;</span>;
<a name="l02503"></a>02503     }
<a name="l02504"></a>02504   <span class="keywordflow">return</span> tmp;
<a name="l02505"></a>02505 }
<a name="l02506"></a>02506 
<a name="l02507"></a>02507 <span class="comment">// Dimension les tableaux des residus</span>
<a name="l02508"></a><a class="code" href="classEquation__base.html#a888dc3f8eb5fb54b05250b6b704a6997">02508</a> <span class="keywordtype">void</span> <a class="code" href="classEquation__base.html#a888dc3f8eb5fb54b05250b6b704a6997">Equation_base::initialise_residu</a>(<span class="keywordtype">int</span> size)
<a name="l02509"></a>02509 {
<a name="l02510"></a>02510   <span class="keywordflow">if</span> (size==0)
<a name="l02511"></a>02511     size = <a class="code" href="classEquation__base.html#a5a1fce9487b9a8dd17020914100c2c89">inconnue</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>().<a class="code" href="classDoubleVect.html#ab02d01cd1bdab66fbd66f9a47cc29e10">line_size</a>();
<a name="l02512"></a>02512   <a class="code" href="classEquation__base.html#a9f72f2df6a43a4046cd6e7e7d726ed6b">residu_</a>.<a class="code" href="classDoubleVect.html#ac55a86eea7b2f06b084b88b16042b67b" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(size);
<a name="l02513"></a>02513   <a class="code" href="classEquation__base.html#afd4438d08126607309aad3664afbec29">residu_initial_</a>.<a class="code" href="classDoubleVect.html#ac55a86eea7b2f06b084b88b16042b67b" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(size);
<a name="l02514"></a>02514   <a class="code" href="classEquation__base.html#a9f72f2df6a43a4046cd6e7e7d726ed6b">residu_</a>=0;
<a name="l02515"></a>02515   <a class="code" href="classEquation__base.html#afd4438d08126607309aad3664afbec29">residu_initial_</a>=0;
<a name="l02516"></a>02516 }
<a name="l02517"></a>02517 
<a name="l02518"></a>02518 
<a name="l02519"></a><a class="code" href="classEquation__base.html#a75697cbd27151fc9efb3032f54509b20">02519</a> <span class="keyword">const</span> <a class="code" href="classOperateur.html" title="classe Operateur Classe generique de la hierarchie des operateurs. Cette classe generique est particu...">Operateur</a>&amp; <a class="code" href="classEquation__base.html#a75697cbd27151fc9efb3032f54509b20">Equation_base::operateur_fonctionnel</a>(<span class="keywordtype">int</span> i)<span class="keyword"> const</span>
<a name="l02520"></a>02520 <span class="keyword"></span>{
<a name="l02521"></a>02521   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;The method operateur_fonctionnel is not coded for equation &quot;</span>&lt;&lt;<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>()&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l02522"></a>02522   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l02523"></a>02523   <span class="keywordflow">throw</span>;
<a name="l02524"></a>02524   <span class="keywordflow">return</span> <a class="code" href="classEquation__base.html#a75697cbd27151fc9efb3032f54509b20">Equation_base::operateur_fonctionnel</a>(i);
<a name="l02525"></a>02525 }
<a name="l02526"></a>02526 
<a name="l02527"></a><a class="code" href="classEquation__base.html#aa20b65412422945c03ef9147390672ae">02527</a> <a class="code" href="classOperateur.html" title="classe Operateur Classe generique de la hierarchie des operateurs. Cette classe generique est particu...">Operateur</a>&amp; <a class="code" href="classEquation__base.html#a75697cbd27151fc9efb3032f54509b20">Equation_base::operateur_fonctionnel</a>(<span class="keywordtype">int</span> i)
<a name="l02528"></a>02528 {
<a name="l02529"></a>02529   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;The method operateur_fonctionnel is not coded for equation &quot;</span>&lt;&lt;<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>()&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l02530"></a>02530   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l02531"></a>02531   <span class="keywordflow">throw</span>;
<a name="l02532"></a>02532   <span class="keywordflow">return</span> <a class="code" href="classEquation__base.html#a75697cbd27151fc9efb3032f54509b20">Equation_base::operateur_fonctionnel</a>(i);
<a name="l02533"></a>02533 }
<a name="l02534"></a>02534 
<a name="l02535"></a><a class="code" href="classEquation__base.html#af8cd02f88b2e9b3fe7f72e32515b8a49">02535</a> <span class="keywordtype">int</span> <a class="code" href="classEquation__base.html#af8cd02f88b2e9b3fe7f72e32515b8a49">Equation_base::nombre_d_operateurs_tot</a>()<span class="keyword"> const</span>
<a name="l02536"></a>02536 <span class="keyword"></span>{
<a name="l02537"></a>02537   <span class="keywordflow">return</span> <a class="code" href="classEquation__base.html#a68cdf54c4af72b23d0d2c8a1b3f7ebd9">nombre_d_operateurs</a>();
<a name="l02538"></a>02538 }
<a name="l02539"></a>02539 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:15 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
