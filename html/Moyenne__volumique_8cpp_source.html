<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/Kernel/Statistiques_temps/Moyenne_volumique.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/Kernel/Statistiques_temps/Moyenne_volumique.cpp</div>  </div>
</div>
<div class="contents">
<a href="Moyenne__volumique_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (c) 2021, CEA</span>
<a name="l00003"></a>00003 <span class="comment">* All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment">* 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00007"></a>00007 <span class="comment">* 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00008"></a>00008 <span class="comment">* 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<a name="l00011"></a>00011 <span class="comment">* IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;</span>
<a name="l00012"></a>00012 <span class="comment">* OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// File:        Moyenne_volumique.cpp</span>
<a name="l00018"></a>00018 <span class="comment">// Directory:   $TRUST_ROOT/src/Kernel/Statistiques_temps</span>
<a name="l00019"></a>00019 <span class="comment">// Version:     /main/14</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;<a class="code" href="Moyenne__volumique_8h.html">Moyenne_volumique.h</a>&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="Param_8h.html">Param.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="Equation__base_8h.html">Equation_base.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="Postraitement_8h.html">Postraitement.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="Zone__VF_8h.html">Zone_VF.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="Ref__Zone__VF_8h.html">Ref_Zone_VF.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="Octree__Double_8h.html">Octree_Double.h</a>&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;<a class="code" href="communications_8h.html">communications.h</a>&gt;</span>
<a name="l00031"></a>00031 
<a name="l00032"></a><a class="code" href="Moyenne__volumique_8cpp.html#a1d6edbdd40708f3dddb3da8fa38ad682">00032</a> <a class="code" href="Op__Diff__CoviMAC__Face_8cpp.html#aa86ec8ba612a969d9b4370b775037144">Implemente_instanciable</a>(<a class="code" href="classMoyenne__volumique.html" title=": cet interprete permet, a la fin du calcul (apres &quot;resoudre&quot;), de calculer et de stocker dans un f...">Moyenne_volumique</a>,<span class="stringliteral">&quot;Moyenne_volumique&quot;</span>,<a class="code" href="classInterprete.html" title="Classe de base des objets &quot;interprete&quot;. Ces objets definissent des actions a realiser lorsqu&#39;on les...">Interprete</a>);
<a name="l00033"></a>00033 
<a name="l00034"></a><a class="code" href="classMoyenne__volumique.html#a0044cbec3bfec4d3d6a662dcf3618334">00034</a> <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classMoyenne__volumique.html#a0044cbec3bfec4d3d6a662dcf3618334" title="Ecriture de l&#39;objet sur un flot de sortie Methode a surcharger.">Moyenne_volumique::printOn</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; s )<span class="keyword"> const</span>
<a name="l00035"></a>00035 <span class="keyword"></span>{
<a name="l00036"></a>00036   <span class="keywordflow">return</span> s &lt;&lt; <a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00037"></a>00037 }
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="comment">//</span>
<a name="l00040"></a>00040 <span class="comment">//</span>
<a name="l00041"></a>00041 <span class="comment">//</span>
<a name="l00042"></a>00042 <span class="comment">//</span>
<a name="l00043"></a>00043 <span class="comment">//</span>
<a name="l00044"></a>00044 <span class="comment">//</span><span class="comment"></span>
<a name="l00045"></a>00045 <span class="comment">//! lecture de la fonction de filtrage.&lt;br&gt;{&lt;br&gt;type BOITE|CHAPEAU|QUADRA|GAUSSIENNE|PARSER&lt;br&gt;demie-largeur L&lt;br&gt;[ omega W ]&lt;br&gt;[ expression FORMULE ]&lt;br&gt;}</span>
<a name="l00046"></a><a class="code" href="classMoyenne__volumique.html#a532019b0893f9b382a123dc6876b35ab">00046</a> <span class="comment"></span><a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classMoyenne__volumique.html#a532019b0893f9b382a123dc6876b35ab" title="lecture de la fonction de filtrage. { type BOITE|CHAPEAU|QUADRA|GAUSSIENNE|PARSER demie-largeur L [ o...">Moyenne_volumique::readOn</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is )
<a name="l00047"></a>00047 {
<a name="l00048"></a>00048   <a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a> = -1;
<a name="l00049"></a>00049   <a class="code" href="classMoyenne__volumique.html#abb6e4de855fc3191749a4c0155ff65e8">expression_parser_</a> = <span class="stringliteral">&quot;??&quot;</span>;
<a name="l00050"></a>00050   <span class="keywordtype">int</span> type;
<a name="l00051"></a>00051   <a class="code" href="classParam.html" title="Defined below in this file.">Param</a> param(<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>());
<a name="l00052"></a>00052   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;type&quot;</span>, &amp; type, <a class="code" href="classParam.html#aa4ad0ca1d49bc5f2ebc5fc83ee9df384aaf5b6dfac1c5970478525407cc6ac572">Param::REQUIRED</a> <span class="comment">/* obligatoire */</span>);
<a name="l00053"></a>00053   param.<a class="code" href="classParam.html#a0d5da6b10afd9ae6e7c98f0836fcb3b0" title="Si le dernier parametre ajoute est de type &quot;int&quot;, associe a ce parametre une ou plusieurs chaines de ...">dictionnaire</a>(<span class="stringliteral">&quot;BOITE&quot;</span>, <a class="code" href="classMoyenne__volumique.html#ad31ca99758c2f72d6ffb157915fb2f0ca0981e3167a7b12bd4250db98275a3e05">BOITE</a>);
<a name="l00054"></a>00054   param.<a class="code" href="classParam.html#a0d5da6b10afd9ae6e7c98f0836fcb3b0" title="Si le dernier parametre ajoute est de type &quot;int&quot;, associe a ce parametre une ou plusieurs chaines de ...">dictionnaire</a>(<span class="stringliteral">&quot;CHAPEAU&quot;</span>, <a class="code" href="classMoyenne__volumique.html#ad31ca99758c2f72d6ffb157915fb2f0caf2f3532c03ed42627991591c29860fdc">CHAPEAU</a>);
<a name="l00055"></a>00055   param.<a class="code" href="classParam.html#a0d5da6b10afd9ae6e7c98f0836fcb3b0" title="Si le dernier parametre ajoute est de type &quot;int&quot;, associe a ce parametre une ou plusieurs chaines de ...">dictionnaire</a>(<span class="stringliteral">&quot;GAUSSIENNE&quot;</span>, <a class="code" href="classMoyenne__volumique.html#ad31ca99758c2f72d6ffb157915fb2f0cafebc314df0e6a5b7842eb190a2015e6d">GAUSSIENNE</a>);
<a name="l00056"></a>00056   param.<a class="code" href="classParam.html#a0d5da6b10afd9ae6e7c98f0836fcb3b0" title="Si le dernier parametre ajoute est de type &quot;int&quot;, associe a ce parametre une ou plusieurs chaines de ...">dictionnaire</a>(<span class="stringliteral">&quot;QUADRA&quot;</span>, <a class="code" href="classMoyenne__volumique.html#ad31ca99758c2f72d6ffb157915fb2f0ca52a3200354cebaecdfa850be8e5f1dcc">QUADRA</a>);
<a name="l00057"></a>00057   param.<a class="code" href="classParam.html#a0d5da6b10afd9ae6e7c98f0836fcb3b0" title="Si le dernier parametre ajoute est de type &quot;int&quot;, associe a ce parametre une ou plusieurs chaines de ...">dictionnaire</a>(<span class="stringliteral">&quot;PARSER&quot;</span>, <a class="code" href="classMoyenne__volumique.html#ad31ca99758c2f72d6ffb157915fb2f0ca015483f4f925dc8da457351494d47b5a">PARSER</a>);
<a name="l00058"></a>00058   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;demie-largeur&quot;</span>, &amp; <a class="code" href="classMoyenne__volumique.html#a9ad73bfe1151ea07b73e25ba83b612ae">box_size_</a>, <a class="code" href="classParam.html#aa4ad0ca1d49bc5f2ebc5fc83ee9df384aaf5b6dfac1c5970478525407cc6ac572">Param::REQUIRED</a> <span class="comment">/* obligatoire */</span>);
<a name="l00059"></a>00059   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;omega&quot;</span>, &amp; <a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a>);
<a name="l00060"></a>00060   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;expression&quot;</span>, &amp; <a class="code" href="classMoyenne__volumique.html#abb6e4de855fc3191749a4c0155ff65e8">expression_parser_</a>);
<a name="l00061"></a>00061   param.<a class="code" href="classParam.html#aa9d44fc51b4a08b357733a97dc7acaad" title="Read the is input with the parameters (defined with the Param object) inside: { ... } Example, to read: { a 1 b 2 } Param param(que_suis_je()); int a,b; param.ajouter(&quot;a&quot;,&amp;a); param.ajouter(&quot;b&quot;,&amp;b); param.lire_avec_accolades_depuis(is);.">lire_avec_accolades_depuis</a>(is);
<a name="l00062"></a>00062   <span class="keywordflow">switch</span>(type)
<a name="l00063"></a>00063     {
<a name="l00064"></a>00064     <span class="keywordflow">case</span> <a class="code" href="classMoyenne__volumique.html#ad31ca99758c2f72d6ffb157915fb2f0ca0981e3167a7b12bd4250db98275a3e05">BOITE</a>:
<a name="l00065"></a>00065       <a class="code" href="classMoyenne__volumique.html#ac8c951eb0b069a5fcd43771f41ed0a5e">type_</a> = <a class="code" href="classMoyenne__volumique.html#ad31ca99758c2f72d6ffb157915fb2f0ca0981e3167a7b12bd4250db98275a3e05">BOITE</a>;
<a name="l00066"></a>00066       <a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a> = <a class="code" href="classMoyenne__volumique.html#a9ad73bfe1151ea07b73e25ba83b612ae">box_size_</a>;
<a name="l00067"></a>00067       <span class="keywordflow">break</span>;
<a name="l00068"></a>00068     <span class="keywordflow">case</span> <a class="code" href="classMoyenne__volumique.html#ad31ca99758c2f72d6ffb157915fb2f0caf2f3532c03ed42627991591c29860fdc">CHAPEAU</a>:
<a name="l00069"></a>00069       <a class="code" href="classMoyenne__volumique.html#ac8c951eb0b069a5fcd43771f41ed0a5e">type_</a> = <a class="code" href="classMoyenne__volumique.html#ad31ca99758c2f72d6ffb157915fb2f0caf2f3532c03ed42627991591c29860fdc">CHAPEAU</a>;
<a name="l00070"></a>00070       <a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a> = <a class="code" href="classMoyenne__volumique.html#a9ad73bfe1151ea07b73e25ba83b612ae">box_size_</a>;
<a name="l00071"></a>00071       <span class="keywordflow">break</span>;
<a name="l00072"></a>00072     <span class="keywordflow">case</span> <a class="code" href="classMoyenne__volumique.html#ad31ca99758c2f72d6ffb157915fb2f0cafebc314df0e6a5b7842eb190a2015e6d">GAUSSIENNE</a>:
<a name="l00073"></a>00073       <a class="code" href="classMoyenne__volumique.html#ac8c951eb0b069a5fcd43771f41ed0a5e">type_</a> = <a class="code" href="classMoyenne__volumique.html#ad31ca99758c2f72d6ffb157915fb2f0cafebc314df0e6a5b7842eb190a2015e6d">GAUSSIENNE</a>;
<a name="l00074"></a>00074       <span class="keywordflow">if</span> (<a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a> &lt; 0.)
<a name="l00075"></a>00075         {
<a name="l00076"></a>00076           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error : OMEGA must be set to &gt;= 0&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00077"></a>00077           <a class="code" href="classProcess.html#aa9e74a5c06a68ea38298a08ea401e7b1" title="Synchronise tous les processeurs du groupe courant&lt;br&gt;(attend que tous les processeurs soient arrives...">barrier</a>();
<a name="l00078"></a>00078           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00079"></a>00079         }
<a name="l00080"></a>00080       <span class="keywordflow">break</span>;
<a name="l00081"></a>00081     <span class="keywordflow">case</span> <a class="code" href="classMoyenne__volumique.html#ad31ca99758c2f72d6ffb157915fb2f0ca015483f4f925dc8da457351494d47b5a">PARSER</a>:
<a name="l00082"></a>00082       <a class="code" href="classMoyenne__volumique.html#ac8c951eb0b069a5fcd43771f41ed0a5e">type_</a> = <a class="code" href="classMoyenne__volumique.html#ad31ca99758c2f72d6ffb157915fb2f0ca015483f4f925dc8da457351494d47b5a">PARSER</a>;
<a name="l00083"></a>00083       <span class="keywordflow">if</span> (<a class="code" href="classMoyenne__volumique.html#abb6e4de855fc3191749a4c0155ff65e8">expression_parser_</a> == <span class="stringliteral">&quot;??&quot;</span>)
<a name="l00084"></a>00084         {
<a name="l00085"></a>00085           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error : EXPRESSION must be specified for the parser.&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00086"></a>00086           <a class="code" href="classProcess.html#aa9e74a5c06a68ea38298a08ea401e7b1" title="Synchronise tous les processeurs du groupe courant&lt;br&gt;(attend que tous les processeurs soient arrives...">barrier</a>();
<a name="l00087"></a>00087           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00088"></a>00088         }
<a name="l00089"></a>00089       {
<a name="l00090"></a>00090         <a class="code" href="classString2.html" title=": class String2 Cette classe encapsule une chaine de caracteres simple. Contrairement a &quot;Nom&quot;...">String2</a> s(<a class="code" href="classMoyenne__volumique.html#abb6e4de855fc3191749a4c0155ff65e8">expression_parser_</a>);
<a name="l00091"></a>00091         <a class="code" href="classMoyenne__volumique.html#accefd662d9bc61693569895cbe71ea50">parser_</a>.<a class="code" href="classParser.html#a4c6c26f213432dee024b97c50eb7387f">setString</a>(s);
<a name="l00092"></a>00092         <a class="code" href="classMoyenne__volumique.html#accefd662d9bc61693569895cbe71ea50">parser_</a>.<a class="code" href="classParser.html#a1d736281fec758c5581a0d7ee7852643">setNbVar</a>(<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">Objet_U::dimension</a>);
<a name="l00093"></a>00093         <a class="code" href="classMoyenne__volumique.html#accefd662d9bc61693569895cbe71ea50">parser_</a>.<a class="code" href="classParser.html#a0f04fd67f90acd8301940430b83154b5">addVar</a>(<span class="stringliteral">&quot;x&quot;</span>);
<a name="l00094"></a>00094         <a class="code" href="classMoyenne__volumique.html#accefd662d9bc61693569895cbe71ea50">parser_</a>.<a class="code" href="classParser.html#a0f04fd67f90acd8301940430b83154b5">addVar</a>(<span class="stringliteral">&quot;y&quot;</span>);
<a name="l00095"></a>00095         <span class="keywordflow">if</span> (<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">Objet_U::dimension</a> == 3)
<a name="l00096"></a>00096           <a class="code" href="classMoyenne__volumique.html#accefd662d9bc61693569895cbe71ea50">parser_</a>.<a class="code" href="classParser.html#a0f04fd67f90acd8301940430b83154b5">addVar</a>(<span class="stringliteral">&quot;z&quot;</span>);
<a name="l00097"></a>00097         <a class="code" href="classMoyenne__volumique.html#accefd662d9bc61693569895cbe71ea50">parser_</a>.<a class="code" href="classParser.html#aeb17e3560dffd7374626ed4577a30a7b">parseString</a>();
<a name="l00098"></a>00098       }
<a name="l00099"></a>00099       <span class="keywordflow">break</span>;
<a name="l00100"></a>00100     <span class="keywordflow">case</span> <a class="code" href="classMoyenne__volumique.html#ad31ca99758c2f72d6ffb157915fb2f0ca52a3200354cebaecdfa850be8e5f1dcc">QUADRA</a>:
<a name="l00101"></a>00101       <a class="code" href="classMoyenne__volumique.html#ac8c951eb0b069a5fcd43771f41ed0a5e">type_</a> = <a class="code" href="classMoyenne__volumique.html#ad31ca99758c2f72d6ffb157915fb2f0ca52a3200354cebaecdfa850be8e5f1dcc">QUADRA</a>;
<a name="l00102"></a>00102       <a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a> = <a class="code" href="classMoyenne__volumique.html#a9ad73bfe1151ea07b73e25ba83b612ae">box_size_</a>;
<a name="l00103"></a>00103       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;l_ = &quot;</span> &lt;&lt; <a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a> &lt;&lt; <span class="stringliteral">&quot;box_size_ = &quot;</span> &lt;&lt; <a class="code" href="classMoyenne__volumique.html#a9ad73bfe1151ea07b73e25ba83b612ae">box_size_</a> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00104"></a>00104       <span class="keywordflow">break</span>;
<a name="l00105"></a>00105     <span class="keywordflow">default</span>:
<a name="l00106"></a>00106       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>(); <span class="comment">//!&lt; Erreur interne !</span>
<a name="l00107"></a>00107 <span class="comment"></span>    }
<a name="l00108"></a>00108 <span class="comment">// Pour que l&#39;octree trouve bien les elements qui sont pile-poil a la limite.</span>
<a name="l00109"></a>00109   <a class="code" href="classMoyenne__volumique.html#a9ad73bfe1151ea07b73e25ba83b612ae">box_size_</a> += <a class="code" href="classObjet__U.html#a7447e25c68cc8d3a1c06cf99f0565cff">precision_geom</a>;
<a name="l00110"></a>00110   <span class="keywordflow">return</span> is;
<a name="l00111"></a>00111 }
<a name="l00112"></a><a class="code" href="Moyenne__volumique_8cpp.html#a7bbd92f8cb4c84a3d304b30755110583">00112</a> <span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="Moyenne__volumique_8cpp.html#a7bbd92f8cb4c84a3d304b30755110583">fonction_quadra</a>(<span class="keywordtype">double</span> x, <span class="keywordtype">double</span> l_)
<a name="l00113"></a>00113 {
<a name="l00114"></a>00114   assert(fabs(x) &lt;= l_);
<a name="l00115"></a>00115   <span class="keywordtype">double</span> ax = 1. - fabs(x) / l_;
<a name="l00116"></a>00116   ax = ax * ax;
<a name="l00117"></a>00117   <span class="keywordflow">if</span> (fabs(x) &lt; (l_/3.))
<a name="l00118"></a>00118     {
<a name="l00119"></a>00119       <span class="keywordtype">double</span> bx = -3. / l_ * fabs(x) + 1.;
<a name="l00120"></a>00120       ax -= bx * bx / 3.; <span class="comment">//!&lt; signifie ax = ax - bx*bx/3</span>
<a name="l00121"></a>00121 <span class="comment"></span>    }
<a name="l00122"></a>00122   <span class="keywordflow">return</span> ax * (27. / (16. * l_));
<a name="l00123"></a>00123 }
<a name="l00124"></a>00124 <span class="comment">//</span><span class="comment"></span>
<a name="l00125"></a>00125 <span class="comment">//! Evalue la fonction filtre en chaque coordonnee coord&lt;br&gt;Methode appelee dans la classe Calcul_integrale_locale</span>
<a name="l00126"></a><a class="code" href="classMoyenne__volumique.html#ae4eee32a01e8adcdc14f083de2e70851">00126</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classMoyenne__volumique.html#ae4eee32a01e8adcdc14f083de2e70851" title="Evalue la fonction filtre en chaque coordonnee coord Methode appelee dans la classe Calcul_integrale_...">Moyenne_volumique::eval_filtre</a>(<span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; coords, <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a>&amp; result)<span class="keyword"> const</span>
<a name="l00127"></a>00127 <span class="keyword"></span>{
<a name="l00128"></a>00128   <span class="keyword">const</span> <span class="keywordtype">int</span> dim = <a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">Objet_U::dimension</a>;
<a name="l00129"></a>00129   assert(dim == coords.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1));
<a name="l00130"></a>00130   <span class="keyword">const</span> <span class="keywordtype">int</span> n = coords.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00131"></a>00131   assert(result.<a class="code" href="classArrOfDouble.html#a3c3b33bea0e88b87315c21ee94bee05f" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>() == n);
<a name="l00132"></a>00132   <span class="keywordflow">switch</span>(<a class="code" href="classMoyenne__volumique.html#ac8c951eb0b069a5fcd43771f41ed0a5e">type_</a>)
<a name="l00133"></a>00133     {
<a name="l00134"></a>00134     <span class="keywordflow">case</span> <a class="code" href="classMoyenne__volumique.html#ad31ca99758c2f72d6ffb157915fb2f0ca015483f4f925dc8da457351494d47b5a">PARSER</a>:
<a name="l00135"></a>00135       {
<a name="l00136"></a>00136         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
<a name="l00137"></a>00137           {
<a name="l00138"></a>00138             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; dim; j++)
<a name="l00139"></a>00139               <a class="code" href="classMoyenne__volumique.html#accefd662d9bc61693569895cbe71ea50">parser_</a>.<a class="code" href="classParser.html#a6d3f980837939c3464960034a0c280fc">setVar</a>(j, coords(i,j));
<a name="l00140"></a>00140             result[i] = <a class="code" href="classMoyenne__volumique.html#accefd662d9bc61693569895cbe71ea50">parser_</a>.<a class="code" href="classParser.html#ab239c68e7987963005bc131b7db294cf">eval</a>();
<a name="l00141"></a>00141           }
<a name="l00142"></a>00142         <span class="keywordflow">break</span>;
<a name="l00143"></a>00143       }
<a name="l00144"></a>00144     <span class="keywordflow">case</span> <a class="code" href="classMoyenne__volumique.html#ad31ca99758c2f72d6ffb157915fb2f0ca0981e3167a7b12bd4250db98275a3e05">BOITE</a>:
<a name="l00145"></a>00145       {
<a name="l00146"></a>00146         <span class="keywordtype">double</span> facteur = 0.;
<a name="l00147"></a>00147         <span class="keywordflow">if</span> (dim == 2)
<a name="l00148"></a>00148           facteur = 1. / (<a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a> * <a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a> * 4.);
<a name="l00149"></a>00149         <span class="keywordflow">else</span>
<a name="l00150"></a>00150           facteur = 1. / (<a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a> * <a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a> * <a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a> * 8.);
<a name="l00151"></a>00151 
<a name="l00152"></a>00152         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
<a name="l00153"></a>00153           {
<a name="l00154"></a>00154             <span class="keyword">const</span> <span class="keywordtype">double</span> x = coords(i,0);
<a name="l00155"></a>00155             <span class="keyword">const</span> <span class="keywordtype">double</span> y = coords(i,1);
<a name="l00156"></a>00156             <span class="keyword">const</span> <span class="keywordtype">double</span> z = (dim==3) ? coords(i,2) : 0.;
<a name="l00157"></a>00157             <span class="keywordtype">double</span> r = facteur;
<a name="l00158"></a>00158             <span class="keywordflow">if</span> (x &gt; <a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a> || x &lt; -<a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a>
<a name="l00159"></a>00159                 || y &gt; <a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a> || y &lt; -<a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a>
<a name="l00160"></a>00160                 || z &gt; <a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a> || z &lt; -<a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a>)
<a name="l00161"></a>00161               r = 0.;
<a name="l00162"></a>00162             result[i] = r;
<a name="l00163"></a>00163           }
<a name="l00164"></a>00164         <span class="keywordflow">break</span>;
<a name="l00165"></a>00165       }
<a name="l00166"></a>00166     <span class="keywordflow">case</span> <a class="code" href="classMoyenne__volumique.html#ad31ca99758c2f72d6ffb157915fb2f0caf2f3532c03ed42627991591c29860fdc">CHAPEAU</a>:
<a name="l00167"></a>00167       {
<a name="l00168"></a>00168         <span class="keyword">const</span> <span class="keywordtype">double</span> L2D = <a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a>*<a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a>*<a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a>*<a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a>;
<a name="l00169"></a>00169         <span class="keyword">const</span> <span class="keywordtype">double</span> L3D = L2D*l_*<a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a>;
<a name="l00170"></a>00170         <span class="keywordtype">double</span> facteur;
<a name="l00171"></a>00171         <span class="keywordflow">if</span> (dim==3)
<a name="l00172"></a>00172           facteur = 1. / L3D;
<a name="l00173"></a>00173         <span class="keywordflow">else</span>
<a name="l00174"></a>00174           facteur = 1. / (L2D * <a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a>);
<a name="l00175"></a>00175         <span class="keyword">const</span> <span class="keywordtype">int</span> nbis = coords.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00176"></a>00176         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nbis; i++)
<a name="l00177"></a>00177           {
<a name="l00178"></a>00178             <span class="keyword">const</span> <span class="keywordtype">double</span> x = coords(i, 0);
<a name="l00179"></a>00179             <span class="keyword">const</span> <span class="keywordtype">double</span> y = coords(i, 1);
<a name="l00180"></a>00180             <span class="keyword">const</span> <span class="keywordtype">double</span> z = (dim == 3) ? coords(i, 2) : 0.;
<a name="l00181"></a>00181             <span class="keywordtype">double</span> resu = 0.;
<a name="l00182"></a>00182             <span class="keyword">const</span> <span class="keywordtype">double</span> ax = <a class="code" href="Double_8h.html#aaecd4ca8a2fe69cc6568af2938b94d2e">dabs</a>(x);
<a name="l00183"></a>00183             <span class="keyword">const</span> <span class="keywordtype">double</span> ay = <a class="code" href="Double_8h.html#aaecd4ca8a2fe69cc6568af2938b94d2e">dabs</a>(y);
<a name="l00184"></a>00184             <span class="keyword">const</span> <span class="keywordtype">double</span> az = <a class="code" href="Double_8h.html#aaecd4ca8a2fe69cc6568af2938b94d2e">dabs</a>(z);
<a name="l00185"></a>00185             <span class="keywordflow">if</span> (ax &lt;= l_ &amp;&amp; ay &lt;= l_ &amp;&amp; az &lt;= l_)
<a name="l00186"></a>00186               resu = (l_-ax) * (l_-ay) * (l_-az) * facteur;
<a name="l00187"></a>00187             result[i] = resu;
<a name="l00188"></a>00188           }
<a name="l00189"></a>00189         <span class="keywordflow">break</span>;
<a name="l00190"></a>00190       }
<a name="l00191"></a>00191     <span class="keywordflow">case</span> <a class="code" href="classMoyenne__volumique.html#ad31ca99758c2f72d6ffb157915fb2f0cafebc314df0e6a5b7842eb190a2015e6d">GAUSSIENNE</a>:
<a name="l00192"></a>00192       {
<a name="l00193"></a>00193         <span class="keywordtype">double</span> facteur1 = - 0.5 / (<a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a> * <a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a>);
<a name="l00194"></a>00194         <span class="keywordtype">double</span> facteur2 = 1. / (<a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a> * sqrt(2 * <a class="code" href="Double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>));
<a name="l00195"></a>00195         <span class="keywordflow">if</span> (dim == 2)
<a name="l00196"></a>00196           facteur2 = facteur2 * facteur2;
<a name="l00197"></a>00197         <span class="keywordflow">else</span>
<a name="l00198"></a>00198           facteur2 = facteur2 * facteur2 * facteur2;
<a name="l00199"></a>00199         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
<a name="l00200"></a>00200           {
<a name="l00201"></a>00201             <span class="keyword">const</span> <span class="keywordtype">double</span> x = coords(i, 0);
<a name="l00202"></a>00202             <span class="keyword">const</span> <span class="keywordtype">double</span> y = coords(i, 1);
<a name="l00203"></a>00203             <span class="keyword">const</span> <span class="keywordtype">double</span> z = (dim == 3) ? coords(i, 2) : 0.;
<a name="l00204"></a>00204             <span class="keyword">const</span> <span class="keywordtype">double</span> k = (x*x + y*y + z*z) * facteur1;
<a name="l00205"></a>00205             result[i] = exp(k) * facteur2;
<a name="l00206"></a>00206           }
<a name="l00207"></a>00207         <span class="keywordflow">break</span>;
<a name="l00208"></a>00208       }
<a name="l00209"></a>00209     <span class="keywordflow">case</span> <a class="code" href="classMoyenne__volumique.html#ad31ca99758c2f72d6ffb157915fb2f0ca52a3200354cebaecdfa850be8e5f1dcc">QUADRA</a>:
<a name="l00210"></a>00210       {
<a name="l00211"></a>00211         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
<a name="l00212"></a>00212           {
<a name="l00213"></a>00213             <span class="keyword">const</span> <span class="keywordtype">double</span> x = coords(i, 0);
<a name="l00214"></a>00214             <span class="keyword">const</span> <span class="keywordtype">double</span> y = coords(i, 1);
<a name="l00215"></a>00215             <span class="keyword">const</span> <span class="keywordtype">double</span> z = (dim == 3) ? coords(i, 2) : 0.;
<a name="l00216"></a>00216             <span class="keywordtype">double</span> resu = 0;
<a name="l00217"></a>00217             <span class="keywordflow">if</span> (fabs(x) &lt; <a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a> &amp;&amp; fabs(y) &lt; <a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a> &amp;&amp; fabs(z) &lt; <a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a>)
<a name="l00218"></a>00218               {
<a name="l00219"></a>00219                 resu = <a class="code" href="Moyenne__volumique_8cpp.html#a7bbd92f8cb4c84a3d304b30755110583">fonction_quadra</a>(x,<a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a>) * <a class="code" href="Moyenne__volumique_8cpp.html#a7bbd92f8cb4c84a3d304b30755110583">fonction_quadra</a>(y,<a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a>);
<a name="l00220"></a>00220                 <span class="keywordflow">if</span> (dim == 3)
<a name="l00221"></a>00221                   resu *= <a class="code" href="Moyenne__volumique_8cpp.html#a7bbd92f8cb4c84a3d304b30755110583">fonction_quadra</a>(z,<a class="code" href="classMoyenne__volumique.html#a5c38f38b7c99c36367600fb6e244781e">l_</a>);
<a name="l00222"></a>00222               }
<a name="l00223"></a>00223             result[i] = resu;
<a name="l00224"></a>00224           }
<a name="l00225"></a>00225         <span class="keywordflow">break</span>;
<a name="l00226"></a>00226       }
<a name="l00227"></a>00227     <span class="keywordflow">default</span>:
<a name="l00228"></a>00228       {
<a name="l00229"></a>00229         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Moyenne_volumique::eval() : filter function is not initialized.&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00230"></a>00230         <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00231"></a>00231       }
<a name="l00232"></a>00232     }
<a name="l00233"></a>00233 }
<a name="l00234"></a>00234 
<a name="l00235"></a>00235 <span class="comment">//</span>
<a name="l00236"></a>00236 <span class="comment">//</span>
<a name="l00237"></a>00237 <span class="comment">//</span><span class="comment"></span>
<a name="l00238"></a>00238 <span class="comment">//! Cherche le champ de nom &quot;nom_champ&quot; dans le probleme de nom &quot;nom_pb&quot;&lt;br&gt;dans les objers de l&#39;interprete.&lt;br&gt;Methode appelee par traiter_champs()</span>
<a name="l00239"></a><a class="code" href="classMoyenne__volumique.html#a8fd4dae403feedf80eace246d9633ebf">00239</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="classMoyenne__volumique.html#a8fd4dae403feedf80eace246d9633ebf" title="Cherche le champ de nom &quot;nom_champ&quot; dans le probleme de nom &quot;nom_pb&quot; dans les objers de l&#39;interpr...">Moyenne_volumique::get_champ</a>(<span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; nom_pb,
<a name="l00240"></a>00240                                  <span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; nom_champ,
<a name="l00241"></a>00241                                  <a class="code" href="Ref_8h.html#aab5720a5c34da14028d0745e386aaa01">REF</a>(<a class="code" href="classChamp__base.html" title="classe Champ_base Cette classe est la base de la hierarchie des champs. Ses membres sont les attribut...">Champ_base</a>) &amp; ref_champ)
<a name="l00242"></a>00242 {
<a name="l00243"></a>00243   <a class="code" href="classProbleme__base.html" title="classe Probleme_base C&#39;est un Probleme_U qui n&#39;est pas un couplage. Le role d&#39;un Probleme_base est la...">Probleme_base</a>&amp; pb = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classProbleme__base.html" title="classe Probleme_base C&#39;est un Probleme_U qui n&#39;est pas un couplage. Le role d&#39;un Probleme_base est la...">Probleme_base</a>, <a class="code" href="classInterprete.html#a3ca248609f0b72eac68baca14621b4ee" title="Voir Interprete_bloc::objet_global() BM: la classe Interprete n&#39;est pas le meilleur endroit pour cett...">objet</a>(nom_pb));
<a name="l00244"></a>00244 <span class="comment">// Le champ est-il defini dans les postraitements (statistiques) ?</span>
<a name="l00245"></a>00245   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_post = pb.<a class="code" href="classProbleme__base.html#a6e1ac01728ed55a4fac04cbcbeb69169">postraitements</a>().<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>();
<a name="l00246"></a>00246   <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> mc_nom_champ(nom_champ);
<a name="l00247"></a>00247   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_post = 0; i_post &lt; nb_post; i_post++)
<a name="l00248"></a>00248     {
<a name="l00249"></a>00249       <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classPostraitement__base.html" title="Classe de base pour l&#39;ensemble des postraitements.">Postraitement_base</a>, pb.<a class="code" href="classProbleme__base.html#a6e1ac01728ed55a4fac04cbcbeb69169">postraitements</a>()[i_post].<a class="code" href="classList__Deriv__Postraitement__base.html#aa2f5f81518386d54eb940482d326edb1" title="Retourne l&#39;Objet_U associe a la cellule de la liste.">valeur</a>()))
<a name="l00250"></a>00250         {
<a name="l00251"></a>00251           <a class="code" href="classPostraitement.html" title="classe Postraitement La classe est dotee -d une liste de champs generiques champs_post_complet_ qui c...">Postraitement</a>&amp; post = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classPostraitement.html" title="classe Postraitement La classe est dotee -d une liste de champs generiques champs_post_complet_ qui c...">Postraitement</a>, pb.<a class="code" href="classProbleme__base.html#a6e1ac01728ed55a4fac04cbcbeb69169">postraitements</a>()[i_post].<a class="code" href="classList__Deriv__Postraitement__base.html#aa2f5f81518386d54eb940482d326edb1" title="Retourne l&#39;Objet_U associe a la cellule de la liste.">valeur</a>());
<a name="l00252"></a>00252           <a class="code" href="classOperateurs__Statistique__tps.html" title="classe Operateurs_Statistique_tps Cette classe represente une liste d&#39;operateurs statistiques en temp...">Operateurs_Statistique_tps</a>&amp; stats = post.<a class="code" href="classPostraitement.html#a11d6af85f0afec19b280fc4269493a79">les_statistiques</a>();
<a name="l00253"></a>00253           <span class="keyword">const</span> <span class="keywordtype">int</span> nstat = stats.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>();
<a name="l00254"></a>00254           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_stat = 0; i_stat &lt; nstat; i_stat++)
<a name="l00255"></a>00255             {
<a name="l00256"></a>00256               <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> tmp(stats[i_stat].<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>().<a class="code" href="classObjet__U.html#a70413a8785d36bf5105fced1c89d0d2b" title="Donne le nom de l&#39;Objet_U Methode a surcharger : renvoie &quot;neant&quot; dans cette implementation.">le_nom</a>() );
<a name="l00257"></a>00257 
<a name="l00258"></a>00258               <span class="keywordflow">if</span> (tmp == mc_nom_champ)
<a name="l00259"></a>00259                 {
<a name="l00260"></a>00260                   <a class="code" href="classOperateur__Statistique__tps__base.html" title="classe Operateur_Statistique_tps_base Represente des operations statistiques sur les champs...">Operateur_Statistique_tps_base</a>&amp; stat = stats[i_stat].valeur();
<a name="l00261"></a>00261                   <a class="code" href="Cast_8h.html#ad3836a067c92103af8df5ad8f35959a6">ref_cast_non_const</a>(<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>, stat.<a class="code" href="classOperateur__Statistique__tps__base.html#a61e03d21a2eb62396b5fe526096f7bc7">integrale</a>().<a class="code" href="classChamp__Fonc.html#a60b75eadb0987d488884e24fcb72d1e5" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs du champ.">valeurs</a>()) = stat.<a class="code" href="classOperateur__Statistique__tps__base.html#a11f0a948e3dad48c3a4844cfea25cbc7">calculer_valeurs</a>();
<a name="l00262"></a>00262                   ref_champ = stat.<a class="code" href="classOperateur__Statistique__tps__base.html#a61e03d21a2eb62396b5fe526096f7bc7">integrale</a>();
<a name="l00263"></a>00263                   <span class="keywordflow">return</span> 1;
<a name="l00264"></a>00264                 }
<a name="l00265"></a>00265             }
<a name="l00266"></a>00266         }
<a name="l00267"></a>00267     }
<a name="l00268"></a>00268 
<a name="l00269"></a>00269   ref_champ = pb.<a class="code" href="classProbleme__base.html#acc8deeeb73b31eaa3d0ecd4f9644ba77">get_champ</a>(nom_champ);
<a name="l00270"></a>00270   <span class="keywordflow">return</span> 1;
<a name="l00271"></a>00271 }
<a name="l00272"></a>00272 
<a name="l00273"></a>00273 <span class="comment">//</span>
<a name="l00274"></a>00274 <span class="comment">//</span>
<a name="l00275"></a>00275 <span class="comment">//</span>
<a name="l00276"></a>00276 <span class="comment">//</span><span class="comment"></span>
<a name="l00277"></a>00277 <span class="comment">//! fonction outil permettant de faire les calculs et d&#39;ecrire le resultat&lt;br&gt;dans un fichier lata pour tous les champs d&#39;un type donne de la liste noms_champs.&lt;br&gt;Methode appelee par interpreter()&lt;br&gt;type_champ=0 =&gt; traiter les champs aux elements&lt;br&gt;type_champ=1 =&gt; traiter les champs aux faces</span>
<a name="l00278"></a><a class="code" href="classMoyenne__volumique.html#a90bfeff9ae2cc5ff5242b21478e4289d">00278</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classMoyenne__volumique.html#a90bfeff9ae2cc5ff5242b21478e4289d" title="fonction outil permettant de faire les calculs et d&#39;ecrire le resultat dans un fichier lata pour tous...">Moyenne_volumique::traiter_champs</a>(<span class="keyword">const</span> <a class="code" href="classMotcles.html" title="Un tableau d&#39;objets de la classe Motcle.">Motcles</a>&amp; noms_champs,
<a name="l00279"></a>00279                                        <span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; nom_pb, <span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; nom_dom,
<a name="l00280"></a>00280                                        <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; coords,
<a name="l00281"></a>00281                                        <a class="code" href="classFormat__Post__base.html" title="Classe de base des formats de postraitements pour les champs&lt;br&gt;(lata, med, lml, meshtv). Utilisation de la classe par l&#39;interface generique: -typer un objet format de postraitement -initialiser l objet format de postraitement -proceder a des operations de complement et verification -ecrire un domaine -ecrire_temps -ecrire_champ (un type de champ supporte: aux elements ou aux sommets, ou encore aux faces si on a ecrit les faces du domaine et si les faces sont supportees par le postraitement)">Format_Post_base</a>&amp; post,
<a name="l00282"></a>00282                                        <span class="keywordtype">double</span> temps,
<a name="l00283"></a>00283                                        <span class="keyword">const</span> <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>&amp; localisation)
<a name="l00284"></a>00284 {
<a name="l00285"></a>00285   <span class="keyword">const</span> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom_post = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>, <a class="code" href="classInterprete.html#a3ca248609f0b72eac68baca14621b4ee" title="Voir Interprete_bloc::objet_global() BM: la classe Interprete n&#39;est pas le meilleur endroit pour cett...">objet</a>(nom_dom));
<a name="l00286"></a>00286   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_champs = noms_champs.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>();
<a name="l00287"></a>00287   <span class="keywordflow">if</span> (nb_champs == 0)
<a name="l00288"></a>00288     <span class="keywordflow">return</span>;
<a name="l00289"></a>00289 
<a name="l00290"></a>00290   <a class="code" href="Ref_8h.html#aab5720a5c34da14028d0745e386aaa01">REF</a>(<a class="code" href="classChamp__base.html" title="classe Champ_base Cette classe est la base de la hierarchie des champs. Ses membres sont les attribut...">Champ_base</a>) ref_champ;
<a name="l00291"></a>00291   <a class="code" href="Ref_8h.html#aab5720a5c34da14028d0745e386aaa01">REF</a>(<a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>) ref_zone_vf;
<a name="l00292"></a>00292   <span class="keywordtype">int</span> i_champ;
<a name="l00293"></a>00293 <span class="comment">// ************************************</span>
<a name="l00294"></a>00294 <span class="comment">// Calcul du nombre total de composantes et de ref_zone_vf</span>
<a name="l00295"></a>00295   <span class="keywordtype">int</span> nb_compo_tot = 0;
<a name="l00296"></a>00296   <span class="keywordflow">for</span> (i_champ = 0; i_champ &lt; nb_champs; i_champ++)
<a name="l00297"></a>00297     {
<a name="l00298"></a>00298       <a class="code" href="classMoyenne__volumique.html#a8fd4dae403feedf80eace246d9633ebf" title="Cherche le champ de nom &quot;nom_champ&quot; dans le probleme de nom &quot;nom_pb&quot; dans les objers de l&#39;interpr...">get_champ</a>(nom_pb, noms_champs[i_champ], ref_champ);
<a name="l00299"></a>00299       <span class="keyword">const</span> <a class="code" href="classChamp__base.html" title="classe Champ_base Cette classe est la base de la hierarchie des champs. Ses membres sont les attribut...">Champ_base</a>&amp; champ = ref_champ.valeur();
<a name="l00300"></a>00300       <span class="keyword">const</span> <a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>&amp; zvf = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>, champ.<a class="code" href="classChamp__base.html#a298ee24f3efdf2f60f39a13966a20bcd">zone_dis_base</a>());
<a name="l00301"></a>00301       <span class="keywordflow">if</span> (i_champ == 0)
<a name="l00302"></a>00302         {
<a name="l00303"></a>00303           ref_zone_vf = zvf;
<a name="l00304"></a>00304         }
<a name="l00305"></a>00305       <span class="keywordflow">else</span>
<a name="l00306"></a>00306         {
<a name="l00307"></a>00307           <span class="keywordflow">if</span> (&amp; (ref_zone_vf.valeur()) != &amp; zvf)
<a name="l00308"></a>00308             {
<a name="l00309"></a>00309               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Moyenne_volumique::traiter_champs all the fields must be discretized on the same Zone.&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00310"></a>00310               <a class="code" href="classProcess.html#aa9e74a5c06a68ea38298a08ea401e7b1" title="Synchronise tous les processeurs du groupe courant&lt;br&gt;(attend que tous les processeurs soient arrives...">barrier</a>();
<a name="l00311"></a>00311               <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00312"></a>00312             }
<a name="l00313"></a>00313         }
<a name="l00314"></a>00314       <span class="keyword">const</span> <span class="keywordtype">int</span> nb_compo = champ.<a class="code" href="classField__base.html#a16e3abfebaaf9b7ef83acb936c872a91" title="Renvoie le nombre de composantes du champ.">nb_comp</a>();
<a name="l00315"></a>00315       nb_compo_tot += nb_compo;
<a name="l00316"></a>00316     }
<a name="l00317"></a>00317 
<a name="l00318"></a>00318   <span class="keyword">const</span> <a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>&amp; zone_source = ref_zone_vf.valeur();
<a name="l00319"></a>00319 
<a name="l00320"></a>00320 <span class="comment">// ************************************</span>
<a name="l00321"></a>00321 <span class="comment">// Construction d&#39;un gros tableau contenant toutes les valeurs a traiter plus la porosite</span>
<a name="l00322"></a>00322   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> valeurs_src;
<a name="l00323"></a>00323   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_lignes = zone_source.<a class="code" href="classZone__dis__base.html#a790cb2f6bc2928518799e748313d0eb3">nb_elem</a>();
<a name="l00324"></a>00324   valeurs_src.<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(nb_lignes, nb_compo_tot + 1);
<a name="l00325"></a>00325   <span class="keywordtype">int</span> count = 0;
<a name="l00326"></a>00326   {
<a name="l00327"></a>00327     <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> tmp_val;
<a name="l00328"></a>00328     <a class="code" href="classIntVect.html">IntVect</a> liste_elems(nb_lignes);
<a name="l00329"></a>00329     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_lignes; i++)
<a name="l00330"></a>00330       liste_elems[i] = i;
<a name="l00331"></a>00331     <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; xp = zone_source.<a class="code" href="classZone__VF.html#a87a29f0223c71256a25ee343c9277599">xp</a>();
<a name="l00332"></a>00332     <span class="keywordflow">for</span> (i_champ = 0; i_champ &lt; nb_champs; i_champ++)
<a name="l00333"></a>00333       {
<a name="l00334"></a>00334         <a class="code" href="classMoyenne__volumique.html#a8fd4dae403feedf80eace246d9633ebf" title="Cherche le champ de nom &quot;nom_champ&quot; dans le probleme de nom &quot;nom_pb&quot; dans les objers de l&#39;interpr...">get_champ</a>(nom_pb, noms_champs[i_champ], ref_champ);
<a name="l00335"></a>00335         <span class="keyword">const</span> <a class="code" href="classChamp__base.html" title="classe Champ_base Cette classe est la base de la hierarchie des champs. Ses membres sont les attribut...">Champ_base</a>&amp; champ = ref_champ.valeur();
<a name="l00336"></a>00336         <span class="keyword">const</span> <span class="keywordtype">int</span> nb_compo = champ.<a class="code" href="classField__base.html#a16e3abfebaaf9b7ef83acb936c872a91" title="Renvoie le nombre de composantes du champ.">nb_comp</a>();
<a name="l00337"></a>00337         tmp_val.<a class="code" href="classDoubleTab.html#acb465ae8c9b24990db18002693b42dea" title="met le tableau dans l&#39;etat obtenu par le constructeur par defaut voir DoubleVect::reset()">reset</a>();
<a name="l00338"></a>00338         tmp_val.<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(nb_lignes, nb_compo);
<a name="l00339"></a>00339         champ.<a class="code" href="classChamp__base.html#a43eede56d800b44980b8534a1845c9a5" title="provoque une erreur ! doit etre surchargee par les classes derivees non virtuelle pure par commodite ...">valeur_aux_elems</a>(xp, liste_elems, tmp_val);
<a name="l00340"></a>00340 
<a name="l00341"></a>00341         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_lignes; i++)
<a name="l00342"></a>00342           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; nb_compo; j++)
<a name="l00343"></a>00343             valeurs_src(i, count+j) = tmp_val(i, j);
<a name="l00344"></a>00344         count += nb_compo;
<a name="l00345"></a>00345 
<a name="l00346"></a>00346         <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;Field name = &quot;</span> &lt;&lt; ref_champ-&gt;le_nom()
<a name="l00347"></a>00347              &lt;&lt; <span class="stringliteral">&quot; Field type = &quot;</span> &lt;&lt; ref_champ-&gt;que_suis_je() &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00348"></a>00348       }
<a name="l00349"></a>00349   }
<a name="l00350"></a>00350 <span class="comment">// et une colonne de 1:</span>
<a name="l00351"></a>00351   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_lignes; i++)
<a name="l00352"></a>00352     valeurs_src(i, count) = 1.;
<a name="l00353"></a>00353 
<a name="l00354"></a>00354 <span class="comment">// Tableau de resultats:</span>
<a name="l00355"></a>00355   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_coords = coords.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00356"></a>00356   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> resu(nb_coords, nb_compo_tot + 1);
<a name="l00357"></a>00357 
<a name="l00358"></a>00358 <span class="comment">// ************************************</span>
<a name="l00359"></a>00359 <span class="comment">// Calcul de tous les produits de convolution</span>
<a name="l00360"></a>00360 
<a name="l00361"></a>00361   <a class="code" href="classMoyenne__volumique.html#ab718ee00f503b157834828bdc624759d" title="Calcule le produit de convolution entre la fonction filtre et le champ &quot;champ_source&quot; qui doit etre...">calculer_convolution_champ_elem</a>(zone_source,
<a name="l00362"></a>00362                                   valeurs_src,
<a name="l00363"></a>00363                                   coords,
<a name="l00364"></a>00364                                   resu);
<a name="l00365"></a>00365   <a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a> nom_dir;
<a name="l00366"></a>00366   nom_dir.<a class="code" href="classVect__Nom.html#ae20c0d0842c00756c1a2610fe0ca471f">add</a>(<span class="stringliteral">&quot;_X&quot;</span>);
<a name="l00367"></a>00367   nom_dir.<a class="code" href="classVect__Nom.html#ae20c0d0842c00756c1a2610fe0ca471f">add</a>(<span class="stringliteral">&quot;_Y&quot;</span>);
<a name="l00368"></a>00368   nom_dir.<a class="code" href="classVect__Nom.html#ae20c0d0842c00756c1a2610fe0ca471f">add</a>(<span class="stringliteral">&quot;_Z&quot;</span>);
<a name="l00369"></a>00369   count = 0;
<a name="l00370"></a>00370   <span class="keywordflow">for</span> (i_champ = 0; i_champ &lt; nb_champs; i_champ++)
<a name="l00371"></a>00371     {
<a name="l00372"></a>00372       <a class="code" href="classMoyenne__volumique.html#a8fd4dae403feedf80eace246d9633ebf" title="Cherche le champ de nom &quot;nom_champ&quot; dans le probleme de nom &quot;nom_pb&quot; dans les objers de l&#39;interpr...">get_champ</a>(nom_pb, noms_champs[i_champ], ref_champ);
<a name="l00373"></a>00373       <span class="keyword">const</span> <a class="code" href="classChamp__base.html" title="classe Champ_base Cette classe est la base de la hierarchie des champs. Ses membres sont les attribut...">Champ_base</a>&amp; champ = ref_champ.valeur();
<a name="l00374"></a>00374       <span class="keyword">const</span> <span class="keywordtype">int</span> nb_compo = champ.<a class="code" href="classField__base.html#a16e3abfebaaf9b7ef83acb936c872a91" title="Renvoie le nombre de composantes du champ.">nb_comp</a>();
<a name="l00375"></a>00375       <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> extrait(nb_coords, nb_compo);
<a name="l00376"></a>00376       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_coords; i++)
<a name="l00377"></a>00377         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; nb_compo; j++)
<a name="l00378"></a>00378           extrait(i, j) = resu(i, count + j);
<a name="l00379"></a>00379 
<a name="l00380"></a>00380       <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;Post writting &quot;</span> &lt;&lt; champ.<a class="code" href="classField__base.html#ae1377124eabe8387aced762115b062bb" title="Renvoie le nom du champ.">le_nom</a>() &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00381"></a>00381       <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> nature(<span class="stringliteral">&quot;scalar&quot;</span>);
<a name="l00382"></a>00382       <span class="keywordflow">if</span> (champ.<a class="code" href="classField__base.html#a75bf4e0a6258589a83801c0383d049cc" title="Renvoie la nature d&#39;un champ (scalaire, multiscalaire, vectoriel).">nature_du_champ</a>()==<a class="code" href="Field__base_8h.html#a1b86c8f670a9b34da7f628a821fb646ba66d795f4e2fbb5636a3966c73964c5e7">vectoriel</a>) nature=<span class="stringliteral">&quot;vector&quot;</span>;
<a name="l00383"></a>00383       post.<a class="code" href="classFormat__Post__base.html#a3786a17f1ffe0b632fa03635e3befde4" title="Ecriture d&#39;un champ dans le fichier de postraitement. Parametre: id_du_champ Signification: identifia...">ecrire_champ</a>(dom_post,
<a name="l00384"></a>00384                         champ.<a class="code" href="classField__base.html#a330a88315c089f823664a7676bd55498" title="Renvoie les unites des composantes du champ.">unites</a>(),
<a name="l00385"></a>00385                         champ.<a class="code" href="classField__base.html#a365a59232bd2d53d4869e5103ca558d1" title="Renvoie le tableau des noms des composantes du champ.">noms_compo</a>(),
<a name="l00386"></a>00386                         -1 <span class="comment">/* ecrire toutes les composantes */</span>, temps, temps,
<a name="l00387"></a>00387                         noms_champs[i_champ], nom_dom, localisation,nature, extrait);
<a name="l00388"></a>00388 
<a name="l00389"></a>00389       count += nb_compo;
<a name="l00390"></a>00390     }
<a name="l00391"></a>00391 <span class="comment">// Derniere colonne (porosite)</span>
<a name="l00392"></a>00392   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_compo = 1;
<a name="l00393"></a>00393   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> extrait(nb_coords, nb_compo);
<a name="l00394"></a>00394   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_coords; i++)
<a name="l00395"></a>00395     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; nb_compo; j++)
<a name="l00396"></a>00396       extrait(i, j) = resu(i, count + j);
<a name="l00397"></a>00397 
<a name="l00398"></a>00398   <a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a> noms_compo;
<a name="l00399"></a>00399   <a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a> unites;
<a name="l00400"></a>00400   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> nom_moyenne;
<a name="l00401"></a>00401   unites.<a class="code" href="classVect__Nom.html#ae20c0d0842c00756c1a2610fe0ca471f">add</a>(<span class="stringliteral">&quot;m3&quot;</span>);
<a name="l00402"></a>00402   noms_compo.<a class="code" href="classVect__Nom.html#ae20c0d0842c00756c1a2610fe0ca471f">add</a>(<span class="stringliteral">&quot;porosite&quot;</span>);
<a name="l00403"></a>00403   nom_moyenne = <span class="stringliteral">&quot;porosite&quot;</span>;
<a name="l00404"></a>00404   <a class="code" href="EntreeSortie_8h.html#a1007c2f57f1c8fc7334a3f62aab08414">Cout</a> &lt;&lt; <span class="stringliteral">&quot;Porosity post writing&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00405"></a>00405 
<a name="l00406"></a>00406   post.<a class="code" href="classFormat__Post__base.html#a3786a17f1ffe0b632fa03635e3befde4" title="Ecriture d&#39;un champ dans le fichier de postraitement. Parametre: id_du_champ Signification: identifia...">ecrire_champ</a>(dom_post, unites, noms_compo, -1 <span class="comment">/* ecrire toutes les composantes */</span>,
<a name="l00407"></a>00407                     temps, temps,
<a name="l00408"></a>00408                     nom_moyenne, nom_dom, localisation, <span class="stringliteral">&quot;scalar&quot;</span>,extrait);
<a name="l00409"></a>00409 }
<a name="l00410"></a>00410 
<a name="l00411"></a>00411 <span class="comment">//</span>
<a name="l00412"></a>00412 <span class="comment">//</span>
<a name="l00413"></a>00413 <span class="comment">//</span>
<a name="l00414"></a>00414 <span class="comment">//</span>
<a name="l00415"></a>00415 <span class="comment">//</span>
<a name="l00416"></a>00416 <span class="comment">//</span>
<a name="l00417"></a>00417 <span class="comment">//</span>
<a name="l00418"></a>00418 <span class="comment">//</span>
<a name="l00419"></a>00419 <span class="comment">//</span>
<a name="l00420"></a>00420 <span class="comment">//</span>
<a name="l00421"></a>00421 <span class="comment">//</span><span class="comment"></span>
<a name="l00422"></a>00422 <span class="comment">//! Lecture des parametres dans le jeu de donnees. Format attendu:&lt;br&gt;Moyenne_volumique {&lt;br&gt;nom_pb NOM_DU_PROBLEME    (ou chercher les champs sources)&lt;br&gt;nom_domaine DOMAINE_CIBLE (on evalue la convolution aux elements de ce domaine)&lt;br&gt;noms_champs N CHAMP1 CHAMP2 ... (noms des champs a filtrer dans le probleme)&lt;br&gt;[ nom_fichier_post NOM_SANS_EXTENSION ] (soit on donne nom_fichier et format_post,&lt;br&gt;soit on donne fichier_post)&lt;br&gt;[ format_post lata|meshtv|lml|med|... ] (par defaut lata)&lt;br&gt;[ fichier_post Format_Post_XXX { ... } ] (lecture par readOn du Format_Post_XXX)&lt;br&gt;fonction_filtre ...  (format : voir Moyenne_volumique::readOn() )&lt;br&gt;[ localisation ELEM|SOM ]&lt;br&gt;}</span>
<a name="l00423"></a><a class="code" href="classMoyenne__volumique.html#a9c7b96a12142172c05890b0732e32dbd">00423</a> <span class="comment"></span><a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classMoyenne__volumique.html#a9c7b96a12142172c05890b0732e32dbd" title="Lecture des parametres dans le jeu de donnees. Format attendu: Moyenne_volumique { nom_pb NOM_DU_PROB...">Moyenne_volumique::interpreter</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00424"></a>00424 {
<a name="l00425"></a>00425   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Starting of Moyenne_volumique::interpreter&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00426"></a>00426   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> nom_pb, nom_dom;
<a name="l00427"></a>00427   <a class="code" href="classMotcles.html" title="Un tableau d&#39;objets de la classe Motcle.">Motcles</a> noms_champs;
<a name="l00428"></a>00428   <a class="code" href="classParam.html" title="Defined below in this file.">Param</a> param(<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() + <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(<span class="stringliteral">&quot;::interpreter()&quot;</span>));
<a name="l00429"></a>00429   <span class="keyword">const</span> <span class="keywordtype">int</span> id_elem = 0;
<a name="l00430"></a>00430   <span class="keyword">const</span> <span class="keywordtype">int</span> id_som = 1;
<a name="l00431"></a>00431   <span class="keywordtype">int</span> localisation = id_elem; <span class="comment">//!&lt; par defaut</span>
<a name="l00432"></a>00432 <span class="comment"></span>  <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> format_post(<span class="stringliteral">&quot;lata_v1&quot;</span>);
<a name="l00433"></a>00433   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> nom_fichier_post;
<a name="l00434"></a>00434   <a class="code" href="Deriv_8h.html#a4b39337b42cbf2fddeba7868ced6f860" title="Soit une classe Type_base qui derive de Objet_U. DERIV(T) est une petite classe contenant un pointeur...">DERIV</a>(<a class="code" href="classFormat__Post__base.html" title="Classe de base des formats de postraitements pour les champs&lt;br&gt;(lata, med, lml, meshtv). Utilisation de la classe par l&#39;interface generique: -typer un objet format de postraitement -initialiser l objet format de postraitement -proceder a des operations de complement et verification -ecrire un domaine -ecrire_temps -ecrire_champ (un type de champ supporte: aux elements ou aux sommets, ou encore aux faces si on a ecrit les faces du domaine et si les faces sont supportees par le postraitement)">Format_Post_base</a>) fichier_post;
<a name="l00435"></a>00435   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;nom_pb&quot;</span>, &amp; nom_pb, <a class="code" href="classParam.html#aa4ad0ca1d49bc5f2ebc5fc83ee9df384aaf5b6dfac1c5970478525407cc6ac572">Param::REQUIRED</a>);
<a name="l00436"></a>00436   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;nom_domaine&quot;</span>, &amp; nom_dom, <a class="code" href="classParam.html#aa4ad0ca1d49bc5f2ebc5fc83ee9df384aaf5b6dfac1c5970478525407cc6ac572">Param::REQUIRED</a>);
<a name="l00437"></a>00437   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;noms_champs&quot;</span>, &amp; noms_champs, <a class="code" href="classParam.html#aa4ad0ca1d49bc5f2ebc5fc83ee9df384aaf5b6dfac1c5970478525407cc6ac572">Param::REQUIRED</a>);
<a name="l00438"></a>00438   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;fichier_post&quot;</span>, &amp; fichier_post);
<a name="l00439"></a>00439   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;format_post&quot;</span>, &amp; format_post);
<a name="l00440"></a>00440   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;nom_fichier_post&quot;</span>, &amp; nom_fichier_post);
<a name="l00441"></a>00441 <span class="comment">// L&#39;objet Moyenne_volumique est un interprete, mais c&#39;est aussi un objet</span>
<a name="l00442"></a>00442 <span class="comment">// dont la seule propriete est la fonction filtre a utiliser... astuce:</span>
<a name="l00443"></a>00443 <span class="comment">// on appelle le readOn de la classe pour lire la fonction filtre.</span>
<a name="l00444"></a>00444   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;fonction_filtre&quot;</span>, <span class="keyword">this</span>, <a class="code" href="classParam.html#aa4ad0ca1d49bc5f2ebc5fc83ee9df384aaf5b6dfac1c5970478525407cc6ac572">Param::REQUIRED</a>);
<a name="l00445"></a>00445   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;localisation&quot;</span>, &amp; localisation);
<a name="l00446"></a>00446   param.<a class="code" href="classParam.html#a0d5da6b10afd9ae6e7c98f0836fcb3b0" title="Si le dernier parametre ajoute est de type &quot;int&quot;, associe a ce parametre une ou plusieurs chaines de ...">dictionnaire</a>(<span class="stringliteral">&quot;ELEM&quot;</span>, id_elem);
<a name="l00447"></a>00447   param.<a class="code" href="classParam.html#a0d5da6b10afd9ae6e7c98f0836fcb3b0" title="Si le dernier parametre ajoute est de type &quot;int&quot;, associe a ce parametre une ou plusieurs chaines de ...">dictionnaire</a>(<span class="stringliteral">&quot;SOM&quot;</span>, id_som);
<a name="l00448"></a>00448   param.<a class="code" href="classParam.html#aa9d44fc51b4a08b357733a97dc7acaad" title="Read the is input with the parameters (defined with the Param object) inside: { ... } Example, to read: { a 1 b 2 } Param param(que_suis_je()); int a,b; param.ajouter(&quot;a&quot;,&amp;a); param.ajouter(&quot;b&quot;,&amp;b); param.lire_avec_accolades_depuis(is);.">lire_avec_accolades_depuis</a>(is);
<a name="l00449"></a>00449 
<a name="l00450"></a>00450 <span class="comment">// on recupere le domaine</span>
<a name="l00451"></a>00451   <span class="keyword">const</span> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>, <a class="code" href="classInterprete.html#a3ca248609f0b72eac68baca14621b4ee" title="Voir Interprete_bloc::objet_global() BM: la classe Interprete n&#39;est pas le meilleur endroit pour cett...">objet</a>(nom_dom));
<a name="l00452"></a>00452   <span class="keywordflow">if</span> (noms_champs.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>() == 0)
<a name="l00453"></a>00453     {
<a name="l00454"></a>00454       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Moyenne_volumique : no field to treat&quot;</span> &lt;&lt; finl;
<a name="l00455"></a>00455       <span class="keywordflow">return</span> is;
<a name="l00456"></a>00456     }
<a name="l00457"></a>00457   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Writing of the post-processing domain : &quot;</span> &lt;&lt; nom_dom &lt;&lt; finl;
<a name="l00458"></a>00458   <a class="code" href="Ref_8h.html#aab5720a5c34da14028d0745e386aaa01">REF</a>(<a class="code" href="classChamp__base.html" title="classe Champ_base Cette classe est la base de la hierarchie des champs. Ses membres sont les attribut...">Champ_base</a>) ref_champ;
<a name="l00459"></a>00459   <a class="code" href="classMoyenne__volumique.html#a8fd4dae403feedf80eace246d9633ebf" title="Cherche le champ de nom &quot;nom_champ&quot; dans le probleme de nom &quot;nom_pb&quot; dans les objers de l&#39;interpr...">get_champ</a>(nom_pb, noms_champs[0], ref_champ);
<a name="l00460"></a>00460   <span class="keyword">const</span> <span class="keywordtype">double</span> temps = ref_champ.valeur().temps();
<a name="l00461"></a>00461   <span class="keywordflow">if</span> (!fichier_post.non_nul())
<a name="l00462"></a>00462     {
<a name="l00463"></a>00463       <span class="keywordflow">if</span> (nom_fichier_post == <span class="stringliteral">&quot;??&quot;</span>)
<a name="l00464"></a>00464         {
<a name="l00465"></a>00465           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Moyenne_volumique::interpreter:\n&quot;</span>
<a name="l00466"></a>00466                &lt;&lt; <span class="stringliteral">&quot; missing NOM_FICHIER_POST or FICHIER_POST keyword&quot;</span> &lt;&lt; finl;
<a name="l00467"></a>00467           <a class="code" href="classProcess.html#aa9e74a5c06a68ea38298a08ea401e7b1" title="Synchronise tous les processeurs du groupe courant&lt;br&gt;(attend que tous les processeurs soient arrives...">barrier</a>();
<a name="l00468"></a>00468           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00469"></a>00469         }
<a name="l00470"></a>00470       <span class="keywordflow">if</span> (format_post == <span class="stringliteral">&quot;lata&quot;</span>)
<a name="l00471"></a>00471         format_post = <span class="stringliteral">&quot;lata_v1&quot;</span>;
<a name="l00472"></a>00472 <span class="comment">// Astuce pour permettre le cas test de non regression en sequentiel et en parallele:</span>
<a name="l00473"></a>00473 <span class="comment">// (il faut que le nom du fichier de sortie soit le nom du cas)</span>
<a name="l00474"></a>00474       <span class="keywordflow">if</span> (nom_fichier_post == <span class="stringliteral">&quot;NOM_DU_CAS&quot;</span>)
<a name="l00475"></a>00475         {
<a name="l00476"></a>00476           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Post filename = NOM_DU_CAS =&gt; using &quot;</span> &lt;&lt; <a class="code" href="classObjet__U.html#a7c27c4f80259eeef76ff8fe2d3bc61f7" title="Renvoie une reference constante vers le nom du cas. Cette methode est statique.">nom_du_cas</a>() &lt;&lt; <span class="stringliteral">&quot; instead&quot;</span> &lt;&lt; finl;
<a name="l00477"></a>00477           nom_fichier_post = <a class="code" href="classObjet__U.html#a7c27c4f80259eeef76ff8fe2d3bc61f7" title="Renvoie une reference constante vers le nom du cas. Cette methode est statique.">nom_du_cas</a>();
<a name="l00478"></a>00478         }
<a name="l00479"></a>00479       fichier_post.typer(<a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a>(<span class="stringliteral">&quot;FORMAT_POST_&quot;</span>) + format_post);
<a name="l00480"></a>00480       fichier_post.valeur().initialize(nom_fichier_post, 1 <span class="comment">/* binaire */</span>, <span class="stringliteral">&quot;SIMPLE&quot;</span>);
<a name="l00481"></a>00481     }
<a name="l00482"></a>00482   <span class="keywordflow">else</span>
<a name="l00483"></a>00483     {
<a name="l00484"></a>00484       <span class="keywordflow">if</span> (nom_fichier_post != <span class="stringliteral">&quot;??&quot;</span>)
<a name="l00485"></a>00485         {
<a name="l00486"></a>00486           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Moyenne_volumique::interpreter:\n&quot;</span>
<a name="l00487"></a>00487                &lt;&lt; <span class="stringliteral">&quot; you cannot give NOM_FICHIER_POST and FICHIER_POST. Choose one&quot;</span> &lt;&lt; finl;
<a name="l00488"></a>00488           <a class="code" href="classProcess.html#aa9e74a5c06a68ea38298a08ea401e7b1" title="Synchronise tous les processeurs du groupe courant&lt;br&gt;(attend que tous les processeurs soient arrives...">barrier</a>();
<a name="l00489"></a>00489           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00490"></a>00490         }
<a name="l00491"></a>00491     }
<a name="l00492"></a>00492   <a class="code" href="classFormat__Post__base.html" title="Classe de base des formats de postraitements pour les champs&lt;br&gt;(lata, med, lml, meshtv). Utilisation de la classe par l&#39;interface generique: -typer un objet format de postraitement -initialiser l objet format de postraitement -proceder a des operations de complement et verification -ecrire un domaine -ecrire_temps -ecrire_champ (un type de champ supporte: aux elements ou aux sommets, ou encore aux faces si on a ecrit les faces du domaine et si les faces sont supportees par le postraitement)">Format_Post_base</a>&amp; post = fichier_post.valeur();
<a name="l00493"></a>00493   post.<a class="code" href="classFormat__Post__base.html#ae11c6023d377a665c55e082fcd5ca28e">ecrire_entete</a>(temps, 0 <span class="comment">/*reprise*/</span>, 1 <span class="comment">/* premier post */</span>);
<a name="l00494"></a>00494   post.<a class="code" href="classFormat__Post__base.html#abf7c0bcdd173cc18ec268949ab9df893" title="Ecriture d&#39;un maillage. L&#39;ecriture du domaine a lieu soit au debut, avant le premier appel a ecrire_t...">ecrire_domaine</a>(dom, 1 <span class="comment">/* premier_post */</span>);
<a name="l00495"></a>00495   post.<a class="code" href="classFormat__Post__base.html#a6f85911c85685f7a2d5563885ac1cfd9" title="Commence l&#39;ecriture d&#39;un pas de temps. La classe derivee doit accepter de recevoir plusieurs appels c...">ecrire_temps</a>(temps);
<a name="l00496"></a>00496 
<a name="l00497"></a>00497 <span class="comment">// Coordonnees des centres des elements du domaine destination</span>
<a name="l00498"></a>00498   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> coords;
<a name="l00499"></a>00499   <span class="keywordflow">if</span> (localisation == id_elem)
<a name="l00500"></a>00500     {
<a name="l00501"></a>00501       dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#ad8104f9be27f9c357e345b281a79064e" title="Calcule les centres de gravites des elements de la zone.">calculer_centres_gravite</a>(coords);
<a name="l00502"></a>00502 <span class="comment">// Le tableau contient aussi les elements virtuels et pas d&#39;espace virtuel. bouh.</span>
<a name="l00503"></a>00503       coords.<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(dom.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a7f249429803b27139a1c54436f6164a5" title="Renvoie le nombre d&#39;elements de la zone.">nb_elem</a>(), coords.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1));
<a name="l00504"></a>00504     }
<a name="l00505"></a>00505   <span class="keywordflow">else</span>
<a name="l00506"></a>00506     {
<a name="l00507"></a>00507       coords = dom.<a class="code" href="classDomaine.html#a0846ac03a10b65c4df911fe35a19c02f" title="Renvoie le nombre total de sommets.">les_sommets</a>();
<a name="l00508"></a>00508     }
<a name="l00509"></a>00509 
<a name="l00510"></a>00510   <a class="code" href="classMotcle.html" title="Une chaine de caractere (Nom) en majuscules.">Motcle</a> loc(<span class="stringliteral">&quot;ELEM&quot;</span>);
<a name="l00511"></a>00511   <span class="keywordflow">if</span> (localisation == id_som)
<a name="l00512"></a>00512     loc = <span class="stringliteral">&quot;SOM&quot;</span>;
<a name="l00513"></a>00513   <a class="code" href="classMoyenne__volumique.html#a90bfeff9ae2cc5ff5242b21478e4289d" title="fonction outil permettant de faire les calculs et d&#39;ecrire le resultat dans un fichier lata pour tous...">traiter_champs</a>(noms_champs,
<a name="l00514"></a>00514                  nom_pb,
<a name="l00515"></a>00515                  nom_dom,
<a name="l00516"></a>00516                  coords,
<a name="l00517"></a>00517                  post,
<a name="l00518"></a>00518                  temps,
<a name="l00519"></a>00519                  loc);
<a name="l00520"></a>00520   <span class="keywordtype">int</span> fin=1;
<a name="l00521"></a>00521   post.<a class="code" href="classFormat__Post__base.html#a621bd94fa673c47fe7e0ca44d8416c52">finir</a>(fin);
<a name="l00522"></a>00522   <span class="keywordflow">return</span> is;
<a name="l00523"></a>00523 }
<a name="l00524"></a>00524 <span class="comment"></span>
<a name="l00525"></a>00525 <span class="comment">//! : classe outil utilisee en interne dans calculer_convolution()</span>
<a name="l00526"></a><a class="code" href="classCalcul__integrale__locale.html">00526</a> <span class="comment"></span><span class="keyword">class </span><a class="code" href="classCalcul__integrale__locale.html" title=": classe outil utilisee en interne dans calculer_convolution()">Calcul_integrale_locale</a>
<a name="l00527"></a>00527 {
<a name="l00528"></a>00528 <span class="keyword">public</span>:
<a name="l00529"></a>00529   <a class="code" href="classCalcul__integrale__locale.html#aeeb362cf1bce0706f05f7ee5557478e7" title="constructeur de la classe outil... Voir Moyenne_volumique::calculer_convolution()">Calcul_integrale_locale</a>(<span class="keyword">const</span> <a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>&amp; zone_source,
<a name="l00530"></a>00530                           <span class="keyword">const</span> <a class="code" href="classMoyenne__volumique.html" title=": cet interprete permet, a la fin du calcul (apres &quot;resoudre&quot;), de calculer et de stocker dans un f...">Moyenne_volumique</a>&amp; filter,
<a name="l00531"></a>00531                           <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; champ_source);
<a name="l00532"></a>00532   <span class="keywordtype">void</span> <a class="code" href="classCalcul__integrale__locale.html#a3b4e91c13082f21cf5b4c05b2a999985" title="evalue le produit de convolution &quot;filter_ * champ_source_&quot; au point x,y,z et stocke le resultat dans ...">calculer</a>(<span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y, <span class="keywordtype">double</span> z, <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a>&amp; resu);
<a name="l00533"></a>00533 
<a name="l00534"></a>00534 <span class="keyword">protected</span>:
<a name="l00535"></a><a class="code" href="classCalcul__integrale__locale.html#a9a84d9d405f486110d72fdeec556f734">00535</a>   <span class="keyword">const</span> <a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>&amp; <a class="code" href="classCalcul__integrale__locale.html#a9a84d9d405f486110d72fdeec556f734">zone_source_</a>;
<a name="l00536"></a><a class="code" href="classCalcul__integrale__locale.html#aa72674115eeee116161c3e53c9c5306b">00536</a>   <a class="code" href="classOctree__Double.html" title=": Un octree permettant de chercher dans l&#39;espace des elements ou des points decrits par des coordonne...">Octree_Double</a> <a class="code" href="classCalcul__integrale__locale.html#aa72674115eeee116161c3e53c9c5306b">octree_</a>;
<a name="l00537"></a><a class="code" href="classCalcul__integrale__locale.html#a465ec85d7e88b0e5ea979f1881326dbf">00537</a>   <span class="keyword">const</span> <a class="code" href="classMoyenne__volumique.html" title=": cet interprete permet, a la fin du calcul (apres &quot;resoudre&quot;), de calculer et de stocker dans un f...">Moyenne_volumique</a>&amp; <a class="code" href="classCalcul__integrale__locale.html#a465ec85d7e88b0e5ea979f1881326dbf">filter_</a>;
<a name="l00538"></a><a class="code" href="classCalcul__integrale__locale.html#a2f21b881502672fb2ee4d7dcc04afcfb">00538</a>   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; <a class="code" href="classCalcul__integrale__locale.html#a2f21b881502672fb2ee4d7dcc04afcfb">champ_source_</a>;
<a name="l00539"></a>00539 <span class="comment">// Tableaux temporaires utilises dans calculer():</span>
<a name="l00540"></a><a class="code" href="classCalcul__integrale__locale.html#a0e2cb55d4c68362adc1ecbcbfa70c865">00540</a>   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> <a class="code" href="classCalcul__integrale__locale.html#a0e2cb55d4c68362adc1ecbcbfa70c865">liste_elems_</a>;
<a name="l00541"></a><a class="code" href="classCalcul__integrale__locale.html#a1dcca786af7c269b26634f3871f42caf">00541</a>   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> <a class="code" href="classCalcul__integrale__locale.html#a1dcca786af7c269b26634f3871f42caf">filter_coords_</a>;
<a name="l00542"></a><a class="code" href="classCalcul__integrale__locale.html#a6441e11c6777774afa583a5f64a71390">00542</a>   <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> <a class="code" href="classCalcul__integrale__locale.html#a6441e11c6777774afa583a5f64a71390">filter_results_</a>;
<a name="l00543"></a><a class="code" href="classCalcul__integrale__locale.html#a4be601a82b6f6af06cce7a5c234410f4">00543</a>   <span class="keywordtype">int</span> <a class="code" href="classCalcul__integrale__locale.html#a4be601a82b6f6af06cce7a5c234410f4">nb_items_reels_</a>;
<a name="l00544"></a>00544 };
<a name="l00545"></a>00545 
<a name="l00546"></a>00546 <span class="comment">//</span><span class="comment"></span>
<a name="l00547"></a>00547 <span class="comment">//! constructeur de la classe outil...&lt;br&gt;Voir Moyenne_volumique::calculer_convolution()</span>
<a name="l00548"></a><a class="code" href="classCalcul__integrale__locale.html#aeeb362cf1bce0706f05f7ee5557478e7">00548</a> <span class="comment"></span><a class="code" href="classCalcul__integrale__locale.html#aeeb362cf1bce0706f05f7ee5557478e7" title="constructeur de la classe outil... Voir Moyenne_volumique::calculer_convolution()">Calcul_integrale_locale::Calcul_integrale_locale</a>(<span class="keyword">const</span> <a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>&amp; zone_source,
<a name="l00549"></a>00549                                                  <span class="keyword">const</span> <a class="code" href="classMoyenne__volumique.html" title=": cet interprete permet, a la fin du calcul (apres &quot;resoudre&quot;), de calculer et de stocker dans un f...">Moyenne_volumique</a>&amp; filter,
<a name="l00550"></a>00550                                                  <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; champ_source) :
<a name="l00551"></a>00551   zone_source_(zone_source),
<a name="l00552"></a>00552   filter_(filter),
<a name="l00553"></a>00553   champ_source_(champ_source)
<a name="l00554"></a>00554 {
<a name="l00555"></a>00555   <a class="code" href="classCalcul__integrale__locale.html#a0e2cb55d4c68362adc1ecbcbfa70c865">liste_elems_</a>.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00556"></a>00556   <a class="code" href="classCalcul__integrale__locale.html#a1dcca786af7c269b26634f3871f42caf">filter_coords_</a>.<a class="code" href="classArrOfDouble.html#ab49f6cae96be9d3f597468d8a53b67b6" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00557"></a>00557   <a class="code" href="classCalcul__integrale__locale.html#a6441e11c6777774afa583a5f64a71390">filter_results_</a>.<a class="code" href="classArrOfDouble.html#ab49f6cae96be9d3f597468d8a53b67b6" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00558"></a>00558 <span class="comment">// Construction d&#39;un octree contenant les centres des elements</span>
<a name="l00559"></a>00559 <span class="comment">// On copie le tableau car il sera retaille :</span>
<a name="l00560"></a>00560   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> coords = zone_source.<a class="code" href="classZone__VF.html#a87a29f0223c71256a25ee343c9277599">xp</a>();
<a name="l00561"></a>00561   <a class="code" href="classCalcul__integrale__locale.html#a4be601a82b6f6af06cce7a5c234410f4">nb_items_reels_</a> = zone_source.<a class="code" href="classZone__dis__base.html#a790cb2f6bc2928518799e748313d0eb3">nb_elem</a>();
<a name="l00562"></a>00562 <span class="comment">// Le tableau xp est dimensionne avec dimension(0)=nb_elem_tot. On le retaille a nb_elem</span>
<a name="l00563"></a>00563   coords.<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(<a class="code" href="classCalcul__integrale__locale.html#a4be601a82b6f6af06cce7a5c234410f4">nb_items_reels_</a>, coords.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1));
<a name="l00564"></a>00564   <span class="keywordflow">if</span> (champ_source.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0) != <a class="code" href="classCalcul__integrale__locale.html#a4be601a82b6f6af06cce7a5c234410f4">nb_items_reels_</a>)
<a name="l00565"></a>00565     {
<a name="l00566"></a>00566       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Calcul_integrale_locale::Calcul_integrale_locale() :\n&quot;</span>
<a name="l00567"></a>00567            &lt;&lt; <span class="stringliteral">&quot; The source field is not discretized at the elements&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00568"></a>00568       <a class="code" href="classProcess.html#aa9e74a5c06a68ea38298a08ea401e7b1" title="Synchronise tous les processeurs du groupe courant&lt;br&gt;(attend que tous les processeurs soient arrives...">Process::barrier</a>();
<a name="l00569"></a>00569       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00570"></a>00570     }
<a name="l00571"></a>00571   <a class="code" href="classCalcul__integrale__locale.html#aa72674115eeee116161c3e53c9c5306b">octree_</a>.<a class="code" href="classOctree__Double.html#a0b66bd315e7f45a024695b6a2764e7d4" title="construit un octree contenant les points de coordonnees coords. Si include_virtual=1, on stocke coords.dimension_tot(0) elements, sinon on en stocke coords.dimension(0) Si epsilon = 0, on construit un octree de points de taille nulle (chaque point se trouve dans un seul octree_floor) Sinon, on construit un octree d&#39;elements cubiques centres sur les coords, de demie-largeur epsilon. Un point peut alors se trouver dans plusieurs octree_floor.">build_nodes</a>(coords, 0 <span class="comment">/* no virtual items */</span>);
<a name="l00572"></a>00572 }
<a name="l00573"></a>00573 
<a name="l00574"></a>00574 <span class="comment">//</span>
<a name="l00575"></a>00575 <span class="comment">//</span>
<a name="l00576"></a>00576 <span class="comment">//</span>
<a name="l00577"></a>00577 <span class="comment">//</span><span class="comment"></span>
<a name="l00578"></a>00578 <span class="comment">//! evalue le produit de convolution &quot;filter_ * champ_source_&quot; au point x,y,z&lt;br&gt;et stocke le resultat dans resu. On determine les elements a utiliser en fonction&lt;br&gt;de la taille du filtre en utilisant une octree.&lt;br&gt;On suppose que le champ source est aux elements.&lt;br&gt;Methode appelee par Moyenne_volumique::calculer_convolution()</span>
<a name="l00579"></a><a class="code" href="classCalcul__integrale__locale.html#a3b4e91c13082f21cf5b4c05b2a999985">00579</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classCalcul__integrale__locale.html#a3b4e91c13082f21cf5b4c05b2a999985" title="evalue le produit de convolution &quot;filter_ * champ_source_&quot; au point x,y,z et stocke le resultat dans ...">Calcul_integrale_locale::calculer</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> x, <span class="keyword">const</span> <span class="keywordtype">double</span> y, <span class="keyword">const</span> <span class="keywordtype">double</span> z,
<a name="l00580"></a>00580                                        <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a>&amp; resu)
<a name="l00581"></a>00581 {
<a name="l00582"></a>00582   <span class="keyword">const</span> <span class="keywordtype">double</span> box_size = <a class="code" href="classCalcul__integrale__locale.html#a465ec85d7e88b0e5ea979f1881326dbf">filter_</a>.<a class="code" href="classMoyenne__volumique.html#afce6ee9cdff619575ae54566677b4dca">box_size</a>();
<a name="l00583"></a>00583   <a class="code" href="classCalcul__integrale__locale.html#aa72674115eeee116161c3e53c9c5306b">octree_</a>.<a class="code" href="classOctree__Double.html#a1dffcace51ca06cb52ff6e2330ab4b2e" title="cherche tous les elements ou points ayant potentiellement une intersection non vide avec la boite don...">search_elements_box</a>(x - box_size, y - box_size, z - box_size,
<a name="l00584"></a>00584                               x + box_size, y + box_size, z + box_size,
<a name="l00585"></a>00585                               <a class="code" href="classCalcul__integrale__locale.html#a0e2cb55d4c68362adc1ecbcbfa70c865">liste_elems_</a>);
<a name="l00586"></a>00586 
<a name="l00587"></a>00587   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; coord_items = <a class="code" href="classCalcul__integrale__locale.html#a9a84d9d405f486110d72fdeec556f734">zone_source_</a>.<a class="code" href="classZone__VF.html#a87a29f0223c71256a25ee343c9277599">xp</a>();
<a name="l00588"></a>00588 
<a name="l00589"></a>00589   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_items = <a class="code" href="classCalcul__integrale__locale.html#a0e2cb55d4c68362adc1ecbcbfa70c865">liste_elems_</a>.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00590"></a>00590   <span class="keyword">const</span> <span class="keywordtype">int</span> dim = <a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">Objet_U::dimension</a>;
<a name="l00591"></a>00591   <span class="keyword">const</span> <span class="keywordtype">int</span> dim3 = (dim == 3);
<a name="l00592"></a>00592   <a class="code" href="classCalcul__integrale__locale.html#a1dcca786af7c269b26634f3871f42caf">filter_coords_</a>.<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(nb_items, dim);
<a name="l00593"></a>00593   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_items; i++)
<a name="l00594"></a>00594     {
<a name="l00595"></a>00595       <span class="keyword">const</span> <span class="keywordtype">int</span> item = <a class="code" href="classCalcul__integrale__locale.html#a0e2cb55d4c68362adc1ecbcbfa70c865">liste_elems_</a>[i];
<a name="l00596"></a>00596       assert(item &lt; <a class="code" href="classCalcul__integrale__locale.html#a4be601a82b6f6af06cce7a5c234410f4">nb_items_reels_</a>);
<a name="l00597"></a>00597       <a class="code" href="classCalcul__integrale__locale.html#a1dcca786af7c269b26634f3871f42caf">filter_coords_</a>(i, 0) = coord_items(item, 0) - x;
<a name="l00598"></a>00598       <a class="code" href="classCalcul__integrale__locale.html#a1dcca786af7c269b26634f3871f42caf">filter_coords_</a>(i, 1) = coord_items(item, 1) - y;
<a name="l00599"></a>00599       <span class="keywordflow">if</span> (dim3)
<a name="l00600"></a>00600         <a class="code" href="classCalcul__integrale__locale.html#a1dcca786af7c269b26634f3871f42caf">filter_coords_</a>(i, 2) = coord_items(item, 2) - z;
<a name="l00601"></a>00601     }
<a name="l00602"></a>00602   <a class="code" href="classCalcul__integrale__locale.html#a6441e11c6777774afa583a5f64a71390">filter_results_</a>.<a class="code" href="classArrOfDouble.html#a610464f4b3dccac6f814915b526783ed">resize_array</a>(nb_items);
<a name="l00603"></a>00603   <a class="code" href="classCalcul__integrale__locale.html#a465ec85d7e88b0e5ea979f1881326dbf">filter_</a>.<a class="code" href="classMoyenne__volumique.html#ae4eee32a01e8adcdc14f083de2e70851" title="Evalue la fonction filtre en chaque coordonnee coord Methode appelee dans la classe Calcul_integrale_...">eval_filtre</a>(<a class="code" href="classCalcul__integrale__locale.html#a1dcca786af7c269b26634f3871f42caf">filter_coords_</a>, <a class="code" href="classCalcul__integrale__locale.html#a6441e11c6777774afa583a5f64a71390">filter_results_</a>);
<a name="l00604"></a>00604 
<a name="l00605"></a>00605   <span class="keyword">const</span> <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; volumes = <a class="code" href="classCalcul__integrale__locale.html#a9a84d9d405f486110d72fdeec556f734">zone_source_</a>.<a class="code" href="classZone__VF.html#aea771c835e561469d2d21dbca5fac1cf" title="renvoie le volume de la maille i.">volumes</a>();
<a name="l00606"></a>00606   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_comp = <a class="code" href="classCalcul__integrale__locale.html#a2f21b881502672fb2ee4d7dcc04afcfb">champ_source_</a>.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1);
<a name="l00607"></a>00607   resu = 0.;
<a name="l00608"></a>00608   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nb_items; i++)
<a name="l00609"></a>00609     {
<a name="l00610"></a>00610       <span class="keyword">const</span> <span class="keywordtype">int</span> item = <a class="code" href="classCalcul__integrale__locale.html#a0e2cb55d4c68362adc1ecbcbfa70c865">liste_elems_</a>[i];
<a name="l00611"></a>00611       <span class="keyword">const</span> <span class="keywordtype">double</span> valeur_filtre = <a class="code" href="classCalcul__integrale__locale.html#a6441e11c6777774afa583a5f64a71390">filter_results_</a>[i];
<a name="l00612"></a>00612       <span class="keyword">const</span> <span class="keywordtype">double</span> volume = volumes(item);
<a name="l00613"></a>00613       <span class="keyword">const</span> <span class="keywordtype">double</span> facteur = valeur_filtre * volume;
<a name="l00614"></a>00614       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; nb_comp; j++)
<a name="l00615"></a>00615         {
<a name="l00616"></a>00616 <span class="comment">// L&#39;integrale est discretisee grossierement comme le produit des</span>
<a name="l00617"></a>00617 <span class="comment">// valeurs au centre de l&#39;element fois le volume de l&#39;element:</span>
<a name="l00618"></a>00618           <span class="keyword">const</span> <span class="keywordtype">double</span> valeur_champ = <a class="code" href="classCalcul__integrale__locale.html#a2f21b881502672fb2ee4d7dcc04afcfb">champ_source_</a>(item, j);
<a name="l00619"></a>00619           resu[j] += valeur_champ * facteur;
<a name="l00620"></a>00620         }
<a name="l00621"></a>00621     }
<a name="l00622"></a>00622 }
<a name="l00623"></a>00623 
<a name="l00624"></a>00624 <span class="comment">//</span>
<a name="l00625"></a>00625 <span class="comment">//</span><span class="comment"></span>
<a name="l00626"></a>00626 <span class="comment">//! methode generale pour calculer une convolution a partir d&#39;un&lt;br&gt;champ aux elements ou aux faces. Methode appelee par calculer_convolution_champ_elem()&lt;br&gt;et calculer_convolution_champ_face()</span>
<a name="l00627"></a><a class="code" href="classMoyenne__volumique.html#a951a03608a0407f0ac7e20a9ebfea38e">00627</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classMoyenne__volumique.html#a951a03608a0407f0ac7e20a9ebfea38e" title="methode generale pour calculer une convolution a partir d&#39;un champ aux elements ou aux faces...">Moyenne_volumique::calculer_convolution</a>(<span class="keyword">const</span> <a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>&amp; zone_source,
<a name="l00628"></a>00628                                              <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; champ_source,
<a name="l00629"></a>00629                                              <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; coords_to_compute,
<a name="l00630"></a>00630                                              <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; resu)<span class="keyword"> const</span>
<a name="l00631"></a>00631 <span class="keyword"></span>{
<a name="l00632"></a>00632   assert(resu.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0) == coords_to_compute.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0));
<a name="l00633"></a>00633   <span class="keyword">const</span> <span class="keywordtype">int</span> dim = <a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">Objet_U::dimension</a>;
<a name="l00634"></a>00634   <span class="keyword">const</span> <span class="keywordtype">int</span> nbproc = <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l00635"></a>00635   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_coords_to_compute = coords_to_compute.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00636"></a>00636   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_coords_max =<a class="code" href="classProcess.html#a1e9d9f9899b71927cfafae14c7bd048d" title="Calcule le max de x sur tous les processeurs du groupe courant. Remarques : Cette methode doit etre a..."> ::mp_max</a>(nb_coords_to_compute);
<a name="l00637"></a>00637 
<a name="l00638"></a>00638   <span class="keywordtype">int</span> nb_comp;
<a name="l00639"></a>00639   nb_comp = champ_source.<a class="code" href="classDoubleVect.html#ab02d01cd1bdab66fbd66f9a47cc29e10">line_size</a>();
<a name="l00640"></a>00640   assert(resu.<a class="code" href="classDoubleVect.html#ab02d01cd1bdab66fbd66f9a47cc29e10">line_size</a>() == nb_comp);
<a name="l00641"></a>00641 
<a name="l00642"></a>00642   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> coords(nbproc, 3);
<a name="l00643"></a>00643   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> flag(nbproc);
<a name="l00644"></a>00644   <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> resu_partiel(nb_comp);
<a name="l00645"></a>00645   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> resu_partiels(nbproc, nb_comp);
<a name="l00646"></a>00646 
<a name="l00647"></a>00647   <a class="code" href="classCalcul__integrale__locale.html" title=": classe outil utilisee en interne dans calculer_convolution()">Calcul_integrale_locale</a> integrale_locale(zone_source,
<a name="l00648"></a>00648                                            *<span class="keyword">this</span>,
<a name="l00649"></a>00649                                            champ_source);
<a name="l00650"></a>00650 
<a name="l00651"></a>00651 <span class="comment">// Boucle sur les coordonnees x locales pour lesquelles on veut calculer l&#39;integrale I(x).</span>
<a name="l00652"></a>00652 <span class="comment">// Si x est pres du bord, le support de la fonction filtre couvre des processeurs voisins</span>
<a name="l00653"></a>00653 <span class="comment">// qu&#39;il faut ajouter. Pour chaque coordonnees, on demande a tous les autres processeurs</span>
<a name="l00654"></a>00654 <span class="comment">// de calculer la contribution. Donc on boucle sur le max du nombre de coordonnees pour</span>
<a name="l00655"></a>00655 <span class="comment">// synchroniser les procs:</span>
<a name="l00656"></a>00656   <span class="keywordtype">int</span> i, j;
<a name="l00657"></a>00657   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_coord = 0; i_coord &lt; nb_coords_max; i_coord++)
<a name="l00658"></a>00658     {
<a name="l00659"></a>00659 <span class="comment">// Chaque processeur envoie la coordonnee a calculer a tous les processeurs:</span>
<a name="l00660"></a>00660       <span class="keywordflow">if</span> (i_coord &lt; nb_coords_to_compute)
<a name="l00661"></a>00661         {
<a name="l00662"></a>00662           <span class="keywordflow">for</span> (j = 0; j &lt; dim; j++)
<a name="l00663"></a>00663             {
<a name="l00664"></a>00664               <span class="keywordtype">double</span> x = coords_to_compute(i_coord, j);
<a name="l00665"></a>00665               <span class="keywordflow">for</span> (i = 0; i &lt; nbproc; i++)
<a name="l00666"></a>00666                 coords(i, j) = x;
<a name="l00667"></a>00667             }
<a name="l00668"></a>00668           flag = 1;
<a name="l00669"></a>00669         }
<a name="l00670"></a>00670       <span class="keywordflow">else</span>
<a name="l00671"></a>00671         {
<a name="l00672"></a>00672           flag = 0;
<a name="l00673"></a>00673         }
<a name="l00674"></a>00674       <a class="code" href="communications_8cpp.html#a5ceda011ec527d63b691f62cd2fb61c8">envoyer_all_to_all</a>(coords, coords);
<a name="l00675"></a>00675       <a class="code" href="communications_8cpp.html#a5ceda011ec527d63b691f62cd2fb61c8">envoyer_all_to_all</a>(flag, flag);
<a name="l00676"></a>00676 <span class="comment">// On a dans coord(pe, i) les coordonnees demandees par chaque processeur et</span>
<a name="l00677"></a>00677 <span class="comment">// flag[pe] indique si le processeur a demande une coordonnee ou s&#39;il a fini</span>
<a name="l00678"></a>00678 <span class="comment">// sa liste coords_to_compute.</span>
<a name="l00679"></a>00679 <span class="comment">// On calcule maintenant la contribution du processeur local aux integrales I(x)</span>
<a name="l00680"></a>00680 <span class="comment">// pour ces coordonnees. En general, le processeur qui a cette coordonnee chez lui</span>
<a name="l00681"></a>00681 <span class="comment">// a beaucoup de travail pour celle-ci et presque rien a faire pour les autres coordonnees</span>
<a name="l00682"></a>00682 <span class="comment">// (si la coordonnee est loin du domaine, l&#39;octree trouve tres rapidement la liste vide).</span>
<a name="l00683"></a>00683 <span class="comment">// Donc les calculs sont a peu pres equilibres sur les processeurs.</span>
<a name="l00684"></a>00684       <span class="keywordflow">for</span> (i = 0; i &lt; nbproc; i++)
<a name="l00685"></a>00685         {
<a name="l00686"></a>00686           <span class="keywordflow">if</span> (flag[i])
<a name="l00687"></a>00687             {
<a name="l00688"></a>00688               integrale_locale.<a class="code" href="classCalcul__integrale__locale.html#a3b4e91c13082f21cf5b4c05b2a999985" title="evalue le produit de convolution &quot;filter_ * champ_source_&quot; au point x,y,z et stocke le resultat dans ...">calculer</a>(coords(i, 0), coords(i, 1), coords(i, 2), resu_partiel);
<a name="l00689"></a>00689               <span class="keywordflow">for</span> (j = 0; j &lt; nb_comp; j++)
<a name="l00690"></a>00690                 resu_partiels(i, j) = resu_partiel[j];
<a name="l00691"></a>00691             }
<a name="l00692"></a>00692         }
<a name="l00693"></a>00693 <span class="comment">// On renvoie a chaque processeur la contribution du processeur local pour la coordonnee</span>
<a name="l00694"></a>00694 <span class="comment">// qu&#39;il a demande:</span>
<a name="l00695"></a>00695       <a class="code" href="communications_8cpp.html#a5ceda011ec527d63b691f62cd2fb61c8">envoyer_all_to_all</a>(resu_partiels, resu_partiels);
<a name="l00696"></a>00696 <span class="comment">// Le resultat est la somme des contributions de tous les processeurs:</span>
<a name="l00697"></a>00697       <span class="keywordflow">if</span> (i_coord &lt; nb_coords_to_compute)
<a name="l00698"></a>00698         {
<a name="l00699"></a>00699           <span class="keywordflow">for</span> (j = 0; j &lt; nb_comp; j++)
<a name="l00700"></a>00700             {
<a name="l00701"></a>00701               <span class="keywordtype">double</span> x = 0.;
<a name="l00702"></a>00702               <span class="keywordflow">for</span> (i = 0; i &lt; nbproc; i++)
<a name="l00703"></a>00703                 x += resu_partiels(i, j);
<a name="l00704"></a>00704               resu(i_coord, j) = x;
<a name="l00705"></a>00705             }
<a name="l00706"></a>00706         }
<a name="l00707"></a>00707     }
<a name="l00708"></a>00708 }
<a name="l00709"></a>00709 
<a name="l00710"></a>00710 <span class="comment">//</span>
<a name="l00711"></a>00711 <span class="comment">//</span>
<a name="l00712"></a>00712 <span class="comment">//</span>
<a name="l00713"></a>00713 <span class="comment">//</span>
<a name="l00714"></a>00714 <span class="comment">//</span><span class="comment"></span>
<a name="l00715"></a>00715 <span class="comment">//! Calcule le produit de convolution entre la fonction filtre et&lt;br&gt;le champ &quot;champ_source&quot; qui doit etre discretise aux elements de la &quot;zone_source&quot;.&lt;br&gt;Le tableau resu aura le meme nombre de colonnes que le tableau &quot;champ_source&quot;, et&lt;br&gt;le meme nombre de lignes que le tableau coords_to_compute.&lt;br&gt;On suppose que la fonction filtre a un support inclu dans un cube de demi-cote box-size&lt;br&gt;centre sur l&#39;origine (on ne calcule pas la contribution des elements hors de ce cube).</span>
<a name="l00716"></a><a class="code" href="classMoyenne__volumique.html#ab718ee00f503b157834828bdc624759d">00716</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classMoyenne__volumique.html#ab718ee00f503b157834828bdc624759d" title="Calcule le produit de convolution entre la fonction filtre et le champ &quot;champ_source&quot; qui doit etre...">Moyenne_volumique::calculer_convolution_champ_elem</a>(<span class="keyword">const</span> <a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>&amp; zone_source,
<a name="l00717"></a>00717                                                         <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; champ_source,
<a name="l00718"></a>00718                                                         <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; coords_to_compute,
<a name="l00719"></a>00719                                                         <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; resu)<span class="keyword"> const</span>
<a name="l00720"></a>00720 <span class="keyword"></span>{
<a name="l00721"></a>00721   assert(champ_source.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0) == zone_source.<a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>().<a class="code" href="classZone.html#a7f249429803b27139a1c54436f6164a5" title="Renvoie le nombre d&#39;elements de la zone.">nb_elem</a>());
<a name="l00722"></a>00722   <a class="code" href="classMoyenne__volumique.html#a951a03608a0407f0ac7e20a9ebfea38e" title="methode generale pour calculer une convolution a partir d&#39;un champ aux elements ou aux faces...">calculer_convolution</a>(zone_source, champ_source,
<a name="l00723"></a>00723                        coords_to_compute, resu);
<a name="l00724"></a>00724 }
<a name="l00725"></a>00725 
<a name="l00726"></a>00726 <span class="comment">//</span>
<a name="l00727"></a>00727 <span class="comment">//</span>
<a name="l00728"></a>00728 <span class="comment">//</span>
<a name="l00729"></a>00729 <span class="comment">//</span>
<a name="l00730"></a>00730 <span class="comment">//</span><span class="comment"></span>
<a name="l00731"></a>00731 <span class="comment">//! Idem que calculer_convolution_champ_elem pour un champ VDF aux faces.&lt;br&gt;(on suppose que le champ source est un champ vectoriel contenant pour chaque face&lt;br&gt;la composante normale du champ a cette face)&lt;br&gt;Pour chaque colonne du tableau champ_source, on remplit &quot;dimension&quot; colonnes&lt;br&gt;du tableau resu : la premiere utilisant uniquement les faces de normale X, la deuxieme&lt;br&gt;avec les faces de normale Y, etc...</span>
<a name="l00732"></a><a class="code" href="classMoyenne__volumique.html#a5fc563f4f506d941d25c3e19e7c4a346">00732</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classMoyenne__volumique.html#a5fc563f4f506d941d25c3e19e7c4a346" title="Idem que calculer_convolution_champ_elem pour un champ VDF aux faces. (on suppose que le champ source...">Moyenne_volumique::calculer_convolution_champ_face</a>(<span class="keyword">const</span> <a class="code" href="classZone__VF.html" title="class Zone_VF Cette classe abstraite contient les informations geometriques communes aux methodes de ...">Zone_VF</a>&amp; zone_source,
<a name="l00733"></a>00733                                                         <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; champ_source,
<a name="l00734"></a>00734                                                         <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; coords_to_compute,
<a name="l00735"></a>00735                                                         <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; resu)<span class="keyword"> const</span>
<a name="l00736"></a>00736 <span class="keyword"></span>{
<a name="l00737"></a>00737   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Moyenne_volumique::calculer_convolution_champ_face is not coded&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00738"></a>00738   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00739"></a>00739 }
<a name="l00740"></a>00740 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:25 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
