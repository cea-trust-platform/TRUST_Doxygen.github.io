<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/ThHyd/Schemas_Temps/Simpler.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/ThHyd/Schemas_Temps/Simpler.cpp</div>  </div>
</div>
<div class="contents">
<a href="Simpler_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (c) 2021, CEA</span>
<a name="l00003"></a>00003 <span class="comment">* All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment">* 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00007"></a>00007 <span class="comment">* 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00008"></a>00008 <span class="comment">* 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<a name="l00011"></a>00011 <span class="comment">* IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;</span>
<a name="l00012"></a>00012 <span class="comment">* OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// File:        Simpler.cpp</span>
<a name="l00018"></a>00018 <span class="comment">// Directory:   $TRUST_ROOT/src/ThHyd/Schemas_Temps</span>
<a name="l00019"></a>00019 <span class="comment">// Version:     /main/48</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;<a class="code" href="Simpler_8h.html">Simpler.h</a>&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="Navier__Stokes__std_8h.html">Navier_Stokes_std.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="EChaine_8h.html">EChaine.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="Debog_8h.html">Debog.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="Matrice__Bloc_8h.html">Matrice_Bloc.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="Assembleur__base_8h.html">Assembleur_base.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="Statistiques_8h.html">Statistiques.h</a>&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;<a class="code" href="Schema__Temps__base_8h.html">Schema_Temps_base.h</a>&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;<a class="code" href="DoubleTrav_8h.html">DoubleTrav.h</a>&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;<a class="code" href="Schema__Euler__Implicite_8h.html">Schema_Euler_Implicite.h</a>&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;<a class="code" href="Probleme__base_8h.html">Probleme_base.h</a>&gt;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a><a class="code" href="Simpler_8cpp.html#a30101c7644da14002571fb0bdce5137c">00035</a> <a class="code" href="Op__Diff__CoviMAC__Face_8cpp.html#aa86ec8ba612a969d9b4370b775037144">Implemente_instanciable</a>(<a class="code" href="classSimpler.html">Simpler</a>,<span class="stringliteral">&quot;Simpler&quot;</span>,<a class="code" href="classSimple.html">Simple</a>);
<a name="l00036"></a>00036 
<a name="l00037"></a><a class="code" href="classSimpler.html#a64a69011a71bb6d106fb73e8b57ad2ec">00037</a> <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classSimpler.html#a64a69011a71bb6d106fb73e8b57ad2ec" title="Ecriture de l&#39;objet sur un flot de sortie Methode a surcharger.">Simpler::printOn</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os )<span class="keyword"> const</span>
<a name="l00038"></a>00038 <span class="keyword"></span>{
<a name="l00039"></a>00039   <span class="keywordflow">return</span> <a class="code" href="classSimpler.html#a64a69011a71bb6d106fb73e8b57ad2ec" title="Ecriture de l&#39;objet sur un flot de sortie Methode a surcharger.">Simple::printOn</a>(os);
<a name="l00040"></a>00040 }
<a name="l00041"></a>00041 
<a name="l00042"></a><a class="code" href="classSimpler.html#a3f6e11bc3a07e61728492d1f04f78ef6">00042</a> <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classSimpler.html#a3f6e11bc3a07e61728492d1f04f78ef6" title="Lecture d&#39;un Objet_U sur un flot d&#39;entree Methode a surcharger.">Simpler::readOn</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is )
<a name="l00043"></a>00043 {
<a name="l00044"></a>00044   <span class="keywordflow">return</span> <a class="code" href="classSimpler.html#a3f6e11bc3a07e61728492d1f04f78ef6" title="Lecture d&#39;un Objet_U sur un flot d&#39;entree Methode a surcharger.">Simple::readOn</a>(is);
<a name="l00045"></a>00045 }
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 <span class="comment">// DEscription:</span>
<a name="l00049"></a>00049 <span class="comment">// calcul D correction_en_vitesse= E current + resu )</span>
<a name="l00050"></a>00050 <span class="comment">// avec D diagonale de la matrice et E = D-matrice =-(matrice-D)</span>
<a name="l00051"></a><a class="code" href="Simpler_8h.html#abe8430b7ba4f6d4d6067041c30fceefb">00051</a> <span class="keywordtype">int</span> <a class="code" href="Simpler_8cpp.html#a39ebea1914996e78c68ef4f58c5f7d95">inverser_par_diagonale</a>(<span class="keyword">const</span> <a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a>&amp; matrice,<span class="keyword">const</span> <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a>&amp; resu,<span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; current,<a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a>&amp; correction_en_vitesse)
<a name="l00052"></a>00052 {
<a name="l00053"></a>00053   <span class="keyword">const</span> <a class="code" href="classIntVect.html">IntVect</a>&amp; tab1 = matrice.<a class="code" href="classMatrice__Morse.html#a79b4e334152850bd36e53478debf3061">get_tab1</a>();
<a name="l00054"></a>00054   <span class="keyword">const</span> <a class="code" href="classIntVect.html">IntVect</a>&amp; tab2 = matrice.<a class="code" href="classMatrice__Morse.html#a787b5a63f27063f9c891243d8f188cda">get_tab2</a>();
<a name="l00055"></a>00055   <span class="keyword">const</span> <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; <a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a> = matrice.<a class="code" href="classMatrice__Morse.html#aacb80dd518dcc0812e3b34edac6ab67e">get_coeff</a>();
<a name="l00056"></a>00056 
<a name="l00057"></a>00057   <span class="keywordtype">int</span> deux_entrees=0;
<a name="l00058"></a>00058   <span class="keywordtype">int</span> nb_comp=1;
<a name="l00059"></a>00059   <span class="keywordflow">if</span> (resu.<a class="code" href="classDoubleTab.html#ae6dda48778e7107e1beb723beef1f75b" title="Returns the number of dimensions of the array (&gt;= 1)">nb_dim</a>()==2)
<a name="l00060"></a>00060     {
<a name="l00061"></a>00061       deux_entrees=1;
<a name="l00062"></a>00062       nb_comp=resu.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1);
<a name="l00063"></a>00063     }
<a name="l00064"></a>00064   <span class="keywordtype">int</span> nb_ligne_reel=correction_en_vitesse.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00065"></a>00065 <span class="comment">// Determine U^</span>
<a name="l00066"></a>00066   <span class="keywordflow">if</span> (deux_entrees==0)
<a name="l00067"></a>00067     {
<a name="l00068"></a>00068       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;nb_ligne_reel; i++)
<a name="l00069"></a>00069         {
<a name="l00070"></a>00070           <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j&lt;nb_comp; j++)
<a name="l00071"></a>00071             {
<a name="l00072"></a>00072               <span class="keywordtype">double</span> t=resu(i);
<a name="l00073"></a>00073               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=tab1(i*nb_comp+j); k&lt;tab1(i*nb_comp+j+1)-1; k++)
<a name="l00074"></a>00074                 t -= <a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a>(k)*current(tab2(k)-1);
<a name="l00075"></a>00075 
<a name="l00076"></a>00076               correction_en_vitesse(i) = t/matrice(i*nb_comp+j,i*nb_comp+j);
<a name="l00077"></a>00077             }
<a name="l00078"></a>00078         }
<a name="l00079"></a>00079 <span class="comment">// verif</span>
<a name="l00080"></a>00080 <span class="comment">// test</span>
<a name="l00081"></a>00081       <span class="keywordflow">if</span> (0)
<a name="l00082"></a>00082         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;nb_ligne_reel; i++)
<a name="l00083"></a>00083           {
<a name="l00084"></a>00084             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;nb_comp; j++)
<a name="l00085"></a>00085               {
<a name="l00086"></a>00086                 <span class="keywordtype">int</span> ii=i*nb_comp+j;
<a name="l00087"></a>00087                 <span class="keywordtype">double</span> tmp=resu(i);
<a name="l00088"></a>00088                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k&lt;matrice.<a class="code" href="classMatrice__Morse.html#a94caf9937bc5a110a7179cb3e9eaa9d9">nb_colonnes</a>(); k++)
<a name="l00089"></a>00089                   <span class="keywordflow">if</span> ((k/nb_comp)!=i)
<a name="l00090"></a>00090                     {
<a name="l00091"></a>00091                       <span class="keywordflow">if</span> (matrice(ii,k))
<a name="l00092"></a>00092                         tmp -= matrice(ii,k)*current((k/nb_comp));
<a name="l00093"></a>00093                     }
<a name="l00094"></a>00094 
<a name="l00095"></a>00095                 <span class="keywordtype">double</span> <a class="code" href="Op__Grad__EF_8cpp.html#abc0897c211f7aa4541da5833388f868b">test</a>=tmp/matrice(ii,ii);
<a name="l00096"></a>00096                 <span class="keywordflow">if</span> (!<a class="code" href="Double_8h.html#ac86f5f350b0f95fd8c34b0ac8d720f6f">est_egal</a>(test,correction_en_vitesse(i),1e-5))
<a name="l00097"></a>00097                   {
<a name="l00098"></a>00098                     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;i&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;j&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;resu(i)&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00099"></a>00099                     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;test&lt;&lt;<span class="stringliteral">&quot; ici &quot;</span>&lt;&lt;correction_en_vitesse(i)-test&lt;&lt;finl;
<a name="l00100"></a>00100                     <span class="keywordflow">return</span> -1;
<a name="l00101"></a>00101                   }
<a name="l00102"></a>00102               }
<a name="l00103"></a>00103           }
<a name="l00104"></a>00104     }
<a name="l00105"></a>00105 
<a name="l00106"></a>00106   <span class="keywordflow">else</span>
<a name="l00107"></a>00107     {
<a name="l00108"></a>00108       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;nb_ligne_reel; i++)
<a name="l00109"></a>00109         {
<a name="l00110"></a>00110           <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j&lt;nb_comp; j++)
<a name="l00111"></a>00111             {
<a name="l00112"></a>00112               <span class="keywordtype">double</span> t=resu(i,j);
<a name="l00113"></a>00113               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=tab1(i*nb_comp+j); k&lt;tab1(i*nb_comp+j+1)-1; k++)
<a name="l00114"></a>00114                 {
<a name="l00115"></a>00115                   <span class="keywordtype">int</span> i1 = (tab2(k)-1)/nb_comp;
<a name="l00116"></a>00116                   <span class="keywordtype">int</span> j1 = (tab2(k)-1)-i1*nb_comp;
<a name="l00117"></a>00117                   t -= <a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a>(k)*current(i1,j1);
<a name="l00118"></a>00118                 }
<a name="l00119"></a>00119               <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; diagonal_coefficient = matrice(i*nb_comp+j,i*nb_comp+j);
<a name="l00120"></a>00120               assert(diagonal_coefficient!=0);
<a name="l00121"></a>00121               correction_en_vitesse(i,j) = t/diagonal_coefficient;
<a name="l00122"></a>00122             }
<a name="l00123"></a>00123         }
<a name="l00124"></a>00124 <span class="comment">// test</span>
<a name="l00125"></a>00125       <span class="keywordflow">if</span> (0)
<a name="l00126"></a>00126         {
<a name="l00127"></a>00127           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;milieu&quot;</span>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00128"></a>00128           <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> corr2(correction_en_vitesse);
<a name="l00129"></a>00129           matrice.<a class="code" href="classMatrice__Base.html#a05caa487a25a6d5e7fbd38d4b2f4ee1e" title="Multiplication d&#39;un vecteur par la matrice. Operation: r = A*x.">multvect</a>(current,corr2);
<a name="l00130"></a>00130           <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;nb_ligne_reel; i++)
<a name="l00131"></a>00131             {
<a name="l00132"></a>00132               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;nb_comp; j++)
<a name="l00133"></a>00133                 {
<a name="l00134"></a>00134                   <span class="keywordtype">int</span> ii = i*nb_comp+j;
<a name="l00135"></a>00135                   corr2(i,j) = (resu(i,j)-corr2(i,j)+matrice(ii,ii)*current(i,j))/matrice(ii,ii);
<a name="l00136"></a>00136                   <span class="keywordtype">double</span> <a class="code" href="Op__Grad__EF_8cpp.html#abc0897c211f7aa4541da5833388f868b">test</a> = corr2(i,j);
<a name="l00137"></a>00137                   <span class="keywordflow">if</span> (!<a class="code" href="Double_8h.html#ac86f5f350b0f95fd8c34b0ac8d720f6f">est_egal</a>(test,correction_en_vitesse(i,j)))
<a name="l00138"></a>00138                     {
<a name="l00139"></a>00139                       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;i&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;j&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;resu(i,j)&lt;&lt;finl;
<a name="l00140"></a>00140                       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;test&lt;&lt;<span class="stringliteral">&quot; ici &quot;</span>&lt;&lt;correction_en_vitesse(i,j)&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;current(i,j)&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;matrice(ii,ii) &lt;&lt;finl;
<a name="l00141"></a>00141                       <span class="keywordflow">return</span> -1;
<a name="l00142"></a>00142                     }
<a name="l00143"></a>00143                 }
<a name="l00144"></a>00144             }
<a name="l00145"></a>00145           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;fin&quot;</span>&lt;&lt;finl;
<a name="l00146"></a>00146         }
<a name="l00147"></a>00147     }
<a name="l00148"></a>00148   correction_en_vitesse.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l00149"></a>00149   <span class="keywordflow">return</span> 0;
<a name="l00150"></a>00150 }
<a name="l00151"></a>00151 
<a name="l00152"></a>00152 
<a name="l00153"></a>00153 <span class="comment">// Entree : Uk-1 ; Pk-1</span>
<a name="l00154"></a>00154 <span class="comment">// Sortie Uk ; Pk</span>
<a name="l00155"></a>00155 <span class="comment">// k designe une iteration</span>
<a name="l00156"></a>00156 
<a name="l00157"></a><a class="code" href="classSimpler.html#ae0048feb0d5e33700bd38626740fdbbf">00157</a> <span class="keywordtype">void</span> <a class="code" href="classSimpler.html#ae0048feb0d5e33700bd38626740fdbbf">Simpler::iterer_NS</a>(<a class="code" href="classEquation__base.html">Equation_base</a>&amp; eqn,<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; current,<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; pression,<span class="keywordtype">double</span> dt,<a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a>&amp; matrice,<span class="keywordtype">double</span> seuil_resol,<a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a>&amp; secmem,<span class="keywordtype">int</span> nb_ite,<span class="keywordtype">int</span>&amp; converge, <span class="keywordtype">int</span>&amp; ok)
<a name="l00158"></a>00158 {
<a name="l00159"></a>00159   <span class="keywordflow">if</span> (eqn.<a class="code" href="classEquation__base.html#aa8151a96f63719523bf50ddd832e0f8f" title="Renvoie le probleme associe a l&#39;equation.">probleme</a>().<a class="code" href="classProbleme__base.html#a4ef1cb4c4eed0aab75358ab7a91e29db">is_dilatable</a>())
<a name="l00160"></a>00160     {
<a name="l00161"></a>00161       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot; Simpler cannot be used with a quasi-compressible fluid.&quot;</span>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00162"></a>00162       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;__FILE__&lt;&lt;(int)__LINE__&lt;&lt;<span class="stringliteral">&quot; non code&quot;</span> &lt;&lt;finl;
<a name="l00163"></a>00163       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00164"></a>00164     }
<a name="l00165"></a>00165 
<a name="l00166"></a>00166   <a class="code" href="classParametre__implicite.html" title="classe Parametre_implicite Un objet Parametre_implicite est un objet regroupant les differentes optio...">Parametre_implicite</a>&amp; param = <a class="code" href="classSimpler__Base.html#a41cac35ea9df69f70075c3df820b96a3" title="retourne le parametre_implicte de l&#39;equation si il existe si il n&#39;existe pas le cree... si les params sont vides on copie ceux du simpler">get_and_set_parametre_implicite</a>(eqn);
<a name="l00167"></a>00167   <a class="code" href="classSolveurSys.html">SolveurSys</a>&amp; le_solveur_ = param.<a class="code" href="classParametre__implicite.html#a7e65b5960b6f41da7e586134f3462666">solveur</a>();
<a name="l00168"></a>00168 
<a name="l00169"></a>00169   <a class="code" href="classNavier__Stokes__std.html" title="classe Navier_Stokes_std Cette classe porte les termes de l&#39;equation de la dynamique pour un fluide s...">Navier_Stokes_std</a>&amp; eqnNS = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classNavier__Stokes__std.html" title="classe Navier_Stokes_std Cette classe porte les termes de l&#39;equation de la dynamique pour un fluide s...">Navier_Stokes_std</a>,eqn);
<a name="l00170"></a>00170   <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> gradP(current);
<a name="l00171"></a>00171   <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> correction_en_pression(pression);
<a name="l00172"></a>00172   <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> correction_en_vitesse(current);
<a name="l00173"></a>00173   <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> resu(current);
<a name="l00174"></a>00174 
<a name="l00175"></a>00175 <span class="comment">// int deux_entrees = 0;</span>
<a name="l00176"></a>00176 <span class="comment">// if (current.nb_dim()==2) deux_entrees = 1;</span>
<a name="l00177"></a>00177   <a class="code" href="classOperateur__Grad.html" title="Classe Operateur_Grad Classe generique de la hierarchie des operateurs calculant le gradient d&#39;un cha...">Operateur_Grad</a>&amp; gradient = eqnNS.<a class="code" href="classNavier__Stokes__std.html#a840295836fce939b7861f1353da595ff" title="Renvoie l&#39;operateur de calcul du gradient associe a l&#39;equation.">operateur_gradient</a>();
<a name="l00178"></a>00178   <a class="code" href="classOperateur__Div.html" title="classe Operateur_Div Classe generique de la hierarchie des operateurs calculant la divergence d&#39;un ch...">Operateur_Div</a>&amp; divergence = eqnNS.<a class="code" href="classNavier__Stokes__std.html#a614d41350181667ee295b87a72779c1a" title="Renvoie l&#39;operateur de calcul de la divergence associe a l&#39;equation.">operateur_divergence</a>();
<a name="l00179"></a>00179 
<a name="l00180"></a>00180 <span class="comment">// int nb_comp = 1;</span>
<a name="l00181"></a>00181 <span class="comment">// int nb_dim = current.nb_dim();</span>
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 <span class="comment">// if (nb_dim==2)</span>
<a name="l00184"></a>00184 <span class="comment">// nb_comp = current.dimension(1);</span>
<a name="l00185"></a>00185 
<a name="l00186"></a>00186 <span class="comment">// Construction de matrice et resu</span>
<a name="l00187"></a>00187 <span class="comment">// matrice = A[Uk-1] = M/dt + CONV +DIFF</span>
<a name="l00188"></a>00188 <span class="comment">// resu =  A[Uk-1]Uk-1 -(A[Uk-1]Uk-1-Ss) + Sv -BtPk-1</span>
<a name="l00189"></a>00189   gradient.<a class="code" href="classOperateur__Grad.html#a179b2f08f6907e9b69fa715cfb98fa81" title="Initialise le tableau passe en parametre avec la contribution de l&#39;operateur.">calculer</a>(pression,gradP);
<a name="l00190"></a>00190   resu -= gradP;
<a name="l00191"></a>00191   eqnNS.<a class="code" href="classEquation__base.html#a6442c887ca10e6b6e59e0d36140f698c">assembler_avec_inertie</a>(matrice,current,resu);
<a name="l00192"></a>00192   le_solveur_.<a class="code" href="classDeriv__SolveurSys__base.html#aa1f67fc10fc25960d05d484a67d1bb54">valeur</a>().<a class="code" href="classSolveurSys__base.html#a8737bd7292204c64e4b7bfe4c7bd88ef">reinit</a>();
<a name="l00193"></a>00193 
<a name="l00194"></a>00194 <span class="comment">// Resolution du systeme : D[Uk-1]UPk = E[Uk-1]Uk-1 + Sv + Ss -BtPk-1 + (M/dt)Uk-1</span>
<a name="l00195"></a>00195 <span class="comment">// matrice = A[Uk-1] = D - E avec D partie diagonale de A</span>
<a name="l00196"></a>00196 <span class="comment">// correction_en_vitesse = UPk ; current = Uk-1 ; resu = Sv + Ss -BtPk-1</span>
<a name="l00197"></a>00197   <span class="keywordtype">int</span> status = <a class="code" href="Simpler_8cpp.html#a39ebea1914996e78c68ef4f58c5f7d95">inverser_par_diagonale</a>(matrice,resu,current,correction_en_vitesse);
<a name="l00198"></a>00198   <span class="keywordflow">if</span> (status!=0) <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00199"></a>00199   <a class="code" href="Op__Div__VEFP1B__Elem_8cpp.html#a45261662b3b88d5db461b3fc99246e5a">Debog::verifier</a>(<span class="stringliteral">&quot;Simpler::iterer_NS correction_en_vitesse&quot;</span>,correction_en_vitesse);
<a name="l00200"></a>00200 
<a name="l00201"></a>00201 <span class="comment">// Construction de matrice_en_pression_2 = BD-1Bt[Uk-1]</span>
<a name="l00202"></a>00202   <a class="code" href="classMatrice.html">Matrice</a>&amp; matrice_en_pression_2 = eqnNS.<a class="code" href="classNavier__Stokes__std.html#ade0331e225bfe2c312d4917eb127e3cd">matrice_pression</a>();
<a name="l00203"></a>00203   <a class="code" href="classSimpler__Base.html#a9551a048f427dd25e9e6e5a054b95038">assembler_matrice_pression_implicite</a>(eqnNS,matrice,matrice_en_pression_2);
<a name="l00204"></a>00204   <a class="code" href="classSolveurSys.html">SolveurSys</a>&amp; solveur_pression_ = eqnNS.<a class="code" href="classNavier__Stokes__std.html#ae83d9f7a42531293583f32be1efd3d5f" title="Renvoie le solveur en pression&lt;br&gt;(version const)">solveur_pression</a>();
<a name="l00205"></a>00205   solveur_pression_.<a class="code" href="classDeriv__SolveurSys__base.html#aa1f67fc10fc25960d05d484a67d1bb54">valeur</a>().<a class="code" href="classSolveurSys__base.html#a8737bd7292204c64e4b7bfe4c7bd88ef">reinit</a>();
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 <span class="comment">// Calcul de BUPk</span>
<a name="l00208"></a>00208   divergence.<a class="code" href="classOperateur__Div.html#ad3dbe52ca9c4899797444afeb0fe4ef4" title="Initialise le tableau passe en parametre avec la contribution de l&#39;operateur.">calculer</a>(correction_en_vitesse,secmem);
<a name="l00209"></a>00209   secmem *= -1;
<a name="l00210"></a>00210   secmem.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l00211"></a>00211   <span class="keywordflow">if</span> (nb_ite==1)
<a name="l00212"></a>00212     eqnNS.<a class="code" href="classNavier__Stokes__std.html#af9f5e0396945755597f147bd424a4a08">assembleur_pression</a>().<a class="code" href="classDeriv__Assembleur__base.html#ac0c74810fc600fc5053e645bf19d4ece">valeur</a>().<a class="code" href="classAssembleur__base.html#a1b7505480a151e375f3916e94e134a92">modifier_secmem</a>(secmem);
<a name="l00213"></a>00213 
<a name="l00214"></a>00214 <span class="comment">// Resolution du systeme (BD-1Bt)P*_k = BUPk</span>
<a name="l00215"></a>00215 <span class="comment">// correction_en_pression = P*_k ; secmem = BUPk</span>
<a name="l00216"></a>00216   solveur_pression_.<a class="code" href="classSolveurSys.html#a62ca198f0c5dc599e53b0535761e5138">resoudre_systeme</a>(matrice_en_pression_2.<a class="code" href="classDeriv__Matrice__Base.html#ae43f3a90ca16518c191f9e7d5ebef912">valeur</a>(),
<a name="l00217"></a>00217                                      secmem,correction_en_pression);
<a name="l00218"></a>00218 
<a name="l00219"></a>00219 <span class="comment">// Calcul de Pk = Pk-1 + P*_k</span>
<a name="l00220"></a>00220   <a class="code" href="DoubleVect_8cpp.html#a9dd7edead35e9d46fc6c8960f33e668a">operator_add</a>(pression, correction_en_pression, <a class="code" href="MD__Vector_8h.html#a3616a15fe105ad6150819554ee8b11caad18680091a9f62247573cb3caa6450b9">VECT_ALL_ITEMS</a>);
<a name="l00221"></a>00221 
<a name="l00222"></a>00222   eqnNS.<a class="code" href="classNavier__Stokes__std.html#af9f5e0396945755597f147bd424a4a08">assembleur_pression</a>().<a class="code" href="classDeriv__Assembleur__base.html#ac0c74810fc600fc5053e645bf19d4ece">valeur</a>().<a class="code" href="classAssembleur__base.html#ab63a4124e6e959dc5986c566748422f6">modifier_solution</a>(pression);
<a name="l00223"></a>00223 
<a name="l00224"></a>00224 <span class="comment">// Calcul de Bt P*_k et ajustement de resu a -Bt Pk</span>
<a name="l00225"></a>00225   gradient.<a class="code" href="classDeriv__Operateur__Grad__base.html#abb2da411c7f8984b95704eeb0d4deeab">valeur</a>().<a class="code" href="classOperateur__Grad__base.html#a0db6712837c5be1c0e117c3cf00ed3fc" title="Calcul sans les conditions aux limites ?">multvect</a>(correction_en_pression,gradP);
<a name="l00226"></a>00226   resu -= gradP;
<a name="l00227"></a>00227   resu.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l00228"></a>00228   <a class="code" href="Op__Div__VEFP1B__Elem_8cpp.html#a45261662b3b88d5db461b3fc99246e5a">Debog::verifier</a>(<span class="stringliteral">&quot;Simpler::iterer_NS resu&quot;</span>,resu);
<a name="l00229"></a>00229 
<a name="l00230"></a>00230 <span class="comment">// Resolution du systeme : A[Uk-1]U*_k = -BtPk + Sv + Ss + (M/dt)Uk-1</span>
<a name="l00231"></a>00231 <span class="comment">// current = U*_k ; resu = A[Uk-1]Uk-1 - (A[Uk-1]Uk-1-Ss) + Sv -BtPk + (M/dt)Uk-1</span>
<a name="l00232"></a>00232   le_solveur_.<a class="code" href="classSolveurSys.html#a62ca198f0c5dc599e53b0535761e5138">resoudre_systeme</a>(matrice,resu,current);
<a name="l00233"></a>00233 
<a name="l00234"></a>00234 <span class="comment">// Calcul de BU*_k</span>
<a name="l00235"></a>00235   divergence.<a class="code" href="classOperateur__Div.html#ad3dbe52ca9c4899797444afeb0fe4ef4" title="Initialise le tableau passe en parametre avec la contribution de l&#39;operateur.">calculer</a>(current,secmem);
<a name="l00236"></a>00236   secmem *= -1;
<a name="l00237"></a>00237   secmem.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l00238"></a>00238   <a class="code" href="Op__Div__VEFP1B__Elem_8cpp.html#a45261662b3b88d5db461b3fc99246e5a">Debog::verifier</a>(<span class="stringliteral">&quot;Simpler::iterer_NS secmem&quot;</span>,secmem);
<a name="l00239"></a>00239 
<a name="l00240"></a>00240 <span class="comment">// Resolution du systeme (BD-1Bt)P&#39;k = BU*_k</span>
<a name="l00241"></a>00241 <span class="comment">// correction_en_pression = P&#39;k ; secmem = BU*_k</span>
<a name="l00242"></a>00242   correction_en_pression = 0;
<a name="l00243"></a>00243   solveur_pression_.<a class="code" href="classSolveurSys.html#a62ca198f0c5dc599e53b0535761e5138">resoudre_systeme</a>(matrice_en_pression_2.<a class="code" href="classDeriv__Matrice__Base.html#ae43f3a90ca16518c191f9e7d5ebef912">valeur</a>(),
<a name="l00244"></a>00244                                      secmem,correction_en_pression);
<a name="l00245"></a>00245 
<a name="l00246"></a>00246 <span class="comment">// Resolution du systeme D[Uk-1](Uk-U*_k) = -BtP&#39;k</span>
<a name="l00247"></a>00247 <span class="comment">// correction_en_vitesse = U&#39;k = Uk-U*_k ; correction_en_pression = P&#39;k</span>
<a name="l00248"></a>00248   <a class="code" href="classSimple.html#aba822b0b0b3d30c62205600a72602b37">calculer_correction_en_vitesse</a>(correction_en_pression,gradP,correction_en_vitesse,matrice,gradient);
<a name="l00249"></a>00249 
<a name="l00250"></a>00250   <span class="keywordflow">if</span> (0)
<a name="l00251"></a>00251     {
<a name="l00252"></a>00252       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot; rr &quot;</span>&lt;&lt;<a class="code" href="DoubleVect_8cpp.html#acb21ec8c0b3909c26b20e3f3455e0289">mp_max_abs_vect</a>(secmem)&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00253"></a>00253 <span class="comment">// Cerr&lt;&lt;secmem&lt;&lt;finl;</span>
<a name="l00254"></a>00254       secmem*=-1;
<a name="l00255"></a>00255       divergence.<a class="code" href="classOperateur__Div.html#aeb7f9d269b7d93314ce9583f0fa1f57d" title="Ajoute la contribution de l&#39;operateur au tableau passe en parametre.">ajouter</a>(correction_en_vitesse, secmem);
<a name="l00256"></a>00256       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot; rr2 &quot;</span>&lt;&lt;<a class="code" href="DoubleVect_8cpp.html#acb21ec8c0b3909c26b20e3f3455e0289">mp_max_abs_vect</a>(secmem)&lt;&lt;finl;
<a name="l00257"></a>00257 
<a name="l00258"></a>00258     }
<a name="l00259"></a>00259 
<a name="l00260"></a>00260 <span class="comment">// Calcul de Uk = U*_k + U&#39;k</span>
<a name="l00261"></a>00261   current += correction_en_vitesse;
<a name="l00262"></a>00262   current.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l00263"></a>00263   <a class="code" href="Op__Div__VEFP1B__Elem_8cpp.html#a45261662b3b88d5db461b3fc99246e5a">Debog::verifier</a>(<span class="stringliteral">&quot;Simpler::iterer_NS current&quot;</span>,current);
<a name="l00264"></a>00264 
<a name="l00265"></a>00265   <span class="keywordflow">if</span> (0)
<a name="l00266"></a>00266     {
<a name="l00267"></a>00267       divergence.<a class="code" href="classOperateur__Div.html#ad3dbe52ca9c4899797444afeb0fe4ef4" title="Initialise le tableau passe en parametre avec la contribution de l&#39;operateur.">calculer</a>(current, secmem);
<a name="l00268"></a>00268       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot; apresdiv &quot;</span>&lt;&lt;<a class="code" href="DoubleVect_8cpp.html#acb21ec8c0b3909c26b20e3f3455e0289">mp_max_abs_vect</a>(secmem)&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;;
<a name="l00269"></a>00269     }
<a name="l00270"></a>00270 }
<a name="l00271"></a>00271 
<a name="l00272"></a>00272 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:37 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
