<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/P1NCP1B/Operateurs/Op_Dift_VEF_P1NCP1B_Face.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/P1NCP1B/Operateurs/Op_Dift_VEF_P1NCP1B_Face.cpp</div>  </div>
</div>
<div class="contents">
<a href="Op__Dift__VEF__P1NCP1B__Face_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (c) 2020, CEA</span>
<a name="l00003"></a>00003 <span class="comment">* All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment">* 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00007"></a>00007 <span class="comment">* 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00008"></a>00008 <span class="comment">* 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<a name="l00011"></a>00011 <span class="comment">* IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;</span>
<a name="l00012"></a>00012 <span class="comment">* OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// File:        Op_Dift_VEF_P1NCP1B_Face.cpp</span>
<a name="l00018"></a>00018 <span class="comment">// Directory:   $TRUST_ROOT/src/P1NCP1B/Operateurs</span>
<a name="l00019"></a>00019 <span class="comment">// Version:     /main/24</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;<a class="code" href="Op__Dift__VEF__P1NCP1B__Face_8h.html">Op_Dift_VEF_P1NCP1B_Face.h</a>&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="Champ__P1NC_8h.html">Champ_P1NC.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="Champ__Don_8h.html">Champ_Don.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="Periodique_8h.html">Periodique.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="Symetrie_8h.html">Symetrie.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="Neumann__sortie__libre_8h.html">Neumann_sortie_libre.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="Champ__Uniforme_8h.html">Champ_Uniforme.h</a>&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;<a class="code" href="Domaine_8h.html">Domaine.h</a>&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;<a class="code" href="IntLists_8h.html">IntLists.h</a>&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;<a class="code" href="DoubleLists_8h.html">DoubleLists.h</a>&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;<a class="code" href="Solv__GCP_8h.html">Solv_GCP.h</a>&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;<a class="code" href="SSOR_8h.html">SSOR.h</a>&gt;</span>
<a name="l00035"></a>00035 
<a name="l00036"></a><a class="code" href="Op__Dift__VEF__P1NCP1B__Face_8cpp.html#aa078a0d0a6dc8ebb1cfaff3f19016dc7">00036</a> <a class="code" href="Op__Diff__CoviMAC__Face_8cpp.html#aa86ec8ba612a969d9b4370b775037144">Implemente_instanciable</a>(<a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html" title="class Op_Dift_VEF_P1NCP1B_Face Cette classe represente l&#39;operateur de diffusion La discretisation est...">Op_Dift_VEF_P1NCP1B_Face</a>,<span class="stringliteral">&quot;Op_Dift_VEF_P1NCP1B_const_P1NC&quot;</span>,<a class="code" href="classOp__Dift__VEF__base.html" title="class Op_Dift_VEF_base">Op_Dift_VEF_base</a>);
<a name="l00037"></a>00037 
<a name="l00038"></a><a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a7cfba98bd82d2ffd3bd794fbedf7b23e">00038</a> <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a7cfba98bd82d2ffd3bd794fbedf7b23e" title="NE FAIT RIEN A surcharger dans les classes derivees.">Op_Dift_VEF_P1NCP1B_Face::printOn</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; s )<span class="keyword"> const</span>
<a name="l00039"></a>00039 <span class="keyword"></span>{
<a name="l00040"></a>00040   <span class="keywordflow">return</span> s &lt;&lt; <a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>() ;
<a name="l00041"></a>00041 }
<a name="l00042"></a>00042 <span class="comment"></span>
<a name="l00043"></a>00043 <span class="comment">////!&lt; readOn </span>
<a name="l00044"></a>00044 <span class="comment"></span><span class="comment">//</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a84c020948fcf0c57ebc0cc31940e2c73" title="NE FAIT RIEN A surcharger dans les classes derivees.">Op_Dift_VEF_P1NCP1B_Face::</a>
<a name="l00047"></a><a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a84c020948fcf0c57ebc0cc31940e2c73">00047</a> <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a84c020948fcf0c57ebc0cc31940e2c73" title="NE FAIT RIEN A surcharger dans les classes derivees.">readOn</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; s )
<a name="l00048"></a>00048 {
<a name="l00049"></a>00049   <span class="keywordflow">return</span> s ;
<a name="l00050"></a>00050 }
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="keywordtype">void</span> <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a9b90429ce0c41a9ac7df11bab0b1dd07">Op_Dift_VEF_P1NCP1B_Face::</a>
<a name="l00053"></a><a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a9b90429ce0c41a9ac7df11bab0b1dd07">00053</a> <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a9b90429ce0c41a9ac7df11bab0b1dd07">associer</a>(<span class="keyword">const</span> <a class="code" href="classZone__dis.html" title="classe Zone_dis Classe generique de la hierarchie des zones discretisees. Un objet de type Zone_dis p...">Zone_dis</a>&amp; zone_dis,
<a name="l00054"></a>00054          <span class="keyword">const</span> <a class="code" href="classZone__Cl__dis.html" title="classe Zone_Cl_dis Classe generique de la hierarchie des conditions aux limites discretisees. Un objet Zone_Cl_dis peut referencer n&#39;importe quel derivant de Zone_Cl_dis_base. La plupart des methodes appellent les methodes de l&#39;objet Probleme sous-jacent via la methode valeur() declaree grace a la macro Declare_deriv().;">Zone_Cl_dis</a>&amp; zone_cl_dis,
<a name="l00055"></a>00055          <span class="keyword">const</span> <a class="code" href="classChamp__Inc.html">Champ_Inc</a>&amp; ch_transporte)
<a name="l00056"></a>00056 {
<a name="l00057"></a>00057   <span class="keyword">const</span> <a class="code" href="classZone__VEF__PreP1b.html">Zone_VEF_PreP1b</a>&amp; zvef = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classZone__VEF__PreP1b.html">Zone_VEF_PreP1b</a>,zone_dis.<a class="code" href="classDeriv__Zone__dis__base.html#a30ff47fc0684fe134e8c74c35b268941">valeur</a>());
<a name="l00058"></a>00058   <span class="keyword">const</span> <a class="code" href="classZone__Cl__VEFP1B.html">Zone_Cl_VEFP1B</a>&amp; zclvef = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classZone__Cl__VEFP1B.html">Zone_Cl_VEFP1B</a>,zone_cl_dis.<a class="code" href="classDeriv__Zone__Cl__dis__base.html#a6b56880f00b604e1f13970ec6d5bc077">valeur</a>());
<a name="l00059"></a>00059   <span class="keyword">const</span> <a class="code" href="classChamp__P1NC.html">Champ_P1NC</a>&amp; inco = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classChamp__P1NC.html">Champ_P1NC</a>,ch_transporte.<a class="code" href="classDeriv__Champ__Inc__base.html#a9e0b743a3e124e7114fa977b36b68225">valeur</a>());
<a name="l00060"></a>00060   <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a78f2d5819303c5dfe731f308a5102c47">la_zone_vef</a> = zvef;
<a name="l00061"></a>00061   <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a35daf718670338d47818fb8d4542d22e">la_zcl_vef</a> = zclvef;
<a name="l00062"></a>00062   <a class="code" href="classOp__Diff__VEF__base.html#abbeb435814253a33ecaf170b6f03829f">inconnue_</a> = inco;
<a name="l00063"></a>00063   <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#aa6d7c2eb34e21533009c8573bc7d978b">solveur</a>.<a class="code" href="classDeriv__.html#ad1d33400ed15b6ff96579ed82d9e2719" title="Essaie de creer une instance du type &quot;type&quot;. si type n&#39;est pas un type ou type n&#39;est pas instanciab...">typer</a>(<span class="stringliteral">&quot;Solv_GCP&quot;</span>);
<a name="l00064"></a>00064   <a class="code" href="classPrecond.html">Precond</a> p;
<a name="l00065"></a>00065   p.<a class="code" href="classDeriv__.html#ad1d33400ed15b6ff96579ed82d9e2719" title="Essaie de creer une instance du type &quot;type&quot;. si type n&#39;est pas un type ou type n&#39;est pas instanciab...">typer</a>(<span class="stringliteral">&quot;SSOR&quot;</span>);
<a name="l00066"></a>00066   <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classSolv__GCP.html">Solv_GCP</a>,<a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#aa6d7c2eb34e21533009c8573bc7d978b">solveur</a>.<a class="code" href="classDeriv__SolveurSys__base.html#aa1f67fc10fc25960d05d484a67d1bb54">valeur</a>()).set_precond(p);
<a name="l00067"></a>00067   <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#aa6d7c2eb34e21533009c8573bc7d978b">solveur</a>.<a class="code" href="classSolveurSys.html#a17fa90c93f514a6d2a898e682e724d3b" title="Donne un nom a l&#39;Objet_U Methode virtuelle a surcharger.">nommer</a>(<span class="stringliteral">&quot;diffusion_solver&quot;</span>);
<a name="l00068"></a>00068 }
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 <span class="keywordtype">void</span> <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#aa989a59bf9c0dc598b68a0d2847c923d">Op_Dift_VEF_P1NCP1B_Face::</a>
<a name="l00071"></a><a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#aa989a59bf9c0dc598b68a0d2847c923d">00071</a> <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#aa989a59bf9c0dc598b68a0d2847c923d">associer_diffusivite</a>(<span class="keyword">const</span> <a class="code" href="classChamp__base.html" title="classe Champ_base Cette classe est la base de la hierarchie des champs. Ses membres sont les attribut...">Champ_base</a>&amp; diffu)
<a name="l00072"></a>00072 {
<a name="l00073"></a>00073   <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a323d8c87ba9d2456fb257493f81959c6">diffusivite_</a> = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classChamp__Uniforme.html" title="classe Champ_Uniforme Represente un champ constant dans l&#39;espace et dans le temps.">Champ_Uniforme</a>, diffu);
<a name="l00074"></a>00074 }
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 <span class="keywordtype">double</span> <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a798a5d1182f8dc327a4d0147e08954eb" title="Calcul dt_stab.">Op_Dift_VEF_P1NCP1B_Face::</a>
<a name="l00077"></a><a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a798a5d1182f8dc327a4d0147e08954eb">00077</a> <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a798a5d1182f8dc327a4d0147e08954eb" title="Calcul dt_stab.">calculer_dt_stab</a>()<span class="keyword"> const</span>
<a name="l00078"></a>00078 <span class="keyword"></span>{
<a name="l00079"></a>00079 <span class="comment">// Calcul de dt_stab</span>
<a name="l00080"></a>00080 <span class="comment">// La diffusivite est constante par elements donc</span>
<a name="l00081"></a>00081 <span class="comment">// il faut calculer dt_diff pour chaque element et</span>
<a name="l00082"></a>00082 <span class="comment">// dt_stab=Min(dt_diff (K) = h(K)*h(K)/(2*dimension*diffu2_(K)))</span>
<a name="l00083"></a>00083 <span class="comment">// ou diffu2_ est la somme des 2 diffusivite laminaire et turbulente</span>
<a name="l00084"></a>00084 
<a name="l00085"></a>00085   <span class="keywordtype">int</span> num_face;
<a name="l00086"></a>00086   <span class="keywordtype">double</span> vol,surf;
<a name="l00087"></a>00087   <span class="keywordtype">double</span> surf_max;
<a name="l00088"></a>00088   <span class="keywordtype">double</span> dt_stab=1.e30;
<a name="l00089"></a>00089   <span class="keywordtype">double</span> coef;
<a name="l00090"></a>00090   <span class="keyword">const</span> <a class="code" href="classZone__VEF__PreP1b.html">Zone_VEF_PreP1b</a>&amp; la_zone_VEF = <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a78f2d5819303c5dfe731f308a5102c47">la_zone_vef</a>.<a class="code" href="classRef__Zone__VEF__PreP1b.html#aeb3b561ce23619afef9061bbbc37bb5e">valeur</a>();
<a name="l00091"></a>00091   <span class="keyword">const</span> <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; volumes = la_zone_VEF.<a class="code" href="classZone__VF.html#aea771c835e561469d2d21dbca5fac1cf" title="renvoie le volume de la maille i.">volumes</a>();
<a name="l00092"></a>00092   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; elem_faces = la_zone_VEF.<a class="code" href="classZone__VF.html#a067e462dcd3ab92b0f6d945b19e4eb37" title="renvoie le numero de le ieme face de la maille num_elem la facon dont ces faces sont numerotees est l...">elem_faces</a>();
<a name="l00093"></a>00093   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; face_normales = la_zone_VEF.<a class="code" href="classZone__VEF.html#a5742d75972e4846bf9fbb6ed5715053e">face_normales</a>();
<a name="l00094"></a>00094   <span class="keyword">const</span> <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; la_zone= la_zone_VEF.<a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>();
<a name="l00095"></a>00095 <span class="comment">// const int nb_elem = la_zone.nb_elem_tot();</span>
<a name="l00096"></a>00096 <span class="comment">// const DoubleTab&amp; xp=la_zone_VEF.xp();</span>
<a name="l00097"></a>00097   <span class="keywordtype">int</span> nb_faces_elem = la_zone.<a class="code" href="classZone.html#a548fbc7518be2f122b1a5c9589a443c2" title="Renvoie le nombre de face de type i des elements geometriques constituants la zone. Ex: les objets de la classe Prisme ont 2 types de faces: triangle ou quadrangle.">nb_faces_elem</a>();
<a name="l00098"></a>00098   <span class="keywordtype">double</span> diffu = (<a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a323d8c87ba9d2456fb257493f81959c6">diffusivite_</a>.<a class="code" href="classRef__Champ__base.html#a0cda53fe61d4f24bc8861720d525b32a">valeur</a>())(0,0);
<a name="l00099"></a>00099   <span class="keyword">const</span> <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; diffu_turb=<a class="code" href="classOp__Diff__Turbulent__base.html#af674533b0786ba32fa6a408b6c8bba04">diffusivite_turbulente</a>()-&gt;<a class="code" href="classChamp__Fonc.html#a60b75eadb0987d488884e24fcb72d1e5" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs du champ.">valeurs</a>();
<a name="l00100"></a>00100   <span class="keywordtype">double</span> diffu2_;
<a name="l00101"></a>00101 <span class="comment">// diffu_turb=1.;</span>
<a name="l00102"></a>00102 <span class="comment">// for( int j=0;j&lt;nb_elem;j++)</span>
<a name="l00103"></a>00103 <span class="comment">// diffu_turb[j]=1.-0.9*xp(j,1);</span>
<a name="l00104"></a>00104   <span class="keywordtype">int</span> la_zone_nb_elem=la_zone.<a class="code" href="classZone.html#a7f249429803b27139a1c54436f6164a5" title="Renvoie le nombre d&#39;elements de la zone.">nb_elem</a>();
<a name="l00105"></a>00105   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> num_elem=0; num_elem&lt;la_zone_nb_elem; num_elem++)
<a name="l00106"></a>00106     {
<a name="l00107"></a>00107       surf_max = 1.e-30;
<a name="l00108"></a>00108       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nb_faces_elem; i++)
<a name="l00109"></a>00109         {
<a name="l00110"></a>00110           num_face = elem_faces(num_elem,i);
<a name="l00111"></a>00111           surf = face_normales(num_face,0)*face_normales(num_face,0);
<a name="l00112"></a>00112           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=1; j&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; j++)
<a name="l00113"></a>00113             surf += face_normales(num_face,j)*face_normales(num_face,j);
<a name="l00114"></a>00114           surf_max = (surf &gt; surf_max)? surf : surf_max;
<a name="l00115"></a>00115         }
<a name="l00116"></a>00116       vol = volumes(num_elem);
<a name="l00117"></a>00117       vol *=vol/surf_max;
<a name="l00118"></a>00118       diffu2_ = diffu + diffu_turb[num_elem];
<a name="l00119"></a>00119       coef=vol/(2.*<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>*(diffu2_+<a class="code" href="Double_8h.html#a0a3fffa6d17ad8f7de4bb337c6266561">DMINFLOAT</a>));
<a name="l00120"></a>00120       dt_stab = (coef &lt; dt_stab )? coef : dt_stab;
<a name="l00121"></a>00121     }
<a name="l00122"></a>00122   <span class="keywordflow">return</span> dt_stab;
<a name="l00123"></a>00123 }
<a name="l00124"></a>00124 
<a name="l00125"></a>00125 <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a6e76b94ce02508d83a0107d50aa6738f">Op_Dift_VEF_P1NCP1B_Face::</a>
<a name="l00126"></a><a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a6e76b94ce02508d83a0107d50aa6738f">00126</a> <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a6e76b94ce02508d83a0107d50aa6738f">calculer_gradient_elem</a>(<span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; vit,
<a name="l00127"></a>00127                        <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; grad)<span class="keyword"> const</span>
<a name="l00128"></a>00128 <span class="keyword"></span>{
<a name="l00129"></a>00129   <span class="keyword">const</span> <a class="code" href="classZone__VEF__PreP1b.html">Zone_VEF_PreP1b</a>&amp; zone_VEF = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classZone__VEF__PreP1b.html">Zone_VEF_PreP1b</a>,
<a name="l00130"></a>00130                                              (<a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a78f2d5819303c5dfe731f308a5102c47">la_zone_vef</a>.<a class="code" href="classRef__Zone__VEF__PreP1b.html#aeb3b561ce23619afef9061bbbc37bb5e">valeur</a>()));
<a name="l00131"></a>00131 
<a name="l00132"></a>00132   <span class="keyword">const</span> <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone = zone_VEF.<a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>();
<a name="l00133"></a>00133   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; face_normales = zone_VEF.<a class="code" href="classZone__VEF.html#a5742d75972e4846bf9fbb6ed5715053e">face_normales</a>();
<a name="l00134"></a>00134   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; elem_faces=zone_VEF.<a class="code" href="classZone__VF.html#a067e462dcd3ab92b0f6d945b19e4eb37" title="renvoie le numero de le ieme face de la maille num_elem la facon dont ces faces sont numerotees est l...">elem_faces</a>();
<a name="l00135"></a>00135   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; face_voisins=zone_VEF.<a class="code" href="classZone__VF.html#a49d4322f5585a8fa95748ca785b70702" title="renvoie l&#39;element voisin de numface dans la direction i. i=0 : dans le sens oppose de l&#39;axe orthogona...">face_voisins</a>();
<a name="l00136"></a>00136   <span class="keywordtype">int</span> nfe=zone.<a class="code" href="classZone.html#a548fbc7518be2f122b1a5c9589a443c2" title="Renvoie le nombre de face de type i des elements geometriques constituants la zone. Ex: les objets de la classe Prisme ont 2 types de faces: triangle ou quadrangle.">nb_faces_elem</a>();
<a name="l00137"></a>00137   <span class="keywordtype">int</span> nb_elem_tot=zone.<a class="code" href="classZone.html#aa3a33e8b723618b9092460007153e42d" title="Renvoie le nombre total d&#39;elements de la zone.">nb_elem_tot</a>();
<a name="l00138"></a>00138   <span class="keywordtype">int</span> elem,indice,face,compi, compj;
<a name="l00139"></a>00139   <span class="keywordtype">double</span> signe;
<a name="l00140"></a>00140 
<a name="l00141"></a>00141   <span class="keywordflow">for</span>(elem=0; elem&lt;nb_elem_tot; elem++)
<a name="l00142"></a>00142     {
<a name="l00143"></a>00143       <span class="keywordflow">for</span>(indice=0; indice&lt;nfe; indice++)
<a name="l00144"></a>00144         {
<a name="l00145"></a>00145           face = elem_faces(elem,indice);
<a name="l00146"></a>00146           signe=1;
<a name="l00147"></a>00147           <span class="keywordflow">if</span>(elem!=face_voisins(face,0))
<a name="l00148"></a>00148             signe=-1;
<a name="l00149"></a>00149           <span class="keywordflow">for</span>(compi=0; compi&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; compi++)
<a name="l00150"></a>00150             <span class="keywordflow">for</span>(compj=0; compj&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; compj++)
<a name="l00151"></a>00151               grad(elem,compi,compj)+=signe*vit(face, compi)*
<a name="l00152"></a>00152                                       face_normales(face,compj);
<a name="l00153"></a>00153         }
<a name="l00154"></a>00154     }
<a name="l00155"></a>00155   <span class="keywordflow">return</span> grad;
<a name="l00156"></a>00156 }
<a name="l00157"></a>00157 
<a name="l00158"></a>00158 <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a32fac13e1464d3c66046c0f82e32b125">Op_Dift_VEF_P1NCP1B_Face::</a>
<a name="l00159"></a><a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a32fac13e1464d3c66046c0f82e32b125">00159</a> <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a32fac13e1464d3c66046c0f82e32b125">calculer_gradient_som</a>(<span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; vit,
<a name="l00160"></a>00160                       <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; grad)<span class="keyword"> const</span>
<a name="l00161"></a>00161 <span class="keyword"></span>{
<a name="l00162"></a>00162 
<a name="l00163"></a>00163   <span class="keyword">const</span> <a class="code" href="classZone__VEF__PreP1b.html">Zone_VEF_PreP1b</a>&amp; zone_VEF = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classZone__VEF__PreP1b.html">Zone_VEF_PreP1b</a>,
<a name="l00164"></a>00164                                              (<a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a78f2d5819303c5dfe731f308a5102c47">la_zone_vef</a>.<a class="code" href="classRef__Zone__VEF__PreP1b.html#aeb3b561ce23619afef9061bbbc37bb5e">valeur</a>()));
<a name="l00165"></a>00165   <span class="keyword">const</span> <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone = zone_VEF.<a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>();
<a name="l00166"></a>00166   <span class="keyword">const</span> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom=zone.<a class="code" href="classZone.html#a379ad2206b5a13a4f4f3df6d44c7546a" title="Renvoie le domaine dont la zone fait partie. (version const)">domaine</a>();
<a name="l00167"></a>00167   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; face_normales = zone_VEF.<a class="code" href="classZone__VEF.html#a5742d75972e4846bf9fbb6ed5715053e">face_normales</a>();
<a name="l00168"></a>00168   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; som_elem=zone.<a class="code" href="classZone.html#ac115e8342be89afb882b7b61cc343267" title="Renvoie le tableau des sommets des elements.">les_elems</a>();
<a name="l00169"></a>00169   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; elem_faces=zone_VEF.<a class="code" href="classZone__VF.html#a067e462dcd3ab92b0f6d945b19e4eb37" title="renvoie le numero de le ieme face de la maille num_elem la facon dont ces faces sont numerotees est l...">elem_faces</a>();
<a name="l00170"></a>00170   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; face_voisins=zone_VEF.<a class="code" href="classZone__VF.html#a49d4322f5585a8fa95748ca785b70702" title="renvoie l&#39;element voisin de numface dans la direction i. i=0 : dans le sens oppose de l&#39;axe orthogona...">face_voisins</a>();
<a name="l00171"></a>00171 
<a name="l00172"></a>00172   <span class="keywordtype">double</span> mijK, miiK, miK=1./(<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>+1)/(<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>+1);
<a name="l00173"></a>00173   <span class="keywordtype">int</span> nfe=zone.<a class="code" href="classZone.html#a548fbc7518be2f122b1a5c9589a443c2" title="Renvoie le nombre de face de type i des elements geometriques constituants la zone. Ex: les objets de la classe Prisme ont 2 types de faces: triangle ou quadrangle.">nb_faces_elem</a>();
<a name="l00174"></a>00174   <span class="keywordtype">int</span> nb_elem_tot=zone.<a class="code" href="classZone.html#aa3a33e8b723618b9092460007153e42d" title="Renvoie le nombre total d&#39;elements de la zone.">nb_elem_tot</a>();
<a name="l00175"></a>00175   <span class="keywordtype">int</span> nps=zone_VEF.<a class="code" href="classZone__VEF__PreP1b.html#ab469e7b0d67ddcc27e5cf16c3c85e8f4">numero_premier_sommet</a>();
<a name="l00176"></a>00176   <span class="keywordtype">int</span> nb_som=grad.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0)-nb_elem_tot;
<a name="l00177"></a>00177   <span class="keywordtype">int</span> nb_som_elem = zone.<a class="code" href="classZone.html#ae0b34a93b9ae8146df2d1884157afe9f" title="Renvoie le nombre de sommets des elements geometriques constituants la zone. Tous les elements de la ...">nb_som_elem</a>();
<a name="l00178"></a>00178   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; elem_som = zone.<a class="code" href="classZone.html#ac115e8342be89afb882b7b61cc343267" title="Renvoie le tableau des sommets des elements.">les_elems</a>();
<a name="l00179"></a>00179   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> secmem(nb_som, <a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>, <a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>);
<a name="l00180"></a>00180 
<a name="l00181"></a>00181   <span class="keywordflow">if</span>(<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">Objet_U::dimension</a>==2)
<a name="l00182"></a>00182     {
<a name="l00183"></a>00183       mijK=1./12.;
<a name="l00184"></a>00184       miiK= 1./6.;
<a name="l00185"></a>00185     }
<a name="l00186"></a>00186   <span class="keywordflow">else</span>
<a name="l00187"></a>00187     {
<a name="l00188"></a>00188       mijK=1./18.;
<a name="l00189"></a>00189       miiK= 1./12.;
<a name="l00190"></a>00190     }
<a name="l00191"></a>00191 
<a name="l00192"></a>00192   <span class="keywordflow">if</span> ( <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a6d353f570e8e943f6f5db56d82e934c3">masse</a>.<a class="code" href="classMatrice__Morse.html#a1f9bd6aedb226c86b7299689fa5b821a">nb_lignes</a>() &lt;2 )
<a name="l00193"></a>00193     {
<a name="l00194"></a>00194       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;<span class="stringliteral">&quot;On remplit la matrice de masse&quot;</span>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00195"></a>00195       (<a class="code" href="Cast_8h.html#ad3836a067c92103af8df5ad8f35959a6">ref_cast_non_const</a>(<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>,<a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a40e74f95224aacb26c567aa354105bdc">savgrad</a>)).resize(nb_som,<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>,<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>);
<a name="l00196"></a>00196       <a class="code" href="classMatrice__Morse__Sym.html" title="Classe Matrice_Morse_Sym Represente une matrice M (creuse) symetrique stockee au format Morse Symetri...">Matrice_Morse_Sym</a>&amp; mat=<a class="code" href="Cast_8h.html#ad3836a067c92103af8df5ad8f35959a6">ref_cast_non_const</a>(<a class="code" href="classMatrice__Morse__Sym.html" title="Classe Matrice_Morse_Sym Represente une matrice M (creuse) symetrique stockee au format Morse Symetri...">Matrice_Morse_Sym</a>, <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a6d353f570e8e943f6f5db56d82e934c3">masse</a>);
<a name="l00197"></a>00197       <span class="keywordtype">int</span> rang;
<a name="l00198"></a>00198       <span class="keywordtype">int</span> nnz=0;
<a name="l00199"></a>00199       <a class="code" href="classIntLists.html" title="Un tableau de listes de type IntList.">IntLists</a> voisins(nb_som);
<a name="l00200"></a>00200       <a class="code" href="classDoubleLists.html" title="Un tableau de listes de type DoubleList.">DoubleLists</a> coeffs(nb_som);
<a name="l00201"></a>00201       <a class="code" href="classDoubleVect.html">DoubleVect</a> diag(nb_som);
<a name="l00202"></a>00202       <span class="keywordtype">int</span> elem;
<a name="l00203"></a>00203       <span class="keywordflow">for</span> (elem=0; elem&lt;nb_elem_tot; elem++)
<a name="l00204"></a>00204         {
<a name="l00205"></a>00205           <span class="keywordtype">double</span> vol=zone_VEF.<a class="code" href="classZone__VF.html#aea771c835e561469d2d21dbca5fac1cf" title="renvoie le volume de la maille i.">volumes</a>(elem);
<a name="l00206"></a>00206           <span class="keywordtype">double</span> coeff_ij=mijK*vol-miK*vol;
<a name="l00207"></a>00207           <span class="keywordtype">double</span> coeff_ii=miiK*vol-miK*vol;
<a name="l00208"></a>00208           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> isom=0; isom&lt;nb_som_elem; isom++)
<a name="l00209"></a>00209             {
<a name="l00210"></a>00210               <span class="keywordtype">int</span> som=elem_som(elem,isom);
<a name="l00211"></a>00211               <span class="keywordtype">int</span> ii=dom.<a class="code" href="classDomaine.html#a37cc657f1907d53b0d5a573da862af80">get_renum_som_perio</a>(som);
<a name="l00212"></a>00212               diag[ii]+=coeff_ii;
<a name="l00213"></a>00213               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> jsom=isom+1; jsom&lt;nb_som_elem; jsom++)
<a name="l00214"></a>00214                 {
<a name="l00215"></a>00215                   <span class="keywordtype">int</span> sombis=elem_som(elem,jsom);
<a name="l00216"></a>00216                   <span class="keywordtype">int</span> j=dom.<a class="code" href="classDomaine.html#a37cc657f1907d53b0d5a573da862af80">get_renum_som_perio</a>(sombis);
<a name="l00217"></a>00217                   <span class="keywordtype">int</span> i=ii;
<a name="l00218"></a>00218                   <span class="keywordflow">if</span>(i&gt;j)
<a name="l00219"></a>00219                     {
<a name="l00220"></a>00220                       <span class="keywordtype">int</span> kl=j;
<a name="l00221"></a>00221                       j=i;
<a name="l00222"></a>00222                       i=kl;
<a name="l00223"></a>00223                     }
<a name="l00224"></a>00224                   rang=voisins[i].rang(j);
<a name="l00225"></a>00225                   <span class="keywordflow">if</span>(rang==-1)
<a name="l00226"></a>00226                     {
<a name="l00227"></a>00227                       voisins[i].add(j);
<a name="l00228"></a>00228                       coeffs[i].add(coeff_ij);
<a name="l00229"></a>00229                       nnz++;
<a name="l00230"></a>00230                     }
<a name="l00231"></a>00231                   <span class="keywordflow">else</span>
<a name="l00232"></a>00232                     {
<a name="l00233"></a>00233                       coeffs[i][rang]+=coeff_ij;
<a name="l00234"></a>00234                     }
<a name="l00235"></a>00235                 }
<a name="l00236"></a>00236             }
<a name="l00237"></a>00237         }
<a name="l00238"></a>00238 
<a name="l00239"></a>00239 
<a name="l00240"></a>00240       {
<a name="l00241"></a>00241         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nb_som; i++)
<a name="l00242"></a>00242           <span class="keywordflow">if</span>(diag(i)==0)
<a name="l00243"></a>00243             diag(i)=1.;
<a name="l00244"></a>00244       }
<a name="l00245"></a>00245 
<a name="l00246"></a>00246       mat.<a class="code" href="classMatrice__Morse.html#ae95f9ed88a8a3fc637cd2a705cead9c8" title="Size the matrix with n lines and n columns and nnz zero-values coefficients.">dimensionner</a>(nb_som, nnz+nb_som) ;
<a name="l00247"></a>00247       mat.<a class="code" href="classMatrice__Morse.html#aedf08423430f9c0b1a9a967d6bb80c9d">remplir</a>(voisins, coeffs, diag) ;
<a name="l00248"></a>00248       mat.<a class="code" href="classMatrice__Morse__Sym.html#a02a9b6a6a9b5f47bed207ff5a0f92e69" title="Suppression des doublons on ordonne tab2; Verification de la diagonale: tous ses elements doivent etr...">compacte</a>() ;
<a name="l00249"></a>00249       mat.<a class="code" href="classMatrice__Sym.html#a532cf830aed3865010c9977b545927c0">set_est_definie</a>(1);
<a name="l00250"></a>00250     }
<a name="l00251"></a>00251   <span class="keywordtype">int</span> elem,indice,face,compi,compj,som;
<a name="l00252"></a>00252   <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> sigma(<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>);
<a name="l00253"></a>00253   <span class="keyword">static</span> <span class="keywordtype">double</span> coeff_som=1./(<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>)/(<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>+1);
<a name="l00254"></a>00254   <span class="keywordtype">double</span> signe;
<a name="l00255"></a>00255 
<a name="l00256"></a>00256   <span class="keywordflow">for</span>(elem=0; elem&lt;nb_elem_tot; elem++)
<a name="l00257"></a>00257     {
<a name="l00258"></a>00258       sigma = 0;
<a name="l00259"></a>00259       <span class="keywordflow">for</span>(indice=0; indice&lt;nfe; indice++)
<a name="l00260"></a>00260         {
<a name="l00261"></a>00261           face = elem_faces(elem,indice);
<a name="l00262"></a>00262           <span class="keywordflow">for</span>(<span class="keywordtype">int</span> comp=0; comp&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; comp++)
<a name="l00263"></a>00263             sigma[comp]+=vit(face, comp);
<a name="l00264"></a>00264         }
<a name="l00265"></a>00265       <span class="keywordflow">for</span>(indice=0; indice&lt;nfe; indice++)
<a name="l00266"></a>00266         {
<a name="l00267"></a>00267           som = dom.<a class="code" href="classDomaine.html#a37cc657f1907d53b0d5a573da862af80">get_renum_som_perio</a>(som_elem(elem,indice));
<a name="l00268"></a>00268           face = elem_faces(elem,indice);
<a name="l00269"></a>00269           signe=1;
<a name="l00270"></a>00270           <span class="keywordflow">if</span>(elem!=face_voisins(face,0))
<a name="l00271"></a>00271             signe=-1;
<a name="l00272"></a>00272           <span class="keywordflow">for</span>(compi=0; compi&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; compi++)
<a name="l00273"></a>00273             <span class="keywordflow">for</span>(compj=0; compj&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; compj++)
<a name="l00274"></a>00274               secmem(som, compi, compj)+=coeff_som*signe*
<a name="l00275"></a>00275                                          sigma[compi]*face_normales(face,compj);
<a name="l00276"></a>00276         }
<a name="l00277"></a>00277     }
<a name="l00278"></a>00278 <span class="comment">// Cerr &lt;&lt; &quot;Avant CL secmem = &quot; &lt;&lt; secmem &lt;&lt; finl;</span>
<a name="l00279"></a>00279   <span class="keyword">const</span> <a class="code" href="classZone__Cl__VEF.html">Zone_Cl_VEF</a>&amp; zone_Cl_VEF = <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a35daf718670338d47818fb8d4542d22e">la_zcl_vef</a>.<a class="code" href="classRef__Zone__Cl__VEFP1B.html#aa36bff02c3f86a9d9ee30929c4127728">valeur</a>();
<a name="l00280"></a>00280   <span class="keyword">const</span> <a class="code" href="classConds__lim.html">Conds_lim</a>&amp; les_cl = zone_Cl_VEF.<a class="code" href="classZone__Cl__dis__base.html#af75e0ed7786863e4d333bfb29d67c323" title="Renvoie la i-ieme condition aux limites. (version const)">les_conditions_limites</a>();
<a name="l00281"></a>00281   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; face_sommets = zone_VEF.<a class="code" href="classZone__VF.html#a298e73b18e17da55f421b1fb0879bd46" title="renvoie le numero du ieme sommet de la face num_face.">face_sommets</a>();
<a name="l00282"></a>00282   <span class="keywordtype">int</span> nb_bords =les_cl.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>();
<a name="l00283"></a>00283   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n_bord=0; n_bord&lt;nb_bords; n_bord++)
<a name="l00284"></a>00284     {
<a name="l00285"></a>00285       <span class="keyword">const</span> <a class="code" href="classCond__lim.html" title="classe Cond_lim Classe generique servant a representer n&#39;importe quelle classe derivee de la classe C...">Cond_lim</a>&amp; la_cl = zone_Cl_VEF.<a class="code" href="classZone__Cl__dis__base.html#af75e0ed7786863e4d333bfb29d67c323" title="Renvoie la i-ieme condition aux limites. (version const)">les_conditions_limites</a>(n_bord);
<a name="l00286"></a>00286       {
<a name="l00287"></a>00287         <span class="keywordflow">if</span> (!<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classPeriodique.html" title="classe Periodique Cette classe represente une condition aux limites periodique. On peut specifier une...">Periodique</a>,la_cl.<a class="code" href="classDeriv__Cond__lim__base.html#a482c910c704f6f51065a8b7d25acf48a">valeur</a>()))
<a name="l00288"></a>00288           {
<a name="l00289"></a>00289             <span class="keyword">const</span> <a class="code" href="classFront__VF.html" title="class Front_VF">Front_VF</a>&amp; le_bord = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classFront__VF.html" title="class Front_VF">Front_VF</a>,la_cl.<a class="code" href="classCond__lim.html#a5b2d24809cee07727006a891d4ce8d22" title="Appel a l&#39;objet sous-jacent Renvoie la frontiere discretisee associee a la condition aux limites...">frontiere_dis</a>());
<a name="l00290"></a>00290             <span class="keywordtype">int</span> num1 = le_bord.<a class="code" href="classFront__VF.html#a4986f0c65653fe9eb40bbbff5a97bf16" title="Numero de la premiere face du bord dans la liste des faces.">num_premiere_face</a>();
<a name="l00291"></a>00291             <span class="keywordtype">int</span> num2 = num1 + le_bord.<a class="code" href="classFront__VF.html#a341e2fcb5117b96e745fd7078ba86bab" title="Nombre de faces reelles du bord.">nb_faces</a>();
<a name="l00292"></a>00292             <span class="keywordflow">for</span> (face=num1; face&lt;num2; face++)
<a name="l00293"></a>00293               {
<a name="l00294"></a>00294                 <span class="keywordflow">for</span>(indice=0; indice&lt;(nfe-1); indice++)
<a name="l00295"></a>00295                   {
<a name="l00296"></a>00296                     som=dom.<a class="code" href="classDomaine.html#a37cc657f1907d53b0d5a573da862af80">get_renum_som_perio</a>(face_sommets(face,indice));
<a name="l00297"></a>00297                     <span class="keywordflow">for</span> (compi=0; compi&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; compi++)
<a name="l00298"></a>00298                       <span class="keywordflow">for</span> (compj=0; compj&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; compj++)
<a name="l00299"></a>00299                         secmem(som, compi, compj) += 1./dimension*
<a name="l00300"></a>00300                                                      vit(face,compi) * face_normales(face,compj) ;
<a name="l00301"></a>00301                   }
<a name="l00302"></a>00302               }
<a name="l00303"></a>00303           }
<a name="l00304"></a>00304       }
<a name="l00305"></a>00305     }
<a name="l00306"></a>00306 <span class="comment">// Cerr &lt;&lt; &quot;Apres CL secmem = &quot; &lt;&lt; secmem &lt;&lt; finl;</span>
<a name="l00307"></a>00307   <span class="keywordtype">double</span> <a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a>=1./(<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>+1.);
<a name="l00308"></a>00308   {
<a name="l00309"></a>00309     <a class="code" href="classDoubleVect.html">DoubleVect</a> secmemij;
<a name="l00310"></a>00310     <a class="code" href="classDoubleVect.html">DoubleVect</a> gradij;
<a name="l00311"></a>00311     dom.<a class="code" href="classDomaine.html#a32c7de9f9e8e78e3d5ea68715b2ceb2b" title="Cree un tableau ayant une &quot;ligne&quot; par sommet du maillage. Voir MD_Vector_tools::creer_tableau_distrib...">creer_tableau_sommets</a>(secmemij);
<a name="l00312"></a>00312     dom.<a class="code" href="classDomaine.html#a32c7de9f9e8e78e3d5ea68715b2ceb2b" title="Cree un tableau ayant une &quot;ligne&quot; par sommet du maillage. Voir MD_Vector_tools::creer_tableau_distrib...">creer_tableau_sommets</a>(gradij);
<a name="l00313"></a>00313     <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; sgrad = <a class="code" href="Cast_8h.html#ad3836a067c92103af8df5ad8f35959a6">ref_cast_non_const</a>(<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>, <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a40e74f95224aacb26c567aa354105bdc">savgrad</a>);
<a name="l00314"></a>00314 
<a name="l00315"></a>00315     <span class="keywordflow">for</span> (compi=0; compi&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; compi++)
<a name="l00316"></a>00316       <span class="keywordflow">for</span> (compj=0; compj&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; compj++)
<a name="l00317"></a>00317         {
<a name="l00318"></a>00318           <span class="keywordtype">int</span> i;
<a name="l00319"></a>00319           <span class="keywordflow">for</span>(i=0; i&lt;nb_som; i++)
<a name="l00320"></a>00320             {
<a name="l00321"></a>00321               <span class="keywordtype">int</span> soml=dom.<a class="code" href="classDomaine.html#a37cc657f1907d53b0d5a573da862af80">get_renum_som_perio</a>(i);
<a name="l00322"></a>00322               secmemij(soml)=secmem(soml,compi,compj);
<a name="l00323"></a>00323               gradij(soml)=sgrad(soml,compi,compj);
<a name="l00324"></a>00324             }
<a name="l00325"></a>00325           <span class="keywordflow">for</span>(elem=0; elem&lt;nb_elem_tot; elem++)
<a name="l00326"></a>00326             <span class="keywordflow">for</span>(indice=0; indice&lt;nfe; indice++)
<a name="l00327"></a>00327               {
<a name="l00328"></a>00328                 som = dom.<a class="code" href="classDomaine.html#a37cc657f1907d53b0d5a573da862af80">get_renum_som_perio</a>(som_elem(elem,indice));
<a name="l00329"></a>00329                 secmemij(som)-=coeff*grad(elem,compi,compj);
<a name="l00330"></a>00330               }
<a name="l00331"></a>00331           (<a class="code" href="Cast_8h.html#ad3836a067c92103af8df5ad8f35959a6">ref_cast_non_const</a>(<a class="code" href="classSolveurSys.html">SolveurSys</a>,<a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#aa6d7c2eb34e21533009c8573bc7d978b">solveur</a>)).resoudre_systeme(<a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a6d353f570e8e943f6f5db56d82e934c3">masse</a>, secmemij, gradij);
<a name="l00332"></a>00332           <span class="keywordflow">for</span>(i=0; i&lt;nb_som; i++)
<a name="l00333"></a>00333             {
<a name="l00334"></a>00334               <span class="keywordtype">int</span> soml=dom.<a class="code" href="classDomaine.html#a37cc657f1907d53b0d5a573da862af80">get_renum_som_perio</a>(i);
<a name="l00335"></a>00335               <span class="keywordtype">double</span> x = gradij(soml);
<a name="l00336"></a>00336               grad(nps+soml,compi,compj)=x;
<a name="l00337"></a>00337               sgrad(soml,compi,compj)=x;
<a name="l00338"></a>00338             }
<a name="l00339"></a>00339         }
<a name="l00340"></a>00340   }
<a name="l00341"></a>00341   <span class="keywordflow">for</span> (elem=0; elem&lt;nb_elem_tot; elem++)
<a name="l00342"></a>00342     {
<a name="l00343"></a>00343       <span class="keywordtype">double</span> vol=zone_VEF.<a class="code" href="classZone__VF.html#aea771c835e561469d2d21dbca5fac1cf" title="renvoie le volume de la maille i.">volumes</a>(elem);
<a name="l00344"></a>00344       <span class="keywordflow">for</span> (compi=0; compi&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; compi++)
<a name="l00345"></a>00345         <span class="keywordflow">for</span> (compj=0; compj&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; compj++)
<a name="l00346"></a>00346           grad(elem,compi,compj)/=vol;
<a name="l00347"></a>00347       <span class="keywordflow">for</span>(indice=0; indice&lt;nfe; indice++)
<a name="l00348"></a>00348         {
<a name="l00349"></a>00349           som = nps+dom.<a class="code" href="classDomaine.html#a37cc657f1907d53b0d5a573da862af80">get_renum_som_perio</a>(som_elem(elem,indice));
<a name="l00350"></a>00350           <span class="keywordflow">for</span> (compi=0; compi&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; compi++)
<a name="l00351"></a>00351             <span class="keywordflow">for</span> (compj=0; compj&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; compj++)
<a name="l00352"></a>00352               grad(elem,compi,compj)-=coeff*grad(som,compi,compj);
<a name="l00353"></a>00353         }
<a name="l00354"></a>00354     }
<a name="l00355"></a>00355 
<a name="l00356"></a>00356   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> tmp(grad);
<a name="l00357"></a>00357   <span class="keywordtype">int</span> ntot=tmp.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00358"></a>00358   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ind=0; ind&lt;ntot; ind++)
<a name="l00359"></a>00359     <span class="keywordflow">for</span> (compi=0; compi&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; compi++)
<a name="l00360"></a>00360       <span class="keywordflow">for</span> (compj=0; compj&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; compj++)
<a name="l00361"></a>00361         tmp(ind,compi, compj)=0.5*(grad(ind,compi, compj)+grad(ind,compj, compi));
<a name="l00362"></a>00362   grad=tmp;
<a name="l00363"></a>00363 <span class="comment">// Cout &lt;&lt; &quot;grad = &quot; &lt;&lt; grad &lt;&lt; finl;</span>
<a name="l00364"></a>00364   <span class="keywordflow">return</span> grad;
<a name="l00365"></a>00365 }
<a name="l00366"></a>00366 
<a name="l00367"></a>00367 <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a28c03caccab9e00d8fdc7f7bd1ece435">Op_Dift_VEF_P1NCP1B_Face::</a>
<a name="l00368"></a><a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a28c03caccab9e00d8fdc7f7bd1ece435">00368</a> <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a28c03caccab9e00d8fdc7f7bd1ece435">corriger_div_pour_Cl</a>(<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; div )<span class="keyword"> const</span>
<a name="l00369"></a>00369 <span class="keyword"></span>{
<a name="l00370"></a>00370   <span class="keyword">const</span> <a class="code" href="classZone__VEF__PreP1b.html">Zone_VEF_PreP1b</a>&amp; zone_VEF = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classZone__VEF__PreP1b.html">Zone_VEF_PreP1b</a>,
<a name="l00371"></a>00371                                              <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a78f2d5819303c5dfe731f308a5102c47">la_zone_vef</a>.<a class="code" href="classRef__Zone__VEF__PreP1b.html#aeb3b561ce23619afef9061bbbc37bb5e">valeur</a>());
<a name="l00372"></a>00372   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; face_normales = zone_VEF.<a class="code" href="classZone__VEF.html#a5742d75972e4846bf9fbb6ed5715053e">face_normales</a>();
<a name="l00373"></a>00373   <span class="keyword">const</span> <a class="code" href="classZone__Cl__VEF.html">Zone_Cl_VEF</a>&amp; zone_Cl_VEF=<a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a35daf718670338d47818fb8d4542d22e">la_zcl_vef</a>.<a class="code" href="classRef__Zone__Cl__VEFP1B.html#aa36bff02c3f86a9d9ee30929c4127728">valeur</a>();
<a name="l00374"></a>00374   <span class="keyword">const</span> <a class="code" href="classConds__lim.html">Conds_lim</a>&amp; les_cl = zone_Cl_VEF.<a class="code" href="classZone__Cl__dis__base.html#af75e0ed7786863e4d333bfb29d67c323" title="Renvoie la i-ieme condition aux limites. (version const)">les_conditions_limites</a>();
<a name="l00375"></a>00375   <span class="keywordtype">int</span> nb_bords =les_cl.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>();
<a name="l00376"></a>00376   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n_bord=0; n_bord&lt;nb_bords; n_bord++)
<a name="l00377"></a>00377     {
<a name="l00378"></a>00378       <span class="keyword">const</span> <a class="code" href="classCond__lim.html" title="classe Cond_lim Classe generique servant a representer n&#39;importe quelle classe derivee de la classe C...">Cond_lim</a>&amp; la_cl = zone_Cl_VEF.<a class="code" href="classZone__Cl__dis__base.html#af75e0ed7786863e4d333bfb29d67c323" title="Renvoie la i-ieme condition aux limites. (version const)">les_conditions_limites</a>(n_bord);
<a name="l00379"></a>00379       {
<a name="l00380"></a>00380         <span class="keyword">const</span> <a class="code" href="classFront__VF.html" title="class Front_VF">Front_VF</a>&amp; le_bord = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classFront__VF.html" title="class Front_VF">Front_VF</a>,la_cl.<a class="code" href="classCond__lim.html#a5b2d24809cee07727006a891d4ce8d22" title="Appel a l&#39;objet sous-jacent Renvoie la frontiere discretisee associee a la condition aux limites...">frontiere_dis</a>());
<a name="l00381"></a>00381         <span class="keywordtype">int</span> num1 = le_bord.<a class="code" href="classFront__VF.html#a4986f0c65653fe9eb40bbbff5a97bf16" title="Numero de la premiere face du bord dans la liste des faces.">num_premiere_face</a>();
<a name="l00382"></a>00382         <span class="keywordtype">int</span> num2 = num1 + le_bord.<a class="code" href="classFront__VF.html#a341e2fcb5117b96e745fd7078ba86bab" title="Nombre de faces reelles du bord.">nb_faces</a>();
<a name="l00383"></a>00383         <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classPeriodique.html" title="classe Periodique Cette classe represente une condition aux limites periodique. On peut specifier une...">Periodique</a>,la_cl.<a class="code" href="classDeriv__Cond__lim__base.html#a482c910c704f6f51065a8b7d25acf48a">valeur</a>()))
<a name="l00384"></a>00384           {
<a name="l00385"></a>00385 <span class="comment">// periodicite</span>
<a name="l00386"></a>00386             <span class="keyword">const</span> <a class="code" href="classPeriodique.html" title="classe Periodique Cette classe represente une condition aux limites periodique. On peut specifier une...">Periodique</a>&amp; la_cl_perio = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classPeriodique.html" title="classe Periodique Cette classe represente une condition aux limites periodique. On peut specifier une...">Periodique</a>,
<a name="l00387"></a>00387                                                      la_cl.<a class="code" href="classDeriv__Cond__lim__base.html#a482c910c704f6f51065a8b7d25acf48a">valeur</a>());
<a name="l00388"></a>00388             <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> fait(le_bord.<a class="code" href="classFront__VF.html#a341e2fcb5117b96e745fd7078ba86bab" title="Nombre de faces reelles du bord.">nb_faces</a>());
<a name="l00389"></a>00389             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> face=num1; face&lt;num2; face++)
<a name="l00390"></a>00390               {
<a name="l00391"></a>00391                 <span class="keywordflow">if</span>(!fait(face-num1))
<a name="l00392"></a>00392                   {
<a name="l00393"></a>00393                     <span class="keywordtype">int</span> <a class="code" href="AssembleurPP1BUtil_8cpp.html#a3e374d53ebc7860e1c2f0b7906f2936d">face_associee</a>=num1+la_cl_perio.<a class="code" href="classPeriodique.html#a207b86556f199a63ea059b841851ca6a">face_associee</a>(face-num1);
<a name="l00394"></a>00394                     fait(face-num1)=(fait(face_associee-num1)=1);
<a name="l00395"></a>00395                     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> comp=0; comp&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; comp++)
<a name="l00396"></a>00396                       {
<a name="l00397"></a>00397                         div(face,comp)+= div(face_associee,comp);
<a name="l00398"></a>00398                         div(face_associee,comp)=div(face,comp);
<a name="l00399"></a>00399                       }
<a name="l00400"></a>00400                   }
<a name="l00401"></a>00401               }
<a name="l00402"></a>00402           }
<a name="l00403"></a>00403         <span class="keywordflow">else</span>
<a name="l00404"></a>00404           {
<a name="l00405"></a>00405             <span class="keywordflow">if</span>(<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classSymetrie.html" title="classe Symetrie Sur les faces de symetrie on a les proprietes suivantes: - composante normale de la v...">Symetrie</a>,la_cl.<a class="code" href="classDeriv__Cond__lim__base.html#a482c910c704f6f51065a8b7d25acf48a">valeur</a>()))
<a name="l00406"></a>00406               {
<a name="l00407"></a>00407                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> face=num1; face&lt;num2; face++)
<a name="l00408"></a>00408                   {
<a name="l00409"></a>00409                     <span class="keywordtype">double</span> psc=0;
<a name="l00410"></a>00410                     <span class="keywordtype">double</span> <a class="code" href="Double_8h.html#ac842198e9490fae75825cab2a03eed2d">norme</a>=0;
<a name="l00411"></a>00411                     <span class="keywordtype">int</span> comp;
<a name="l00412"></a>00412                     <span class="keywordflow">for</span> (comp=0; comp&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; comp++)
<a name="l00413"></a>00413                       psc += div(face,comp)*face_normales(face,comp);
<a name="l00414"></a>00414                     <span class="keywordflow">for</span> (comp=0; comp&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; comp++)
<a name="l00415"></a>00415                       norme += face_normales(face,comp)*face_normales(face,comp);
<a name="l00416"></a>00416 
<a name="l00417"></a>00417 <span class="comment">// psc/=norme; // Fixed bug: Arithmetic exception</span>
<a name="l00418"></a>00418                     <span class="keywordflow">if</span> (<a class="code" href="Double_8h.html#aaecd4ca8a2fe69cc6568af2938b94d2e">dabs</a>(norme)&gt;=<a class="code" href="Double_8h.html#a0a3fffa6d17ad8f7de4bb337c6266561">DMINFLOAT</a>) psc/=<a class="code" href="Double_8h.html#ac842198e9490fae75825cab2a03eed2d">norme</a>;
<a name="l00419"></a>00419                     <span class="keywordflow">for</span> (comp=0; comp&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; comp++)
<a name="l00420"></a>00420                       div(face,comp)-=psc*face_normales(face,comp);
<a name="l00421"></a>00421                   }
<a name="l00422"></a>00422               }
<a name="l00423"></a>00423           }
<a name="l00424"></a>00424       }
<a name="l00425"></a>00425     }
<a name="l00426"></a>00426 <span class="comment">// Cout &lt;&lt; &quot;div = &quot; &lt;&lt; div &lt;&lt; finl;</span>
<a name="l00427"></a>00427   <span class="keywordflow">return</span> div;
<a name="l00428"></a>00428 }
<a name="l00429"></a>00429 
<a name="l00430"></a>00430 <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a2102438bf779d8a5377ac39b4b67a2f5">Op_Dift_VEF_P1NCP1B_Face::</a>
<a name="l00431"></a><a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a2102438bf779d8a5377ac39b4b67a2f5">00431</a> <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a2102438bf779d8a5377ac39b4b67a2f5">calculer_divergence_elem</a>(<span class="keywordtype">double</span> nu, <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; nu_turb,
<a name="l00432"></a>00432                          <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; grad,
<a name="l00433"></a>00433                          <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; div)<span class="keyword"> const</span>
<a name="l00434"></a>00434 <span class="keyword"></span>{
<a name="l00435"></a>00435   <span class="keyword">const</span> <a class="code" href="classZone__VEF__PreP1b.html">Zone_VEF_PreP1b</a>&amp; zone_VEF = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classZone__VEF__PreP1b.html">Zone_VEF_PreP1b</a>,
<a name="l00436"></a>00436                                              <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a78f2d5819303c5dfe731f308a5102c47">la_zone_vef</a>.<a class="code" href="classRef__Zone__VEF__PreP1b.html#aeb3b561ce23619afef9061bbbc37bb5e">valeur</a>());
<a name="l00437"></a>00437   <span class="keyword">const</span> <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone = zone_VEF.<a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>();
<a name="l00438"></a>00438   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; face_normales = zone_VEF.<a class="code" href="classZone__VEF.html#a5742d75972e4846bf9fbb6ed5715053e">face_normales</a>();
<a name="l00439"></a>00439   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; elem_faces=zone_VEF.<a class="code" href="classZone__VF.html#a067e462dcd3ab92b0f6d945b19e4eb37" title="renvoie le numero de le ieme face de la maille num_elem la facon dont ces faces sont numerotees est l...">elem_faces</a>();
<a name="l00440"></a>00440   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; face_voisins=zone_VEF.<a class="code" href="classZone__VF.html#a49d4322f5585a8fa95748ca785b70702" title="renvoie l&#39;element voisin de numface dans la direction i. i=0 : dans le sens oppose de l&#39;axe orthogona...">face_voisins</a>();
<a name="l00441"></a>00441   <span class="keywordtype">int</span> nfe=zone.nb_faces_elem();
<a name="l00442"></a>00442   <span class="keywordtype">int</span> nb_elem_tot=zone.nb_elem_tot();
<a name="l00443"></a>00443 
<a name="l00444"></a>00444   <span class="keywordtype">int</span> elem,indice,face,compi, compj;
<a name="l00445"></a>00445   <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> sigma(<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>);
<a name="l00446"></a>00446   <span class="keywordflow">for</span>(elem=0; elem&lt;nb_elem_tot; elem++)
<a name="l00447"></a>00447     {
<a name="l00448"></a>00448       <span class="keywordtype">double</span> nu_tot=nu+nu_turb(elem);
<a name="l00449"></a>00449       <span class="keywordflow">for</span>(indice=0; indice&lt;nfe; indice++)
<a name="l00450"></a>00450         {
<a name="l00451"></a>00451           face = elem_faces(elem,indice);
<a name="l00452"></a>00452           <span class="keywordtype">double</span> signe=1;
<a name="l00453"></a>00453           <span class="keywordflow">if</span>(elem!=face_voisins(face,0))
<a name="l00454"></a>00454             signe=-1;
<a name="l00455"></a>00455           <span class="keywordflow">for</span>(compi=0; compi&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; compi++)
<a name="l00456"></a>00456             <span class="keywordflow">for</span>(compj=0; compj&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; compj++)
<a name="l00457"></a>00457               div(face, compi)-=nu_tot*grad(elem, compi, compj)
<a name="l00458"></a>00458                                 *signe*face_normales(face,compj);
<a name="l00459"></a>00459         }
<a name="l00460"></a>00460     }
<a name="l00461"></a>00461 <span class="comment">// Cerr &lt;&lt; &quot;AP elem div =&quot; &lt;&lt; div &lt;&lt; finl;</span>
<a name="l00462"></a>00462   <span class="keywordflow">return</span> div;
<a name="l00463"></a>00463 }
<a name="l00464"></a>00464 <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#ad41ae3d76a9d3ad557208ba84cd4dca5">Op_Dift_VEF_P1NCP1B_Face::</a>
<a name="l00465"></a><a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#ad41ae3d76a9d3ad557208ba84cd4dca5">00465</a> <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#ad41ae3d76a9d3ad557208ba84cd4dca5">calculer_divergence_som</a>(<span class="keywordtype">double</span> nu, <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; nu_turb,
<a name="l00466"></a>00466                         <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; grad,
<a name="l00467"></a>00467                         <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; div)<span class="keyword"> const</span>
<a name="l00468"></a>00468 <span class="keyword"></span>{
<a name="l00469"></a>00469   <span class="keyword">const</span> <a class="code" href="classZone__VEF__PreP1b.html">Zone_VEF_PreP1b</a>&amp; zone_VEF = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classZone__VEF__PreP1b.html">Zone_VEF_PreP1b</a>,
<a name="l00470"></a>00470                                              <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a78f2d5819303c5dfe731f308a5102c47">la_zone_vef</a>.<a class="code" href="classRef__Zone__VEF__PreP1b.html#aeb3b561ce23619afef9061bbbc37bb5e">valeur</a>());
<a name="l00471"></a>00471   <span class="keyword">const</span> <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone = zone_VEF.<a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>();
<a name="l00472"></a>00472   <span class="keyword">const</span> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom=zone.domaine();
<a name="l00473"></a>00473   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; face_normales = zone_VEF.<a class="code" href="classZone__VEF.html#a5742d75972e4846bf9fbb6ed5715053e">face_normales</a>();
<a name="l00474"></a>00474   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; som_elem=zone.les_elems();
<a name="l00475"></a>00475   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; elem_faces=zone_VEF.<a class="code" href="classZone__VF.html#a067e462dcd3ab92b0f6d945b19e4eb37" title="renvoie le numero de le ieme face de la maille num_elem la facon dont ces faces sont numerotees est l...">elem_faces</a>();
<a name="l00476"></a>00476   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; face_voisins=zone_VEF.<a class="code" href="classZone__VF.html#a49d4322f5585a8fa95748ca785b70702" title="renvoie l&#39;element voisin de numface dans la direction i. i=0 : dans le sens oppose de l&#39;axe orthogona...">face_voisins</a>();
<a name="l00477"></a>00477   <span class="keywordtype">int</span> nfe=zone.nb_faces_elem();
<a name="l00478"></a>00478   <span class="keywordtype">int</span> nb_elem_tot=zone.nb_elem_tot();
<a name="l00479"></a>00479   <span class="keywordtype">int</span> nps=zone_VEF.<a class="code" href="classZone__VEF__PreP1b.html#ab469e7b0d67ddcc27e5cf16c3c85e8f4">numero_premier_sommet</a>();
<a name="l00480"></a>00480   <span class="keywordtype">int</span> elem,indice,indice2,face,compi,compj,som;
<a name="l00481"></a>00481   <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> sigma(<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>);
<a name="l00482"></a>00482   <span class="keyword">static</span> <span class="keywordtype">double</span> coeff_som=1./(<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>)/(<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>+1);
<a name="l00483"></a>00483   <span class="keywordflow">for</span>(elem=0; elem&lt;nb_elem_tot; elem++)
<a name="l00484"></a>00484     {
<a name="l00485"></a>00485       <span class="keywordtype">double</span> nu_tot=nu+nu_turb(elem);
<a name="l00486"></a>00486       <span class="keywordflow">for</span>(indice=0; indice&lt;nfe; indice++)
<a name="l00487"></a>00487         {
<a name="l00488"></a>00488           som = nps+dom.<a class="code" href="classDomaine.html#a37cc657f1907d53b0d5a573da862af80">get_renum_som_perio</a>(som_elem(elem,indice));
<a name="l00489"></a>00489           face = elem_faces(elem,indice);
<a name="l00490"></a>00490           <span class="keywordtype">double</span> signe=1;
<a name="l00491"></a>00491           <span class="keywordflow">if</span>(elem!=face_voisins(face,0))
<a name="l00492"></a>00492             signe=-1;
<a name="l00493"></a>00493           <span class="keywordflow">for</span>(<span class="keywordtype">int</span> comp=0; comp&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; comp++)
<a name="l00494"></a>00494             {
<a name="l00495"></a>00495               sigma[comp]=signe*face_normales(face,comp);
<a name="l00496"></a>00496             }
<a name="l00497"></a>00497           <span class="keywordflow">for</span>(indice2=0; indice2&lt;nfe; indice2++)
<a name="l00498"></a>00498             <span class="keywordflow">for</span>(compi=0; compi&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; compi++)
<a name="l00499"></a>00499               <span class="keywordflow">for</span>(compj=0; compj&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; compj++)
<a name="l00500"></a>00500                 div(elem_faces(elem,indice2),compi)-=coeff_som*nu_tot*
<a name="l00501"></a>00501                                                      grad(som,compi,compj)*sigma[compj];
<a name="l00502"></a>00502         }
<a name="l00503"></a>00503     }
<a name="l00504"></a>00504 <span class="comment">// Cerr &lt;&lt; &quot;div AV CL : &quot; &lt;&lt; div &lt;&lt; finl;</span>
<a name="l00505"></a>00505   <span class="keyword">const</span> <a class="code" href="classZone__Cl__VEF.html">Zone_Cl_VEF</a>&amp; zone_Cl_VEF = <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a35daf718670338d47818fb8d4542d22e">la_zcl_vef</a>.<a class="code" href="classRef__Zone__Cl__VEFP1B.html#aa36bff02c3f86a9d9ee30929c4127728">valeur</a>();
<a name="l00506"></a>00506   <span class="keyword">const</span> <a class="code" href="classConds__lim.html">Conds_lim</a>&amp; les_cl = zone_Cl_VEF.<a class="code" href="classZone__Cl__dis__base.html#af75e0ed7786863e4d333bfb29d67c323" title="Renvoie la i-ieme condition aux limites. (version const)">les_conditions_limites</a>();
<a name="l00507"></a>00507   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; face_sommets = zone_VEF.<a class="code" href="classZone__VF.html#a298e73b18e17da55f421b1fb0879bd46" title="renvoie le numero du ieme sommet de la face num_face.">face_sommets</a>();
<a name="l00508"></a>00508   <span class="keywordtype">int</span> nb_bords =les_cl.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>();
<a name="l00509"></a>00509   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n_bord=0; n_bord&lt;nb_bords; n_bord++)
<a name="l00510"></a>00510     {
<a name="l00511"></a>00511       <span class="keyword">const</span> <a class="code" href="classCond__lim.html" title="classe Cond_lim Classe generique servant a representer n&#39;importe quelle classe derivee de la classe C...">Cond_lim</a>&amp; la_cl = zone_Cl_VEF.<a class="code" href="classZone__Cl__dis__base.html#af75e0ed7786863e4d333bfb29d67c323" title="Renvoie la i-ieme condition aux limites. (version const)">les_conditions_limites</a>(n_bord);
<a name="l00512"></a>00512       {
<a name="l00513"></a>00513         <span class="keyword">const</span> <a class="code" href="classFront__VF.html" title="class Front_VF">Front_VF</a>&amp; le_bord = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classFront__VF.html" title="class Front_VF">Front_VF</a>,la_cl.<a class="code" href="classCond__lim.html#a5b2d24809cee07727006a891d4ce8d22" title="Appel a l&#39;objet sous-jacent Renvoie la frontiere discretisee associee a la condition aux limites...">frontiere_dis</a>());
<a name="l00514"></a>00514         <span class="keywordtype">int</span> num1 = le_bord.<a class="code" href="classFront__VF.html#a4986f0c65653fe9eb40bbbff5a97bf16" title="Numero de la premiere face du bord dans la liste des faces.">num_premiere_face</a>();
<a name="l00515"></a>00515         <span class="keywordtype">int</span> num2 = num1 + le_bord.<a class="code" href="classFront__VF.html#a341e2fcb5117b96e745fd7078ba86bab" title="Nombre de faces reelles du bord.">nb_faces</a>();
<a name="l00516"></a>00516         <span class="keywordflow">if</span>(<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classNeumann__sortie__libre.html" title="classe Neumann_sortie_libre Cette classe represente une frontiere ouverte sans vitesse imposee Pour l...">Neumann_sortie_libre</a>,la_cl.<a class="code" href="classDeriv__Cond__lim__base.html#a482c910c704f6f51065a8b7d25acf48a">valeur</a>()))
<a name="l00517"></a>00517           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> face2=num1; face2&lt;num2; face2++)
<a name="l00518"></a>00518             {
<a name="l00519"></a>00519               <span class="keywordtype">double</span> nu_tot=nu+nu_turb(face_voisins(face2,0));
<a name="l00520"></a>00520               <span class="keywordflow">for</span>(indice=0; indice&lt;(nfe-1); indice++)
<a name="l00521"></a>00521                 {
<a name="l00522"></a>00522                   som=nps+dom.<a class="code" href="classDomaine.html#a37cc657f1907d53b0d5a573da862af80">get_renum_som_perio</a>(face_sommets(face2,indice));
<a name="l00523"></a>00523                   <span class="keywordflow">for</span> (compi=0; compi&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; compi++)
<a name="l00524"></a>00524                     <span class="keywordflow">for</span> (compj=0; compj&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; compj++)
<a name="l00525"></a>00525                       div(face2,compi)-= nu_tot/dimension*
<a name="l00526"></a>00526                                          face_normales(face2,compj)*grad(som,compi,compj);
<a name="l00527"></a>00527                 }
<a name="l00528"></a>00528             }
<a name="l00529"></a>00529       }
<a name="l00530"></a>00530     }
<a name="l00531"></a>00531 <span class="comment">// Cerr &lt;&lt; &quot;div AP CL : &quot; &lt;&lt; div &lt;&lt; finl;</span>
<a name="l00532"></a>00532   <span class="keywordflow">return</span> div;
<a name="l00533"></a>00533 }
<a name="l00534"></a>00534 
<a name="l00535"></a>00535 
<a name="l00536"></a>00536 
<a name="l00537"></a><a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#aff9b814fd68288255bd8da82b1ec6b78">00537</a> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#aff9b814fd68288255bd8da82b1ec6b78">Op_Dift_VEF_P1NCP1B_Face::ajouter</a>(<span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; inconnue,
<a name="l00538"></a>00538                                              <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; resu)<span class="keyword"> const</span>
<a name="l00539"></a>00539 <span class="keyword"></span>{
<a name="l00540"></a>00540 <span class="comment">// const Zone_Cl_VEFP1B&amp; zone_Cl_VEF = la_zcl_vef.valeur();</span>
<a name="l00541"></a>00541   <span class="keyword">const</span> <a class="code" href="classZone__VEF__PreP1b.html">Zone_VEF_PreP1b</a>&amp; zone_VEF = <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a78f2d5819303c5dfe731f308a5102c47">la_zone_vef</a>.<a class="code" href="classRef__Zone__VEF__PreP1b.html#aeb3b561ce23619afef9061bbbc37bb5e">valeur</a>();
<a name="l00542"></a>00542   <span class="keyword">const</span> <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone = zone_VEF.<a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>();
<a name="l00543"></a>00543   <span class="keyword">const</span> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom=zone.<a class="code" href="classZone.html#a379ad2206b5a13a4f4f3df6d44c7546a" title="Renvoie le domaine dont la zone fait partie. (version const)">domaine</a>();
<a name="l00544"></a>00544   <span class="keywordtype">int</span> nb_elem_tot=zone.<a class="code" href="classZone.html#aa3a33e8b723618b9092460007153e42d" title="Renvoie le nombre total d&#39;elements de la zone.">nb_elem_tot</a>();
<a name="l00545"></a>00545   <span class="keywordtype">int</span> nb_som_tot=dom.<a class="code" href="classDomaine.html#a394e61cf1993665886de0fbbd0c0178e" title="Renvoie le nombre total de sommets.">nb_som_tot</a>();
<a name="l00546"></a>00546 
<a name="l00547"></a>00547   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; nu_turb=<a class="code" href="classOp__Diff__Turbulent__base.html#af674533b0786ba32fa6a408b6c8bba04">diffusivite_turbulente</a>()-&gt;<a class="code" href="classChamp__Fonc.html#a60b75eadb0987d488884e24fcb72d1e5" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs du champ.">valeurs</a>();
<a name="l00548"></a>00548   <span class="keywordtype">double</span> nu=(<a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a323d8c87ba9d2456fb257493f81959c6">diffusivite_</a>.<a class="code" href="classRef__Champ__base.html#a0cda53fe61d4f24bc8861720d525b32a">valeur</a>())(0,0);
<a name="l00549"></a>00549 
<a name="l00550"></a>00550   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> gradient(nb_elem_tot+nb_som_tot, <a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>, <a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>);
<a name="l00551"></a>00551   gradient = 0.;
<a name="l00552"></a>00552   <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a6e76b94ce02508d83a0107d50aa6738f">calculer_gradient_elem</a>(inconnue, gradient);
<a name="l00553"></a>00553   <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a32fac13e1464d3c66046c0f82e32b125">calculer_gradient_som</a>(inconnue, gradient);
<a name="l00554"></a>00554   <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a2102438bf779d8a5377ac39b4b67a2f5">calculer_divergence_elem</a>(nu, nu_turb, gradient, resu);
<a name="l00555"></a>00555   <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#ad41ae3d76a9d3ad557208ba84cd4dca5">calculer_divergence_som</a>(nu, nu_turb, gradient, resu);
<a name="l00556"></a>00556   <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a28c03caccab9e00d8fdc7f7bd1ece435">corriger_div_pour_Cl</a>(resu);
<a name="l00557"></a>00557   resu.<a class="code" href="classDoubleVect.html#abfebbc2f685ce7bc4b80c720d7da9bf3">echange_espace_virtuel</a>();
<a name="l00558"></a>00558   <a class="code" href="classOp__VEF__Face.html#a6c8ce571769b4f2e20b07cbb7a6944f2">modifier_flux</a>(*<span class="keyword">this</span>);
<a name="l00559"></a>00559   <span class="keywordflow">return</span> resu;
<a name="l00560"></a>00560 }
<a name="l00561"></a>00561 
<a name="l00562"></a><a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#aea69a68e0afe28d33685a7d67cb43db8">00562</a> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#aea69a68e0afe28d33685a7d67cb43db8">Op_Dift_VEF_P1NCP1B_Face::calculer</a>(<span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; inconnue, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; resu)<span class="keyword"> const</span>
<a name="l00563"></a>00563 <span class="keyword"></span>{
<a name="l00564"></a>00564   resu = 0;
<a name="l00565"></a>00565   <span class="keywordflow">return</span> <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#aff9b814fd68288255bd8da82b1ec6b78">ajouter</a>(inconnue,resu);
<a name="l00566"></a>00566 
<a name="l00567"></a>00567 }
<a name="l00568"></a>00568 
<a name="l00569"></a>00569 
<a name="l00570"></a>00570 
<a name="l00571"></a>00571 <span class="comment">//</span>
<a name="l00572"></a>00572 <span class="comment">// Methodes pour l&#39;implicite</span>
<a name="l00573"></a>00573 <span class="comment">//</span>
<a name="l00574"></a>00574 
<a name="l00575"></a><a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#acaf12bed637426ec20b52a888f165c37">00575</a> <span class="keywordtype">void</span> <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#acaf12bed637426ec20b52a888f165c37">Op_Dift_VEF_P1NCP1B_Face::ajouter_contribution</a>( )<span class="keyword"> const</span>
<a name="l00576"></a>00576 <span class="keyword"></span>
<a name="l00577"></a>00577 <span class="keyword"></span>{
<a name="l00578"></a>00578   <span class="keywordflow">return</span>;
<a name="l00579"></a>00579 }
<a name="l00580"></a>00580 
<a name="l00581"></a><a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a0fcac8ba3fe6677ce82299343429f5ab">00581</a> <span class="keywordtype">void</span> <a class="code" href="classOp__Dift__VEF__P1NCP1B__Face.html#a0fcac8ba3fe6677ce82299343429f5ab">Op_Dift_VEF_P1NCP1B_Face::contribue_au_second_membre</a>( )<span class="keyword"> const</span>
<a name="l00582"></a>00582 <span class="keyword"></span>{
<a name="l00583"></a>00583   <span class="keywordflow">return</span>;
<a name="l00584"></a>00584 }
<a name="l00585"></a>00585 
<a name="l00586"></a>00586 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:29 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
