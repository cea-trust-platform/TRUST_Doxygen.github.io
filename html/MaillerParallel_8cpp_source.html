<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/Kernel/Geometrie/MaillerParallel.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/Kernel/Geometrie/MaillerParallel.cpp</div>  </div>
</div>
<div class="contents">
<a href="MaillerParallel_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (c) 2015 - 2016, CEA</span>
<a name="l00003"></a>00003 <span class="comment">* All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment">* 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00007"></a>00007 <span class="comment">* 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00008"></a>00008 <span class="comment">* 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<a name="l00011"></a>00011 <span class="comment">* IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;</span>
<a name="l00012"></a>00012 <span class="comment">* OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// File:        MaillerParallel.cpp</span>
<a name="l00018"></a>00018 <span class="comment">// Directory:   $TRUST_ROOT/src/Kernel/Geometrie</span>
<a name="l00019"></a>00019 <span class="comment">// Version:     /main/6</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;<a class="code" href="MaillerParallel_8h.html">MaillerParallel.h</a>&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;<a class="code" href="Domaine_8h.html">Domaine.h</a>&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="Motcle_8h.html">Motcle.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="Scatter_8h.html">Scatter.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="Statistiques_8h.html">Statistiques.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="Param_8h.html">Param.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="Vect__ArrOfDouble_8h.html">Vect_ArrOfDouble.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="Parser__U_8h.html">Parser_U.h</a>&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;<a class="code" href="Reordonner__faces__periodiques_8h.html">Reordonner_faces_periodiques.h</a>&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;<a class="code" href="EFichier_8h.html">EFichier.h</a>&gt;</span>
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;<a class="code" href="Schema__Comm_8h.html">Schema_Comm.h</a>&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;<a class="code" href="Octree__Double_8h.html">Octree_Double.h</a>&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;<a class="code" href="Faces__builder_8h.html">Faces_builder.h</a>&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;<a class="code" href="Connectivite__som__elem_8h.html">Connectivite_som_elem.h</a>&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;<a class="code" href="Static__Int__Lists_8h.html">Static_Int_Lists.h</a>&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;<a class="code" href="communications_8h.html">communications.h</a>&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;<a class="code" href="ArrOfBit_8h.html">ArrOfBit.h</a>&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;<a class="code" href="Array__tools_8h.html">Array_tools.h</a>&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;<a class="code" href="Ref__Joint_8h.html">Ref_Joint.h</a>&gt;</span>
<a name="l00042"></a>00042 
<a name="l00043"></a><a class="code" href="MaillerParallel_8cpp.html#a0be7bff9e7d678a6d4793cb7dde80076">00043</a> <a class="code" href="Op__Diff__CoviMAC__Face_8cpp.html#aa86ec8ba612a969d9b4370b775037144">Implemente_instanciable</a>(<a class="code" href="classMaillerParallel.html">MaillerParallel</a>, <span class="stringliteral">&quot;MaillerParallel&quot;</span>, <a class="code" href="classInterprete.html" title="Classe de base des objets &quot;interprete&quot;. Ces objets definissent des actions a realiser lorsqu&#39;on les...">Interprete</a>);
<a name="l00044"></a>00044 
<a name="l00045"></a><a class="code" href="classMaillerParallel.html#a95c9dd39093e3ca3b3910e8e8345fb05">00045</a> <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classMaillerParallel.html#a95c9dd39093e3ca3b3910e8e8345fb05" title="Lecture d&#39;un Objet_U sur un flot d&#39;entree Methode a surcharger.">MaillerParallel::readOn</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00046"></a>00046 {
<a name="l00047"></a>00047   <span class="keywordflow">return</span> is;
<a name="l00048"></a>00048 }
<a name="l00049"></a>00049 
<a name="l00050"></a><a class="code" href="classMaillerParallel.html#ae8310bd158fd3e6ae47a1498a87d7e1d">00050</a> <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classMaillerParallel.html#ae8310bd158fd3e6ae47a1498a87d7e1d" title="Ecriture de l&#39;objet sur un flot de sortie Methode a surcharger.">MaillerParallel::printOn</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os)<span class="keyword"> const</span>
<a name="l00051"></a>00051 <span class="keyword"></span>{
<a name="l00052"></a>00052   <span class="keywordflow">return</span> os;
<a name="l00053"></a>00053 }
<a name="l00054"></a>00054 
<a name="l00055"></a><a class="code" href="structBlocData.html">00055</a> <span class="keyword">struct </span><a class="code" href="structBlocData.html">BlocData</a>
<a name="l00056"></a>00056 {
<a name="l00057"></a>00057   <span class="keywordtype">void</span> <a class="code" href="structBlocData.html#a185298286cbc7cdc06c085379d2fa3d9">add_bloc</a>(<a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; domaine, <span class="keyword">const</span> <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a>) &amp; coord_ijk) <span class="keyword">const</span>;
<a name="l00058"></a>00058 <span class="comment">// xmin_tot = 0 implicitement</span>
<a name="l00059"></a>00059 <span class="comment">// xmax_tot = nombre total de sommets dans le maillage</span>
<a name="l00060"></a>00060 <span class="comment">// xmax = indice du dernier sommet + 1</span>
<a name="l00061"></a>00061 <span class="comment">// xmin = indice du premier sommet (donc xmax - xmin = nombre de sommets du bloc courant)</span>
<a name="l00062"></a><a class="code" href="structBlocData.html#a88c629a18e65a3811b8a5f68065bc304">00062</a>   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> <a class="code" href="structBlocData.html#a88c629a18e65a3811b8a5f68065bc304">xmax_tot_</a>;
<a name="l00063"></a><a class="code" href="structBlocData.html#a1ad39d4feefa3ef69a274926b466ae1f">00063</a>   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> <a class="code" href="structBlocData.html#a1ad39d4feefa3ef69a274926b466ae1f">xmin_</a>, <a class="code" href="structBlocData.html#ae49d411b8948c98ca29ed68cbe170b9f">xmax_</a>;
<a name="l00064"></a><a class="code" href="structBlocData.html#a9f6276d86cf940a3048fb85ad658fe39">00064</a>   <a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a> <a class="code" href="structBlocData.html#a9f6276d86cf940a3048fb85ad658fe39">bord_xmin_</a>, <a class="code" href="structBlocData.html#aab95b60e2dab03ad5eff9120820c9d9d">bord_xmax_</a>;
<a name="l00065"></a><a class="code" href="structBlocData.html#a4ed262ab943c5e2b305a4dc8f6b34259">00065</a>   <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="structBlocData.html#a4ed262ab943c5e2b305a4dc8f6b34259">nb_som</a>(<span class="keywordtype">int</span> i)<span class="keyword">  const</span>
<a name="l00066"></a>00066 <span class="keyword">  </span>{
<a name="l00067"></a>00067     <span class="keywordflow">return</span> <a class="code" href="structBlocData.html#ae49d411b8948c98ca29ed68cbe170b9f">xmax_</a>[i] - <a class="code" href="structBlocData.html#a1ad39d4feefa3ef69a274926b466ae1f">xmin_</a>[i];
<a name="l00068"></a>00068   }
<a name="l00069"></a><a class="code" href="structBlocData.html#a1317e96ec175f50c2679d684956eadf2">00069</a>   <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="structBlocData.html#a1317e96ec175f50c2679d684956eadf2">nb_elem</a>(<span class="keywordtype">int</span> i)<span class="keyword">  const</span>
<a name="l00070"></a>00070 <span class="keyword">  </span>{
<a name="l00071"></a>00071     <span class="keywordflow">return</span> <a class="code" href="structBlocData.html#ae49d411b8948c98ca29ed68cbe170b9f">xmax_</a>[i] - <a class="code" href="structBlocData.html#a1ad39d4feefa3ef69a274926b466ae1f">xmin_</a>[i] - 1;
<a name="l00072"></a>00072   }
<a name="l00073"></a>00073   <span class="keywordtype">void</span> <a class="code" href="structBlocData.html#ae4783975d4bd9e10e74e328644a5732a">add_faces</a>(<a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone, <span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; nombord, <span class="keywordtype">int</span> offset_sommets, <span class="keywordtype">int</span> dir, <span class="keywordtype">int</span> cote_max) <span class="keyword">const</span>;
<a name="l00074"></a>00074 };
<a name="l00075"></a>00075 
<a name="l00076"></a><a class="code" href="structBlocData.html#a185298286cbc7cdc06c085379d2fa3d9">00076</a> <span class="keywordtype">void</span> <a class="code" href="structBlocData.html#a185298286cbc7cdc06c085379d2fa3d9">BlocData::add_bloc</a>(<a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; domaine, <span class="keyword">const</span> <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a>) &amp; coord_ijk)<span class="keyword"> const</span>
<a name="l00077"></a>00077 <span class="keyword"></span>{
<a name="l00078"></a>00078   <span class="keywordflow">if</span> (<a class="code" href="structBlocData.html#a1317e96ec175f50c2679d684956eadf2">nb_elem</a>(0) &lt; 1 || <a class="code" href="structBlocData.html#a1317e96ec175f50c2679d684956eadf2">nb_elem</a>(1) &lt; 1 || <a class="code" href="structBlocData.html#a1317e96ec175f50c2679d684956eadf2">nb_elem</a>(2) &lt; 1)
<a name="l00079"></a>00079     {
<a name="l00080"></a>00080       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error : not enough nodes in a block, increase mesh size or decrease processor count&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00081"></a>00081       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00082"></a>00082     }
<a name="l00083"></a>00083   <span class="keyword">const</span> <span class="keywordtype">int</span> dim = 3;
<a name="l00084"></a>00084 <span class="comment">// Les sommets</span>
<a name="l00085"></a>00085   <span class="keyword">const</span> <span class="keywordtype">int</span> old_nb_som = domaine.<a class="code" href="classDomaine.html#a0846ac03a10b65c4df911fe35a19c02f" title="Renvoie le nombre total de sommets.">les_sommets</a>().<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00086"></a>00086   {
<a name="l00087"></a>00087     <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; sommets = domaine.<a class="code" href="classDomaine.html#a0846ac03a10b65c4df911fe35a19c02f" title="Renvoie le nombre total de sommets.">les_sommets</a>();
<a name="l00088"></a>00088     <span class="keyword">const</span> <span class="keywordtype">int</span> nsom = <a class="code" href="structBlocData.html#a4ed262ab943c5e2b305a4dc8f6b34259">nb_som</a>(0) * <a class="code" href="structBlocData.html#a4ed262ab943c5e2b305a4dc8f6b34259">nb_som</a>(1) * <a class="code" href="structBlocData.html#a4ed262ab943c5e2b305a4dc8f6b34259">nb_som</a>(2);
<a name="l00089"></a>00089     sommets.<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(old_nb_som + nsom, dim);
<a name="l00090"></a>00090 
<a name="l00091"></a>00091     <span class="keywordtype">int</span> index = old_nb_som;
<a name="l00092"></a>00092     <span class="keywordtype">int</span> i, j, k;
<a name="l00093"></a>00093     <span class="keywordflow">for</span> (k = <a class="code" href="structBlocData.html#a1ad39d4feefa3ef69a274926b466ae1f">xmin_</a>[2]; k &lt; <a class="code" href="structBlocData.html#ae49d411b8948c98ca29ed68cbe170b9f">xmax_</a>[2]; k++)
<a name="l00094"></a>00094       {
<a name="l00095"></a>00095         <span class="keywordflow">for</span> (j = <a class="code" href="structBlocData.html#a1ad39d4feefa3ef69a274926b466ae1f">xmin_</a>[1]; j &lt; xmax_[1]; j++)
<a name="l00096"></a>00096           {
<a name="l00097"></a>00097             <span class="keywordflow">for</span> (i = <a class="code" href="structBlocData.html#a1ad39d4feefa3ef69a274926b466ae1f">xmin_</a>[0]; i &lt; xmax_[0]; i++)
<a name="l00098"></a>00098               {
<a name="l00099"></a>00099                 sommets(index, 0) = coord_ijk[0][i];
<a name="l00100"></a>00100                 sommets(index, 1) = coord_ijk[1][j];
<a name="l00101"></a>00101                 <span class="keywordflow">if</span> (dim==3)
<a name="l00102"></a>00102                   sommets(index, 2) = coord_ijk[2][k];
<a name="l00103"></a>00103                 index++;
<a name="l00104"></a>00104               }
<a name="l00105"></a>00105           }
<a name="l00106"></a>00106       }
<a name="l00107"></a>00107   }
<a name="l00108"></a>00108 <span class="comment">// Les elements</span>
<a name="l00109"></a>00109   {
<a name="l00110"></a>00110     assert(dim==3);
<a name="l00111"></a>00111     <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone = domaine.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0);
<a name="l00112"></a>00112     <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; elements = zone.<a class="code" href="classZone.html#ac115e8342be89afb882b7b61cc343267" title="Renvoie le tableau des sommets des elements.">les_elems</a>();
<a name="l00113"></a>00113     <span class="keyword">const</span> <span class="keywordtype">int</span> nb_som_par_element = 8;
<a name="l00114"></a>00114 
<a name="l00115"></a>00115 <span class="comment">// stride des indices de sommets:</span>
<a name="l00116"></a>00116     <span class="keyword">const</span> <span class="keywordtype">int</span> dx = 1;
<a name="l00117"></a>00117     <span class="keyword">const</span> <span class="keywordtype">int</span> dy = <a class="code" href="structBlocData.html#a4ed262ab943c5e2b305a4dc8f6b34259">nb_som</a>(0);
<a name="l00118"></a>00118     <span class="keyword">const</span> <span class="keywordtype">int</span> dz = dy * <a class="code" href="structBlocData.html#a4ed262ab943c5e2b305a4dc8f6b34259">nb_som</a>(1);
<a name="l00119"></a>00119 <span class="comment">// nombre d&#39;elements dans chaque direction</span>
<a name="l00120"></a>00120     <span class="keyword">const</span> <span class="keywordtype">int</span> nx = <a class="code" href="structBlocData.html#a1317e96ec175f50c2679d684956eadf2">nb_elem</a>(0);
<a name="l00121"></a>00121     <span class="keyword">const</span> <span class="keywordtype">int</span> ny = <a class="code" href="structBlocData.html#a1317e96ec175f50c2679d684956eadf2">nb_elem</a>(1);
<a name="l00122"></a>00122     <span class="keyword">const</span> <span class="keywordtype">int</span> nz = <a class="code" href="structBlocData.html#a1317e96ec175f50c2679d684956eadf2">nb_elem</a>(2);
<a name="l00123"></a>00123     <span class="keyword">const</span> <span class="keywordtype">int</span> nb_elem_old = zone.<a class="code" href="classZone.html#ac115e8342be89afb882b7b61cc343267" title="Renvoie le tableau des sommets des elements.">les_elems</a>().<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00124"></a>00124     <span class="keyword">const</span> <span class="keywordtype">int</span> nbelem = nx * ny * nz;
<a name="l00125"></a>00125     elements.<a class="code" href="classIntTab.html#a22e6bed6826b3688d4d0181cbf3b7a38" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(nb_elem_old + nbelem, nb_som_par_element);
<a name="l00126"></a>00126 
<a name="l00127"></a>00127     <span class="keywordtype">int</span> index = nb_elem_old;
<a name="l00128"></a>00128     <span class="keywordtype">int</span> i, j, k;
<a name="l00129"></a>00129     <span class="keywordflow">for</span> (k = 0; k &lt; nz; k++)
<a name="l00130"></a>00130       {
<a name="l00131"></a>00131         <span class="keywordflow">for</span> (j = 0; j &lt; ny; j++)
<a name="l00132"></a>00132           {
<a name="l00133"></a>00133             <span class="keywordflow">for</span> (i = 0; i &lt; nx; i++)
<a name="l00134"></a>00134               {
<a name="l00135"></a>00135                 <span class="keywordtype">int</span> n = old_nb_som + k * dz + j * dy + i * dx;
<a name="l00136"></a>00136                 elements(index, 0) = n;
<a name="l00137"></a>00137                 elements(index, 1) = n + dx;
<a name="l00138"></a>00138                 elements(index, 2) = n + dy;
<a name="l00139"></a>00139                 elements(index, 3) = n + dx + dy;
<a name="l00140"></a>00140                 elements(index, 4) = n + dz;
<a name="l00141"></a>00141                 elements(index, 5) = n + dz + dx;
<a name="l00142"></a>00142                 elements(index, 6) = n + dz + dy;
<a name="l00143"></a>00143                 elements(index, 7) = n + dz + dx + dy;
<a name="l00144"></a>00144                 index++;
<a name="l00145"></a>00145               }
<a name="l00146"></a>00146           }
<a name="l00147"></a>00147       }
<a name="l00148"></a>00148   }
<a name="l00149"></a>00149 <span class="comment">// Les bords</span>
<a name="l00150"></a>00150   <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone = domaine.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0);
<a name="l00151"></a>00151   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> dir = 0; dir &lt; 3; dir++)
<a name="l00152"></a>00152     {
<a name="l00153"></a>00153       <span class="keywordflow">if</span> (<a class="code" href="structBlocData.html#a1ad39d4feefa3ef69a274926b466ae1f">xmin_</a>[dir] == 0)
<a name="l00154"></a>00154         <a class="code" href="structBlocData.html#ae4783975d4bd9e10e74e328644a5732a">add_faces</a>(zone, <a class="code" href="structBlocData.html#a9f6276d86cf940a3048fb85ad658fe39">bord_xmin_</a>[dir], old_nb_som, dir, 0);
<a name="l00155"></a>00155       <span class="keywordflow">if</span> (<a class="code" href="structBlocData.html#ae49d411b8948c98ca29ed68cbe170b9f">xmax_</a>[dir] == <a class="code" href="structBlocData.html#a88c629a18e65a3811b8a5f68065bc304">xmax_tot_</a>[dir])
<a name="l00156"></a>00156         <a class="code" href="structBlocData.html#ae4783975d4bd9e10e74e328644a5732a">add_faces</a>(zone, <a class="code" href="structBlocData.html#aab95b60e2dab03ad5eff9120820c9d9d">bord_xmax_</a>[dir], old_nb_som, dir, 1);
<a name="l00157"></a>00157     }
<a name="l00158"></a>00158 }
<a name="l00159"></a>00159 
<a name="l00160"></a><a class="code" href="structBlocData.html#ae4783975d4bd9e10e74e328644a5732a">00160</a> <span class="keywordtype">void</span> <a class="code" href="structBlocData.html#ae4783975d4bd9e10e74e328644a5732a">BlocData::add_faces</a>(<a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone, <span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; nombord, <span class="keywordtype">int</span> offset_sommets, <span class="keywordtype">int</span> dir, <span class="keywordtype">int</span> cote_max)<span class="keyword"> const</span>
<a name="l00161"></a>00161 <span class="keyword"></span>{
<a name="l00162"></a>00162   <span class="keywordtype">int</span> nfaces1, nfaces2;
<a name="l00163"></a>00163   <span class="keywordtype">int</span> increment1, increment2;
<a name="l00164"></a>00164   <span class="keywordtype">int</span> increment_dir;
<a name="l00165"></a>00165   <span class="keywordflow">switch</span>(dir)
<a name="l00166"></a>00166     {
<a name="l00167"></a>00167     <span class="keywordflow">case</span> 0:
<a name="l00168"></a>00168       nfaces1 = <a class="code" href="structBlocData.html#a1317e96ec175f50c2679d684956eadf2">nb_elem</a>(1);
<a name="l00169"></a>00169       nfaces2 = <a class="code" href="structBlocData.html#a1317e96ec175f50c2679d684956eadf2">nb_elem</a>(2);
<a name="l00170"></a>00170       increment1 = <a class="code" href="structBlocData.html#a4ed262ab943c5e2b305a4dc8f6b34259">nb_som</a>(0);
<a name="l00171"></a>00171       increment2 = <a class="code" href="structBlocData.html#a4ed262ab943c5e2b305a4dc8f6b34259">nb_som</a>(0) * <a class="code" href="structBlocData.html#a4ed262ab943c5e2b305a4dc8f6b34259">nb_som</a>(1);
<a name="l00172"></a>00172       increment_dir = 1;
<a name="l00173"></a>00173       <span class="keywordflow">break</span>;
<a name="l00174"></a>00174     <span class="keywordflow">case</span> 1:
<a name="l00175"></a>00175       nfaces1 = <a class="code" href="structBlocData.html#a1317e96ec175f50c2679d684956eadf2">nb_elem</a>(0);
<a name="l00176"></a>00176       nfaces2 = <a class="code" href="structBlocData.html#a1317e96ec175f50c2679d684956eadf2">nb_elem</a>(2);
<a name="l00177"></a>00177       increment1 = 1;
<a name="l00178"></a>00178       increment2 = <a class="code" href="structBlocData.html#a4ed262ab943c5e2b305a4dc8f6b34259">nb_som</a>(0) * <a class="code" href="structBlocData.html#a4ed262ab943c5e2b305a4dc8f6b34259">nb_som</a>(1);
<a name="l00179"></a>00179       increment_dir = <a class="code" href="structBlocData.html#a4ed262ab943c5e2b305a4dc8f6b34259">nb_som</a>(0);
<a name="l00180"></a>00180       <span class="keywordflow">break</span>;
<a name="l00181"></a>00181     <span class="keywordflow">default</span>:
<a name="l00182"></a>00182       nfaces1 = <a class="code" href="structBlocData.html#a1317e96ec175f50c2679d684956eadf2">nb_elem</a>(0);
<a name="l00183"></a>00183       nfaces2 = <a class="code" href="structBlocData.html#a1317e96ec175f50c2679d684956eadf2">nb_elem</a>(1);
<a name="l00184"></a>00184       increment1 = 1;
<a name="l00185"></a>00185       increment2 = <a class="code" href="structBlocData.html#a4ed262ab943c5e2b305a4dc8f6b34259">nb_som</a>(0);
<a name="l00186"></a>00186       increment_dir = <a class="code" href="structBlocData.html#a4ed262ab943c5e2b305a4dc8f6b34259">nb_som</a>(0)*<a class="code" href="structBlocData.html#a4ed262ab943c5e2b305a4dc8f6b34259">nb_som</a>(1);
<a name="l00187"></a>00187       <span class="keywordflow">break</span>;
<a name="l00188"></a>00188     }
<a name="l00189"></a>00189   <span class="keywordflow">if</span> (cote_max)
<a name="l00190"></a>00190     offset_sommets += increment_dir * (<a class="code" href="structBlocData.html#a4ed262ab943c5e2b305a4dc8f6b34259">nb_som</a>(dir)-1);
<a name="l00191"></a>00191 
<a name="l00192"></a>00192   <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; faces = zone.<a class="code" href="classZone.html#ac338b119d4b0bc4f510a223b9086fe5e">frontiere</a>(nombord).<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a07b8d8db9e3d656b93a21a49c063430c">les_sommets</a>();
<a name="l00193"></a>00193   <span class="keywordtype">int</span> count = faces.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00194"></a>00194   zone.<a class="code" href="classZone.html#ac338b119d4b0bc4f510a223b9086fe5e">frontiere</a>(nombord).<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#aa3112928fe6cd95eb6c3394fd53c3cb1" title="(Re-)dimensionne les faces On redimensionne les voisins en consequence. Les sommets implicitement ajo...">dimensionner</a>(count + nfaces1 * nfaces2);
<a name="l00195"></a>00195   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nfaces2; i++)
<a name="l00196"></a>00196     {
<a name="l00197"></a>00197       <span class="keywordtype">int</span> sommet = offset_sommets;
<a name="l00198"></a>00198       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; nfaces1; j++)
<a name="l00199"></a>00199         {
<a name="l00200"></a>00200           faces(count, 0) = sommet;
<a name="l00201"></a>00201           faces(count, 1) = sommet + increment1;
<a name="l00202"></a>00202           faces(count, 2) = sommet + increment2;
<a name="l00203"></a>00203           faces(count, 3) = sommet + increment1 + increment2;
<a name="l00204"></a>00204           sommet += increment1;
<a name="l00205"></a>00205           count++;
<a name="l00206"></a>00206         }
<a name="l00207"></a>00207       offset_sommets += increment2;
<a name="l00208"></a>00208     }
<a name="l00209"></a>00209 }
<a name="l00210"></a>00210 
<a name="l00211"></a><a class="code" href="MaillerParallel_8cpp.html#a6ba3b4bcfd66200d20aad91d85653444">00211</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="MaillerParallel_8cpp.html#a6ba3b4bcfd66200d20aad91d85653444">bbox_intersection</a>(<span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; bboxes, <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, <span class="keywordtype">double</span> epsilon)
<a name="l00212"></a>00212 {
<a name="l00213"></a>00213   <span class="keyword">const</span> <span class="keywordtype">int</span> dim = bboxes.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1) / 2;
<a name="l00214"></a>00214   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; dim; k++)
<a name="l00215"></a>00215     {
<a name="l00216"></a>00216       <span class="keywordtype">double</span> min1 = bboxes(i, k) - epsilon;
<a name="l00217"></a>00217       <span class="keywordtype">double</span> max1 = bboxes(i, dim+k) + epsilon;
<a name="l00218"></a>00218       <span class="keywordtype">double</span> min2 = bboxes(j, k);
<a name="l00219"></a>00219       <span class="keywordtype">double</span> max2 = bboxes(j, dim+k);
<a name="l00220"></a>00220       <span class="keywordflow">if</span> (min1 &gt; max2 || max1 &lt; min2)
<a name="l00221"></a>00221         <span class="keywordflow">return</span> 0;
<a name="l00222"></a>00222     }
<a name="l00223"></a>00223   <span class="keywordflow">return</span> 1;
<a name="l00224"></a>00224 }
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 <span class="comment">//</span>
<a name="l00227"></a>00227 <span class="comment">//</span>
<a name="l00228"></a>00228 <span class="comment">//</span>
<a name="l00229"></a>00229 <span class="comment">//</span>
<a name="l00230"></a>00230 <span class="comment">//</span><span class="comment"></span>
<a name="l00231"></a>00231 <span class="comment">//! for a given set of local coordinates, finds which other processors&lt;br&gt;share the same nodes.&lt;br&gt;match must be sized to Process::nproc() and will be filled with, for each processor,&lt;br&gt;the indexes of coordinates that the corresponding processor shares with me.&lt;br&gt;Nodes are listed in the same order on couples of processors sharing a list of nodes&lt;br&gt;match[Process::me()] will be left empty.</span>
<a name="l00232"></a><a class="code" href="MaillerParallel_8cpp.html#a84d7b23bed74996cd415586161aa92fd">00232</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="MaillerParallel_8cpp.html#a84d7b23bed74996cd415586161aa92fd" title="for a given set of local coordinates, finds which other processors share the same nodes...">find_matching_coordinates</a>(<span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; coords,
<a name="l00233"></a>00233                                <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>) &amp; match,
<a name="l00234"></a>00234                                <span class="keywordtype">double</span> epsilon)
<a name="l00235"></a>00235 {
<a name="l00236"></a>00236   <span class="keywordtype">int</span> i, j;
<a name="l00237"></a>00237   <span class="keyword">const</span> <span class="keywordtype">int</span> dim = coords.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1);
<a name="l00238"></a>00238   <span class="keyword">const</span> <span class="keywordtype">int</span> ncoord = coords.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00239"></a>00239   <span class="keyword">const</span> <span class="keywordtype">int</span> nproc = <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l00240"></a>00240   <span class="keyword">const</span> <span class="keywordtype">int</span> moi = <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>();
<a name="l00241"></a>00241 <span class="comment">// Fill nodes coordinates and bounding boxes</span>
<a name="l00242"></a>00242   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> bounding_boxes(nproc, dim*2);
<a name="l00243"></a>00243   {
<a name="l00244"></a>00244     <span class="keyword">const</span> <span class="keywordtype">double</span> big_val = 1.e36;
<a name="l00245"></a>00245     <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> min_coord(dim);
<a name="l00246"></a>00246     min_coord= big_val;
<a name="l00247"></a>00247     <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> max_coord(dim);
<a name="l00248"></a>00248     max_coord= -big_val;
<a name="l00249"></a>00249 
<a name="l00250"></a>00250     <span class="keywordflow">for</span> (i = 0; i &lt; ncoord; i++)
<a name="l00251"></a>00251       {
<a name="l00252"></a>00252         <span class="keywordflow">for</span> (j = 0; j &lt; dim; j++)
<a name="l00253"></a>00253           {
<a name="l00254"></a>00254             <span class="keyword">const</span> <span class="keywordtype">double</span> x = coords(i, j);
<a name="l00255"></a>00255             <span class="keywordflow">if</span> (x &gt; max_coord[j])
<a name="l00256"></a>00256               max_coord[j] = x;
<a name="l00257"></a>00257             <span class="keywordflow">if</span> (x &lt; min_coord[j])
<a name="l00258"></a>00258               min_coord[j] = x;
<a name="l00259"></a>00259           }
<a name="l00260"></a>00260       }
<a name="l00261"></a>00261 <span class="comment">// broadcast a tous les processeurs</span>
<a name="l00262"></a>00262     <span class="keywordflow">for</span> (i = 0; i &lt; nproc; i++)
<a name="l00263"></a>00263       {
<a name="l00264"></a>00264         <span class="keywordflow">for</span> (j = 0; j &lt; dim; j++)
<a name="l00265"></a>00265           {
<a name="l00266"></a>00266             bounding_boxes(i, j) = min_coord[j];
<a name="l00267"></a>00267             bounding_boxes(i, j+dim) = max_coord[j];
<a name="l00268"></a>00268           }
<a name="l00269"></a>00269       }
<a name="l00270"></a>00270     <a class="code" href="communications_8cpp.html#a5ceda011ec527d63b691f62cd2fb61c8">envoyer_all_to_all</a>(bounding_boxes, bounding_boxes);
<a name="l00271"></a>00271   }
<a name="l00272"></a>00272 <span class="comment">// Exchange boundary nodes coordinates with other processors</span>
<a name="l00273"></a>00273   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> all_pe;
<a name="l00274"></a>00274   all_pe.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00275"></a>00275   <span class="keywordflow">for</span> (i = 0; i &lt; nproc; i++)
<a name="l00276"></a>00276     <span class="keywordflow">if</span> (i != moi &amp;&amp; <a class="code" href="MaillerParallel_8cpp.html#a6ba3b4bcfd66200d20aad91d85653444">bbox_intersection</a>(bounding_boxes, moi, i, epsilon))
<a name="l00277"></a>00277       all_pe.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(i);
<a name="l00278"></a>00278 
<a name="l00279"></a>00279   <a class="code" href="classSchema__Comm.html">Schema_Comm</a> schema;
<a name="l00280"></a>00280   schema.<a class="code" href="classSchema__Comm.html#ad11c9b47999c294c26ae4df8d2bbd57b" title="Definit la liste des processeurs a qui on va envoyer et de qui on va recevoir des donnees...">set_send_recv_pe_list</a>(all_pe, all_pe);
<a name="l00281"></a>00281   schema.<a class="code" href="classSchema__Comm.html#ac617b53de22748cdd9fa30a0cfd0f4a8" title="Statut passe a WRITING Autorise si status_ == WRITING:">begin_comm</a>();
<a name="l00282"></a>00282   <a class="code" href="classOctree__Double.html" title=": Un octree permettant de chercher dans l&#39;espace des elements ou des points decrits par des coordonne...">Octree_Double</a> octree;
<a name="l00283"></a>00283   octree.<a class="code" href="classOctree__Double.html#a0b66bd315e7f45a024695b6a2764e7d4" title="construit un octree contenant les points de coordonnees coords. Si include_virtual=1, on stocke coords.dimension_tot(0) elements, sinon on en stocke coords.dimension(0) Si epsilon = 0, on construit un octree de points de taille nulle (chaque point se trouve dans un seul octree_floor) Sinon, on construit un octree d&#39;elements cubiques centres sur les coords, de demie-largeur epsilon. Un point peut alors se trouver dans plusieurs octree_floor.">build_nodes</a>(coords, 0 <span class="comment">/* do not include virtual nodes */</span>);
<a name="l00284"></a>00284 
<a name="l00285"></a>00285 <span class="comment">// Send nodes coordinates to processors with non empty intersection</span>
<a name="l00286"></a>00286 <span class="comment">// temporary array for octree functions:</span>
<a name="l00287"></a>00287   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> nodes_list;
<a name="l00288"></a>00288   nodes_list.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00289"></a>00289   <span class="keywordtype">int</span> ipe;
<a name="l00290"></a>00290   <span class="keywordflow">for</span> (ipe = 0; ipe &lt; all_pe.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>(); ipe++)
<a name="l00291"></a>00291     {
<a name="l00292"></a>00292 <span class="comment">// Search nodes within the bounding box of the other processor:</span>
<a name="l00293"></a>00293       <span class="keyword">const</span> <span class="keywordtype">int</span> pe = all_pe[ipe]; <span class="comment">//!&lt; processor number</span>
<a name="l00294"></a>00294 <span class="comment"></span>      <span class="keyword">const</span> <span class="keywordtype">double</span> xmin = bounding_boxes(pe, 0) - epsilon;
<a name="l00295"></a>00295       <span class="keyword">const</span> <span class="keywordtype">double</span> ymin = bounding_boxes(pe, 1) - epsilon;
<a name="l00296"></a>00296       <span class="keyword">const</span> <span class="keywordtype">double</span> zmin = (dim == 3) ? bounding_boxes(pe, 2) - epsilon : -epsilon;
<a name="l00297"></a>00297       <span class="keyword">const</span> <span class="keywordtype">double</span> xmax = bounding_boxes(pe, dim) + epsilon;
<a name="l00298"></a>00298       <span class="keyword">const</span> <span class="keywordtype">double</span> ymax = bounding_boxes(pe, dim+1) + epsilon;
<a name="l00299"></a>00299       <span class="keyword">const</span> <span class="keywordtype">double</span> zmax = (dim == 3) ? bounding_boxes(pe, dim+2) + epsilon : epsilon;
<a name="l00300"></a>00300       octree.<a class="code" href="classOctree__Double.html#a1dffcace51ca06cb52ff6e2330ab4b2e" title="cherche tous les elements ou points ayant potentiellement une intersection non vide avec la boite don...">search_elements_box</a>(xmin, ymin, zmin, xmax, ymax, zmax, nodes_list);
<a name="l00301"></a>00301 
<a name="l00302"></a>00302       <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; buffer = schema.<a class="code" href="classSchema__Comm.html#a6c771eae3b46250ae0d2f0126a7d8065" title="renvoie le buffer correspondant au processeur num_PE pour y entasser des donnees a envoyer...">send_buffer</a>(pe);
<a name="l00303"></a>00303       <span class="keyword">const</span> <span class="keywordtype">int</span> n = nodes_list.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00304"></a>00304       <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)
<a name="l00305"></a>00305         {
<a name="l00306"></a>00306           <span class="keyword">const</span> <span class="keywordtype">int</span> som = nodes_list[i];
<a name="l00307"></a>00307           <span class="keyword">const</span> <span class="keywordtype">double</span> x = coords(som, 0);
<a name="l00308"></a>00308           <span class="keyword">const</span> <span class="keywordtype">double</span> y = coords(som, 1);
<a name="l00309"></a>00309           <span class="keyword">const</span> <span class="keywordtype">double</span> z = (dim==3) ? coords(som, 2) : 0;
<a name="l00310"></a>00310 <span class="comment">// test again if inside bounding box (octree test gives more nodes)</span>
<a name="l00311"></a>00311           <span class="keywordflow">if</span> (x&gt;=xmin &amp;&amp; x&lt;=xmax &amp;&amp; y&gt;=ymin &amp;&amp; y&lt;=ymax &amp;&amp; z&gt;=zmin &amp;&amp; z&lt;=zmax)
<a name="l00312"></a>00312             {
<a name="l00313"></a>00313               buffer &lt;&lt; x &lt;&lt; y &lt;&lt; z;
<a name="l00314"></a>00314             }
<a name="l00315"></a>00315         }
<a name="l00316"></a>00316     }
<a name="l00317"></a>00317   schema.<a class="code" href="classSchema__Comm.html#abca0e8ac6c2b742d26f3cfaee0690c72" title="Statut passe a EXCHANGED.">echange_taille_et_messages</a>();
<a name="l00318"></a>00318   <span class="keywordflow">for</span> (ipe = 0; ipe &lt; all_pe.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>(); ipe++)
<a name="l00319"></a>00319     {
<a name="l00320"></a>00320       <span class="keyword">const</span> <span class="keywordtype">int</span> pe = all_pe[ipe]; <span class="comment">//!&lt; processor number</span>
<a name="l00321"></a>00321 <span class="comment"></span>      <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; buffer = schema.<a class="code" href="classSchema__Comm.html#a0c056eb81ab8fd513912b336b4d13a1a" title="renvoie le buffer correspondant au processeur num_PE pour y lire les donnees recues. Le schema doit etre dans l&#39;etat EXCHANGED.">recv_buffer</a>(pe);
<a name="l00322"></a>00322       <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; resu = match[pe];
<a name="l00323"></a>00323       resu.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00324"></a>00324       resu.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(0);
<a name="l00325"></a>00325       <span class="keywordflow">while</span>(1)
<a name="l00326"></a>00326         {
<a name="l00327"></a>00327           <span class="keywordtype">double</span> x, y, z;
<a name="l00328"></a>00328           buffer &gt;&gt; x &gt;&gt; y &gt;&gt; z;
<a name="l00329"></a>00329           <span class="keywordflow">if</span> (buffer.<a class="code" href="classEntree.html#abcd397cb0b99fbe7c6f01047d8cec89c">eof</a>())
<a name="l00330"></a>00330             <span class="keywordflow">break</span>;
<a name="l00331"></a>00331 <span class="comment">// Seach for this node in my list</span>
<a name="l00332"></a>00332           octree.<a class="code" href="classOctree__Double.html#a1dffcace51ca06cb52ff6e2330ab4b2e" title="cherche tous les elements ou points ayant potentiellement une intersection non vide avec la boite don...">search_elements_box</a>(x-epsilon, y-epsilon, z-epsilon,
<a name="l00333"></a>00333                                      x+epsilon, y+epsilon, z+epsilon, nodes_list);
<a name="l00334"></a>00334 <span class="comment">// Refine search to keep only matching nodes:</span>
<a name="l00335"></a>00335           octree.<a class="code" href="classOctree__Double.html#a8ba1f6ceba5dae2af587d2f9a766aac2" title="Methode hors classe Cherche parmi les sommets de la liste node_list ceux qui sont a une distance infe...">search_nodes_close_to</a>(x, y, z, coords, nodes_list, epsilon);
<a name="l00336"></a>00336           <span class="keyword">const</span> <span class="keywordtype">int</span> n = nodes_list.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00337"></a>00337           <span class="keywordflow">if</span> (n &gt; 1)
<a name="l00338"></a>00338             {
<a name="l00339"></a>00339               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in automatic joint builder: more than one node within epsilon tolerance\n&quot;</span>
<a name="l00340"></a>00340                    &lt;&lt; <span class="stringliteral">&quot; node coord = &quot;</span> &lt;&lt; x &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; y &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; z &lt;&lt; <span class="stringliteral">&quot; tolerance= &quot;</span> &lt;&lt; epsilon &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00341"></a>00341               <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00342"></a>00342             }
<a name="l00343"></a>00343           <span class="keywordflow">if</span> (n == 1)
<a name="l00344"></a>00344             resu.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(nodes_list[0]);
<a name="l00345"></a>00345         }
<a name="l00346"></a>00346     }
<a name="l00347"></a>00347   schema.<a class="code" href="classSchema__Comm.html#a73a981f88b6ffebc150fb46c5cce75d9" title="Statut passe a RESET Accesseurs:">end_comm</a>();
<a name="l00348"></a>00348 }
<a name="l00349"></a>00349 
<a name="l00350"></a>00350 <span class="comment">//</span>
<a name="l00351"></a>00351 <span class="comment">//</span>
<a name="l00352"></a>00352 <span class="comment">//</span>
<a name="l00353"></a>00353 <span class="comment">//</span><span class="comment"></span>
<a name="l00354"></a>00354 <span class="comment">//! finds all faces of all elements that&lt;br&gt;- have only one neighbour elements&lt;br&gt;- and do not belong to a boundary&lt;br&gt;(these are joint faces)&lt;br&gt;Fills &quot;faces&quot; with the local node numbers of the faces that have been found.</span>
<a name="l00355"></a><a class="code" href="MaillerParallel_8cpp.html#aaffcc9b5476334db05eb75b524a20d5d">00355</a> <span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="MaillerParallel_8cpp.html#aaffcc9b5476334db05eb75b524a20d5d" title="finds all faces of all elements that - have only one neighbour elements - and do not belong to a boun...">find_joint_faces</a>(<span class="keyword">const</span> <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone, <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; faces)
<a name="l00356"></a>00356 {
<a name="l00357"></a>00357   <a class="code" href="classStatic__Int__Lists.html" title="Cette classe permet de stocker des listes d&#39;entiers accessibles en temps constant. La taille des listes ne peut pas changer sans perdre le contenu (ce sont des listes statiques). Exemple: Static_Int_List l; ArrOfInt tailles(3); tailles[0] = 2; tailles[1] = 3; tailles[2] = 0; // On reserve la memoire pour trois listes de taille 2, 3 et 0: l.set_list_sizes(tailles); // On affecte une valeur au deuxieme element de la premiere liste: l.set_value(0,1,765); // Affiche la valeur Cout &lt;&lt; l(0,1);.">Static_Int_Lists</a> som_elem;
<a name="l00358"></a>00358   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; elements = zone.<a class="code" href="classZone.html#ac115e8342be89afb882b7b61cc343267" title="Renvoie le tableau des sommets des elements.">les_elems</a>();
<a name="l00359"></a>00359   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_som = zone.<a class="code" href="classZone.html#a379ad2206b5a13a4f4f3df6d44c7546a" title="Renvoie le domaine dont la zone fait partie. (version const)">domaine</a>().<a class="code" href="classDomaine.html#abc4abc8b8db5bebeb161fae4162a89ce" title="Renvoie le nombre de sommets.">nb_som</a>();
<a name="l00360"></a>00360   <a class="code" href="Connectivite__som__elem_8cpp.html#a82161461a228e43ae236c31101ff3ce6" title="construction de la structure som_elem pour la zone donnee On cree pour chaque sommet i la liste des e...">construire_connectivite_som_elem</a>(nb_som, elements, som_elem, 0 <span class="comment">/* do not include virtual elements */</span>);
<a name="l00361"></a>00361   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_som_faces = zone.<a class="code" href="classZone.html#a18cf83cd0f9c368dcfa32fb802a0ac94" title="Renvoie un element geometrique du type de ceux qui constituent la zone. (version const)">type_elem</a>().<a class="code" href="classDeriv__Elem__geom__base.html#a384b487459a33f9f521fb16539ec81de">valeur</a>().<a class="code" href="classElem__geom__base.html#ad6c1fe053cf842b50bc1c0870f4d21f5">nb_som_face</a>();
<a name="l00362"></a>00362   faces.<a class="code" href="classIntTab.html#a22e6bed6826b3688d4d0181cbf3b7a38" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(0, nb_som_faces);
<a name="l00363"></a>00363   faces.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00364"></a>00364   <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a> faces_element_reference;
<a name="l00365"></a>00365   zone.<a class="code" href="classZone.html#a18cf83cd0f9c368dcfa32fb802a0ac94" title="Renvoie un element geometrique du type de ceux qui constituent la zone. (version const)">type_elem</a>().<a class="code" href="classDeriv__Elem__geom__base.html#a384b487459a33f9f521fb16539ec81de">valeur</a>().<a class="code" href="classElem__geom__base.html#a9993267e98ef97472d3a5ef9c3c67882" title="remplit le tableau faces_som_local(i,j) qui donne pour 0 &lt;= i &lt; nb_faces() et 0 &lt;= j &lt; nb_som_face(i) le ...">get_tab_faces_sommets_locaux</a>(faces_element_reference);
<a name="l00366"></a>00366   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_faces_elem = faces_element_reference.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00367"></a>00367 <span class="comment">// Mark faces of elements that are on a boundary</span>
<a name="l00368"></a>00368   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_elem = elements.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00369"></a>00369   <a class="code" href="classArrOfBit.html">ArrOfBit</a> boundary_faces(nb_elem * nb_faces_elem);
<a name="l00370"></a>00370   boundary_faces = 0;
<a name="l00371"></a>00371   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> une_face(nb_som_faces);
<a name="l00372"></a>00372   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> liste_elements;
<a name="l00373"></a>00373   liste_elements.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00374"></a>00374   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_boundaries = zone.<a class="code" href="classZone.html#a9bf185c52ad1809d954bba670d9aed8a" title="Renvoie le nombre de bords + le nombre de raccords + le nombre de faces frontieres internes...">nb_front_Cl</a>();
<a name="l00375"></a>00375   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i_boundary = 0; i_boundary &lt; nb_boundaries; i_boundary++)
<a name="l00376"></a>00376     {
<a name="l00377"></a>00377       <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; faces_front = zone.<a class="code" href="classZone.html#ac338b119d4b0bc4f510a223b9086fe5e">frontiere</a>(i_boundary).<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a07b8d8db9e3d656b93a21a49c063430c">les_sommets</a>();
<a name="l00378"></a>00378       <span class="keyword">const</span> <span class="keywordtype">int</span> nb_faces_bord = faces_front.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00379"></a>00379       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; nb_faces_bord; j++)
<a name="l00380"></a>00380         {
<a name="l00381"></a>00381           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; nb_som_faces; k++)
<a name="l00382"></a>00382             une_face[k] = faces_front(j, k);
<a name="l00383"></a>00383           <a class="code" href="Connectivite__som__elem_8cpp.html#afccbadf5344a16154a56b33dbddf88c1" title="Cherche les elements qui contiennent tous les sommets du tableau sommets_to_find (permet de trouver l...">find_adjacent_elements</a>(som_elem, une_face, liste_elements);
<a name="l00384"></a>00384           <span class="keywordflow">if</span> (liste_elements.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>() != 1)
<a name="l00385"></a>00385             {
<a name="l00386"></a>00386               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in MaillerParallel::find_joint_faces: boundary face ArrOfInt=&quot;</span> &lt;&lt; une_face
<a name="l00387"></a>00387                    &lt;&lt; <span class="stringliteral">&quot; does not have exactly 1 neighbour element: &quot;</span> &lt;&lt; liste_elements;
<a name="l00388"></a>00388               <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00389"></a>00389             }
<a name="l00390"></a>00390           <span class="keyword">const</span> <span class="keywordtype">int</span> elem = liste_elements[0];
<a name="l00391"></a>00391           <span class="keyword">const</span> <span class="keywordtype">int</span> face_locale = <a class="code" href="classFaces__builder.html#a17469d1ff2feae7d358abcccd2d67831">Faces_builder::chercher_face_element</a>(elements, faces_element_reference, une_face, elem);
<a name="l00392"></a>00392           boundary_faces.<a class="code" href="classArrOfBit.html#a5c339cfd9dea141737e127131e52aaae" title="Met le bit e a 1.">setbit</a>(elem * nb_faces_elem + face_locale);
<a name="l00393"></a>00393         }
<a name="l00394"></a>00394     }
<a name="l00395"></a>00395 <span class="comment">// Browse all faces of all elements, find faces with only one neighbour</span>
<a name="l00396"></a>00396   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> elem = 0; elem &lt; nb_elem; elem++)
<a name="l00397"></a>00397     {
<a name="l00398"></a>00398       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> face_locale = 0; face_locale &lt; nb_faces_elem; face_locale++)
<a name="l00399"></a>00399         {
<a name="l00400"></a>00400           <span class="keywordflow">if</span> (boundary_faces[elem * nb_faces_elem + face_locale])
<a name="l00401"></a>00401             <span class="keywordflow">continue</span>;
<a name="l00402"></a>00402           <span class="keywordtype">int</span> i;
<a name="l00403"></a>00403           <span class="keywordflow">for</span> (i = 0; i &lt; nb_som_faces; i++)
<a name="l00404"></a>00404             {
<a name="l00405"></a>00405               <span class="keyword">const</span> <span class="keywordtype">int</span> sommet_local = faces_element_reference(face_locale, i);
<a name="l00406"></a>00406               une_face[i] = elements(elem, sommet_local);
<a name="l00407"></a>00407             }
<a name="l00408"></a>00408           <a class="code" href="Connectivite__som__elem_8cpp.html#afccbadf5344a16154a56b33dbddf88c1" title="Cherche les elements qui contiennent tous les sommets du tableau sommets_to_find (permet de trouver l...">find_adjacent_elements</a>(som_elem, une_face, liste_elements);
<a name="l00409"></a>00409           <span class="keywordflow">if</span> (liste_elements.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>() == 1)
<a name="l00410"></a>00410             {
<a name="l00411"></a>00411               <span class="keyword">const</span> <span class="keywordtype">int</span> n = faces.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00412"></a>00412               faces.<a class="code" href="classIntTab.html#a425c14e929dedb4760f303ff42a20ee2" title="change la dimension[0] du tableau en conservant les autres.">resize_dim0</a>(n+1);
<a name="l00413"></a>00413               <span class="keywordflow">for</span> (i = 0; i &lt; nb_som_faces; i++)
<a name="l00414"></a>00414                 faces(n, i) = une_face[i];
<a name="l00415"></a>00415             }
<a name="l00416"></a>00416         }
<a name="l00417"></a>00417     }
<a name="l00418"></a>00418   <a class="code" href="classProcess.html#a57e0f54b11e6eaadbea224fa904b18dd" title="Renvoie un objet statique de type Sortie qui sert de journal d&#39;evenements. Si message_level &lt;= verbose...">Process::Journal</a>() &lt;&lt; <span class="stringliteral">&quot;Domain &quot;</span> &lt;&lt; zone.<a class="code" href="classZone.html#a379ad2206b5a13a4f4f3df6d44c7546a" title="Renvoie le domaine dont la zone fait partie. (version const)">domaine</a>().<a class="code" href="classDomaine.html#a87e2cdc035a26565e6fe481446aa4cd3" title="Renvoie le nom du domaine.">le_nom</a>() &lt;&lt; <span class="stringliteral">&quot; has &quot;</span> &lt;&lt; faces.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0) &lt;&lt; <span class="stringliteral">&quot; undeclared boundary faces candidates for joint faces&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00419"></a>00419 }
<a name="l00420"></a>00420 
<a name="l00421"></a><a class="code" href="MaillerParallel_8cpp.html#a36b86a59ab5c59e71d833df1b70903ab">00421</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="MaillerParallel_8cpp.html#a36b86a59ab5c59e71d833df1b70903ab">auto_build_joints</a>(<a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone, <span class="keyword">const</span> <span class="keywordtype">int</span> epaisseur_joint)
<a name="l00422"></a>00422 {
<a name="l00423"></a>00423   <span class="keyword">const</span> <span class="keywordtype">double</span> epsilon = 1e-10;
<a name="l00424"></a>00424   <span class="keywordtype">int</span> i, j;
<a name="l00425"></a>00425 <span class="comment">// Find joint faces (faces with 1 neighbour element not registered in boundary faces)</span>
<a name="l00426"></a>00426   <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a> faces;
<a name="l00427"></a>00427   <a class="code" href="MaillerParallel_8cpp.html#aaffcc9b5476334db05eb75b524a20d5d" title="finds all faces of all elements that - have only one neighbour elements - and do not belong to a boun...">find_joint_faces</a>(zone, faces);
<a name="l00428"></a>00428 
<a name="l00429"></a>00429   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; sommets = zone.<a class="code" href="classZone.html#a379ad2206b5a13a4f4f3df6d44c7546a" title="Renvoie le domaine dont la zone fait partie. (version const)">domaine</a>().<a class="code" href="classDomaine.html#a0846ac03a10b65c4df911fe35a19c02f" title="Renvoie le nombre total de sommets.">les_sommets</a>();
<a name="l00430"></a>00430 <span class="comment">// List of unique local boundary node numbers</span>
<a name="l00431"></a>00431   <span class="keyword">const</span> <span class="keywordtype">int</span> dim = sommets.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1);
<a name="l00432"></a>00432 
<a name="l00433"></a>00433   {
<a name="l00434"></a>00434     <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> boundary_nodes_index;
<a name="l00435"></a>00435     boundary_nodes_index = faces; <span class="comment">//!&lt; copie du tableau</span>
<a name="l00436"></a>00436 <span class="comment"></span>    <a class="code" href="Scatter_8cpp.html#a23c4d19dc90caae2323f04de90621709" title="Methode outil pour retirer les doublons dans un tableau.">array_trier_retirer_doublons</a>(boundary_nodes_index);
<a name="l00437"></a>00437     <span class="keyword">const</span> <span class="keywordtype">int</span> ncoord = boundary_nodes_index.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00438"></a>00438 <span class="comment">// Fill nodes coordinates and bounding boxes</span>
<a name="l00439"></a>00439     <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> coord;
<a name="l00440"></a>00440     coord.<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(ncoord, dim, <a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ffaf6ae9ba7eb51c5f298ce693345b3ec68">Array_base::NOCOPY_NOINIT</a>);
<a name="l00441"></a>00441     <span class="keywordflow">for</span> (i = 0; i &lt; ncoord; i++)
<a name="l00442"></a>00442       {
<a name="l00443"></a>00443         <span class="keyword">const</span> <span class="keywordtype">int</span> som = boundary_nodes_index[i];
<a name="l00444"></a>00444         <span class="keywordflow">for</span> (j = 0; j &lt; dim; j++)
<a name="l00445"></a>00445           coord(i, j) = sommets(som, j);
<a name="l00446"></a>00446       }
<a name="l00447"></a>00447     <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>) match(<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>());
<a name="l00448"></a>00448     <a class="code" href="MaillerParallel_8cpp.html#a84d7b23bed74996cd415586161aa92fd" title="for a given set of local coordinates, finds which other processors share the same nodes...">find_matching_coordinates</a>(coord, match, epsilon);
<a name="l00449"></a>00449 
<a name="l00450"></a>00450     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> pe = 0; pe &lt; match.size(); pe++)
<a name="l00451"></a>00451       {
<a name="l00452"></a>00452         <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; list = match[pe];
<a name="l00453"></a>00453         <span class="keyword">const</span> <span class="keywordtype">int</span> n = list.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00454"></a>00454         <span class="keywordflow">if</span> (n &gt; 0)
<a name="l00455"></a>00455           {
<a name="l00456"></a>00456             <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp; joint = zone.<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>().<a class="code" href="classList__Joint.html#af5bca88a907fbe4086842805696cfe2f">add</a>(<a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>());
<a name="l00457"></a>00457             joint.<a class="code" href="classFrontiere.html#a714e3cc26d7e59f3a65d80de23ea21ac" title="Donne un nom a la frontiere.">nommer</a>(<span class="stringliteral">&quot;Joint_i&quot;</span>);
<a name="l00458"></a>00458             joint.<a class="code" href="classFrontiere.html#af927b5d4fc1fd086ba91e916f61badee" title="Associe la frontiere a la zone dont elle depend.">associer_zone</a>(zone);
<a name="l00459"></a>00459             joint.<a class="code" href="classJoint.html#a130c206de5fddabf173bb3e4604cefa3" title="Fixe l&#39;epaisseur du joint.">affecte_epaisseur</a>(epaisseur_joint);
<a name="l00460"></a>00460             joint.<a class="code" href="classJoint.html#a3c4ef6a648dd0b5d4aa072a1f4e3c64e" title="Fixe le numero du PE voisin.">affecte_PEvoisin</a>(pe);
<a name="l00461"></a>00461             joint.<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a503fe687811445373b75dd8ac0991ec2" title="Type les faces.">typer</a>(zone.<a class="code" href="classZone.html#a18cf83cd0f9c368dcfa32fb802a0ac94" title="Renvoie un element geometrique du type de ceux qui constituent la zone. (version const)">type_elem</a>().<a class="code" href="classDeriv__Elem__geom__base.html#a384b487459a33f9f521fb16539ec81de">valeur</a>().<a class="code" href="classElem__geom__base.html#af781819b042bc5d8fec8b2255e32b498">type_face</a>());
<a name="l00462"></a>00462             <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; sommets_joint = joint.<a class="code" href="classJoint.html#aa1c4d729a3017082d26907d82ad1d7de" title="Renvoie les informations de joint pour un type d&#39;item geometrique donne, pour remplissage des structu...">set_joint_item</a>(<a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>).<a class="code" href="classJoint__Items.html#aa01c4601d506c658f4f1d45e66951ce0" title="Renvoie le tableau items_communs_ pour le remplir. (BM: ce tableau n&#39;est pas encore rempli)...">set_items_communs</a>();
<a name="l00463"></a>00463             sommets_joint.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(n, <a class="code" href="classArray__base.html#abee342aa9ac59623c4c782dc9d7877ffaf6ae9ba7eb51c5f298ce693345b3ec68">Array_base::NOCOPY_NOINIT</a>);
<a name="l00464"></a>00464             <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)
<a name="l00465"></a>00465               sommets_joint[i] = boundary_nodes_index[list[i]];
<a name="l00466"></a>00466             sommets_joint.<a class="code" href="classArrOfInt.html#abb0f48cf5a4be4b70edcc90baaebd521" title="Tri des valeurs du tableau dans l&#39;ordre croissant. La fonction utilisee est qsort de stdlib (elle est...">ordonne_array</a>();
<a name="l00467"></a>00467             <a class="code" href="classProcess.html#a57e0f54b11e6eaadbea224fa904b18dd" title="Renvoie un objet statique de type Sortie qui sert de journal d&#39;evenements. Si message_level &lt;= verbose...">Process::Journal</a>() &lt;&lt; <span class="stringliteral">&quot;Joint sommets with pe &quot;</span> &lt;&lt; pe &lt;&lt; <span class="stringliteral">&quot; has &quot;</span> &lt;&lt; n &lt;&lt; <span class="stringliteral">&quot; nodes&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00468"></a>00468           }
<a name="l00469"></a>00469       }
<a name="l00470"></a>00470   }
<a name="l00471"></a>00471 
<a name="l00472"></a>00472   {
<a name="l00473"></a>00473 <span class="comment">// Find matching faces (match the coordinates of the centers)</span>
<a name="l00474"></a>00474     <span class="keyword">const</span> <span class="keywordtype">int</span> nfaces = faces.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0);
<a name="l00475"></a>00475     <span class="keyword">const</span> <span class="keywordtype">int</span> nb_som_faces = faces.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1);
<a name="l00476"></a>00476     <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> coord(nfaces, dim); <span class="comment">//!&lt; init with 0.</span>
<a name="l00477"></a>00477 <span class="comment"></span>    <span class="keyword">const</span> <span class="keywordtype">double</span> facteur = 1. / (double)nb_som_faces;
<a name="l00478"></a>00478     <span class="keywordflow">for</span> (i = 0; i &lt; nfaces; i++)
<a name="l00479"></a>00479       {
<a name="l00480"></a>00480         <span class="keywordflow">for</span> (j = 0; j &lt; nb_som_faces; j++)
<a name="l00481"></a>00481           {
<a name="l00482"></a>00482             <span class="keyword">const</span> <span class="keywordtype">int</span> som = faces(i,j);
<a name="l00483"></a>00483             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; dim; k++)
<a name="l00484"></a>00484               coord(i, k) += sommets(som, k) * facteur;
<a name="l00485"></a>00485           }
<a name="l00486"></a>00486       }
<a name="l00487"></a>00487     <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>) match(<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>());
<a name="l00488"></a>00488     <a class="code" href="MaillerParallel_8cpp.html#a84d7b23bed74996cd415586161aa92fd" title="for a given set of local coordinates, finds which other processors share the same nodes...">find_matching_coordinates</a>(coord, match, epsilon);
<a name="l00489"></a>00489 
<a name="l00490"></a>00490     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> pe = 0; pe &lt; match.size(); pe++)
<a name="l00491"></a>00491       {
<a name="l00492"></a>00492         <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; list = match[pe];
<a name="l00493"></a>00493         <span class="keyword">const</span> <span class="keywordtype">int</span> n = list.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00494"></a>00494         <span class="keywordflow">if</span> (n &gt; 0)
<a name="l00495"></a>00495           {
<a name="l00496"></a>00496             <a class="code" href="Ref_8h.html#aab5720a5c34da14028d0745e386aaa01">REF</a>(<a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>) ref_joint;
<a name="l00497"></a>00497             <span class="keywordtype">int</span> ii;
<a name="l00498"></a>00498             <span class="keywordflow">for</span> (ii = 0; ii &lt; zone.<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>().<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>(); ii++)
<a name="l00499"></a>00499               {
<a name="l00500"></a>00500                 <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp; joint = zone.<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>()[ii];
<a name="l00501"></a>00501                 <span class="keywordflow">if</span> (joint.<a class="code" href="classJoint.html#a0952bc5c7805434ccd8cd5c9b01e3747" title="Renvoie PEvoisin (numero de la zone voisine)">PEvoisin</a>() == pe)
<a name="l00502"></a>00502                   {
<a name="l00503"></a>00503                     ref_joint = joint;
<a name="l00504"></a>00504                     <span class="keywordflow">break</span>;
<a name="l00505"></a>00505                   }
<a name="l00506"></a>00506               }
<a name="l00507"></a>00507             <span class="keywordflow">if</span> (!ref_joint.non_nul())
<a name="l00508"></a>00508               {
<a name="l00509"></a>00509                 <a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>&amp; joint = zone.<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>().<a class="code" href="classList__Joint.html#af5bca88a907fbe4086842805696cfe2f">add</a>(<a class="code" href="classJoint.html" title="La classe Joint est une Frontiere qui contient les faces et les sommets de joint avec la zone PEvoisi...">Joint</a>());
<a name="l00510"></a>00510                 joint.<a class="code" href="classFrontiere.html#a714e3cc26d7e59f3a65d80de23ea21ac" title="Donne un nom a la frontiere.">nommer</a>(<span class="stringliteral">&quot;Joint_i&quot;</span>);
<a name="l00511"></a>00511                 joint.<a class="code" href="classFrontiere.html#af927b5d4fc1fd086ba91e916f61badee" title="Associe la frontiere a la zone dont elle depend.">associer_zone</a>(zone);
<a name="l00512"></a>00512                 joint.<a class="code" href="classJoint.html#a130c206de5fddabf173bb3e4604cefa3" title="Fixe l&#39;epaisseur du joint.">affecte_epaisseur</a>(epaisseur_joint);
<a name="l00513"></a>00513                 joint.<a class="code" href="classJoint.html#a3c4ef6a648dd0b5d4aa072a1f4e3c64e" title="Fixe le numero du PE voisin.">affecte_PEvoisin</a>(pe);
<a name="l00514"></a>00514                 joint.<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a503fe687811445373b75dd8ac0991ec2" title="Type les faces.">typer</a>(zone.<a class="code" href="classZone.html#a18cf83cd0f9c368dcfa32fb802a0ac94" title="Renvoie un element geometrique du type de ceux qui constituent la zone. (version const)">type_elem</a>().<a class="code" href="classDeriv__Elem__geom__base.html#a384b487459a33f9f521fb16539ec81de">valeur</a>().<a class="code" href="classElem__geom__base.html#af781819b042bc5d8fec8b2255e32b498">type_face</a>());
<a name="l00515"></a>00515                 ref_joint = joint;
<a name="l00516"></a>00516               }
<a name="l00517"></a>00517             <a class="code" href="classFaces.html" title="enum Type_Face Les differents types geometriques de faces.">Faces</a>&amp; les_faces = ref_joint.valeur().faces();
<a name="l00518"></a>00518             les_faces.<a class="code" href="classFaces.html#aa3112928fe6cd95eb6c3394fd53c3cb1" title="(Re-)dimensionne les faces On redimensionne les voisins en consequence. Les sommets implicitement ajo...">dimensionner</a>(n);
<a name="l00519"></a>00519             <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; faces_sommets = les_faces.<a class="code" href="classFaces.html#a07b8d8db9e3d656b93a21a49c063430c">les_sommets</a>();
<a name="l00520"></a>00520             <span class="keywordflow">for</span> (ii = 0; ii &lt; n; ii++)
<a name="l00521"></a>00521               {
<a name="l00522"></a>00522                 <span class="keyword">const</span> <span class="keywordtype">int</span> num_face = list[ii];
<a name="l00523"></a>00523                 <span class="keywordflow">for</span> (j = 0; j &lt; nb_som_faces; j++)
<a name="l00524"></a>00524                   faces_sommets(ii, j) = faces(num_face, j);
<a name="l00525"></a>00525               }
<a name="l00526"></a>00526             <a class="code" href="classProcess.html#a57e0f54b11e6eaadbea224fa904b18dd" title="Renvoie un objet statique de type Sortie qui sert de journal d&#39;evenements. Si message_level &lt;= verbose...">Process::Journal</a>() &lt;&lt; <span class="stringliteral">&quot;Joint faces with pe &quot;</span> &lt;&lt; pe &lt;&lt; <span class="stringliteral">&quot; has &quot;</span> &lt;&lt; n &lt;&lt; <span class="stringliteral">&quot; faces&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00527"></a>00527           }
<a name="l00528"></a>00528       }
<a name="l00529"></a>00529   }
<a name="l00530"></a>00530 <span class="comment">// Tri des joints dans l&#39;ordre croissant des processeurs</span>
<a name="l00531"></a>00531   <a class="code" href="classScatter.html#ac5dd6d7661490708649976cde509f480" title="Tri des joints dans l&#39;ordre croissant des processeurs.">Scatter::trier_les_joints</a>(zone.<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>());
<a name="l00532"></a>00532 }
<a name="l00533"></a>00533 
<a name="l00534"></a><a class="code" href="classMaillerParallel.html#af896958c03975cca4ab462b28e00a4cc">00534</a> <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classMaillerParallel.html#af896958c03975cca4ab462b28e00a4cc">MaillerParallel::interpreter</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00535"></a>00535 {
<a name="l00536"></a>00536   <span class="keywordflow">if</span> (<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a> != 3)
<a name="l00537"></a>00537     {
<a name="l00538"></a>00538       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error: Mailler_Parallel is only coded for dimension 3&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00539"></a>00539       <a class="code" href="classProcess.html#aa9e74a5c06a68ea38298a08ea401e7b1" title="Synchronise tous les processeurs du groupe courant&lt;br&gt;(attend que tous les processeurs soient arrives...">barrier</a>();
<a name="l00540"></a>00540       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00541"></a>00541     }
<a name="l00542"></a>00542 
<a name="l00543"></a>00543   <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>      nom_domaine;
<a name="l00544"></a>00544   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> nb_noeuds;
<a name="l00545"></a>00545   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> decoupage;
<a name="l00546"></a>00546   <span class="keywordtype">int</span>   epaisseur_joint;
<a name="l00547"></a>00547   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> perio(3);
<a name="l00548"></a>00548   <a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a> fonctions_coord(3);
<a name="l00549"></a>00549   <a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a> nom_bords_min(3);
<a name="l00550"></a>00550   <a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a> nom_bords_max(3);
<a name="l00551"></a>00551   nom_bords_min[0] = <span class="stringliteral">&quot;xmin&quot;</span>;
<a name="l00552"></a>00552   nom_bords_min[1] = <span class="stringliteral">&quot;ymin&quot;</span>;
<a name="l00553"></a>00553   nom_bords_min[2] = <span class="stringliteral">&quot;zmin&quot;</span>;
<a name="l00554"></a>00554   nom_bords_max[0] = <span class="stringliteral">&quot;xmax&quot;</span>;
<a name="l00555"></a>00555   nom_bords_max[1] = <span class="stringliteral">&quot;ymax&quot;</span>;
<a name="l00556"></a>00556   nom_bords_max[2] = <span class="stringliteral">&quot;zmax&quot;</span>;
<a name="l00557"></a>00557   <a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a> fichier_coord(3);
<a name="l00558"></a>00558   <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a> mapping;
<a name="l00559"></a>00559   {
<a name="l00560"></a>00560     <a class="code" href="classParam.html" title="Defined below in this file.">Param</a> param(<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>());
<a name="l00561"></a>00561     param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;domain&quot;</span>, &amp;nom_domaine, <a class="code" href="classParam.html#aa4ad0ca1d49bc5f2ebc5fc83ee9df384aaf5b6dfac1c5970478525407cc6ac572">Param::REQUIRED</a>);
<a name="l00562"></a>00562     param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;nb_nodes&quot;</span>, &amp;nb_noeuds, <a class="code" href="classParam.html#aa4ad0ca1d49bc5f2ebc5fc83ee9df384aaf5b6dfac1c5970478525407cc6ac572">Param::REQUIRED</a>);
<a name="l00563"></a>00563     param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;splitting&quot;</span>, &amp;decoupage, <a class="code" href="classParam.html#aa4ad0ca1d49bc5f2ebc5fc83ee9df384aaf5b6dfac1c5970478525407cc6ac572">Param::REQUIRED</a>);
<a name="l00564"></a>00564     param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;ghost_thickness&quot;</span>, &amp;epaisseur_joint, <a class="code" href="classParam.html#aa4ad0ca1d49bc5f2ebc5fc83ee9df384aaf5b6dfac1c5970478525407cc6ac572">Param::REQUIRED</a>);
<a name="l00565"></a>00565     param.<a class="code" href="classParam.html#ae3d50612a0014a9d58e6e035a65f20e5">ajouter_flag</a>(<span class="stringliteral">&quot;perio_x&quot;</span>, &amp;perio[0]);
<a name="l00566"></a>00566     param.<a class="code" href="classParam.html#ae3d50612a0014a9d58e6e035a65f20e5">ajouter_flag</a>(<span class="stringliteral">&quot;perio_y&quot;</span>, &amp;perio[1]);
<a name="l00567"></a>00567     param.<a class="code" href="classParam.html#ae3d50612a0014a9d58e6e035a65f20e5">ajouter_flag</a>(<span class="stringliteral">&quot;perio_z&quot;</span>, &amp;perio[2]);
<a name="l00568"></a>00568     param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;function_coord_x&quot;</span>, &amp;fonctions_coord[0]);
<a name="l00569"></a>00569     param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;function_coord_y&quot;</span>, &amp;fonctions_coord[1]);
<a name="l00570"></a>00570     param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;function_coord_z&quot;</span>, &amp;fonctions_coord[2]);
<a name="l00571"></a>00571     param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;file_coord_x&quot;</span>, &amp;fichier_coord[0]);
<a name="l00572"></a>00572     param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;file_coord_y&quot;</span>, &amp;fichier_coord[1]);
<a name="l00573"></a>00573     param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;file_coord_z&quot;</span>, &amp;fichier_coord[2]);
<a name="l00574"></a>00574     param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;boundary_xmin&quot;</span>, &amp;nom_bords_min[0]);
<a name="l00575"></a>00575     param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;boundary_xmax&quot;</span>, &amp;nom_bords_max[0]);
<a name="l00576"></a>00576     param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;boundary_ymin&quot;</span>, &amp;nom_bords_min[1]);
<a name="l00577"></a>00577     param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;boundary_ymax&quot;</span>, &amp;nom_bords_max[1]);
<a name="l00578"></a>00578     param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;boundary_zmin&quot;</span>, &amp;nom_bords_min[2]);
<a name="l00579"></a>00579     param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;boundary_zmax&quot;</span>, &amp;nom_bords_max[2]);
<a name="l00580"></a>00580     param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;mapping&quot;</span>, &amp;mapping);
<a name="l00581"></a>00581     param.<a class="code" href="classParam.html#aea52f16d3b74c59c48cb5708ff48f14a">lire_avec_accolades</a>(is);
<a name="l00582"></a>00582   }
<a name="l00583"></a>00583 
<a name="l00584"></a>00584   <a class="code" href="Vect_8h.html#adc7c7b04809c9aec2cb897cd2ef06378">VECT</a>(<a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a>) coord_ijk(3);
<a name="l00585"></a>00585   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> dir=0; dir&lt;3; dir++)
<a name="l00586"></a>00586     {
<a name="l00587"></a>00587       <span class="keyword">const</span> <span class="keywordtype">int</span> n = nb_noeuds[dir];
<a name="l00588"></a>00588       <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a>&amp; coord = coord_ijk[dir];
<a name="l00589"></a>00589       coord.<a class="code" href="classArrOfDouble.html#a610464f4b3dccac6f814915b526783ed">resize_array</a>(n);
<a name="l00590"></a>00590       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Building coordinates for direction &quot;</span> &lt;&lt; dir &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00591"></a>00591       <span class="keywordflow">if</span> (fonctions_coord[dir] != <span class="stringliteral">&quot;??&quot;</span>)
<a name="l00592"></a>00592         {
<a name="l00593"></a>00593           <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> chaine = fonctions_coord[dir];
<a name="l00594"></a>00594           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Interpreting expression &quot;</span> &lt;&lt; chaine &lt;&lt; finl;
<a name="l00595"></a>00595           <a class="code" href="classParser__U.html" title="classe Parser_U Version de la classe Parser, derivant de Objet_U. Elle permet lors de son utilisation...">Parser_U</a> p;
<a name="l00596"></a>00596           <a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a> noms_dir(3);
<a name="l00597"></a>00597           noms_dir[0]=<span class="stringliteral">&quot;X&quot;</span>;
<a name="l00598"></a>00598           noms_dir[1]=<span class="stringliteral">&quot;Y&quot;</span>;
<a name="l00599"></a>00599           noms_dir[2]=<span class="stringliteral">&quot;Z&quot;</span>;
<a name="l00600"></a>00600           p.<a class="code" href="classParser__U.html#a3ff44eabf641cbcea9ca59f84167e2c1">setNbVar</a>(1);
<a name="l00601"></a>00601           p.<a class="code" href="classParser__U.html#a25d581b85688da391aa64117abf0a073">setString</a>(chaine);
<a name="l00602"></a>00602           p.<a class="code" href="classParser__U.html#ae216b7daee6c4bb756423ffed5674293">addVar</a>(noms_dir[dir]);
<a name="l00603"></a>00603           p.<a class="code" href="classParser__U.html#a441c2fd29f5d4370c0c7b6a1cdfe56d5">parseString</a>();
<a name="l00604"></a>00604           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
<a name="l00605"></a>00605             {
<a name="l00606"></a>00606               p.<a class="code" href="classParser__U.html#a13c377b32b6c3ced39a14f83f94a8828">setVar</a>(0, (<span class="keywordtype">double</span>) i / (<span class="keywordtype">double</span>) (nb_noeuds[dir]-1));
<a name="l00607"></a>00607               coord[i] = p.<a class="code" href="classParser__U.html#a61605bc1b85e466f884f1739e811b6b4">eval</a>();
<a name="l00608"></a>00608               <span class="keywordflow">if</span> (i &gt; 0 &amp;&amp; coord[i] &lt;= coord[i-1])
<a name="l00609"></a>00609                 {
<a name="l00610"></a>00610                   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in fonctions_coord parameter &quot;</span> &lt;&lt; chaine &lt;&lt; <span class="stringliteral">&quot; : must be strictly increasing&quot;</span> &lt;&lt; finl;
<a name="l00611"></a>00611                   <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00612"></a>00612                 }
<a name="l00613"></a>00613             }
<a name="l00614"></a>00614           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Build mesh covering [ &quot;</span> &lt;&lt; coord[0] &lt;&lt; <span class="stringliteral">&quot; , &quot;</span> &lt;&lt; coord[n-1] &lt;&lt; <span class="stringliteral">&quot; ]&quot;</span> &lt;&lt; finl;
<a name="l00615"></a>00615         }
<a name="l00616"></a>00616       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fichier_coord[dir] != <span class="stringliteral">&quot;??&quot;</span>)
<a name="l00617"></a>00617         {
<a name="l00618"></a>00618           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Reading file &quot;</span> &lt;&lt; fichier_coord[dir] &lt;&lt; finl;
<a name="l00619"></a>00619           <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l00620"></a>00620             {
<a name="l00621"></a>00621               <a class="code" href="classEFichier.html" title="Fichier en lecture Cette classe est a la classe C++ ifstream ce que la classe Entree est a la classe ...">EFichier</a> f(fichier_coord[dir]);
<a name="l00622"></a>00622               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
<a name="l00623"></a>00623                 f &gt;&gt; coord[i];
<a name="l00624"></a>00624             }
<a name="l00625"></a>00625           <a class="code" href="communications_8cpp.html#a2335b36078ae87e23dab400a6e129a3c">envoyer_broadcast</a>(coord, 0);
<a name="l00626"></a>00626           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Found mesh covering [ &quot;</span> &lt;&lt; coord[0] &lt;&lt; <span class="stringliteral">&quot; , &quot;</span> &lt;&lt; coord[n-1] &lt;&lt; <span class="stringliteral">&quot; ]&quot;</span> &lt;&lt; finl;
<a name="l00627"></a>00627         }
<a name="l00628"></a>00628       <span class="keywordflow">else</span>
<a name="l00629"></a>00629         {
<a name="l00630"></a>00630           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot; Uniform mesh covering [0,1]&quot;</span> &lt;&lt; finl;
<a name="l00631"></a>00631           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
<a name="l00632"></a>00632             {
<a name="l00633"></a>00633               coord[i] = (double) i / (<span class="keywordtype">double</span>)(n-1);
<a name="l00634"></a>00634             }
<a name="l00635"></a>00635         }
<a name="l00636"></a>00636     }
<a name="l00637"></a>00637 
<a name="l00638"></a>00638   <a class="code" href="classObjet__U.html" title="classe Objet_U Cette classe est la classe de base des Objets de TRUST Dans les classes derivees de Ob...">Objet_U</a>&amp; obj = <a class="code" href="classInterprete.html#a3ca248609f0b72eac68baca14621b4ee" title="Voir Interprete_bloc::objet_global() BM: la classe Interprete n&#39;est pas le meilleur endroit pour cett...">objet</a>(nom_domaine);
<a name="l00639"></a>00639   <span class="keywordflow">if</span>(!<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>, obj))
<a name="l00640"></a>00640     {
<a name="l00641"></a>00641       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;obj : &quot;</span> &lt;&lt; nom_domaine &lt;&lt; <span class="stringliteral">&quot; is not an object of type Domaine !&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00642"></a>00642       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00643"></a>00643     }
<a name="l00644"></a>00644 
<a name="l00645"></a>00645   <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; domaine = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>, obj);
<a name="l00646"></a>00646 
<a name="l00647"></a>00647   <span class="keyword">const</span> <span class="keywordtype">int</span> numproc = <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>();
<a name="l00648"></a>00648 
<a name="l00649"></a>00649   <span class="keyword">static</span> <a class="code" href="classStat__Counter__Id.html">Stat_Counter_Id</a> stats = <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#ae1d5ab3d7354d4f748173dde67f9912d">new_counter</a>(0 <span class="comment">/* Level */</span>, <span class="stringliteral">&quot;Mailler_Parallel&quot;</span>, 0 <span class="comment">/* Group */</span>);
<a name="l00650"></a>00650 
<a name="l00651"></a>00651   <span class="keyword">const</span> <span class="keywordtype">int</span> dim = <a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">Objet_U::dimension</a>;
<a name="l00652"></a>00652   <span class="keywordflow">if</span> (nb_noeuds.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>() != dim)
<a name="l00653"></a>00653     {
<a name="l00654"></a>00654       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;MaillerParallel::construire_domaine wrong dimension for nb_noeuds : nb_noeuds=&quot;</span> &lt;&lt; nb_noeuds &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00655"></a>00655       <a class="code" href="classProcess.html#aa9e74a5c06a68ea38298a08ea401e7b1" title="Synchronise tous les processeurs du groupe courant&lt;br&gt;(attend que tous les processeurs soient arrives...">barrier</a>();
<a name="l00656"></a>00656       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00657"></a>00657     }
<a name="l00658"></a>00658 
<a name="l00659"></a>00659   <span class="keywordflow">if</span> (decoupage.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>() != dim)
<a name="l00660"></a>00660     {
<a name="l00661"></a>00661       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;MaillerParallel::construire_domaine wrong dimension for nb_noeuds : nb_noeuds=&quot;</span> &lt;&lt; nb_noeuds &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00662"></a>00662       <a class="code" href="classProcess.html#aa9e74a5c06a68ea38298a08ea401e7b1" title="Synchronise tous les processeurs du groupe courant&lt;br&gt;(attend que tous les processeurs soient arrives...">barrier</a>();
<a name="l00663"></a>00663       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00664"></a>00664     }
<a name="l00665"></a>00665 
<a name="l00666"></a>00666   {
<a name="l00667"></a>00667     <span class="keywordtype">int</span> n = 1;
<a name="l00668"></a>00668     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; dim; i++)
<a name="l00669"></a>00669       n *= decoupage[i];
<a name="l00670"></a>00670     <span class="keywordflow">if</span> (n != <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>())
<a name="l00671"></a>00671       {
<a name="l00672"></a>00672         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;MaillerParallel::construire_domaine decoupage does not match nproc&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00673"></a>00673         <a class="code" href="classProcess.html#aa9e74a5c06a68ea38298a08ea401e7b1" title="Synchronise tous les processeurs du groupe courant&lt;br&gt;(attend que tous les processeurs soient arrives...">barrier</a>();
<a name="l00674"></a>00674         <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00675"></a>00675       }
<a name="l00676"></a>00676   }
<a name="l00677"></a>00677   <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#affcd058809786918ed173aaf681d0843">begin_count</a>(stats);
<a name="l00678"></a>00678 
<a name="l00679"></a>00679 <span class="comment">// Position du bloc correspondant a numproc dans le decoupage i,j,k:</span>
<a name="l00680"></a>00680   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> i_proc(dim);
<a name="l00681"></a>00681   <span class="keywordflow">if</span> (mapping.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0) == 0)
<a name="l00682"></a>00682     {
<a name="l00683"></a>00683 <span class="comment">// Pas de mapping fourni, on prend decoupe par defaut</span>
<a name="l00684"></a>00684       <span class="keywordtype">int</span> i;
<a name="l00685"></a>00685       <span class="keywordtype">int</span> reste = numproc;
<a name="l00686"></a>00686 
<a name="l00687"></a>00687       <span class="keywordflow">for</span> (i = 0; i &lt; dim; i++)
<a name="l00688"></a>00688         {
<a name="l00689"></a>00689 <span class="comment">// Nombre de parties dans la direction dim_2:</span>
<a name="l00690"></a>00690           <span class="keyword">const</span> <span class="keywordtype">int</span> n_parties = decoupage[i];
<a name="l00691"></a>00691 <span class="comment">// Position du processeur courant dans cette direction:</span>
<a name="l00692"></a>00692           i_proc[i] = reste % n_parties;
<a name="l00693"></a>00693           reste = reste / n_parties;
<a name="l00694"></a>00694         }
<a name="l00695"></a>00695     }
<a name="l00696"></a>00696   <span class="keywordflow">else</span>
<a name="l00697"></a>00697     {
<a name="l00698"></a>00698       <span class="keywordflow">if</span> (mapping.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0) != <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>() || mapping.<a class="code" href="classIntTab.html#abc3b32c94925a82f69d5b153a356e359" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1) != 3)
<a name="l00699"></a>00699         {
<a name="l00700"></a>00700           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error: processor mapping should be of dimension &quot;</span> &lt;&lt; <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>() &lt;&lt;  <span class="stringliteral">&quot; x 3&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00701"></a>00701           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00702"></a>00702         }
<a name="l00703"></a>00703       i_proc[0] = mapping(numproc,0);
<a name="l00704"></a>00704       i_proc[1] = mapping(numproc,1);
<a name="l00705"></a>00705       i_proc[2] = mapping(numproc,2);
<a name="l00706"></a>00706     }
<a name="l00707"></a>00707 <span class="comment">// Indice du premier element du bloc associe au processeur dans la direction i:</span>
<a name="l00708"></a>00708 <span class="comment">// Attention, en cas de periodique, i_premier_element sera negatif.</span>
<a name="l00709"></a>00709   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> i_premier_element(dim);
<a name="l00710"></a>00710 <span class="comment">// Taille du bloc associe au processeur</span>
<a name="l00711"></a>00711   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> nb_elements(dim);
<a name="l00712"></a>00712   {
<a name="l00713"></a>00713     <span class="keywordtype">int</span> i;
<a name="l00714"></a>00714     <span class="keywordflow">for</span> (i = 0; i &lt; dim; i++)
<a name="l00715"></a>00715       {
<a name="l00716"></a>00716         <span class="keyword">const</span> <span class="keywordtype">int</span> nb_elem_tot = nb_noeuds[i] - 1; <span class="comment">//!&lt; Nb total de noeuds dans la direction i</span>
<a name="l00717"></a>00717 <span class="comment"></span>        i_premier_element[i] = nb_elem_tot * i_proc[i] / decoupage[i];
<a name="l00718"></a>00718         <span class="keyword">const</span> <span class="keywordtype">int</span> i_dernier_element = nb_elem_tot * (i_proc[i] + 1) / decoupage[i] - 1;
<a name="l00719"></a>00719         nb_elements[i] = i_dernier_element - i_premier_element[i] + 1;
<a name="l00720"></a>00720 
<a name="l00721"></a>00721         <span class="keywordflow">if</span> (perio[i] &amp;&amp; decoupage[i] &gt; 1)
<a name="l00722"></a>00722           {
<a name="l00723"></a>00723             <span class="keywordtype">int</span> decalage = nb_elem_tot / decoupage[i] / 2;
<a name="l00724"></a>00724             i_premier_element[i] -= decalage;
<a name="l00725"></a>00725           }
<a name="l00726"></a>00726       }
<a name="l00727"></a>00727   }
<a name="l00728"></a>00728 
<a name="l00729"></a>00729 <span class="comment">// On cree une zone pour le domaine</span>
<a name="l00730"></a>00730   <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a> empty_zone;
<a name="l00731"></a>00731   <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone = domaine.<a class="code" href="classDomaine.html#a6204a2b89860bfd74ca2858d1d8750bf" title="Ajoute une Sous_Zone au domaine.">add</a>(empty_zone);
<a name="l00732"></a>00732 <span class="comment">// Nom de la zone</span>
<a name="l00733"></a>00733   {
<a name="l00734"></a>00734     <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> nom_zone(<span class="stringliteral">&quot;Proc&quot;</span>);
<a name="l00735"></a>00735     nom_zone += <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(numproc);
<a name="l00736"></a>00736     nom_zone += <span class="stringliteral">&quot;sur&quot;</span>;
<a name="l00737"></a>00737     nom_zone += <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>(<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>());
<a name="l00738"></a>00738     zone.<a class="code" href="classZone.html#ad9cedce77314d4aa1d84a12958079b0e" title="Donne un nom a la zone.">nommer</a>(nom_zone);
<a name="l00739"></a>00739   }
<a name="l00740"></a>00740   zone.<a class="code" href="classZone.html#a68a215145852861f2d513c959f52a1a5" title="Specifie le domaine dont la zone fait partie.">associer_domaine</a>(domaine);
<a name="l00741"></a>00741   {
<a name="l00742"></a>00742     <a class="code" href="classElem__geom.html">Elem_geom</a>&amp; elem = zone.<a class="code" href="classZone.html#a18cf83cd0f9c368dcfa32fb802a0ac94" title="Renvoie un element geometrique du type de ceux qui constituent la zone. (version const)">type_elem</a>();
<a name="l00743"></a>00743     <span class="keywordflow">switch</span>(dim)
<a name="l00744"></a>00744       {
<a name="l00745"></a>00745       <span class="keywordflow">case</span> 3:
<a name="l00746"></a>00746         elem.<a class="code" href="classDeriv__.html#ad1d33400ed15b6ff96579ed82d9e2719" title="Essaie de creer une instance du type &quot;type&quot;. si type n&#39;est pas un type ou type n&#39;est pas instanciab...">typer</a>(<span class="stringliteral">&quot;Hexaedre&quot;</span>);
<a name="l00747"></a>00747         <span class="keywordflow">break</span>;
<a name="l00748"></a>00748       <span class="keywordflow">default</span>:
<a name="l00749"></a>00749         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;MaillerParallel::construire_domaine  erreur&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00750"></a>00750         <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00751"></a>00751       }
<a name="l00752"></a>00752     elem.<a class="code" href="classDeriv__Elem__geom__base.html#a384b487459a33f9f521fb16539ec81de">valeur</a>().<a class="code" href="classElem__geom__base.html#a48f1f36788b3d033b83a458affad564e" title="Associe l&#39;element geometrique a sa zone.">associer_zone</a>(zone);
<a name="l00753"></a>00753   }
<a name="l00754"></a>00754 
<a name="l00755"></a>00755   <a class="code" href="structBlocData.html">BlocData</a> data;
<a name="l00756"></a>00756   <a class="code" href="classNoms.html" title="Un tableau de chaine de caracteres (VECT(Nom))">Noms</a> liste_bords_perio;
<a name="l00757"></a>00757   <a class="code" href="classBords.html" title="Classe Bords Cette classe represente une liste d&#39;objets de type Bord.">Bords</a>&amp; bords = zone.<a class="code" href="classZone.html#a4bc04163903c004c5c1383eaa5fa844d" title="Renvoie la liste des bords de la zone. (version const)">faces_bord</a>();
<a name="l00758"></a>00758   data.<a class="code" href="structBlocData.html#a9f6276d86cf940a3048fb85ad658fe39">bord_xmin_</a> = nom_bords_min;
<a name="l00759"></a>00759   data.<a class="code" href="structBlocData.html#aab95b60e2dab03ad5eff9120820c9d9d">bord_xmax_</a> = nom_bords_max;
<a name="l00760"></a>00760   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> dir = 0; dir &lt; 3; dir++)
<a name="l00761"></a>00761     {
<a name="l00762"></a>00762       <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> nomdir;
<a name="l00763"></a>00763       <span class="keywordflow">if</span> (dir == 0) nomdir = <span class="stringliteral">&quot;x&quot;</span>;
<a name="l00764"></a>00764       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dir == 1) nomdir = <span class="stringliteral">&quot;y&quot;</span>;
<a name="l00765"></a>00765       <span class="keywordflow">else</span> nomdir = <span class="stringliteral">&quot;z&quot;</span>;
<a name="l00766"></a>00766       <span class="keywordflow">if</span> (perio[dir])
<a name="l00767"></a>00767         {
<a name="l00768"></a>00768           data.<a class="code" href="structBlocData.html#aab95b60e2dab03ad5eff9120820c9d9d">bord_xmax_</a>[dir] = data.<a class="code" href="structBlocData.html#a9f6276d86cf940a3048fb85ad658fe39">bord_xmin_</a>[dir];
<a name="l00769"></a>00769           bords.<a class="code" href="classList__Bord.html#a61386a2f94d915253bcec812ce0735c3">add</a>(<a class="code" href="classBord.html" title="Classe Bord Cette classe represente un bord d&#39;une zone, c&#39;est un type de frontiere&lt;br&gt;(derive de Fronti...">Bord</a>()).<a class="code" href="classObjet__U.html#a469dbcad1d4a98a67e4246dce8e264ad" title="Donne un nom a l&#39;Objet_U Methode virtuelle a surcharger.">nommer</a>(data.<a class="code" href="structBlocData.html#a9f6276d86cf940a3048fb85ad658fe39">bord_xmin_</a>[dir]);
<a name="l00770"></a>00770         }
<a name="l00771"></a>00771       <span class="keywordflow">else</span>
<a name="l00772"></a>00772         {
<a name="l00773"></a>00773           bords.<a class="code" href="classList__Bord.html#a61386a2f94d915253bcec812ce0735c3">add</a>(<a class="code" href="classBord.html" title="Classe Bord Cette classe represente un bord d&#39;une zone, c&#39;est un type de frontiere&lt;br&gt;(derive de Fronti...">Bord</a>()).<a class="code" href="classObjet__U.html#a469dbcad1d4a98a67e4246dce8e264ad" title="Donne un nom a l&#39;Objet_U Methode virtuelle a surcharger.">nommer</a>(data.<a class="code" href="structBlocData.html#a9f6276d86cf940a3048fb85ad658fe39">bord_xmin_</a>[dir]);
<a name="l00774"></a>00774           bords.<a class="code" href="classList__Bord.html#a61386a2f94d915253bcec812ce0735c3">add</a>(<a class="code" href="classBord.html" title="Classe Bord Cette classe represente un bord d&#39;une zone, c&#39;est un type de frontiere&lt;br&gt;(derive de Fronti...">Bord</a>()).<a class="code" href="classObjet__U.html#a469dbcad1d4a98a67e4246dce8e264ad" title="Donne un nom a l&#39;Objet_U Methode virtuelle a surcharger.">nommer</a>(data.<a class="code" href="structBlocData.html#aab95b60e2dab03ad5eff9120820c9d9d">bord_xmax_</a>[dir]);
<a name="l00775"></a>00775         }
<a name="l00776"></a>00776     }
<a name="l00777"></a>00777   data.<a class="code" href="structBlocData.html#a88c629a18e65a3811b8a5f68065bc304">xmax_tot_</a> = nb_noeuds;
<a name="l00778"></a>00778 
<a name="l00779"></a>00779   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> nblocs(3);
<a name="l00780"></a>00780   nblocs= 1;
<a name="l00781"></a>00781   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++)
<a name="l00782"></a>00782     {
<a name="l00783"></a>00783       <span class="keywordflow">if</span> (i_premier_element[i] &lt; 0)
<a name="l00784"></a>00784         nblocs[i] = 2;
<a name="l00785"></a>00785     }
<a name="l00786"></a>00786 
<a name="l00787"></a>00787   <span class="keywordtype">int</span> num_bord;
<a name="l00788"></a>00788   <span class="keywordflow">for</span> (num_bord = 0; num_bord &lt; bords.<a class="code" href="classliste.html#ab47f280662ff68f9aa2e00e50431c5dc" title="Renvoie la taille de la liste Une liste vide est de taille nulle.">size</a>(); num_bord++)
<a name="l00789"></a>00789     {
<a name="l00790"></a>00790       <a class="code" href="classBord.html" title="Classe Bord Cette classe represente un bord d&#39;une zone, c&#39;est un type de frontiere&lt;br&gt;(derive de Fronti...">Bord</a>&amp; bord = bords[num_bord];
<a name="l00791"></a>00791       bord.<a class="code" href="classFrontiere.html#af927b5d4fc1fd086ba91e916f61badee" title="Associe la frontiere a la zone dont elle depend.">associer_zone</a>(zone);
<a name="l00792"></a>00792       bord.<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a503fe687811445373b75dd8ac0991ec2" title="Type les faces.">typer</a>(zone.<a class="code" href="classZone.html#a18cf83cd0f9c368dcfa32fb802a0ac94" title="Renvoie un element geometrique du type de ceux qui constituent la zone. (version const)">type_elem</a>().<a class="code" href="classDeriv__Elem__geom__base.html#a384b487459a33f9f521fb16539ec81de">valeur</a>().<a class="code" href="classElem__geom__base.html#af781819b042bc5d8fec8b2255e32b498">type_face</a>());
<a name="l00793"></a>00793 <span class="comment">// important pour dimensionner le linesize du tableau des faces pour les frontieres vides</span>
<a name="l00794"></a>00794       bord.<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#aa3112928fe6cd95eb6c3394fd53c3cb1" title="(Re-)dimensionne les faces On redimensionne les voisins en consequence. Les sommets implicitement ajo...">dimensionner</a>(0);
<a name="l00795"></a>00795     }
<a name="l00796"></a>00796 
<a name="l00797"></a>00797   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> ibloc(3);
<a name="l00798"></a>00798   <span class="keywordflow">for</span> (ibloc[0] = 0; ibloc[0] &lt; nblocs[0]; ibloc[0]++)
<a name="l00799"></a>00799     {
<a name="l00800"></a>00800       <span class="keywordflow">for</span> (ibloc[1] = 0; ibloc[1]  &lt; nblocs[1]; ibloc[1]++)
<a name="l00801"></a>00801         {
<a name="l00802"></a>00802           <span class="keywordflow">for</span> (ibloc[2] = 0; ibloc[2]  &lt; nblocs[2]; ibloc[2]++)
<a name="l00803"></a>00803             {
<a name="l00804"></a>00804 
<a name="l00805"></a>00805               data.<a class="code" href="structBlocData.html#a1ad39d4feefa3ef69a274926b466ae1f">xmin_</a>.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(3);
<a name="l00806"></a>00806               data.<a class="code" href="structBlocData.html#ae49d411b8948c98ca29ed68cbe170b9f">xmax_</a>.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(3);
<a name="l00807"></a>00807               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> dir = 0; dir &lt; 3; dir++)
<a name="l00808"></a>00808                 {
<a name="l00809"></a>00809                   data.<a class="code" href="structBlocData.html#a1ad39d4feefa3ef69a274926b466ae1f">xmin_</a>[dir] = i_premier_element[dir];
<a name="l00810"></a>00810                   data.<a class="code" href="structBlocData.html#ae49d411b8948c98ca29ed68cbe170b9f">xmax_</a>[dir] = i_premier_element[dir] + nb_elements[dir] + 1;
<a name="l00811"></a>00811 
<a name="l00812"></a>00812                   <span class="keywordflow">if</span> (nblocs[dir] &gt; 1)
<a name="l00813"></a>00813                     {
<a name="l00814"></a>00814                       <span class="keywordflow">if</span> (ibloc[dir] == 0)
<a name="l00815"></a>00815                         data.<a class="code" href="structBlocData.html#a1ad39d4feefa3ef69a274926b466ae1f">xmin_</a>[dir] = 0;
<a name="l00816"></a>00816                       <span class="keywordflow">else</span>
<a name="l00817"></a>00817                         {
<a name="l00818"></a>00818                           data.<a class="code" href="structBlocData.html#a1ad39d4feefa3ef69a274926b466ae1f">xmin_</a>[dir] += data.<a class="code" href="structBlocData.html#a88c629a18e65a3811b8a5f68065bc304">xmax_tot_</a>[dir] - 1;
<a name="l00819"></a>00819                           data.<a class="code" href="structBlocData.html#ae49d411b8948c98ca29ed68cbe170b9f">xmax_</a>[dir] = data.<a class="code" href="structBlocData.html#a88c629a18e65a3811b8a5f68065bc304">xmax_tot_</a>[dir];
<a name="l00820"></a>00820                         }
<a name="l00821"></a>00821                     }
<a name="l00822"></a>00822                 }
<a name="l00823"></a>00823               <a class="code" href="classProcess.html#a57e0f54b11e6eaadbea224fa904b18dd" title="Renvoie un objet statique de type Sortie qui sert de journal d&#39;evenements. Si message_level &lt;= verbose...">Process::Journal</a>() &lt;&lt; <span class="stringliteral">&quot;add bloc xmin=&quot;</span> &lt;&lt; data.<a class="code" href="structBlocData.html#a1ad39d4feefa3ef69a274926b466ae1f">xmin_</a> &lt;&lt; <span class="stringliteral">&quot;xmax=&quot;</span> &lt;&lt; data.<a class="code" href="structBlocData.html#ae49d411b8948c98ca29ed68cbe170b9f">xmax_</a> &lt;&lt; <span class="stringliteral">&quot;xtot=&quot;</span> &lt;&lt; data.<a class="code" href="structBlocData.html#a88c629a18e65a3811b8a5f68065bc304">xmax_tot_</a>;
<a name="l00824"></a>00824               data.<a class="code" href="structBlocData.html#a185298286cbc7cdc06c085379d2fa3d9">add_bloc</a>(domaine, coord_ijk);
<a name="l00825"></a>00825             }
<a name="l00826"></a>00826         }
<a name="l00827"></a>00827     }
<a name="l00828"></a>00828 
<a name="l00829"></a>00829   {
<a name="l00830"></a>00830     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> d = 0; d &lt; 3; d++)
<a name="l00831"></a>00831       {
<a name="l00832"></a>00832         <span class="keywordflow">if</span> (perio[d])
<a name="l00833"></a>00833           {
<a name="l00834"></a>00834             <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> dir(3);
<a name="l00835"></a>00835             dir[d] = coord_ijk[d][nb_noeuds[d]-1] - coord_ijk[d][0];
<a name="l00836"></a>00836             <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; faces = domaine.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#af2f1e6a14af55249979da674e7aac11a" title="Renvoie le i-ieme bord de la zone&lt;br&gt;(version const)">bord</a>(nom_bords_min[d]).<a class="code" href="classFrontiere.html#ac64479069f0c43a17cb5766a39ce5ba8" title="Renvoie les faces de la frontiere&lt;br&gt;(version const)">faces</a>().<a class="code" href="classFaces.html#a07b8d8db9e3d656b93a21a49c063430c">les_sommets</a>();
<a name="l00837"></a>00837             <span class="keywordtype">double</span> epsilon = <a class="code" href="classObjet__U.html#a7447e25c68cc8d3a1c06cf99f0565cff">precision_geom</a>;
<a name="l00838"></a>00838             <a class="code" href="classReordonner__faces__periodiques.html#a3d177f6fcafb470513dad54fe4d9f79a" title="Reordonne le tableau &quot;faces&quot; selon la convention des faces periodiques: D&#39;abord les faces d&#39;une ext...">Reordonner_faces_periodiques::reordonner_faces_periodiques</a>(domaine, faces, dir, epsilon);
<a name="l00839"></a>00839           }
<a name="l00840"></a>00840       }
<a name="l00841"></a>00841   }
<a name="l00842"></a>00842 
<a name="l00843"></a>00843 
<a name="l00844"></a>00844   <a class="code" href="MaillerParallel_8cpp.html#a36b86a59ab5c59e71d833df1b70903ab">auto_build_joints</a>(domaine.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0), epaisseur_joint);
<a name="l00845"></a>00845 
<a name="l00846"></a>00846 
<a name="l00847"></a>00847   <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a0faf52d1b518f5b0b2177f22efcc222d" title="Arret du compteur counter_id. On ajoute quantity a la somme des &#39;quantity&#39; (par defaut 0) stockees po...">end_count</a>(stats);
<a name="l00848"></a>00848   <span class="keywordtype">double</span> maxtime = <a class="code" href="classProcess.html#a1e9d9f9899b71927cfafae14c7bd048d" title="Calcule le max de x sur tous les processeurs du groupe courant. Remarques : Cette methode doit etre a...">mp_max</a>(<a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().last_time(stats));
<a name="l00849"></a>00849   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l00850"></a>00850     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Ending of the construction of the zones, time:&quot;</span> &lt;&lt; maxtime &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00851"></a>00851 
<a name="l00852"></a>00852   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">nproc</a>() &gt; 1)
<a name="l00853"></a>00853     {
<a name="l00854"></a>00854 
<a name="l00855"></a>00855       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#affcd058809786918ed173aaf681d0843">begin_count</a>(stats);
<a name="l00856"></a>00856 
<a name="l00857"></a>00857       <a class="code" href="classScatter.html#acafac38fc2983e19398c403a9235bb4c" title="Construction des tableaux joint_item(Joint::SOMMET).items_communs de tous les joints de la zone(0) du...">Scatter::construire_correspondance_sommets_par_coordonnees</a>(domaine);
<a name="l00858"></a>00858       <a class="code" href="classScatter.html#a21f166c05df9be1fc1f02b0604624fe5" title="On suppose que chaque joint[i].joint_item(type_item).items_communs() contient les indices locaux des ...">Scatter::calculer_renum_items_communs</a>(domaine.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#a16f273a76321d31435995cdad664285a" title="Renvoie la liste des joints de la zone. (version const)">faces_joint</a>(), <a class="code" href="classJoint.html#a1e2d15d088c27c9b7b11c02bf4d2c926a050aa4faf237e25faef6fff15ffc20f8">Joint::SOMMET</a>);
<a name="l00859"></a>00859 
<a name="l00860"></a>00860       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a0faf52d1b518f5b0b2177f22efcc222d" title="Arret du compteur counter_id. On ajoute quantity a la somme des &#39;quantity&#39; (par defaut 0) stockees po...">end_count</a>(stats);
<a name="l00861"></a>00861       maxtime = <a class="code" href="classProcess.html#a1e9d9f9899b71927cfafae14c7bd048d" title="Calcule le max de x sur tous les processeurs du groupe courant. Remarques : Cette methode doit etre a...">mp_max</a>(<a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().last_time(stats));
<a name="l00862"></a>00862       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Scatter::construire_correspondance_sommets_par_coordonnees fin, time:&quot;</span>
<a name="l00863"></a>00863            &lt;&lt; maxtime &lt;&lt; finl;
<a name="l00864"></a>00864 
<a name="l00865"></a>00865       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#affcd058809786918ed173aaf681d0843">begin_count</a>(stats);
<a name="l00866"></a>00866 
<a name="l00867"></a>00867       <a class="code" href="classScatter.html#af6b88297583bd92c6ca3814bc532b8be" title="Construction des structures paralleles du domaine et de la zone (determination des elements distants ...">Scatter::construire_structures_paralleles</a>(domaine, liste_bords_perio);
<a name="l00868"></a>00868 
<a name="l00869"></a>00869       <a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().<a class="code" href="classStatistiques.html#a0faf52d1b518f5b0b2177f22efcc222d" title="Arret du compteur counter_id. On ajoute quantity a la somme des &#39;quantity&#39; (par defaut 0) stockees po...">end_count</a>(stats);
<a name="l00870"></a>00870       maxtime = <a class="code" href="classProcess.html#a1e9d9f9899b71927cfafae14c7bd048d" title="Calcule le max de x sur tous les processeurs du groupe courant. Remarques : Cette methode doit etre a...">mp_max</a>(<a class="code" href="Statistiques_8h.html#a7bb2ce53a9ec088bba93ddcfce2b8cb1">statistiques</a>().last_time(stats));
<a name="l00871"></a>00871       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Scatter::construire_structures_paralleles, time:&quot;</span> &lt;&lt; maxtime &lt;&lt; finl;
<a name="l00872"></a>00872     }
<a name="l00873"></a>00873   <span class="keywordflow">else</span>
<a name="l00874"></a>00874     {
<a name="l00875"></a>00875       <a class="code" href="classScatter.html#a1874139ffd29d5a68191bc7828d3a5bd" title="cree des descripteurs sequentiels pour les tableaux sommets et elements du domaine (necessaire car Sc...">Scatter::init_sequential_domain</a>(domaine);
<a name="l00876"></a>00876     }
<a name="l00877"></a>00877 
<a name="l00878"></a>00878   domaine.<a class="code" href="classDomaine.html#a0e62f2bc829542fafa29e3f2c614159c" title="Renvoie la i-ieme zone du domaine. (version const)">zone</a>(0).<a class="code" href="classZone.html#ad9cedce77314d4aa1d84a12958079b0e" title="Donne un nom a la zone.">nommer</a>(domaine.<a class="code" href="classDomaine.html#a87e2cdc035a26565e6fe481446aa4cd3" title="Renvoie le nom du domaine.">le_nom</a>());
<a name="l00879"></a>00879 
<a name="l00880"></a>00880   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;MaillerParallel::construire_domaine : end&quot;</span> &lt;&lt; finl;
<a name="l00881"></a>00881 
<a name="l00882"></a>00882   <span class="keywordflow">return</span> is;
<a name="l00883"></a>00883 }
<a name="l00884"></a>00884 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:19 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
