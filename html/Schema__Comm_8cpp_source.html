<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/Kernel/Utilitaires/Schema_Comm.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/Kernel/Utilitaires/Schema_Comm.cpp</div>  </div>
</div>
<div class="contents">
<a href="Schema__Comm_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (c) 2019, CEA</span>
<a name="l00003"></a>00003 <span class="comment">* All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment">* 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00007"></a>00007 <span class="comment">* 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00008"></a>00008 <span class="comment">* 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<a name="l00011"></a>00011 <span class="comment">* IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;</span>
<a name="l00012"></a>00012 <span class="comment">* OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// File:        Schema_Comm.cpp</span>
<a name="l00018"></a>00018 <span class="comment">// Directory:   $TRUST_ROOT/src/Kernel/Utilitaires</span>
<a name="l00019"></a>00019 <span class="comment">// Version:     /main/16</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;<a class="code" href="Schema__Comm_8h.html">Schema_Comm.h</a>&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;<a class="code" href="PE__Groups_8h.html">PE_Groups.h</a>&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="Vect__ArrOfInt_8h.html">Vect_ArrOfInt.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="InOutCommBuffers_8h.html">InOutCommBuffers.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="Comm__Group_8h.html">Comm_Group.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="communications_8h.html">communications.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="Comm__Group__MPI_8h.html">Comm_Group_MPI.h</a>&gt;</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="comment">// ====================================================================</span>
<a name="l00031"></a>00031 <span class="comment">// class Schema_Comm</span>
<a name="l00032"></a>00032 <span class="comment">// ====================================================================</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <a class="code" href="classSchema__Comm.html#a513eef36a4603d995f2a04f166812470">Schema_Comm::Static_Status</a> <a class="code" href="classSchema__Comm.html#ae56acaadf7a079ce874be628491593cb">Schema_Comm::status_</a> = UNINITIALIZED;
<a name="l00035"></a>00035 <a class="code" href="classInOutCommBuffers.html">InOutCommBuffers</a>   <a class="code" href="classSchema__Comm.html#a6ce69882db45689247b677d5978d569e">Schema_Comm::buffers_</a>;
<a name="l00036"></a>00036 <span class="keywordtype">int</span>                <a class="code" href="classSchema__Comm.html#ac4ab50424d6aa29ac87103aa7690e203">Schema_Comm::n_buffers_</a> = 0;
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="comment">//</span><span class="comment"></span>
<a name="l00039"></a>00039 <span class="comment">//! Accesseur a un membre du tableau obuffers_ (avec verification)</span>
<a name="l00040"></a><a class="code" href="classSchema__Comm.html#a734080d1326e58abdc5731d1b3486d4b">00040</a> <span class="comment"></span><span class="keyword">inline</span> <a class="code" href="classOutputCommBuffer.html" title=": Classe outil utilisee exclusivement par Schema_Comm. C&#39;est une classe derivee de Entree dont le str...">OutputCommBuffer</a>&amp; <a class="code" href="classSchema__Comm.html#a734080d1326e58abdc5731d1b3486d4b" title="Accesseur a un membre du tableau obuffers_ (avec verification)">Schema_Comm::obuffer</a>(<span class="keywordtype">int</span> pe)
<a name="l00041"></a>00041 {
<a name="l00042"></a>00042   assert(pe &gt;= 0 &amp;&amp; pe &lt; <a class="code" href="classSchema__Comm.html#ac4ab50424d6aa29ac87103aa7690e203">n_buffers_</a>);
<a name="l00043"></a>00043   <span class="keywordflow">return</span> <a class="code" href="classSchema__Comm.html#a6ce69882db45689247b677d5978d569e">buffers_</a>.<a class="code" href="classInOutCommBuffers.html#afb8912746dd19244b430fd26d874d5d4">obuffers_</a>[pe];
<a name="l00044"></a>00044 }
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="comment">//</span><span class="comment"></span>
<a name="l00047"></a>00047 <span class="comment">//! Accesseur a un membre du tableau ebuffers_ (avec verification)</span>
<a name="l00048"></a><a class="code" href="classSchema__Comm.html#a0955c141014893e559b831ae33d55d56">00048</a> <span class="comment"></span><span class="keyword">inline</span> <a class="code" href="classInputCommBuffer.html" title=": Classe outil utilisee exclusivement par Schema_Comm. C&#39;est une classe derivee de Entree dont le str...">InputCommBuffer</a>&amp;   <a class="code" href="classSchema__Comm.html#a0955c141014893e559b831ae33d55d56" title="Accesseur a un membre du tableau ebuffers_ (avec verification)">Schema_Comm::ebuffer</a>(<span class="keywordtype">int</span> pe)
<a name="l00049"></a>00049 {
<a name="l00050"></a>00050   assert(pe &gt;= 0 &amp;&amp; pe &lt; <a class="code" href="classSchema__Comm.html#ac4ab50424d6aa29ac87103aa7690e203">n_buffers_</a>);
<a name="l00051"></a>00051   <span class="keywordflow">return</span> <a class="code" href="classSchema__Comm.html#a6ce69882db45689247b677d5978d569e">buffers_</a>.<a class="code" href="classInOutCommBuffers.html#a4f45d4ba0db13ce4aae52b93539b67ee">ebuffers_</a>[pe];
<a name="l00052"></a>00052 }
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="comment">// static const int SET_GROUP_TAG = 0;</span>
<a name="l00055"></a><a class="code" href="Schema__Comm_8cpp.html#a85ca790bf7f3401ae365ae2f7ba1bdff">00055</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="Schema__Comm_8cpp.html#a85ca790bf7f3401ae365ae2f7ba1bdff">BEGIN_COMM_TAG</a> = 1;
<a name="l00056"></a><a class="code" href="Schema__Comm_8cpp.html#a4c41ba0edefa0cda76d623d2bee6099d">00056</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="Schema__Comm_8cpp.html#a4c41ba0edefa0cda76d623d2bee6099d">ECHANGE_MESSAGES_COMM_TAG</a> = 2;
<a name="l00057"></a><a class="code" href="Schema__Comm_8cpp.html#aad8b15298bcd90d51ca68c28f25a4fbf">00057</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="Schema__Comm_8cpp.html#aad8b15298bcd90d51ca68c28f25a4fbf">END_COMM_TAG</a> = 3;
<a name="l00058"></a><a class="code" href="Schema__Comm_8cpp.html#aeab2e35cc58325aa2499ebf416a90038">00058</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="Schema__Comm_8cpp.html#aeab2e35cc58325aa2499ebf416a90038">COPY_OPERATOR_TAG</a> = 4;
<a name="l00059"></a>00059 <span class="comment">// static const int CHECK_SEND_RCV_TAG = 5;</span>
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="comment">//</span><span class="comment"></span>
<a name="l00062"></a>00062 <span class="comment">//! Construction d&#39;un nouveau schema de communication.</span>
<a name="l00063"></a><a class="code" href="classSchema__Comm.html#af2b4707c7ffae5a98fae11d6bf185d05">00063</a> <span class="comment"></span><a class="code" href="classSchema__Comm.html#af2b4707c7ffae5a98fae11d6bf185d05" title="Construction d&#39;un nouveau schema de communication.">Schema_Comm::Schema_Comm</a>()
<a name="l00064"></a>00064 {
<a name="l00065"></a>00065   <a class="code" href="classSchema__Comm.html#a93eb7538476fa54ade96e88294feec8e" title="Liste des processeurs a qui envoyer.">send_pe_list_</a>.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00066"></a>00066   <a class="code" href="classSchema__Comm.html#a24918eceb0ce15a6dae5a5a833480246" title="Liste des processeurs de qui recevoir.">recv_pe_list_</a>.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00067"></a>00067   <a class="code" href="classSchema__Comm.html#aaa55ab78220cfcca058cf54a7ac14cc0" title="Drapeau: est-ce qu&#39;on autorise a s&#39;envoyer des messages a soi ?">me_to_me_</a> = 0;
<a name="l00068"></a>00068   <a class="code" href="classSchema__Comm.html#a88ddb051931c6d62f96d57ca2f79f7c1" title="Drapeau, quel type de communication faut-il utiliser ?">use_all_to_allv_</a> = 0;
<a name="l00069"></a>00069 <span class="comment">// Pour verifier plus tard qu&#39;on est toujours dans le bon groupe,</span>
<a name="l00070"></a>00070 <span class="comment">// on conserve une ref au groupe courant.</span>
<a name="l00071"></a>00071   <a class="code" href="classSchema__Comm.html#adcd2cdb2d6ce76883858c8f6078fda56" title="Groupe de processeurs qui vont discuter.">ref_group_</a> = <a class="code" href="classPE__Groups.html#ae6ca0277a58f2ab34ebfb3216578fa75" title="renvoie une reference au groupe de processeurs actif courant">PE_Groups::current_group</a>();
<a name="l00072"></a>00072   <span class="keywordflow">if</span> (<a class="code" href="classSchema__Comm.html#ae56acaadf7a079ce874be628491593cb">status_</a> == <a class="code" href="classSchema__Comm.html#a513eef36a4603d995f2a04f166812470ab8a8496bcb475aa3d59c4392d8fc08a9">UNINITIALIZED</a>)
<a name="l00073"></a>00073     {
<a name="l00074"></a>00074       <a class="code" href="classSchema__Comm.html#ac4ab50424d6aa29ac87103aa7690e203">n_buffers_</a> = <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l00075"></a>00075       <a class="code" href="classSchema__Comm.html#a6ce69882db45689247b677d5978d569e">buffers_</a>.<a class="code" href="classInOutCommBuffers.html#afb8912746dd19244b430fd26d874d5d4">obuffers_</a> = <span class="keyword">new</span> <a class="code" href="classOutputCommBuffer.html" title=": Classe outil utilisee exclusivement par Schema_Comm. C&#39;est une classe derivee de Entree dont le str...">OutputCommBuffer</a>[<a class="code" href="classSchema__Comm.html#ac4ab50424d6aa29ac87103aa7690e203">n_buffers_</a>];
<a name="l00076"></a>00076       <a class="code" href="classSchema__Comm.html#a6ce69882db45689247b677d5978d569e">buffers_</a>.<a class="code" href="classInOutCommBuffers.html#a4f45d4ba0db13ce4aae52b93539b67ee">ebuffers_</a> = <span class="keyword">new</span> <a class="code" href="classInputCommBuffer.html" title=": Classe outil utilisee exclusivement par Schema_Comm. C&#39;est une classe derivee de Entree dont le str...">InputCommBuffer</a>[<a class="code" href="classSchema__Comm.html#ac4ab50424d6aa29ac87103aa7690e203">n_buffers_</a>];
<a name="l00077"></a>00077       <a class="code" href="classSchema__Comm.html#ae56acaadf7a079ce874be628491593cb">status_</a> = <a class="code" href="classSchema__Comm.html#a513eef36a4603d995f2a04f166812470a79ffb1835b68257288b75f8fbcb65178">RESET</a>;
<a name="l00078"></a>00078     }
<a name="l00079"></a>00079 }
<a name="l00080"></a>00080 
<a name="l00081"></a>00081 <span class="comment">//</span><span class="comment"></span>
<a name="l00082"></a>00082 <span class="comment">//! Destruction d&#39;un schema de communication.</span>
<a name="l00083"></a><a class="code" href="classSchema__Comm.html#a5b8b9f4946cb1de5edad0721561c43f8">00083</a> <span class="comment"></span><a class="code" href="classSchema__Comm.html#a5b8b9f4946cb1de5edad0721561c43f8" title="Destruction d&#39;un schema de communication.">Schema_Comm::~Schema_Comm</a>()
<a name="l00084"></a>00084 {
<a name="l00085"></a>00085 }
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 <span class="comment">//</span>
<a name="l00088"></a>00088 <span class="comment">//</span>
<a name="l00089"></a>00089 <span class="comment">//</span><span class="comment"></span>
<a name="l00090"></a>00090 <span class="comment">//! Constructeur par copie (nouveau schema place en mode RESET).&lt;br&gt;Attention : tous les membres du Comm_Group doivent executer&lt;br&gt;cette fonction simultanement.</span>
<a name="l00091"></a><a class="code" href="classSchema__Comm.html#a8f7a71ce2536bf4b3fc52f77862fa01d">00091</a> <span class="comment"></span><a class="code" href="classSchema__Comm.html#af2b4707c7ffae5a98fae11d6bf185d05" title="Construction d&#39;un nouveau schema de communication.">Schema_Comm::Schema_Comm</a>(<span class="keyword">const</span> <a class="code" href="classSchema__Comm.html">Schema_Comm</a>&amp; schema)
<a name="l00092"></a>00092 {
<a name="l00093"></a>00093   <a class="code" href="classSchema__Comm.html#a93eb7538476fa54ade96e88294feec8e" title="Liste des processeurs a qui envoyer.">send_pe_list_</a>.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00094"></a>00094   <a class="code" href="classSchema__Comm.html#a24918eceb0ce15a6dae5a5a833480246" title="Liste des processeurs de qui recevoir.">recv_pe_list_</a>.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00095"></a>00095   <a class="code" href="classSchema__Comm.html#a0963ab78f7c26d5fb8e25b1a657ea414" title="Operateur copie : on copie la liste des processeurs qui communiquent. Le nouveau schema est place dan...">operator= </a>(schema);
<a name="l00096"></a>00096 }
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 <span class="comment">//</span>
<a name="l00099"></a>00099 <span class="comment">//</span>
<a name="l00100"></a>00100 <span class="comment">//</span>
<a name="l00101"></a>00101 <span class="comment">//</span><span class="comment"></span>
<a name="l00102"></a>00102 <span class="comment">//! Operateur copie : on copie la liste des processeurs qui&lt;br&gt;communiquent. Le nouveau schema est place dans l&#39;etat RESET.&lt;br&gt;Attention : tous les membres du Comm_Group doivent executer&lt;br&gt;cette fonction simultanement.</span>
<a name="l00103"></a><a class="code" href="classSchema__Comm.html#a0963ab78f7c26d5fb8e25b1a657ea414">00103</a> <span class="comment"></span><span class="keyword">const</span> <a class="code" href="classSchema__Comm.html">Schema_Comm</a>&amp; <a class="code" href="classSchema__Comm.html#a0963ab78f7c26d5fb8e25b1a657ea414" title="Operateur copie : on copie la liste des processeurs qui communiquent. Le nouveau schema est place dan...">Schema_Comm::operator=</a>(<span class="keyword">const</span> <a class="code" href="classSchema__Comm.html">Schema_Comm</a>&amp; schema)
<a name="l00104"></a>00104 {
<a name="l00105"></a>00105   assert(<a class="code" href="classSchema__Comm.html#ae56acaadf7a079ce874be628491593cb">status_</a> == <a class="code" href="classSchema__Comm.html#a513eef36a4603d995f2a04f166812470a79ffb1835b68257288b75f8fbcb65178">RESET</a>);
<a name="l00106"></a>00106   <a class="code" href="classSchema__Comm.html#adcd2cdb2d6ce76883858c8f6078fda56" title="Groupe de processeurs qui vont discuter.">ref_group_</a> = schema.<a class="code" href="classSchema__Comm.html#adcd2cdb2d6ce76883858c8f6078fda56" title="Groupe de processeurs qui vont discuter.">ref_group_</a>;
<a name="l00107"></a>00107   assert(&amp;(<a class="code" href="classSchema__Comm.html#adcd2cdb2d6ce76883858c8f6078fda56" title="Groupe de processeurs qui vont discuter.">ref_group_</a>.<a class="code" href="classRef__Comm__Group.html#a46f3361cb566b4a386f75f7f9570fe9a">valeur</a>()) == &amp;<a class="code" href="classPE__Groups.html#ae6ca0277a58f2ab34ebfb3216578fa75" title="renvoie une reference au groupe de processeurs actif courant">PE_Groups::current_group</a>());
<a name="l00108"></a>00108   <a class="code" href="classSchema__Comm.html#a93eb7538476fa54ade96e88294feec8e" title="Liste des processeurs a qui envoyer.">send_pe_list_</a> = schema.<a class="code" href="classSchema__Comm.html#a93eb7538476fa54ade96e88294feec8e" title="Liste des processeurs a qui envoyer.">send_pe_list_</a>;
<a name="l00109"></a>00109   <a class="code" href="classSchema__Comm.html#a24918eceb0ce15a6dae5a5a833480246" title="Liste des processeurs de qui recevoir.">recv_pe_list_</a> = schema.<a class="code" href="classSchema__Comm.html#a24918eceb0ce15a6dae5a5a833480246" title="Liste des processeurs de qui recevoir.">recv_pe_list_</a>;
<a name="l00110"></a>00110   <a class="code" href="classSchema__Comm.html#aaa55ab78220cfcca058cf54a7ac14cc0" title="Drapeau: est-ce qu&#39;on autorise a s&#39;envoyer des messages a soi ?">me_to_me_</a>     = schema.<a class="code" href="classSchema__Comm.html#aaa55ab78220cfcca058cf54a7ac14cc0" title="Drapeau: est-ce qu&#39;on autorise a s&#39;envoyer des messages a soi ?">me_to_me_</a>;
<a name="l00111"></a>00111   <a class="code" href="classSchema__Comm.html#a88ddb051931c6d62f96d57ca2f79f7c1" title="Drapeau, quel type de communication faut-il utiliser ?">use_all_to_allv_</a> = schema.<a class="code" href="classSchema__Comm.html#a88ddb051931c6d62f96d57ca2f79f7c1" title="Drapeau, quel type de communication faut-il utiliser ?">use_all_to_allv_</a>;
<a name="l00112"></a>00112   <span class="keyword">const</span> <a class="code" href="classComm__Group.html" title=": Cette classe decrit un groupe de processeurs sur lesquels une portion de code s&#39;execute simultaneme...">Comm_Group</a>&amp; group = <a class="code" href="classSchema__Comm.html#adcd2cdb2d6ce76883858c8f6078fda56" title="Groupe de processeurs qui vont discuter.">ref_group_</a>.<a class="code" href="classRef__Comm__Group.html#a46f3361cb566b4a386f75f7f9570fe9a">valeur</a>();
<a name="l00113"></a>00113   <span class="keywordflow">if</span> (group.<a class="code" href="classComm__Group.html#a0f230fe65c9f52fd2a168a1ea70e7b15">check_enabled</a>()) group.<a class="code" href="classComm__Group.html#ac20236e71fc50066d225761ba1349c69">barrier</a>(<a class="code" href="Schema__Comm_8cpp.html#aeab2e35cc58325aa2499ebf416a90038">COPY_OPERATOR_TAG</a>);
<a name="l00114"></a>00114   <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00115"></a>00115 }
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 <span class="comment">//</span>
<a name="l00118"></a>00118 <span class="comment">//</span>
<a name="l00119"></a>00119 <span class="comment">//</span>
<a name="l00120"></a>00120 <span class="comment">//</span><span class="comment"></span>
<a name="l00121"></a>00121 <span class="comment">//! Methode obsolete, le groupe associe au schema est le groupe&lt;br&gt;courant au moment ou on cree le schema. L&#39;appel a cette methode&lt;br&gt;n&#39;est valide qu&#39;avec le meme groupe que le groupe d&#39;origine.&lt;br&gt;La methode ne fait rien.</span>
<a name="l00122"></a><a class="code" href="classSchema__Comm.html#a46dd131a48e83d289e078f163e7f5c9d">00122</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classSchema__Comm.html#a46dd131a48e83d289e078f163e7f5c9d" title="Obsolete.">Schema_Comm::set_group</a>(<span class="keyword">const</span> <a class="code" href="classComm__Group.html" title=": Cette classe decrit un groupe de processeurs sur lesquels une portion de code s&#39;execute simultaneme...">Comm_Group</a>&amp; group)
<a name="l00123"></a>00123 {
<a name="l00124"></a>00124   assert(&amp;group == &amp;(<a class="code" href="classSchema__Comm.html#adcd2cdb2d6ce76883858c8f6078fda56" title="Groupe de processeurs qui vont discuter.">ref_group_</a>.<a class="code" href="classRef__Comm__Group.html#a46f3361cb566b4a386f75f7f9570fe9a">valeur</a>()));
<a name="l00125"></a>00125   assert(&amp;group == &amp;<a class="code" href="classPE__Groups.html#ae6ca0277a58f2ab34ebfb3216578fa75" title="renvoie une reference au groupe de processeurs actif courant">PE_Groups::current_group</a>());
<a name="l00126"></a>00126 }
<a name="l00127"></a>00127 
<a name="l00128"></a>00128 <span class="comment">//</span><span class="comment"></span>
<a name="l00129"></a>00129 <span class="comment">//! Renvoie le groupe auquel est associe le schema.</span>
<a name="l00130"></a><a class="code" href="classSchema__Comm.html#af18c96784f01b84237cae0327a175fcf">00130</a> <span class="comment"></span><span class="keyword">const</span> <a class="code" href="classComm__Group.html" title=": Cette classe decrit un groupe de processeurs sur lesquels une portion de code s&#39;execute simultaneme...">Comm_Group</a>&amp; <a class="code" href="classSchema__Comm.html#af18c96784f01b84237cae0327a175fcf" title="Renvoie le groupe auquel est associe le schema.">Schema_Comm::get_group</a>()<span class="keyword"> const</span>
<a name="l00131"></a>00131 <span class="keyword"></span>{
<a name="l00132"></a>00132   assert(<a class="code" href="classSchema__Comm.html#adcd2cdb2d6ce76883858c8f6078fda56" title="Groupe de processeurs qui vont discuter.">ref_group_</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>());
<a name="l00133"></a>00133   <span class="keywordflow">return</span> <a class="code" href="classSchema__Comm.html#adcd2cdb2d6ce76883858c8f6078fda56" title="Groupe de processeurs qui vont discuter.">ref_group_</a>.<a class="code" href="classRef__Comm__Group.html#a46f3361cb566b4a386f75f7f9570fe9a">valeur</a>();
<a name="l00134"></a>00134 }
<a name="l00135"></a>00135 
<a name="l00136"></a>00136 <span class="comment">// Precondition:</span>
<a name="l00137"></a>00137 <span class="comment">// * Le schema doit etre dans l&#39;etat RESET.</span>
<a name="l00138"></a>00138 <span class="comment">// * Les tableaux doivent verifier le principe &quot;tu m&#39;ecoutes quand je te parle&quot;</span>
<a name="l00139"></a>00139 <span class="comment">// (voir commentaire de la classe)</span>
<a name="l00140"></a>00140 <span class="comment">// * Mon numero de proc ne doit pas etre dans les listes send_pe_list et</span>
<a name="l00141"></a>00141 <span class="comment">// recv_pe_list (sauf si me_to_me=1)</span>
<a name="l00142"></a>00142 <span class="comment">//</span>
<a name="l00143"></a>00143 <span class="comment">//</span>
<a name="l00144"></a>00144 <span class="comment">//</span><span class="comment"></span>
<a name="l00145"></a>00145 <span class="comment">//! Definit la liste des processeurs a qui on va envoyer&lt;br&gt;et de qui on va recevoir des donnees.&lt;br&gt;Si me_to_me est non nul, on autorise l&#39;envoi des messages a soi-meme,&lt;br&gt;sinon non (argument optionnel : par defaut, me_to_me=0)</span>
<a name="l00146"></a><a class="code" href="classSchema__Comm.html#ad11c9b47999c294c26ae4df8d2bbd57b">00146</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classSchema__Comm.html#ad11c9b47999c294c26ae4df8d2bbd57b" title="Definit la liste des processeurs a qui on va envoyer et de qui on va recevoir des donnees...">Schema_Comm::set_send_recv_pe_list</a>(<span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; send_pe_list,
<a name="l00147"></a>00147                                         <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; recv_pe_list,
<a name="l00148"></a>00148                                         <span class="keyword">const</span> <span class="keywordtype">int</span>     me_to_me)
<a name="l00149"></a>00149 {
<a name="l00150"></a>00150   assert(<a class="code" href="classSchema__Comm.html#ae56acaadf7a079ce874be628491593cb">status_</a> == <a class="code" href="classSchema__Comm.html#a513eef36a4603d995f2a04f166812470a79ffb1835b68257288b75f8fbcb65178">RESET</a>);
<a name="l00151"></a>00151   <a class="code" href="classSchema__Comm.html#a93eb7538476fa54ade96e88294feec8e" title="Liste des processeurs a qui envoyer.">send_pe_list_</a> = send_pe_list;
<a name="l00152"></a>00152   <a class="code" href="classSchema__Comm.html#a24918eceb0ce15a6dae5a5a833480246" title="Liste des processeurs de qui recevoir.">recv_pe_list_</a> = recv_pe_list;
<a name="l00153"></a>00153   <a class="code" href="classSchema__Comm.html#aaa55ab78220cfcca058cf54a7ac14cc0" title="Drapeau: est-ce qu&#39;on autorise a s&#39;envoyer des messages a soi ?">me_to_me_</a> = me_to_me;
<a name="l00154"></a>00154 <span class="comment">// Verification du principe &quot;tu m&#39;ecoutes quand je te parle&quot;</span>
<a name="l00155"></a>00155   <span class="keyword">const</span> <a class="code" href="classComm__Group.html" title=": Cette classe decrit un groupe de processeurs sur lesquels une portion de code s&#39;execute simultaneme...">Comm_Group</a>&amp; group = <a class="code" href="classSchema__Comm.html#adcd2cdb2d6ce76883858c8f6078fda56" title="Groupe de processeurs qui vont discuter.">ref_group_</a>.<a class="code" href="classRef__Comm__Group.html#a46f3361cb566b4a386f75f7f9570fe9a">valeur</a>();
<a name="l00156"></a>00156   assert(&amp;group == &amp;<a class="code" href="classPE__Groups.html#ae6ca0277a58f2ab34ebfb3216578fa75" title="renvoie une reference au groupe de processeurs actif courant">PE_Groups::current_group</a>());
<a name="l00157"></a>00157   <span class="keywordflow">if</span> (group.<a class="code" href="classComm__Group.html#a0f230fe65c9f52fd2a168a1ea70e7b15">check_enabled</a>()) <a class="code" href="classSchema__Comm.html#a10b238ae8ba1d3f6ed955fa7164c93ce" title="Verifie que les send/recv_pe_list verifient la propriete &quot;tu m&#39;ecoutes quand je te parle&quot;...">check_send_recv_pe_list</a>();
<a name="l00158"></a>00158 }
<a name="l00159"></a>00159 
<a name="l00160"></a>00160 <span class="comment">//</span>
<a name="l00161"></a>00161 <span class="comment">//</span>
<a name="l00162"></a>00162 <span class="comment">//</span>
<a name="l00163"></a>00163 <span class="comment">//</span>
<a name="l00164"></a>00164 <span class="comment">//</span><span class="comment"></span>
<a name="l00165"></a>00165 <span class="comment">//! Reserve les buffers de comm pour une nouvelle communication.&lt;br&gt;Le schema passe de RESET a WRITING, on a maintenant le droit&lt;br&gt;d&#39;appeler send_buffer(). Interdiction d&#39;appeler a nouveau begin_comm&lt;br&gt;sur tous les objets de comm avant d&#39;avoir fini cette communication&lt;br&gt;avec end_comm().</span>
<a name="l00166"></a><a class="code" href="classSchema__Comm.html#ac617b53de22748cdd9fa30a0cfd0f4a8">00166</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classSchema__Comm.html#ac617b53de22748cdd9fa30a0cfd0f4a8" title="Statut passe a WRITING Autorise si status_ == WRITING:">Schema_Comm::begin_comm</a>()<span class="keyword"> const</span>
<a name="l00167"></a>00167 <span class="keyword"></span>{
<a name="l00168"></a>00168 <span class="comment">// On verifie qu&#39;une autre communication n&#39;est pas en cours.</span>
<a name="l00169"></a>00169   assert (<a class="code" href="classSchema__Comm.html#ae56acaadf7a079ce874be628491593cb">status_</a> == <a class="code" href="classSchema__Comm.html#a513eef36a4603d995f2a04f166812470a79ffb1835b68257288b75f8fbcb65178">RESET</a> &amp;&amp; <a class="code" href="classSchema__Comm.html#adcd2cdb2d6ce76883858c8f6078fda56" title="Groupe de processeurs qui vont discuter.">ref_group_</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>());
<a name="l00170"></a>00170   <a class="code" href="classSchema__Comm.html#ae56acaadf7a079ce874be628491593cb">status_</a> = <a class="code" href="classSchema__Comm.html#a513eef36a4603d995f2a04f166812470a218bae4e3cf445666fb4c8d08d055f0d">WRITING</a>;
<a name="l00171"></a>00171 <span class="comment">// On verifie que tous les membres du groupe executent ceci.</span>
<a name="l00172"></a>00172 <span class="comment">// Si ca plante ici, c&#39;est que tous les membres declares ne sont</span>
<a name="l00173"></a>00173 <span class="comment">// pas en train de faire la barriere.</span>
<a name="l00174"></a>00174   <span class="keyword">const</span> <a class="code" href="classComm__Group.html" title=": Cette classe decrit un groupe de processeurs sur lesquels une portion de code s&#39;execute simultaneme...">Comm_Group</a>&amp; group = <a class="code" href="classSchema__Comm.html#adcd2cdb2d6ce76883858c8f6078fda56" title="Groupe de processeurs qui vont discuter.">ref_group_</a>.<a class="code" href="classRef__Comm__Group.html#a46f3361cb566b4a386f75f7f9570fe9a">valeur</a>();
<a name="l00175"></a>00175   assert(&amp;group == &amp;<a class="code" href="classPE__Groups.html#ae6ca0277a58f2ab34ebfb3216578fa75" title="renvoie une reference au groupe de processeurs actif courant">PE_Groups::current_group</a>());
<a name="l00176"></a>00176   <span class="keywordflow">if</span> (group.<a class="code" href="classComm__Group.html#a0f230fe65c9f52fd2a168a1ea70e7b15">check_enabled</a>()) group.<a class="code" href="classComm__Group.html#ac20236e71fc50066d225761ba1349c69">barrier</a>(<a class="code" href="Schema__Comm_8cpp.html#a85ca790bf7f3401ae365ae2f7ba1bdff">BEGIN_COMM_TAG</a>);
<a name="l00177"></a>00177 }
<a name="l00178"></a>00178 
<a name="l00179"></a><a class="code" href="Schema__Comm_8cpp.html#a269962dc3d54d1d174a7936f5fe41d72">00179</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="Schema__Comm_8cpp.html#a269962dc3d54d1d174a7936f5fe41d72">exchange_data</a>(<span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; send_list,
<a name="l00180"></a>00180                           <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; send_size,
<a name="l00181"></a>00181                           <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> * <span class="keyword">const</span> send_buffers,
<a name="l00182"></a>00182                           <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; recv_list,
<a name="l00183"></a>00183                           <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; recv_size,
<a name="l00184"></a>00184                           <span class="keywordtype">char</span> * <span class="keyword">const</span> * <span class="keyword">const</span> recv_buffers,
<a name="l00185"></a>00185                           <span class="keyword">const</span> <a class="code" href="classComm__Group.html" title=": Cette classe decrit un groupe de processeurs sur lesquels une portion de code s&#39;execute simultaneme...">Comm_Group</a>&amp; group,
<a name="l00186"></a>00186                           <span class="keywordtype">bool</span> use_all_to_all)
<a name="l00187"></a>00187 {
<a name="l00188"></a>00188 <span class="comment">// GF je rajoute le ifdef pour les versions sans MPI comm_group_mpi n&#39;existep pas</span>
<a name="l00189"></a>00189 <span class="preprocessor">#ifdef MPI_</span>
<a name="l00190"></a>00190 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (!use_all_to_all || !<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classComm__Group__MPI.html" title=": Classe Comm_Group_MPI, derivee de la classe abstraite Comm_Group. Cette classe represente un groupe...">Comm_Group_MPI</a>, group))
<a name="l00191"></a>00191 <span class="preprocessor">#else</span>
<a name="l00192"></a>00192 <span class="preprocessor"></span><span class="comment">// if (!use_all_to_all || !sub_type(Comm_Group_MPI, group))</span>
<a name="l00193"></a>00193 <span class="comment">// on n utilise pas le all_to_all car n&#39;exsite pas sans MPI</span>
<a name="l00194"></a>00194   <span class="keywordflow">if</span> (1)
<a name="l00195"></a>00195 <span class="preprocessor">#endif</span>
<a name="l00196"></a>00196 <span class="preprocessor"></span>    {
<a name="l00197"></a>00197       group.<a class="code" href="classComm__Group.html#a7fb0eaad288afd68e88514f0ab9ee42d">send_recv_start</a>(send_list, send_size, send_buffers,
<a name="l00198"></a>00198                             recv_list, recv_size, recv_buffers);
<a name="l00199"></a>00199       group.<a class="code" href="classComm__Group.html#a68bdde2db96498a1024cd1db4d371bcd">send_recv_finish</a>();
<a name="l00200"></a>00200     }
<a name="l00201"></a>00201   <span class="keywordflow">else</span>
<a name="l00202"></a>00202     {
<a name="l00203"></a>00203 <span class="preprocessor">#ifdef MPI_</span>
<a name="l00204"></a>00204 <span class="preprocessor"></span>      <span class="keyword">const</span> <span class="keywordtype">int</span> n = group.<a class="code" href="classComm__Group.html#a657c34d2d722170d7e052b594e17654c" title="Renvoie le nombre de processeurs dans le groupe *this.">nproc</a>();
<a name="l00205"></a>00205       <span class="keyword">const</span> <span class="keywordtype">int</span> nsend = send_list.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00206"></a>00206       <span class="keyword">const</span> <span class="keywordtype">int</span> nrecv = recv_list.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00207"></a>00207 <span class="comment">// Pack all send data in a single buffer:</span>
<a name="l00208"></a>00208       <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> a_send_size(n);
<a name="l00209"></a>00209       <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> a_send_offset(n);
<a name="l00210"></a>00210       <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> a_recv_size(n);
<a name="l00211"></a>00211       <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> a_recv_offset(n);
<a name="l00212"></a>00212       <span class="keywordtype">int</span> i, offset;
<a name="l00213"></a>00213 <span class="comment">// Compute send_size array</span>
<a name="l00214"></a>00214       <span class="keywordflow">for</span> (i = 0; i &lt; nsend; i++)
<a name="l00215"></a>00215         a_send_size[send_list[i]] = send_size[i];
<a name="l00216"></a>00216 <span class="comment">// Compute send_offset</span>
<a name="l00217"></a>00217       <span class="keywordflow">for</span> (i = 0, offset = 0; i &lt; n; i++)
<a name="l00218"></a>00218         {
<a name="l00219"></a>00219           a_send_offset[i] = offset;
<a name="l00220"></a>00220           offset += a_send_size[i];
<a name="l00221"></a>00221         }
<a name="l00222"></a>00222       <span class="keyword">const</span> <span class="keywordtype">int</span> buf_size_send = offset;
<a name="l00223"></a>00223 <span class="comment">// Compute recv_size array</span>
<a name="l00224"></a>00224       <span class="keywordflow">for</span> (i = 0; i &lt; nrecv; i++)
<a name="l00225"></a>00225         a_recv_size[recv_list[i]] = recv_size[i];
<a name="l00226"></a>00226 <span class="comment">// Compute recv_offset</span>
<a name="l00227"></a>00227       <span class="keywordflow">for</span> (i = 0, offset = 0; i &lt; n; i++)
<a name="l00228"></a>00228         {
<a name="l00229"></a>00229           a_recv_offset[i] = offset;
<a name="l00230"></a>00230           offset += a_recv_size[i];
<a name="l00231"></a>00231         }
<a name="l00232"></a>00232       <span class="keyword">const</span> <span class="keywordtype">int</span> buf_size_recv = offset;
<a name="l00233"></a>00233 <span class="comment">// Allocate contiguous send and recv buffer:</span>
<a name="l00234"></a>00234       <span class="keywordtype">char</span> *send_buffer = (<span class="keywordtype">char</span> *) malloc(buf_size_send);
<a name="l00235"></a>00235       <span class="keywordtype">char</span> *recv_buffer = (<span class="keywordtype">char</span> *) malloc(buf_size_recv);
<a name="l00236"></a>00236 <span class="comment">// Copy send data to send buffer</span>
<a name="l00237"></a>00237       <span class="keywordflow">for</span> (i = 0; i &lt; nsend; i++)
<a name="l00238"></a>00238         memcpy(send_buffer + a_send_offset[send_list[i]], <span class="comment">//!&lt; dest</span>
<a name="l00239"></a>00239 <span class="comment"></span>               send_buffers[i], <span class="comment">//!&lt; source</span>
<a name="l00240"></a>00240 <span class="comment"></span>               send_size[i]); <span class="comment">//!&lt; size Exchange data</span>
<a name="l00241"></a>00241 <span class="comment"></span><span class="comment">//</span>
<a name="l00242"></a>00242       <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classComm__Group__MPI.html" title=": Classe Comm_Group_MPI, derivee de la classe abstraite Comm_Group. Cette classe represente un groupe...">Comm_Group_MPI</a>, group).all_to_allv(send_buffer, a_send_size.<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>(), a_send_offset.<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>(),
<a name="l00243"></a>00243                                                   recv_buffer, a_recv_size.<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>(), a_recv_offset.<a class="code" href="classArrOfInt.html#ad0b31250e60cd9040ea60be55db73c3d" title="Renvoie un pointeur sur le premier element du tableau. Le pointeur est nul si le tableau est &quot;detach...">addr</a>());
<a name="l00244"></a>00244 <span class="comment">// Copy recv data to recv_buffers</span>
<a name="l00245"></a>00245       <span class="keywordflow">for</span> (i = 0; i &lt; nrecv; i++)
<a name="l00246"></a>00246         memcpy(recv_buffers[i], <span class="comment">//!&lt; dest</span>
<a name="l00247"></a>00247 <span class="comment"></span>               recv_buffer + a_recv_offset[recv_list[i]], <span class="comment">//!&lt; source</span>
<a name="l00248"></a>00248 <span class="comment"></span>               recv_size[i]); <span class="comment">//!&lt; size [ABN] arrruhhhhhmmmmmm:</span>
<a name="l00249"></a>00249 <span class="comment"></span><span class="comment">//</span>
<a name="l00250"></a>00250       free(send_buffer);
<a name="l00251"></a>00251       free(recv_buffer);
<a name="l00252"></a>00252 <span class="preprocessor">#endif</span>
<a name="l00253"></a>00253 <span class="preprocessor"></span>    }
<a name="l00254"></a>00254 }
<a name="l00255"></a>00255 
<a name="l00256"></a>00256 <span class="comment">//</span>
<a name="l00257"></a>00257 <span class="comment">//</span>
<a name="l00258"></a>00258 <span class="comment">//</span>
<a name="l00259"></a>00259 <span class="comment">//</span><span class="comment"></span>
<a name="l00260"></a>00260 <span class="comment">//! Transmet la taille des messages a envoyer aux processeurs qui&lt;br&gt;vont les recevoir. La taille est le nombre de bytes des obuffers.&lt;br&gt;send_pe_list et recv_pe_list doivent etre initialises.&lt;br&gt;Le schema doit etre dans l&#39;etat WRITING.</span>
<a name="l00261"></a><a class="code" href="classSchema__Comm.html#a7988e23c0989bfa8a3980f16b591e41d">00261</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classSchema__Comm.html#a7988e23c0989bfa8a3980f16b591e41d" title="Transmet la taille des messages a envoyer aux processeurs qui vont les recevoir. La taille est le nom...">Schema_Comm::echange_taille</a>(<span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; send_size,
<a name="l00262"></a>00262                                  <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; recv_size)<span class="keyword"> const</span>
<a name="l00263"></a>00263 <span class="keyword"></span>{
<a name="l00264"></a>00264   <span class="keyword">static</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> send_sz;
<a name="l00265"></a>00265   <span class="keyword">static</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> recv_sz;
<a name="l00266"></a>00266   send_sz.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00267"></a>00267   recv_sz.<a class="code" href="classArrOfInt.html#a22d744bcd452d039580d1d9186f02b4e" title="Change le mode l&#39;allocation memoire: reallocation d&#39;un tableau a chaque changement de taille (flag = ...">set_smart_resize</a>(1);
<a name="l00268"></a>00268 
<a name="l00269"></a>00269   assert(<a class="code" href="classSchema__Comm.html#ae56acaadf7a079ce874be628491593cb">status_</a> == <a class="code" href="classSchema__Comm.html#a513eef36a4603d995f2a04f166812470a218bae4e3cf445666fb4c8d08d055f0d">WRITING</a> &amp;&amp; <a class="code" href="classSchema__Comm.html#adcd2cdb2d6ce76883858c8f6078fda56" title="Groupe de processeurs qui vont discuter.">ref_group_</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>());
<a name="l00270"></a>00270   <span class="keyword">const</span> <a class="code" href="classComm__Group.html" title=": Cette classe decrit un groupe de processeurs sur lesquels une portion de code s&#39;execute simultaneme...">Comm_Group</a>&amp; group = <a class="code" href="classSchema__Comm.html#adcd2cdb2d6ce76883858c8f6078fda56" title="Groupe de processeurs qui vont discuter.">ref_group_</a>.<a class="code" href="classRef__Comm__Group.html#a46f3361cb566b4a386f75f7f9570fe9a">valeur</a>();
<a name="l00271"></a>00271   assert(&amp;group == &amp;<a class="code" href="classPE__Groups.html#ae6ca0277a58f2ab34ebfb3216578fa75" title="renvoie une reference au groupe de processeurs actif courant">PE_Groups::current_group</a>());
<a name="l00272"></a>00272 
<a name="l00273"></a>00273 <span class="comment">// On verifie que tous les membres du groupe executent ceci.</span>
<a name="l00274"></a>00274 <span class="comment">// Si ca plante ici, c&#39;est que tous les membres declares ne sont</span>
<a name="l00275"></a>00275 <span class="comment">// pas en train de faire la barriere.</span>
<a name="l00276"></a>00276   <span class="keywordflow">if</span> (group.check_enabled()) group.barrier(<a class="code" href="Schema__Comm_8cpp.html#a4c41ba0edefa0cda76d623d2bee6099d">ECHANGE_MESSAGES_COMM_TAG</a>);
<a name="l00277"></a>00277 
<a name="l00278"></a>00278   <span class="keyword">const</span> <span class="keywordtype">int</span> n_send = <a class="code" href="classSchema__Comm.html#a93eb7538476fa54ade96e88294feec8e" title="Liste des processeurs a qui envoyer.">send_pe_list_</a>.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00279"></a>00279   <span class="keyword">const</span> <span class="keywordtype">int</span> n_recv = <a class="code" href="classSchema__Comm.html#a24918eceb0ce15a6dae5a5a833480246" title="Liste des processeurs de qui recevoir.">recv_pe_list_</a>.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00280"></a>00280 
<a name="l00281"></a>00281   recv_size.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(n_recv);
<a name="l00282"></a>00282 
<a name="l00283"></a>00283   <span class="keyword">const</span> <span class="keywordtype">char</span> ** send_buffers = <span class="keyword">new</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* [n_send];
<a name="l00284"></a>00284   <span class="keywordtype">char</span> ** recv_buffers = <span class="keyword">new</span> <span class="keywordtype">char</span>* [n_recv];
<a name="l00285"></a>00285 
<a name="l00286"></a>00286   send_sz.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(n_send);   <span class="comment">//!&lt; Taille d&#39;un int (on echange une taille)</span>
<a name="l00287"></a>00287 <span class="comment"></span>  send_sz = <span class="keyword">sizeof</span>(int);
<a name="l00288"></a>00288   <span class="keywordtype">int</span> i;
<a name="l00289"></a>00289   <span class="keywordflow">for</span> (i = 0; i &lt; n_send; i++)
<a name="l00290"></a>00290     send_buffers[i] = (<span class="keywordtype">char</span>*) (&amp; send_size[i]);
<a name="l00291"></a>00291 
<a name="l00292"></a>00292   recv_sz.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(n_recv);
<a name="l00293"></a>00293   recv_sz = <span class="keyword">sizeof</span>(int);
<a name="l00294"></a>00294   recv_size.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(n_recv);
<a name="l00295"></a>00295   <span class="keywordflow">for</span> (i = 0; i &lt; n_recv; i++)
<a name="l00296"></a>00296     recv_buffers[i] = (<span class="keywordtype">char</span>*) (&amp; recv_size[i]);
<a name="l00297"></a>00297 
<a name="l00298"></a>00298   <a class="code" href="Schema__Comm_8cpp.html#a269962dc3d54d1d174a7936f5fe41d72">exchange_data</a>(<a class="code" href="classSchema__Comm.html#a93eb7538476fa54ade96e88294feec8e" title="Liste des processeurs a qui envoyer.">send_pe_list_</a>, send_sz, send_buffers,
<a name="l00299"></a>00299                 <a class="code" href="classSchema__Comm.html#a24918eceb0ce15a6dae5a5a833480246" title="Liste des processeurs de qui recevoir.">recv_pe_list_</a>, recv_sz, recv_buffers,
<a name="l00300"></a>00300                 group,
<a name="l00301"></a>00301                 <a class="code" href="classSchema__Comm.html#a88ddb051931c6d62f96d57ca2f79f7c1" title="Drapeau, quel type de communication faut-il utiliser ?">use_all_to_allv_</a>);
<a name="l00302"></a>00302 
<a name="l00303"></a>00303   <span class="keyword">delete</span>[] recv_buffers;
<a name="l00304"></a>00304   <span class="keyword">delete</span>[] send_buffers;
<a name="l00305"></a>00305 }
<a name="l00306"></a>00306 
<a name="l00307"></a>00307 <span class="comment">//</span>
<a name="l00308"></a>00308 <span class="comment">//</span>
<a name="l00309"></a>00309 <span class="comment">//</span><span class="comment"></span>
<a name="l00310"></a>00310 <span class="comment">//! Cette methode lance l&#39;echange de donnees entre tous les processeurs.&lt;br&gt;La taille des messages recus doit etre deja connue.&lt;br&gt;Le schema passe de WRITING a EXCHANGED.</span>
<a name="l00311"></a><a class="code" href="classSchema__Comm.html#a6d7e026c5aa0af7f994aecf9d40d4079">00311</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classSchema__Comm.html#ae33a0b666e564e5f9996e2e39ebba7e1" title="Statut passe a EXCHANGED Autorise si status_ == EXCHANGED:">Schema_Comm::echange_messages</a>(<span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; send_size,
<a name="l00312"></a>00312                                    <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; recv_size)<span class="keyword"> const</span>
<a name="l00313"></a>00313 <span class="keyword"></span>{
<a name="l00314"></a>00314   assert(<a class="code" href="classSchema__Comm.html#ae56acaadf7a079ce874be628491593cb">status_</a> == <a class="code" href="classSchema__Comm.html#a513eef36a4603d995f2a04f166812470a218bae4e3cf445666fb4c8d08d055f0d">WRITING</a> &amp;&amp; <a class="code" href="classSchema__Comm.html#adcd2cdb2d6ce76883858c8f6078fda56" title="Groupe de processeurs qui vont discuter.">ref_group_</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>());
<a name="l00315"></a>00315   <span class="keyword">const</span> <a class="code" href="classComm__Group.html" title=": Cette classe decrit un groupe de processeurs sur lesquels une portion de code s&#39;execute simultaneme...">Comm_Group</a>&amp; group = <a class="code" href="classSchema__Comm.html#adcd2cdb2d6ce76883858c8f6078fda56" title="Groupe de processeurs qui vont discuter.">ref_group_</a>.<a class="code" href="classRef__Comm__Group.html#a46f3361cb566b4a386f75f7f9570fe9a">valeur</a>();
<a name="l00316"></a>00316   assert(&amp;group == &amp;<a class="code" href="classPE__Groups.html#ae6ca0277a58f2ab34ebfb3216578fa75" title="renvoie une reference au groupe de processeurs actif courant">PE_Groups::current_group</a>());
<a name="l00317"></a>00317 
<a name="l00318"></a>00318 <span class="comment">// On verifie que tous les membres du groupe executent ceci.</span>
<a name="l00319"></a>00319 <span class="comment">// Si ca plante ici, c&#39;est que tous les membres declares ne sont</span>
<a name="l00320"></a>00320 <span class="comment">// pas en train de faire la barriere.</span>
<a name="l00321"></a>00321   <span class="keywordflow">if</span> (group.check_enabled()) group.barrier(<a class="code" href="Schema__Comm_8cpp.html#a4c41ba0edefa0cda76d623d2bee6099d">ECHANGE_MESSAGES_COMM_TAG</a>);
<a name="l00322"></a>00322 
<a name="l00323"></a>00323   <span class="keyword">const</span> <span class="keywordtype">int</span> n_send = <a class="code" href="classSchema__Comm.html#a93eb7538476fa54ade96e88294feec8e" title="Liste des processeurs a qui envoyer.">send_pe_list_</a>.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00324"></a>00324   <span class="keyword">const</span> <span class="keywordtype">int</span> n_recv = <a class="code" href="classSchema__Comm.html#a24918eceb0ce15a6dae5a5a833480246" title="Liste des processeurs de qui recevoir.">recv_pe_list_</a>.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00325"></a>00325   <span class="keyword">const</span> <span class="keywordtype">char</span> ** send_buffers = <span class="keyword">new</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* [n_send];
<a name="l00326"></a>00326   <span class="keywordtype">char</span> ** recv_buffers = <span class="keyword">new</span> <span class="keywordtype">char</span>* [n_recv];
<a name="l00327"></a>00327 
<a name="l00328"></a>00328   <span class="keywordtype">int</span> i;
<a name="l00329"></a>00329   <span class="keywordflow">for</span> (i = 0; i &lt; n_recv; i++)
<a name="l00330"></a>00330     {
<a name="l00331"></a>00331       <span class="keywordtype">int</span> pe = <a class="code" href="classSchema__Comm.html#a24918eceb0ce15a6dae5a5a833480246" title="Liste des processeurs de qui recevoir.">recv_pe_list_</a>[i];
<a name="l00332"></a>00332       <span class="keywordtype">int</span> size = recv_size[i];
<a name="l00333"></a>00333       <a class="code" href="classInputCommBuffer.html" title=": Classe outil utilisee exclusivement par Schema_Comm. C&#39;est une classe derivee de Entree dont le str...">InputCommBuffer</a>&amp; <a class="code" href="arch_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a> = <a class="code" href="classSchema__Comm.html#a0955c141014893e559b831ae33d55d56" title="Accesseur a un membre du tableau ebuffers_ (avec verification)">ebuffer</a>(pe);
<a name="l00334"></a>00334       recv_buffers[i] = buf.<a class="code" href="classInputCommBuffer.html#a1ea808033309fd6c3def0db5ac439fa4">reserve_buffer</a>(size);
<a name="l00335"></a>00335     }
<a name="l00336"></a>00336   <span class="keywordflow">for</span> (i = 0; i &lt; n_send; i++)
<a name="l00337"></a>00337     {
<a name="l00338"></a>00338       <span class="keywordtype">int</span> pe = <a class="code" href="classSchema__Comm.html#a93eb7538476fa54ade96e88294feec8e" title="Liste des processeurs a qui envoyer.">send_pe_list_</a>[i];
<a name="l00339"></a>00339       <a class="code" href="classOutputCommBuffer.html" title=": Classe outil utilisee exclusivement par Schema_Comm. C&#39;est une classe derivee de Entree dont le str...">OutputCommBuffer</a>&amp; <a class="code" href="arch_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a> = <a class="code" href="classSchema__Comm.html#a734080d1326e58abdc5731d1b3486d4b" title="Accesseur a un membre du tableau obuffers_ (avec verification)">obuffer</a>(pe);
<a name="l00340"></a>00340 <span class="comment">// On verifie que la taille des messages en emission est la meme que</span>
<a name="l00341"></a>00341 <span class="comment">// celle enregistree dans send_size_, ce qui garantit que la taille</span>
<a name="l00342"></a>00342 <span class="comment">// en reception est juste elle-aussi.</span>
<a name="l00343"></a>00343       assert(send_size[i] == buf.<a class="code" href="classOutputCommBuffer.html#a3dd24532686e8a731b2809b0049c7a4c">get_buffer_size</a>());
<a name="l00344"></a>00344       send_buffers[i] = buf.<a class="code" href="classOutputCommBuffer.html#ad4526ebfe5863c4009c858d59576c638">get_buffer</a>();
<a name="l00345"></a>00345     }
<a name="l00346"></a>00346 
<a name="l00347"></a>00347   <a class="code" href="Schema__Comm_8cpp.html#a269962dc3d54d1d174a7936f5fe41d72">exchange_data</a>(<a class="code" href="classSchema__Comm.html#a93eb7538476fa54ade96e88294feec8e" title="Liste des processeurs a qui envoyer.">send_pe_list_</a>, send_size, send_buffers,
<a name="l00348"></a>00348                 <a class="code" href="classSchema__Comm.html#a24918eceb0ce15a6dae5a5a833480246" title="Liste des processeurs de qui recevoir.">recv_pe_list_</a>, recv_size, recv_buffers,
<a name="l00349"></a>00349                 group,
<a name="l00350"></a>00350                 <a class="code" href="classSchema__Comm.html#a88ddb051931c6d62f96d57ca2f79f7c1" title="Drapeau, quel type de communication faut-il utiliser ?">use_all_to_allv_</a>);
<a name="l00351"></a>00351 
<a name="l00352"></a>00352   <span class="keyword">delete</span>[] recv_buffers;
<a name="l00353"></a>00353   <span class="keyword">delete</span>[] send_buffers;
<a name="l00354"></a>00354 
<a name="l00355"></a>00355 <span class="comment">// Creation des input streams a partir des buffers recus</span>
<a name="l00356"></a>00356   <span class="keywordflow">for</span> (i = 0; i &lt; n_recv; i++)
<a name="l00357"></a>00357     {
<a name="l00358"></a>00358       <span class="keywordtype">int</span> pe = <a class="code" href="classSchema__Comm.html#a24918eceb0ce15a6dae5a5a833480246" title="Liste des processeurs de qui recevoir.">recv_pe_list_</a>[i];
<a name="l00359"></a>00359       <a class="code" href="classInputCommBuffer.html" title=": Classe outil utilisee exclusivement par Schema_Comm. C&#39;est une classe derivee de Entree dont le str...">InputCommBuffer</a>&amp; <a class="code" href="arch_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a> = <a class="code" href="classSchema__Comm.html#a0955c141014893e559b831ae33d55d56" title="Accesseur a un membre du tableau ebuffers_ (avec verification)">ebuffer</a>(pe);
<a name="l00360"></a>00360       buf.<a class="code" href="classInputCommBuffer.html#a3a272bcedfa78423e2fb29084334000a">create_stream</a>();
<a name="l00361"></a>00361     }
<a name="l00362"></a>00362 
<a name="l00363"></a>00363 <span class="comment">// Cas particulier des messages envoyes a moi-meme:</span>
<a name="l00364"></a>00364   <span class="keywordflow">if</span> (<a class="code" href="classSchema__Comm.html#aaa55ab78220cfcca058cf54a7ac14cc0" title="Drapeau: est-ce qu&#39;on autorise a s&#39;envoyer des messages a soi ?">me_to_me_</a>)
<a name="l00365"></a>00365     {
<a name="l00366"></a>00366       <span class="keywordtype">int</span> pe = <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>();
<a name="l00367"></a>00367       <a class="code" href="classInputCommBuffer.html" title=": Classe outil utilisee exclusivement par Schema_Comm. C&#39;est une classe derivee de Entree dont le str...">InputCommBuffer</a>&amp; <a class="code" href="arch_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a> = <a class="code" href="classSchema__Comm.html#a0955c141014893e559b831ae33d55d56" title="Accesseur a un membre du tableau ebuffers_ (avec verification)">ebuffer</a>(pe);
<a name="l00368"></a>00368       <a class="code" href="classOutputCommBuffer.html" title=": Classe outil utilisee exclusivement par Schema_Comm. C&#39;est une classe derivee de Entree dont le str...">OutputCommBuffer</a>&amp; obuf = <a class="code" href="classSchema__Comm.html#a734080d1326e58abdc5731d1b3486d4b" title="Accesseur a un membre du tableau obuffers_ (avec verification)">obuffer</a>(pe);
<a name="l00369"></a>00369       buf.<a class="code" href="classInputCommBuffer.html#af6a33480102d6d23f694da538798afd3">create_stream_from_output_stream</a>(obuf);
<a name="l00370"></a>00370     }
<a name="l00371"></a>00371 
<a name="l00372"></a>00372   <a class="code" href="classSchema__Comm.html#ae56acaadf7a079ce874be628491593cb">status_</a> = <a class="code" href="classSchema__Comm.html#a513eef36a4603d995f2a04f166812470a40b4132b151da7359211aad2f3682c9f">EXCHANGED</a>;
<a name="l00373"></a>00373 }
<a name="l00374"></a>00374 
<a name="l00375"></a>00375 <span class="comment">//</span>
<a name="l00376"></a>00376 <span class="comment">//</span>
<a name="l00377"></a>00377 <span class="comment">//</span>
<a name="l00378"></a>00378 <span class="comment">//</span><span class="comment"></span>
<a name="l00379"></a>00379 <span class="comment">//! Cette methode lance l&#39;echange de donnees entre tous les processeurs.&lt;br&gt;La taille des messages recus n&#39;a pas besoin d&#39;etre connue a priori,&lt;br&gt;on la transmet.&lt;br&gt;Le schema passe de WRITING a EXCHANGED.</span>
<a name="l00380"></a><a class="code" href="classSchema__Comm.html#abca0e8ac6c2b742d26f3cfaee0690c72">00380</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classSchema__Comm.html#abca0e8ac6c2b742d26f3cfaee0690c72" title="Statut passe a EXCHANGED.">Schema_Comm::echange_taille_et_messages</a>()<span class="keyword"> const</span>
<a name="l00381"></a>00381 <span class="keyword"></span>{
<a name="l00382"></a>00382   <span class="keyword">static</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> send_size;
<a name="l00383"></a>00383   <span class="keyword">static</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> recv_size;
<a name="l00384"></a>00384   <span class="keyword">const</span> <span class="keywordtype">int</span> n_send = <a class="code" href="classSchema__Comm.html#a93eb7538476fa54ade96e88294feec8e" title="Liste des processeurs a qui envoyer.">send_pe_list_</a>.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00385"></a>00385   send_size.<a class="code" href="classArrOfInt.html#a9b3afbb46b16870dbd36236c8935b535">resize_array</a>(n_send);
<a name="l00386"></a>00386   <span class="keywordtype">int</span> i;
<a name="l00387"></a>00387   <span class="keywordflow">for</span> (i = 0; i &lt; n_send; i++)
<a name="l00388"></a>00388     {
<a name="l00389"></a>00389       <span class="keywordtype">int</span> pe = <a class="code" href="classSchema__Comm.html#a93eb7538476fa54ade96e88294feec8e" title="Liste des processeurs a qui envoyer.">send_pe_list_</a>[i];
<a name="l00390"></a>00390       send_size[i] = <a class="code" href="classSchema__Comm.html#a734080d1326e58abdc5731d1b3486d4b" title="Accesseur a un membre du tableau obuffers_ (avec verification)">obuffer</a>(pe).<a class="code" href="classOutputCommBuffer.html#a3dd24532686e8a731b2809b0049c7a4c">get_buffer_size</a>();
<a name="l00391"></a>00391     }
<a name="l00392"></a>00392 
<a name="l00393"></a>00393 <span class="comment">// Methode non optimale: en MPI on pourrait utiliser MPI_Probe mais</span>
<a name="l00394"></a>00394 <span class="comment">// cette methode me parait peu sure.</span>
<a name="l00395"></a>00395   <a class="code" href="classSchema__Comm.html#a7988e23c0989bfa8a3980f16b591e41d" title="Transmet la taille des messages a envoyer aux processeurs qui vont les recevoir. La taille est le nom...">echange_taille</a>(send_size, recv_size);
<a name="l00396"></a>00396   <a class="code" href="classSchema__Comm.html#ae33a0b666e564e5f9996e2e39ebba7e1" title="Statut passe a EXCHANGED Autorise si status_ == EXCHANGED:">echange_messages</a>(send_size, recv_size);
<a name="l00397"></a>00397 }
<a name="l00398"></a>00398 
<a name="l00399"></a>00399 <span class="comment">//</span>
<a name="l00400"></a>00400 <span class="comment">//</span>
<a name="l00401"></a>00401 <span class="comment">//</span><span class="comment"></span>
<a name="l00402"></a>00402 <span class="comment">//! Cette methode lance l&#39;echange de donnees. On fournit la taille en octets&lt;br&gt;des messages recus dans recv_size (tableau de la meme taille que recv_pe_list)&lt;br&gt;En mode check_enabled, on verifie que la taille est correcte</span>
<a name="l00403"></a><a class="code" href="classSchema__Comm.html#ae33a0b666e564e5f9996e2e39ebba7e1">00403</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classSchema__Comm.html#ae33a0b666e564e5f9996e2e39ebba7e1" title="Statut passe a EXCHANGED Autorise si status_ == EXCHANGED:">Schema_Comm::echange_messages</a>(<span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; recv_size)<span class="keyword"> const</span>
<a name="l00404"></a>00404 <span class="keyword"></span>{
<a name="l00405"></a>00405   <span class="keyword">const</span> <span class="keywordtype">int</span> n_send = <a class="code" href="classSchema__Comm.html#a93eb7538476fa54ade96e88294feec8e" title="Liste des processeurs a qui envoyer.">send_pe_list_</a>.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00406"></a>00406   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> send_size(n_send);
<a name="l00407"></a>00407   <span class="keywordtype">int</span> i;
<a name="l00408"></a>00408   <span class="keywordflow">for</span> (i = 0; i &lt; n_send; i++)
<a name="l00409"></a>00409     {
<a name="l00410"></a>00410       <span class="keywordtype">int</span> pe = <a class="code" href="classSchema__Comm.html#a93eb7538476fa54ade96e88294feec8e" title="Liste des processeurs a qui envoyer.">send_pe_list_</a>[i];
<a name="l00411"></a>00411       send_size[i] = <a class="code" href="classSchema__Comm.html#a734080d1326e58abdc5731d1b3486d4b" title="Accesseur a un membre du tableau obuffers_ (avec verification)">obuffer</a>(pe).<a class="code" href="classOutputCommBuffer.html#a3dd24532686e8a731b2809b0049c7a4c">get_buffer_size</a>();
<a name="l00412"></a>00412     }
<a name="l00413"></a>00413   <span class="keywordflow">if</span> (<a class="code" href="classPE__Groups.html#ae6ca0277a58f2ab34ebfb3216578fa75" title="renvoie une reference au groupe de processeurs actif courant">PE_Groups::current_group</a>().check_enabled())
<a name="l00414"></a>00414     {
<a name="l00415"></a>00415       <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> check_recv_size;
<a name="l00416"></a>00416       <a class="code" href="classSchema__Comm.html#a7988e23c0989bfa8a3980f16b591e41d" title="Transmet la taille des messages a envoyer aux processeurs qui vont les recevoir. La taille est le nom...">echange_taille</a>(send_size, check_recv_size);
<a name="l00417"></a>00417       <span class="keywordflow">if</span> (!(check_recv_size == recv_size))
<a name="l00418"></a>00418         {
<a name="l00419"></a>00419           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Schema_Comm::echange_messages : bad recv_size&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00420"></a>00420           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00421"></a>00421         }
<a name="l00422"></a>00422     }
<a name="l00423"></a>00423   <a class="code" href="classSchema__Comm.html#ae33a0b666e564e5f9996e2e39ebba7e1" title="Statut passe a EXCHANGED Autorise si status_ == EXCHANGED:">echange_messages</a>(send_size, recv_size);
<a name="l00424"></a>00424 }
<a name="l00425"></a>00425 
<a name="l00426"></a>00426 <span class="comment">//</span>
<a name="l00427"></a>00427 <span class="comment">//</span>
<a name="l00428"></a>00428 <span class="comment">//</span><span class="comment"></span>
<a name="l00429"></a>00429 <span class="comment">//! Vide les buffers et libere les ressources: on&lt;br&gt;a fini de lire les donnees recues dans les buffers.&lt;br&gt;Le schema passe de EXCHANGED a RESET</span>
<a name="l00430"></a><a class="code" href="classSchema__Comm.html#a73a981f88b6ffebc150fb46c5cce75d9">00430</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classSchema__Comm.html#a73a981f88b6ffebc150fb46c5cce75d9" title="Statut passe a RESET Accesseurs:">Schema_Comm::end_comm</a>()<span class="keyword"> const</span>
<a name="l00431"></a>00431 <span class="keyword"></span>{
<a name="l00432"></a>00432   assert(<a class="code" href="classSchema__Comm.html#ae56acaadf7a079ce874be628491593cb">status_</a> == <a class="code" href="classSchema__Comm.html#a513eef36a4603d995f2a04f166812470a40b4132b151da7359211aad2f3682c9f">EXCHANGED</a> &amp;&amp; <a class="code" href="classSchema__Comm.html#adcd2cdb2d6ce76883858c8f6078fda56" title="Groupe de processeurs qui vont discuter.">ref_group_</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>());
<a name="l00433"></a>00433   <span class="keyword">const</span> <a class="code" href="classComm__Group.html" title=": Cette classe decrit un groupe de processeurs sur lesquels une portion de code s&#39;execute simultaneme...">Comm_Group</a>&amp; group = <a class="code" href="classSchema__Comm.html#adcd2cdb2d6ce76883858c8f6078fda56" title="Groupe de processeurs qui vont discuter.">ref_group_</a>.<a class="code" href="classRef__Comm__Group.html#a46f3361cb566b4a386f75f7f9570fe9a">valeur</a>();
<a name="l00434"></a>00434   assert(&amp;group == &amp;<a class="code" href="classPE__Groups.html#ae6ca0277a58f2ab34ebfb3216578fa75" title="renvoie une reference au groupe de processeurs actif courant">PE_Groups::current_group</a>());
<a name="l00435"></a>00435 
<a name="l00436"></a>00436 <span class="comment">// On verifie que tous les membres du groupe executent ceci.</span>
<a name="l00437"></a>00437 <span class="comment">// Si ca plante ici, c&#39;est que tous les membres declares ne sont</span>
<a name="l00438"></a>00438 <span class="comment">// pas en train de faire la barriere.</span>
<a name="l00439"></a>00439   <span class="keywordflow">if</span> (group.check_enabled()) group.barrier(<a class="code" href="Schema__Comm_8cpp.html#aad8b15298bcd90d51ca68c28f25a4fbf">END_COMM_TAG</a>);
<a name="l00440"></a>00440 
<a name="l00441"></a>00441   <span class="keywordtype">int</span> i, n;
<a name="l00442"></a>00442   n = <a class="code" href="classSchema__Comm.html#a93eb7538476fa54ade96e88294feec8e" title="Liste des processeurs a qui envoyer.">send_pe_list_</a>.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00443"></a>00443   <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)
<a name="l00444"></a>00444     {
<a name="l00445"></a>00445       <span class="keywordtype">int</span> pe = <a class="code" href="classSchema__Comm.html#a93eb7538476fa54ade96e88294feec8e" title="Liste des processeurs a qui envoyer.">send_pe_list_</a>[i];
<a name="l00446"></a>00446       <a class="code" href="classSchema__Comm.html#a734080d1326e58abdc5731d1b3486d4b" title="Accesseur a un membre du tableau obuffers_ (avec verification)">obuffer</a>(pe).<a class="code" href="classOutputCommBuffer.html#a4a00e5a4325c667529c26a227ec269e7">clear</a>();
<a name="l00447"></a>00447     }
<a name="l00448"></a>00448   n = <a class="code" href="classSchema__Comm.html#a24918eceb0ce15a6dae5a5a833480246" title="Liste des processeurs de qui recevoir.">recv_pe_list_</a>.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00449"></a>00449   <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)
<a name="l00450"></a>00450     {
<a name="l00451"></a>00451       <span class="keywordtype">int</span> pe = <a class="code" href="classSchema__Comm.html#a24918eceb0ce15a6dae5a5a833480246" title="Liste des processeurs de qui recevoir.">recv_pe_list_</a>[i];
<a name="l00452"></a>00452       <a class="code" href="classSchema__Comm.html#a0955c141014893e559b831ae33d55d56" title="Accesseur a un membre du tableau ebuffers_ (avec verification)">ebuffer</a>(pe).<a class="code" href="classInputCommBuffer.html#a4df9114080cacee52c46a14ad052509a">clear</a>();
<a name="l00453"></a>00453     }
<a name="l00454"></a>00454 
<a name="l00455"></a>00455   <span class="keywordflow">if</span> (<a class="code" href="classSchema__Comm.html#aaa55ab78220cfcca058cf54a7ac14cc0" title="Drapeau: est-ce qu&#39;on autorise a s&#39;envoyer des messages a soi ?">me_to_me_</a>)
<a name="l00456"></a>00456     {
<a name="l00457"></a>00457       <span class="keywordtype">int</span> pe = <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>();
<a name="l00458"></a>00458       <a class="code" href="classSchema__Comm.html#a734080d1326e58abdc5731d1b3486d4b" title="Accesseur a un membre du tableau obuffers_ (avec verification)">obuffer</a>(pe).<a class="code" href="classOutputCommBuffer.html#a4a00e5a4325c667529c26a227ec269e7">clear</a>();
<a name="l00459"></a>00459       <a class="code" href="classSchema__Comm.html#a0955c141014893e559b831ae33d55d56" title="Accesseur a un membre du tableau ebuffers_ (avec verification)">ebuffer</a>(pe).<a class="code" href="classInputCommBuffer.html#a4df9114080cacee52c46a14ad052509a">clear</a>();
<a name="l00460"></a>00460     }
<a name="l00461"></a>00461 
<a name="l00462"></a>00462   <a class="code" href="classSchema__Comm.html#ae56acaadf7a079ce874be628491593cb">status_</a> = <a class="code" href="classSchema__Comm.html#a513eef36a4603d995f2a04f166812470a79ffb1835b68257288b75f8fbcb65178">RESET</a>;
<a name="l00463"></a>00463 }
<a name="l00464"></a>00464 
<a name="l00465"></a>00465 <span class="preprocessor">#ifndef NDEBUG</span>
<a name="l00466"></a><a class="code" href="Schema__Comm_8cpp.html#a7014965a679ba90a3e95e5ef0f66f002">00466</a> <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="Schema__Comm_8cpp.html#a7014965a679ba90a3e95e5ef0f66f002">check_PE_in_list</a>(<span class="keywordtype">int</span> num_pe, <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; list)
<a name="l00467"></a>00467 {
<a name="l00468"></a>00468   <span class="keywordtype">int</span> i;
<a name="l00469"></a>00469   <span class="keywordtype">int</span> n = list.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00470"></a>00470   <span class="keywordflow">for</span> (i = 0; i &lt; n &amp;&amp; list[i] != num_pe; i++);
<a name="l00471"></a>00471   <span class="keywordflow">return</span> (i &lt; n);
<a name="l00472"></a>00472 }
<a name="l00473"></a>00473 <span class="preprocessor">#endif</span>
<a name="l00474"></a>00474 <span class="preprocessor"></span>
<a name="l00475"></a>00475 <span class="comment">//</span><span class="comment"></span>
<a name="l00476"></a>00476 <span class="comment">//! renvoie le buffer correspondant au processeur num_PE pour&lt;br&gt;y entasser des donnees a envoyer. Le schema doit etre dans l&#39;etat WRITING.</span>
<a name="l00477"></a><a class="code" href="classSchema__Comm.html#a6c771eae3b46250ae0d2f0126a7d8065">00477</a> <span class="comment"></span><a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classSchema__Comm.html#a6c771eae3b46250ae0d2f0126a7d8065" title="renvoie le buffer correspondant au processeur num_PE pour y entasser des donnees a envoyer...">Schema_Comm::send_buffer</a>(<span class="keywordtype">int</span> num_PE)<span class="keyword"> const</span>
<a name="l00478"></a>00478 <span class="keyword"></span>{
<a name="l00479"></a>00479 <span class="comment">// Si l&#39;assert suivant plante, c&#39;est qu&#39;on essaie de</span>
<a name="l00480"></a>00480 <span class="comment">// mettre des donnees dans le buffer en dehors du bloc</span>
<a name="l00481"></a>00481 <span class="comment">// begin_comm();</span>
<a name="l00482"></a>00482 <span class="comment">// ...</span><span class="comment"></span>
<a name="l00483"></a>00483 <span class="comment">  ///!&lt;  echange_xxx();</span>
<a name="l00484"></a>00484 <span class="comment"></span>  assert(<a class="code" href="classSchema__Comm.html#ae56acaadf7a079ce874be628491593cb">status_</a> == <a class="code" href="classSchema__Comm.html#a513eef36a4603d995f2a04f166812470a218bae4e3cf445666fb4c8d08d055f0d">WRITING</a> &amp;&amp; <a class="code" href="classSchema__Comm.html#adcd2cdb2d6ce76883858c8f6078fda56" title="Groupe de processeurs qui vont discuter.">ref_group_</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>());
<a name="l00485"></a>00485 
<a name="l00486"></a>00486 <span class="comment">// On verifie que le PE demande est bien dans la liste</span>
<a name="l00487"></a>00487 <span class="comment">// des PEs declares en envoi.</span>
<a name="l00488"></a>00488   assert((<a class="code" href="classSchema__Comm.html#aaa55ab78220cfcca058cf54a7ac14cc0" title="Drapeau: est-ce qu&#39;on autorise a s&#39;envoyer des messages a soi ?">me_to_me_</a>&amp;&amp;num_PE==<a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>()) || <a class="code" href="Schema__Comm_8cpp.html#a7014965a679ba90a3e95e5ef0f66f002">check_PE_in_list</a>(num_PE, <a class="code" href="classSchema__Comm.html#a93eb7538476fa54ade96e88294feec8e" title="Liste des processeurs a qui envoyer.">send_pe_list_</a>));
<a name="l00489"></a>00489   <span class="keywordflow">return</span> <a class="code" href="classSchema__Comm.html#a734080d1326e58abdc5731d1b3486d4b" title="Accesseur a un membre du tableau obuffers_ (avec verification)">obuffer</a>(num_PE);
<a name="l00490"></a>00490 }
<a name="l00491"></a>00491 
<a name="l00492"></a>00492 <span class="comment">//</span><span class="comment"></span>
<a name="l00493"></a>00493 <span class="comment">//! renvoie le buffer correspondant au processeur num_PE pour&lt;br&gt;y lire les donnees recues. Le schema doit etre dans l&#39;etat EXCHANGED.</span>
<a name="l00494"></a><a class="code" href="classSchema__Comm.html#a0c056eb81ab8fd513912b336b4d13a1a">00494</a> <span class="comment"></span><a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classSchema__Comm.html#a0c056eb81ab8fd513912b336b4d13a1a" title="renvoie le buffer correspondant au processeur num_PE pour y lire les donnees recues. Le schema doit etre dans l&#39;etat EXCHANGED.">Schema_Comm::recv_buffer</a>(<span class="keywordtype">int</span> num_PE)<span class="keyword"> const</span>
<a name="l00495"></a>00495 <span class="keyword"></span>{
<a name="l00496"></a>00496 <span class="comment">// Si l&#39;assert suivant plante, c&#39;est qu&#39;on essaie de</span>
<a name="l00497"></a>00497 <span class="comment">// lire des donnees dans les buffers en dehors du bloc</span>
<a name="l00498"></a>00498 <span class="comment">// echange_xxx();</span>
<a name="l00499"></a>00499 <span class="comment">// ...</span>
<a name="l00500"></a>00500 <span class="comment">// end_comm();</span>
<a name="l00501"></a>00501   assert(<a class="code" href="classSchema__Comm.html#ae56acaadf7a079ce874be628491593cb">status_</a> == <a class="code" href="classSchema__Comm.html#a513eef36a4603d995f2a04f166812470a40b4132b151da7359211aad2f3682c9f">EXCHANGED</a> &amp;&amp; <a class="code" href="classSchema__Comm.html#adcd2cdb2d6ce76883858c8f6078fda56" title="Groupe de processeurs qui vont discuter.">ref_group_</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>());
<a name="l00502"></a>00502 <span class="comment">// On verifie que le PE demande est bien dans la liste</span>
<a name="l00503"></a>00503 <span class="comment">// des PEs declares en reception.</span>
<a name="l00504"></a>00504   assert((<a class="code" href="classSchema__Comm.html#aaa55ab78220cfcca058cf54a7ac14cc0" title="Drapeau: est-ce qu&#39;on autorise a s&#39;envoyer des messages a soi ?">me_to_me_</a>&amp;&amp;num_PE==<a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>()) || <a class="code" href="Schema__Comm_8cpp.html#a7014965a679ba90a3e95e5ef0f66f002">check_PE_in_list</a>(num_PE, <a class="code" href="classSchema__Comm.html#a24918eceb0ce15a6dae5a5a833480246" title="Liste des processeurs de qui recevoir.">recv_pe_list_</a>));
<a name="l00505"></a>00505   <span class="keywordflow">return</span> <a class="code" href="classSchema__Comm.html#a0955c141014893e559b831ae33d55d56" title="Accesseur a un membre du tableau ebuffers_ (avec verification)">ebuffer</a>(num_PE);
<a name="l00506"></a>00506 }
<a name="l00507"></a>00507 
<a name="l00508"></a><a class="code" href="classSchema__Comm.html#ad726332731df9b745cb6df8e1919d82a">00508</a> <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; <a class="code" href="classSchema__Comm.html#ad726332731df9b745cb6df8e1919d82a">Schema_Comm::get_send_pe_list</a>()<span class="keyword"> const</span>
<a name="l00509"></a>00509 <span class="keyword"></span>{
<a name="l00510"></a>00510   assert(<a class="code" href="classSchema__Comm.html#adcd2cdb2d6ce76883858c8f6078fda56" title="Groupe de processeurs qui vont discuter.">ref_group_</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>());
<a name="l00511"></a>00511   <span class="keywordflow">return</span> <a class="code" href="classSchema__Comm.html#a93eb7538476fa54ade96e88294feec8e" title="Liste des processeurs a qui envoyer.">send_pe_list_</a>;
<a name="l00512"></a>00512 }
<a name="l00513"></a>00513 
<a name="l00514"></a><a class="code" href="classSchema__Comm.html#abfde4d298c654f11891abfc3120be8fd">00514</a> <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; <a class="code" href="classSchema__Comm.html#abfde4d298c654f11891abfc3120be8fd">Schema_Comm::get_recv_pe_list</a>()<span class="keyword"> const</span>
<a name="l00515"></a>00515 <span class="keyword"></span>{
<a name="l00516"></a>00516   assert(<a class="code" href="classSchema__Comm.html#adcd2cdb2d6ce76883858c8f6078fda56" title="Groupe de processeurs qui vont discuter.">ref_group_</a>.<a class="code" href="classO__U__Ptr.html#a16f216b2d169e885876419182658ddcc" title="Renvoie 1 si le pointeur est non_nul Renvoie 0 sinon.">non_nul</a>());
<a name="l00517"></a>00517   <span class="keywordflow">return</span> <a class="code" href="classSchema__Comm.html#a24918eceb0ce15a6dae5a5a833480246" title="Liste des processeurs de qui recevoir.">recv_pe_list_</a>;
<a name="l00518"></a>00518 }
<a name="l00519"></a>00519 
<a name="l00520"></a>00520 <span class="comment">//</span>
<a name="l00521"></a>00521 <span class="comment">//</span>
<a name="l00522"></a>00522 <span class="comment">//</span>
<a name="l00523"></a>00523 <span class="comment">//</span><span class="comment"></span>
<a name="l00524"></a>00524 <span class="comment">//! renvoie une reference a un tableau qui contient, pour chaque&lt;br&gt;processeur de send_pe_list_, la taille en bytes des donnees&lt;br&gt;a envoyer.&lt;br&gt;A FINIR !!!!</span>
<a name="l00525"></a><a class="code" href="classSchema__Comm__statique.html#a17092c95f0710cd991596c1f43c7e74e">00525</a> <span class="comment"></span><span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; <a class="code" href="classSchema__Comm__statique.html#a17092c95f0710cd991596c1f43c7e74e" title="renvoie une reference a un tableau qui contient, pour chaque processeur de send_pe_list_, la taille en bytes des donnees a envoyer. A FINIR !!!!">Schema_Comm_statique::get_send_size</a>()<span class="keyword"> const</span>
<a name="l00526"></a>00526 <span class="keyword"></span>{
<a name="l00527"></a>00527   assert(0);
<a name="l00528"></a>00528   assert(<a class="code" href="classSchema__Comm.html#ae56acaadf7a079ce874be628491593cb">status_</a> == <a class="code" href="classSchema__Comm.html#a513eef36a4603d995f2a04f166812470a40b4132b151da7359211aad2f3682c9f">EXCHANGED</a>);
<a name="l00529"></a>00529   <span class="keywordflow">return</span> <a class="code" href="classSchema__Comm__statique.html#ab171764b7e3d484b941d1aba02ce54c2" title="Taille des messages a envoyer en bytes.">send_size_</a>;
<a name="l00530"></a>00530 }
<a name="l00531"></a>00531 
<a name="l00532"></a>00532 <span class="comment">//</span>
<a name="l00533"></a>00533 <span class="comment">//</span>
<a name="l00534"></a>00534 <span class="comment">//</span>
<a name="l00535"></a>00535 <span class="comment">//</span><span class="comment"></span>
<a name="l00536"></a>00536 <span class="comment">//! renvoie une reference a un tableau qui contient, pour chaque&lt;br&gt;processeur de send_pe_list_, la taille en bytes des donnees&lt;br&gt;a recues.&lt;br&gt;A FINIR !!!!</span>
<a name="l00537"></a><a class="code" href="classSchema__Comm__statique.html#a2b768dd1aa7cffb5c634fd4e0da8c4f8">00537</a> <span class="comment"></span><span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; <a class="code" href="classSchema__Comm__statique.html#a2b768dd1aa7cffb5c634fd4e0da8c4f8" title="renvoie une reference a un tableau qui contient, pour chaque processeur de send_pe_list_, la taille en bytes des donnees a recues. A FINIR !!!!">Schema_Comm_statique::get_recv_size</a>()<span class="keyword"> const</span>
<a name="l00538"></a>00538 <span class="keyword"></span>{
<a name="l00539"></a>00539   assert(0);
<a name="l00540"></a>00540   assert(<a class="code" href="classSchema__Comm.html#ae56acaadf7a079ce874be628491593cb">status_</a> == <a class="code" href="classSchema__Comm.html#a513eef36a4603d995f2a04f166812470a40b4132b151da7359211aad2f3682c9f">EXCHANGED</a>);
<a name="l00541"></a>00541   <span class="keywordflow">return</span> <a class="code" href="classSchema__Comm__statique.html#a847e3ad3fb0f84b27d7595896c39d665" title="Taille des messages a recevoir en bytes.">recv_size_</a>;
<a name="l00542"></a>00542 }
<a name="l00543"></a>00543 
<a name="l00544"></a>00544 <span class="comment">// Precondition:</span>
<a name="l00545"></a>00545 <span class="comment">// * Statut == RESET</span>
<a name="l00546"></a>00546 <span class="comment">// * Cette fonction doit etre appelee simultanement sur tous les membres du groupe.</span>
<a name="l00547"></a>00547 <span class="comment">//</span><span class="comment"></span>
<a name="l00548"></a>00548 <span class="comment">//! Verifie que les send/recv_pe_list verifient la propriete&lt;br&gt;&quot;tu m&#39;ecoutes quand je te parle&quot;</span>
<a name="l00549"></a><a class="code" href="classSchema__Comm.html#a10b238ae8ba1d3f6ed955fa7164c93ce">00549</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classSchema__Comm.html#a10b238ae8ba1d3f6ed955fa7164c93ce" title="Verifie que les send/recv_pe_list verifient la propriete &quot;tu m&#39;ecoutes quand je te parle&quot;...">Schema_Comm::check_send_recv_pe_list</a>()<span class="keyword"> const</span>
<a name="l00550"></a>00550 <span class="keyword"></span>{
<a name="l00551"></a>00551   assert(<a class="code" href="classSchema__Comm.html#ae56acaadf7a079ce874be628491593cb">status_</a> == <a class="code" href="classSchema__Comm.html#a513eef36a4603d995f2a04f166812470a79ffb1835b68257288b75f8fbcb65178">RESET</a>);
<a name="l00552"></a>00552 <span class="comment">// On verifie que les indices de processeurs sont dans le groupe</span>
<a name="l00553"></a>00553   <span class="keywordtype">int</span> fail1 = 0;
<a name="l00554"></a>00554   <span class="keyword">const</span> <span class="keywordtype">int</span> np = <a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>();
<a name="l00555"></a>00555   <span class="keyword">const</span> <span class="keywordtype">int</span> n1 = <a class="code" href="classSchema__Comm.html#a93eb7538476fa54ade96e88294feec8e" title="Liste des processeurs a qui envoyer.">send_pe_list_</a>.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00556"></a>00556   <span class="keywordtype">int</span> i;
<a name="l00557"></a>00557   <span class="keywordflow">for</span> (i = 0; i &lt; n1; i++)
<a name="l00558"></a>00558     <span class="keywordflow">if</span> (<a class="code" href="classSchema__Comm.html#a93eb7538476fa54ade96e88294feec8e" title="Liste des processeurs a qui envoyer.">send_pe_list_</a>[i] &lt; 0 || <a class="code" href="classSchema__Comm.html#a93eb7538476fa54ade96e88294feec8e" title="Liste des processeurs a qui envoyer.">send_pe_list_</a>[i] &gt;= np)
<a name="l00559"></a>00559       fail1 = 1;
<a name="l00560"></a>00560   <span class="keyword">const</span> <span class="keywordtype">int</span> n2 = <a class="code" href="classSchema__Comm.html#a24918eceb0ce15a6dae5a5a833480246" title="Liste des processeurs de qui recevoir.">recv_pe_list_</a>.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00561"></a>00561   <span class="keywordflow">for</span> (i = 0; i &lt; n2; i++)
<a name="l00562"></a>00562     <span class="keywordflow">if</span> (<a class="code" href="classSchema__Comm.html#a24918eceb0ce15a6dae5a5a833480246" title="Liste des processeurs de qui recevoir.">recv_pe_list_</a>[i] &lt; 0 || <a class="code" href="classSchema__Comm.html#a24918eceb0ce15a6dae5a5a833480246" title="Liste des processeurs de qui recevoir.">recv_pe_list_</a>[i] &gt;= np)
<a name="l00563"></a>00563       fail1 = 1;
<a name="l00564"></a>00564   <span class="keywordtype">int</span> fail2 = 0;
<a name="l00565"></a>00565   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> recv_list;
<a name="l00566"></a>00566   <span class="keywordflow">if</span> (!fail1)
<a name="l00567"></a>00567     {
<a name="l00568"></a>00568       <a class="code" href="communications_8cpp.html#a38c9e2f958081bff6f390b56ec939523" title="Calcule la transposee d&#39;une liste de processeurs: On construit le tableau dest_list tel que: x est da...">reverse_send_recv_pe_list</a>(<a class="code" href="classSchema__Comm.html#a93eb7538476fa54ade96e88294feec8e" title="Liste des processeurs a qui envoyer.">send_pe_list_</a>, recv_list);
<a name="l00569"></a>00569 <span class="comment">// Le tableau recv_pe_list_ n&#39;est pas forcement trie alors que recv_list l&#39;est toujours</span>
<a name="l00570"></a>00570 <span class="comment">// On trie avant de comparer</span>
<a name="l00571"></a>00571       <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> copie(<a class="code" href="classSchema__Comm.html#a24918eceb0ce15a6dae5a5a833480246" title="Liste des processeurs de qui recevoir.">recv_pe_list_</a>);
<a name="l00572"></a>00572       copie.<a class="code" href="classArrOfInt.html#abb0f48cf5a4be4b70edcc90baaebd521" title="Tri des valeurs du tableau dans l&#39;ordre croissant. La fonction utilisee est qsort de stdlib (elle est...">ordonne_array</a>();
<a name="l00573"></a>00573       fail2 = !(recv_list == copie);
<a name="l00574"></a>00574     }
<a name="l00575"></a>00575   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#a7d23bc1ef94b3f0623fbc79d034c27fd" title="Calcule la somme de x sur tous les processeurs du groupe courant. Voir aussi mp_max()">Process::mp_sum</a>(fail1+fail2))
<a name="l00576"></a>00576     {
<a name="l00577"></a>00577       <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#acd052b99706c577f8a5b6656217cf4c2" title="renvoie 1 si on est sur le processeur maitre du groupe courant (c&#39;est a dire me() == 0)...">Process::je_suis_maitre</a>())
<a name="l00578"></a>00578         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error in Schema_Comm::check_send_recv_pe_list(), see .log files&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00579"></a>00579       <a class="code" href="classProcess.html#a57e0f54b11e6eaadbea224fa904b18dd" title="Renvoie un objet statique de type Sortie qui sert de journal d&#39;evenements. Si message_level &lt;= verbose...">Process::Journal</a>() &lt;&lt; <span class="stringliteral">&quot;Error in Schema_Comm::check_send_recv_pe_list() :\n&quot;</span>
<a name="l00580"></a>00580                          &lt;&lt; <span class="stringliteral">&quot;send_list:\n&quot;</span> &lt;&lt; <a class="code" href="classSchema__Comm.html#a93eb7538476fa54ade96e88294feec8e" title="Liste des processeurs a qui envoyer.">send_pe_list_</a>
<a name="l00581"></a>00581                          &lt;&lt; <span class="stringliteral">&quot;recv_list:\n&quot;</span> &lt;&lt; <a class="code" href="classSchema__Comm.html#a24918eceb0ce15a6dae5a5a833480246" title="Liste des processeurs de qui recevoir.">recv_pe_list_</a>;
<a name="l00582"></a>00582       <span class="keywordflow">if</span> (fail1)
<a name="l00583"></a>00583         <a class="code" href="classProcess.html#a57e0f54b11e6eaadbea224fa904b18dd" title="Renvoie un objet statique de type Sortie qui sert de journal d&#39;evenements. Si message_level &lt;= verbose...">Process::Journal</a>() &lt;&lt; <span class="stringliteral">&quot;processor ranks not in current group: current group size = &quot;</span> &lt;&lt; np;
<a name="l00584"></a>00584       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fail2)
<a name="l00585"></a>00585         <a class="code" href="classProcess.html#a57e0f54b11e6eaadbea224fa904b18dd" title="Renvoie un objet statique de type Sortie qui sert de journal d&#39;evenements. Si message_level &lt;= verbose...">Process::Journal</a>() &lt;&lt; <span class="stringliteral">&quot;recv_list should be this one:\n&quot;</span> &lt;&lt; recv_list &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00586"></a>00586       <span class="keywordflow">else</span>
<a name="l00587"></a>00587         <a class="code" href="classProcess.html#a57e0f54b11e6eaadbea224fa904b18dd" title="Renvoie un objet statique de type Sortie qui sert de journal d&#39;evenements. Si message_level &lt;= verbose...">Process::Journal</a>() &lt;&lt; <span class="stringliteral">&quot;OK on this processor&quot;</span> &lt;&lt; finl;
<a name="l00588"></a>00588       <a class="code" href="classProcess.html#aa9e74a5c06a68ea38298a08ea401e7b1" title="Synchronise tous les processeurs du groupe courant&lt;br&gt;(attend que tous les processeurs soient arrives...">Process::barrier</a>();
<a name="l00589"></a>00589       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00590"></a>00590     }
<a name="l00591"></a>00591 }
<a name="l00592"></a>00592 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:27 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
