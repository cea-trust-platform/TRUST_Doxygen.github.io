<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/Kernel/Utilitaires/Schema_Comm_Vecteurs.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/Kernel/Utilitaires/Schema_Comm_Vecteurs.h</div>  </div>
</div>
<div class="contents">
<a href="Schema__Comm__Vecteurs_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (c) 2015 - 2016, CEA</span>
<a name="l00003"></a>00003 <span class="comment">* All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment">* 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00007"></a>00007 <span class="comment">* 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00008"></a>00008 <span class="comment">* 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<a name="l00011"></a>00011 <span class="comment">* IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;</span>
<a name="l00012"></a>00012 <span class="comment">* OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// File:        Schema_Comm_Vecteurs.h</span>
<a name="l00018"></a>00018 <span class="comment">// Directory:   $TRUST_ROOT/src/Kernel/Utilitaires</span>
<a name="l00019"></a>00019 <span class="comment">// Version:     /main/7</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 <span class="preprocessor">#ifndef Schema_Comm_Vecteurs_included</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span><span class="preprocessor">#define Schema_Comm_Vecteurs_included</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="ArrOfInt_8h.html">ArrOfInt.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="ArrOfDouble_8h.html">ArrOfDouble.h</a>&gt;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="keyword">class </span><a class="code" href="classSchema__Comm__Vecteurs__Static__Data.html" title="Donnees statiques communes a toutes les classes Schema_Comm_Vecteur, avec destructeur pour liberer la...">Schema_Comm_Vecteurs_Static_Data</a>;
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="comment">//</span>
<a name="l00031"></a>00031 <span class="comment">//</span>
<a name="l00032"></a>00032 <span class="comment">//</span>
<a name="l00033"></a>00033 <span class="comment">//</span>
<a name="l00034"></a>00034 <span class="comment">//</span>
<a name="l00035"></a>00035 <span class="comment">//</span>
<a name="l00036"></a>00036 <span class="comment">//</span>
<a name="l00037"></a>00037 <span class="comment">//</span>
<a name="l00038"></a>00038 <span class="comment">//</span>
<a name="l00039"></a>00039 <span class="comment">//</span>
<a name="l00040"></a>00040 <span class="comment">//</span>
<a name="l00041"></a>00041 <span class="comment">//</span>
<a name="l00042"></a>00042 <span class="comment">//</span>
<a name="l00043"></a>00043 <span class="comment">//</span>
<a name="l00044"></a>00044 <span class="comment">//</span>
<a name="l00045"></a>00045 <span class="comment">//</span>
<a name="l00046"></a>00046 <span class="comment">//</span>
<a name="l00047"></a>00047 <span class="comment">//</span>
<a name="l00048"></a>00048 <span class="comment">//</span>
<a name="l00049"></a>00049 <span class="comment">//</span>
<a name="l00050"></a>00050 <span class="comment">//</span>
<a name="l00051"></a>00051 <span class="comment">//</span><span class="comment"></span>
<a name="l00052"></a>00052 <span class="comment">//! Classe outil utilisee notamment par les methodes MD_Vector::echange_espace_virtuel()&lt;br&gt;Permet d&#39;echanger avec d&#39;autres processeurs des blocs d&#39;ints ou de double&lt;br&gt;accessibles par des tableaux dans lesquels on lit et on ecrit directement&lt;br&gt;(contrairement a Schema_Comm qui utilise readOn et printOn, plus lent).&lt;br&gt;Pour des raisons de performances, la communication est separee en deux parties&lt;br&gt;- definition des tailles de buffers (permet d&#39;allouer a l&#39;avance les bufffers&lt;br&gt;begin_init()&lt;br&gt;add_send/recv_area_int/double(processeur, size)&lt;br&gt;(declaration des types, tailles et processeurs destinataire des blocs que l&#39;on va envoyer,&lt;br&gt;on peut envoyer plusieurs blocs de types identiques ou differents a chaque processeur)&lt;br&gt;end_init()&lt;br&gt;- echange de donnees (autant de fois qu&#39;on veut):&lt;br&gt;begin_comm()&lt;br&gt;for(each bloc to send) {&lt;br&gt;ArrOfInt/Double \&amp; buf = get_next_area_int/double(pe, size);&lt;br&gt;for (i=0; i&lt;size; i++)&lt;br&gt;buf[i] = ...&lt;br&gt;}&lt;br&gt;exchange();&lt;br&gt;for (each bloc to recv) {&lt;br&gt;... get_next_area_int/double(...)&lt;br&gt;end_comm();</span>
<a name="l00053"></a><a class="code" href="classSchema__Comm__Vecteurs.html">00053</a> <span class="comment"></span><span class="keyword">class </span><a class="code" href="classSchema__Comm__Vecteurs.html" title="Classe outil utilisee notamment par les methodes MD_Vector::echange_espace_virtuel() Permet d&#39;echange...">Schema_Comm_Vecteurs</a>
<a name="l00054"></a>00054 {
<a name="l00055"></a>00055 <span class="keyword">public</span>:
<a name="l00056"></a>00056   <a class="code" href="classSchema__Comm__Vecteurs.html#a6951f896ebedb99dad6dfbcfe4be7a67">Schema_Comm_Vecteurs</a>();
<a name="l00057"></a>00057   <a class="code" href="classSchema__Comm__Vecteurs.html#ad98e7188d4e47242a0fae0c98a49cbdb">~Schema_Comm_Vecteurs</a>();
<a name="l00058"></a>00058   <span class="keywordtype">void</span> <a class="code" href="classSchema__Comm__Vecteurs.html#a611c6c0d69aae3a85657a4811a745dd6" title="Reinitialise les tailles de buffers. Il faut ensuite definir les tailles de buffers avec add_send/rec...">begin_init</a>();
<a name="l00059"></a>00059   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classSchema__Comm__Vecteurs.html#a80428288ac46f964239cf75adff9e426">add_send_area_int</a>(<span class="keywordtype">int</span> pe, <span class="keywordtype">int</span> size);
<a name="l00060"></a>00060   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classSchema__Comm__Vecteurs.html#a64e4789eec21a8a401107adb1aaa65eb">add_send_area_double</a>(<span class="keywordtype">int</span> pe, <span class="keywordtype">int</span> size);
<a name="l00061"></a>00061   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classSchema__Comm__Vecteurs.html#a7e0bf8bf0137f69808fb319802b29782">add_recv_area_int</a>(<span class="keywordtype">int</span> pe, <span class="keywordtype">int</span> size);
<a name="l00062"></a>00062   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classSchema__Comm__Vecteurs.html#a1e886aafb0edbc524e3426786d268ff1">add_recv_area_double</a>(<span class="keywordtype">int</span> pe, <span class="keywordtype">int</span> size);
<a name="l00063"></a>00063   <span class="keywordtype">void</span> <a class="code" href="classSchema__Comm__Vecteurs.html#a60c477436f012ff4caadc23b4f6626d9" title="Une fois les donnees a echanger declarees avec add_send/recv_area_...(), initialise les offset de buf...">end_init</a>();
<a name="l00064"></a>00064   <span class="keywordtype">void</span> <a class="code" href="classSchema__Comm__Vecteurs.html#a5174c71752ad18a1ebad363832aa97fe" title="Commence un nouvel echange de donnees (les tailles de buffers doivent avoir ete initialisees avec beg...">begin_comm</a>();
<a name="l00065"></a>00065   <span class="keywordtype">void</span> <a class="code" href="classSchema__Comm__Vecteurs.html#abf1ef0ef60e6756f9c4c8346262a35b1">exchange</a>();
<a name="l00066"></a>00066   <span class="keywordtype">void</span> <a class="code" href="classSchema__Comm__Vecteurs.html#a09f608641aa8e3349ac966b1eb3b07e1">end_comm</a>();
<a name="l00067"></a>00067   <span class="keyword">inline</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; <a class="code" href="classSchema__Comm__Vecteurs.html#ae31bd8f65b3b9ff75f5e8f12f94f5ebf" title="renvoie un tableau contenant les &quot;size&quot; valeurs suivantes recues du processeur pe lors de la commun...">get_next_area_int</a>(<span class="keywordtype">int</span> pe, <span class="keywordtype">int</span> array_size);
<a name="l00068"></a>00068   <span class="keyword">inline</span> <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a>&amp; <a class="code" href="classSchema__Comm__Vecteurs.html#a22d534079143232b4a9db96c93288782">get_next_area_double</a>(<span class="keywordtype">int</span> pe, <span class="keywordtype">int</span> array_size);
<a name="l00069"></a>00069 <span class="keyword">protected</span>:
<a name="l00070"></a>00070   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classSchema__Comm__Vecteurs.html#afbb8c49e9547fccf62d04e97ae42f447">add</a>(<span class="keywordtype">int</span> pe, <span class="keywordtype">int</span> size, <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; procs, <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; buf_sizes, <span class="keywordtype">int</span> align_size);
<a name="l00071"></a>00071   <span class="keywordtype">int</span> <a class="code" href="classSchema__Comm__Vecteurs.html#a7b6fd32e043ba94392d5d19bfc51b282" title="Selon status_, verifie que tous les pointeurs de buffers pointent a la fin du buffer aloue pour chaqu...">check_buffers_full</a>() <span class="keyword">const</span>;
<a name="l00072"></a>00072   <span class="keywordtype">int</span> <a class="code" href="classSchema__Comm__Vecteurs.html#aedfb206be5b0e1cae3c0307a962f8035" title="verifie qu&#39;il reste au moins byte_size octets dans le buffer du processeur pe">check_next_area</a>(<span class="keywordtype">int</span> pe, <span class="keywordtype">int</span> byte_size) <span class="keyword">const</span>;
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 <span class="comment">// Pour chaque processeur de send_proc ou recv_proc_, taille totale des buffers en &quot;bytes&quot;</span>
<a name="l00075"></a>00075 <span class="comment">// Pendant la phase begin_init(), ces deux tableaux sont de taille nproc(), valeur nulle</span>
<a name="l00076"></a>00076 <span class="comment">// pour les processeurs a qui on ne parle pas.</span>
<a name="l00077"></a>00077 <span class="comment">// ensuite, il sont de la meme taille que send_procs_ et recv_procs_</span>
<a name="l00078"></a><a class="code" href="classSchema__Comm__Vecteurs.html#a3f5e5544b71d235ea283f7f8beb2665e">00078</a>   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> <a class="code" href="classSchema__Comm__Vecteurs.html#a3f5e5544b71d235ea283f7f8beb2665e">send_buf_sizes_</a>;
<a name="l00079"></a><a class="code" href="classSchema__Comm__Vecteurs.html#ada2157628cf7d00fbedf8fd12cebcca0">00079</a>   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> <a class="code" href="classSchema__Comm__Vecteurs.html#ada2157628cf7d00fbedf8fd12cebcca0">recv_buf_sizes_</a>;
<a name="l00080"></a>00080 <span class="comment">// Liste des proceseurs a qui on envoie des donnees</span>
<a name="l00081"></a><a class="code" href="classSchema__Comm__Vecteurs.html#ac4bee61e3e8a6a0d34e525f6eae82381">00081</a>   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> <a class="code" href="classSchema__Comm__Vecteurs.html#ac4bee61e3e8a6a0d34e525f6eae82381">send_procs_</a>;
<a name="l00082"></a><a class="code" href="classSchema__Comm__Vecteurs.html#a71a5b90321747f416727a654100b89d5">00082</a>   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> <a class="code" href="classSchema__Comm__Vecteurs.html#a71a5b90321747f416727a654100b89d5">recv_procs_</a>;
<a name="l00083"></a>00083 <span class="comment">// A l&#39;issue de la phase d&#39;initialisation, les processeurs sont-ils dans l&#39;ordre croissant ?</span>
<a name="l00084"></a><a class="code" href="classSchema__Comm__Vecteurs.html#af1bf17b00de4bd2e96695f94f68ea791">00084</a>   <span class="keywordtype">int</span> <a class="code" href="classSchema__Comm__Vecteurs.html#af1bf17b00de4bd2e96695f94f68ea791">sorted_</a>;
<a name="l00085"></a>00085 <span class="comment">// Taille du buffer requis pour ce schema</span>
<a name="l00086"></a><a class="code" href="classSchema__Comm__Vecteurs.html#aca1abcf441c2f3c71b392ac830bbc912">00086</a>   <span class="keywordtype">int</span> <a class="code" href="classSchema__Comm__Vecteurs.html#aca1abcf441c2f3c71b392ac830bbc912">min_buf_size_</a>;
<a name="l00087"></a>00087 
<a name="l00088"></a><a class="code" href="classSchema__Comm__Vecteurs.html#af0b3633b2b20429b5d91bc5b13a3fa7f">00088</a>   <span class="keyword">enum</span> <a class="code" href="classSchema__Comm__Vecteurs.html#af0b3633b2b20429b5d91bc5b13a3fa7f">Status</a> { <a class="code" href="classSchema__Comm__Vecteurs.html#af0b3633b2b20429b5d91bc5b13a3fa7faab624dd5c19c008840a1aa849d9e82dc">RESET</a>, <a class="code" href="classSchema__Comm__Vecteurs.html#af0b3633b2b20429b5d91bc5b13a3fa7fa707bf7dddcf9ecd02c8606e508a21449">BEGIN_INIT</a>, <a class="code" href="classSchema__Comm__Vecteurs.html#af0b3633b2b20429b5d91bc5b13a3fa7fab012d408c1973759c4c1877bd2f4e2b1">END_INIT</a>, <a class="code" href="classSchema__Comm__Vecteurs.html#af0b3633b2b20429b5d91bc5b13a3fa7fa875fbe2bdd16fe2e9dac04573165b674">BEGIN_COMM</a>, <a class="code" href="classSchema__Comm__Vecteurs.html#af0b3633b2b20429b5d91bc5b13a3fa7fa5e2a97a86e391667109817a944f3df14">EXCHANGED</a> };
<a name="l00089"></a><a class="code" href="classSchema__Comm__Vecteurs.html#a9554e2a80041d4a475fe57ca335fd624">00089</a>   <a class="code" href="classSchema__Comm__Vecteurs.html#af0b3633b2b20429b5d91bc5b13a3fa7f">Status</a> <a class="code" href="classSchema__Comm__Vecteurs.html#a9554e2a80041d4a475fe57ca335fd624">status_</a>;
<a name="l00090"></a>00090 
<a name="l00091"></a>00091 <span class="comment">// Le buffer global est-il en cours d&#39;utilisation ?</span>
<a name="l00092"></a><a class="code" href="classSchema__Comm__Vecteurs.html#a53368cc5b731fda45880a64e126551f1">00092</a>   <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="classSchema__Comm__Vecteurs.html#a53368cc5b731fda45880a64e126551f1">buffer_locked_</a>;
<a name="l00093"></a>00093 <span class="comment">// Zones temporaires de lecture/ecriture, renvoyees par get_next... et qui pointent dans buffer_</span>
<a name="l00094"></a><a class="code" href="classSchema__Comm__Vecteurs.html#a2fab4d2b9a4370b5be227b0221b5f16b">00094</a>   <span class="keyword">static</span> <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> <a class="code" href="classSchema__Comm__Vecteurs.html#a2fab4d2b9a4370b5be227b0221b5f16b">tmp_area_double_</a>;
<a name="l00095"></a><a class="code" href="classSchema__Comm__Vecteurs.html#a76a394eefd359ca8c00c459124aa4433">00095</a>   <span class="keyword">static</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> <a class="code" href="classSchema__Comm__Vecteurs.html#a76a394eefd359ca8c00c459124aa4433">tmp_area_int_</a>;
<a name="l00096"></a>00096 <span class="comment">// Classe contenant des tableaux malloc (pour destruction automatique en fin d&#39;execution)</span>
<a name="l00097"></a><a class="code" href="classSchema__Comm__Vecteurs.html#a09a2147eb4b5adfa654bee03e3c18f8a">00097</a>   <span class="keyword">static</span> <a class="code" href="classSchema__Comm__Vecteurs__Static__Data.html" title="Donnees statiques communes a toutes les classes Schema_Comm_Vecteur, avec destructeur pour liberer la...">Schema_Comm_Vecteurs_Static_Data</a> <a class="code" href="classSchema__Comm__Vecteurs.html#a09a2147eb4b5adfa654bee03e3c18f8a">sdata_</a>;
<a name="l00098"></a>00098 };
<a name="l00099"></a>00099 
<a name="l00100"></a>00100 <span class="comment">//</span>
<a name="l00101"></a>00101 <span class="comment">//</span><span class="comment"></span>
<a name="l00102"></a>00102 <span class="comment">//! Donnees statiques communes a toutes les classes Schema_Comm_Vecteur,&lt;br&gt;avec destructeur pour liberer la memoire en fin d&#39;execution</span>
<a name="l00103"></a><a class="code" href="classSchema__Comm__Vecteurs__Static__Data.html">00103</a> <span class="comment"></span><span class="keyword">class </span><a class="code" href="classSchema__Comm__Vecteurs__Static__Data.html" title="Donnees statiques communes a toutes les classes Schema_Comm_Vecteur, avec destructeur pour liberer la...">Schema_Comm_Vecteurs_Static_Data</a>
<a name="l00104"></a>00104 {
<a name="l00105"></a>00105 <span class="keyword">public</span>:
<a name="l00106"></a>00106   <a class="code" href="classSchema__Comm__Vecteurs__Static__Data.html#accb766de57a5b0363ad0e07f5004c330">Schema_Comm_Vecteurs_Static_Data</a>();
<a name="l00107"></a>00107   <a class="code" href="classSchema__Comm__Vecteurs__Static__Data.html#ad938efa7d8155bcd8909735fe6634a5e">~Schema_Comm_Vecteurs_Static_Data</a>();
<a name="l00108"></a>00108   <span class="keywordtype">void</span> <a class="code" href="classSchema__Comm__Vecteurs__Static__Data.html#a108a25291e8ef56311d8fde3da034c56">init</a>(<span class="keywordtype">int</span> size);
<a name="l00109"></a>00109 
<a name="l00110"></a><a class="code" href="classSchema__Comm__Vecteurs__Static__Data.html#a17c27dc3ea91f86491469dc8a68ded0b">00110</a>   <span class="keywordtype">char</span>  *<a class="code" href="classSchema__Comm__Vecteurs__Static__Data.html#a17c27dc3ea91f86491469dc8a68ded0b">buffer_base_</a>;
<a name="l00111"></a><a class="code" href="classSchema__Comm__Vecteurs__Static__Data.html#a49e6d562d9107c76f4b09c94d2afaa04">00111</a>   <span class="keywordtype">int</span> <a class="code" href="classSchema__Comm__Vecteurs__Static__Data.html#a49e6d562d9107c76f4b09c94d2afaa04">buffer_base_size_</a>;
<a name="l00112"></a><a class="code" href="classSchema__Comm__Vecteurs__Static__Data.html#a28f343988f1e7d0e8795e0d031efe439">00112</a>   <span class="keywordtype">int</span> <a class="code" href="classSchema__Comm__Vecteurs__Static__Data.html#a28f343988f1e7d0e8795e0d031efe439">buf_pointers_size_</a>;
<a name="l00113"></a>00113 <span class="comment">// Pour chaque processeur entre 0 et nproc(), adresse des prochaines donnees a lire/ecrire</span>
<a name="l00114"></a>00114 <span class="comment">// de ce proc dans le tableau buffer</span>
<a name="l00115"></a><a class="code" href="classSchema__Comm__Vecteurs__Static__Data.html#a957a2b143d97af8d47d2bf69a377f9ea">00115</a>   <span class="keywordtype">char</span> **<a class="code" href="classSchema__Comm__Vecteurs__Static__Data.html#a957a2b143d97af8d47d2bf69a377f9ea">buf_pointers_</a>;
<a name="l00116"></a>00116 };
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 <span class="comment">// Taille en bytes d&#39;un bloc de sz ints, arrondi aux 8 octets superieurs</span>
<a name="l00119"></a>00119 <span class="preprocessor">#ifdef INT_is_64_</span>
<a name="l00120"></a>00120 <span class="preprocessor"></span><span class="preprocessor">#define BLOCSIZE_INT(sz) (sz&lt;&lt;3)</span>
<a name="l00121"></a>00121 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00122"></a><a class="code" href="Schema__Comm__Vecteurs_8h.html#ada4317c273dab21bc78c5f5882f99997">00122</a> <span class="preprocessor"></span><span class="preprocessor">#define BLOCSIZE_INT(sz) (sz&lt;&lt;2)</span>
<a name="l00123"></a>00123 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00124"></a>00124 <span class="preprocessor"></span>
<a name="l00125"></a><a class="code" href="Schema__Comm__Vecteurs_8h.html#aabe0eb672d9fc4249b9bafe9dce85426">00125</a> <span class="preprocessor">#define BLOCSIZE_DOUBLE(sz) (sz&lt;&lt;3)</span>
<a name="l00126"></a><a class="code" href="Schema__Comm__Vecteurs_8h.html#acaaec25a198425e04f2cab9826df83e6">00126</a> <span class="preprocessor"></span><span class="preprocessor">#define ALIGN_SIZE(ptr,sz) ptr=sdata_.buffer_base_+((ptr-sdata_.buffer_base_+(sz-1))&amp;(~(sz-1)))</span>
<a name="l00127"></a>00127 <span class="preprocessor"></span>
<a name="l00128"></a><a class="code" href="classSchema__Comm__Vecteurs.html#afbb8c49e9547fccf62d04e97ae42f447">00128</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classSchema__Comm__Vecteurs.html#afbb8c49e9547fccf62d04e97ae42f447">Schema_Comm_Vecteurs::add</a>(<span class="keywordtype">int</span> pe, <span class="keywordtype">int</span> size, <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; procs, <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; buf_sizes,
<a name="l00129"></a>00129                                       <span class="keywordtype">int</span> align_size)
<a name="l00130"></a>00130 {
<a name="l00131"></a>00131   assert(<a class="code" href="classSchema__Comm__Vecteurs.html#a9554e2a80041d4a475fe57ca335fd624">status_</a> == <a class="code" href="classSchema__Comm__Vecteurs.html#af0b3633b2b20429b5d91bc5b13a3fa7fa707bf7dddcf9ecd02c8606e508a21449">BEGIN_INIT</a>);
<a name="l00132"></a>00132   assert(size &gt;= 0);
<a name="l00133"></a>00133   <span class="keywordtype">int</span>&amp; x = buf_sizes[pe];
<a name="l00134"></a>00134   <span class="keywordflow">if</span> (x == 0 &amp;&amp; size &gt; 0)
<a name="l00135"></a>00135     {
<a name="l00136"></a>00136       <span class="keyword">const</span> <span class="keywordtype">int</span> n = procs.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00137"></a>00137       <span class="keywordflow">if</span> (n &gt; 0 &amp;&amp; procs[n-1] &gt; pe)
<a name="l00138"></a>00138         <a class="code" href="classSchema__Comm__Vecteurs.html#af1bf17b00de4bd2e96695f94f68ea791">sorted_</a> = 0;
<a name="l00139"></a>00139       procs.<a class="code" href="classArrOfInt.html#a3f39d0966599416e7b1f7cd8159d8d01" title="Ajoute une case en fin de tableau et y stocke la &quot;valeur&quot;.">append_array</a>(pe);
<a name="l00140"></a>00140     }
<a name="l00141"></a>00141   x = ((x+align_size-1)&amp;(~(align_size-1))) + size; <span class="comment">//!&lt; Padding before block</span>
<a name="l00142"></a>00142 <span class="comment"></span>}
<a name="l00143"></a>00143 
<a name="l00144"></a><a class="code" href="classSchema__Comm__Vecteurs.html#a80428288ac46f964239cf75adff9e426">00144</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classSchema__Comm__Vecteurs.html#a80428288ac46f964239cf75adff9e426">Schema_Comm_Vecteurs::add_send_area_int</a>(<span class="keywordtype">int</span> pe, <span class="keywordtype">int</span> size)
<a name="l00145"></a>00145 {
<a name="l00146"></a>00146   <a class="code" href="classSchema__Comm__Vecteurs.html#afbb8c49e9547fccf62d04e97ae42f447">add</a>(pe, <a class="code" href="Schema__Comm__Vecteurs_8h.html#ada4317c273dab21bc78c5f5882f99997">BLOCSIZE_INT</a>(size), <a class="code" href="classSchema__Comm__Vecteurs.html#ac4bee61e3e8a6a0d34e525f6eae82381">send_procs_</a>, <a class="code" href="classSchema__Comm__Vecteurs.html#a3f5e5544b71d235ea283f7f8beb2665e">send_buf_sizes_</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00147"></a>00147 }
<a name="l00148"></a>00148 
<a name="l00149"></a><a class="code" href="classSchema__Comm__Vecteurs.html#a64e4789eec21a8a401107adb1aaa65eb">00149</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classSchema__Comm__Vecteurs.html#a64e4789eec21a8a401107adb1aaa65eb">Schema_Comm_Vecteurs::add_send_area_double</a>(<span class="keywordtype">int</span> pe, <span class="keywordtype">int</span> size)
<a name="l00150"></a>00150 {
<a name="l00151"></a>00151   <a class="code" href="classSchema__Comm__Vecteurs.html#afbb8c49e9547fccf62d04e97ae42f447">add</a>(pe, <a class="code" href="Schema__Comm__Vecteurs_8h.html#aabe0eb672d9fc4249b9bafe9dce85426">BLOCSIZE_DOUBLE</a>(size), <a class="code" href="classSchema__Comm__Vecteurs.html#ac4bee61e3e8a6a0d34e525f6eae82381">send_procs_</a>, <a class="code" href="classSchema__Comm__Vecteurs.html#a3f5e5544b71d235ea283f7f8beb2665e">send_buf_sizes_</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00152"></a>00152 }
<a name="l00153"></a>00153 
<a name="l00154"></a><a class="code" href="classSchema__Comm__Vecteurs.html#a7e0bf8bf0137f69808fb319802b29782">00154</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classSchema__Comm__Vecteurs.html#a7e0bf8bf0137f69808fb319802b29782">Schema_Comm_Vecteurs::add_recv_area_int</a>(<span class="keywordtype">int</span> pe, <span class="keywordtype">int</span> size)
<a name="l00155"></a>00155 {
<a name="l00156"></a>00156   <a class="code" href="classSchema__Comm__Vecteurs.html#afbb8c49e9547fccf62d04e97ae42f447">add</a>(pe, <a class="code" href="Schema__Comm__Vecteurs_8h.html#ada4317c273dab21bc78c5f5882f99997">BLOCSIZE_INT</a>(size), <a class="code" href="classSchema__Comm__Vecteurs.html#a71a5b90321747f416727a654100b89d5">recv_procs_</a>, <a class="code" href="classSchema__Comm__Vecteurs.html#ada2157628cf7d00fbedf8fd12cebcca0">recv_buf_sizes_</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00157"></a>00157 }
<a name="l00158"></a>00158 
<a name="l00159"></a><a class="code" href="classSchema__Comm__Vecteurs.html#a1e886aafb0edbc524e3426786d268ff1">00159</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classSchema__Comm__Vecteurs.html#a1e886aafb0edbc524e3426786d268ff1">Schema_Comm_Vecteurs::add_recv_area_double</a>(<span class="keywordtype">int</span> pe, <span class="keywordtype">int</span> size)
<a name="l00160"></a>00160 {
<a name="l00161"></a>00161   <a class="code" href="classSchema__Comm__Vecteurs.html#afbb8c49e9547fccf62d04e97ae42f447">add</a>(pe, <a class="code" href="Schema__Comm__Vecteurs_8h.html#aabe0eb672d9fc4249b9bafe9dce85426">BLOCSIZE_DOUBLE</a>(size), <a class="code" href="classSchema__Comm__Vecteurs.html#a71a5b90321747f416727a654100b89d5">recv_procs_</a>, <a class="code" href="classSchema__Comm__Vecteurs.html#ada2157628cf7d00fbedf8fd12cebcca0">recv_buf_sizes_</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00162"></a>00162 }
<a name="l00163"></a>00163 
<a name="l00164"></a>00164 <span class="comment">//</span>
<a name="l00165"></a>00165 <span class="comment">//</span>
<a name="l00166"></a>00166 <span class="comment">//</span>
<a name="l00167"></a>00167 <span class="comment">//</span><span class="comment"></span>
<a name="l00168"></a>00168 <span class="comment">//! renvoie un tableau contenant les &quot;size&quot; valeurs suivantes&lt;br&gt;recues du processeur pe lors de la communication en cours.&lt;br&gt;Attention:&lt;br&gt;Le tableau renvoye est une reference a un tableau interne qui n&#39;est valide que&lt;br&gt;jusqu&#39;au prochain appel a une methode get_next_xxx.</span>
<a name="l00169"></a><a class="code" href="classSchema__Comm__Vecteurs.html#ae31bd8f65b3b9ff75f5e8f12f94f5ebf">00169</a> <span class="comment"></span><span class="keyword">inline</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; <a class="code" href="classSchema__Comm__Vecteurs.html#ae31bd8f65b3b9ff75f5e8f12f94f5ebf" title="renvoie un tableau contenant les &quot;size&quot; valeurs suivantes recues du processeur pe lors de la commun...">Schema_Comm_Vecteurs::get_next_area_int</a>(<span class="keywordtype">int</span> pe, <span class="keywordtype">int</span> size)
<a name="l00170"></a>00170 {
<a name="l00171"></a>00171   <a class="code" href="Schema__Comm__Vecteurs_8h.html#acaaec25a198425e04f2cab9826df83e6">ALIGN_SIZE</a>(<a class="code" href="classSchema__Comm__Vecteurs.html#a09a2147eb4b5adfa654bee03e3c18f8a">sdata_</a>.<a class="code" href="classSchema__Comm__Vecteurs__Static__Data.html#a957a2b143d97af8d47d2bf69a377f9ea">buf_pointers_</a>[pe], <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00172"></a>00172   assert(<a class="code" href="classSchema__Comm__Vecteurs.html#aedfb206be5b0e1cae3c0307a962f8035" title="verifie qu&#39;il reste au moins byte_size octets dans le buffer du processeur pe">check_next_area</a>(pe, <a class="code" href="Schema__Comm__Vecteurs_8h.html#ada4317c273dab21bc78c5f5882f99997">BLOCSIZE_INT</a>(size)));
<a name="l00173"></a>00173   <span class="keywordtype">int</span> *bufptr = (<span class="keywordtype">int</span> *) (<a class="code" href="classSchema__Comm__Vecteurs.html#a09a2147eb4b5adfa654bee03e3c18f8a">sdata_</a>.<a class="code" href="classSchema__Comm__Vecteurs__Static__Data.html#a957a2b143d97af8d47d2bf69a377f9ea">buf_pointers_</a>[pe]);
<a name="l00174"></a>00174 <span class="comment">// attention a l&#39;arithmetique de pointeurs, ajout d&#39;une taille en octets</span>
<a name="l00175"></a>00175   <a class="code" href="classSchema__Comm__Vecteurs.html#a09a2147eb4b5adfa654bee03e3c18f8a">sdata_</a>.<a class="code" href="classSchema__Comm__Vecteurs__Static__Data.html#a957a2b143d97af8d47d2bf69a377f9ea">buf_pointers_</a>[pe] += <a class="code" href="Schema__Comm__Vecteurs_8h.html#ada4317c273dab21bc78c5f5882f99997">BLOCSIZE_INT</a>(size);
<a name="l00176"></a>00176   <a class="code" href="classSchema__Comm__Vecteurs.html#a76a394eefd359ca8c00c459124aa4433">tmp_area_int_</a>.<a class="code" href="classArrOfInt.html#a95b02281f2d3f210e463389ff7288169" title="Fait pointer le tableau vers la zone de memoire &quot;data_&quot;. On detache la zone de memoire existante...">ref_data</a>(bufptr, size);
<a name="l00177"></a>00177   <span class="keywordflow">return</span> <a class="code" href="classSchema__Comm__Vecteurs.html#a76a394eefd359ca8c00c459124aa4433">tmp_area_int_</a>;
<a name="l00178"></a>00178 }
<a name="l00179"></a>00179 
<a name="l00180"></a><a class="code" href="classSchema__Comm__Vecteurs.html#a22d534079143232b4a9db96c93288782">00180</a> <span class="keyword">inline</span> <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a>&amp; <a class="code" href="classSchema__Comm__Vecteurs.html#a22d534079143232b4a9db96c93288782">Schema_Comm_Vecteurs::get_next_area_double</a>(<span class="keywordtype">int</span> pe, <span class="keywordtype">int</span> size)
<a name="l00181"></a>00181 {
<a name="l00182"></a>00182   <a class="code" href="Schema__Comm__Vecteurs_8h.html#acaaec25a198425e04f2cab9826df83e6">ALIGN_SIZE</a>(<a class="code" href="classSchema__Comm__Vecteurs.html#a09a2147eb4b5adfa654bee03e3c18f8a">sdata_</a>.<a class="code" href="classSchema__Comm__Vecteurs__Static__Data.html#a957a2b143d97af8d47d2bf69a377f9ea">buf_pointers_</a>[pe], <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00183"></a>00183   assert(<a class="code" href="classSchema__Comm__Vecteurs.html#aedfb206be5b0e1cae3c0307a962f8035" title="verifie qu&#39;il reste au moins byte_size octets dans le buffer du processeur pe">check_next_area</a>(pe, <a class="code" href="Schema__Comm__Vecteurs_8h.html#aabe0eb672d9fc4249b9bafe9dce85426">BLOCSIZE_DOUBLE</a>(size)));
<a name="l00184"></a>00184   <span class="keywordtype">double</span> *bufptr = (<span class="keywordtype">double</span> *) (<a class="code" href="classSchema__Comm__Vecteurs.html#a09a2147eb4b5adfa654bee03e3c18f8a">sdata_</a>.<a class="code" href="classSchema__Comm__Vecteurs__Static__Data.html#a957a2b143d97af8d47d2bf69a377f9ea">buf_pointers_</a>[pe]);
<a name="l00185"></a>00185 <span class="comment">// attention a l&#39;arithmetique de pointeurs, ajout d&#39;une taille en octets</span>
<a name="l00186"></a>00186   <a class="code" href="classSchema__Comm__Vecteurs.html#a09a2147eb4b5adfa654bee03e3c18f8a">sdata_</a>.<a class="code" href="classSchema__Comm__Vecteurs__Static__Data.html#a957a2b143d97af8d47d2bf69a377f9ea">buf_pointers_</a>[pe] += <a class="code" href="Schema__Comm__Vecteurs_8h.html#aabe0eb672d9fc4249b9bafe9dce85426">BLOCSIZE_DOUBLE</a>(size);
<a name="l00187"></a>00187   <a class="code" href="classSchema__Comm__Vecteurs.html#a2fab4d2b9a4370b5be227b0221b5f16b">tmp_area_double_</a>.<a class="code" href="classArrOfDouble.html#a8cc97dbe67c8001dad97008b10fa7690" title="Fait pointer le tableau vers la zone de memoire &quot;data_&quot;. On detache la zone de memoire existante...">ref_data</a>(bufptr, size);
<a name="l00188"></a>00188   <span class="keywordflow">return</span> <a class="code" href="classSchema__Comm__Vecteurs.html#a2fab4d2b9a4370b5be227b0221b5f16b">tmp_area_double_</a>;
<a name="l00189"></a>00189 }
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 
<a name="l00192"></a>00192 <span class="preprocessor">#undef BLOCSIZE_INT</span>
<a name="l00193"></a>00193 <span class="preprocessor"></span><span class="preprocessor">#undef BLOCSIZE_DOUBLE</span>
<a name="l00194"></a>00194 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00195"></a>00195 <span class="preprocessor"></span>
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:27 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
