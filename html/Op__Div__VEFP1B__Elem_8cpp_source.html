<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/P1NCP1B/Operateurs/Op_Div_VEFP1B_Elem.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/P1NCP1B/Operateurs/Op_Div_VEFP1B_Elem.cpp</div>  </div>
</div>
<div class="contents">
<a href="Op__Div__VEFP1B__Elem_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (c) 2021, CEA</span>
<a name="l00003"></a>00003 <span class="comment">* All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment">* 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00007"></a>00007 <span class="comment">* 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00008"></a>00008 <span class="comment">* 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<a name="l00011"></a>00011 <span class="comment">* IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;</span>
<a name="l00012"></a>00012 <span class="comment">* OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// File:        Op_Div_VEFP1B_Elem.cpp</span>
<a name="l00018"></a>00018 <span class="comment">// Directory:   $TRUST_ROOT/src/P1NCP1B/Operateurs</span>
<a name="l00019"></a>00019 <span class="comment">// Version:     /main/53</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;<a class="code" href="Op__Div__VEFP1B__Elem_8h.html">Op_Div_VEFP1B_Elem.h</a>&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="Domaine_8h.html">Domaine.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="Zone__Cl__VEF_8h.html">Zone_Cl_VEF.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="Periodique_8h.html">Periodique.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="Dirichlet_8h.html">Dirichlet.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="Dirichlet__homogene_8h.html">Dirichlet_homogene.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="Dirichlet__entree__fluide_8h.html">Dirichlet_entree_fluide.h</a>&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;<a class="code" href="Symetrie_8h.html">Symetrie.h</a>&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;<a class="code" href="Neumann_8h.html">Neumann.h</a>&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;<a class="code" href="Neumann__val__ext_8h.html">Neumann_val_ext.h</a>&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;<a class="code" href="Zone__VEF__PreP1b_8h.html">Zone_VEF_PreP1b.h</a>&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;<a class="code" href="Debog_8h.html">Debog.h</a>&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;<a class="code" href="Probleme__base_8h.html">Probleme_base.h</a>&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;<a class="code" href="Check__espace__virtuel_8h.html">Check_espace_virtuel.h</a>&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;<a class="code" href="Schema__Temps__base_8h.html">Schema_Temps_base.h</a>&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;<a class="code" href="Porosites__champ_8h.html">Porosites_champ.h</a>&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;<a class="code" href="SChaine_8h.html">SChaine.h</a>&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;<a class="code" href="VerifierCoin_8h.html">VerifierCoin.h</a>&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;<a class="code" href="SFichier_8h.html">SFichier.h</a>&gt;</span>
<a name="l00042"></a>00042 
<a name="l00043"></a><a class="code" href="Op__Div__VEFP1B__Elem_8cpp.html#ac392518ba9fdb95b27f98888a5c3645c">00043</a> <a class="code" href="Op__Diff__CoviMAC__Face_8cpp.html#aa86ec8ba612a969d9b4370b775037144">Implemente_instanciable</a>(<a class="code" href="classOp__Div__VEFP1B__Elem.html">Op_Div_VEFP1B_Elem</a>,<span class="stringliteral">&quot;Op_Div_VEFPreP1B_P1NC&quot;</span>,<a class="code" href="classOp__Div__VEF__Elem.html" title="class Op_Div_VEF_Elem Cette classe represente l&#39;operateur de divergence La discretisation est VEF On ...">Op_Div_VEF_Elem</a>);
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="comment">// printOn et readOn</span>
<a name="l00046"></a>00046 
<a name="l00047"></a><a class="code" href="classOp__Div__VEFP1B__Elem.html#a9db22d924656b4c47702b4926716e52a">00047</a> <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classOp__Div__VEFP1B__Elem.html#a9db22d924656b4c47702b4926716e52a" title="NE FAIT RIEN A surcharger dans les classes derivees.">Op_Div_VEFP1B_Elem::printOn</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; s )<span class="keyword"> const</span>
<a name="l00048"></a>00048 <span class="keyword"></span>{
<a name="l00049"></a>00049   <span class="keywordflow">return</span> s;
<a name="l00050"></a>00050 }
<a name="l00051"></a>00051 
<a name="l00052"></a><a class="code" href="classOp__Div__VEFP1B__Elem.html#ac5d24bc5b7d4e9591c21c926feaf2710">00052</a> <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classOp__Div__VEFP1B__Elem.html#ac5d24bc5b7d4e9591c21c926feaf2710">Op_Div_VEFP1B_Elem::readOn</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is )
<a name="l00053"></a>00053 {
<a name="l00054"></a>00054   <span class="keywordflow">return</span> is;
<a name="l00055"></a>00055 }
<a name="l00056"></a>00056 
<a name="l00057"></a><a class="code" href="Op__Div__VEFP1B__Elem_8cpp.html#a43ddbecfeb5d72a0ccf918858acb528c">00057</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="Op__Div__VEFP1B__Elem_8cpp.html#a43ddbecfeb5d72a0ccf918858acb528c">chercher_arete</a>(<span class="keywordtype">int</span> elem, <span class="keywordtype">int</span> somi, <span class="keywordtype">int</span> somj,
<a name="l00058"></a>00058                           <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; elem_aretes,
<a name="l00059"></a>00059                           <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; aretes_som)
<a name="l00060"></a>00060 {
<a name="l00061"></a>00061   <span class="keywordflow">if</span>(somi&gt;somj)
<a name="l00062"></a>00062     {
<a name="l00063"></a>00063       <span class="keywordtype">int</span> k=somi;
<a name="l00064"></a>00064       somi=somj;
<a name="l00065"></a>00065       somj=k;
<a name="l00066"></a>00066     }
<a name="l00067"></a>00067   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i_arete=0; i_arete&lt;6; i_arete++)
<a name="l00068"></a>00068     {
<a name="l00069"></a>00069       <span class="keywordtype">int</span> arete=elem_aretes(elem, i_arete);
<a name="l00070"></a>00070       <span class="keywordtype">int</span> som1=aretes_som(arete,0);
<a name="l00071"></a>00071       <span class="keywordflow">if</span>(somi==som1)
<a name="l00072"></a>00072         {
<a name="l00073"></a>00073           <span class="keywordtype">int</span> som2=aretes_som(arete,1);
<a name="l00074"></a>00074           <span class="keywordflow">if</span>(somj==som2)
<a name="l00075"></a>00075             <span class="keywordflow">return</span> arete;
<a name="l00076"></a>00076         }
<a name="l00077"></a>00077     }
<a name="l00078"></a>00078   <span class="keywordflow">return</span> -1;
<a name="l00079"></a>00079 }
<a name="l00080"></a>00080 
<a name="l00081"></a><a class="code" href="Op__Div__VEFP1B__Elem_8cpp.html#a45261662b3b88d5db461b3fc99246e5a">00081</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="Op__Div__VEFP1B__Elem_8cpp.html#a45261662b3b88d5db461b3fc99246e5a">verifier</a>(<span class="keyword">const</span> <a class="code" href="classOp__Div__VEFP1B__Elem.html">Op_Div_VEFP1B_Elem</a>&amp; op,
<a name="l00082"></a>00082                     <span class="keywordtype">int</span>&amp; init,
<a name="l00083"></a>00083                     <span class="keyword">const</span> <a class="code" href="classZone__VEF__PreP1b.html">Zone_VEF_PreP1b</a>&amp; zone_VEF,
<a name="l00084"></a>00084                     <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; vit,
<a name="l00085"></a>00085                     <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; div)
<a name="l00086"></a>00086 {
<a name="l00087"></a>00087   init=1;
<a name="l00088"></a>00088   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> v(vit);
<a name="l00089"></a>00089   v=1;
<a name="l00090"></a>00090   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> r(div);
<a name="l00091"></a>00091   r=0;
<a name="l00092"></a>00092   op.<a class="code" href="classOp__Div__VEFP1B__Elem.html#a9f7c58d682438fd50cf4213d82c55b5d">ajouter</a>(v, r);
<a name="l00093"></a>00093   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;div(1,..,1) = &quot;</span> &lt;&lt; r &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00094"></a>00094   <a class="code" href="classDebog.html#aa228f7e951ef67b9e9bb31ced928652f">Debog::verifier</a>(<span class="stringliteral">&quot;div(1,..,1) =&quot;</span>,r);
<a name="l00095"></a>00095   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; xv = zone_VEF.<a class="code" href="classZone__VF.html#a918c0885a9b67317fcce3a0535306542">xv</a>();
<a name="l00096"></a>00096   v=xv;
<a name="l00097"></a>00097   {
<a name="l00098"></a>00098     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt; v.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(0); i++)
<a name="l00099"></a>00099       v(i,1)=0;
<a name="l00100"></a>00100   }
<a name="l00101"></a>00101   r=0;
<a name="l00102"></a>00102   op.<a class="code" href="classOp__Div__VEFP1B__Elem.html#a9f7c58d682438fd50cf4213d82c55b5d">ajouter</a>(v, r);
<a name="l00103"></a>00103   <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;div(x,0) = &quot;</span> &lt;&lt; r &lt;&lt; finl;
<a name="l00104"></a>00104   <a class="code" href="classDebog.html#aa228f7e951ef67b9e9bb31ced928652f">Debog::verifier</a>(<span class="stringliteral">&quot;div(x,0) =&quot;</span>,r);
<a name="l00105"></a>00105   <span class="keywordflow">return</span> 1;
<a name="l00106"></a>00106 }
<a name="l00107"></a>00107 
<a name="l00108"></a><a class="code" href="classOp__Div__VEFP1B__Elem.html#a170699aa293b7f92b38c312afe34dec9">00108</a> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; <a class="code" href="classOp__Div__VEFP1B__Elem.html#a170699aa293b7f92b38c312afe34dec9">Op_Div_VEFP1B_Elem::ajouter_elem</a>(<span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; vit, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; div)<span class="keyword"> const</span>
<a name="l00109"></a>00109 <span class="keyword"></span>{
<a name="l00110"></a>00110   <span class="keyword">const</span> <a class="code" href="classZone__VEF__PreP1b.html">Zone_VEF_PreP1b</a>&amp; zone_VEF = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classZone__VEF__PreP1b.html">Zone_VEF_PreP1b</a>,<a class="code" href="classOp__Div__VEF__Elem.html#a0fb0419078a6e4f7f276ff20c7204ad6">la_zone_vef</a>.<a class="code" href="classRef__Zone__VEF.html#aafd9a5ee1a76f290c9c6b5447b0c8d30">valeur</a>());
<a name="l00111"></a>00111   assert(zone_VEF.<a class="code" href="classZone__VEF__PreP1b.html#aee2def53aa92584d7945e7c3d0d98963">get_alphaE</a>());
<a name="l00112"></a>00112   <span class="keyword">const</span> <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone = zone_VEF.<a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>();
<a name="l00113"></a>00113   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; face_normales = zone_VEF.<a class="code" href="classZone__VEF.html#a5742d75972e4846bf9fbb6ed5715053e">face_normales</a>();
<a name="l00114"></a>00114   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; elem_faces=zone_VEF.<a class="code" href="classZone__VF.html#a067e462dcd3ab92b0f6d945b19e4eb37" title="renvoie le numero de le ieme face de la maille num_elem la facon dont ces faces sont numerotees est l...">elem_faces</a>();
<a name="l00115"></a>00115   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; face_voisins=zone_VEF.<a class="code" href="classZone__VF.html#a49d4322f5585a8fa95748ca785b70702" title="renvoie l&#39;element voisin de numface dans la direction i. i=0 : dans le sens oppose de l&#39;axe orthogona...">face_voisins</a>();
<a name="l00116"></a>00116   <span class="keywordtype">int</span> nfe=zone.nb_faces_elem();
<a name="l00117"></a>00117   <span class="keywordtype">int</span> nb_elem=zone.nb_elem();
<a name="l00118"></a>00118   <span class="keywordtype">int</span> elem,indice,face,comp;
<a name="l00119"></a>00119   <span class="keywordtype">double</span> pscf,signe;
<a name="l00120"></a>00120 
<a name="l00121"></a>00121   <span class="keywordflow">for</span>(elem=0; elem&lt;nb_elem; elem++)
<a name="l00122"></a>00122     {
<a name="l00123"></a>00123       pscf=0;
<a name="l00124"></a>00124       <span class="keywordflow">for</span>(indice=0; indice&lt;nfe; indice++)
<a name="l00125"></a>00125         {
<a name="l00126"></a>00126           face = elem_faces(elem,indice);
<a name="l00127"></a>00127           signe=1;
<a name="l00128"></a>00128           <span class="keywordflow">if</span>(elem!=face_voisins(face,0))
<a name="l00129"></a>00129             signe=-1;
<a name="l00130"></a>00130           <span class="keywordflow">for</span>(comp=0; comp&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; comp++)
<a name="l00131"></a>00131             pscf+=signe*vit(face, comp)*
<a name="l00132"></a>00132                   face_normales(face,comp);
<a name="l00133"></a>00133         }
<a name="l00134"></a>00134       div(elem)+=pscf;
<a name="l00135"></a>00135     }
<a name="l00136"></a>00136   <a class="code" href="Check__espace__virtuel_8cpp.html#adee035ac60c0a14f58d5473969b5a976" title="Appelle remplir_items_non_calcules() si on est en mode comm_check_enabled() ou en mode debug (NDEBUG ...">assert_invalide_items_non_calcules</a>(div);
<a name="l00137"></a>00137   <span class="keywordflow">return</span> div;
<a name="l00138"></a>00138 }
<a name="l00139"></a>00139 
<a name="l00140"></a><a class="code" href="Op__Div__VEFP1B__Elem_8cpp.html#a210fede867f45a3894b9528eac9a2827">00140</a> <span class="keywordtype">int</span> <a class="code" href="Op__Div__VEFP1B__Elem_8cpp.html#a210fede867f45a3894b9528eac9a2827">find_cl_face</a>(<span class="keyword">const</span> <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone, <span class="keyword">const</span> <span class="keywordtype">int</span> face)
<a name="l00141"></a>00141 {
<a name="l00142"></a>00142   <span class="keywordtype">int</span> i;
<a name="l00143"></a>00143   <span class="keyword">const</span> <span class="keywordtype">int</span> nb_cl = zone.<a class="code" href="classZone.html#a9bf185c52ad1809d954bba670d9aed8a" title="Renvoie le nombre de bords + le nombre de raccords + le nombre de faces frontieres internes...">nb_front_Cl</a>();
<a name="l00144"></a>00144   <span class="keywordflow">for</span> (i = 0; i &lt; nb_cl; i++)
<a name="l00145"></a>00145     {
<a name="l00146"></a>00146       <span class="keyword">const</span> <a class="code" href="classFrontiere.html" title="Classe Frontiere. Une Frontiere decrit une partie de la frontiere d&#39;une Zone, elle possede un Nom...">Frontiere</a>&amp; fr = zone.<a class="code" href="classZone.html#ac338b119d4b0bc4f510a223b9086fe5e">frontiere</a>(i);
<a name="l00147"></a>00147       <span class="keyword">const</span> <span class="keywordtype">int</span> debut = fr.<a class="code" href="classFrontiere.html#a2a41c319a1530c984c356121e5ca2383">num_premiere_face</a>();
<a name="l00148"></a>00148       <span class="keywordflow">if</span> (face &gt;= debut &amp;&amp; face &lt; debut + fr.<a class="code" href="classFrontiere.html#aa073fe9dbdddde59471ee7032b256aa2" title="Renvoie le nombre de faces de la frontiere.">nb_faces</a>())
<a name="l00149"></a>00149         <span class="keywordflow">return</span> i;
<a name="l00150"></a>00150       <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; faces_virt = fr.<a class="code" href="classFrontiere.html#af1785ae558446734ad201d6ff9fece32">get_faces_virt</a>();
<a name="l00151"></a>00151       <span class="keyword">const</span> <span class="keywordtype">int</span> nb_faces_virt = faces_virt.<a class="code" href="classArrOfInt.html#a0f41611fce0a58c3ef3409dc1af8904d" title="Renvoie la taille du tableau (nombre d&#39;elements declares a la construction ou a resize_array()). C&#39;est le nombre d&#39;elements accessibles a operator[].">size_array</a>();
<a name="l00152"></a>00152       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; nb_faces_virt; j++)
<a name="l00153"></a>00153         <span class="keywordflow">if</span> (face == faces_virt[j])
<a name="l00154"></a>00154           <span class="keywordflow">return</span> i;
<a name="l00155"></a>00155     }
<a name="l00156"></a>00156   <span class="keywordflow">return</span> -1;
<a name="l00157"></a>00157 }
<a name="l00158"></a>00158 
<a name="l00159"></a><a class="code" href="Terme__Source__Qdm__VEF__Face_8cpp.html#ac26bff605faf3f42dc28db1dee9323a7">00159</a> <span class="keywordtype">double</span> <a class="code" href="Op__Div__VEFP1B__Elem_8cpp.html#ac26bff605faf3f42dc28db1dee9323a7">calculer_coef_som</a>(<span class="keywordtype">int</span> elem, <span class="keywordtype">int</span>&amp; nb_face_diri, <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; indice_diri, <span class="keyword">const</span> <a class="code" href="classZone__Cl__VEF.html">Zone_Cl_VEF</a>&amp; zcl, <span class="keyword">const</span> <a class="code" href="classZone__VEF.html" title="class Zone_VEF Classe instanciable qui derive de Zone_VF. Cette classe contient les informations geom...">Zone_VEF</a>&amp; zone_VEF)
<a name="l00160"></a>00160 {
<a name="l00161"></a>00161 
<a name="l00162"></a>00162 <span class="comment">// prov ajouter verif par %2 ....</span>
<a name="l00163"></a>00163   <span class="keywordtype">int</span> <a class="code" href="Raffiner__Simplexes_8cpp.html#a358dc168d8905bbafc12587204bc9fb8">type_elem</a>=0;
<a name="l00164"></a>00164   <span class="keywordtype">int</span>&amp; dimension= <a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">Objet_U::dimension</a>;
<a name="l00165"></a>00165   <span class="keywordtype">int</span> rang_elem=zone_VEF.<a class="code" href="classZone__VEF.html#a4b2171a85e5fc33663a3366acb713584">rang_elem_non_std</a>()(elem);
<a name="l00166"></a>00166   <span class="keywordflow">if</span> (rang_elem!=-1)
<a name="l00167"></a>00167     type_elem=zcl.<a class="code" href="classZone__Cl__VEF.html#a483bdab7690f844ed04e3defe04ec70a">type_elem_Cl</a>(rang_elem);
<a name="l00168"></a>00168   <span class="keywordflow">if</span> ((0)||(type_elem==0))
<a name="l00169"></a>00169     {
<a name="l00170"></a>00170       nb_face_diri=0;
<a name="l00171"></a>00171       <span class="keywordtype">double</span> coeff_som=1./(dimension*(dimension+1));
<a name="l00172"></a>00172       <span class="keywordflow">return</span> coeff_som;
<a name="l00173"></a>00173     }
<a name="l00174"></a>00174   <span class="keywordflow">else</span>
<a name="l00175"></a>00175     {
<a name="l00176"></a>00176       <span class="keywordflow">if</span> (dimension==2)
<a name="l00177"></a>00177         {
<a name="l00178"></a>00178           <span class="keywordflow">switch</span>(type_elem)
<a name="l00179"></a>00179             {
<a name="l00180"></a>00180             <span class="keywordflow">case</span> 1:
<a name="l00181"></a>00181               nb_face_diri=1;
<a name="l00182"></a>00182               indice_diri[0]=2;
<a name="l00183"></a>00183               <span class="keywordflow">break</span>;
<a name="l00184"></a>00184             <span class="keywordflow">case</span> 2:
<a name="l00185"></a>00185               nb_face_diri=1;
<a name="l00186"></a>00186               indice_diri[0]=1;
<a name="l00187"></a>00187               <span class="keywordflow">break</span>;
<a name="l00188"></a>00188             <span class="keywordflow">case</span> 4:
<a name="l00189"></a>00189               nb_face_diri=1;
<a name="l00190"></a>00190               indice_diri[0]=0;
<a name="l00191"></a>00191               <span class="keywordflow">break</span>;
<a name="l00192"></a>00192             <span class="keywordflow">case</span> 3:
<a name="l00193"></a>00193               nb_face_diri=2;
<a name="l00194"></a>00194               indice_diri[0]=1;
<a name="l00195"></a>00195               indice_diri[1]=2;
<a name="l00196"></a>00196               <span class="keywordflow">break</span>;
<a name="l00197"></a>00197             <span class="keywordflow">case</span> 5:
<a name="l00198"></a>00198               nb_face_diri=2;
<a name="l00199"></a>00199               indice_diri[0]=0;
<a name="l00200"></a>00200               indice_diri[1]=2;
<a name="l00201"></a>00201               <span class="keywordflow">break</span>;
<a name="l00202"></a>00202             <span class="keywordflow">case</span> 6:
<a name="l00203"></a>00203               nb_face_diri=2;
<a name="l00204"></a>00204               indice_diri[0]=0;
<a name="l00205"></a>00205               indice_diri[1]=1;
<a name="l00206"></a>00206               <span class="keywordflow">break</span>;
<a name="l00207"></a>00207             <span class="keywordflow">default</span>:
<a name="l00208"></a>00208               nb_face_diri=10000;
<a name="l00209"></a>00209               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;__FILE__&lt;&lt;(int)__LINE__&lt;&lt;<span class="stringliteral">&quot; impossible &quot;</span>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00210"></a>00210               <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00211"></a>00211               <span class="keywordflow">break</span>;
<a name="l00212"></a>00212             }
<a name="l00213"></a>00213         }
<a name="l00214"></a>00214       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dimension==3)
<a name="l00215"></a>00215         {
<a name="l00216"></a>00216           <span class="keywordflow">switch</span>(type_elem)
<a name="l00217"></a>00217             {
<a name="l00218"></a>00218             <span class="keywordflow">case</span> 1:
<a name="l00219"></a>00219               nb_face_diri=1;
<a name="l00220"></a>00220               indice_diri[0]=3;
<a name="l00221"></a>00221               <span class="keywordflow">break</span>;
<a name="l00222"></a>00222             <span class="keywordflow">case</span> 2:
<a name="l00223"></a>00223               nb_face_diri=1;
<a name="l00224"></a>00224               indice_diri[0]=2;
<a name="l00225"></a>00225               <span class="keywordflow">break</span>;
<a name="l00226"></a>00226             <span class="keywordflow">case</span> 4:
<a name="l00227"></a>00227               nb_face_diri=1;
<a name="l00228"></a>00228               indice_diri[0]=1;
<a name="l00229"></a>00229               <span class="keywordflow">break</span>;
<a name="l00230"></a>00230             <span class="keywordflow">case</span> 8:
<a name="l00231"></a>00231               nb_face_diri=1;
<a name="l00232"></a>00232               indice_diri[0]=0;
<a name="l00233"></a>00233               <span class="keywordflow">break</span>;
<a name="l00234"></a>00234             <span class="keywordflow">case</span> 3:
<a name="l00235"></a>00235               nb_face_diri=2;
<a name="l00236"></a>00236               indice_diri[0]=3;
<a name="l00237"></a>00237               indice_diri[1]=2;
<a name="l00238"></a>00238               <span class="keywordflow">break</span>;
<a name="l00239"></a>00239             <span class="keywordflow">case</span> 5:
<a name="l00240"></a>00240               nb_face_diri=2;
<a name="l00241"></a>00241               indice_diri[0]=1;
<a name="l00242"></a>00242               indice_diri[1]=3;
<a name="l00243"></a>00243               <span class="keywordflow">break</span>;
<a name="l00244"></a>00244             <span class="keywordflow">case</span> 6:
<a name="l00245"></a>00245               nb_face_diri=2;
<a name="l00246"></a>00246               indice_diri[0]=1;
<a name="l00247"></a>00247               indice_diri[1]=2;
<a name="l00248"></a>00248               <span class="keywordflow">break</span>;
<a name="l00249"></a>00249             <span class="keywordflow">case</span> 9:
<a name="l00250"></a>00250               nb_face_diri=2;
<a name="l00251"></a>00251               indice_diri[0]=0;
<a name="l00252"></a>00252               indice_diri[1]=3;
<a name="l00253"></a>00253               <span class="keywordflow">break</span>;
<a name="l00254"></a>00254             <span class="keywordflow">case</span> 10:
<a name="l00255"></a>00255               nb_face_diri=2;
<a name="l00256"></a>00256               indice_diri[0]=0;
<a name="l00257"></a>00257               indice_diri[1]=2;
<a name="l00258"></a>00258               <span class="keywordflow">break</span>;
<a name="l00259"></a>00259             <span class="keywordflow">case</span> 12:
<a name="l00260"></a>00260               nb_face_diri=2;
<a name="l00261"></a>00261               indice_diri[0]=0;
<a name="l00262"></a>00262               indice_diri[1]=1;
<a name="l00263"></a>00263               <span class="keywordflow">break</span>;
<a name="l00264"></a>00264             <span class="keywordflow">case</span> 7:
<a name="l00265"></a>00265               nb_face_diri=3;
<a name="l00266"></a>00266               indice_diri[0]=1;
<a name="l00267"></a>00267               indice_diri[1]=2;
<a name="l00268"></a>00268               indice_diri[2]=3;
<a name="l00269"></a>00269               <span class="keywordflow">break</span>;
<a name="l00270"></a>00270             <span class="keywordflow">case</span> 11:
<a name="l00271"></a>00271               nb_face_diri=3;
<a name="l00272"></a>00272               indice_diri[0]=0;
<a name="l00273"></a>00273               indice_diri[1]=2;
<a name="l00274"></a>00274               indice_diri[2]=3;
<a name="l00275"></a>00275               <span class="keywordflow">break</span>;
<a name="l00276"></a>00276             <span class="keywordflow">case</span> 13:
<a name="l00277"></a>00277               nb_face_diri=3;
<a name="l00278"></a>00278               indice_diri[0]=0;
<a name="l00279"></a>00279               indice_diri[1]=1;
<a name="l00280"></a>00280               indice_diri[2]=3;
<a name="l00281"></a>00281               <span class="keywordflow">break</span>;
<a name="l00282"></a>00282             <span class="keywordflow">case</span> 14:
<a name="l00283"></a>00283               nb_face_diri=3;
<a name="l00284"></a>00284               indice_diri[0]=0;
<a name="l00285"></a>00285               indice_diri[1]=1;
<a name="l00286"></a>00286               indice_diri[2]=2;
<a name="l00287"></a>00287               <span class="keywordflow">break</span>;
<a name="l00288"></a>00288             <span class="keywordflow">default</span>:
<a name="l00289"></a>00289               nb_face_diri=10000;
<a name="l00290"></a>00290               <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a>&lt;&lt;__FILE__&lt;&lt;(int)__LINE__&lt;&lt;<span class="stringliteral">&quot; impossible &quot;</span>&lt;&lt;<a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00291"></a>00291               <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00292"></a>00292               <span class="keywordflow">break</span>;
<a name="l00293"></a>00293             }
<a name="l00294"></a>00294         }
<a name="l00295"></a>00295       <span class="keywordflow">else</span>
<a name="l00296"></a>00296         {
<a name="l00297"></a>00297           nb_face_diri=10000;
<a name="l00298"></a>00298           abort();
<a name="l00299"></a>00299           <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">Process::exit</a>();
<a name="l00300"></a>00300         }
<a name="l00301"></a>00301     }
<a name="l00302"></a>00302   <span class="keywordtype">double</span> coeff_som=1./(dimension*(dimension+1-nb_face_diri));
<a name="l00303"></a>00303   <span class="keywordflow">return</span> coeff_som;
<a name="l00304"></a>00304 }
<a name="l00305"></a>00305 
<a name="l00306"></a><a class="code" href="classOp__Div__VEFP1B__Elem.html#a319b23f45b01481f30b1cf0bed47c4a5">00306</a> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; <a class="code" href="classOp__Div__VEFP1B__Elem.html#a319b23f45b01481f30b1cf0bed47c4a5">Op_Div_VEFP1B_Elem::ajouter_som</a>(<span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; vit, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; div, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; flux_b)<span class="keyword"> const</span>
<a name="l00307"></a>00307 <span class="keyword"></span>{
<a name="l00308"></a>00308   <span class="keyword">const</span> <a class="code" href="classZone__VEF__PreP1b.html">Zone_VEF_PreP1b</a>&amp; zone_VEF = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classZone__VEF__PreP1b.html">Zone_VEF_PreP1b</a>,<a class="code" href="classOp__Div__VEF__Elem.html#a0fb0419078a6e4f7f276ff20c7204ad6">la_zone_vef</a>.<a class="code" href="classRef__Zone__VEF.html#aafd9a5ee1a76f290c9c6b5447b0c8d30">valeur</a>());
<a name="l00309"></a>00309   assert(zone_VEF.<a class="code" href="classZone__VEF__PreP1b.html#ad7fbcb5567dcc2e6f0a0ed85ce90a4fa">get_alphaS</a>());
<a name="l00310"></a>00310   <span class="keyword">const</span> <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone = zone_VEF.<a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>();
<a name="l00311"></a>00311   <span class="keyword">const</span> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom=zone.domaine();
<a name="l00312"></a>00312   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; face_normales = zone_VEF.<a class="code" href="classZone__VEF.html#a5742d75972e4846bf9fbb6ed5715053e">face_normales</a>();
<a name="l00313"></a>00313   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; som_elem=zone.les_elems();
<a name="l00314"></a>00314   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; elem_faces=zone_VEF.<a class="code" href="classZone__VF.html#a067e462dcd3ab92b0f6d945b19e4eb37" title="renvoie le numero de le ieme face de la maille num_elem la facon dont ces faces sont numerotees est l...">elem_faces</a>();
<a name="l00315"></a>00315   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; face_voisins=zone_VEF.<a class="code" href="classZone__VF.html#a49d4322f5585a8fa95748ca785b70702" title="renvoie l&#39;element voisin de numface dans la direction i. i=0 : dans le sens oppose de l&#39;axe orthogona...">face_voisins</a>();
<a name="l00316"></a>00316   <span class="keywordtype">int</span> nfe=zone.nb_faces_elem();
<a name="l00317"></a>00317   <span class="keywordtype">int</span> nb_elem_tot=zone.nb_elem_tot();
<a name="l00318"></a>00318   <span class="keywordtype">int</span> nps=zone_VEF.<a class="code" href="classZone__VEF__PreP1b.html#ab469e7b0d67ddcc27e5cf16c3c85e8f4">numero_premier_sommet</a>();
<a name="l00319"></a>00319   <span class="keywordtype">int</span> elem,indice,face,comp,som;
<a name="l00320"></a>00320   <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> sigma(<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>);
<a name="l00321"></a>00321 
<a name="l00322"></a>00322   <span class="keywordtype">int</span> nb_face_diri=0;
<a name="l00323"></a>00323   <span class="keywordtype">double</span> coeff_som=1./(<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>*(<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>+1));
<a name="l00324"></a>00324   <span class="keywordtype">int</span> modif_traitement_diri=zone_VEF.<a class="code" href="classZone__VEF__PreP1b.html#aa2b3f7b3fcebdd13aa386170a840780b">get_modif_div_face_dirichlet</a>();
<a name="l00325"></a>00325   <span class="keywordtype">double</span> psc, signe;
<a name="l00326"></a>00326 
<a name="l00327"></a>00327   <span class="keyword">const</span> <a class="code" href="classZone__Cl__VEF.html">Zone_Cl_VEF</a>&amp; zcl=<a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classZone__Cl__VEF.html">Zone_Cl_VEF</a>,<a class="code" href="classOp__Div__VEF__Elem.html#a0cab6b48f5e099f0309caf38ac6c16ff">la_zcl_vef</a>.<a class="code" href="classRef__Zone__Cl__VEF.html#a0970d7253def65ad4f0c5ce1830fd243">valeur</a>());
<a name="l00328"></a>00328   <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a> indice_diri(<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>+1);
<a name="l00329"></a>00329   <span class="keywordflow">for</span>(elem=0; elem&lt;nb_elem_tot; elem++)
<a name="l00330"></a>00330     {
<a name="l00331"></a>00331       <span class="keywordflow">if</span> (modif_traitement_diri)
<a name="l00332"></a>00332         coeff_som=<a class="code" href="Op__Div__VEFP1B__Elem_8cpp.html#ac26bff605faf3f42dc28db1dee9323a7">calculer_coef_som</a>(elem,nb_face_diri,indice_diri,zcl,zone_VEF);
<a name="l00333"></a>00333 
<a name="l00334"></a>00334       sigma = 0;
<a name="l00335"></a>00335       <span class="keywordflow">for</span>(indice=0; indice&lt;nfe; indice++)
<a name="l00336"></a>00336         {
<a name="l00337"></a>00337           face = elem_faces(elem,indice);
<a name="l00338"></a>00338           <span class="keywordflow">for</span>(comp=0; comp&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; comp++)
<a name="l00339"></a>00339             {
<a name="l00340"></a>00340               sigma[comp]+=vit(face, comp);
<a name="l00341"></a>00341             }
<a name="l00342"></a>00342         }
<a name="l00343"></a>00343 <span class="comment">// on retire la contribution des faces dirichlets</span>
<a name="l00344"></a>00344       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> fdiri=0; fdiri&lt;nb_face_diri; fdiri++)
<a name="l00345"></a>00345         {
<a name="l00346"></a>00346           <span class="keywordtype">int</span> indice2=indice_diri[fdiri];
<a name="l00347"></a>00347           face = elem_faces(elem,indice2);
<a name="l00348"></a>00348           <span class="keywordflow">for</span>(comp=0; comp&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; comp++)
<a name="l00349"></a>00349             {
<a name="l00350"></a>00350               sigma[comp]-=vit(face, comp);
<a name="l00351"></a>00351             }
<a name="l00352"></a>00352         }
<a name="l00353"></a>00353       <span class="keywordflow">for</span>(indice=0; indice&lt;nfe; indice++)
<a name="l00354"></a>00354         {
<a name="l00355"></a>00355           som = nps+dom.<a class="code" href="classDomaine.html#a37cc657f1907d53b0d5a573da862af80">get_renum_som_perio</a>(som_elem(elem,indice));
<a name="l00356"></a>00356           face = elem_faces(elem,indice);
<a name="l00357"></a>00357           psc=0;
<a name="l00358"></a>00358           signe=1;
<a name="l00359"></a>00359           <span class="keywordflow">if</span>(elem!=face_voisins(face,0))
<a name="l00360"></a>00360             signe=-1;
<a name="l00361"></a>00361           <span class="keywordflow">for</span>(comp=0; comp&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; comp++)
<a name="l00362"></a>00362             {
<a name="l00363"></a>00363               psc+=sigma[comp]*face_normales(face,comp);
<a name="l00364"></a>00364             }
<a name="l00365"></a>00365           div(som)+=signe*coeff_som*psc;
<a name="l00366"></a>00366           <a class="code" href="classOp__Div__VEFP1B__Elem.html#a6477affcde67cba4ef601e5cdf688e9d">nb_degres_liberte</a>(som-nps)++;
<a name="l00367"></a>00367         }
<a name="l00368"></a>00368     }
<a name="l00369"></a>00369   <span class="keyword">const</span> <a class="code" href="classZone__Cl__VEF.html">Zone_Cl_VEF</a>&amp; zone_Cl_VEF = <a class="code" href="classOp__Div__VEF__Elem.html#a0cab6b48f5e099f0309caf38ac6c16ff">la_zcl_vef</a>.<a class="code" href="classRef__Zone__Cl__VEF.html#a0970d7253def65ad4f0c5ce1830fd243">valeur</a>();
<a name="l00370"></a>00370   <span class="keyword">const</span> <a class="code" href="classConds__lim.html">Conds_lim</a>&amp; les_cl = zone_Cl_VEF.<a class="code" href="classZone__Cl__dis__base.html#af75e0ed7786863e4d333bfb29d67c323" title="Renvoie la i-ieme condition aux limites. (version const)">les_conditions_limites</a>();
<a name="l00371"></a>00371   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; face_sommets = zone_VEF.<a class="code" href="classZone__VF.html#a298e73b18e17da55f421b1fb0879bd46" title="renvoie le numero du ieme sommet de la face num_face.">face_sommets</a>();
<a name="l00372"></a>00372   <span class="keywordtype">int</span> nb_bords =les_cl.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>();
<a name="l00373"></a>00373   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n_bord=0; n_bord&lt;nb_bords; n_bord++)
<a name="l00374"></a>00374     {
<a name="l00375"></a>00375       <span class="keyword">const</span> <a class="code" href="classCond__lim.html" title="classe Cond_lim Classe generique servant a representer n&#39;importe quelle classe derivee de la classe C...">Cond_lim</a>&amp; la_cl = zone_Cl_VEF.<a class="code" href="classZone__Cl__dis__base.html#af75e0ed7786863e4d333bfb29d67c323" title="Renvoie la i-ieme condition aux limites. (version const)">les_conditions_limites</a>(n_bord);
<a name="l00376"></a>00376       {
<a name="l00377"></a>00377         <span class="keyword">const</span> <a class="code" href="classFront__VF.html" title="class Front_VF">Front_VF</a>&amp; le_bord = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classFront__VF.html" title="class Front_VF">Front_VF</a>,la_cl.<a class="code" href="classCond__lim.html#a5b2d24809cee07727006a891d4ce8d22" title="Appel a l&#39;objet sous-jacent Renvoie la frontiere discretisee associee a la condition aux limites...">frontiere_dis</a>());
<a name="l00378"></a>00378         <span class="keywordtype">int</span> nb_faces_bord = le_bord.<a class="code" href="classFront__VF.html#a341e2fcb5117b96e745fd7078ba86bab" title="Nombre de faces reelles du bord.">nb_faces</a>();
<a name="l00379"></a>00379         <span class="keywordtype">int</span> nb_faces_bord_tot = le_bord.<a class="code" href="classFront__VF.html#aed4006d91bf2ef3af2b9f7933d863a09" title="Nombre de faces reelles et virtuelles du bord.">nb_faces_tot</a>();
<a name="l00380"></a>00380         assert(le_bord.<a class="code" href="classFront__VF.html#a341e2fcb5117b96e745fd7078ba86bab" title="Nombre de faces reelles du bord.">nb_faces</a>()==zone_VEF.<a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>().<a class="code" href="classZone.html#ac338b119d4b0bc4f510a223b9086fe5e">frontiere</a>(n_bord).<a class="code" href="classFrontiere.html#aa073fe9dbdddde59471ee7032b256aa2" title="Renvoie le nombre de faces de la frontiere.">nb_faces</a>());
<a name="l00381"></a>00381         <span class="keywordflow">if</span> (!<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classPeriodique.html" title="classe Periodique Cette classe represente une condition aux limites periodique. On peut specifier une...">Periodique</a>,la_cl.<a class="code" href="classDeriv__Cond__lim__base.html#a482c910c704f6f51065a8b7d25acf48a">valeur</a>()))
<a name="l00382"></a>00382           {
<a name="l00383"></a>00383             <span class="keywordtype">int</span> libre=1;
<a name="l00384"></a>00384             <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classDirichlet.html" title="classe Dirichlet Cette classe est la classe de base de la hierarchie des conditions aux limites de ty...">Dirichlet</a>,la_cl.<a class="code" href="classDeriv__Cond__lim__base.html#a482c910c704f6f51065a8b7d25acf48a">valeur</a>())
<a name="l00385"></a>00385                 ||<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classDirichlet__homogene.html" title="Classe Dirichlet_homogene Cette classe est la classe de base de la hierarchie des conditions aux limi...">Dirichlet_homogene</a>,la_cl.<a class="code" href="classDeriv__Cond__lim__base.html#a482c910c704f6f51065a8b7d25acf48a">valeur</a>())
<a name="l00386"></a>00386                 ||<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classDirichlet__entree__fluide.html" title="classe Dirichlet_entree_fluide Cette classe represente une condition aux limite imposant une grandeur...">Dirichlet_entree_fluide</a>,la_cl.<a class="code" href="classDeriv__Cond__lim__base.html#a482c910c704f6f51065a8b7d25acf48a">valeur</a>())
<a name="l00387"></a>00387                 ||<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classSymetrie.html" title="classe Symetrie Sur les faces de symetrie on a les proprietes suivantes: - composante normale de la v...">Symetrie</a>,la_cl.<a class="code" href="classDeriv__Cond__lim__base.html#a482c910c704f6f51065a8b7d25acf48a">valeur</a>()))
<a name="l00388"></a>00388               libre=0;
<a name="l00389"></a>00389 <span class="comment">// On boucle sur les faces de bord reelles et virtuelles</span>
<a name="l00390"></a>00390             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ind_face=0; ind_face&lt;nb_faces_bord_tot; ind_face++)
<a name="l00391"></a>00391               {
<a name="l00392"></a>00392                 face = le_bord.<a class="code" href="classFront__VF.html#a3402a19d7e54ed797d2b18e9a47ead1e" title="Renvoie le numero de face de la ieme face du bord.">num_face</a>(ind_face);
<a name="l00393"></a>00393                 <span class="keywordtype">double</span> flux = 0. ;
<a name="l00394"></a>00394                 <span class="keywordflow">for</span> (comp=0; comp&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; comp++)
<a name="l00395"></a>00395                   {
<a name="l00396"></a>00396                     flux += vit(face,comp) * face_normales(face,comp) ;
<a name="l00397"></a>00397                   }
<a name="l00398"></a>00398                 <span class="keywordflow">if</span> (ind_face&lt;nb_faces_bord) flux_b(face,0) = flux;
<a name="l00399"></a>00399                 flux*=1./<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>;
<a name="l00400"></a>00400                 <span class="keywordflow">for</span>(indice=0; indice&lt;(nfe-1); indice++)
<a name="l00401"></a>00401                   {
<a name="l00402"></a>00402                     som=dom.<a class="code" href="classDomaine.html#a37cc657f1907d53b0d5a573da862af80">get_renum_som_perio</a>(face_sommets(face,indice));
<a name="l00403"></a>00403                     div(nps+som)+=flux;
<a name="l00404"></a>00404                     <span class="keywordflow">if</span> (libre) <a class="code" href="classOp__Div__VEFP1B__Elem.html#a6477affcde67cba4ef601e5cdf688e9d">nb_degres_liberte</a>(som)++;
<a name="l00405"></a>00405                   }
<a name="l00406"></a>00406               }
<a name="l00407"></a>00407           }
<a name="l00408"></a>00408         <span class="keywordflow">else</span>
<a name="l00409"></a>00409           {
<a name="l00410"></a>00410             <span class="keyword">const</span> <a class="code" href="classPeriodique.html" title="classe Periodique Cette classe represente une condition aux limites periodique. On peut specifier une...">Periodique</a>&amp; la_cl_perio = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classPeriodique.html" title="classe Periodique Cette classe represente une condition aux limites periodique. On peut specifier une...">Periodique</a>,la_cl.<a class="code" href="classDeriv__Cond__lim__base.html#a482c910c704f6f51065a8b7d25acf48a">valeur</a>());
<a name="l00411"></a>00411 <span class="comment">// On boucle sur les faces de bord reelles et virtuelles</span>
<a name="l00412"></a>00412             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ind_face=0; ind_face&lt;nb_faces_bord_tot; ind_face++)
<a name="l00413"></a>00413               {
<a name="l00414"></a>00414                 face = le_bord.<a class="code" href="classFront__VF.html#a3402a19d7e54ed797d2b18e9a47ead1e" title="Renvoie le numero de face de la ieme face du bord.">num_face</a>(ind_face);
<a name="l00415"></a>00415                 <span class="keywordtype">int</span> <a class="code" href="AssembleurPP1BUtil_8cpp.html#a3e374d53ebc7860e1c2f0b7906f2936d">face_associee</a> = le_bord.<a class="code" href="classFront__VF.html#a3402a19d7e54ed797d2b18e9a47ead1e" title="Renvoie le numero de face de la ieme face du bord.">num_face</a>(la_cl_perio.<a class="code" href="classPeriodique.html#a207b86556f199a63ea059b841851ca6a">face_associee</a>(ind_face));
<a name="l00416"></a>00416                 <span class="keywordtype">double</span> flux = 0. ;
<a name="l00417"></a>00417                 <span class="keywordtype">double</span> flux_perio = 0. ;
<a name="l00418"></a>00418                 <span class="keywordflow">for</span> (comp=0; comp&lt;<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>; comp++)
<a name="l00419"></a>00419                   {
<a name="l00420"></a>00420                     flux += vit(face,comp) * face_normales(face,comp) ;
<a name="l00421"></a>00421                     flux_perio += vit(face_associee,comp) * face_normales(face_associee,comp) ;
<a name="l00422"></a>00422                   }
<a name="l00423"></a>00423                 <span class="keywordflow">if</span> (ind_face&lt;(nb_faces_bord/2))
<a name="l00424"></a>00424                   {
<a name="l00425"></a>00425                     flux_b(face,0) = -flux;
<a name="l00426"></a>00426                     flux_b(face_associee,0) = flux_perio;
<a name="l00427"></a>00427                   }
<a name="l00428"></a>00428               }
<a name="l00429"></a>00429           }
<a name="l00430"></a>00430       }
<a name="l00431"></a>00431     }
<a name="l00432"></a>00432   <span class="keywordflow">return</span> div;
<a name="l00433"></a>00433 }
<a name="l00434"></a>00434 
<a name="l00435"></a><a class="code" href="classOp__Div__VEFP1B__Elem.html#a1c420cf5e79690484ece98f88d2a425f">00435</a> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; <a class="code" href="classOp__Div__VEFP1B__Elem.html#a1c420cf5e79690484ece98f88d2a425f">Op_Div_VEFP1B_Elem::ajouter_aretes</a>(<span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; vit, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; div)<span class="keyword"> const</span>
<a name="l00436"></a>00436 <span class="keyword"></span>{
<a name="l00437"></a>00437   <span class="keyword">const</span> <a class="code" href="classZone__VEF__PreP1b.html">Zone_VEF_PreP1b</a>&amp; zone_VEF = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classZone__VEF__PreP1b.html">Zone_VEF_PreP1b</a>,<a class="code" href="classOp__Div__VEF__Elem.html#a0fb0419078a6e4f7f276ff20c7204ad6">la_zone_vef</a>.<a class="code" href="classRef__Zone__VEF.html#aafd9a5ee1a76f290c9c6b5447b0c8d30">valeur</a>());
<a name="l00438"></a>00438   assert(zone_VEF.<a class="code" href="classZone__VEF__PreP1b.html#a9d02e2431efb6e75c3d733ff06f89549">get_alphaA</a>());
<a name="l00439"></a>00439   <span class="keyword">const</span> <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone = zone_VEF.<a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>();
<a name="l00440"></a>00440   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; face_normales = zone_VEF.<a class="code" href="classZone__VEF.html#a5742d75972e4846bf9fbb6ed5715053e">face_normales</a>();
<a name="l00441"></a>00441   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; som_elem=zone.les_elems();
<a name="l00442"></a>00442   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; elem_faces=zone_VEF.<a class="code" href="classZone__VF.html#a067e462dcd3ab92b0f6d945b19e4eb37" title="renvoie le numero de le ieme face de la maille num_elem la facon dont ces faces sont numerotees est l...">elem_faces</a>();
<a name="l00443"></a>00443   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; face_voisins=zone_VEF.<a class="code" href="classZone__VF.html#a49d4322f5585a8fa95748ca785b70702" title="renvoie l&#39;element voisin de numface dans la direction i. i=0 : dans le sens oppose de l&#39;axe orthogona...">face_voisins</a>();
<a name="l00444"></a>00444   <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; renum_arete_perio=zone_VEF.<a class="code" href="classZone__VEF__PreP1b.html#a43767f8684512d1ee950dc07eea76c5b">get_renum_arete_perio</a>();
<a name="l00445"></a>00445   <span class="keyword">const</span> <a class="code" href="classArrOfInt.html" title="Represente un tableau d&#39;elements de type int. L&#39;etat du tableau est caracterise par la valeur de p_ e...">ArrOfInt</a>&amp; ok_arete=zone_VEF.<a class="code" href="classZone__VEF__PreP1b.html#a83771f784d487e346b2ef22a389472a2">get_ok_arete</a>();
<a name="l00446"></a>00446   <span class="keywordtype">int</span> npa=zone_VEF.<a class="code" href="classZone__VEF__PreP1b.html#aa0033e533851a80e958050a0b892e9a8">numero_premiere_arete</a>();
<a name="l00447"></a>00447   <span class="keywordtype">int</span> nb_elem_tot=zone.nb_elem_tot();
<a name="l00448"></a>00448   <span class="keywordtype">int</span> elem,comp;
<a name="l00449"></a>00449   <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> sigma(<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">dimension</a>);
<a name="l00450"></a>00450 
<a name="l00451"></a>00451   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; aretes_som=zone_VEF.<a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>().<a class="code" href="classZone.html#affa60690e1b372fa4c01d6088267dbe4" title="renvoie le tableau de connectivite aretes/sommets.">aretes_som</a>();
<a name="l00452"></a>00452   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; elem_aretes=zone_VEF.<a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>().<a class="code" href="classZone.html#a1e1e86ef5b088c4d33d42cd38a967b4a" title="renvoie le numero de la jeme arete du ieme element.">elem_aretes</a>();
<a name="l00453"></a>00453   <span class="keywordflow">for</span>(elem=0; elem&lt;nb_elem_tot; elem++)
<a name="l00454"></a>00454     {
<a name="l00455"></a>00455       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> isom=0; isom&lt;3; isom++)
<a name="l00456"></a>00456         {
<a name="l00457"></a>00457           <span class="keywordtype">int</span> somi = som_elem(elem,isom);
<a name="l00458"></a>00458           <span class="keywordtype">int</span> facei = elem_faces(elem,isom);
<a name="l00459"></a>00459           <span class="keywordtype">double</span> signei=1.;
<a name="l00460"></a>00460           <span class="keywordflow">if</span> (face_voisins(facei,0) != elem)
<a name="l00461"></a>00461             signei=-1.;
<a name="l00462"></a>00462           <span class="keywordflow">for</span>(<span class="keywordtype">int</span> jsom=isom+1; jsom&lt;4; jsom++)
<a name="l00463"></a>00463             {
<a name="l00464"></a>00464               <span class="keywordtype">int</span> somj = som_elem(elem,jsom);
<a name="l00465"></a>00465               <span class="keywordtype">int</span> facej = elem_faces(elem,jsom);
<a name="l00466"></a>00466               <span class="keywordtype">double</span> signej=1.;
<a name="l00467"></a>00467               <span class="keywordflow">if</span> (face_voisins(facej,0) != elem)
<a name="l00468"></a>00468                 signej=-1.;
<a name="l00469"></a>00469               <span class="keywordtype">int</span> arete = renum_arete_perio(<a class="code" href="Op__Div__VEFP1B__Elem_8cpp.html#a43ddbecfeb5d72a0ccf918858acb528c">chercher_arete</a>(elem, somi, somj,
<a name="l00470"></a>00470                                                            elem_aretes, aretes_som));
<a name="l00471"></a>00471               <span class="keywordflow">if</span>(ok_arete(arete))
<a name="l00472"></a>00472                 {
<a name="l00473"></a>00473                   <span class="keywordtype">int</span> niinij=0;
<a name="l00474"></a>00474                   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ksom=0; ksom&lt;4; ksom++)
<a name="l00475"></a>00475                     {
<a name="l00476"></a>00476                       <span class="keywordflow">if</span>((ksom==isom)||(ksom==jsom))
<a name="l00477"></a>00477                         {
<a name="l00478"></a>00478                           <span class="keywordflow">if</span>(niinij==ksom)
<a name="l00479"></a>00479                             niinij++;
<a name="l00480"></a>00480                           <span class="keywordtype">double</span> psc=0;
<a name="l00481"></a>00481                           <span class="keywordflow">for</span>(comp=0; comp&lt;3; comp++)
<a name="l00482"></a>00482                             psc+=(signei*face_normales(facei,comp)+
<a name="l00483"></a>00483                                   signej*face_normales(facej,comp))
<a name="l00484"></a>00484                                  *vit(elem_faces(elem,ksom),comp);
<a name="l00485"></a>00485                           div(npa+arete)-=1./15.*psc;
<a name="l00486"></a>00486                         }
<a name="l00487"></a>00487                       <span class="keywordflow">else</span>
<a name="l00488"></a>00488                         {
<a name="l00489"></a>00489                           <span class="keywordflow">if</span>(niinij==ksom)
<a name="l00490"></a>00490                             niinij++;
<a name="l00491"></a>00491                           <span class="keywordflow">while</span>((niinij==jsom)||(niinij==isom))
<a name="l00492"></a>00492                             niinij++;
<a name="l00493"></a>00493                           assert(niinij&lt;4);
<a name="l00494"></a>00494                           assert(niinij!=isom);
<a name="l00495"></a>00495                           assert(niinij!=jsom);
<a name="l00496"></a>00496                           assert(niinij!=ksom);
<a name="l00497"></a>00497                           <span class="keywordtype">int</span> facek = elem_faces(elem,niinij);
<a name="l00498"></a>00498                           <span class="keywordtype">double</span> signek=1.;
<a name="l00499"></a>00499                           <span class="keywordflow">if</span> (face_voisins(facek,0) != elem)
<a name="l00500"></a>00500                             signek=-1.;
<a name="l00501"></a>00501                           <span class="keywordtype">double</span> psc=0;
<a name="l00502"></a>00502                           <span class="keywordflow">for</span>(comp=0; comp&lt;3; comp++)
<a name="l00503"></a>00503                             psc+=signek*face_normales(facek,comp)
<a name="l00504"></a>00504                                  *vit(elem_faces(elem,ksom),comp);
<a name="l00505"></a>00505                           div(npa+arete)-=2./15.*psc;
<a name="l00506"></a>00506                           niinij=ksom;
<a name="l00507"></a>00507                         }
<a name="l00508"></a>00508                     }
<a name="l00509"></a>00509                 }
<a name="l00510"></a>00510             }
<a name="l00511"></a>00511         }
<a name="l00512"></a>00512     }
<a name="l00513"></a>00513   <span class="keywordflow">return</span> div;
<a name="l00514"></a>00514 }
<a name="l00515"></a>00515 
<a name="l00516"></a>00516 <span class="comment">// static void verifier_vit(const Zone_Cl_VEF&amp; zone_Cl_VEF,</span>
<a name="l00517"></a>00517 <span class="comment">// const Zone_VEF&amp; zone_VEF,</span>
<a name="l00518"></a>00518 <span class="comment">// const DoubleTab&amp; vit)</span>
<a name="l00519"></a>00519 <span class="comment">// {</span>
<a name="l00520"></a>00520 <span class="comment">// const DoubleTab&amp; face_normales = zone_VEF.face_normales();</span>
<a name="l00521"></a>00521 <span class="comment">// const Conds_lim&amp; les_cl = zone_Cl_VEF.les_conditions_limites();</span>
<a name="l00522"></a>00522 <span class="comment">// int nb_bords =les_cl.size();</span>
<a name="l00523"></a>00523 <span class="comment">// for (int n_bord=0; n_bord&lt;nb_bords; n_bord++)</span>
<a name="l00524"></a>00524 <span class="comment">// {</span>
<a name="l00525"></a>00525 <span class="comment">// const Cond_lim&amp; la_cl = zone_Cl_VEF.les_conditions_limites(n_bord);</span>
<a name="l00526"></a>00526 <span class="comment">// {</span>
<a name="l00527"></a>00527 <span class="comment">// if (sub_type(Periodique,la_cl.valeur()))</span>
<a name="l00528"></a>00528 <span class="comment">// {</span>
<a name="l00529"></a>00529 <span class="comment">// const Front_VF&amp; le_bord = ref_cast(Front_VF,la_cl.frontiere_dis());</span>
<a name="l00530"></a>00530 <span class="comment">// const Periodique&amp; la_cl_perio = ref_cast(Periodique,</span>
<a name="l00531"></a>00531 <span class="comment">// la_cl.valeur());</span>
<a name="l00532"></a>00532 <span class="comment">// int num1 = le_bord.num_premiere_face();</span>
<a name="l00533"></a>00533 <span class="comment">// int num2 = num1 + le_bord.nb_faces();</span>
<a name="l00534"></a>00534 <span class="comment">// for (int face=num1; face&lt;num2; face++)</span>
<a name="l00535"></a>00535 <span class="comment">// {</span>
<a name="l00536"></a>00536 <span class="comment">// int face_associee=num1+la_cl_perio.face_associee(face-num1);</span>
<a name="l00537"></a>00537 <span class="comment">// for (int comp=0; comp&lt;Objet_U::dimension; comp++)</span>
<a name="l00538"></a>00538 <span class="comment">// {</span>
<a name="l00539"></a>00539 <span class="comment">// if(dabs(vit(face,comp)-vit(face_associee,comp))&gt;1.e-20)</span>
<a name="l00540"></a>00540 <span class="comment">// Cout &lt;&lt; &quot;ERREUR PERIO&quot; &lt;&lt; finl;</span>
<a name="l00541"></a>00541 <span class="comment">// }</span>
<a name="l00542"></a>00542 <span class="comment">// }</span>
<a name="l00543"></a>00543 <span class="comment">// }</span>
<a name="l00544"></a>00544 <span class="comment">// else if (sub_type(Symetrie,la_cl.valeur()))</span>
<a name="l00545"></a>00545 <span class="comment">// {</span>
<a name="l00546"></a>00546 <span class="comment">// DoubleTab&amp; inco = (DoubleTab&amp;) vit;</span>
<a name="l00547"></a>00547 <span class="comment">// const Front_VF&amp; le_bord = ref_cast(Front_VF,la_cl.frontiere_dis());</span>
<a name="l00548"></a>00548 <span class="comment">// int num1 = le_bord.num_premiere_face();</span>
<a name="l00549"></a>00549 <span class="comment">// int num2 = num1 + le_bord.nb_faces();</span>
<a name="l00550"></a>00550 <span class="comment">// for (int face=num1; face&lt;num2; face++)</span>
<a name="l00551"></a>00551 <span class="comment">// {</span>
<a name="l00552"></a>00552 <span class="comment">// double surf=0;</span>
<a name="l00553"></a>00553 <span class="comment">// double flux=0;</span>
<a name="l00554"></a>00554 <span class="comment">// double face_n;</span>
<a name="l00555"></a>00555 <span class="comment">// for (int comp=0; comp&lt;Objet_U::dimension; comp++)</span>
<a name="l00556"></a>00556 <span class="comment">// {</span>
<a name="l00557"></a>00557 <span class="comment">// face_n = face_normales(face,comp);</span>
<a name="l00558"></a>00558 <span class="comment">// flux += vit(face,comp)*face_n;</span>
<a name="l00559"></a>00559 <span class="comment">// surf += face_n*face_n;</span>
<a name="l00560"></a>00560 <span class="comment">// }</span>
<a name="l00561"></a>00561 <span class="comment">// //flux_b(face,0) = flux;</span>
<a name="l00562"></a>00562 <span class="comment">// flux /= surf;</span>
<a name="l00563"></a>00563 <span class="comment">// if(dabs(flux)&gt;1.e-12)</span>
<a name="l00564"></a>00564 <span class="comment">// Cout &lt;&lt; &quot;Erreur Symetrie!! &quot; &lt;&lt; flux &lt;&lt; finl;</span>
<a name="l00565"></a>00565 <span class="comment">// for (int comp=0; comp&lt;Objet_U::dimension; comp++)</span>
<a name="l00566"></a>00566 <span class="comment">// inco(face,comp) -= flux * face_normales(face,comp);</span>
<a name="l00567"></a>00567 <span class="comment">// }</span>
<a name="l00568"></a>00568 <span class="comment">// }</span>
<a name="l00569"></a>00569 <span class="comment">// }</span>
<a name="l00570"></a>00570 <span class="comment">// }</span>
<a name="l00571"></a>00571 <span class="comment">// };</span>
<a name="l00572"></a>00572 
<a name="l00573"></a><a class="code" href="classOp__Div__VEFP1B__Elem.html#a9f7c58d682438fd50cf4213d82c55b5d">00573</a> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; <a class="code" href="classOp__Div__VEFP1B__Elem.html#a9f7c58d682438fd50cf4213d82c55b5d">Op_Div_VEFP1B_Elem::ajouter</a>(<span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; vitesse_face_absolue, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; div)<span class="keyword"> const</span>
<a name="l00574"></a>00574 <span class="keyword"></span>{
<a name="l00575"></a>00575   <span class="keyword">const</span> <a class="code" href="classZone__VEF__PreP1b.html">Zone_VEF_PreP1b</a>&amp; zone_VEF = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classZone__VEF__PreP1b.html">Zone_VEF_PreP1b</a>,<a class="code" href="classOp__Div__VEF__Elem.html#a0fb0419078a6e4f7f276ff20c7204ad6">la_zone_vef</a>.<a class="code" href="classRef__Zone__VEF.html#aafd9a5ee1a76f290c9c6b5447b0c8d30">valeur</a>());
<a name="l00576"></a>00576   <span class="keyword">const</span> <a class="code" href="classZone__Cl__VEF.html">Zone_Cl_VEF</a>&amp; zone_Cl_VEF = <a class="code" href="classOp__Div__VEF__Elem.html#a0cab6b48f5e099f0309caf38ac6c16ff">la_zcl_vef</a>.<a class="code" href="classRef__Zone__Cl__VEF.html#a0970d7253def65ad4f0c5ce1830fd243">valeur</a>();
<a name="l00577"></a>00577 <span class="comment">// Quelques verifications:</span>
<a name="l00578"></a>00578 <span class="comment">// L&#39;espace virtuel de vitesse_face_absolue doit etre a jour (Le test est fait si check_enabled==1)</span>
<a name="l00579"></a>00579   <a class="code" href="Check__espace__virtuel_8cpp.html#a2ea8fcf12c28d0454bdc4126f8c4b186" title="en mode comm_check_enabled(), verifie si l&#39;espace virtuel du vecteur est a jour, si ce n&#39;est pas le c...">assert_espace_virtuel_vect</a>(vitesse_face_absolue);
<a name="l00580"></a>00580 <span class="comment">// On s&#39;en fiche de l&#39;espace virtuel de div a l&#39;entree, mais on fait += dessus.</span>
<a name="l00581"></a>00581   <a class="code" href="Check__espace__virtuel_8cpp.html#adee035ac60c0a14f58d5473969b5a976" title="Appelle remplir_items_non_calcules() si on est en mode comm_check_enabled() ou en mode debug (NDEBUG ...">assert_invalide_items_non_calcules</a>(div, 0.);
<a name="l00582"></a>00582 
<a name="l00583"></a>00583 <span class="preprocessor">#ifndef NDEBUG</span>
<a name="l00584"></a>00584 <span class="preprocessor"></span><span class="comment">// On s&#39;assure que la periodicite est respectee sur vitesse_face_absolue (Voir FA814)</span>
<a name="l00585"></a>00585   <span class="keywordtype">int</span> nb_comp=vitesse_face_absolue.<a class="code" href="classDoubleTab.html#ac3805e2637a3b880ba2d3e650c69dac4" title="Returns one of the &quot;real&quot; dimensions of the multi-dimensionnal array, as defined by: dimension(0) = s...">dimension</a>(1);
<a name="l00586"></a>00586   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n_bord=0; n_bord&lt;zone_VEF.<a class="code" href="classZone__dis__base.html#af22167d614644f55591a29c77eb1c009">nb_front_Cl</a>(); n_bord++)
<a name="l00587"></a>00587     {
<a name="l00588"></a>00588       <span class="keyword">const</span> <a class="code" href="classCond__lim.html" title="classe Cond_lim Classe generique servant a representer n&#39;importe quelle classe derivee de la classe C...">Cond_lim</a>&amp; la_cl = zone_Cl_VEF.les_conditions_limites(n_bord);
<a name="l00589"></a>00589       <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classPeriodique.html" title="classe Periodique Cette classe represente une condition aux limites periodique. On peut specifier une...">Periodique</a>,la_cl.<a class="code" href="classDeriv__Cond__lim__base.html#a482c910c704f6f51065a8b7d25acf48a">valeur</a>()))
<a name="l00590"></a>00590         {
<a name="l00591"></a>00591           <span class="keyword">const</span> <a class="code" href="classPeriodique.html" title="classe Periodique Cette classe represente une condition aux limites periodique. On peut specifier une...">Periodique</a>&amp; la_cl_perio = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classPeriodique.html" title="classe Periodique Cette classe represente une condition aux limites periodique. On peut specifier une...">Periodique</a>,la_cl.<a class="code" href="classDeriv__Cond__lim__base.html#a482c910c704f6f51065a8b7d25acf48a">valeur</a>());
<a name="l00592"></a>00592           <span class="keyword">const</span> <a class="code" href="classFront__VF.html" title="class Front_VF">Front_VF</a>&amp; le_bord = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classFront__VF.html" title="class Front_VF">Front_VF</a>,la_cl.<a class="code" href="classCond__lim.html#a5b2d24809cee07727006a891d4ce8d22" title="Appel a l&#39;objet sous-jacent Renvoie la frontiere discretisee associee a la condition aux limites...">frontiere_dis</a>());
<a name="l00593"></a>00593           <span class="keywordtype">int</span> nb_faces_bord=le_bord.nb_faces();
<a name="l00594"></a>00594           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ind_face=0; ind_face&lt;nb_faces_bord; ind_face++)
<a name="l00595"></a>00595             {
<a name="l00596"></a>00596               <span class="keywordtype">int</span> ind_face_associee = la_cl_perio.<a class="code" href="classPeriodique.html#a207b86556f199a63ea059b841851ca6a">face_associee</a>(ind_face);
<a name="l00597"></a>00597               <span class="keywordtype">int</span> face = le_bord.num_face(ind_face);
<a name="l00598"></a>00598               <span class="keywordtype">int</span> <a class="code" href="AssembleurPP1BUtil_8cpp.html#a3e374d53ebc7860e1c2f0b7906f2936d">face_associee</a> = le_bord.num_face(ind_face_associee);
<a name="l00599"></a>00599 <span class="comment">// PL : test a 1.e-4 car certains cas ne respectent pas strictement (lente derive?)</span>
<a name="l00600"></a>00600               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> comp=0; comp&lt;nb_comp; comp++)
<a name="l00601"></a>00601                 <span class="keywordflow">if</span> (!<a class="code" href="Double_8h.html#ac86f5f350b0f95fd8c34b0ac8d720f6f">est_egal</a>(vitesse_face_absolue(face, comp),vitesse_face_absolue(face_associee, comp),1.e-4))
<a name="l00602"></a>00602                   {
<a name="l00603"></a>00603                     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;vit1(&quot;</span>&lt;&lt;face&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;comp&lt;&lt;<span class="stringliteral">&quot;)=&quot;</span> &lt;&lt; vitesse_face_absolue(face, comp) &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00604"></a>00604                     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;vit2(&quot;</span>&lt;&lt;face_associee&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;comp&lt;&lt;<span class="stringliteral">&quot;)=&quot;</span> &lt;&lt; vitesse_face_absolue(face_associee, comp) &lt;&lt; finl;
<a name="l00605"></a>00605                     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Delta=&quot;</span> &lt;&lt; vitesse_face_absolue(face, comp)-vitesse_face_absolue(face_associee, comp) &lt;&lt; finl;
<a name="l00606"></a>00606                     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Periodic boundary condition is not correct in Op_Div_VEFP1B_Elem::ajouter&quot;</span> &lt;&lt; finl;
<a name="l00607"></a>00607                     <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Contact TRUST support.&quot;</span> &lt;&lt; finl;
<a name="l00608"></a>00608                     <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00609"></a>00609                   }
<a name="l00610"></a>00610             }<span class="comment">//!&lt; for face</span>
<a name="l00611"></a>00611 <span class="comment"></span>        }<span class="comment">//!&lt; sub_type Perio</span>
<a name="l00612"></a>00612 <span class="comment"></span>    }
<a name="l00613"></a>00613 <span class="preprocessor">#endif</span>
<a name="l00614"></a>00614 <span class="preprocessor"></span>  <span class="keyword">const</span> <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; porosite_face = zone_VEF.<a class="code" href="classZone__VF.html#ad9d74d1d9da9f50ab26768dbbca7711b">porosite_face</a>();
<a name="l00615"></a>00615   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a> phi_vitesse_face_;
<a name="l00616"></a>00616   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; vit=<a class="code" href="Porosites__champ_8cpp.html#a2340e7d73d0f9d34926d012fe1b1d884" title="renvoit le tableau res, res=org si flag=0, res= porosite*org sinon attention ne pas modifier res car ...">modif_par_porosite_si_flag</a>(vitesse_face_absolue,phi_vitesse_face_,1,porosite_face);
<a name="l00617"></a>00617 
<a name="l00618"></a>00618 <span class="comment">// Tableau des degres de liberte</span>
<a name="l00619"></a>00619   <span class="keywordtype">int</span> nps=zone_VEF.<a class="code" href="classZone__VEF__PreP1b.html#ab469e7b0d67ddcc27e5cf16c3c85e8f4">numero_premier_sommet</a>();
<a name="l00620"></a>00620   <a class="code" href="classOp__Div__VEFP1B__Elem.html#a6477affcde67cba4ef601e5cdf688e9d">nb_degres_liberte</a>.<a class="code" href="classIntVect.html#a5900779fd9a3f9a82c68007a42b87d98" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(zone_VEF.<a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>().<a class="code" href="classZone.html#a01ed67af826d6045ef4eacfb87a663e8" title="Renvoie le nombre total de sommets de la zone. i.e. le nombre de sommets reels et virtuels sur le pro...">nb_som_tot</a>());
<a name="l00621"></a>00621   <a class="code" href="classOp__Div__VEFP1B__Elem.html#a6477affcde67cba4ef601e5cdf688e9d">nb_degres_liberte</a>=-1;
<a name="l00622"></a>00622 
<a name="l00623"></a>00623   <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; flux_b = <a class="code" href="classOperateur__base.html#a451f51b41518ddbc0d3f586a8177d319" title="Tableau contenant les flux sur les bords de l&#39;operateur.">flux_bords_</a>;
<a name="l00624"></a>00624   flux_b.<a class="code" href="classDoubleTab.html#ae83b4d31205c53d9c8d2b43da178ce75" title="Change la taille du vecteur (identique a resize_array() pour le traitement des anciennes valeurs et d...">resize</a>(zone_VEF.<a class="code" href="classZone__VF.html#a8815e2276637c0db23868f043dc43e58" title="renvoie le nombre de faces sur lesquelles sont appliquees les conditions limites : bords...">nb_faces_bord</a>(),1);
<a name="l00625"></a>00625   flux_b = 0.;
<a name="l00626"></a>00626 
<a name="l00627"></a>00627   <span class="keyword">static</span> <span class="keywordtype">int</span> init=1;
<a name="l00628"></a>00628   <span class="keywordflow">if</span>(!init)<a class="code" href="Op__Div__VEFP1B__Elem_8cpp.html#a45261662b3b88d5db461b3fc99246e5a"> ::verifier</a>(*<span class="keyword">this</span>, init, zone_VEF, vit, div);
<a name="l00629"></a>00629   <span class="keywordflow">if</span>(zone_VEF.get_alphaE()) <a class="code" href="classOp__Div__VEFP1B__Elem.html#a170699aa293b7f92b38c312afe34dec9">ajouter_elem</a>(vit, div);
<a name="l00630"></a>00630   <span class="keywordflow">if</span>(zone_VEF.get_alphaS()) <a class="code" href="classOp__Div__VEFP1B__Elem.html#a319b23f45b01481f30b1cf0bed47c4a5">ajouter_som</a>(vit, div, flux_b);
<a name="l00631"></a>00631   <span class="keywordflow">if</span>(zone_VEF.get_alphaA()) <a class="code" href="classOp__Div__VEFP1B__Elem.html#a1c420cf5e79690484ece98f88d2a425f">ajouter_aretes</a>(vit, div);
<a name="l00632"></a>00632 
<a name="l00633"></a>00633 <span class="comment">// correction de de div u si pression sommet imposee de maniere forte</span>
<a name="l00634"></a>00634   <span class="keywordflow">if</span> ((zone_VEF.get_alphaS())&amp;&amp;((zone_VEF.get_cl_pression_sommet_faible()==0)))
<a name="l00635"></a>00635     {
<a name="l00636"></a>00636       <span class="keyword">const</span> <a class="code" href="classConds__lim.html">Conds_lim</a>&amp; les_cl = zone_Cl_VEF.les_conditions_limites();
<a name="l00637"></a>00637       <span class="keywordtype">int</span> nb_bords =les_cl.<a class="code" href="classvect__impl.html#a78155bfbd6b61f4710b9830641ed1694">size</a>();
<a name="l00638"></a>00638       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n_bord=0; n_bord&lt;nb_bords; n_bord++)
<a name="l00639"></a>00639         {
<a name="l00640"></a>00640           <span class="keyword">const</span> <a class="code" href="classCond__lim.html" title="classe Cond_lim Classe generique servant a representer n&#39;importe quelle classe derivee de la classe C...">Cond_lim</a>&amp; la_cl = les_cl[n_bord];
<a name="l00641"></a>00641           <span class="keywordflow">if</span> (<a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classNeumann.html" title="Classe Neumann Cette classe est la classe de base de la hierarchie des conditions aux limites de type...">Neumann</a>,la_cl.<a class="code" href="classDeriv__Cond__lim__base.html#a482c910c704f6f51065a8b7d25acf48a">valeur</a>()) || <a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classNeumann__val__ext.html" title="Classe Neumann_val_ext Cette classe est la classe de base de la hierarchie des conditions aux limites...">Neumann_val_ext</a>,la_cl.<a class="code" href="classDeriv__Cond__lim__base.html#a482c910c704f6f51065a8b7d25acf48a">valeur</a>()))
<a name="l00642"></a>00642             {
<a name="l00643"></a>00643               <span class="keyword">const</span> <a class="code" href="classFront__VF.html" title="class Front_VF">Front_VF</a>&amp; la_front_dis = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classFront__VF.html" title="class Front_VF">Front_VF</a>,la_cl.<a class="code" href="classCond__lim.html#a5b2d24809cee07727006a891d4ce8d22" title="Appel a l&#39;objet sous-jacent Renvoie la frontiere discretisee associee a la condition aux limites...">frontiere_dis</a>());
<a name="l00644"></a>00644               <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; faces_sommets = zone_VEF.face_sommets();
<a name="l00645"></a>00645               <span class="keywordtype">int</span> nb_faces=la_front_dis.<a class="code" href="classFront__VF.html#aed4006d91bf2ef3af2b9f7933d863a09" title="Nombre de faces reelles et virtuelles du bord.">nb_faces_tot</a>();
<a name="l00646"></a>00646               <span class="keywordtype">int</span> nsf=0;
<a name="l00647"></a>00647               <span class="keywordflow">if</span>(nb_faces!=0)
<a name="l00648"></a>00648                 nsf=faces_sommets.dimension(1);
<a name="l00649"></a>00649 
<a name="l00650"></a>00650               <span class="keywordtype">int</span> num2 = nb_faces;
<a name="l00651"></a>00651               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ind_face=0; ind_face&lt;num2; ind_face++)
<a name="l00652"></a>00652                 {
<a name="l00653"></a>00653                   <span class="keywordtype">int</span> face=la_front_dis.<a class="code" href="classFront__VF.html#a3402a19d7e54ed797d2b18e9a47ead1e" title="Renvoie le numero de face de la ieme face du bord.">num_face</a>(ind_face);
<a name="l00654"></a>00654                   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> som=0; som&lt;nsf; som++)
<a name="l00655"></a>00655                     {
<a name="l00656"></a>00656                       <span class="keywordtype">int</span> som1=faces_sommets(face, som);
<a name="l00657"></a>00657                       div(nps+som1) = 0.;
<a name="l00658"></a>00658                     }
<a name="l00659"></a>00659                 }
<a name="l00660"></a>00660             }
<a name="l00661"></a>00661         }
<a name="l00662"></a>00662     }
<a name="l00663"></a>00663   <a class="code" href="classOp__Div__VEFP1B__Elem.html#aad9cd210d49e59abe4018c0a70ccddab">degres_liberte</a>();
<a name="l00664"></a>00664 <span class="comment">// Optimisation, pas necessaire:</span>
<a name="l00665"></a>00665 <span class="comment">// div.echange_espace_virtuel();</span>
<a name="l00666"></a>00666   <span class="keywordflow">return</span> div;
<a name="l00667"></a>00667 }
<a name="l00668"></a>00668 
<a name="l00669"></a>00669 <span class="preprocessor">#ifdef VersionP1</span>
<a name="l00670"></a>00670 <span class="preprocessor"></span><span class="keywordtype">double</span> tiers=1./3.;
<a name="l00671"></a>00671 <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; aretes_som=zone_VEF.zone().aretes_som();
<a name="l00672"></a>00672 <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; elem_aretes=zone_VEF.zone().elem_aretes();
<a name="l00673"></a>00673 <a class="code" href="classArrOfDouble.html" title="Represente un tableau d&#39;elements de type double. L&#39;etat du tableau est caracterise par la valeur de p...">ArrOfDouble</a> gradK(3);
<a name="l00674"></a>00674 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> isom=0; isom&lt;3; isom++)
<a name="l00675"></a>00675   {
<a name="l00676"></a>00676     <span class="keywordtype">int</span> somi = som_elem(elem,isom);
<a name="l00677"></a>00677     <span class="keywordtype">int</span> facei = elem_faces(elem,isom);
<a name="l00678"></a>00678     <span class="keywordtype">double</span> signei=1.;
<a name="l00679"></a>00679     <span class="keywordflow">if</span> (face_voisins(facei,0) != elem)
<a name="l00680"></a>00680       signei=-1.;
<a name="l00681"></a>00681     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> jsom=isom+1; jsom&lt;4; jsom++)
<a name="l00682"></a>00682       {
<a name="l00683"></a>00683         <span class="keywordtype">int</span> somj = som_elem(elem,jsom);
<a name="l00684"></a>00684         <span class="keywordtype">int</span> facej = elem_faces(elem,jsom);
<a name="l00685"></a>00685         <span class="keywordtype">double</span> signej=1.;
<a name="l00686"></a>00686         <span class="keywordflow">if</span> (face_voisins(facej,0) != elem)
<a name="l00687"></a>00687           signej=-1.;
<a name="l00688"></a>00688         <span class="keywordtype">int</span> arete = <a class="code" href="Op__Div__VEFP1B__Elem_8cpp.html#a43ddbecfeb5d72a0ccf918858acb528c">chercher_arete</a>(elem, somi, somj,
<a name="l00689"></a>00689                                    elem_aretes, aretes_som);
<a name="l00690"></a>00690         <span class="keywordflow">for</span>(comp=0; comp&lt;dimension; comp++)
<a name="l00691"></a>00691           gradK(comp) = (signei*face_normales(facei,comp)+
<a name="l00692"></a>00692                          signej*face_normales(facej,comp));
<a name="l00693"></a>00693         psc=0;
<a name="l00694"></a>00694         <span class="keywordflow">for</span>(comp=0; comp&lt;dimension; comp++)
<a name="l00695"></a>00695           psc+=tiers*(
<a name="l00696"></a>00696                  -signei*face_normales(facei,comp)*vit(facei,comp)
<a name="l00697"></a>00697                  -signej*face_normales(facej,comp)*vit(facej,comp)
<a name="l00698"></a>00698                  +.5*gradK(comp)*sigma[comp]);
<a name="l00699"></a>00699         div(npa+arete)-=psc;
<a name="l00700"></a>00700       }
<a name="l00701"></a>00701   }
<a name="l00702"></a>00702 <span class="preprocessor">#else</span>
<a name="l00703"></a>00703 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00704"></a>00704 <span class="preprocessor"></span>
<a name="l00705"></a>00705 <span class="comment">// Divise par le volume</span>
<a name="l00706"></a><a class="code" href="classOp__Div__VEFP1B__Elem.html#ab093f067cf19c8bb443f831653a611a0">00706</a> <span class="keywordtype">void</span> <a class="code" href="classOp__Div__VEFP1B__Elem.html#ab093f067cf19c8bb443f831653a611a0">Op_Div_VEFP1B_Elem::volumique</a>(<a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; div)<span class="keyword"> const</span>
<a name="l00707"></a>00707 <span class="keyword"></span>{
<a name="l00708"></a>00708   <span class="keyword">const</span> <a class="code" href="classZone__VEF__PreP1b.html">Zone_VEF_PreP1b</a>&amp; zone_VEF = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classZone__VEF__PreP1b.html">Zone_VEF_PreP1b</a>,<a class="code" href="classOp__Div__VEF__Elem.html#a0fb0419078a6e4f7f276ff20c7204ad6">la_zone_vef</a>.<a class="code" href="classRef__Zone__VEF.html#aafd9a5ee1a76f290c9c6b5447b0c8d30">valeur</a>());
<a name="l00709"></a>00709   <span class="keywordtype">int</span> n=0;
<a name="l00710"></a>00710   <span class="keywordflow">if</span> (zone_VEF.<a class="code" href="classZone__VEF__PreP1b.html#aee2def53aa92584d7945e7c3d0d98963">get_alphaE</a>())
<a name="l00711"></a>00711     {
<a name="l00712"></a>00712       <a class="code" href="classOp__Div__VEFP1B__Elem.html#ab093f067cf19c8bb443f831653a611a0">Op_Div_VEF_Elem::volumique</a>(div);
<a name="l00713"></a>00713       n+=zone_VEF.<a class="code" href="classZone__dis__base.html#a4d6aa445f152aa6dc54d66ea7a071147">nb_elem_tot</a>();
<a name="l00714"></a>00714     }
<a name="l00715"></a>00715   <span class="keywordflow">if</span> (zone_VEF.<a class="code" href="classZone__VEF__PreP1b.html#ad7fbcb5567dcc2e6f0a0ed85ce90a4fa">get_alphaS</a>())
<a name="l00716"></a>00716     {
<a name="l00717"></a>00717       <span class="keyword">const</span> <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; vol = zone_VEF.<a class="code" href="classZone__VEF__PreP1b.html#ac8282d378ae480144d75129df4a8c55c">volume_aux_sommets</a>();
<a name="l00718"></a>00718       <span class="keywordtype">int</span> size_tot = vol.<a class="code" href="classDoubleVect.html#ad2d21b364e1c6559771970596a25c006" title="Identique a size_array()">size_totale</a>();
<a name="l00719"></a>00719       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;size_tot; i++)
<a name="l00720"></a>00720         div(n+i)/=vol(i);
<a name="l00721"></a>00721       n+=zone_VEF.<a class="code" href="classZone__dis__base.html#a8f793341b7a41d67561ba563ae0f69a0">nb_som_tot</a>();
<a name="l00722"></a>00722     }
<a name="l00723"></a>00723   <span class="keywordflow">if</span> (zone_VEF.<a class="code" href="classZone__VEF__PreP1b.html#a9d02e2431efb6e75c3d733ff06f89549">get_alphaA</a>())
<a name="l00724"></a>00724     {
<a name="l00725"></a>00725       <span class="keyword">const</span> <a class="code" href="classDoubleVect.html">DoubleVect</a>&amp; vol = zone_VEF.<a class="code" href="classZone__VEF__PreP1b.html#a05ce81decd9a72e90a112b75182ae280">get_volumes_aretes</a>();
<a name="l00726"></a>00726       <span class="keywordtype">int</span> size_tot = vol.<a class="code" href="classDoubleVect.html#ad2d21b364e1c6559771970596a25c006" title="Identique a size_array()">size_totale</a>();
<a name="l00727"></a>00727       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;size_tot; i++)
<a name="l00728"></a>00728         div(n+i)/=vol(i);
<a name="l00729"></a>00729     }
<a name="l00730"></a>00730 }
<a name="l00731"></a>00731 
<a name="l00732"></a><a class="code" href="classOp__Div__VEFP1B__Elem.html#aad9cd210d49e59abe4018c0a70ccddab">00732</a> <span class="keywordtype">void</span> <a class="code" href="classOp__Div__VEFP1B__Elem.html#aad9cd210d49e59abe4018c0a70ccddab">Op_Div_VEFP1B_Elem::degres_liberte</a>()<span class="keyword"> const</span>
<a name="l00733"></a>00733 <span class="keyword"></span>{
<a name="l00734"></a>00734 <span class="comment">// On annulle la divergence aux sommets sans degre de liberte</span>
<a name="l00735"></a>00735 <span class="comment">// (sommet uniquement commun a des faces avec des CL Diriclet)</span>
<a name="l00736"></a>00736   <span class="keyword">const</span> <a class="code" href="classZone__VEF__PreP1b.html">Zone_VEF_PreP1b</a>&amp; zone_VEF = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classZone__VEF__PreP1b.html">Zone_VEF_PreP1b</a>,<a class="code" href="classOp__Div__VEF__Elem.html#a0fb0419078a6e4f7f276ff20c7204ad6">la_zone_vef</a>.<a class="code" href="classRef__Zone__VEF.html#aafd9a5ee1a76f290c9c6b5447b0c8d30">valeur</a>());
<a name="l00737"></a>00737   <span class="keyword">const</span> <a class="code" href="classZone.html" title="classe Zone Une Zone est un maillage compose d&#39;un ensemble d&#39;elements geometriques de meme type...">Zone</a>&amp; zone = zone_VEF.<a class="code" href="classZone__dis__base.html#a0bb3a4512e111f91fa2c352de44653a4" title="Renvoie la Zone associee a l&#39;objet. (version const)">zone</a>();
<a name="l00738"></a>00738   <span class="keyword">const</span> <a class="code" href="classDomaine.html" title="Classe Domaine Un Domaine represente le domaine (spatial) de resolution d&#39;un Probleme. Un Domaine a un Nom, il est constitue d&#39;une ou plusieurs Zone qui peuvent etre eventuellement decoupees en Sous_Zone. Un Domaine porte l&#39;ensemble des sommets utilises par ses Zones. On peut vouloir resoudre des problemes de type different sur plusieurs domaines, geometriquement les domaines sont alors couples par des surfaces qu&#39;on appelle Raccord.">Domaine</a>&amp; dom=zone.domaine();
<a name="l00739"></a>00739   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; som_elem=zone.les_elems();
<a name="l00740"></a>00740   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; elem_faces=zone_VEF.<a class="code" href="classZone__VF.html#a067e462dcd3ab92b0f6d945b19e4eb37" title="renvoie le numero de le ieme face de la maille num_elem la facon dont ces faces sont numerotees est l...">elem_faces</a>();
<a name="l00741"></a>00741   <span class="keyword">const</span> <a class="code" href="classIntTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un IntVect avec calculs de l&#39;indice corespondant Voir les co...">IntTab</a>&amp; face_voisins=zone_VEF.<a class="code" href="classZone__VF.html#a49d4322f5585a8fa95748ca785b70702" title="renvoie l&#39;element voisin de numface dans la direction i. i=0 : dans le sens oppose de l&#39;axe orthogona...">face_voisins</a>();
<a name="l00742"></a>00742   <span class="keyword">const</span> <span class="keywordtype">int</span> nse=zone.nb_som_elem();
<a name="l00743"></a>00743   <span class="keywordtype">int</span> nb_faces_tot = zone_VEF.<a class="code" href="classZone__VF.html#a50fd21c9535680489015a3c8b88c685a" title="renvoie le nombre total de faces. C&#39;est-a-dire faces reelles + faces virtuelles">nb_faces_tot</a>();
<a name="l00744"></a>00744 
<a name="l00745"></a>00745   <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; journal = <a class="code" href="classProcess.html#a57e0f54b11e6eaadbea224fa904b18dd" title="Renvoie un objet statique de type Sortie qui sert de journal d&#39;evenements. Si message_level &lt;= verbose...">Process::Journal</a>();
<a name="l00746"></a>00746   <span class="keywordtype">int</span> afficher_message = 0;
<a name="l00747"></a>00747   <span class="keywordtype">int</span> nb_som=zone.nb_som();
<a name="l00748"></a>00748 
<a name="l00749"></a>00749   <span class="keywordtype">int</span> ecrire_decoupage_som=0;
<a name="l00750"></a>00750   <span class="keywordtype">int</span> decoupage_som=0;
<a name="l00751"></a>00751 <span class="comment">// On n&#39;ecrit qu&#39;une seule fois le fichier decoupage_som</span>
<a name="l00752"></a>00752 <span class="comment">// et uniquement en sequentiel</span>
<a name="l00753"></a>00753   <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>()==1 &amp;&amp; <a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().schema_temps().nb_pas_dt()==0)
<a name="l00754"></a>00754     decoupage_som=1;
<a name="l00755"></a>00755 <span class="comment">// SFichier* os=NULL;</span>
<a name="l00756"></a>00756   <a class="code" href="classSChaine.html" title="Cette classe derivee de Sortie empile ce qu&#39;on lui envoie dans une chaine de caracteres. On recupere le contenu de la chaine avec get_str().">SChaine</a> decoup_som;
<a name="l00757"></a>00757   decoup_som &lt;&lt; <span class="stringliteral">&quot;1&quot;</span> &lt;&lt; <a class="code" href="EntreeSortie_8h.html#a7f716d3c5b6411631d5d0700ead09467">finl</a>;
<a name="l00758"></a>00758   decoup_som &lt;&lt; <a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">Objet_U::dimension</a> &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; nb_som &lt;&lt; finl;
<a name="l00759"></a>00759   <a class="code" href="classIntVect.html">IntVect</a> somm(dimension+2);
<a name="l00760"></a>00760 
<a name="l00761"></a>00761   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0; k&lt;nb_som; k++)
<a name="l00762"></a>00762     {
<a name="l00763"></a>00763       <span class="keywordtype">int</span> sommet = dom.<a class="code" href="classDomaine.html#a37cc657f1907d53b0d5a573da862af80">get_renum_som_perio</a>(k);
<a name="l00764"></a>00764       <span class="keywordflow">if</span> (<a class="code" href="classOp__Div__VEFP1B__Elem.html#a6477affcde67cba4ef601e5cdf688e9d">nb_degres_liberte</a>(sommet) != 0)
<a name="l00765"></a>00765         <span class="keywordflow">continue</span>;
<a name="l00766"></a>00766       <span class="keywordflow">if</span> (!afficher_message &amp;&amp; <a class="code" href="classVerifierCoin.html#afa6dc25a972ceeb96910547dfefc9c07">VerifierCoin::expert_only</a>==0)
<a name="l00767"></a>00767         {
<a name="l00768"></a>00768           afficher_message = 1;
<a name="l00769"></a>00769           <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; finl &lt;&lt; <span class="stringliteral">&quot;Problem with the mesh used for the VEF P1Bulle discretization.&quot;</span> &lt;&lt; finl;
<a name="l00770"></a>00770           journal &lt;&lt; <span class="stringliteral">&quot;List of nodes with no degrees of freedom :&quot;</span> &lt;&lt; finl;
<a name="l00771"></a>00771         }
<a name="l00772"></a>00772       <span class="keyword">const</span> <span class="keywordtype">double</span> x = dom.<a class="code" href="classDomaine.html#a716f7248439ab8ec62d3e033ddfede41" title="Renvoie la j-ieme coordonnee du i-ieme noeud.">coord</a>(sommet, 0);
<a name="l00773"></a>00773       <span class="keyword">const</span> <span class="keywordtype">double</span> y = dom.<a class="code" href="classDomaine.html#a716f7248439ab8ec62d3e033ddfede41" title="Renvoie la j-ieme coordonnee du i-ieme noeud.">coord</a>(sommet, 1);
<a name="l00774"></a>00774       <span class="keyword">const</span> <span class="keywordtype">double</span> z = (<a class="code" href="classObjet__U.html#a3e23491c01f2f39245fb6f3b6d6d9b17">Objet_U::dimension</a>==3) ? dom.<a class="code" href="classDomaine.html#a716f7248439ab8ec62d3e033ddfede41" title="Renvoie la j-ieme coordonnee du i-ieme noeud.">coord</a>(sommet, 2) : 0.;
<a name="l00775"></a>00775 
<a name="l00776"></a>00776       journal &lt;&lt; <span class="stringliteral">&quot;Error node &quot;</span> &lt;&lt; sommet &lt;&lt; <span class="stringliteral">&quot; ( &quot;</span> &lt;&lt; x &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; y &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; z &lt;&lt; <span class="stringliteral">&quot; )\n&quot;</span>;
<a name="l00777"></a>00777 <span class="comment">// On affiche la liste des indices d&#39;elements reels et virtuels qui contiennent</span>
<a name="l00778"></a>00778 <span class="comment">// ce sommet. On affiche la lettre &quot;v&quot; pour les elements virtuels.</span>
<a name="l00779"></a>00779       journal &lt;&lt; <span class="stringliteral">&quot;Elements &quot;</span>;
<a name="l00780"></a>00780       <span class="keyword">const</span> <span class="keywordtype">int</span> nb_elem_tot = zone.nb_elem_tot();
<a name="l00781"></a>00781       <span class="keyword">const</span> <span class="keywordtype">int</span> nb_elem     = zone.nb_elem();
<a name="l00782"></a>00782       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> elem = 0; elem &lt; nb_elem_tot; elem++)
<a name="l00783"></a>00783         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> som = 0; som &lt; nse; som++)
<a name="l00784"></a>00784           <span class="keywordflow">if</span> (som_elem(elem, som) == sommet)
<a name="l00785"></a>00785             {
<a name="l00786"></a>00786               journal &lt;&lt; elem &lt;&lt; ((elem&gt;=nb_elem)?<span class="stringliteral">&quot;v &quot;</span>:<span class="stringliteral">&quot; &quot;</span>);
<a name="l00787"></a>00787 
<a name="l00788"></a>00788 <span class="comment">// Ecriture dans le fichier decoupage_som</span>
<a name="l00789"></a>00789               <span class="keywordtype">int</span> face_opp=elem_faces(elem,som);
<a name="l00790"></a>00790               <span class="keywordtype">int</span> elem_opp;
<a name="l00791"></a>00791               somm=-1;
<a name="l00792"></a>00792               somm(0)=sommet;
<a name="l00793"></a>00793 
<a name="l00794"></a>00794               <span class="keywordtype">int</span> elem1 = face_voisins(face_opp,0);
<a name="l00795"></a>00795               <span class="keywordtype">int</span> elem2 = face_voisins(face_opp,1);
<a name="l00796"></a>00796 
<a name="l00797"></a>00797               <span class="keywordflow">if</span> (elem1==elem)
<a name="l00798"></a>00798                 elem_opp=elem2;
<a name="l00799"></a>00799               <span class="keywordflow">else</span>
<a name="l00800"></a>00800                 elem_opp=elem1;
<a name="l00801"></a>00801 
<a name="l00802"></a>00802               <span class="keywordtype">int</span> i=2;
<a name="l00803"></a>00803               <span class="keywordflow">for</span>(<span class="keywordtype">int</span> som1=0; som1&lt;nse; som1++)  <span class="comment">//!&lt; on parcourt les sommets de elem_opp</span>
<a name="l00804"></a>00804 <span class="comment"></span>                {
<a name="l00805"></a>00805                   <span class="keywordtype">int</span> ok=1;
<a name="l00806"></a>00806                   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> som2=0; som2&lt;nse; som2++)  <span class="comment">//!&lt; on parcourt les sommets de elem</span>
<a name="l00807"></a>00807 <span class="comment"></span>                    <span class="keywordflow">if</span> ( som_elem(elem, som2)==som_elem(elem_opp, som1) )
<a name="l00808"></a>00808                       ok=0;
<a name="l00809"></a>00809                   <span class="keywordflow">if</span> (ok) somm(1)=som_elem(elem_opp, som1);
<a name="l00810"></a>00810                   <span class="keywordflow">else</span>
<a name="l00811"></a>00811                     {
<a name="l00812"></a>00812                       somm(i)=som_elem(elem_opp, som1);  <span class="comment">//!&lt; sommets de la face commune</span>
<a name="l00813"></a>00813 <span class="comment"></span>                      i++;
<a name="l00814"></a>00814                     }
<a name="l00815"></a>00815                 }
<a name="l00816"></a>00816               <span class="keywordflow">if</span> (decoupage_som)
<a name="l00817"></a>00817                 {
<a name="l00818"></a>00818                   ecrire_decoupage_som=1;
<a name="l00819"></a>00819                   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;dimension+2; j++)
<a name="l00820"></a>00820                     decoup_som &lt;&lt; somm(j) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> ;
<a name="l00821"></a>00821                   decoup_som &lt;&lt; elem &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; elem_opp &lt;&lt; finl;
<a name="l00822"></a>00822                 }
<a name="l00823"></a>00823             }
<a name="l00824"></a>00824       journal &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00825"></a>00825 <span class="comment">// On affiche la liste des faces qui contiennent ce sommet.</span>
<a name="l00826"></a>00826 <span class="comment">// Pour les faces de bord, on affiche la condlim,</span>
<a name="l00827"></a>00827 <span class="comment">// pour les faces virtuelles, la lettre &quot;v&quot;</span>
<a name="l00828"></a>00828       journal &lt;&lt; <span class="stringliteral">&quot;\nFaces &quot;</span>;
<a name="l00829"></a>00829       <span class="keyword">const</span> <span class="keywordtype">int</span> nb_faces = zone_VEF.<a class="code" href="classZone__VF.html#aede27992d9f2eedd52c24d4a80ff7ffb" title="renvoie le nombre global de faces.">nb_faces</a>();
<a name="l00830"></a>00830       <span class="keyword">const</span> <span class="keywordtype">int</span> nb_som_face = zone_VEF.<a class="code" href="classZone__VF.html#a298e73b18e17da55f421b1fb0879bd46" title="renvoie le numero du ieme sommet de la face num_face.">face_sommets</a>().dimension(1);
<a name="l00831"></a>00831       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> face = 0; face &lt; nb_faces_tot; face++)
<a name="l00832"></a>00832         {
<a name="l00833"></a>00833           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> som = 0; som &lt; nb_som_face; som++)
<a name="l00834"></a>00834             {
<a name="l00835"></a>00835               <span class="keywordflow">if</span> (zone_VEF.<a class="code" href="classZone__VF.html#a298e73b18e17da55f421b1fb0879bd46" title="renvoie le numero du ieme sommet de la face num_face.">face_sommets</a>(face, som) == sommet)
<a name="l00836"></a>00836                 {
<a name="l00837"></a>00837                   journal &lt;&lt; face;
<a name="l00838"></a>00838                   <span class="keywordflow">if</span> (face &gt;= nb_faces) <span class="comment">//!&lt; Face virtuelle</span>
<a name="l00839"></a>00839 <span class="comment"></span>                    journal &lt;&lt; <span class="stringliteral">&quot;v&quot;</span>;
<a name="l00840"></a>00840                   <span class="keyword">const</span> <span class="keywordtype">int</span> cl = <a class="code" href="Op__Div__VEFP1B__Elem_8cpp.html#a210fede867f45a3894b9528eac9a2827">find_cl_face</a>(zone, face);
<a name="l00841"></a>00841 <span class="comment">// Face de bord reelle:</span>
<a name="l00842"></a>00842                   <span class="keywordflow">if</span> (cl &gt;= 0)
<a name="l00843"></a>00843                     {
<a name="l00844"></a>00844                       <span class="keyword">const</span> <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a>&amp; nom_bord = zone.frontiere(cl).<a class="code" href="classNom.html#a4fcffbaa80271df0d9674f2a2751efb9" title="Renvoie *this;.">le_nom</a>();
<a name="l00845"></a>00845                       journal &lt;&lt; <span class="stringliteral">&quot;(boundary=&quot;</span> &lt;&lt; nom_bord &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;
<a name="l00846"></a>00846                     }
<a name="l00847"></a>00847                   journal &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l00848"></a>00848                 }
<a name="l00849"></a>00849             }
<a name="l00850"></a>00850         }
<a name="l00851"></a>00851       journal &lt;&lt; finl;
<a name="l00852"></a>00852     }
<a name="l00853"></a>00853 
<a name="l00854"></a>00854   <span class="keywordflow">if</span> (ecrire_decoupage_som)
<a name="l00855"></a>00855     {
<a name="l00856"></a>00856       decoup_som &lt;&lt; <span class="stringliteral">&quot;-1&quot;</span>;
<a name="l00857"></a>00857       <a class="code" href="classSFichier.html" title="Cette classe est a la classe C++ ofstream ce que la classe Sortie est a la classe C++ ostream Elle re...">SFichier</a> fic(<a class="code" href="classObjet__U.html#a7c27c4f80259eeef76ff8fe2d3bc61f7" title="Renvoie une reference constante vers le nom du cas. Cette methode est statique.">Objet_U::nom_du_cas</a>()+<span class="stringliteral">&quot;.decoupage_som&quot;</span>);
<a name="l00858"></a>00858       fic &lt;&lt; decoup_som.<a class="code" href="classSChaine.html#a8ed820eca8d79e52fb50520d02637315" title="returns a copy of the string stored by the SChaine">get_str</a>() &lt;&lt; finl;
<a name="l00859"></a>00859       fic.<a class="code" href="classSortie__Fichier__base.html#ac246a47c4438e3183322c20db2a3323c">close</a>();
<a name="l00860"></a>00860 
<a name="l00861"></a>00861     }
<a name="l00862"></a>00862   <span class="keywordflow">if</span> (afficher_message &amp;&amp; <a class="code" href="classVerifierCoin.html#afa6dc25a972ceeb96910547dfefc9c07">VerifierCoin::expert_only</a>==0)
<a name="l00863"></a>00863     {
<a name="l00864"></a>00864       <a class="code" href="classNom.html" title="class Nom Une chaine de caractere pour nommer les objets de TRUST">Nom</a> <a class="code" href="Postraitement_8cpp.html#a2014b0b7ca4c8b7161754648bb234d56">nom_fichier</a>(<a class="code" href="classObjet__U.html#a7c27c4f80259eeef76ff8fe2d3bc61f7" title="Renvoie une reference constante vers le nom du cas. Cette methode est statique.">nom_du_cas</a>());
<a name="l00865"></a>00865       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Look at the .log file of processor &quot;</span> &lt;&lt; <a class="code" href="classProcess.html#ab55ba07167ec807ed3a145cac0f5dca4" title="renvoie mon rang dans le groupe de communication courant. Voir Comm_Group::rank() et PE_Groups::curre...">Process::me</a>() &lt;&lt; <span class="stringliteral">&quot; to know which nodes&quot;</span> &lt;&lt; finl;
<a name="l00866"></a>00866       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;do not have enough degrees of freedom. You can also visualize&quot;</span> &lt;&lt; finl;
<a name="l00867"></a>00867       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;your mesh to identify which elements have a problem and&quot;</span> &lt;&lt; finl;
<a name="l00868"></a>00868       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;remesh your domain close to these nodes so that these have&quot;</span> &lt;&lt; finl;
<a name="l00869"></a>00869       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;at least a degree of freedom.&quot;</span> &lt;&lt; finl;
<a name="l00870"></a>00870       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;The VEF P1Bulle discretization is not compatible with this type&quot;</span> &lt;&lt; finl;
<a name="l00871"></a>00871       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;of mesh and boundary conditions used (Dirichlet, Symmetry ,...)&quot;</span> &lt;&lt; finl &lt;&lt; finl;
<a name="l00872"></a>00872       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Other possibility, in your data file:&quot;</span>&lt;&lt;finl;
<a name="l00873"></a>00873       <span class="keywordflow">if</span> (dimension==2)
<a name="l00874"></a>00874         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;If you have used \&quot;Trianguler\&quot;, substituted by \&quot;Trianguler_H\&quot;.&quot;</span> &lt;&lt; finl &lt;&lt; finl;
<a name="l00875"></a>00875       <span class="keywordflow">if</span> (dimension==3)
<a name="l00876"></a>00876         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;If you have used \&quot;Tetraedriser\&quot;, substituted by \&quot;Tetraedriser_homogene\&quot; or \&quot;Tetraedriser_par_prisme\&quot;.&quot;</span> &lt;&lt; finl &lt;&lt; finl;
<a name="l00877"></a>00877       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Or insert the line:&quot;</span> &lt;&lt; finl;
<a name="l00878"></a>00878       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;VerifierCoin &quot;</span> &lt;&lt; dom.<a class="code" href="classDomaine.html#a87e2cdc035a26565e6fe481446aa4cd3" title="Renvoie le nom du domaine.">le_nom</a>() &lt;&lt; <span class="stringliteral">&quot; { [Read_file &quot;</span> &lt;&lt; nom_fichier &lt;&lt; <span class="stringliteral">&quot;.decoupage_som] }&quot;</span> &lt;&lt; finl;
<a name="l00879"></a>00879       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;after the mesh is finished to be read and built.&quot;</span> &lt;&lt; finl;
<a name="l00880"></a>00880       <span class="keywordflow">if</span> (<a class="code" href="classProcess.html#a6bf692ce58d9578aa62ac3c07b8caaa1" title="renvoie le nombre de processeurs dans le groupe courant Voir Comm_Group::nproc() et PE_Groups::curren...">Process::nproc</a>()&gt;1)
<a name="l00881"></a>00881         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;and BEFORE the keyword \&quot;Decouper\&quot; during the partition of the mesh.&quot;</span> &lt;&lt; finl;
<a name="l00882"></a>00882       <span class="keywordflow">else</span>
<a name="l00883"></a>00883         <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;and BEFORE the keyword \&quot;Discretiser\&quot;.&quot;</span> &lt;&lt; finl;
<a name="l00884"></a>00884       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;A few cells will be divided into 3 (2D) or 4 (3D).&quot;</span> &lt;&lt; finl;
<a name="l00885"></a>00885       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; finl;
<a name="l00886"></a>00886       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;Last possibility, it is possible now for experimented users to not check if there is enough degrees of freedom&quot;</span> &lt;&lt; finl;
<a name="l00887"></a>00887       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;by adding the next line BEFORE the keyword \&quot;Discretiser\&quot;:&quot;</span> &lt;&lt; finl;
<a name="l00888"></a>00888       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;VerifierCoin &quot;</span> &lt;&lt; dom.<a class="code" href="classDomaine.html#a87e2cdc035a26565e6fe481446aa4cd3" title="Renvoie le nom du domaine.">le_nom</a>() &lt;&lt; <span class="stringliteral">&quot; { expert_only } &quot;</span> &lt;&lt; finl;
<a name="l00889"></a>00889       <a class="code" href="EntreeSortie_8h.html#a5ebb6b5243d6167369bddecb78d0b5b8">Cerr</a> &lt;&lt; <span class="stringliteral">&quot;In this case, check the results carefully.&quot;</span> &lt;&lt; finl;
<a name="l00890"></a>00890       <a class="code" href="classProcess.html#acc2fbbe761e08e5870ae605c0705491c" title="Routine de sortie de Trio-U sur une erreur Sauvegarde la memoire et le hierarchie dans les fichiers &quot;...">exit</a>();
<a name="l00891"></a>00891     }
<a name="l00892"></a>00892 }
<a name="l00893"></a>00893 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:29 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
