<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TRUST: src/ThHyd/Multiphase/CoviMAC/Op_Evanescence_Homogene_CoviMAC_Elem.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TRUST&#160;<span id="projectnumber">1.8.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">src/ThHyd/Multiphase/CoviMAC/Op_Evanescence_Homogene_CoviMAC_Elem.cpp</div>  </div>
</div>
<div class="contents">
<a href="Op__Evanescence__Homogene__CoviMAC__Elem_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* Copyright (c) 2021, CEA</span>
<a name="l00003"></a>00003 <span class="comment">* All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment">* 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00007"></a>00007 <span class="comment">* 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00008"></a>00008 <span class="comment">* 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00009"></a>00009 <span class="comment">*</span>
<a name="l00010"></a>00010 <span class="comment">* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<a name="l00011"></a>00011 <span class="comment">* IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;</span>
<a name="l00012"></a>00012 <span class="comment">* OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// File:        Op_Evanescence_Homogene_CoviMAC_Elem.cpp</span>
<a name="l00018"></a>00018 <span class="comment">// Directory:   $TRUST_ROOT/src/ThHyd/Multiphase/CoviMAC</span>
<a name="l00019"></a>00019 <span class="comment">// Version:     /main/13</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;<a class="code" href="Op__Evanescence__Homogene__CoviMAC__Elem_8h.html">Op_Evanescence_Homogene_CoviMAC_Elem.h</a>&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="Zone__CoviMAC_8h.html">Zone_CoviMAC.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="Champ__P0__CoviMAC_8h.html">Champ_P0_CoviMAC.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="Zone__Cl__CoviMAC_8h.html">Zone_Cl_CoviMAC.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="Matrix__tools_8h.html">Matrix_tools.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="Pb__Multiphase_8h.html">Pb_Multiphase.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="Champ__Uniforme_8h.html">Champ_Uniforme.h</a>&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;<a class="code" href="Schema__Implicite__base_8h.html">Schema_Implicite_base.h</a>&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;<a class="code" href="SETS_8h.html">SETS.h</a>&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;<a class="code" href="Param_8h.html">Param.h</a>&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;<a class="code" href="Milieu__composite_8h.html">Milieu_composite.h</a>&gt;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a><a class="code" href="Op__Evanescence__Homogene__CoviMAC__Elem_8cpp.html#aa18d98b222ce923f5204c2af22d6f9fa">00035</a> <a class="code" href="Op__Diff__CoviMAC__Face_8cpp.html#aa86ec8ba612a969d9b4370b775037144">Implemente_instanciable</a>(<a class="code" href="classOp__Evanescence__Homogene__CoviMAC__Elem.html" title="Classe Op_Evanescence_Homogene_CoviMAC_Elem gestion dans CoviMAC de l&#39;evanescence dans une equation a...">Op_Evanescence_Homogene_CoviMAC_Elem</a>,<span class="stringliteral">&quot;Op_Evanescence_Homogene_CoviMAC_Elem&quot;</span>,<a class="code" href="classOperateur__Evanescence__base.html" title="classe Operateur_Evanescence Classe generique de la hierarchie des operateurs representant un terme d...">Operateur_Evanescence_base</a>);
<a name="l00036"></a>00036 
<a name="l00037"></a><a class="code" href="classOp__Evanescence__Homogene__CoviMAC__Elem.html#a3c019c1a635214d8d352dc72d90610a2">00037</a> <a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; <a class="code" href="classOp__Evanescence__Homogene__CoviMAC__Elem.html#a3c019c1a635214d8d352dc72d90610a2" title="NE FAIT RIEN A surcharger dans les classes derivees.">Op_Evanescence_Homogene_CoviMAC_Elem::printOn</a>(<a class="code" href="classSortie.html" title="Classe de base des flux de sortie. Elle sait ecrire des types simples&lt;br&gt;(entiers, flottants) et des Ob...">Sortie</a>&amp; os)<span class="keyword"> const</span>
<a name="l00038"></a>00038 <span class="keyword"></span>{
<a name="l00039"></a>00039   <span class="keywordflow">return</span> os;
<a name="l00040"></a>00040 }
<a name="l00041"></a>00041 
<a name="l00042"></a><a class="code" href="classOp__Evanescence__Homogene__CoviMAC__Elem.html#ad37dda6e2a9d3aba1ff9016cd55e07c7">00042</a> <a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; <a class="code" href="classOp__Evanescence__Homogene__CoviMAC__Elem.html#ad37dda6e2a9d3aba1ff9016cd55e07c7" title="NE FAIT RIEN A surcharger dans les classes derivees.">Op_Evanescence_Homogene_CoviMAC_Elem::readOn</a>(<a class="code" href="classEntree.html" title="Classe de definition des operateurs et methodes pour toute lecture dans un flot d&#39;entree (fichier...">Entree</a>&amp; is)
<a name="l00043"></a>00043 {
<a name="l00044"></a>00044   <a class="code" href="classParam.html" title="Defined below in this file.">Param</a> param(<a class="code" href="classObjet__U.html#aa58e9a81c0ddc2c1149053b8f96698ac" title="renvoie la chaine identifiant la classe.">que_suis_je</a>());
<a name="l00045"></a>00045   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;alpha_res&quot;</span>, &amp;<a class="code" href="classOp__Evanescence__Homogene__CoviMAC__Elem.html#a9cc0eaa4e2a945f328e125f885760b13">alpha_res_</a>, <a class="code" href="classParam.html#aa4ad0ca1d49bc5f2ebc5fc83ee9df384aaf5b6dfac1c5970478525407cc6ac572">Param::REQUIRED</a>);
<a name="l00046"></a>00046   param.<a class="code" href="classParam.html#affb8a0102361201ba896bac7ca8bc21c">ajouter</a>(<span class="stringliteral">&quot;alpha_res_min&quot;</span>, &amp;<a class="code" href="classOp__Evanescence__Homogene__CoviMAC__Elem.html#a3a0ab54af6c88540d62f359f1d766886">alpha_res_min_</a>);
<a name="l00047"></a>00047   param.<a class="code" href="classParam.html#aa9d44fc51b4a08b357733a97dc7acaad" title="Read the is input with the parameters (defined with the Param object) inside: { ... } Example, to read: { a 1 b 2 } Param param(que_suis_je()); int a,b; param.ajouter(&quot;a&quot;,&amp;a); param.ajouter(&quot;b&quot;,&amp;b); param.lire_avec_accolades_depuis(is);.">lire_avec_accolades_depuis</a>(is);
<a name="l00048"></a>00048   <span class="keywordflow">return</span> is;
<a name="l00049"></a>00049 }
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="keywordtype">void</span> <a class="code" href="classOp__Evanescence__Homogene__CoviMAC__Elem.html#a78d39dc368d4382444f7ccbece78502b">Op_Evanescence_Homogene_CoviMAC_Elem::dimensionner_blocs</a>(<a class="code" href="Interface__blocs_8h.html#a68e4f5c4505f6b31305de844302660bb">matrices_t</a> matrices, <span class="keyword">const</span> <a class="code" href="Interface__blocs_8h.html#a2d7480bf11fc9f791b1d2839fa30a5c3">tabs_t</a>&amp; semi_impl)<span class="keyword"> const</span>
<a name="l00052"></a>00052 <span class="keyword"></span>{
<a name="l00053"></a>00053   <span class="keyword">const</span> <a class="code" href="classChamp__P0__CoviMAC.html" title=": class Champ_P0_CoviMAC Champ correspondant a une inconnue scalaire (type temperature ou pression) D...">Champ_P0_CoviMAC</a>&amp; ch = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classChamp__P0__CoviMAC.html" title=": class Champ_P0_CoviMAC Champ correspondant a une inconnue scalaire (type temperature ou pression) D...">Champ_P0_CoviMAC</a>, <a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().inconnue().<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>());
<a name="l00054"></a>00054   <span class="keyword">const</span> <a class="code" href="classZone__CoviMAC.html" title="class Zone_CoviMAC Classe instanciable qui derive de Zone_VF. Cette classe contient les informations ...">Zone_CoviMAC</a>&amp; zone = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classZone__CoviMAC.html" title="class Zone_CoviMAC Classe instanciable qui derive de Zone_VF. Cette classe contient les informations ...">Zone_CoviMAC</a>, <a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().zone_dis().<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>());
<a name="l00055"></a>00055   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; inco = ch.<a class="code" href="classChamp__Inc__base.html#adb537f43f1649e103a8980314c7ed175" title="Renvoie le tableau des valeurs du champ au temps courant.">valeurs</a>();
<a name="l00056"></a>00056 
<a name="l00057"></a>00057   <span class="comment">/* on doit pouvoir ajouter / soustraire les equations entre composantes */</span>
<a name="l00058"></a>00058   <span class="keywordtype">int</span> i, j, e, n, N = inco.<a class="code" href="classDoubleVect.html#ab02d01cd1bdab66fbd66f9a47cc29e10">line_size</a>();
<a name="l00059"></a>00059   <span class="keywordflow">if</span> (N == 1) <span class="keywordflow">return</span>; <span class="comment">//pas d&#39;evanescence en simple phase!</span>
<a name="l00060"></a>00060   <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;&amp;n_m : matrices) <span class="keywordflow">if</span> (n_m.second-&gt;nb_colonnes())
<a name="l00061"></a>00061       {
<a name="l00062"></a>00062         <a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a>&amp; mat = *n_m.second, mat2;
<a name="l00063"></a>00063         <a class="code" href="classIntTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un IntTab avec allocation dans un pool de memoire gere...">IntTrav</a> sten(0, 2);
<a name="l00064"></a>00064         sten.set_smart_resize(1);
<a name="l00065"></a>00065 
<a name="l00066"></a>00066         std::set&lt;int&gt; idx;
<a name="l00067"></a>00067         <span class="keywordflow">for</span> (e = 0; e &lt; zone.<a class="code" href="classZone__dis__base.html#a790cb2f6bc2928518799e748313d0eb3">nb_elem</a>(); e++, idx.clear())
<a name="l00068"></a>00068           {
<a name="l00069"></a>00069             <span class="keywordflow">for</span> (i = N * e, n = 0; n &lt; N; n++, i++) <span class="keywordflow">for</span> (j = mat.<a class="code" href="classMatrice__Morse.html#a79b4e334152850bd36e53478debf3061">get_tab1</a>()(i) - 1; j &lt; mat.<a class="code" href="classMatrice__Morse.html#a79b4e334152850bd36e53478debf3061">get_tab1</a>()(i + 1) - 1; j++)
<a name="l00070"></a>00070                 idx.insert(mat.<a class="code" href="classMatrice__Morse.html#a787b5a63f27063f9c891243d8f188cda">get_tab2</a>()(j) - 1);
<a name="l00071"></a>00071             <span class="keywordflow">for</span> (i = N * e, n = 0; n &lt; N; n++, i++) <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;&amp;c : idx) sten.append_line(i, c);
<a name="l00072"></a>00072           }
<a name="l00073"></a>00073         <a class="code" href="classMatrix__tools.html#a481961691c1dbee5372da25777e5c1e8">Matrix_tools::allocate_morse_matrix</a>(mat.<a class="code" href="classMatrice__Morse.html#a1f9bd6aedb226c86b7299689fa5b821a">nb_lignes</a>(), mat.<a class="code" href="classMatrice__Morse.html#a94caf9937bc5a110a7179cb3e9eaa9d9">nb_colonnes</a>(), sten, mat2);
<a name="l00074"></a>00074         mat = mat2; <span class="comment">//pour forcer l&#39;ordre des coefficients dans la matrice (accelere les operations ligne a ligne)</span>
<a name="l00075"></a>00075       }
<a name="l00076"></a>00076 }
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 <span class="keywordtype">void</span> <a class="code" href="classOp__Evanescence__Homogene__CoviMAC__Elem.html#a3c828e10220e7c02798dd62e55011da2">Op_Evanescence_Homogene_CoviMAC_Elem::ajouter_blocs</a>(<a class="code" href="Interface__blocs_8h.html#a68e4f5c4505f6b31305de844302660bb">matrices_t</a> matrices, <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; secmem, <span class="keyword">const</span> <a class="code" href="Interface__blocs_8h.html#a2d7480bf11fc9f791b1d2839fa30a5c3">tabs_t</a>&amp; semi_impl)<span class="keyword"> const</span>
<a name="l00079"></a>00079 <span class="keyword"></span>{
<a name="l00080"></a>00080   <span class="keyword">const</span> <a class="code" href="classMilieu__composite.html" title="Classe Milieu_composite Cette classe represente un fluide reel ainsi que ses proprietes: - viscosite ...">Milieu_composite</a>&amp; milc = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classMilieu__composite.html" title="Classe Milieu_composite Cette classe represente un fluide reel ainsi que ses proprietes: - viscosite ...">Milieu_composite</a>, <a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().milieu());
<a name="l00081"></a>00081   <span class="keyword">const</span> <a class="code" href="classChamp__P0__CoviMAC.html" title=": class Champ_P0_CoviMAC Champ correspondant a une inconnue scalaire (type temperature ou pression) D...">Champ_P0_CoviMAC</a>&amp; ch = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classChamp__P0__CoviMAC.html" title=": class Champ_P0_CoviMAC Champ correspondant a une inconnue scalaire (type temperature ou pression) D...">Champ_P0_CoviMAC</a>, <a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().inconnue().<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>());
<a name="l00082"></a>00082   <span class="keyword">const</span> <a class="code" href="classZone__CoviMAC.html" title="class Zone_CoviMAC Classe instanciable qui derive de Zone_VF. Cette classe contient les informations ...">Zone_CoviMAC</a>&amp; zone = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classZone__CoviMAC.html" title="class Zone_CoviMAC Classe instanciable qui derive de Zone_VF. Cette classe contient les informations ...">Zone_CoviMAC</a>, <a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().zone_dis().<a class="code" href="Source__Generique__Face__PolyMAC_8cpp.html#a7d7b5d77a3caa1af70f5e1c9108de5a1">valeur</a>());
<a name="l00083"></a>00083   <span class="keyword">const</span> <a class="code" href="classPb__Multiphase.html" title="classe Pb_Multiphase Cette classe represente un probleme de thermohydraulique multiphase de type &quot;3*...">Pb_Multiphase</a>&amp; pb = <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classPb__Multiphase.html" title="classe Pb_Multiphase Cette classe represente un probleme de thermohydraulique multiphase de type &quot;3*...">Pb_Multiphase</a>, <a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().probleme());
<a name="l00084"></a>00084   <span class="keyword">const</span> <a class="code" href="classDoubleTab.html" title="Tableau a n entrees pour n&lt;= 4 Repose sur un DoubleVect avec calculs de l&#39;indice corespondant Voir les...">DoubleTab</a>&amp; inco = ch.<a class="code" href="classChamp__Inc__base.html#adb537f43f1649e103a8980314c7ed175" title="Renvoie le tableau des valeurs du champ au temps courant.">valeurs</a>(), &amp;alpha = pb.<a class="code" href="classPb__Multiphase.html#affb5ae03eb9e469afd34b084cda27d95">eq_masse</a>.<a class="code" href="classMasse__Multiphase.html#a1d77eeafadabbeac5bebb84bfafaac29" title="Renvoie le champ inconnue representant l&#39;inconnue (T ou H) (version const)">inconnue</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>(),
<a name="l00085"></a>00085                    &amp;rho = <a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().<a class="code" href="classEquation__base.html#a181e9899e2d927eb14c835d9d9334f46">milieu</a>().<a class="code" href="classMilieu__base.html#a46a9a4bfb046ed22d0f267b6c052889f" title="Renvoie la masse volumique du milieu. (version const)">masse_volumique</a>().<a class="code" href="classChamp__Proto.html#a9d8c69f11d1b0a8e378cc6ca41793614">valeurs</a>(),
<a name="l00086"></a>00086                     &amp;p = pb.<a class="code" href="classPb__Multiphase.html#adf2872b95eb3bdb1a22e6d3c55bda061">eq_qdm</a>.<a class="code" href="classNavier__Stokes__std.html#afbb8f39bdfd70328dfad21bf2b9dd45a" title="Renvoie le champ de pression.">pression</a>().<a class="code" href="classChamp__Inc.html#a28ef3d411d12cb5684ac5e799efb7d24" title="Appel a l&#39;objet sous-jacent Renvoie le tableau des valeurs au temps courant.">valeurs</a>();
<a name="l00087"></a>00087   <span class="keyword">const</span> <a class="code" href="classSETS.html">SETS</a> *sch = <a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classSchema__Implicite__base.html" title="class Schema_Implicite_base Classe de base pour tous les schemas en temps implicite Il porte un objet...">Schema_Implicite_base</a>, pb.<a class="code" href="classPb__Multiphase.html#adf2872b95eb3bdb1a22e6d3c55bda061">eq_qdm</a>.<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>()) &amp;&amp; <a class="code" href="Cast_8h.html#a9632e68536db6c29c2b754cb55381fbe">sub_type</a>(<a class="code" href="classSETS.html">SETS</a>, <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classSchema__Implicite__base.html" title="class Schema_Implicite_base Classe de base pour tous les schemas en temps implicite Il porte un objet...">Schema_Implicite_base</a>, pb.<a class="code" href="classPb__Multiphase.html#adf2872b95eb3bdb1a22e6d3c55bda061">eq_qdm</a>.<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>()).<a class="code" href="classOperateur__base.html#a01258c6b4bf60a83b7ebd1649a54ecf6">solveur</a>().<a class="code" href="classDeriv__SolveurSys__base.html#aa1f67fc10fc25960d05d484a67d1bb54">valeur</a>())
<a name="l00088"></a>00088                     ? &amp;<a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classSETS.html">SETS</a>, <a class="code" href="Cast_8h.html#ad116a7acb85c9c91e5687c44941a0d0c">ref_cast</a>(<a class="code" href="classSchema__Implicite__base.html" title="class Schema_Implicite_base Classe de base pour tous les schemas en temps implicite Il porte un objet...">Schema_Implicite_base</a>, pb.<a class="code" href="classPb__Multiphase.html#adf2872b95eb3bdb1a22e6d3c55bda061">eq_qdm</a>.<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>()).<a class="code" href="classOperateur__base.html#a01258c6b4bf60a83b7ebd1649a54ecf6">solveur</a>().<a class="code" href="classDeriv__SolveurSys__base.html#aa1f67fc10fc25960d05d484a67d1bb54">valeur</a>()) : NULL;
<a name="l00089"></a>00089 
<a name="l00090"></a>00090   <span class="keywordtype">int</span> e, i, j, k, n, N = inco.<a class="code" href="classDoubleVect.html#ab02d01cd1bdab66fbd66f9a47cc29e10">line_size</a>(), m, M = p.line_size(), is_m = ch.<a class="code" href="classField__base.html#ae1377124eabe8387aced762115b062bb" title="Renvoie le nom du champ.">le_nom</a>() == <span class="stringliteral">&quot;alpha&quot;</span>, cR = (rho.dimension_tot(0) == 1),
<a name="l00091"></a>00091                      iter = sch ? sch-&gt;<a class="code" href="classSETS.html#a73c4e579bc537898da0bc707ac19fb3a">iteration</a> : 0, p_degen = is_m &amp;&amp; sch ? sch-&gt;<a class="code" href="classSETS.html#a3ac3e326835cd7b7e65512befd351443">p_degen</a> : 0;
<a name="l00092"></a>00092   if (N == 1 || p_degen || (is_m &amp;&amp; !iter)) <span class="keywordflow">return</span>; <span class="comment">//pas d&#39;evanescence en simple phase ou si p est degenere</span>
<a name="l00093"></a>00093 
<a name="l00094"></a>00094   <span class="keywordtype">double</span> a_eps = <a class="code" href="classOp__Evanescence__Homogene__CoviMAC__Elem.html#a9cc0eaa4e2a945f328e125f885760b13">alpha_res_</a>, a_eps_min = <a class="code" href="classOp__Evanescence__Homogene__CoviMAC__Elem.html#a3a0ab54af6c88540d62f359f1d766886">alpha_res_min_</a>, a_m, a_max; <span class="comment">//seuil de declenchement du traitement de l&#39;evanescence</span>
<a name="l00095"></a>00095 
<a name="l00096"></a>00096   <span class="comment">/* recherche de phases evanescentes et traitement des seconds membres */</span>
<a name="l00097"></a>00097   <a class="code" href="classIntTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un IntTab avec allocation dans un pool de memoire gere...">IntTrav</a> maj(inco.<a class="code" href="classDoubleTab.html#a3eadd63f3ba20c1b454d760b430acbf7" title="Returns the total dimensions of the multi-dimensionnal array, including virtual items (used in parall...">dimension_tot</a>(0)); <span class="comment">//maj(i) : phase majoritaire de la ligne i</span>
<a name="l00098"></a>00098   <a class="code" href="classDoubleTrav.html" title="Tableau de travail a n entrees pour n&lt;= 4 C&#39;est un DoubleTab avec allocation dans un pool de memoire g...">DoubleTrav</a> <a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a>(inco.<a class="code" href="classDoubleTab.html#a3eadd63f3ba20c1b454d760b430acbf7" title="Returns the total dimensions of the multi-dimensionnal array, including virtual items (used in parall...">dimension_tot</a>(0), inco.<a class="code" href="classDoubleVect.html#ab02d01cd1bdab66fbd66f9a47cc29e10">line_size</a>(), 2); <span class="comment">//coeff(i, n, 0/1) : coeff a appliquer a l&#39;equation existante / a l&#39;eq. &quot;inco = v_maj&quot;, leurs derivees en alpha</span>
<a name="l00099"></a>00099   <a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a>&amp; mat_diag = *matrices.at(ch.<a class="code" href="classField__base.html#ae1377124eabe8387aced762115b062bb" title="Renvoie le nom du champ.">le_nom</a>().<a class="code" href="classNom.html#a855d8cd96b5c73c2aa55cb7c0a870640">getString</a>());
<a name="l00100"></a>00100   <span class="keywordflow">for</span> (e = 0; e &lt; zone.<a class="code" href="classZone__dis__base.html#a790cb2f6bc2928518799e748313d0eb3">nb_elem</a>(); e++)
<a name="l00101"></a>00101     {
<a name="l00102"></a>00102       <span class="comment">/* phase majoritaire */</span>
<a name="l00103"></a>00103       <span class="keywordflow">for</span> (a_max = 0, k = -1, n = 0; n &lt; N; n++) if ((a_m = alpha(e, n)) &gt; a_max) k = n, a_max = a_m;
<a name="l00104"></a>00104       <span class="keywordflow">if</span> (k &gt;= 0) maj(e) = k;
<a name="l00105"></a>00105       <span class="keywordflow">else</span> <a class="code" href="classProcess.html#a6a4b64571b10f150a70db229b839e881" title="Routine de sortie de Trio-U sur une erreur abort()">abort</a>();
<a name="l00106"></a>00106 
<a name="l00107"></a>00107       <span class="comment">/* coeff d&#39;evanescence, second membre */</span>
<a name="l00108"></a>00108       <span class="keywordflow">for</span> (n = 0, m = 0; n &lt; N; n++, m += (M &gt; 1)) <span class="keywordflow">if</span> (n != k &amp;&amp; (a_m = alpha(e, n)) &lt; a_eps)
<a name="l00109"></a>00109           {
<a name="l00110"></a>00110             <span class="keywordtype">double</span> val = is_m ? 0 : milc.<a class="code" href="classMilieu__composite.html#ab01b847f409f1b43e64f471e1d673eb6">has_saturation</a>(n, k) ? milc.<a class="code" href="classMilieu__composite.html#acb12d79518b83d853a1bdf4c497ed09c">get_saturation</a>(n, k).<a class="code" href="classSaturation__base.html#af8943364ab31ef65f4495b8542c90844">Tsat</a>(p(e, m)) : inco(e, k); <span class="comment">//valeur a laquelle on veut ramener inco(e, n)</span>
<a name="l00111"></a>00111             <a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a>(e, n, 0) = (a_eps == a_eps_min ? (a_m &lt; a_eps) : <a class="code" href="Double_8h.html#a2f8edc4561e9744ed4233b205fa7ec32">min</a>(<a class="code" href="Double_8h.html#a1c45761573e6cbc97cfacac78d905016">max</a>((a_eps - a_m) / (a_eps - a_eps_min), 0.), 1.));
<a name="l00112"></a>00112             <a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a>(e, n, 1) = mat_diag(N * e + k, N * e + k) * <a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a>(e, n, 0);
<a name="l00113"></a>00113             <span class="keywordtype">double</span> flux = <a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a>(e, n, 0) * secmem(e, n) + <a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a>(e, n, 1) * (inco(e, n) - val);
<a name="l00114"></a>00114             secmem(e, k) += (p_degen ? rho(!cR * e, k) : 1) * flux, secmem(e, n) -= (p_degen ? rho(!cR * e, n) : 1) * flux;
<a name="l00115"></a>00115           }
<a name="l00116"></a>00116     }
<a name="l00117"></a>00117 
<a name="l00118"></a>00118   <span class="comment">/* lignes de matrices */</span>
<a name="l00119"></a>00119   <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;&amp;n_m : matrices) <span class="keywordflow">if</span> (n_m.second-&gt;nb_colonnes())
<a name="l00120"></a>00120       {
<a name="l00121"></a>00121         <span class="keywordtype">int</span> diag = (n_m.first == ch.<a class="code" href="classField__base.html#ae1377124eabe8387aced762115b062bb" title="Renvoie le nom du champ.">le_nom</a>().<a class="code" href="classNom.html#a855d8cd96b5c73c2aa55cb7c0a870640">getString</a>()), press = (n_m.first == <span class="stringliteral">&quot;pression&quot;</span>); <span class="comment">//est-on sur le bloc diagonal, sur le bloc pression?</span>
<a name="l00122"></a>00122         <a class="code" href="classMatrice__Morse.html" title="Classe Matrice_Morse Represente une matrice M (creuse), non necessairement carree stockee au format M...">Matrice_Morse</a>&amp; mat = *n_m.second;
<a name="l00123"></a>00123         <span class="keywordflow">for</span> (e = 0; e &lt; zone.<a class="code" href="classZone__dis__base.html#a790cb2f6bc2928518799e748313d0eb3">nb_elem</a>(); e++) <span class="keywordflow">for</span> (n = 0, m = 0; n &lt; N; n++, m += (M &gt; 1)) <span class="keywordflow">if</span> (<a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a>(e, n, 0))
<a name="l00124"></a>00124               {
<a name="l00125"></a>00125                 k = maj(e); <span class="comment">//phase majoritaire</span>
<a name="l00126"></a>00126                 <span class="keywordtype">double</span> dval = is_m ? 0 : milc.<a class="code" href="classMilieu__composite.html#ab01b847f409f1b43e64f471e1d673eb6">has_saturation</a>(n, k) ? (press ? milc.<a class="code" href="classMilieu__composite.html#acb12d79518b83d853a1bdf4c497ed09c">get_saturation</a>(n, k).<a class="code" href="classSaturation__base.html#a9397771f1c8916a87557da47b2cca39e">dP_Tsat</a>(p(e, m)) : 0) : diag; <span class="comment">//derivee de val (nulle si on n&#39;est pas sur le bon bloc)</span>
<a name="l00127"></a>00127                 <span class="keywordtype">int</span> cval = is_m ? -1 : milc.<a class="code" href="classMilieu__composite.html#ab01b847f409f1b43e64f471e1d673eb6">has_saturation</a>(n, k) ? M * e + m : N * e + k; <span class="comment">//indice de colonne associe a cette derivee</span>
<a name="l00128"></a>00128                 <span class="keywordflow">for</span> (i = mat.<a class="code" href="classMatrice__Morse.html#a79b4e334152850bd36e53478debf3061">get_tab1</a>()(N * e + n) - 1, j = mat.<a class="code" href="classMatrice__Morse.html#a79b4e334152850bd36e53478debf3061">get_tab1</a>()(N * e + k) - 1; i &lt; mat.<a class="code" href="classMatrice__Morse.html#a79b4e334152850bd36e53478debf3061">get_tab1</a>()(N * e + n + 1) - 1; i++, j++)
<a name="l00129"></a>00129                   {
<a name="l00130"></a>00130                     assert(mat.<a class="code" href="classMatrice__Morse.html#a787b5a63f27063f9c891243d8f188cda">get_tab2</a>()(j) == mat.<a class="code" href="classMatrice__Morse.html#a787b5a63f27063f9c891243d8f188cda">get_tab2</a>()(i));
<a name="l00131"></a>00131                     <span class="keywordtype">int</span> c = mat.<a class="code" href="classMatrice__Morse.html#a787b5a63f27063f9c891243d8f188cda">get_tab2</a>()(i) - 1; <span class="comment">//indice de colonne (commun aux deux lignes grace au dimensionner_blocs())</span>
<a name="l00132"></a>00132                     <span class="keywordtype">double</span> dflux = -<a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a>(e, n, 0) * mat.<a class="code" href="classMatrice__Morse.html#acd067e8514e5741f52b18a1d99746d11">get_set_coeff</a>()(i) + <a class="code" href="Champ__P1iP1B__implementation_8cpp.html#aa8c8f49390c3cf7c702d71a71bc977e3">coeff</a>(e, n, 1) * (diag * (c == N * e + n) - dval * (c == cval)); <span class="comment">//derivee de flux en secmem, inco, val</span>
<a name="l00133"></a>00133                     mat.<a class="code" href="classMatrice__Morse.html#acd067e8514e5741f52b18a1d99746d11">get_set_coeff</a>()(i) += (p_degen ? rho(!cR * e, n) : 1) * dflux;
<a name="l00134"></a>00134                     mat.<a class="code" href="classMatrice__Morse.html#acd067e8514e5741f52b18a1d99746d11">get_set_coeff</a>()(j) -= (p_degen ? rho(!cR * e, k) : 1) * dflux;
<a name="l00135"></a>00135                   }
<a name="l00136"></a>00136               }
<a name="l00137"></a>00137       }
<a name="l00138"></a>00138   <span class="keywordflow">if</span> (!is_m &amp;&amp; <a class="code" href="classMorEqn.html#a615dd9abff96edcb625fa0424a489864" title="Renvoie la reference sur l&#39;equation pointe par MorEqn::mon_equation. (version const)">equation</a>().<a class="code" href="classEquation__base.html#abc11e51aa75b4c7aa55c27f71eb2f2c4" title="Renvoie le schema en temps associe a l&#39;equation.">schema_temps</a>().<a class="code" href="classSchema__Temps__base.html#a5054df01edb6d4f7baec7e612d423834" title="Renvoie le temps courant.">temps_courant</a>() &gt; 0.68)
<a name="l00139"></a>00139     e++;
<a name="l00140"></a>00140 }
<a name="l00141"></a>00141 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Dec 14 2021 19:35:36 for TRUST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
